This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.claude/settings.local.json
.cursor/worktrees.json
.gitignore
app/.cursorrules
app/about/about-content.tsx
app/about/layout.tsx
app/about/page.tsx
app/actions/unsplash.ts
app/admin/badges/page.tsx
app/admin/events/page.tsx
app/admin/layout.tsx
app/admin/page.tsx
app/admin/partners/page.tsx
app/admin/roles/page.tsx
app/admin/users/page.tsx
app/api/community/free/posts/route.ts
app/api/payments/confirm/route.ts
app/api/upload/route.ts
app/auth/callback/route.ts
app/auth/error/page.tsx
app/auth/layout.tsx
app/auth/login/page.tsx
app/auth/sign-up-success/page.tsx
app/auth/sign-up/page.tsx
app/communities/layout.tsx
app/communities/new/page.tsx
app/communities/page.tsx
app/community/_components/board-filter-buttons.tsx
app/community/_components/events-section-header.tsx
app/community/announcements/[id]/page.tsx
app/community/announcements/loading.tsx
app/community/announcements/new/page.tsx
app/community/board/[slug]/[id]/loading.tsx
app/community/board/[slug]/[id]/page.tsx
app/community/board/[slug]/board-page-client.tsx
app/community/board/[slug]/layout.tsx
app/community/board/[slug]/loading.tsx
app/community/board/[slug]/new/page.tsx
app/community/board/[slug]/page.tsx
app/community/layout.tsx
app/community/page.tsx
app/community/posts/[id]/loading.tsx
app/community/posts/[id]/page.tsx
app/community/posts/layout.tsx
app/community/posts/new/page.tsx
app/community/posts/page.tsx
app/community/profile/[id]/page.tsx
app/community/profile/layout.tsx
app/community/profile/page.tsx
app/community/profile/ProfileContent.tsx
app/customer-center/layout.tsx
app/customer-center/page.tsx
app/e/[id]/edit/page.tsx
app/e/[id]/manage/page.tsx
app/e/[id]/opengraph-image.tsx
app/e/[id]/page.tsx
app/e/layout.tsx
app/e/new/page.tsx
app/e/page.tsx
app/error.tsx
app/events/[id]/edit/page.tsx
app/events/[id]/manage/page.tsx
app/events/[id]/opengraph-image.tsx
app/events/[id]/page.tsx
app/events/loading.tsx
app/events/new/page.tsx
app/events/page.tsx
app/fonts/PretendardVariable.woff2
app/global-error.tsx
app/globals.css
app/layout.tsx
app/member/layout.tsx
app/member/loading.tsx
app/member/page.tsx
app/opengraph-image.tsx
app/page.tsx
app/partners/[id]/page.tsx
app/partners/layout.tsx
app/partners/page.tsx
app/payment/fail/page.tsx
app/payment/success/page.tsx
app/privacy/page.tsx
app/projects/[id]/page.tsx
app/projects/layout.tsx
app/projects/new/page.tsx
app/projects/page.tsx
app/providers.tsx
app/reviews/test/page.tsx
app/robots.ts
app/sitemap.ts
app/terms/page.tsx
components.config.json.json
components/add-guest-form.tsx
components/admin/admin-breadcrumb.tsx
components/admin/admin-view.tsx
components/admin/badge-management-tab.tsx
components/admin/category-management-tab.tsx
components/admin/partner-applications-tab.tsx
components/admin/partners/partner-category-tab.tsx
components/admin/partners/partner-list-tab.tsx
components/admin/posts/partner-category-tab-simple.tsx
components/admin/posts/post-management-tab.tsx
components/auth-header.tsx
components/badge-management-row.tsx
components/badge-manager.tsx
components/comment-section.tsx
components/community-banner.tsx
components/community-intro.tsx
components/community-right-sidebar.tsx
components/community/community-grid.tsx
components/community/community-header.tsx
components/community/community-info-sidebar.tsx
components/community/community-mobile-bar.tsx
components/community/community-settings-modal.tsx
components/complete-event-button.tsx
components/customer-center/customer-center-content.tsx
components/daily-login-checker.tsx
components/dashboard-layout.tsx
components/delete-event-button.tsx
components/event-detail-content.tsx
components/event-detail-hero.tsx
components/event-post-card.tsx
components/event-share-button.tsx
components/export-csv-button.tsx
components/floating-action-bar.tsx
components/google-map-embed.tsx
components/home/announcement-banner.tsx
components/home/events-section-container.tsx
components/home/events-section.tsx
components/home/featured-events.tsx
components/home/feed-section-container.tsx
components/home/feed-section.tsx
components/home/filter-buttons.tsx
components/home/hero-section-container.tsx
components/home/hero-section-static.tsx
components/home/hero-section.tsx
components/home/home-page-client.tsx
components/home/latest-feed.tsx
components/home/posts-section.tsx
components/home/reviews-section.tsx
components/layout/standard-layout.tsx
components/layout/three-column-layout.tsx
components/like-button.tsx
components/manage-event-form-wrapper.tsx
components/member-card.tsx
components/member/member-detail-modal.tsx
components/member/member-list-client.tsx
components/mobile-action-bar.tsx
components/mobile-header-container.tsx
components/mobile-header.tsx
components/new-announcement-form.tsx
components/new-community-form.tsx
components/new-event-form.tsx
components/new-post-form.tsx
components/new-project-form.tsx
components/notifications-dropdown.tsx
components/page-header.tsx
components/partner-apply-button.tsx
components/partner-proposal-button-client.tsx
components/partner-proposal-dialog.tsx
components/payment/toss-payment-widget.tsx
components/post-actions.tsx
components/post-card.tsx
components/register-button.tsx
components/reviews/review-card.tsx
components/reviews/review-modal.tsx
components/rich-text-editor.tsx
components/role-manager.tsx
components/scrollbar-fix.tsx
components/sidebar-container.tsx
components/sidebar-logout-item.tsx
components/sidebar-profile-client.tsx
components/sidebar-profile.tsx
components/sidebar.tsx
components/site-header-client.tsx
components/site-header-static.tsx
components/site-header.tsx
components/skeletons.tsx
components/standard-right-sidebar.tsx
components/theme-provider.tsx
components/threaded-comments.tsx
components/ui/accordion.tsx
components/ui/alert-dialog.tsx
components/ui/alert.tsx
components/ui/aspect-ratio.tsx
components/ui/avatar.tsx
components/ui/badge.tsx
components/ui/breadcrumb.tsx
components/ui/button-group.tsx
components/ui/button.tsx
components/ui/calendar.tsx
components/ui/card.tsx
components/ui/carousel.tsx
components/ui/chart.tsx
components/ui/checkbox.tsx
components/ui/clickable-avatar.tsx
components/ui/collapsible.tsx
components/ui/combobox.tsx
components/ui/command.tsx
components/ui/context-menu.tsx
components/ui/dialog.tsx
components/ui/drawer.tsx
components/ui/dropdown-menu.tsx
components/ui/empty.tsx
components/ui/event-card.tsx
components/ui/feed-post-card.tsx
components/ui/field.tsx
components/ui/form.tsx
components/ui/hover-card.tsx
components/ui/input-group.tsx
components/ui/input-otp.tsx
components/ui/input.tsx
components/ui/insight-card.tsx
components/ui/item.tsx
components/ui/kbd.tsx
components/ui/label.tsx
components/ui/menubar.tsx
components/ui/navigation-menu.tsx
components/ui/pagination.tsx
components/ui/popover.tsx
components/ui/post-card.tsx
components/ui/post-list-item.tsx
components/ui/profile-popover.tsx
components/ui/progress.tsx
components/ui/radio-group.tsx
components/ui/resizable.tsx
components/ui/scroll-area.tsx
components/ui/select.tsx
components/ui/separator.tsx
components/ui/sheet.tsx
components/ui/sidebar.tsx
components/ui/skeleton.tsx
components/ui/slider.tsx
components/ui/sonner.tsx
components/ui/spinner.tsx
components/ui/switch.tsx
components/ui/table.tsx
components/ui/tabs.tsx
components/ui/textarea.tsx
components/ui/toast.tsx
components/ui/toaster.tsx
components/ui/toggle-group.tsx
components/ui/toggle.tsx
components/ui/tooltip.tsx
components/user-badges.tsx
components/user-management.tsx
DEPLOYMENT_DEBUG.md
FIX_API_KEY_ERROR.md
GOOGLE_MAPS_API_SETUP.md
GOOGLE_OAUTH_SETUP.md
hooks/use-mobile.ts
hooks/use-toast.ts
lib/actions/admin.ts
lib/actions/badge-categories.ts
lib/actions/badges.ts
lib/actions/comments.ts
lib/actions/community-moderators.ts
lib/actions/community.ts
lib/actions/event-registrations.ts
lib/actions/events.ts
lib/actions/feed.ts
lib/actions/inquiries.ts
lib/actions/partner-applications.ts
lib/actions/partner-proposals.ts
lib/actions/posts.ts
lib/actions/reviews.ts
lib/actions/user.ts
lib/actions/utils.ts
lib/api/posts.ts
lib/auth/server.ts
lib/format-time.ts
lib/hooks/usePosts.ts
lib/hooks/usePrefetchPosts.ts
lib/queries/announcements.ts
lib/queries/badges.ts
lib/queries/board-categories.ts
lib/queries/cached.ts
lib/queries/events.ts
lib/queries/feed.ts
lib/queries/posts.ts
lib/queries/profiles.ts
lib/supabase/admin.ts
lib/supabase/client.ts
lib/supabase/middleware.ts
lib/supabase/server.ts
lib/types/badges.ts
lib/types/events.ts
lib/types/home.ts
lib/types/posts.ts
lib/types/profile.ts
lib/types/reviews.ts
lib/types/supabase.ts
lib/types/unsplash.ts
lib/utils.ts
lib/utils/comments-tree.ts
lib/utils/event-detail.tsx
lib/utils/event-url.ts
lib/utils/scroll-lock.ts
lib/utils/unsplash.ts
middleware.ts
MOBILE_TEST_RESULTS.md
next-env.d.ts
next.config.mjs
package.json
postcss.config.mjs
public/apple-icon.png
public/icon-dark-32x32.png
public/icon-light-32x32.png
public/icon.svg
public/images/ec-a0-9c-eb-aa-a9-20-ec-97-86-ec-9d-8c-1.png
public/images/logo-circle.png
public/images/logo-text.jpg
public/images/logo-text.png
public/images/logo.png
public/images/sfc-logo.png
public/placeholder-logo.png
public/placeholder-logo.svg
public/placeholder-user.jpg
public/placeholder.jpg
public/placeholder.svg
QUICK_FIX.md
REDDIT_COMPARISON.md
REFACTORING_ANALYSIS_REPORT.md
REFACTORING_EXECUTION_REPORT.md
REFACTORING_FINAL_REPORT.md
REFACTORING_PHASE3_4_REPORT.md
REFACTORING_PLAN.md
RLS_FIX_INSTRUCTIONS.md
scripts/001_create_tables.sql
scripts/002_create_profile_trigger.sql
scripts/003_seed_sample_data.sql
scripts/003-add-membership-tiers.sql
scripts/006_add_points_and_admin.sql
scripts/007_create_sample_events.sql
scripts/008_add_guest_registration.sql
scripts/009_add_community_boards.sql
scripts/010_refactor_posts_with_board_categories.sql
scripts/011_create_projects_tables.sql
scripts/012_fix_event_thumbnails.sql
scripts/013_add_sample_announcements.sql
scripts/014_create_notifications.sql
scripts/015_set_master_admin.sql
scripts/016_posts_rls_policy.sql
scripts/017_ensure_public_read_policies.sql
scripts/018_check_data_and_policies.sql
scripts/019_fix_anonymous_access.sql
scripts/020_test_anonymous_queries.sql
scripts/021_debug_queries.sql
scripts/022_fix_inner_join_rls.sql
scripts/023_disable_realtime.sql
scripts/024_final_check_rls.sql
scripts/025_update_event_policies.sql
scripts/026_fix_rls_visibility.sql
scripts/027_point_system_full.sql
scripts/030_badge_system.sql
scripts/031_add_badge_status_and_evidence.sql
scripts/031_create_communities.sql
scripts/032_migrate_about_badges.sql
scripts/032_update_member_profile.sql
scripts/033_add_post_visibility.sql
scripts/033_final_badge_migration.sql
scripts/034_add_badge_is_active.sql
scripts/034_add_end_date.sql
scripts/034_create_partner_services.sql
scripts/035_add_test_badges.sql
scripts/035_seed_partner_services.sql
scripts/036_fix_badge_is_active_column.sql
scripts/036_rename_bangol_to_vangol.sql
scripts/037_add_badges_rls_policy.sql
scripts/037_add_event_request_category.sql
scripts/038_anonymous_likes.sql
scripts/038_create_categories_table.sql
scripts/039_create_inquiries_table.sql
scripts/039_event_custom_fields.sql
scripts/040_add_event_types.sql
scripts/040_create_partner_applications_table.sql
scripts/041_allow_guest_registration.sql
scripts/042_add_review_features.sql
scripts/043_fix_profile_trigger_and_recover_data.sql
scripts/044_add_insights_and_thumbnail.sql
scripts/045_fix_posts_rls.sql
scripts/046_add_social_links_to_profiles.sql
scripts/047_add_category_id_to_posts.sql
scripts/048_create_badge_categories_table.sql
scripts/049_create_community_moderators_table.sql
scripts/049_create_partner_proposals_table.sql
scripts/050_create_post_images_table.sql
scripts/050_create_reviews_table.sql
scripts/051_add_proof_url_to_user_badges.sql
scripts/052_add_thumbnail_url_to_partner_proposals.sql
scripts/053_fix_profile_columns_and_reload.sql
scripts/054_allow_admin_delete.sql
scripts/055_fix_delete_permissions_and_fkeys.sql
scripts/056_fix_profile_visibility_schema.sql
scripts/057_fix_badge_visibility_policy.sql
scripts/058_fix_missing_social_columns.sql
scripts/059_fix_badge_evidence_column.sql
scripts/060_add_second_affiliation.sql
scripts/060_auto_grant_community_leader_badge.sql
scripts/061_fix_new_year_event_date.sql
scripts/061_fix_post_delete_and_rls.sql
scripts/062_fix_community_update_policy.sql
scripts/062_sync_community_leader_badge.sql
scripts/063_add_badge_rejection_reason.sql
scripts/063_add_profile_tagline.sql
scripts/064_add_member_type.sql
scripts/064_fix_notifications_rls.sql
scripts/065_update_member_type_to_array.sql
scripts/066_fix_member_type_constraint.sql
scripts/067_profiles_admin_update_policy.sql
scripts/068_atomic_event_registration.sql
scripts/069_secure_event_registrations_rls.sql
scripts/070_add_waitlist_status.sql
scripts/070_community_reddit_overhaul.sql
scripts/071_disable_event_requests.sql
scripts/073_set_communities_public.sql
scripts/074_fix_community_delete_rls.sql
scripts/075_add_community_banner.sql
scripts/099_rebuild_community_schema.sql
scripts/100_upgrade_to_club_system.sql
scripts/999_seed_launch_data.sql
scripts/ALL_MIGRATIONS_README.md
scripts/badge_icon_update.sql
scripts/community_upgrade.sql
scripts/fix_questions_rls.sql
scripts/optimize_performance.sql
scripts/reload_schema.sql
scripts/test-helper.sh
SERVICE_ROLE_KEY_SETUP.md
styles/globals.css
supabase/.temp/cli-latest
supabase/.temp/gotrue-version
supabase/.temp/pooler-url
supabase/.temp/postgres-version
supabase/.temp/project-ref
supabase/.temp/rest-version
supabase/.temp/storage-migration
supabase/.temp/storage-version
TEST_RESULTS.md
TESTING_CHECKLIST.md
TROUBLESHOOTING.md
tsconfig.json
VERCEL_ENV_CHECK.md
vercel.json
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path=".cursor/worktrees.json">
{
  "setup-worktree": [
    "npm install"
  ]
}
</file>

<file path=".gitignore">
# dependencies
node_modules/

# production build
.next/
out/
dist/
build/

# local env
.env.local
.env.*.local

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*

# system files
.DS_Store
Thumbs.db

# vercel
.vercel/
</file>

<file path="app/.cursorrules">
# Role & Language
You are an expert AI developer using Cursor.
ALWAYS respond and think in **Korean (í•œêµ­ì–´)**.

# Constraints for Efficiency (Save Credits)
1. **No Chitchat**: Do not use conversational fillers like "Sure," "I can help with that," "Here is the code," or "Let's analyze." Start directly with the solution or plan.
2. **Concise Output**: Keep your responses and reasoning steps extremely brief and to the point to save tokens.
3. **Dry Style**: Use a dry, technical tone. (e.g., "ìˆ˜ì •í•˜ê² ìŠµë‹ˆë‹¤." instead of "ë„¤, ì œê°€ ê·¸ ë¶€ë¶„ì„ ìˆ˜ì •í•´ ë“œë¦´ê²Œìš”!")
4. **No Repetition**: Do not repeat the user's code unless necessary for context. Only show the changed parts or the final code block.

# Execution Rules
- When planning steps (Agent mode), describe your plan briefly in **Korean**.
- If the user asks for a code change, provide the code immediately without lengthy explanations.
- Skip "I have updated the file..." messages after the tool call. Just finish the task.
</file>

<file path="app/about/layout.tsx">
import type { ReactNode } from "react"
import { StandardLayout } from "@/components/layout/standard-layout"

export default function AboutLayout({ children }: { children: ReactNode }) {
  return <StandardLayout>{children}</StandardLayout>
}
</file>

<file path="app/about/page.tsx">
import AboutContent from "./about-content"
import { createClient } from "@/lib/supabase/server"

export default async function AboutPage() {
  console.log("ğŸš© About Page ì‹œì‘")
  
  const supabase = await createClient()
  
  // ì‚¬ìš©ì ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
  const { data: { user } } = await supabase.auth.getUser()
  
  // badge_categories í…Œì´ë¸”ì—ì„œ ì¹´í…Œê³ ë¦¬ ìˆœì„œ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
  const { data: badgeCategories } = await supabase
    .from("badge_categories")
    .select("category_value, category_label, sort_order")
    .order("sort_order", { ascending: true })
    .order("created_at", { ascending: true }) // 2ì°¨ ì •ë ¬: sort_orderê°€ ê°™ì€ ê²½ìš° created_at ê¸°ì¤€
  
  // badges í…Œì´ë¸”ì—ì„œ í™œì„±í™”ëœ ë±ƒì§€ë§Œ ê°€ì ¸ì˜¤ê¸° (is_active = true ë˜ëŠ” null)
  // âš ï¸ ìºì‹œ: Next.jsê°€ ì´ í˜ì´ì§€ë¥¼ ìºì‹œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
  //    ê´€ë¦¬ìì—ì„œ ë±ƒì§€ ìƒíƒœë¥¼ ë³€ê²½í•˜ë©´ revalidatePath("/about")ê°€ í˜¸ì¶œë˜ì–´ ìºì‹œê°€ ë¬´íš¨í™”ë©ë‹ˆë‹¤.
  const { data: badges } = await supabase
    .from("badges")
    .select("id, name, icon, category, description, created_at")
    .or("is_active.eq.true,is_active.is.null") // í™œì„±í™”ëœ ë±ƒì§€ë§Œ ì¡°íšŒ (true ë˜ëŠ” null)
    .order("created_at", { ascending: true })

  return (
    <AboutContent badges={badges || []} badgeCategories={badgeCategories || []} isLoggedIn={!!user} />
  )
}
</file>

<file path="app/actions/unsplash.ts">
"use server"

import type { UnsplashSearchResponse, UnsplashImage } from "@/lib/types/unsplash"

const UNSPLASH_ACCESS_KEY = process.env.UNSPLASH_ACCESS_KEY

/**
 * Unsplash APIë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ë¯¸ì§€ë¥¼ ê²€ìƒ‰í•˜ëŠ” ì„œë²„ ì•¡ì…˜
 * @param query ê²€ìƒ‰ì–´
 * @returns UnsplashSearchResponse íƒ€ì…ì˜ ê²€ìƒ‰ ê²°ê³¼
 */
export async function searchUnsplashImages(query: string): Promise<UnsplashSearchResponse> {
  console.log("Unsplash ê²€ìƒ‰ ìš”ì²­:", query)

  if (!UNSPLASH_ACCESS_KEY) {
    console.error("Unsplash API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. .env.local íŒŒì¼ì„ í™•ì¸í•´ì£¼ì„¸ìš”.")
    return {
      success: false,
      error: "ì„œë²„ ì„¤ì • ì˜¤ë¥˜: Unsplash API í‚¤ê°€ ì—†ìŠµë‹ˆë‹¤.",
    }
  }

  if (!query || query.trim().length === 0) {
    return {
      success: true,
      results: [],
    }
  }

  try {
    const url = `https://api.unsplash.com/search/photos?query=${encodeURIComponent(query.trim())}&per_page=20&client_id=${UNSPLASH_ACCESS_KEY}`
    
    const response = await fetch(url, {
      method: "GET",
      headers: {
        "Accept": "application/json",
      },
    })

    if (!response.ok) {
      let errorData: { errors?: string[] } = {}
      try {
        errorData = await response.json()
      } catch {
        // JSON íŒŒì‹± ì‹¤íŒ¨ ì‹œ ë¹ˆ ê°ì²´ ì‚¬ìš©
      }

      console.error("Unsplash API í˜¸ì¶œ ì—ëŸ¬:", response.status, errorData)

      // Rate Limit ë“± êµ¬ì²´ì ì¸ ì—ëŸ¬ ë©”ì‹œì§€ ì „ë‹¬
      if (response.status === 403) {
        return {
          success: false,
          error: "Unsplash API ìš”ì²­ í•œë„ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.",
        }
      }

      if (response.status === 401) {
        return {
          success: false,
          error: "Unsplash API ì¸ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. API í‚¤ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.",
        }
      }

      return {
        success: false,
        error: errorData.errors?.[0] || `Unsplash API ì˜¤ë¥˜: ${response.status}`,
      }
    }

    const data = await response.json() as {
      results?: Array<{
        id: string
        urls: {
          thumb: string
          small: string
          regular: string
          full: string
        }
        alt_description: string | null
        description: string | null
        width: number
        height: number
        user: {
          name: string
          username: string
        }
      }>
    }

    console.log(`Unsplash ê²€ìƒ‰ ì„±ê³µ: ${data.results?.length || 0}ê°œ ê²°ê³¼ ë°˜í™˜`)

    // UnsplashImage íƒ€ì…ì— ë§ê²Œ ë³€í™˜
    const images: UnsplashImage[] = (data.results || []).map((item) => ({
      id: item.id,
      urls: {
        thumb: item.urls.thumb,
        small: item.urls.small,
        regular: item.urls.regular,
        full: item.urls.full,
      },
      alt_description: item.alt_description,
      description: item.description,
      width: item.width,
      height: item.height,
      user: {
        name: item.user.name,
        username: item.user.username,
      },
    }))

    return {
      success: true,
      results: images,
    }
  } catch (error) {
    console.error("Unsplash ì´ë¯¸ì§€ ê²€ìƒ‰ ì¤‘ ì˜ˆì™¸ ë°œìƒ:", error)
    
    const errorMessage = error instanceof Error 
      ? error.message 
      : "ì´ë¯¸ì§€ ê²€ìƒ‰ ì¤‘ ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."

    return {
      success: false,
      error: errorMessage,
    }
  }
}
</file>

<file path="app/admin/badges/page.tsx">
import { requireAdmin } from "@/lib/auth/server"
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from "@/components/ui/table"
import { Medal } from "lucide-react"
import { BadgeManagementRow } from "@/components/badge-management-row"
import { AdminBreadcrumb } from "@/components/admin/admin-breadcrumb"

export default async function BadgesManagementPage() {
  const { supabase, user } = await requireAdmin()

  // pending ìƒíƒœì¸ ë±ƒì§€ ì‹ ì²­ë§Œ ì¡°íšŒ
  const { data: pendingBadges } = await supabase
    .from("user_badges")
    .select(`
      id,
      status,
      evidence,
      created_at,
      profiles:user_id (
        id,
        full_name,
        email,
        avatar_url
      ),
      badges:badge_id (
        id,
        name,
        icon
      )
    `)
    .eq("status", "pending")
    .order("created_at", { ascending: false })

  return (
    <div className="min-h-screen bg-white p-4 md:p-8 pt-20 md:pt-8">
      <div className="mx-auto max-w-7xl">
        <AdminBreadcrumb items={[{ label: "ë±ƒì§€ ë°œê¸‰ ê´€ë¦¬" }]} />

        <div className="mb-8">
          <div className="flex items-center gap-3">
            <Medal className="h-8 w-8 text-amber-500" />
            <div>
              <h1 className="text-3xl font-bold tracking-tight text-slate-900">ë±ƒì§€ ë°œê¸‰ ê´€ë¦¬</h1>
              <p className="mt-2 text-slate-600">ì‚¬ìš©ìê°€ ì‹ ì²­í•œ ë±ƒì§€ë¥¼ ê²€í† í•˜ê³  ìŠ¹ì¸/ê±°ì ˆí•©ë‹ˆë‹¤</p>
            </div>
          </div>
        </div>

        <Card className="border-slate-200">
          <CardHeader>
            <CardTitle>ëŒ€ê¸° ì¤‘ì¸ ë±ƒì§€ ì‹ ì²­ ({pendingBadges?.length || 0}ê±´)</CardTitle>
          </CardHeader>
          <CardContent>
            {pendingBadges && pendingBadges.length > 0 ? (
              <Table>
                <TableHeader>
                  <TableRow>
                    <TableHead>ì‹ ì²­ì</TableHead>
                    <TableHead>ì‹ ì²­ ë±ƒì§€</TableHead>
                    <TableHead>ì¦ë¹™ ìë£Œ</TableHead>
                    <TableHead>ì‹ ì²­ì¼</TableHead>
                    <TableHead className="text-right">ê´€ë¦¬</TableHead>
                  </TableRow>
                </TableHeader>
                <TableBody>
                  {pendingBadges.map((badgeRequest: any) => (
                    <BadgeManagementRow
                      key={badgeRequest.id}
                      badgeRequest={badgeRequest}
                    />
                  ))}
                </TableBody>
              </Table>
            ) : (
              <div className="py-12 text-center text-slate-500">
                <Medal className="h-12 w-12 mx-auto mb-3 text-slate-300" />
                <p>ëŒ€ê¸° ì¤‘ì¸ ë±ƒì§€ ì‹ ì²­ì´ ì—†ìŠµë‹ˆë‹¤</p>
              </div>
            )}
          </CardContent>
        </Card>
      </div>
    </div>
  )
}
</file>

<file path="app/admin/layout.tsx">
import type React from "react"
import { DashboardLayout } from "@/components/dashboard-layout"
import { SiteHeader } from "@/components/site-header"
import { createClient } from "@/lib/supabase/server"
import { getCurrentUserProfile } from "@/lib/queries/profiles"

export default async function AdminLayout({
  children,
}: {
  children: React.ReactNode
}) {
  const supabase = await createClient()
  const userProfile = await getCurrentUserProfile(supabase)
  const userRole = userProfile?.profile?.role || null

  return (
    <DashboardLayout header={<SiteHeader />} userRole={userRole}>
      <div className="p-6 lg:p-8">
        {children}
      </div>
    </DashboardLayout>
  )
}
</file>

<file path="app/admin/page.tsx">
import { requireAdmin } from "@/lib/auth/server"
import { AdminView } from "@/components/admin/admin-view"

export default async function AdminDashboard() {
  const { supabase, user, isMaster } = await requireAdmin()

  // Fetch all data in parallel
  const [usersResult, eventsResult, postsResult, badgesResult, pendingBadgesResult, categoriesResult, partnerApplicationsResult, badgeCategoriesResult] = await Promise.all([
    // Users: ì „ì²´ í”„ë¡œí•„ (ìµœì‹ ìˆœ)
    supabase
      .from("profiles")
      .select("id, full_name, email, role, membership_tier, points, created_at")
      .order("created_at", { ascending: false }),
    
    // Events: ì „ì²´ ì´ë²¤íŠ¸ (ìµœì‹ ìˆœ, í˜¸ìŠ¤íŠ¸ ì •ë³´ í¬í•¨)
    supabase
      .from("events")
      .select(`
        id,
        title,
        thumbnail_url,
        event_date,
        location,
        max_participants,
        created_at,
        profiles:created_by (
          id,
          full_name,
          avatar_url
        )
      `)
      .order("created_at", { ascending: false }),
    
    // Posts: ì „ì²´ ê²Œì‹œê¸€ (ìµœì‹ ìˆœ, ì‘ì„±ì ë° ê²Œì‹œíŒ ì •ë³´ í¬í•¨)
    supabase
      .from("posts")
      .select(`
        id,
        title,
        created_at,
        visibility,
        profiles:author_id (
          id,
          full_name,
          avatar_url
        ),
        board_categories:board_category_id (
          id,
          name,
          slug
        )
      `)
      .order("created_at", { ascending: false }),
    
    // Badges: ì „ì²´ ë±ƒì§€ ëª©ë¡ (ê´€ë¦¬ì í˜ì´ì§€ì—ì„œëŠ” ìˆ¨ê¹€ ì²˜ë¦¬ëœ ë±ƒì§€ë„ ëª¨ë‘ í‘œì‹œ, í•„í„°ë§ ì—†ìŒ)
    (async () => {
      try {
        // ë¨¼ì € is_active í•„ë“œ í¬í•¨í•˜ì—¬ ì‹œë„
        let { data, error } = await supabase
          .from("badges")
          .select("id, name, icon, category, description, is_active")
          .order("category", { ascending: true })
          .order("name", { ascending: true })
        
        // is_active í•„ë“œê°€ ì—†ì–´ì„œ ì—ëŸ¬ê°€ ë°œìƒí•œ ê²½ìš°, í•„ë“œ ì œì™¸í•˜ê³  ì¬ì‹œë„
        if (error && error.code === '42703') {
          console.warn("is_active í•„ë“œê°€ ì—†ìŠµë‹ˆë‹¤. í•„ë“œë¥¼ ì œì™¸í•˜ê³  ì¬ì‹œë„í•©ë‹ˆë‹¤.")
          const fallbackResult = await supabase
            .from("badges")
            .select("id, name, icon, category, description")
            .order("category", { ascending: true })
            .order("name", { ascending: true })
          
          if (fallbackResult.error) {
            console.error("Badges fallback query error:", fallbackResult.error)
            return { data: [], error: fallbackResult.error }
          }
          
          // is_active í•„ë“œê°€ ì—†ëŠ” ê²½ìš° ê¸°ë³¸ê°’ trueë¡œ ì„¤ì •
          data = (fallbackResult.data || []).map(badge => ({ ...badge, is_active: true }))
          error = null
        } else if (error) {
          console.error("Badges query error:", error)
          return { data: [], error }
        }
        
        // is_activeê°€ nullì´ê±°ë‚˜ undefinedì¸ ê²½ìš° ê¸°ë³¸ê°’ trueë¡œ ì„¤ì •
        const processedData = (data || []).map(badge => ({ 
          ...badge, 
          is_active: badge.is_active !== false // null, undefinedë„ trueë¡œ ì²˜ë¦¬
        }))
        
        return { data: processedData, error: null }
      } catch (err) {
        console.error("Badges query exception:", err)
        return { data: [], error: err }
      }
    })(),
    
    // Pending Badges: ëŒ€ê¸° ì¤‘ì¸ ë±ƒì§€ ì‹ ì²­
    supabase
      .from("user_badges")
      .select(`
        id,
        status,
        evidence,
        proof_url,
        created_at,
        profiles:user_id (
          id,
          full_name,
          email,
          avatar_url
        ),
        badges:badge_id (
          id,
          name,
          icon
        )
      `)
      .eq("status", "pending")
      .order("created_at", { ascending: false }),
    
    // Categories: ì „ì²´ ì¹´í…Œê³ ë¦¬ ëª©ë¡
    supabase
      .from("categories")
      .select("*")
      .order("type", { ascending: true })
      .order("created_at", { ascending: true }),
    
    // Partner Applications: íŒŒíŠ¸ë„ˆìŠ¤ ì‹ ì²­ ëª©ë¡ (ì‹ ì²­ì ì •ë³´ ì¡°ì¸)
    (async () => {
      try {
        const { data, error } = await supabase
          .from("partner_applications")
          .select(`
            id,
            created_at,
            status,
            company_name,
            current_usage,
            partner_name,
            profiles:user_id (
              id,
              full_name,
              email
            )
          `)
          .order("created_at", { ascending: false })
        
        if (error) {
          // í…Œì´ë¸”ì´ ì—†ì„ ê²½ìš° ë¹ˆ ë°°ì—´ ë°˜í™˜
          if (error.code === "42P01") {
            console.warn("partner_applications í…Œì´ë¸”ì´ ì—†ìŠµë‹ˆë‹¤.")
            return { data: [], error: null }
          }
          return { data: [], error }
        }
        
        return { data: data || [], error: null }
      } catch (err) {
        console.error("Partner applications query error:", err)
        return { data: [], error: err }
      }
    })(),
    
    // Badge Categories: ë±ƒì§€ ì¹´í…Œê³ ë¦¬ ìˆœì„œ ì •ë³´
    (async () => {
      try {
        const { data, error } = await supabase
          .from("badge_categories")
          .select("category_value, category_label, sort_order")
          .order("sort_order", { ascending: true })
        
        if (error) {
          // í…Œì´ë¸”ì´ ì—†ì„ ê²½ìš° ë¹ˆ ë°°ì—´ ë°˜í™˜
          if (error.code === "42P01") {
            console.warn("badge_categories í…Œì´ë¸”ì´ ì—†ìŠµë‹ˆë‹¤.")
            return { data: [], error: null }
          }
          return { data: [], error }
        }
        
        return { data: data || [], error: null }
      } catch (err) {
        console.error("Badge categories query error:", err)
        return { data: [], error: null }
      }
    })(),
  ])

  // Fetch registration counts for events
  const eventsWithCounts = await Promise.all(
    (eventsResult.data || []).map(async (event) => {
      const profile: any = (event as any).profiles
      const ownerProfile = Array.isArray(profile) ? profile[0] : profile

      const { count } = await supabase
        .from("event_registrations")
        .select("*", { count: "exact", head: true })
        .eq("event_id", event.id)

      return {
        ...event,
        profiles: ownerProfile,
        participantCount: count || 0,
      }
    })
  )

  // Normalize posts relations (Supabase íƒ€ì…ì´ ë°°ì—´ë¡œ ë°˜í™˜ë  ë•Œ ëŒ€ë¹„)
  const postsNormalized = (postsResult.data || []).map((post: any) => {
    const profile = Array.isArray(post.profiles) ? post.profiles[0] : post.profiles
    const category = Array.isArray(post.board_categories) ? post.board_categories[0] : post.board_categories
    return {
      ...post,
      profiles: profile,
      board_categories: category,
    }
  })

  // Normalize pending badges relations
  const pendingBadgesNormalized = (pendingBadgesResult.data || []).map((item: any) => {
    const profile = Array.isArray(item.profiles) ? item.profiles[0] : item.profiles
    const badge = Array.isArray(item.badges) ? item.badges[0] : item.badges
    return {
      ...item,
      profiles: profile,
      badges: badge,
    }
  })

  // Normalize partner applications relations
  const partnerApplicationsNormalized = (partnerApplicationsResult.data || []).map((item: any) => {
    const profile = Array.isArray(item.profiles) ? item.profiles[0] : item.profiles
    return { ...item, profiles: profile }
  })

  // badgesResult ì²˜ë¦¬ (ì—ëŸ¬ ë°œìƒ ì‹œ ë¹ˆ ë°°ì—´ ë°˜í™˜)
  let badgesData: any[] = []
  if (badgesResult && typeof badgesResult === 'object' && 'data' in badgesResult) {
    badgesData = badgesResult.data || []
  } else if (Array.isArray(badgesResult)) {
    badgesData = badgesResult
  }

  return (
    <AdminView
      users={usersResult.data || []}
      events={eventsWithCounts}
      posts={postsNormalized}
      badges={badgesData}
      pendingBadges={pendingBadgesNormalized}
      categories={categoriesResult.data || []}
      partnerApplications={partnerApplicationsNormalized}
      badgeCategories={badgeCategoriesResult.data || []}
      currentUserId={user.id}
      isMaster={isMaster}
    />
  )
}
</file>

<file path="app/admin/partners/page.tsx">
import { requireAdmin } from "@/lib/auth/server"
import { PartnerListTab } from "@/components/admin/partners/partner-list-tab"
import { PartnerApplicationsTab } from "@/components/admin/partner-applications-tab"
import { PartnerCategoryTab } from "@/components/admin/partners/partner-category-tab"
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs"
import { AdminBreadcrumb } from "@/components/admin/admin-breadcrumb"

export default async function AdminPartnersPage() {
  const { supabase } = await requireAdmin()

  // ë³‘ë ¬ ë°ì´í„° í˜ì¹­
  const [servicesResult, applicationsResult, categoriesResult] = await Promise.all([
    // Partner Services: íŒŒíŠ¸ë„ˆìŠ¤ ì„œë¹„ìŠ¤ ëª©ë¡
    (async () => {
      try {
        const { data, error } = await supabase
          .from("partner_services")
          .select(`
            id,
            title,
            description,
            category,
            thumbnail_url,
            is_verified,
            created_at,
            profiles:provider_id (
              id,
              full_name
            )
          `)
          .order("is_verified", { ascending: false })
          .order("created_at", { ascending: false })
        
        if (error) {
          console.error("Partner services query error:", error)
          return { data: [], error: null }
        }
        return { data: data || [], error: null }
      } catch (err) {
        console.error("Partner services query exception:", err)
        return { data: [], error: err }
      }
    })(),
    
    // Partner Applications: íŒŒíŠ¸ë„ˆìŠ¤ ì‹ ì²­ ëª©ë¡
    (async () => {
      try {
        const { data, error } = await supabase
          .from("partner_applications")
          .select(`
            id,
            created_at,
            status,
            company_name,
            current_usage,
            partner_name,
            profiles:user_id (
              id,
              full_name,
              email
            )
          `)
          .order("created_at", { ascending: false })
        
        if (error) {
          // í…Œì´ë¸”ì´ ì—†ì„ ê²½ìš° ë¹ˆ ë°°ì—´ ë°˜í™˜
          if (error.code === "42P01") {
            console.warn("partner_applications í…Œì´ë¸”ì´ ì—†ìŠµë‹ˆë‹¤.")
            return { data: [], error: null }
          }
          return { data: [], error }
        }
        return { data: data || [], error: null }
      } catch (err) {
        console.error("Partner applications query error:", err)
        return { data: [], error: err }
      }
    })(),
    
    // Categories: íŒŒíŠ¸ë„ˆìŠ¤ ì¹´í…Œê³ ë¦¬ë§Œ
    supabase
      .from("categories")
      .select("*")
      .eq("type", "partner")
      .order("created_at", { ascending: true }),
  ])

  const servicesNormalized = (servicesResult.data || []).map((item: any) => {
    const profile = Array.isArray(item.profiles) ? item.profiles[0] : item.profiles
    return { ...item, profiles: profile }
  })

  const applicationsNormalized = (applicationsResult.data || []).map((item: any) => {
    const profile = Array.isArray(item.profiles) ? item.profiles[0] : item.profiles
    return { ...item, profiles: profile }
  })

  return (
    <div className="w-full">
      <AdminBreadcrumb items={[{ label: "íŒŒíŠ¸ë„ˆìŠ¤ ê´€ë¦¬" }]} />

      <div className="mb-8">
        <h1 className="text-3xl font-bold tracking-tight text-slate-900">íŒŒíŠ¸ë„ˆìŠ¤ ê´€ë¦¬</h1>
        <p className="mt-2 text-slate-600">ì œíœ´ ì—…ì²´ ë° ì‹ ì²­ ë‚´ì—­ì„ ê´€ë¦¬í•©ë‹ˆë‹¤</p>
      </div>

      <div className="bg-white border border-slate-200 rounded-xl p-6">
        <Tabs defaultValue="list" className="w-full">
          <TabsList className="grid w-full max-w-2xl grid-cols-3 mb-6">
            <TabsTrigger value="list">ì œíœ´ ì—…ì²´ ëª©ë¡</TabsTrigger>
            <TabsTrigger value="applications">ì‹ ì²­ ë‚´ì—­ ê´€ë¦¬</TabsTrigger>
            <TabsTrigger value="categories">ì¹´í…Œê³ ë¦¬ ê´€ë¦¬</TabsTrigger>
          </TabsList>

          <TabsContent value="list" className="mt-0">
            <PartnerListTab
              initialServices={servicesNormalized}
              initialCategories={categoriesResult.data || []}
            />
          </TabsContent>

          <TabsContent value="applications" className="mt-0">
            <PartnerApplicationsTab
              applications={applicationsNormalized}
            />
          </TabsContent>

          <TabsContent value="categories" className="mt-0">
            <PartnerCategoryTab
              initialCategories={categoriesResult.data || []}
            />
          </TabsContent>
        </Tabs>
      </div>
    </div>
  )
}
</file>

<file path="app/admin/roles/page.tsx">
import { requireMaster } from "@/lib/auth/server";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Shield, Crown } from 'lucide-react';
import { RoleManager } from "@/components/role-manager";
import { AdminBreadcrumb } from "@/components/admin/admin-breadcrumb";

export default async function RolesManagementPage() {
  const { supabase, user } = await requireMaster();

  const { data: users } = await supabase
    .from("profiles")
    .select("id, full_name, email, role, created_at")
    .neq("id", user.id)
    .order("created_at", { ascending: false });

  return (
    <div className="min-h-screen bg-slate-50 p-4 md:p-8 pt-20 md:pt-8">
      <div className="mx-auto max-w-7xl">
        <AdminBreadcrumb items={[{ label: "ê´€ë¦¬ì ì§€ì •" }]} />

        <div className="mb-8">
          <div className="flex items-center gap-3">
            <Crown className="h-8 w-8 text-amber-500" />
            <div>
              <h1 className="text-3xl font-bold tracking-tight text-slate-900">
                ê´€ë¦¬ì ì§€ì •
              </h1>
              <p className="mt-2 text-slate-600">
                MASTER ì „ìš©: ë‹¤ë¥¸ íšŒì›ì—ê²Œ ê´€ë¦¬ì ê¶Œí•œ ë¶€ì—¬
              </p>
            </div>
          </div>
        </div>

        <Card className="mb-6 border-amber-200 bg-amber-50">
          <CardContent className="pt-6">
            <div className="flex items-start gap-3">
              <Shield className="h-5 w-5 text-amber-600 mt-0.5" />
              <div className="text-sm text-amber-800">
                <p className="font-medium mb-1">ê´€ë¦¬ì ê¶Œí•œ ì•ˆë‚´</p>
                <ul className="list-disc list-inside space-y-1 text-amber-700">
                  <li>ê²Œì‹œíŒ ì¹´í…Œê³ ë¦¬ ìƒì„±, ìˆ˜ì •, ì‚­ì œ</li>
                  <li>íšŒì› ëª©ë¡ ì¡°íšŒ ë° ê´€ë¦¬</li>
                  <li>ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ì ‘ê·¼</li>
                </ul>
                <p className="mt-2 font-medium">MASTER ê´€ë¦¬ìë§Œ ë‹¤ë¥¸ ê´€ë¦¬ìë¥¼ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
              </div>
            </div>
          </CardContent>
        </Card>

        <Card className="border-slate-200">
          <CardHeader>
            <CardTitle>íšŒì› ëª©ë¡</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="space-y-3">
              {users && users.length > 0 ? (
                users.map((member) => (
                  <RoleManager key={member.id} user={member} />
                ))
              ) : (
                <div className="py-12 text-center text-slate-500">
                  íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤
                </div>
              )}
            </div>
          </CardContent>
        </Card>
      </div>
    </div>
  );
}
</file>

<file path="app/admin/users/page.tsx">
import { requireAdmin } from "@/lib/auth/server"
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from "@/components/ui/table"
import { UserManagementRow } from "@/components/user-management"
import { AdminBreadcrumb } from "@/components/admin/admin-breadcrumb"

export default async function UsersManagementPage() {
  const { supabase, user, isMaster } = await requireAdmin()

  const { data: users } = await supabase
    .from("profiles")
    .select("id, full_name, email, role, membership_tier, points, created_at")
    .order("created_at", { ascending: false })

  return (
    <div className="min-h-screen bg-white p-4 md:p-8 pt-20 md:pt-8">
      <div className="mx-auto max-w-7xl">
        <AdminBreadcrumb items={[{ label: "íšŒì› ê´€ë¦¬" }]} />

        <div className="mb-8">
          <h1 className="text-3xl font-bold tracking-tight text-slate-900">íšŒì› ê´€ë¦¬</h1>
          <p className="mt-2 text-slate-600">ì „ì²´ íšŒì› ëª©ë¡ ë° ìƒì„¸ ì •ë³´</p>
        </div>

        <Card className="border-slate-200">
          <CardHeader>
            <CardTitle>íšŒì› ëª©ë¡ ({users?.length || 0}ëª…)</CardTitle>
          </CardHeader>
          <CardContent>
            {users && users.length > 0 ? (
              <Table>
                <TableHeader>
                  <TableRow>
                    <TableHead>ì´ë¦„</TableHead>
                    <TableHead>ì´ë©”ì¼</TableHead>
                    {/* <TableHead>í¬ì¸íŠ¸</TableHead> */}
                    <TableHead>ë“±ê¸‰</TableHead>
                    <TableHead>ê°€ì…ì¼</TableHead>
                    <TableHead className="text-right">ê´€ë¦¬</TableHead>
                  </TableRow>
                </TableHeader>
                <TableBody>
                  {users.map((member) => (
                    <UserManagementRow
                      key={member.id}
                      user={member}
                      currentUserId={user.id}
                      canChangeRole={isMaster}
                    />
                  ))}
                </TableBody>
              </Table>
            ) : (
              <div className="py-12 text-center text-slate-500">íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤</div>
            )}
          </CardContent>
        </Card>
      </div>
    </div>
  )
}
</file>

<file path="app/api/community/free/posts/route.ts">
import { NextRequest, NextResponse } from "next/server"
import { revalidatePath } from "next/cache"

import { createClient } from "@/lib/supabase/server"

const FREE_BOARD_SLUG = "free-board"

export async function POST(request: NextRequest) {
  try {
    const { title, content } = await request.json()

    if (!title || !content) {
      return NextResponse.json({ error: "ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”." }, { status: 400 })
    }

    const supabase = await createClient()
    const {
      data: { user },
    } = await supabase.auth.getUser()

    if (!user) {
      return NextResponse.json({ error: "ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤." }, { status: 401 })
    }

    const { data: category } = await supabase
      .from("board_categories")
      .select("id")
      .eq("slug", FREE_BOARD_SLUG)
      .eq("is_active", true)
      .single()

    if (!category) {
      return NextResponse.json({ error: "ììœ ê²Œì‹œíŒ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤." }, { status: 404 })
    }

    const { data, error } = await supabase
      .from("posts")
      .insert({
        title: title.trim(),
        content: content.trim(),
        author_id: user.id,
        board_category_id: category.id,
        category: FREE_BOARD_SLUG,
      })
      .select("id")
      .single()

    if (error) {
      throw error
    }

    revalidatePath("/community/free")

    return NextResponse.json({ id: data.id }, { status: 201 })
  } catch (error) {
    console.error("Failed to create free board post:", error)
    return NextResponse.json({ error: "ê²Œì‹œê¸€ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤." }, { status: 500 })
  }
}
</file>

<file path="app/api/payments/confirm/route.ts">
import { NextRequest, NextResponse } from "next/server";
import { createClient } from "@/lib/supabase/server";

export async function POST(request: NextRequest) {
  try {
    const body = await request.json();
    const { paymentKey, orderId, amount } = body;

    if (!paymentKey || !orderId || !amount) {
      return NextResponse.json(
        { error: "í•„ìˆ˜ íŒŒë¼ë¯¸í„°ê°€ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤." },
        { status: 400 }
      );
    }

    const secretKey = process.env.TOSS_SECRET_KEY;
    if (!secretKey) {
      return NextResponse.json(
        { error: "ì„œë²„ ì„¤ì • ì˜¤ë¥˜: TOSS_SECRET_KEYê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤." },
        { status: 500 }
      );
    }

    // í† ìŠ¤í˜ì´ë¨¼ì¸  ìŠ¹ì¸ API í˜¸ì¶œ
    const confirmResponse = await fetch(
      "https://api.tosspayments.com/v1/payments/confirm",
      {
        method: "POST",
        headers: {
          "Authorization": `Basic ${Buffer.from(secretKey + ":").toString("base64")}`,
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          paymentKey,
          orderId,
          amount,
        }),
      }
    );

    const paymentData = await confirmResponse.json();

    if (!confirmResponse.ok) {
      console.error("Toss payment confirmation failed:", paymentData);
      return NextResponse.json(
        { error: paymentData.message || "ê²°ì œ ìŠ¹ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤." },
        { status: confirmResponse.status }
      );
    }

    // orderIdì—ì„œ eventId ì¶”ì¶œ (í˜•ì‹: event-{eventId}-{timestamp})
    const eventIdMatch = orderId.match(/^event-([^-]+)-/);
    if (!eventIdMatch) {
      return NextResponse.json(
        { error: "ì˜ëª»ëœ ì£¼ë¬¸ ID í˜•ì‹ì…ë‹ˆë‹¤." },
        { status: 400 }
      );
    }
    const eventId = eventIdMatch[1];

    // Supabase í´ë¼ì´ì–¸íŠ¸ ìƒì„±
    const supabase = await createClient();
    const { data: { user } } = await supabase.auth.getUser();

    // ê²°ì œ ì •ë³´ì—ì„œ ê³ ê° ì •ë³´ ì¶”ì¶œ
    const customerName = paymentData.customer?.name || paymentData.customerName || "";
    const customerEmail = paymentData.customer?.email || paymentData.customerEmail || "";

    // ì›ìì  ì´ë²¤íŠ¸ ë“±ë¡ (Race Condition ë°©ì§€)
    // RPC í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ì •ì› ì²´í¬ì™€ ë“±ë¡ì„ í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ì²˜ë¦¬
    const { data: rpcResult, error: rpcError } = await supabase.rpc('register_for_event', {
      p_event_id: eventId,
      p_user_id: user?.id || null,
      p_guest_name: user ? null : customerName,
      p_guest_contact: user ? null : customerEmail,
    });

    if (rpcError) {
      console.error("RPC error:", rpcError);

      // RPC í•¨ìˆ˜ê°€ ì—†ëŠ” ê²½ìš° ê¸°ì¡´ ë°©ì‹ìœ¼ë¡œ í´ë°±
      if (rpcError.code === "42883") {
        console.warn("register_for_event í•¨ìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤. ê¸°ì¡´ ë°©ì‹ìœ¼ë¡œ ë“±ë¡í•©ë‹ˆë‹¤.");

        // ê¸°ì¡´ ë°©ì‹ (í´ë°±)
        const { data: event } = await supabase
          .from("events")
          .select("max_participants")
          .eq("id", eventId)
          .single();

        const { count: currentCount } = await supabase
          .from("event_registrations")
          .select("*", { count: "exact", head: true })
          .eq("event_id", eventId);

        if (event?.max_participants && currentCount && currentCount >= event.max_participants) {
          return NextResponse.json(
            { error: "ì´ë²¤íŠ¸ ì •ì›ì´ ë§ˆê°ë˜ì—ˆìŠµë‹ˆë‹¤." },
            { status: 400 }
          );
        }

        const registrationData: any = {
          event_id: eventId,
          registered_at: new Date().toISOString(),
          ...(user ? { user_id: user.id } : { guest_name: customerName, guest_contact: customerEmail }),
        };

        const { data: fallbackReg, error: insertError } = await supabase
          .from("event_registrations")
          .insert(registrationData)
          .select("id")
          .single();

        if (insertError) {
          if (insertError.code === "23505") {
            return NextResponse.json({ error: "ì´ë¯¸ ë“±ë¡ëœ ì´ë²¤íŠ¸ì…ë‹ˆë‹¤." }, { status: 400 });
          }
          return NextResponse.json({ error: "ë“±ë¡ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤." }, { status: 500 });
        }

        return NextResponse.json({
          success: true,
          registrationId: fallbackReg.id,
          paymentData: {
            paymentKey: paymentData.paymentKey,
            orderId: paymentData.orderId,
            amount: paymentData.totalAmount,
          },
        });
      }

      return NextResponse.json(
        { error: "ë“±ë¡ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤." },
        { status: 500 }
      );
    }

    // RPC ê²°ê³¼ ì²˜ë¦¬
    const registration = rpcResult?.[0];
    if (!registration?.success) {
      return NextResponse.json(
        { error: registration?.message || "ë“±ë¡ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤." },
        { status: 400 }
      );
    }

    return NextResponse.json({
      success: true,
      registrationId: registration.registration_id,
      paymentData: {
        paymentKey: paymentData.paymentKey,
        orderId: paymentData.orderId,
        amount: paymentData.totalAmount,
      },
    });
  } catch (error) {
    console.error("Payment confirmation error:", error);
    return NextResponse.json(
      { error: error instanceof Error ? error.message : "ê²°ì œ ìŠ¹ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤." },
      { status: 500 }
    );
  }
}
</file>

<file path="app/api/upload/route.ts">
import { put } from "@vercel/blob"
import { type NextRequest, NextResponse } from "next/server"
import { createClient } from "@/lib/supabase/server"

export async function POST(request: NextRequest) {
  try {
    // ì¸ì¦ ì²´í¬ - ë¡œê·¸ì¸í•œ ì‚¬ìš©ìë§Œ ì—…ë¡œë“œ ê°€ëŠ¥
    const supabase = await createClient()
    const { data: { user }, error: authError } = await supabase.auth.getUser()

    if (authError || !user) {
      return NextResponse.json(
        { error: "ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤." },
        { status: 401 }
      )
    }

    // BLOB_READ_WRITE_TOKEN í™˜ê²½ë³€ìˆ˜ í™•ì¸
    if (!process.env.BLOB_READ_WRITE_TOKEN) {
      console.error("âŒ BLOB_READ_WRITE_TOKEN is missing")
      return NextResponse.json(
        { error: "ì„œë²„ ì„¤ì • ì˜¤ë¥˜: BLOB_READ_WRITE_TOKENì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤." },
        { status: 500 }
      )
    }

    const formData = await request.formData()
    const file = formData.get("file") as File

    if (!file) {
      return NextResponse.json({ error: "íŒŒì¼ì´ ì œê³µë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤." }, { status: 400 })
    }

    // íŒŒì¼ íƒ€ì… ê²€ì¦ (ì´ë¯¸ì§€ ë˜ëŠ” PDF)
    const allowedTypes = [
      "image/jpeg",
      "image/jpg", 
      "image/png",
      "application/pdf"
    ]
    const allowedExtensions = [".jpg", ".jpeg", ".png", ".pdf"]
    
    const fileExtension = "." + file.name.split(".").pop()?.toLowerCase()
    const isValidType = allowedTypes.includes(file.type) || allowedExtensions.includes(fileExtension)
    
    if (!isValidType) {
      return NextResponse.json({ 
        error: "JPG, JPEG, PNG, PDF íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤." 
      }, { status: 400 })
    }

    // íŒŒì¼ í¬ê¸° ì œí•œ (10MB)
    const maxSize = 10 * 1024 * 1024 // 10MB
    if (file.size > maxSize) {
      return NextResponse.json({ error: "íŒŒì¼ í¬ê¸°ëŠ” 10MBë¥¼ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤." }, { status: 400 })
    }

    // Upload to Vercel Blob
    // addRandomSuffixë¥¼ ì‚¬ìš©í•˜ì—¬ ê³ ìœ í•œ íŒŒì¼ëª… ìƒì„± (ê°™ì€ ì´ë¦„ì˜ íŒŒì¼ì´ ìˆì–´ë„ ë®ì–´ì“°ê¸° ë°©ì§€)
    const blob = await put(file.name, file, {
      access: "public",
      addRandomSuffix: true,
    })

    return NextResponse.json({
      url: blob.url,
      filename: file.name,
      size: file.size,
      type: file.type,
    })
  } catch (error) {
    console.error("Upload error:", error)
    const errorMessage = error instanceof Error ? error.message : "ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."
    return NextResponse.json(
      { error: `ì—…ë¡œë“œ ì‹¤íŒ¨: ${errorMessage}` },
      { status: 500 }
    )
  }
}
</file>

<file path="app/auth/error/page.tsx">
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { AlertCircle } from 'lucide-react';
import { AuthHeader } from "@/components/auth-header";

export default async function ErrorPage({
  searchParams,
}: {
  searchParams: Promise<{ error: string }>;
}) {
  const params = await searchParams;

  return (
    <>
      <AuthHeader />

      <div className="flex min-h-screen w-full items-center justify-center bg-gradient-to-br from-slate-50 to-slate-100 p-6 pt-20">
        <div className="w-full max-w-sm">
          <Card className="border-red-200 shadow-lg">
            <CardHeader className="text-center">
              <div className="mx-auto mb-4 flex h-12 w-12 items-center justify-center rounded-full bg-red-100">
                <AlertCircle className="h-6 w-6 text-red-600" />
              </div>
              <CardTitle className="text-2xl text-red-900">
                Something went wrong
              </CardTitle>
            </CardHeader>
            <CardContent>
              {params?.error ? (
                <p className="text-center text-sm text-slate-600">
                  Error: {params.error}
                </p>
              ) : (
                <p className="text-center text-sm text-slate-600">
                  An unspecified error occurred.
                </p>
              )}
            </CardContent>
          </Card>
        </div>
      </div>
    </>
  );
}
</file>

<file path="app/auth/layout.tsx">
import { DashboardLayout } from "@/components/dashboard-layout"
import { SiteHeader } from "@/components/site-header"
import { ThreeColumnLayout } from "@/components/layout/three-column-layout"
import { StandardRightSidebar } from "@/components/standard-right-sidebar"

export default function AuthLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <DashboardLayout header={<SiteHeader />}>
      <ThreeColumnLayout rightSidebar={<StandardRightSidebar />}>
        {children}
      </ThreeColumnLayout>
    </DashboardLayout>
  )
}
</file>

<file path="app/auth/login/page.tsx">
"use client"

import { createClient } from "@/lib/supabase/client"
import { Button } from "@/components/ui/button"
import { useState, Suspense } from "react"
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import Link from "next/link"
import Image from "next/image"
import { useSearchParams } from "next/navigation"

function LoginContent() {
  const searchParams = useSearchParams()
  const next = searchParams.get("next") || "/"
  const [error, setError] = useState<string | null>(null)
  const [isLoading, setIsLoading] = useState(false)

  const handleGoogleLogin = async () => {
    const supabase = createClient()
    setIsLoading(true)
    setError(null)

    try {
      const { error } = await supabase.auth.signInWithOAuth({
        provider: "google",
        options: {
          // í™˜ê²½ ë³€ìˆ˜ ëŒ€ì‹  í˜„ì¬ ë¸Œë¼ìš°ì €ì˜ originì„ ì‚¬ìš©í•˜ì—¬
          // ë¡œì»¬ì—ì„œëŠ” localhostë¡œ, ë°°í¬ í™˜ê²½ì—ì„œëŠ” ë„ë©”ì¸ìœ¼ë¡œ ì´ë™í•˜ë„ë¡ ìˆ˜ì •
          redirectTo: `${window.location.origin}/auth/callback?next=${next}`,
          queryParams: {
            access_type: 'offline',
            prompt: 'consent',
          },
        },
      })
      if (error) throw error
    } catch (error: unknown) {
      setError(error instanceof Error ? error.message : "An error occurred")
      setIsLoading(false)
    }
  }

  return (
    <Card className="w-full max-w-[420px] p-8 border-none shadow-xl rounded-2xl bg-white animate-in fade-in zoom-in-95 duration-500">
      <CardHeader className="flex flex-col items-center space-y-4 pb-0">

        {/* ë¡œê³  ì˜ì—­ (í™•ì‹¤í•˜ê²Œ í‚¤ì›€ w-32) */}
        <div className="flex flex-col items-center gap-4">
          <div className="relative w-32 h-32 shadow-lg rounded-full overflow-hidden border-[5px] border-white bg-white">
            <Image
              src="/images/logo.png"
              alt="Seoul Founders Club Logo"
              width={256}
              height={256}
              quality={100}
              className="object-cover w-full h-full"
              priority
            />
          </div>
          <Image
            src="/images/logo-text.png"
            alt="SEOUL FOUNDERS CLUB"
            width={160}
            height={28}
            className="object-contain opacity-90 h-auto"
            quality={100}
            priority
          />
        </div>

        <div className="text-center space-y-1">
          <CardTitle className="text-2xl font-bold text-slate-900">
            í™˜ì˜í•©ë‹ˆë‹¤!
          </CardTitle>
          <p className="text-[13px] text-slate-500 leading-relaxed">
            ì„œìš¸ íŒŒìš´ë”ìŠ¤ í´ëŸ½ì—ì„œ<br />
            í•¨ê»˜ ì„±ì¥í•˜ê³  ì—°ê²°ë˜ì„¸ìš”.
          </p>
        </div>
      </CardHeader>

      <CardContent className="flex flex-col gap-3 mt-2 p-0">
        <Button
          type="button"
          variant="outline"
          className="w-full h-12 text-[15px] bg-white hover:bg-slate-50 border border-slate-200 text-slate-700 font-medium relative shadow-sm transition-all hover:shadow-md rounded-xl"
          onClick={handleGoogleLogin}
          disabled={isLoading}
        >
          <div className="absolute left-4 flex items-center justify-center">
            <svg className="h-5 w-5" viewBox="0 0 24 24">
              <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4" />
              <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853" />
              <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05" />
              <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335" />
            </svg>
          </div>
          {isLoading ? "ì—°ê²° ì¤‘..." : "Googleë¡œ ê³„ì†í•˜ê¸°"}
        </Button>

        {error && <p className="text-xs text-red-600 text-center bg-red-50 p-2 rounded-lg">{error}</p>}

        <div className="mt-1 text-center">
          <p className="text-[10px] text-slate-400 leading-relaxed">
            ê³„ì† ì§„í–‰í•¨ìœ¼ë¡œì¨ Seoul Founders Clubì˜{" "}
            <Link href="/terms" className="underline underline-offset-2 hover:text-slate-600 transition-colors" target="_blank">
              ì´ìš©ì•½ê´€
            </Link>
            {" "}ë°{" "}
            <Link href="/privacy" className="underline underline-offset-2 hover:text-slate-600 transition-colors" target="_blank">
              ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨
            </Link>
            ì—<br />
            ë™ì˜í•˜ëŠ” ê²ƒìœ¼ë¡œ ê°„ì£¼ë©ë‹ˆë‹¤.
          </p>
        </div>
      </CardContent>
    </Card>
  )
}

export default function LoginPage() {
  return (
    <div className="flex items-center justify-center min-h-[60vh] py-12">
      <Suspense fallback={<div>Loading...</div>}>
        <LoginContent />
      </Suspense>
    </div>
  )
}
</file>

<file path="app/auth/sign-up-success/page.tsx">
import {
  Card,
  CardContent,
  CardDescription,
  CardHeader,
  CardTitle,
} from "@/components/ui/card";
import { CheckCircle } from 'lucide-react';
import Link from "next/link";
import Image from "next/image";

export default function SignUpSuccessPage() {
  return (
    <>
      <header className="fixed inset-x-0 top-0 z-50 h-14 w-full border-b border-slate-200 bg-white/95 backdrop-blur supports-[backdrop-filter]:bg-white/90">
        <div className="mx-auto flex h-14 w-full max-w-7xl items-center px-4 lg:px-[27px]">
          <Link href="/" className="flex items-center hover:opacity-85 transition-opacity">
            <Image
              src="/images/logo-text.png"
              alt="Seoul Founders Club"
              width={120}
              height={24}
              className="h-6 w-auto object-contain"
              priority
            />
          </Link>
        </div>
      </header>

      <div className="flex min-h-screen w-full items-center justify-center bg-gradient-to-br from-slate-50 to-slate-100 p-6 pt-20">
        <div className="w-full max-w-sm">
          <Card className="border-slate-200 shadow-lg">
            <CardHeader className="text-center">
              <div className="mx-auto mb-4 flex h-12 w-12 items-center justify-center rounded-full bg-green-100">
                <CheckCircle className="h-6 w-6 text-green-600" />
              </div>
              <CardTitle className="text-2xl">Check your email</CardTitle>
              <CardDescription>
                We've sent you a confirmation link
              </CardDescription>
            </CardHeader>
            <CardContent>
              <p className="text-center text-sm text-slate-600">
                Please check your email and click the confirmation link to activate your account.
              </p>
            </CardContent>
          </Card>
        </div>
      </div>
    </>
  );
}
</file>

<file path="app/auth/sign-up/page.tsx">
"use client";

import { createClient } from "@/lib/supabase/client";
import { Button } from "@/components/ui/button";
import {
  Card,
  CardContent,
  CardDescription,
  CardHeader,
  CardTitle,
} from "@/components/ui/card";
import { useState } from "react";
import Link from "next/link";
import Image from "next/image";
import { AuthHeader } from "@/components/auth-header";

export default function SignUpPage() {
  const [error, setError] = useState<string | null>(null);
  const [isLoading, setIsLoading] = useState(false);

  const handleGoogleSignUp = async () => {
    const supabase = createClient();
    setIsLoading(true);
    setError(null);

    try {
      const { error } = await supabase.auth.signInWithOAuth({
        provider: 'google',
        options: {
          redirectTo: process.env.NEXT_PUBLIC_DEV_SUPABASE_REDIRECT_URL || `${window.location.origin}/auth/callback`,
        },
      });
      if (error) throw error;
    } catch (error: unknown) {
      setError(error instanceof Error ? error.message : "An error occurred");
      setIsLoading(false);
    }
  };

  return (
    <>
      <AuthHeader />

      <div className="flex min-h-screen w-full items-center justify-center bg-gradient-to-br from-slate-50 to-slate-100 p-6 pt-20">
        <div className="w-full max-w-sm">
          <div className="mb-8 text-center">
            <h1 className="text-3xl font-bold tracking-tight text-slate-900">Seoul Founders Club</h1>
            <p className="mt-2 text-sm text-slate-600">ì„œìš¸ì˜ ì°½ì—…ê°€ë“¤ê³¼ í•¨ê»˜í•˜ì„¸ìš”</p>
          </div>
          <Card className="border-slate-200 shadow-lg">
            <CardHeader>
              <CardTitle className="text-2xl">íšŒì›ê°€ì…</CardTitle>
              <CardDescription>
                Google ê³„ì •ìœ¼ë¡œ ì‹œì‘í•˜ì„¸ìš”
              </CardDescription>
            </CardHeader>
            <CardContent>
              <div className="flex flex-col gap-4">
                <Button
                  type="button"
                  variant="outline"
                  className="w-full h-12"
                  onClick={handleGoogleSignUp}
                  disabled={isLoading}
                >
                  <svg className="mr-2 h-5 w-5" viewBox="0 0 24 24">
                    <path
                      d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"
                      fill="#4285F4"
                    />
                    <path
                      d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"
                      fill="#34A853"
                    />
                    <path
                      d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"
                      fill="#FBBC05"
                    />
                    <path
                      d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"
                      fill="#EA4335"
                    />
                  </svg>
                  {isLoading ? "ê°€ì… ì¤‘..." : "Googleë¡œ ì‹œì‘í•˜ê¸°"}
                </Button>
                {error && <p className="text-sm text-red-600 text-center">{error}</p>}
              </div>
            </CardContent>
          </Card>
        </div>
      </div>
    </>
  );
}
</file>

<file path="app/communities/layout.tsx">
import type React from "react"
import { DashboardLayout } from "@/components/dashboard-layout"
import { SiteHeader } from "@/components/site-header"

export default function CommunitiesLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <DashboardLayout header={<SiteHeader />}>
      {children}
    </DashboardLayout>
  )
}
</file>

<file path="app/community/_components/board-filter-buttons.tsx">
"use client"

import { Button } from "@/components/ui/button"
import { cn } from "@/lib/utils"

export type BoardFilter = "all" | "vangol" | "hightalk" | "free-board" | "other"

const filterOptions: { value: BoardFilter; label: string }[] = [
  { value: "all", label: "ì „ì²´" },
  { value: "vangol", label: "ë°˜ê³¨" },
  { value: "hightalk", label: "í•˜ì´í† í¬" },
  { value: "free-board", label: "ììœ ê²Œì‹œíŒ" },
  { value: "other", label: "ê¸°íƒ€" },
]

interface BoardFilterButtonsProps {
  activeFilter: BoardFilter
  onFilterChange: (filter: BoardFilter) => void
}

export function BoardFilterButtons({
  activeFilter,
  onFilterChange,
}: BoardFilterButtonsProps) {
  return (
    <div className="flex flex-wrap gap-2">
      {filterOptions.map((option) => (
        <Button
          key={option.value}
          variant={activeFilter === option.value ? "default" : "outline"}
          size="sm"
          onClick={() => onFilterChange(option.value)}
          className={cn(
            activeFilter === option.value &&
              "bg-primary text-primary-foreground"
          )}
        >
          {option.label}
        </Button>
      ))}
    </div>
  )
}
</file>

<file path="app/community/_components/events-section-header.tsx">
import { CardHeader, CardTitle } from "@/components/ui/card"
import { Button } from "@/components/ui/button"
import Link from "next/link"
import { Plus } from "lucide-react"

export function EventsSectionHeader() {
  return (
    <CardHeader className="flex flex-row items-center justify-between">
      <CardTitle>ì´ë²¤íŠ¸</CardTitle>
      <div className="hidden lg:block">
        <Button asChild size="sm">
          <Link href="/events/new">
            <Plus className="mr-2 h-4 w-4" />
            ìƒˆ ì´ë²¤íŠ¸
          </Link>
        </Button>
      </div>
    </CardHeader>
  )
}
</file>

<file path="app/community/announcements/[id]/page.tsx">
import { createClient } from "@/lib/supabase/server";
import { notFound } from 'next/navigation';
import { Card, CardContent } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Megaphone } from 'lucide-react';
import { CommentSection } from "@/components/comment-section";
import Link from "next/link";
import { Button } from "@/components/ui/button";

export default async function AnnouncementDetailPage({
  params,
}: {
  params: { id: string };
}) {
  const supabase = await createClient();

  const { data: { user } } = await supabase.auth.getUser();

  const { data: announcement } = await supabase
    .from("posts")
    .select(`
      *,
      profiles:author_id (full_name, avatar_url)
    `)
    .eq("id", params.id)
    .eq("category", "announcement")
    .single();

  if (!announcement) {
    notFound();
  }

  const { data: comments } = await supabase
    .from("comments")
    .select(`
      *,
      profiles:author_id (id, full_name, avatar_url)
    `)
    .eq("post_id", params.id)
    .order("created_at", { ascending: false });

  const createdAt = new Date(announcement.created_at);

  return (
    <div className="min-h-screen bg-slate-50 p-8">
      <div className="mx-auto max-w-4xl">
        <div className="mb-6">
          <Link href="/community/announcements">
            <Button variant="ghost">â† ëª©ë¡ìœ¼ë¡œ</Button>
          </Link>
        </div>

        <Card className="mb-6 border-slate-200">
          <CardContent className="p-8">
            <div className="mb-4 flex items-center gap-2">
              <Megaphone className="h-5 w-5 text-blue-600" />
              <Badge variant="secondary">ê³µì§€ì‚¬í•­</Badge>
              <span className="text-sm text-slate-500">
                {createdAt.toLocaleDateString('ko-KR', {
                  year: 'numeric',
                  month: 'long',
                  day: 'numeric',
                })}
              </span>
            </div>

            <h1 className="mb-6 text-3xl font-bold text-slate-900">
              {announcement.title}
            </h1>

            <div className="mb-6 flex items-center gap-3">
              <div className="h-10 w-10 rounded-full bg-slate-200 flex items-center justify-center font-semibold text-slate-700">
                {announcement.profiles?.full_name?.[0] || 'U'}
              </div>
              <div>
                <p className="font-medium text-slate-900">
                  {announcement.profiles?.full_name || 'Unknown'}
                </p>
                <p className="text-sm text-slate-500">ì‘ì„±ì</p>
              </div>
            </div>

            <div className="prose prose-slate max-w-none mb-6">
              <p className="whitespace-pre-wrap text-slate-700 leading-relaxed">
                {announcement.content}
              </p>
            </div>

          </CardContent>
        </Card>

        <CommentSection 
          postId={announcement.id} 
          userId={user?.id} 
          comments={comments || []} 
          readOnly={true}
        />
      </div>
    </div>
  );
}
</file>

<file path="app/community/announcements/loading.tsx">
import { Card, CardContent } from "@/components/ui/card";
import { Skeleton } from "@/components/ui/skeleton";

export default function AnnouncementsLoading() {
  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <div className="space-y-2">
          <Skeleton className="h-10 w-32" />
          <Skeleton className="h-5 w-64" />
        </div>
        <Skeleton className="h-10 w-32" />
      </div>

      <div className="space-y-4">
        {[1, 2, 3].map((i) => (
          <Card key={i} className="border border-slate-200">
            <CardContent className="p-6">
              <div className="flex items-start gap-4">
                <Skeleton className="h-14 w-14 rounded-lg" />
                <div className="flex-1 space-y-2">
                  <div className="flex items-center gap-2">
                    <Skeleton className="h-5 w-16" />
                    <Skeleton className="h-4 w-24" />
                  </div>
                  <Skeleton className="h-7 w-3/4" />
                  <Skeleton className="h-4 w-full" />
                  <Skeleton className="h-4 w-2/3" />
                  <div className="flex items-center gap-4">
                    <Skeleton className="h-4 w-24" />
                    <Skeleton className="h-4 w-16" />
                  </div>
                </div>
              </div>
            </CardContent>
          </Card>
        ))}
      </div>
    </div>
  );
}
</file>

<file path="app/community/announcements/new/page.tsx">
import { createClient } from "@/lib/supabase/server";
import { redirect } from 'next/navigation';
import { NewAnnouncementForm } from "@/components/new-announcement-form";

export default async function NewAnnouncementPage() {
  const supabase = await createClient();

  const { data: { user } } = await supabase.auth.getUser();
  if (!user) {
    redirect("/auth/login");
  }

  return (
    <div className="min-h-screen bg-slate-50 p-8">
      <div className="mx-auto max-w-3xl">
        <div className="mb-8">
          <h1 className="text-3xl font-bold tracking-tight text-slate-900">
            ê³µì§€ì‚¬í•­ ì‘ì„±
          </h1>
          <p className="mt-2 text-slate-600">
            ì»¤ë®¤ë‹ˆí‹°ì— ì¤‘ìš”í•œ ê³µì§€ë¥¼ ì „ë‹¬í•˜ì„¸ìš”
          </p>
        </div>

        <NewAnnouncementForm />
      </div>
    </div>
  );
}
</file>

<file path="app/community/board/[slug]/[id]/loading.tsx">
import { Card, CardContent } from "@/components/ui/card"
import { Skeleton } from "@/components/ui/skeleton"

export default function PostDetailLoading() {
  return (
    <div className="w-full flex flex-col gap-6">
      {/* í—¤ë” (ë’¤ë¡œê°€ê¸°) */}
      <div className="flex items-center gap-2">
        <Skeleton className="h-5 w-5" />
        <Skeleton className="h-5 w-20" />
      </div>

      {/* ê²Œì‹œê¸€ ì¹´ë“œ */}
      <Card className="border border-slate-200 rounded-xl shadow-sm bg-white">
        <CardContent className="p-6 md:p-8">
          {/* ê²Œì‹œíŒ íƒœê·¸ */}
          <Skeleton className="h-6 w-20 mb-4 rounded-md" />

          {/* ì‘ì„±ì ì •ë³´ */}
          <div className="mb-6 flex items-center gap-3">
            <Skeleton className="h-10 w-10 rounded-full" />
            <div>
              <Skeleton className="h-4 w-24 mb-1" />
              <Skeleton className="h-3 w-32" />
            </div>
          </div>

          {/* ì œëª© */}
          <Skeleton className="h-8 w-3/4 mb-8" />

          {/* ë³¸ë¬¸ */}
          <div className="space-y-3 mb-10">
            <Skeleton className="h-4 w-full" />
            <Skeleton className="h-4 w-full" />
            <Skeleton className="h-4 w-5/6" />
            <Skeleton className="h-4 w-full" />
            <Skeleton className="h-4 w-4/5" />
          </div>

          {/* í•˜ë‹¨ ì•¡ì…˜ */}
          <div className="flex items-center justify-between pt-6 border-t border-slate-100">
            <div className="flex items-center gap-4">
              <Skeleton className="h-8 w-16" />
              <Skeleton className="h-8 w-16" />
            </div>
            <Skeleton className="h-8 w-16" />
          </div>

          {/* ëŒ“ê¸€ ì„¹ì…˜ */}
          <div className="mt-8 pt-8 border-t border-slate-100">
            <Skeleton className="h-6 w-20 mb-6" />
            <div className="space-y-4">
              <Skeleton className="h-24 w-full rounded-lg" />
              <Skeleton className="h-20 w-full rounded-lg" />
            </div>
          </div>
        </CardContent>
      </Card>
    </div>
  )
}
</file>

<file path="app/community/board/[slug]/loading.tsx">
import { Skeleton } from "@/components/ui/skeleton"
import { PageHeaderSkeleton } from "@/components/page-header"

export default function BoardLoading() {
  return (
    <div className="w-full flex flex-col gap-8">
      <div className="flex flex-col gap-6">
        {/* ë°°ë„ˆ ìŠ¤ì¼ˆë ˆí†¤ - PageHeaderì™€ ë™ì¼í•œ í¬ê¸° */}
        <PageHeaderSkeleton compact={true} className="mb-0" />

        {/* ë·° ëª¨ë“œ í† ê¸€ + ë²„íŠ¼ ì˜ì—­ */}
        <div className="flex items-center justify-between bg-white p-2 rounded-lg border border-slate-200 shadow-sm">
          <Skeleton className="h-9 w-36 rounded-xl" />
          <Skeleton className="h-10 w-28 rounded-full" />
        </div>

        {/* ê²Œì‹œê¸€ ë¦¬ìŠ¤íŠ¸ ìŠ¤ì¼ˆë ˆí†¤ */}
        <div className="flex flex-col gap-4">
          {[1, 2, 3, 4, 5].map((i) => (
            <div key={i} className="bg-white rounded-2xl border border-slate-100 p-5">
              <div className="flex items-center gap-3 mb-3">
                <Skeleton className="h-8 w-8 rounded-full" />
                <div className="flex-1">
                  <Skeleton className="h-4 w-24 mb-1" />
                  <Skeleton className="h-3 w-32" />
                </div>
              </div>
              <Skeleton className="h-6 w-3/4 mb-2" />
              <Skeleton className="h-4 w-full mb-1" />
              <Skeleton className="h-4 w-2/3 mb-4" />
              <div className="flex items-center gap-4">
                <Skeleton className="h-4 w-12" />
                <Skeleton className="h-4 w-12" />
              </div>
            </div>
          ))}
        </div>
      </div>
    </div>
  )
}
</file>

<file path="app/community/board/[slug]/new/page.tsx">
import { createClient } from "@/lib/supabase/server";
import { notFound, redirect } from 'next/navigation';
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { NewPostForm } from "@/components/new-post-form";
import { StandardRightSidebar } from "@/components/standard-right-sidebar";

export default async function NewBoardPostPage({
  params,
}: {
  params: Promise<{ slug: string }>;
}) {
  const { slug } = await params;
  const supabase = await createClient();

  // Verify board category exists
  const { data: category } = await supabase
    .from("board_categories")
    .select("id, name, slug")
    .eq("slug", slug)
    .eq("is_active", true)
    .single();

  if (!category) {
    notFound();
  }

  const { data: { user } } = await supabase.auth.getUser();

  if (!user) {
    // í˜„ì¬ í˜ì´ì§€ ê²½ë¡œë¥¼ next íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬
    redirect(`/auth/login?next=/community/board/${slug}/new`);
  }

  return (
    <div className="w-full flex flex-col lg:flex-row gap-10">
      {/* [LEFT] ë©”ì¸ ì½˜í…ì¸  (ê¸€ì“°ê¸° í¼) */}
      <div className="flex-1 min-w-0">
        <div className="bg-white rounded-2xl border border-slate-200 p-8 shadow-sm">
          <h1 className="text-2xl font-bold text-slate-900 mb-6">
            ìƒˆ ê¸€ ì‘ì„± - {category.name}
          </h1>
          <NewPostForm slug={slug} boardCategoryId={category.id} />
        </div>
      </div>

      {/* [RIGHT] ìš°ì¸¡ ì‚¬ì´ë“œë°” */}
      <div className="hidden lg:flex w-72 shrink-0 flex-col gap-6">
        <div className="sticky top-8 flex flex-col gap-6 h-fit">
          <StandardRightSidebar />
        </div>
      </div>
    </div>
  );
}
</file>

<file path="app/community/posts/[id]/loading.tsx">
import { Card, CardContent, CardHeader } from "@/components/ui/card"
import { Skeleton } from "@/components/ui/skeleton"

export default function PostDetailLoading() {
  return (
    <div className="p-8">
      <div className="mx-auto max-w-4xl">
        {/* Post Card Skeleton */}
        <Card className="border-slate-200">
          <CardHeader>
            <div className="flex items-center justify-between">
              <div className="flex items-center gap-3">
                <Skeleton className="h-12 w-12 rounded-full" />
                <div>
                  <div className="flex items-center gap-2 mb-2">
                    <Skeleton className="h-5 w-32" />
                    <Skeleton className="h-4 w-16" />
                  </div>
                  <Skeleton className="h-4 w-24" />
                </div>
              </div>
              <Skeleton className="h-8 w-8 rounded" />
            </div>
          </CardHeader>
          <CardContent>
            <Skeleton className="h-8 w-3/4 mb-4" />
            <div className="space-y-2 mb-4">
              <Skeleton className="h-4 w-full" />
              <Skeleton className="h-4 w-full" />
              <Skeleton className="h-4 w-5/6" />
              <Skeleton className="h-4 w-4/5" />
            </div>
            <div className="mt-6 flex items-center gap-4 border-t border-slate-200 pt-4">
              <Skeleton className="h-8 w-20" />
              <Skeleton className="h-4 w-24" />
            </div>
          </CardContent>
        </Card>

        {/* Comments Section Skeleton */}
        <div className="mt-8">
          <Card className="border-slate-200">
            <CardHeader>
              <Skeleton className="h-6 w-32" />
            </CardHeader>
            <CardContent>
              <Skeleton className="h-24 w-full mb-4" />
              <Skeleton className="h-10 w-24" />
            </CardContent>
          </Card>
        </div>
      </div>
    </div>
  )
}
</file>

<file path="app/community/posts/[id]/page.tsx">
import { createClient } from "@/lib/supabase/server"
import { notFound } from "next/navigation"
import { Card, CardContent, CardHeader } from "@/components/ui/card"
import { MessageSquare } from "lucide-react"
import { CommentSection } from "@/components/comment-section"
import { PostActions } from "@/components/post-actions"
import { isMasterAdmin } from "@/lib/utils"
import { UserBadges } from "@/components/user-badges"

export default async function PostDetailPage({
  params,
}: {
  params: Promise<{ id: string }>
}) {
  const { id } = await params
  const supabase = await createClient()

  // ë³‘ë ¬ë¡œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
  const [userResult, postResult] = await Promise.all([
    supabase.auth.getUser(),
    supabase
      .from("posts")
      .select(`
        *,
        profiles:author_id (
          id,
          full_name,
          avatar_url
        )
      `)
      .eq("id", id)
      .single()
  ])

  const { data: { user } } = userResult
  const { data: post } = postResult

  if (!post) {
    notFound()
  }

  // ë³‘ë ¬ë¡œ ë‚˜ë¨¸ì§€ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
  const [commentsResult, profileResult, badgesResult] = await Promise.all([
    supabase
      .from("comments")
      .select(`
        *,
        profiles:author_id (
          id,
          full_name,
          avatar_url
        )
      `)
      .eq("post_id", id)
      .order("created_at", { ascending: true }),
    user ? supabase.from("profiles").select("role, email").eq("id", user.id).maybeSingle() : Promise.resolve({ data: null }),
    post.author_id ? supabase
      .from("user_badges")
      .select(`
        badges:badge_id (
          icon,
          name
        )
      `)
      .eq("user_id", post.author_id)
      .eq("is_visible", true) : Promise.resolve({ data: null })
  ])
  const { data: comments } = commentsResult
  const { data: profile } = profileResult

  // Check if user is author
  const isAuthor = Boolean(user && post.author_id === user.id)

  // Check if user is master admin
  const isMaster = profile ? isMasterAdmin(profile.role, profile.email) : false

  // ì‘ì„±ìì˜ ë…¸ì¶œëœ ë±ƒì§€ ê°€ì ¸ì˜¤ê¸°
  let authorVisibleBadges: Array<{ icon: string; name: string }> = []
  if (badgesResult.data) {
    authorVisibleBadges = badgesResult.data
      .map((ub: any) => ub.badges)
      .filter(Boolean)
      .map((badge: any) => ({
        icon: badge.icon,
        name: badge.name,
      }))
  }

  return (
    <div className="flex flex-col gap-6">
      {/* Post */}
      <Card className="border-slate-200">
        <CardHeader>
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-3">
              <div className="flex h-12 w-12 items-center justify-center rounded-full bg-slate-200 text-lg font-medium text-slate-700">
                {post.profiles?.full_name?.[0] || "U"}
              </div>
              <div>
                <div className="flex items-center gap-2 flex-wrap">
                  <p className="font-medium text-slate-900">{post.profiles?.full_name || "Anonymous"}</p>
                  {authorVisibleBadges.length > 0 && (
                    <UserBadges badges={authorVisibleBadges} />
                  )}
                </div>
                <p className="text-sm text-slate-500">
                  {new Date(post.created_at).toLocaleDateString("ko-KR", {
                    year: "numeric",
                    month: "long",
                    day: "numeric",
                  })}
                </p>
              </div>
            </div>
            {(isAuthor || isMaster) && (
              <PostActions postId={post.id} isAuthor={isAuthor} isMaster={isMaster} />
            )}
          </div>
        </CardHeader>
        <CardContent>
          <h1 className="mb-4 text-2xl font-bold tracking-tight text-slate-900">{post.title}</h1>
          <p className="whitespace-pre-wrap text-slate-700 leading-relaxed">{post.content}</p>

          {/* Actions */}
          <div className="mt-6 flex items-center gap-4 border-t border-slate-200 pt-4">
            <div className="flex items-center gap-2 text-sm text-slate-600">
              <MessageSquare className="h-4 w-4" />
              <span>{post.comments_count} ëŒ“ê¸€</span>
            </div>
          </div>
        </CardContent>
      </Card>

      {/* Comments Section */}
      <CommentSection postId={post.id} userId={user?.id} comments={comments || []} />
    </div>
  )
}
</file>

<file path="app/customer-center/layout.tsx">
import type { ReactNode } from "react"
import { StandardLayout } from "@/components/layout/standard-layout"

export default function CustomerCenterLayout({ children }: { children: ReactNode }) {
  return <StandardLayout>{children}</StandardLayout>
}
</file>

<file path="app/customer-center/page.tsx">
import { CustomerCenterContent } from "@/components/customer-center/customer-center-content"

export default function CustomerCenterPage() {
  return <CustomerCenterContent />
}
</file>

<file path="app/e/[id]/opengraph-image.tsx">
import { ImageResponse } from 'next/og'
import { createClient } from '@/lib/supabase/server'
import { buildEventQueryFromShortCode } from '@/lib/utils/event-url'

export const runtime = 'edge'

// ì´ë²¤íŠ¸ IDë¥¼ ì°¾ëŠ” í—¬í¼ í•¨ìˆ˜
async function findEventId(id: string, supabase: any): Promise<string | null> {
  // ì§§ì€ ì½”ë“œ(6ì)ì¸ ê²½ìš° ë‚ ì§œ + ìˆœì„œë²ˆí˜¸ë¡œ ì´ë²¤íŠ¸ ì°¾ê¸°
  if (id.length === 6) {
    const query = buildEventQueryFromShortCode(id)
    if (!query) {
      return null
    }
    
    const { month, day, orderNumber } = query
    
    const { data: allEventsForDate } = await supabase
      .from("events")
      .select("id, event_date, created_at")
      .order("created_at", { ascending: true })
    
    if (!allEventsForDate || allEventsForDate.length === 0) {
      return null
    }
    
    const allMatchingEvents = allEventsForDate.filter((event: any) => {
      const eventDate = new Date(event.event_date)
      const eventMonth = eventDate.getMonth() + 1
      const eventDay = eventDate.getDate()
      return eventMonth === month && eventDay === day
    })
    
    allMatchingEvents.sort((a: any, b: any) => {
      const dateA = new Date(a.created_at).getTime()
      const dateB = new Date(b.created_at).getTime()
      return dateA - dateB
    })
    
    if (allMatchingEvents.length >= orderNumber) {
      return allMatchingEvents[orderNumber - 1].id
    }
    
    return null
  } else {
    // ì „ì²´ UUIDì¸ ê²½ìš°
    return id
  }
}

export default async function Image({ params }: { params: Promise<{ id: string }> }) {
  const { id } = await params
  const supabase = await createClient()

  const eventId = await findEventId(id, supabase)
  
  if (!eventId) {
    return new ImageResponse(
      (
        <div
          style={{
            fontSize: 40,
            color: 'black',
            background: 'white',
            width: '100%',
            height: '100%',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
          }}
        >
          Event Not Found
        </div>
      ),
      { width: 1200, height: 630 }
    )
  }

  const { data: event } = await supabase
    .from('events')
    .select('title, event_date, location, thumbnail_url, profiles(full_name)')
    .eq('id', eventId)
    .single()

  if (!event) {
    return new ImageResponse(
      (
        <div
          style={{
            fontSize: 40,
            color: 'black',
            background: 'white',
            width: '100%',
            height: '100%',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
          }}
        >
          Event Not Found
        </div>
      ),
      { width: 1200, height: 630 }
    )
  }

  const eventDate = new Date(event.event_date)
  const dateStr = eventDate.toLocaleDateString('ko-KR', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
    weekday: 'short',
  })
  const hostProfile = Array.isArray(event.profiles) ? event.profiles[0] : event.profiles

  // ì¸ë„¤ì¼ì´ ìˆìœ¼ë©´ ì¸ë„¤ì¼ì„ ì‚¬ìš©, ì—†ìœ¼ë©´ í…ìŠ¤íŠ¸ ê¸°ë°˜ ì´ë¯¸ì§€ ìƒì„±
  if (event.thumbnail_url) {
    return new ImageResponse(
      (
        <div
          style={{
            width: '100%',
            height: '100%',
            display: 'flex',
            position: 'relative',
          }}
        >
          <img
            src={event.thumbnail_url}
            alt={event.title}
            style={{
              width: '100%',
              height: '100%',
              objectFit: 'cover',
            }}
          />
          {/* ì˜¤ë²„ë ˆì´ - ì œëª©ê³¼ ë‚ ì§œ í‘œì‹œ */}
          <div
            style={{
              position: 'absolute',
              bottom: 0,
              left: 0,
              right: 0,
              background: 'linear-gradient(to top, rgba(0,0,0,0.8), transparent)',
              padding: '60px 80px 40px',
              display: 'flex',
              flexDirection: 'column',
              gap: '12px',
            }}
          >
            <div
              style={{
                fontSize: 56,
                fontWeight: 'bold',
                color: 'white',
                lineHeight: 1.2,
              }}
            >
              {event.title}
            </div>
            <div
              style={{
                fontSize: 32,
                color: 'rgba(255, 255, 255, 0.9)',
              }}
            >
              {dateStr} Â· {event.location}
            </div>
          </div>
        </div>
      ),
      { width: 1200, height: 630 }
    )
  }

  // ì¸ë„¤ì¼ì´ ì—†ìœ¼ë©´ í…ìŠ¤íŠ¸ ê¸°ë°˜ ì´ë¯¸ì§€ ìƒì„±
  return new ImageResponse(
    (
      <div
        style={{
          fontSize: 40,
          color: 'black',
          background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
          width: '100%',
          height: '100%',
          padding: '50px 200px',
          textAlign: 'center',
          justifyContent: 'center',
          alignItems: 'center',
          display: 'flex',
          flexDirection: 'column',
          position: 'relative',
        }}
      >
        {/* ë°°ê²½ íŒ¨í„´ */}
        <div
          style={{
            position: 'absolute',
            top: 0,
            left: 0,
            right: 0,
            bottom: 0,
            background: 'rgba(0, 0, 0, 0.1)',
            opacity: 0.3,
          }}
        />

        {/* ë©”ì¸ ì»¨í…ì¸  */}
        <div
          style={{
            display: 'flex',
            flexDirection: 'column',
            alignItems: 'center',
            justifyContent: 'center',
            zIndex: 1,
            width: '100%',
          }}
        >
          {/* ë¡œê³ /ë¸Œëœë“œ */}
          <div
            style={{
              fontSize: 24,
              color: 'white',
              marginBottom: 30,
              opacity: 0.9,
              fontWeight: 600,
            }}
          >
            Seoul Founders Club
          </div>

          {/* ì´ë²¤íŠ¸ ì œëª© */}
          <div
            style={{
              fontSize: 64,
              fontWeight: 'bold',
              color: 'white',
              marginBottom: 30,
              textAlign: 'center',
              lineHeight: 1.2,
              maxWidth: '900px',
            }}
          >
            {event.title}
          </div>

          {/* ë‚ ì§œ ë° ì¥ì†Œ */}
          <div
            style={{
              fontSize: 32,
              color: 'rgba(255, 255, 255, 0.95)',
              marginBottom: 20,
              display: 'flex',
              flexDirection: 'column',
              gap: 10,
            }}
          >
            <div>{dateStr}</div>
            {event.location && (
              <div style={{ fontSize: 28, opacity: 0.9 }}>{event.location}</div>
            )}
          </div>

          {/* í˜¸ìŠ¤íŠ¸ ì •ë³´ */}
          {hostProfile?.full_name && (
            <div
              style={{
                fontSize: 24,
                color: 'rgba(255, 255, 255, 0.85)',
                marginTop: 20,
                paddingTop: 20,
                borderTop: '2px solid rgba(255, 255, 255, 0.3)',
              }}
            >
              Hosted by {hostProfile.full_name}
            </div>
          )}
        </div>
      </div>
    ),
    { width: 1200, height: 630 }
  )
}
</file>

<file path="app/e/layout.tsx">
import type { ReactNode } from "react"
import { StandardLayout } from "@/components/layout/standard-layout"

export default function EventLayout({ children }: { children: ReactNode }) {
  return <StandardLayout>{children}</StandardLayout>
}
</file>

<file path="app/error.tsx">
"use client"

import { useEffect } from "react"
import { Button } from "@/components/ui/button"
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import { AlertCircle, RefreshCw } from "lucide-react"
import Link from "next/link"

export default function Error({
  error,
  reset,
}: {
  error: Error & { digest?: string }
  reset: () => void
}) {
  useEffect(() => {
    // ì—ëŸ¬ ë¡œê¹… (ì„ íƒì‚¬í•­)
    console.error("Application error:", error)
  }, [error])

  return (
    <div className="min-h-screen bg-slate-50 flex items-center justify-center p-4">
      <Card className="w-full max-w-md border-red-200">
        <CardHeader className="text-center">
          <div className="mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-red-100">
            <AlertCircle className="h-8 w-8 text-red-600" />
          </div>
          <CardTitle className="text-2xl text-red-900">
            ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤
          </CardTitle>
        </CardHeader>
        <CardContent className="space-y-4">
          <p className="text-center text-slate-600">
            ì˜ˆìƒì¹˜ ëª»í•œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.
            <br />
            ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.
          </p>
          
          {error.digest && (
            <div className="text-center">
              <p className="text-xs text-slate-400">
                ì˜¤ë¥˜ ì½”ë“œ: {error.digest}
              </p>
            </div>
          )}

          <div className="flex flex-col gap-2">
            <Button
              onClick={reset}
              className="w-full bg-slate-900 hover:bg-slate-800 text-white"
            >
              <RefreshCw className="mr-2 h-4 w-4" />
              ë‹¤ì‹œ ì‹œë„
            </Button>
            <Button
              variant="outline"
              asChild
              className="w-full"
            >
              <Link href="/">
                í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°
              </Link>
            </Button>
          </div>
        </CardContent>
      </Card>
    </div>
  )
}
</file>

<file path="app/events/[id]/edit/page.tsx">
import { createClient } from "@/lib/supabase/server"
import { redirect, notFound } from "next/navigation"
import { requireAuth } from "@/lib/auth/server"
import { NewEventForm } from "@/components/new-event-form"

export default async function EditEventPage({
  params,
}: {
  params: Promise<{ id: string }>
}) {
  const { id } = await params
  const { user, supabase } = await requireAuth()

  // ì´ë²¤íŠ¸ ì •ë³´ ì¡°íšŒ
  const { data: event, error } = await supabase
    .from("events")
    .select("id, title, description, event_date, end_date, location, price, max_participants, thumbnail_url, event_type, created_by")
    .eq("id", id)
    .single()

  if (error || !event) {
    notFound()
  }

  // ì‘ì„±ì í™•ì¸
  if (event.created_by !== user.id) {
    redirect("/")
  }

  // ì°¸ê°€ì ì§ˆë¬¸ ì¡°íšŒ
  const { data: customFieldsData } = await supabase
    .from("event_registration_fields")
    .select("id, field_name, field_type, field_options, is_required, order_index")
    .eq("event_id", id)
    .order("order_index", { ascending: true })

  // ì§ˆë¬¸ ë°ì´í„°ë¥¼ í¼ í¬ë§·ìœ¼ë¡œ ë³€í™˜
  const customFields = (customFieldsData || []).map((field) => {
    let options: string[] = []
    if (field.field_options) {
      if (Array.isArray(field.field_options)) {
        options = field.field_options
      } else if (typeof field.field_options === 'string') {
        try {
          options = JSON.parse(field.field_options)
        } catch (e) {
          console.error('Failed to parse field_options:', e)
        }
      }
    }

    return {
      id: field.id,
      label: field.field_name,
      type: field.field_type as 'text' | 'select',
      options: options,
      required: field.is_required || false,
    }
  })

  // ì´ˆê¸° ë°ì´í„° ì¤€ë¹„
  const initialData = {
    id: event.id,
    title: event.title,
    description: event.description || "",
    event_date: event.event_date,
    end_date: event.end_date,
    location: event.location,
    price: event.price,
    max_participants: event.max_participants,
    thumbnail_url: event.thumbnail_url,
    event_type: event.event_type,
    customFields: customFields,
  }

  return (
    <div className="min-h-screen bg-slate-50 py-10">
      <div className="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
        <div className="mb-8">
          <h1 className="text-3xl font-bold text-slate-900">ì´ë²¤íŠ¸ ìˆ˜ì •</h1>
          <p className="mt-2 text-slate-600">ì´ë²¤íŠ¸ ì •ë³´ë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
        </div>
        <NewEventForm 
          userId={user.id} 
          initialData={initialData}
        />
      </div>
    </div>
  )
}
</file>

<file path="app/events/[id]/manage/page.tsx">
import { redirect } from 'next/navigation';

export default async function ManageEventPage({
  params,
}: {
  params: Promise<{ id: string }>;
}) {
  const { id } = await params;
  // /events/[id]/manageë¥¼ /e/[id]/manageë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
  redirect(`/e/${id}/manage`);
}
</file>

<file path="app/events/[id]/opengraph-image.tsx">
import { ImageResponse } from 'next/og'
import { createClient } from '@/lib/supabase/server'

export const runtime = 'edge'

export default async function Image({ params }: { params: Promise<{ id: string }> }) {
  const { id } = await params
  const supabase = await createClient()

  const { data: event } = await supabase
    .from('events')
    .select('title, event_date, location, thumbnail_url, profiles(full_name)')
    .eq('id', id)
    .single()

  if (!event) {
    return new ImageResponse(
      (
        <div
          style={{
            fontSize: 40,
            color: 'black',
            background: 'white',
            width: '100%',
            height: '100%',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
          }}
        >
          Event Not Found
        </div>
      ),
      { width: 1200, height: 630 }
    )
  }

  const eventDate = new Date(event.event_date)
  const dateStr = eventDate.toLocaleDateString('ko-KR', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
    weekday: 'short',
  })
  const hostProfile = Array.isArray(event.profiles) ? event.profiles[0] : event.profiles

  // ì¸ë„¤ì¼ì´ ìˆìœ¼ë©´ ì¸ë„¤ì¼ì„ ì‚¬ìš©, ì—†ìœ¼ë©´ í…ìŠ¤íŠ¸ ê¸°ë°˜ ì´ë¯¸ì§€ ìƒì„±
  if (event.thumbnail_url) {
    return new ImageResponse(
      (
        <div
          style={{
            width: '100%',
            height: '100%',
            display: 'flex',
            position: 'relative',
          }}
        >
          <img
            src={event.thumbnail_url}
            alt={event.title}
            style={{
              width: '100%',
              height: '100%',
              objectFit: 'cover',
            }}
          />
          {/* ì˜¤ë²„ë ˆì´ - ì œëª©ê³¼ ë‚ ì§œ í‘œì‹œ */}
          <div
            style={{
              position: 'absolute',
              bottom: 0,
              left: 0,
              right: 0,
              background: 'linear-gradient(to top, rgba(0,0,0,0.8), transparent)',
              padding: '60px 80px 40px',
              display: 'flex',
              flexDirection: 'column',
              gap: '12px',
            }}
          >
            <div
              style={{
                fontSize: 56,
                fontWeight: 'bold',
                color: 'white',
                lineHeight: 1.2,
              }}
            >
              {event.title}
            </div>
            <div
              style={{
                fontSize: 32,
                color: 'rgba(255, 255, 255, 0.9)',
              }}
            >
              {dateStr} Â· {event.location}
            </div>
          </div>
        </div>
      ),
      { width: 1200, height: 630 }
    )
  }

  return new ImageResponse(
    (
      <div
        style={{
          fontSize: 40,
          color: 'black',
          background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
          width: '100%',
          height: '100%',
          padding: '50px 200px',
          textAlign: 'center',
          justifyContent: 'center',
          alignItems: 'center',
          display: 'flex',
          flexDirection: 'column',
          position: 'relative',
        }}
      >
        {/* ë°°ê²½ íŒ¨í„´ */}
        <div
          style={{
            position: 'absolute',
            top: 0,
            left: 0,
            right: 0,
            bottom: 0,
            background: 'rgba(0, 0, 0, 0.1)',
            opacity: 0.3,
          }}
        />

        {/* ë©”ì¸ ì»¨í…ì¸  */}
        <div
          style={{
            display: 'flex',
            flexDirection: 'column',
            alignItems: 'center',
            justifyContent: 'center',
            zIndex: 1,
            width: '100%',
          }}
        >
          {/* ë¡œê³ /ë¸Œëœë“œ */}
          <div
            style={{
              fontSize: 24,
              color: 'white',
              marginBottom: 30,
              opacity: 0.9,
              fontWeight: 600,
            }}
          >
            Seoul Founders Club
          </div>

          {/* ì´ë²¤íŠ¸ ì œëª© */}
          <div
            style={{
              fontSize: 64,
              fontWeight: 'bold',
              color: 'white',
              marginBottom: 30,
              textAlign: 'center',
              lineHeight: 1.2,
              maxWidth: '900px',
            }}
          >
            {event.title}
          </div>

          {/* ë‚ ì§œ ë° ì¥ì†Œ */}
          <div
            style={{
              fontSize: 32,
              color: 'rgba(255, 255, 255, 0.95)',
              marginBottom: 20,
              display: 'flex',
              flexDirection: 'column',
              gap: 10,
            }}
          >
            <div>{dateStr}</div>
            {event.location && (
              <div style={{ fontSize: 28, opacity: 0.9 }}>{event.location}</div>
            )}
          </div>

          {/* í˜¸ìŠ¤íŠ¸ ì •ë³´ */}
          {hostProfile?.full_name && (
            <div
              style={{
                fontSize: 24,
                color: 'rgba(255, 255, 255, 0.85)',
                marginTop: 20,
                paddingTop: 20,
                borderTop: '2px solid rgba(255, 255, 255, 0.3)',
              }}
            >
              Hosted by {hostProfile.full_name}
            </div>
          )}
        </div>
      </div>
    ),
    { width: 1200, height: 630 }
  )
}
</file>

<file path="app/events/new/page.tsx">
import { redirect } from 'next/navigation'

export default async function NewEventPage() {
  // /events/newë¥¼ /e/newë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
  redirect('/e/new')
}
</file>

<file path="app/events/page.tsx">
import { redirect } from "next/navigation"

export default function EventsPage() {
  // /eventsë¥¼ /eë¡œ ë‹¨ìˆœ ë¦¬ë‹¤ì´ë ‰íŠ¸í•˜ì—¬ ì¤‘ë³µ ë ˆì´ì•„ì›ƒ/ì¿¼ë¦¬ ì œê±°
  redirect("/e")
}
</file>

<file path="app/global-error.tsx">
"use client"

import { useEffect } from "react"
import { Button } from "@/components/ui/button"
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import { AlertCircle, RefreshCw } from "lucide-react"

export default function GlobalError({
  error,
  reset,
}: {
  error: Error & { digest?: string }
  reset: () => void
}) {
  useEffect(() => {
    // ê¸€ë¡œë²Œ ì—ëŸ¬ ë¡œê¹…
    console.error("Global application error:", error)
  }, [error])

  return (
    <html lang="ko">
      <body>
        <div className="min-h-screen bg-slate-50 flex items-center justify-center p-4">
          <Card className="w-full max-w-md border-red-200">
            <CardHeader className="text-center">
              <div className="mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-red-100">
                <AlertCircle className="h-8 w-8 text-red-600" />
              </div>
              <CardTitle className="text-2xl text-red-900">
                ì‹¬ê°í•œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤
              </CardTitle>
            </CardHeader>
            <CardContent className="space-y-4">
              <p className="text-center text-slate-600">
                ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì‹¬ê°í•œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.
                <br />
                í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ê±°ë‚˜ ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.
              </p>
              
              {error.digest && (
                <div className="text-center">
                  <p className="text-xs text-slate-400">
                    ì˜¤ë¥˜ ì½”ë“œ: {error.digest}
                  </p>
                </div>
              )}

              <div className="flex flex-col gap-2">
                <Button
                  onClick={reset}
                  className="w-full bg-slate-900 hover:bg-slate-800 text-white"
                >
                  <RefreshCw className="mr-2 h-4 w-4" />
                  ë‹¤ì‹œ ì‹œë„
                </Button>
                <Button
                  variant="outline"
                  onClick={() => window.location.href = "/"}
                  className="w-full"
                >
                  í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°
                </Button>
              </div>
            </CardContent>
          </Card>
        </div>
      </body>
    </html>
  )
}
</file>

<file path="app/member/layout.tsx">
import type { ReactNode } from "react"
import { StandardLayout } from "@/components/layout/standard-layout"

export default function MemberLayout({ children }: { children: ReactNode }) {
  return <StandardLayout>{children}</StandardLayout>
}
</file>

<file path="app/member/loading.tsx">
import { Card, CardContent } from "@/components/ui/card"
import { Skeleton } from "@/components/ui/skeleton"
import { PageHeader } from "@/components/page-header"

export default function MemberLoading() {
  return (
    <div className="flex flex-col gap-6 w-full">
      <PageHeader
        title="ë©¤ë²„"
        description="ê°ìì˜ ì˜ì—­ì—ì„œ ì„±ê³¼ë¥¼ ì¦ëª…í•œ, ê²€ì¦ëœ ë©¤ë²„ë“¤ì„ ë§Œë‚˜ë³´ì„¸ìš”."
        compact={true}
      />

      <div className="flex flex-col gap-4">
        <div className="flex items-center justify-between">
          <Skeleton className="h-7 w-32" />
          <Skeleton className="h-5 w-24" />
        </div>

        {/* í•„í„° ë²„íŠ¼ ìŠ¤ì¼ˆë ˆí†¤ */}
        <div className="mb-6 flex gap-2">
          {[1, 2, 3, 4].map((i) => (
            <Skeleton key={i} className="h-9 w-20 rounded-full" />
          ))}
        </div>

        {/* ì‹¤ì œ ë ˆì´ì•„ì›ƒê³¼ ë™ì¼í•œ 3ì—´ ê·¸ë¦¬ë“œ */}
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5">
          {[1, 2, 3, 4, 5, 6].map((i) => (
            <Card key={i} className="border-slate-200 bg-white h-full overflow-hidden flex flex-col">
              <CardContent className="p-0 flex flex-col h-full">
                {/* ìƒë‹¨ ì˜ì—­ */}
                <div className="pt-3 px-4 pb-2 flex flex-col gap-2 flex-1">
                  <div className="flex items-center gap-3 ml-2">
                    {/* ì•„ë°”íƒ€ */}
                    <Skeleton className="h-12 w-12 rounded-full flex-shrink-0" />

                    <div className="flex-1 min-w-0 flex flex-col gap-1">
                      {/* ì´ë¦„ */}
                      <Skeleton className="h-5 w-24" />
                      {/* ì†Œì†/ì§ì±… */}
                      <Skeleton className="h-4 w-40" />
                      {/* ì—­í•  íƒœê·¸ */}
                      <div className="flex gap-1">
                        <Skeleton className="h-4 w-12 rounded" />
                        <Skeleton className="h-4 w-14 rounded" />
                      </div>
                    </div>
                  </div>

                  {/* ì†Œê°œê¸€ ì˜ì—­ */}
                  <div className="w-full mt-1 h-9 flex items-center justify-center px-1">
                    <Skeleton className="h-3 w-3/4" />
                  </div>
                </div>

                {/* í•˜ë‹¨ ë°°ì§€ ì˜ì—­ */}
                <div className="w-full h-[72px] shrink-0 flex items-center justify-between gap-1 px-3">
                  {[1, 2, 3].map((j) => (
                    <div key={j} className="flex-1 basis-1/3 min-w-0 flex flex-col items-center justify-center gap-1">
                      <Skeleton className="h-10 w-10 rounded-full" />
                      <Skeleton className="h-3 w-10" />
                    </div>
                  ))}
                </div>
              </CardContent>
            </Card>
          ))}
        </div>
      </div>
    </div>
  )
}
</file>

<file path="app/member/page.tsx">
import { createClient } from "@/lib/supabase/server"
import { Button } from "@/components/ui/button"
import { PageHeader } from "@/components/page-header"
import Link from "next/link"
import { MemberListClient } from "@/components/member/member-list-client"
import type { MemberProfile } from "@/components/member/member-detail-modal"

// ISR: 60ì´ˆë§ˆë‹¤ ì¬ê²€ì¦
export const revalidate = 60

export default async function MemberPage() {
  const supabase = await createClient()

  // ì„¸ì…˜ ë¨¼ì € í™•ì¸ (ë¹„ë¡œê·¸ì¸ ìµœì í™” - getUser ë„¤íŠ¸ì›Œí¬ í˜¸ì¶œ ë°©ì§€)
  const { data: { session } } = await supabase.auth.getSession()

  let currentUser = null
  let currentUserProfile = null

  if (session) {
    // ì„¸ì…˜ì´ ìˆì„ ë•Œë§Œ getUser í˜¸ì¶œ
    const { data: { user } } = await supabase.auth.getUser()
    currentUser = user

    if (currentUser) {
      const { data } = await supabase
        .from("profiles")
        .select("id, is_profile_public, role")
        .eq("id", currentUser.id)
        .single()
      currentUserProfile = data
    }
  }

  // 1. ë©¤ë²„ ì¡°íšŒ ì‹œë„ (ê³µê°œ í˜ì´ì§€ - ë¡œê·¸ì¸ ì—¬ë¶€ì™€ ë¬´ê´€í•˜ê²Œ í•­ìƒ ì¡°íšŒ)
  let { data: publicMembers, error } = await supabase
    .from("profiles")
    .select(`
      id,
      full_name,
      avatar_url,
      company,
      position,
      company_2,
      position_2,
      roles,
      tagline,
      introduction,
      member_type,
      role,
      created_at,
      user_badges (
        status,
        is_visible,
        badges:badge_id (
          icon,
          name,
          description,
          is_active
        )
      )
    `)
    .eq("is_profile_public", true)
    .order("created_at", { ascending: false })

  // 2. ì—ëŸ¬ ë°œìƒ ì‹œ ì•ˆì „í•œ ì¿¼ë¦¬ë¡œ ì¬ì‹œë„
  if (error) {
    console.warn("First attempt failed, retrying with safe columns. Error:", error)

    // [1ì°¨ ì¬ì‹œë„] ë±ƒì§€ ìƒíƒœ í¬í•¨
    let { data: retryData, error: retryError } = await supabase
      .from("profiles")
      .select(`
        id,
        full_name,
        avatar_url,
        company,
        position,
        company_2,
        position_2,
        roles,
        tagline,
        introduction,
        member_type,
        role,
        created_at,
        user_badges (
          status,
          is_visible,
          badges:badge_id (
            icon,
            name,
            description,
            is_active
          )
        )
      `)
      .eq("is_profile_public", true)
      .order("created_at", { ascending: false })

    if (!retryError) {
      publicMembers = retryData
    } else {
      // [2ì°¨ ì¬ì‹œë„] ë±ƒì§€ ìƒíƒœë„ ì œì™¸ (ìµœì†Œ ë°ì´í„°)
      console.warn("Second attempt failed, retrying with minimal columns. Error:", retryError)
      const { data: finalData, error: finalError } = await supabase
        .from("profiles")
        .select(`
          id,
          full_name,
          avatar_url,
          company,
          position,
          member_type,
          roles,
          introduction,
          role,
          created_at,
          user_badges (
            badges:badge_id (
              icon,
              name,
              description,
              is_active
            )
          )
        `)
        .eq("is_profile_public", true)
        .order("created_at", { ascending: false })

      if (!finalError) {
        publicMembers = finalData as any
      } else {
        console.error("All fetch attempts failed:", finalError)
      }
    }
  }

  const members: MemberProfile[] = (publicMembers || []).map((member: any) => {
    // ë±ƒì§€ í•„í„°ë§: ìŠ¹ì¸ë¨(approved) AND ê³µê°œ(is_visible) AND ë±ƒì§€ í™œì„±(is_active != false)
    const validBadges = member.user_badges?.filter((ub: any) =>
      ub.badges &&
      (ub.status === 'approved' || !ub.status) &&
      ub.is_visible &&
      ub.badges.is_active !== false
    ).map((ub: any) => ub.badges) || []

    return {
      id: member.id,
      full_name: member.full_name,
      avatar_url: member.avatar_url,
      company: member.company,
      position: member.position,
      company_2: member.company_2,
      position_2: member.position_2,
      tagline: member.tagline,
      introduction: member.introduction,
      member_type: member.member_type || null,
      role: member.role,
      roles: member.roles || [],
      badges: validBadges
    }
  })

  return (
    <div className="flex flex-col gap-6 w-full">
      <PageHeader
        title="ë©¤ë²„"
        description="ê°ìì˜ ì˜ì—­ì—ì„œ ì„±ê³¼ë¥¼ ì¦ëª…í•œ, ê²€ì¦ëœ ë©¤ë²„ë“¤ì„ ë§Œë‚˜ë³´ì„¸ìš”."
        compact={true}
      />

      {currentUser && currentUserProfile && !currentUserProfile.is_profile_public && (
        <div className="p-4 bg-blue-50 border border-blue-200 rounded-lg flex items-center justify-between">
          <div>
            <p className="text-lg font-bold text-blue-900">
              í”„ë¡œí•„ì„ ê³µê°œí•˜ê³  ë©¤ë²„ ë¦¬ìŠ¤íŠ¸ì— ì˜¬ë ¤ë³´ì„¸ìš”!
            </p>
          </div>
          <Link href="/community/profile">
            <Button size="sm" variant="outline" className="border-blue-300 text-blue-700 hover:bg-blue-100">
              ì„¤ì •í•˜ê¸°
            </Button>
          </Link>
        </div>
      )}

      <div className="flex flex-col gap-4">
        <div className="flex items-center justify-between">
          <h2 className="text-xl font-semibold text-slate-900">ë©¤ë²„ ë¦¬ìŠ¤íŠ¸</h2>
          <div className="text-sm text-slate-500">ì´ {members.length}ëª…</div>
        </div>

        <MemberListClient
          members={members}
          currentUserRole={currentUserProfile?.role || null}
        />
      </div>
    </div>
  )
}
</file>

<file path="app/opengraph-image.tsx">
import { ImageResponse } from 'next/og'

export const runtime = 'edge'
export const alt = 'Seoul Founders Club'
export const size = {
  width: 1200,
  height: 630,
}
export const contentType = 'image/png'

export default async function Image() {
  // ì›í˜• ë¡œê³  ì´ë¯¸ì§€ë¥¼ ë¡œë“œ
  const baseUrl = process.env.NEXT_PUBLIC_SITE_URL || 'https://seoulfounders.club'
  const logoUrl = `${baseUrl}/images/logo-circle.png`
  
  try {
    const logoResponse = await fetch(logoUrl, {
      cache: 'no-store',
    })
    
    if (logoResponse.ok) {
      // Edge runtimeì—ì„œëŠ” ì§ì ‘ ì´ë¯¸ì§€ URLì„ ì‚¬ìš©
      return new ImageResponse(
        (
          <div
            style={{
              background: '#ffffff',
              width: '100%',
              height: '100%',
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'center',
            }}
          >
            {/* ì›í˜• ë¡œê³ ë¥¼ ì¤‘ì•™ì— ë°°ì¹˜ */}
            <img
              src={logoUrl}
              alt="Seoul Founders Club Logo"
              style={{
                width: '500px',
                height: '500px',
                objectFit: 'contain',
              }}
            />
          </div>
        ),
        { 
          ...size,
          // ì´ë¯¸ì§€ ë¡œë“œ í—ˆìš©
        }
      )
    }
  } catch (error) {
    console.error('OG ì´ë¯¸ì§€ ìƒì„± ì˜¤ë¥˜:', error)
  }

  // ì´ë¯¸ì§€ë¥¼ ë¡œë“œí•  ìˆ˜ ì—†ìœ¼ë©´ ê¸°ë³¸ ë°°ê²½ë§Œ í‘œì‹œ
  return new ImageResponse(
    (
      <div
        style={{
          fontSize: 60,
          color: '#0f172a',
          background: '#f8fafc',
          width: '100%',
          height: '100%',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          fontWeight: 'bold',
        }}
      >
        Seoul Founders Club
      </div>
    ),
    { ...size }
  )
}
</file>

<file path="app/payment/fail/page.tsx">
"use client";

import { Suspense } from "react";
import { useSearchParams, useRouter } from "next/navigation";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { AlertCircle, Loader2 } from "lucide-react";
import Link from "next/link";

function PaymentFailContent() {
  const searchParams = useSearchParams();
  const router = useRouter();

  const errorCode = searchParams.get("code");
  const errorMessage = searchParams.get("message");

  const getErrorMessage = () => {
    if (errorMessage) {
      return errorMessage;
    }
    if (errorCode) {
      return `ì˜¤ë¥˜ ì½”ë“œ: ${errorCode}`;
    }
    return "ê²°ì œê°€ ì·¨ì†Œë˜ì—ˆê±°ë‚˜ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.";
  };

  return (
    <div className="min-h-screen bg-slate-50 flex items-center justify-center p-4">
      <Card className="w-full max-w-md">
        <CardHeader className="text-center">
          <div className="flex justify-center mb-4">
            <AlertCircle className="h-16 w-16 text-red-600" />
          </div>
          <CardTitle className="text-2xl text-red-600">ê²°ì œ ì‹¤íŒ¨</CardTitle>
        </CardHeader>
        <CardContent className="space-y-6">
          <div className="bg-red-50 border border-red-200 rounded-lg p-4">
            <p className="text-sm text-red-800 text-center">
              {getErrorMessage()}
            </p>
          </div>
          <div className="flex flex-col gap-3">
            <Button asChild className="w-full">
              <Link href="/events">
                ì´ë²¤íŠ¸ ëª©ë¡ìœ¼ë¡œ
              </Link>
            </Button>
            <Button
              variant="outline"
              className="w-full"
              onClick={() => router.back()}
            >
              ë‹¤ì‹œ ì‹œë„
            </Button>
          </div>
        </CardContent>
      </Card>
    </div>
  );
}

export default function PaymentFailPage() {
  return (
    <Suspense
      fallback={
        <div className="min-h-screen bg-slate-50 flex items-center justify-center">
          <Loader2 className="h-8 w-8 animate-spin text-slate-400" />
        </div>
      }
    >
      <PaymentFailContent />
    </Suspense>
  );
}
</file>

<file path="app/payment/success/page.tsx">
"use client";

import { useEffect, useState, Suspense } from "react";
import { useSearchParams, useRouter } from "next/navigation";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { CheckCircle, Loader2, AlertCircle, Calendar } from "lucide-react";
import Link from "next/link";

function PaymentSuccessContent() {
  const searchParams = useSearchParams();
  const router = useRouter();
  const [status, setStatus] = useState<"loading" | "success" | "error">("loading");
  const [errorMessage, setErrorMessage] = useState<string>("");
  const [registrationId, setRegistrationId] = useState<string | null>(null);

  const paymentKey = searchParams.get("paymentKey");
  const orderId = searchParams.get("orderId");
  const amount = searchParams.get("amount");

  useEffect(() => {
    if (!paymentKey || !orderId || !amount) {
      setStatus("error");
      setErrorMessage("ê²°ì œ ì •ë³´ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");
      return;
    }

    async function confirmPayment() {
      try {
        const response = await fetch("/api/payments/confirm", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            paymentKey,
            orderId,
            amount: parseInt(amount ?? "0", 10),
          }),
        });

        const data = await response.json();

        if (!response.ok) {
          setStatus("error");
          setErrorMessage(data.error || "ê²°ì œ ìŠ¹ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
          return;
        }

        setStatus("success");
        setRegistrationId(data.registrationId);
      } catch (error) {
        console.error("Payment confirmation error:", error);
        setStatus("error");
        setErrorMessage("ê²°ì œ ìŠ¹ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
      }
    }

    confirmPayment();
  }, [paymentKey, orderId, amount]);

  return (
    <div className="min-h-screen bg-slate-50 flex items-center justify-center p-4">
      <Card className="w-full max-w-md">
        <CardHeader className="text-center">
          {status === "loading" && (
            <>
              <div className="flex justify-center mb-4">
                <Loader2 className="h-16 w-16 animate-spin text-blue-600" />
              </div>
              <CardTitle className="text-2xl">ê²°ì œ ì²˜ë¦¬ ì¤‘...</CardTitle>
            </>
          )}
          {status === "success" && (
            <>
              <div className="flex justify-center mb-4">
                <CheckCircle className="h-16 w-16 text-green-600" />
              </div>
              <CardTitle className="text-2xl text-green-600">ê²°ì œ ì™„ë£Œ</CardTitle>
            </>
          )}
          {status === "error" && (
            <>
              <div className="flex justify-center mb-4">
                <AlertCircle className="h-16 w-16 text-red-600" />
              </div>
              <CardTitle className="text-2xl text-red-600">ê²°ì œ ì‹¤íŒ¨</CardTitle>
            </>
          )}
        </CardHeader>
        <CardContent className="space-y-6">
          {status === "loading" && (
            <p className="text-center text-slate-600">
              ê²°ì œë¥¼ í™•ì¸í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.
            </p>
          )}

          {status === "success" && (
            <>
              <div className="bg-green-50 border border-green-200 rounded-lg p-4">
                <p className="text-sm text-green-800 text-center">
                  ê²°ì œê°€ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.
                </p>
                {amount && (
                  <p className="text-lg font-bold text-green-900 text-center mt-2">
                    {parseInt(amount, 10).toLocaleString()}ì›
                  </p>
                )}
              </div>
              <div className="flex flex-col gap-3">
                <Button asChild className="w-full">
                  <Link href="/events">
                    <Calendar className="mr-2 h-4 w-4" />
                    ì´ë²¤íŠ¸ ëª©ë¡ìœ¼ë¡œ
                  </Link>
                </Button>
                {registrationId && (
                  <Button asChild variant="outline" className="w-full">
                    <Link href={`/events/${orderId?.replace(/^event-([^-]+)-.*/, "$1")}`}>
                      ë‚´ì—­ ë³´ê¸°
                    </Link>
                  </Button>
                )}
              </div>
            </>
          )}

          {status === "error" && (
            <>
              <div className="bg-red-50 border border-red-200 rounded-lg p-4">
                <p className="text-sm text-red-800 text-center">
                  {errorMessage}
                </p>
              </div>
              <div className="flex flex-col gap-3">
                <Button asChild className="w-full">
                  <Link href="/events">
                    ì´ë²¤íŠ¸ ëª©ë¡ìœ¼ë¡œ
                  </Link>
                </Button>
                <Button
                  variant="outline"
                  className="w-full"
                  onClick={() => router.back()}
                >
                  ë‹¤ì‹œ ì‹œë„
                </Button>
              </div>
            </>
          )}
        </CardContent>
      </Card>
    </div>
  );
}

export default function PaymentSuccessPage() {
  return (
    <Suspense
      fallback={
        <div className="min-h-screen bg-slate-50 flex items-center justify-center">
          <Loader2 className="h-8 w-8 animate-spin text-slate-400" />
        </div>
      }
    >
      <PaymentSuccessContent />
    </Suspense>
  );
}
</file>

<file path="app/privacy/page.tsx">
import { createClient } from "@/lib/supabase/server"
import { getCurrentUserProfile } from "@/lib/queries/profiles"
import { DashboardLayout } from "@/components/dashboard-layout"
import SidebarProfile from "@/components/sidebar-profile"
import { SiteHeader } from "@/components/site-header"
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"

export default async function PrivacyPage() {
  const supabase = await createClient()
  const userProfile = await getCurrentUserProfile(supabase)
  const userRole = userProfile?.profile?.role || null

  return (
    <DashboardLayout header={<SiteHeader />} sidebarProfile={<SidebarProfile />} userRole={userRole}>
      <div className="max-w-4xl mx-auto p-6 w-full">
          <Card className="border-slate-200 shadow-sm">
            <CardHeader>
              <CardTitle className="text-2xl font-bold">ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨</CardTitle>
              <p className="text-sm text-slate-500">ìµœì¢… ìˆ˜ì •ì¼: 2025ë…„ 11ì›” 20ì¼</p>
            </CardHeader>
            <CardContent className="prose prose-slate max-w-none">
              <div className="space-y-6 text-sm leading-relaxed text-slate-700">
                <section>
                  <p className="mb-4">
                    Seoul Founders Club(ì´í•˜ "ì»¤ë®¤ë‹ˆí‹°")ì€ ì´ìš©ìì˜ ê°œì¸ì •ë³´ë¥¼ ì¤‘ìš”í•˜ê²Œ ìƒê°í•˜ë©°, ì •ë³´í†µì‹ ë§ë²• ë“± ê´€ë ¨ ë²•ë ¹ì— ë”°ë¼ ì•ˆì „í•˜ê²Œ ê´€ë¦¬í•©ë‹ˆë‹¤. ë³¸ ë°©ì¹¨ì€ ì»¤ë®¤ë‹ˆí‹°ê°€ ì œê³µí•˜ëŠ” ì„œë¹„ìŠ¤ ì´ìš©ê³¼ ê´€ë ¨í•œ ê°œì¸ì •ë³´ ì²˜ë¦¬ ê¸°ì¤€ì„ ì„¤ëª…í•©ë‹ˆë‹¤.
                  </p>
                </section>

                <section>
                  <h3 className="text-lg font-semibold text-slate-900 mb-2">1. ê°œì¸ì •ë³´ì˜ ìˆ˜ì§‘ ë° ì´ìš© ëª©ì </h3>
                  <p>
                    ì»¤ë®¤ë‹ˆí‹°ëŠ” ì•„ë˜ ëª©ì ì„ ìœ„í•´ ê°œì¸ì •ë³´ë¥¼ ì²˜ë¦¬í•˜ë©°, ëª©ì  ì™¸ í™œìš©ì€ í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.<br/>
                    - íšŒì› ê°€ì… ë° ë³¸ì¸ í™•ì¸<br/>
                    - ì„œë¹„ìŠ¤ ì œê³µ ë° ìš´ì˜<br/>
                    - ì´ë²¤íŠ¸ ì‹ ì²­<br/>
                    - ê²Œì‹œê¸€ ì‘ì„±<br/>
                    - í”„ë¡œí•„ ê´€ë¦¬<br/>
                    - ì»¤ë®¤ë‹ˆí‹° ë‚´ ë„¤íŠ¸ì›Œí‚¹ ê¸°ëŠ¥ ì œê³µ<br/>
                    - ì´ë²¤íŠ¸ ì£¼ìµœìì˜ ì°¸ê°€ì ëª…ë‹¨ ê´€ë¦¬ ê¸°ëŠ¥ ì œê³µ<br/>
                    - ì„œë¹„ìŠ¤ í’ˆì§ˆ ê°œì„  ë° í†µê³„ ë¶„ì„<br/>
                    - ë¶€ì • ì´ìš© ë°©ì§€, ê³„ì • ë³´í˜¸
                  </p>
                </section>

                <section>
                  <h3 className="text-lg font-semibold text-slate-900 mb-2">2. ìˆ˜ì§‘í•˜ëŠ” ê°œì¸ì •ë³´ í•­ëª©</h3>
                  <p className="mb-2">
                    <strong>â‘  í•„ìˆ˜ í•­ëª© (Google ì†Œì…œ ë¡œê·¸ì¸ ì‹œ ìë™ ìˆ˜ì§‘)</strong><br/>
                    - ì´ë©”ì¼ ì£¼ì†Œ<br/>
                    - ì´ë¦„(ë‹‰ë„¤ì„)<br/>
                    - í”„ë¡œí•„ ì‚¬ì§„
                  </p>
                  <p className="mb-2">
                    <strong>â‘¡ ì„ íƒ ì…ë ¥ í•­ëª© (ì‚¬ìš©ì ì…ë ¥ ì‹œ)</strong><br/>
                    - ì§í•¨<br/>
                    - ì†Œì†<br/>
                    - ìê¸°ì†Œê°œ ë“± í”„ë¡œí•„ ê´€ë ¨ ì •ë³´
                  </p>
                  <p>
                    <strong>â‘¢ ìë™ ìˆ˜ì§‘ ì •ë³´</strong><br/>
                    ì„œë¹„ìŠ¤ ì´ìš© ê³¼ì •ì—ì„œ ì•„ë˜ ì •ë³´ê°€ ìë™ìœ¼ë¡œ ìƒì„±Â·ìˆ˜ì§‘ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br/>
                    - ì ‘ì† ë¡œê·¸<br/>
                    - ê¸°ê¸°Â·ë¸Œë¼ìš°ì € ì •ë³´<br/>
                    - ì´ìš© ê¸°ë¡<br/>
                    - ì¿ í‚¤(Cookie)
                  </p>
                </section>

                <section>
                  <h3 className="text-lg font-semibold text-slate-900 mb-2">3. ê°œì¸ì •ë³´ì˜ ë³´ìœ  ë° ì´ìš©ê¸°ê°„</h3>
                  <p className="mb-3">
                    ì›ì¹™ì ìœ¼ë¡œ ì´ìš© ëª©ì  ë‹¬ì„± í›„ ì§€ì²´ ì—†ì´ íŒŒê¸°í•©ë‹ˆë‹¤.<br/>
                    ë‹¤ë§Œ ì•„ë˜ ì‚¬í•­ì€ ê´€ë ¨ ë²•ë ¹ì— ë”°ë¼ ì •í•´ì§„ ê¸°ê°„ ë™ì•ˆ ë³´ê´€ë©ë‹ˆë‹¤.
                  </p>
                  <div className="overflow-x-auto">
                    <table className="min-w-full border border-slate-200 text-xs">
                      <thead>
                        <tr className="bg-slate-50">
                          <th className="border border-slate-200 px-3 py-2 text-left font-semibold">í•­ëª©</th>
                          <th className="border border-slate-200 px-3 py-2 text-left font-semibold">ë³´ê´€ê¸°ê°„</th>
                          <th className="border border-slate-200 px-3 py-2 text-left font-semibold">ê´€ë ¨ ë²•ë ¹</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td className="border border-slate-200 px-3 py-2">ì„œë¹„ìŠ¤ ì ‘ì† ê¸°ë¡</td>
                          <td className="border border-slate-200 px-3 py-2">3ê°œì›”</td>
                          <td className="border border-slate-200 px-3 py-2">í†µì‹ ë¹„ë°€ë³´í˜¸ë²•</td>
                        </tr>
                        <tr>
                          <td className="border border-slate-200 px-3 py-2">ì†Œë¹„ì ë¶„ìŸ ê´€ë ¨ ê¸°ë¡</td>
                          <td className="border border-slate-200 px-3 py-2">3ë…„</td>
                          <td className="border border-slate-200 px-3 py-2">ì „ììƒê±°ë˜ë²•</td>
                        </tr>
                        <tr>
                          <td className="border border-slate-200 px-3 py-2">ê²°ì œÂ·í™˜ë¶ˆ ê¸°ë¡</td>
                          <td className="border border-slate-200 px-3 py-2">5ë…„</td>
                          <td className="border border-slate-200 px-3 py-2">ì „ììƒê±°ë˜ë²•</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </section>

                <section>
                  <h3 className="text-lg font-semibold text-slate-900 mb-2">4. ê°œì¸ì •ë³´ì˜ ì œ3ì ì œê³µ</h3>
                  <p>
                    ì»¤ë®¤ë‹ˆí‹°ëŠ” ì´ìš©ìì˜ ê°œì¸ì •ë³´ë¥¼ ì™¸ë¶€ì— ì œê³µí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.<br/>
                    ë‹¨, ì•„ë˜ ê²½ìš°ì— í•œí•´ ì˜ˆì™¸ì ìœ¼ë¡œ ì œê³µë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br/>
                    - ì´ìš©ìê°€ ì‚¬ì „ì— ë™ì˜í•œ ê²½ìš°<br/>
                    - ë²•ë ¹ì— ë”°ë¥¸ ìš”ì²­ì´ ìˆëŠ” ê²½ìš°(ìˆ˜ì‚¬ê¸°ê´€Â·ë²•ì› ë“±)
                  </p>
                </section>

                <section>
                  <h3 className="text-lg font-semibold text-slate-900 mb-2">5. ê°œì¸ì •ë³´ ì²˜ë¦¬ì˜ ìœ„íƒ</h3>
                  <p>
                    ì›í™œí•œ ì„œë¹„ìŠ¤ ìš´ì˜ì„ ìœ„í•´ í•„ìš”í•œ ê²½ìš° ì¼ë¶€ ì—…ë¬´ë¥¼ ì™¸ë¶€ì— ìœ„íƒí•  ìˆ˜ ìˆìœ¼ë©°, ìœ„íƒ ì‹œ ê°œì¸ì •ë³´ê°€ ì•ˆì „í•˜ê²Œ ê´€ë¦¬ë˜ë„ë¡ ê°ë…í•©ë‹ˆë‹¤.<br/>
                    (â€» í˜„ì¬ëŠ” ìœ„íƒ ì—…ì²´ ì—†ìŒ)<br/>
                    â€» í–¥í›„ ì„œë²„Â·í˜¸ìŠ¤íŒ…Â·ì•Œë¦¼ ì„œë¹„ìŠ¤ ë“±ì´ ì¶”ê°€ë  ê²½ìš° ë°©ì¹¨ì— ë°˜ì˜í•©ë‹ˆë‹¤.
                  </p>
                </section>

                <section>
                  <h3 className="text-lg font-semibold text-slate-900 mb-2">6. ì´ìš©ìì˜ ê¶Œë¦¬</h3>
                  <p>
                    ì´ìš©ìëŠ” ì•„ë˜ ê¶Œë¦¬ë¥¼ í–‰ì‚¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br/>
                    - ê°œì¸ì •ë³´ ì¡°íšŒ<br/>
                    - ê°œì¸ì •ë³´ ìˆ˜ì •<br/>
                    - ìˆ˜ì§‘ ë° ì´ìš© ë™ì˜ ì² íšŒ(íšŒì› íƒˆí‡´)<br/>
                    - ê°œì¸ì •ë³´ ì‚­ì œ ìš”ì²­<br/>
                    ìš”ì²­ ì‹œ ì»¤ë®¤ë‹ˆí‹°ëŠ” ì§€ì²´ ì—†ì´ í•„ìš”í•œ ì¡°ì¹˜ë¥¼ ì·¨í•©ë‹ˆë‹¤.
                  </p>
                </section>

                <section>
                  <h3 className="text-lg font-semibold text-slate-900 mb-2">7. ì´ë²¤íŠ¸ ì£¼ìµœìì˜ ê°œì¸ì •ë³´ ì—´ëŒÂ·ê´€ë¦¬ ê¶Œí•œ</h3>
                  <p className="mb-3">
                    Seoul Founders Club ì„œë¹„ìŠ¤ êµ¬ì¡°ìƒ, ì´ë²¤íŠ¸ ì£¼ìµœìëŠ” ë³¸ì¸ì´ ìƒì„±í•œ ì´ë²¤íŠ¸ì˜ ìš´ì˜ì„ ìœ„í•´ í•„ìš”í•œ ë²”ìœ„ì—ì„œë§Œ ì°¸ì—¬ì ì •ë³´ë¥¼ ì—´ëŒÂ·ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                  </p>
                  <p className="mb-2">
                    <strong>ì£¼ìµœìê°€ ì—´ëŒí•  ìˆ˜ ìˆëŠ” ì •ë³´</strong><br/>
                    - ì°¸ì—¬ìì˜ ì´ë¦„(ë‹‰ë„¤ì„)<br/>
                    - í”„ë¡œí•„ ì‚¬ì§„<br/>
                    - ì§í•¨Â·ì†Œì†(ì„ íƒ ì…ë ¥ ì‹œ)<br/>
                    - ì´ë©”ì¼ ì£¼ì†Œ<br/>
                    - ì‹ ì²­ ì‹œê°„ ë° ìƒíƒœ(ì°¸ê°€/ëŒ€ê¸°/ì·¨ì†Œ ë“±)
                  </p>
                  <p className="mb-2">
                    <strong>ì—´ëŒ ëª©ì </strong><br/>
                    - ì´ë²¤íŠ¸ ìš´ì˜<br/>
                    - ì°¸ì„ì ê´€ë¦¬<br/>
                    - í˜„ì¥ ì¶œì„ í™•ì¸<br/>
                    - ì•ˆë‚´ ë° ì»¤ë®¤ë‹ˆì¼€ì´ì…˜
                  </p>
                  <p>
                    <strong>ì ‘ê·¼ ë²”ìœ„ ì œí•œ</strong><br/>
                    - ì£¼ìµœìëŠ” ìì‹ ì´ ìƒì„±í•œ ì´ë²¤íŠ¸ì˜ ëª…ë‹¨ë§Œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br/>
                    - ë‹¤ë¥¸ ì´ë²¤íŠ¸ ë˜ëŠ” ë¹„íšŒì› ì •ë³´ëŠ” ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.<br/>
                    - ë°ì´í„° ì ‘ê·¼ì€ ê¶Œí•œ ê¸°ë°˜ êµ¬ì¡°ë¡œ ì—„ê²©íˆ ì œí•œë©ë‹ˆë‹¤.
                  </p>
                </section>

                <section>
                  <h3 className="text-lg font-semibold text-slate-900 mb-2">8. ê°œì¸ì •ë³´ì˜ íŒŒê¸° ì ˆì°¨ ë° ë°©ë²•</h3>
                  <p>
                    ì´ìš© ëª©ì  ë‹¬ì„±, ë³´ìœ ê¸°ê°„ ë§Œë£Œ ë“±ì˜ ì‚¬ìœ  ë°œìƒ ì‹œ ì§€ì²´ ì—†ì´ íŒŒê¸°í•©ë‹ˆë‹¤.<br/>
                    - ì „ì íŒŒì¼: ë³µêµ¬ ë¶ˆê°€ ë°©ì‹ìœ¼ë¡œ ì˜êµ¬ ì‚­ì œ<br/>
                    - ì¢…ì´ ë¬¸ì„œ: ë¶„ì‡„ ë˜ëŠ” ì†Œê°
                  </p>
                </section>

                <section>
                  <h3 className="text-lg font-semibold text-slate-900 mb-2">9. ê°œì¸ì •ë³´ì˜ ì•ˆì „ì„± í™•ë³´ì¡°ì¹˜</h3>
                  <p>
                    ì»¤ë®¤ë‹ˆí‹°ëŠ” ê°œì¸ì •ë³´ ë³´í˜¸ë¥¼ ìœ„í•´ ì•„ë˜ì™€ ê°™ì€ ì¡°ì¹˜ë¥¼ ì·¨í•©ë‹ˆë‹¤.<br/>
                    - ì ‘ê·¼ ê¶Œí•œ ìµœì†Œí™”<br/>
                    - ë°ì´í„° ì•”í˜¸í™”(ê°€ëŠ¥í•œ ê²½ìš°)<br/>
                    - ë³´ì•ˆ í”„ë¡œê·¸ë¨ ì„¤ì¹˜<br/>
                    - ì ‘ì† ê¸°ë¡ ê´€ë¦¬ ë° ìœ„Â·ë³€ì¡° ë°©ì§€<br/>
                    - ì„œë²„ ë° ë°ì´í„°ë² ì´ìŠ¤ ì ‘ê·¼ í†µì œ<br/>
                    - ê¶Œí•œ ê¸°ë°˜(Host ê¸°ë°˜) ë°ì´í„° ì ‘ê·¼ êµ¬ì¡°
                  </p>
                </section>

                <section>
                  <h3 className="text-lg font-semibold text-slate-900 mb-2">10. ê°œì¸ì •ë³´ ë³´í˜¸ì±…ì„ì</h3>
                  <p>
                    ê°œì¸ì •ë³´ ê´€ë ¨ ë¬¸ì˜, ì—´ëŒÂ·ì •ì •Â·ì‚­ì œ ìš”ì²­ ë“±ì€ ì•„ë˜ ì—°ë½ì²˜ë¡œ ë¬¸ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br/>
                    ê°œì¸ì •ë³´ ë³´í˜¸ì±…ì„ì ì´ë©”ì¼: master@mvmt.city
                  </p>
                </section>

                <section>
                  <h3 className="text-lg font-semibold text-slate-900 mb-2">11. ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨ì˜ ë³€ê²½</h3>
                  <p>
                    ë²•ë ¹ ë˜ëŠ” ì„œë¹„ìŠ¤ ì •ì±… ë³€ê²½ ì‹œ ë³¸ ë°©ì¹¨ì„ ê°œì •í•˜ë©°, ì¤‘ìš”í•œ ë³€ê²½ì´ ìˆëŠ” ê²½ìš° ì‚¬ì „ì— ê³µì§€í•©ë‹ˆë‹¤.
                  </p>
                </section>
              </div>
            </CardContent>
          </Card>
      </div>
    </DashboardLayout>
  )
}
</file>

<file path="app/projects/[id]/page.tsx">
import { createClient } from "@/lib/supabase/server";
import { notFound } from 'next/navigation';
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { FolderKanban, Users, User, Calendar, Settings, ExternalLink } from 'lucide-react';
import Link from "next/link";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";

export default async function ProjectDetailPage({
  params,
}: {
  params: Promise<{ id: string }>;
}) {
  const { id } = await params;
  const supabase = await createClient();

  const { data: { user } } = await supabase.auth.getUser();

  const { data: project } = await supabase
    .from("projects")
    .select(`
      *,
      profiles:created_by (
        id,
        full_name
      )
    `)
    .eq("id", id)
    .single();

  if (!project) {
    notFound();
  }

  const { data: members } = await supabase
    .from("project_members")
    .select(`
      id,
      role,
      profiles:user_id (
        id,
        full_name
      )
    `)
    .eq("project_id", id);

  const { data: techStack } = await supabase
    .from("project_tech_stack")
    .select("technology")
    .eq("project_id", id);

  const isCreator = user && project.created_by === user.id;
  const isMember = user && members?.some((m) => {
    const profile = Array.isArray(m.profiles) ? m.profiles[0] : m.profiles
    return profile?.id === user.id
  });

  return (
    <div className="min-h-screen bg-slate-50 p-4 md:p-8">
      <div className="mx-auto max-w-4xl">
        <div className="mb-6 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
          <Link href="/projects">
            <Button variant="ghost" size="sm" className="w-full sm:w-auto">â† ëª©ë¡ìœ¼ë¡œ</Button>
          </Link>
          {isCreator && (
            <Button variant="outline" size="sm" className="w-full sm:w-auto">
              <Settings className="mr-2 h-4 w-4" />
              í”„ë¡œì íŠ¸ ê´€ë¦¬
            </Button>
          )}
        </div>

        <Card className="border-slate-200">
          {project.thumbnail_url && (
            <div className="aspect-video w-full overflow-hidden rounded-t-lg bg-gradient-to-br from-blue-500 to-purple-600">
              <img
                src={project.thumbnail_url || "/placeholder.svg"}
                alt={project.title}
                className="h-full w-full object-cover"
              />
            </div>
          )}
          <CardHeader className="p-4 md:p-6">
            <div className="flex items-start justify-between">
              <div className="flex-1">
                <div className="mb-3 flex flex-wrap items-center gap-2">
                  <Badge variant="outline">
                    {project.category}
                  </Badge>
                  <Badge className={
                    project.status === 'recruiting' ? 'bg-green-500' :
                    project.status === 'active' ? 'bg-blue-500' :
                    'bg-slate-500'
                  }>
                    {project.status === 'recruiting' ? 'ëª¨ì§‘ì¤‘' :
                     project.status === 'active' ? 'ì§„í–‰ì¤‘' : 'ì™„ë£Œ'}
                  </Badge>
                  {project.looking_for_members && (
                    <Badge className="bg-orange-500">
                      íŒ€ì› ëª¨ì§‘ ì¤‘
                    </Badge>
                  )}
                </div>
                
                <CardTitle className="mb-4 text-2xl md:text-3xl">{project.title}</CardTitle>
                
                <div className="space-y-2 md:space-y-3 text-sm md:text-base text-slate-600">
                  <div className="flex items-center gap-2">
                    <User className="h-5 w-5" />
                    <span>í”„ë¡œì íŠ¸ ë¦¬ë”: {project.profiles?.full_name || "ìµëª…"}</span>
                  </div>
                  <div className="flex items-center gap-2">
                    <Calendar className="h-5 w-5" />
                    <span>
                      ì‹œì‘ì¼: {new Date(project.created_at).toLocaleDateString("ko-KR")}
                    </span>
                  </div>
                  {project.github_url && (
                    <div className="flex items-center gap-2">
                      <ExternalLink className="h-5 w-5" />
                      <a 
                        href={project.github_url} 
                        target="_blank" 
                        rel="noopener noreferrer"
                        className="text-blue-600 hover:underline"
                      >
                        GitHub ì €ì¥ì†Œ
                      </a>
                    </div>
                  )}
                </div>
              </div>
            </div>
          </CardHeader>
          <CardContent className="p-4 md:p-6">
            <div className="mb-6">
              <h2 className="mb-3 text-lg md:text-xl font-semibold text-slate-900">
                í”„ë¡œì íŠ¸ ì†Œê°œ
              </h2>
              <p className="whitespace-pre-wrap text-sm md:text-base text-slate-700 leading-relaxed">
                {project.description}
              </p>
            </div>

            {techStack && techStack.length > 0 && (
              <div className="mb-6">
                <h2 className="mb-3 text-lg md:text-xl font-semibold text-slate-900">
                  ê¸°ìˆ  ìŠ¤íƒ
                </h2>
                <div className="flex flex-wrap gap-2">
                  {techStack.map((tech, index) => (
                    <Badge key={index} variant="secondary" className="text-xs md:text-sm">
                      {tech.technology}
                    </Badge>
                  ))}
                </div>
              </div>
            )}

            {project.looking_for_members && (
              <div className="rounded-lg bg-green-50 border border-green-200 p-3 md:p-4 mb-6">
                <h3 className="font-semibold text-green-900 mb-2 text-sm md:text-base">íŒ€ì›ì„ ì°¾ê³  ìˆìŠµë‹ˆë‹¤!</h3>
                <p className="text-green-700 text-xs md:text-sm">
                  ì´ í”„ë¡œì íŠ¸ëŠ” í˜„ì¬ í•¨ê»˜í•  íŒ€ì›ì„ ëª¨ì§‘ ì¤‘ì…ë‹ˆë‹¤. ê´€ì‹¬ì´ ìˆë‹¤ë©´ í”„ë¡œì íŠ¸ ë¦¬ë”ì—ê²Œ ì—°ë½í•´ë³´ì„¸ìš”.
                </p>
              </div>
            )}
          </CardContent>
        </Card>

        {members && members.length > 0 && (
          <Card className="mt-8 border-slate-200">
            <CardHeader className="p-4 md:p-6">
              <CardTitle className="text-lg md:text-xl">íŒ€ì› ({members.length})</CardTitle>
            </CardHeader>
            <CardContent className="p-4 md:p-6">
              <div className="grid gap-3 sm:grid-cols-2">
                {members.map((member) => {
                  const profile = Array.isArray(member.profiles) ? member.profiles[0] : member.profiles
                  const name = profile?.full_name || "ìµëª…";
                  return (
                    <div
                      key={member.id}
                      className="flex items-center gap-3 rounded-lg border border-slate-200 p-3"
                    >
                      <div className="flex h-10 w-10 items-center justify-center rounded-full bg-slate-200 text-sm font-medium text-slate-700">
                        {name[0]}
                      </div>
                      <div>
                        <p className="font-medium text-slate-900">{name}</p>
                        <p className="text-xs text-slate-500">{member.role || 'íŒ€ì›'}</p>
                      </div>
                    </div>
                  );
                })}
              </div>
            </CardContent>
          </Card>
        )}
      </div>
    </div>
  );
}
</file>

<file path="app/projects/layout.tsx">
import type React from "react"
import { DashboardLayout } from "@/components/dashboard-layout"
import SidebarProfile from "@/components/sidebar-profile"
import { SiteHeader } from "@/components/site-header"

export default function ProjectsLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <DashboardLayout header={<SiteHeader />} sidebarProfile={<SidebarProfile />}>
      {children}
    </DashboardLayout>
  )
}
</file>

<file path="app/projects/new/page.tsx">
import { createClient } from "@/lib/supabase/server";
import { redirect } from 'next/navigation';
import { NewProjectForm } from "@/components/new-project-form";

export default async function NewProjectPage() {
  const supabase = await createClient();

  const { data: { user } } = await supabase.auth.getUser();
  if (!user) {
    redirect("/auth/login");
  }

  return (
    <div className="space-y-8">
      <div>
        <h1 className="text-3xl font-bold tracking-tight text-slate-900 sm:text-4xl">
          ìƒˆ í”„ë¡œì íŠ¸ ë§Œë“¤ê¸°
        </h1>
        <p className="mt-2 text-base text-slate-600">
          í•¨ê»˜ í˜‘ì—…í•  í”„ë¡œì íŠ¸ë¥¼ ë“±ë¡í•˜ê³  íŒ€ì›ì„ ëª¨ì§‘í•˜ì„¸ìš”
        </p>
      </div>
      
      <div className="rounded-2xl bg-white p-8 shadow-sm border border-slate-200 sm:p-10">
        <NewProjectForm userId={user.id} />
      </div>
    </div>
  );
}
</file>

<file path="app/projects/page.tsx">
import { createClient } from "@/lib/supabase/server";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { FolderKanban, Users, Plus, Search } from 'lucide-react';
import Link from "next/link";
import { Badge } from "@/components/ui/badge";
import { Input } from "@/components/ui/input";

export default async function ProjectsPage() {
  const supabase = await createClient();

  const { data: { user } } = await supabase.auth.getUser();

  const { data: activeProjects } = await supabase
    .from("projects")
    .select(`
      *,
      profiles:created_by (
        id,
        full_name
      ),
      project_members(count)
    `)
    .eq("status", "active")
    .order("created_at", { ascending: false });

  const { data: completedProjects } = await supabase
    .from("projects")
    .select(`
      *,
      profiles:created_by (
        id,
        full_name
      ),
      project_members(count)
    `)
    .eq("status", "completed")
    .order("updated_at", { ascending: false })
    .limit(6);

  return (
    <div className="w-full">
      {/* Header */}
      <div className="mb-8 flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
          <div>
            <h1 className="text-2xl md:text-3xl font-bold tracking-tight text-slate-900">
              í”„ë¡œì íŠ¸
            </h1>
            <p className="mt-2 text-sm md:text-base text-slate-600">
              í˜‘ì—…í•  í”„ë¡œì íŠ¸ë¥¼ ì°¾ê±°ë‚˜ ìƒˆë¡œìš´ í”„ë¡œì íŠ¸ë¥¼ ì‹œì‘í•˜ì„¸ìš”
            </p>
          </div>
          {user ? (
            <Link href="/projects/new" className="w-full md:w-auto">
              <Button className="w-full md:w-auto gap-2 h-12 px-6 bg-blue-600 hover:bg-blue-700 text-white text-base">
                <Plus className="h-5 w-5" />
                í”„ë¡œì íŠ¸ ë§Œë“¤ê¸°
              </Button>
            </Link>
          ) : (
            <Link href="/auth/login" className="w-full md:w-auto">
              <Button className="w-full md:w-auto gap-2 h-12 px-6 bg-blue-600 hover:bg-blue-700 text-white text-base">
                <Plus className="h-5 w-5" />
                ë¡œê·¸ì¸í•˜ê³  í”„ë¡œì íŠ¸ ë§Œë“¤ê¸°
              </Button>
            </Link>
          )}
        </div>

        {/* Active Projects */}
        <div className="mb-12">
          <h2 className="mb-4 text-lg md:text-xl font-semibold text-slate-900">
            ì§„í–‰ ì¤‘ì¸ í”„ë¡œì íŠ¸
          </h2>
          {activeProjects && activeProjects.length > 0 ? (
            <div className="grid gap-4 sm:grid-cols-2 lg:grid-cols-3 md:gap-6">
              {activeProjects.map((project) => {
                const memberCount = project.project_members?.[0]?.count || 0;
                const needsMembers = project.looking_for_members;
                
                return (
                  <Link key={project.id} href={`/projects/${project.id}`}>
                    <Card className="h-full overflow-hidden border-slate-200 transition-shadow hover:shadow-lg">
                      <div className="relative h-40 md:h-48 w-full bg-gradient-to-br from-blue-500 to-purple-600">
                        {project.thumbnail_url ? (
                          <img
                            src={project.thumbnail_url || "/placeholder.svg"}
                            alt={project.title}
                            className="h-full w-full object-cover"
                          />
                        ) : (
                          <div className="flex h-full w-full items-center justify-center">
                            <FolderKanban className="h-16 w-16 text-white opacity-80" />
                          </div>
                        )}
                        {needsMembers && (
                          <Badge className="absolute top-3 right-3 bg-green-500">
                            íŒ€ì› ëª¨ì§‘ ì¤‘
                          </Badge>
                        )}
                      </div>

                      <CardContent className="p-3 md:p-4">
                        <div className="mb-2 flex items-center gap-2">
                          <Badge variant="outline" className="text-xs">
                            {project.category}
                          </Badge>
                          <Badge variant="outline" className="text-xs">
                            {project.status === 'active' ? 'ì§„í–‰ì¤‘' : project.status === 'recruiting' ? 'ëª¨ì§‘ì¤‘' : 'ì™„ë£Œ'}
                          </Badge>
                        </div>

                        <h3 className="mb-3 h-12 md:h-14 line-clamp-2 text-base md:text-lg font-semibold text-slate-900">
                          {project.title}
                        </h3>

                        <p className="mb-4 line-clamp-2 text-xs md:text-sm text-slate-600">
                          {project.description}
                        </p>

                        <div className="space-y-2 text-xs md:text-sm text-slate-600">
                          <div className="flex items-center gap-2">
                            <Users className="h-4 w-4" />
                            <span>íŒ€ì› {memberCount}ëª…</span>
                          </div>
                        </div>
                      </CardContent>
                    </Card>
                  </Link>
                );
              })}
            </div>
          ) : (
            <Card className="border-slate-200">
              <CardContent className="py-12 text-center">
                <FolderKanban className="mx-auto mb-4 h-12 w-12 text-slate-400" />
                <h3 className="mb-2 text-lg font-semibold text-slate-900">
                  ì§„í–‰ ì¤‘ì¸ í”„ë¡œì íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤
                </h3>
                <p className="mb-4 text-sm text-slate-600">
                  ì²« ë²ˆì§¸ í”„ë¡œì íŠ¸ë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”
                </p>
                {user ? (
                  <Link href="/projects/new">
                    <Button>í”„ë¡œì íŠ¸ ë§Œë“¤ê¸°</Button>
                  </Link>
                ) : (
                  <Link href="/auth/login">
                    <Button>ë¡œê·¸ì¸í•˜ê³  í”„ë¡œì íŠ¸ ë§Œë“¤ê¸°</Button>
                  </Link>
                )}
              </CardContent>
            </Card>
          )}
        </div>

        {/* Completed Projects */}
        {completedProjects && completedProjects.length > 0 && (
          <div>
            <h2 className="mb-4 text-lg md:text-xl font-semibold text-slate-900">
              ì™„ë£Œëœ í”„ë¡œì íŠ¸
            </h2>
            <div className="grid gap-4 sm:grid-cols-2 lg:grid-cols-3 md:gap-6">
              {completedProjects.map((project) => (
                <Link key={project.id} href={`/projects/${project.id}`}>
                  <Card className="h-full border-slate-200 opacity-75 transition-all hover:opacity-100">
                    <CardHeader>
                      <Badge variant="outline" className="w-fit text-xs mb-2">
                        {project.category}
                      </Badge>
                      <CardTitle className="line-clamp-2">{project.title}</CardTitle>
                    </CardHeader>
                    <CardContent>
                      <p className="text-sm text-slate-600 line-clamp-2">
                        {project.description}
                      </p>
                    </CardContent>
                  </Card>
                </Link>
              ))}
            </div>
          </div>
        )}
    </div>
  );
}
</file>

<file path="app/providers.tsx">
"use client"

import { QueryClient, QueryClientProvider } from "@tanstack/react-query"
import { ReactQueryDevtools } from "@tanstack/react-query-devtools"
import { useState } from "react"
import { ScrollbarFix } from "@/components/scrollbar-fix"

export default function Providers({ children }: { children: React.ReactNode }) {
  const [queryClient] = useState(
    () =>
      new QueryClient({
        defaultOptions: {
          queries: {
            // ê¸°ë³¸ì ìœ¼ë¡œ 1ë¶„ ë™ì•ˆì€ ë°ì´í„°ë¥¼ ìƒí•œ ê²ƒìœ¼ë¡œ ê°„ì£¼í•˜ì§€ ì•ŠìŒ (ì¬ìš”ì²­ ì•ˆ í•¨)
            staleTime: 60 * 1000,
            refetchOnWindowFocus: false, // ì°½ í¬ì»¤ìŠ¤ ì‹œ ì¬ìš”ì²­ ë°©ì§€ (ì„ íƒì‚¬í•­)
          },
        },
      })
  )

  return (
    <QueryClientProvider client={queryClient}>
      <ScrollbarFix />
      {children}
      <ReactQueryDevtools initialIsOpen={false} />
    </QueryClientProvider>
  )
}
</file>

<file path="app/reviews/test/page.tsx">
import { createClient } from "@/lib/supabase/server"
import { ReviewModal } from "@/components/reviews/review-modal"
import { ReviewCard } from "@/components/reviews/review-card"
import type { ReviewForDisplay } from "@/lib/types/reviews"

// ëª© ë°ì´í„°
const mockReviews: ReviewForDisplay[] = [
    {
        id: "1",
        user_id: "mock-user-1",
        event_id: "event-1",
        rating: 4.5,
        keywords: ["ğŸ· ì¦ê±°ìš´ ë¶„ìœ„ê¸°", "ğŸŒ¿ íë§/ì¶©ì „", "ğŸ‰ ì•Œì°¬ êµ¬ì„±"],
        one_liner: "ì§€ì¹œ ì¼ìƒì—ì„œ ë²—ì–´ë‚˜ ì—ë„ˆì§€ë¥¼ ê°€ë“ ì¶©ì „í•˜ê³  ê°‘ë‹ˆë‹¤!",
        detail_content:
            "ì²˜ìŒì—” ë‹¨ìˆœí•œ ë„¤íŠ¸ì›Œí‚¹ ëª¨ì„ì´ë¼ê³  ìƒê°í–ˆëŠ”ë°, ì‹¤ì œë¡œ ê²ªê³  ìˆëŠ” ì–´ë ¤ì›€ë“¤ì„ í—ˆì‹¬íƒ„íšŒí•˜ê²Œ ë‚˜ëˆŒ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. íŠ¹íˆ ì œì¡°ì—… ìŠ¤íƒ€íŠ¸ì—…ì„ ìš´ì˜í•˜ì‹œëŠ” ë¶„ì˜ ì¡°ì–¸ì´ ì •ë§ ë„ì›€ì´ ë§ì´ ë˜ì—ˆì–´ìš”. ë‹¤ìŒì—ë„ ê¼­ ì°¸ì—¬í•˜ê³  ì‹¶ìŠµë‹ˆë‹¤!",
        images: [],
        is_best: true,
        is_public: true,
        created_at: new Date().toISOString(),
        updated_at: new Date().toISOString(),
        profiles: {
            id: "mock-user-1",
            full_name: "ê¹€ì°½ì—…",
            avatar_url: null,
            role: "member",
            company: "ìŠ¤íƒ€íŠ¸ì—…ì½”ë¦¬ì•„",
            position: "ëŒ€í‘œ",
        },
        events: {
            id: "event-1",
            title: "ì°½ì—…ê°€ ë„¤íŠ¸ì›Œí‚¹ ëª¨ì„ - 12ì›”",
            event_date: new Date(Date.now() - 432000000).toISOString(),
            thumbnail_url: null,
        },
    },
    {
        id: "2",
        user_id: "mock-user-2",
        event_id: "event-2",
        rating: 5.0,
        keywords: ["ğŸ§  ìƒˆë¡œìš´ ê´€ì ", "ğŸ’¼ íˆ¬ì ê¸°íšŒ"],
        one_liner: "íˆ¬ìì ê´€ì ì—ì„œ ë°”ë¼ë³¸ ì‹œì¥ ë¶„ì„ì´ ëˆˆì„ ëœ¨ê²Œ í•´ì¤¬ìŠµë‹ˆë‹¤",
        detail_content: null,
        images: [],
        is_best: false,
        is_public: true,
        created_at: new Date(Date.now() - 86400000).toISOString(),
        updated_at: new Date(Date.now() - 86400000).toISOString(),
        profiles: {
            id: "mock-user-2",
            full_name: "ì´ì‚¬ì—…",
            avatar_url: null,
            role: "member",
            company: "í…Œí¬ë²¤ì²˜ìŠ¤",
            position: "CTO",
        },
        events: {
            id: "event-2",
            title: "ìŠ¤íƒ€íŠ¸ì—… íˆ¬ì ì„¸ë¯¸ë‚˜",
            event_date: new Date(Date.now() - 864000000).toISOString(),
            thumbnail_url: null,
        },
    },
    {
        id: "3",
        user_id: "mock-user-3",
        event_id: "event-3",
        rating: 4.0,
        keywords: ["ğŸ—£ï¸ ììœ ë¡œìš´ ì†Œí†µ", "ğŸ§¸ ê°€ë²¼ìš´ ì‹œì‘", "ğŸ¤ ì¢‹ì€ ì¸ë§¥"],
        one_liner: "í¸ì•ˆí•œ ë¶„ìœ„ê¸°ì—ì„œ ì§„ì†”í•œ ëŒ€í™”ë¥¼ ë‚˜ëˆŒ ìˆ˜ ìˆì—ˆì–´ìš”",
        detail_content: null,
        images: [],
        is_best: false,
        is_public: true,
        created_at: new Date(Date.now() - 172800000).toISOString(),
        updated_at: new Date(Date.now() - 172800000).toISOString(),
        profiles: {
            id: "mock-user-3",
            full_name: "ë°•í˜ì‹ ",
            avatar_url: null,
            role: "admin",
            company: "ì´ë…¸ë² ì´ì…˜ë©",
            position: "íŒ€ì¥",
        },
        events: {
            id: "event-3",
            title: "SFC ì •ê¸° ëª¨ì„",
            event_date: new Date(Date.now() - 1728000000).toISOString(),
            thumbnail_url: null,
        },
    },
    {
        id: "4",
        user_id: "mock-user-4",
        event_id: "event-1",
        rating: 3.5,
        keywords: ["âš¡ï¸ ë™ê¸°ë¶€ì—¬"],
        one_liner: "ë‹¤ì‹œ ë„ì „í•  ìš©ê¸°ë¥¼ ì–»ì—ˆìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤!",
        detail_content: null,
        images: [],
        is_best: false,
        is_public: true,
        created_at: new Date(Date.now() - 259200000).toISOString(),
        updated_at: new Date(Date.now() - 259200000).toISOString(),
        profiles: {
            id: "mock-user-4",
            full_name: "ìµœë„ì „",
            avatar_url: null,
            role: "member",
            company: null,
            position: "ì˜ˆë¹„ì°½ì—…ì",
        },
        events: {
            id: "event-1",
            title: "ì°½ì—…ê°€ ë„¤íŠ¸ì›Œí‚¹ ëª¨ì„ - 12ì›”",
            event_date: new Date(Date.now() - 432000000).toISOString(),
            thumbnail_url: null,
        },
    },
]

export default async function ReviewTestPage() {
    const supabase = await createClient()
    const {
        data: { user },
    } = await supabase.auth.getUser()

    return (
        <div className="min-h-screen bg-gradient-to-br from-slate-50 via-white to-slate-100 dark:from-slate-950 dark:via-slate-900 dark:to-slate-950">
            <div className="container max-w-7xl mx-auto px-4 py-12 space-y-8">
                {/* í—¤ë” */}
                <div className="text-center space-y-4">
                    <h1 className="text-4xl md:text-5xl font-bold bg-gradient-to-r from-primary via-purple-600 to-pink-600 bg-clip-text text-transparent">
                        í›„ê¸° ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸
                    </h1>
                    <p className="text-lg text-muted-foreground max-w-2xl mx-auto">
                        ê°€ë²¼ìš´ íšŒê³  ì‹œìŠ¤í…œì„ í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”. ë³„ì , í‚¤ì›Œë“œ, í•œ ì¤„ í‰ìœ¼ë¡œ ê°„í¸í•˜ê²Œ í›„ê¸°ë¥¼ ë‚¨ê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    </p>
                </div>

                {/* í›„ê¸° ì‘ì„± ë²„íŠ¼ */}
                <div className="flex justify-center">
                    {user ? (
                        <ReviewModal userId={user.id} eventId="event-1" />
                    ) : (
                        <div className="text-center p-8 bg-white/50 dark:bg-slate-900/50 backdrop-blur rounded-lg border">
                            <p className="text-muted-foreground mb-4">
                                í›„ê¸°ë¥¼ ì‘ì„±í•˜ë ¤ë©´ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤
                            </p>
                            <a
                                href="/auth/login"
                                className="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"
                            >
                                ë¡œê·¸ì¸í•˜ê¸°
                            </a>
                        </div>
                    )}
                </div>

                {/* êµ¬ë¶„ì„  */}
                <div className="relative">
                    <div className="absolute inset-0 flex items-center">
                        <div className="w-full border-t border-slate-200 dark:border-slate-800" />
                    </div>
                    <div className="relative flex justify-center text-sm">
                        <span className="bg-white dark:bg-slate-950 px-4 text-muted-foreground">
                            ì‘ì„±ëœ í›„ê¸°
                        </span>
                    </div>
                </div>

                {/* í›„ê¸° ì¹´ë“œ - 2ì—´ ê·¸ë¦¬ë“œ */}
                <div className="grid grid-cols-1 lg:grid-cols-2 gap-4">
                    {mockReviews.map((review) => (
                        <ReviewCard key={review.id} review={review} />
                    ))}
                </div>

                {/* ì•ˆë‚´ë¬¸ */}
                <div className="bg-blue-50 dark:bg-blue-950/30 border border-blue-200 dark:border-blue-900 rounded-lg p-6">
                    <h3 className="font-semibold text-blue-900 dark:text-blue-100 mb-2">
                        ğŸ’¡ í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ì•ˆë‚´
                    </h3>
                    <ul className="text-sm text-blue-800 dark:text-blue-200 space-y-1">
                        <li>â€¢ ìœ„ í›„ê¸°ë“¤ì€ ëª©(Mock) ë°ì´í„°ì…ë‹ˆë‹¤</li>
                        <li>â€¢ ëª¨ë“  í›„ê¸°ëŠ” íŠ¹ì • ì´ë²¤íŠ¸/í–‰ì‚¬ì™€ ì—°ê²°ë©ë‹ˆë‹¤</li>
                        <li>â€¢ ë³„ì ì€ 0.5ì  ë‹¨ìœ„ë¡œ ì„ íƒ ê°€ëŠ¥í•©ë‹ˆë‹¤ (ë³„ ì™¼ìª½ í´ë¦­: 0.5ì , ì˜¤ë¥¸ìª½ í´ë¦­: 1ì )</li>
                        <li>â€¢ í‚¤ì›Œë“œëŠ” ì¤‘ë³µ ì„ íƒì´ ê°€ëŠ¥í•©ë‹ˆë‹¤</li>
                        <li>â€¢ í•œ ì¤„ í‰ì€ 20ì ì´ìƒ 100ì ì´í•˜ë¡œ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤</li>
                        <li>â€¢ ìƒì„¸ í›„ê¸°ì™€ ì´ë¯¸ì§€ëŠ” ì„ íƒ ì‚¬í•­ì…ë‹ˆë‹¤</li>
                    </ul>
                </div>

                {/* Supabase ë§ˆì´ê·¸ë ˆì´ì…˜ ì•ˆë‚´ */}
                <div className="bg-yellow-50 dark:bg-yellow-950/30 border border-yellow-200 dark:border-yellow-900 rounded-lg p-6">
                    <h3 className="font-semibold text-yellow-900 dark:text-yellow-100 mb-2">
                        âš ï¸ ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ í•„ìš”
                    </h3>
                    <p className="text-sm text-yellow-800 dark:text-yellow-200 mb-3">
                        ì‹¤ì œë¡œ í›„ê¸°ë¥¼ ì‘ì„±í•˜ë ¤ë©´ ë¨¼ì € Supabaseì—ì„œ ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ì‹¤í–‰í•´ì•¼ í•©ë‹ˆë‹¤:
                    </p>
                    <ol className="text-sm text-yellow-800 dark:text-yellow-200 space-y-1 list-decimal list-inside">
                        <li>Supabase ëŒ€ì‹œë³´ë“œ â†’ SQL Editorë¡œ ì´ë™</li>
                        <li>
                            <code className="bg-yellow-100 dark:bg-yellow-900 px-1 py-0.5 rounded text-xs">
                                scripts/050_create_reviews_table.sql
                            </code>{" "}
                            íŒŒì¼ ë‚´ìš© ë³µì‚¬
                        </li>
                        <li>SQL Editorì— ë¶™ì—¬ë„£ê³  "Run" í´ë¦­</li>
                        <li>Table Editorì—ì„œ "reviews" í…Œì´ë¸” ìƒì„± í™•ì¸</li>
                    </ol>
                </div>
            </div>
        </div>
    )
}
</file>

<file path="app/robots.ts">
import { MetadataRoute } from 'next'

export default function robots(): MetadataRoute.Robots {
  const siteUrl = process.env.NEXT_PUBLIC_SITE_URL || "https://seoulfounders.club";

  return {
    rules: [
      {
        userAgent: '*',
        allow: [
          '/',
          '/about',
          '/events',
          '/member',
          '/communities',
          '/community/board/free',
          '/community/board/vangol',
          '/community/board/hightalk',
        ],
        disallow: [
          '/auth/',
          '/admin/',
          '/api/',
          '/community/profile',
          '/community/board/announcements',
        ],
      },
      {
        userAgent: 'Googlebot',
        allow: [
          '/',
          '/about',
          '/events',
          '/member',
          '/communities',
          '/community/board/free',
          '/community/board/vangol',
          '/community/board/hightalk',
        ],
        disallow: [
          '/auth/',
          '/admin/',
          '/api/',
          '/community/profile',
          '/community/board/announcements',
        ],
      },
    ],
    sitemap: `${siteUrl}/sitemap.xml`,
  }
}
</file>

<file path="app/sitemap.ts">
import { MetadataRoute } from 'next'
import { createClient } from '@supabase/supabase-js'

const PUBLIC_BOARDS = ["free", "vangol", "hightalk", "insights"];

export default async function sitemap(): Promise<MetadataRoute.Sitemap> {
  const siteUrl = process.env.NEXT_PUBLIC_SITE_URL || "https://seoulfounders.club";

  // Sitemap ìƒì„±ì„ ìœ„í•œ ì§ì ‘ í´ë¼ì´ì–¸íŠ¸ ìƒì„± (ì¿ í‚¤ ì˜ì¡´ì„± ì œê±°)
  const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;
  const supabaseKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;

  if (!supabaseUrl || !supabaseKey) {
    console.error("Supabase environment variables are missing for sitemap generation");
    // í™˜ê²½ ë³€ìˆ˜ê°€ ì—†ì–´ë„ ê¸°ë³¸ í˜ì´ì§€ë“¤ì€ ë°˜í™˜í•˜ë„ë¡ í•¨
    return [
      {
        url: siteUrl,
        lastModified: new Date(),
        changeFrequency: 'daily',
        priority: 1,
      },
      // ... ë‹¤ë¥¸ ì •ì  í˜ì´ì§€ë“¤ì€ ì•„ë˜ ë¡œì§ì—ì„œ ì¶”ê°€ë¨
    ];
  }

  const supabase = createClient(supabaseUrl, supabaseKey);

  // ê¸°ë³¸ í˜ì´ì§€ë“¤
  const routes: MetadataRoute.Sitemap = [
    {
      url: siteUrl,
      lastModified: new Date(),
      changeFrequency: 'daily',
      priority: 1,
    },
    {
      url: `${siteUrl}/about`,
      lastModified: new Date(),
      changeFrequency: 'monthly',
      priority: 0.8,
    },
    {
      url: `${siteUrl}/events`,
      lastModified: new Date(),
      changeFrequency: 'daily',
      priority: 0.9,
    },
    {
      url: `${siteUrl}/member`,
      lastModified: new Date(),
      changeFrequency: 'weekly',
      priority: 0.8,
    },
    {
      url: `${siteUrl}/communities`,
      lastModified: new Date(),
      changeFrequency: 'daily',
      priority: 0.8,
    },
  ];

  // ì „ì²´ ê³µê°œ ê²Œì‹œíŒ í˜ì´ì§€ë“¤
  for (const slug of PUBLIC_BOARDS) {
    routes.push({
      url: `${siteUrl}/community/board/${slug}`,
      lastModified: new Date(),
      changeFrequency: 'daily',
      priority: 0.7,
    });
  }

  // ì „ì²´ ê³µê°œ ê²Œì‹œíŒì˜ ê²Œì‹œê¸€ë“¤
  try {
    for (const slug of PUBLIC_BOARDS) {
      // URL slugë¥¼ DB slugë¡œ ë³€í™˜
      let dbSlug = slug;
      if (slug === 'free') dbSlug = 'free-board';
      if (slug === 'announcements') dbSlug = 'announcement';

      const { data: posts } = await supabase
        .from("posts")
        .select(`
          id, 
          updated_at, 
          created_at,
          board_categories!inner(slug)
        `)
        .eq("board_categories.slug", dbSlug)
        .order("created_at", { ascending: false })
        .limit(100); // ìµœê·¼ 100ê°œë§Œ í¬í•¨

      if (posts) {
        posts.forEach((post: any) => {
          // ì¸ì‚¬ì´íŠ¸ ê²Œì‹œê¸€ì€ priorityë¥¼ 0.8ë¡œ ì„¤ì •
          const priority = slug === "insights" ? 0.8 : 0.6;

          routes.push({
            url: `${siteUrl}/community/board/${slug}/${post.id}`,
            lastModified: new Date(post.updated_at || post.created_at),
            changeFrequency: 'weekly',
            priority: priority,
          });
        });
      }
    }
  } catch (error) {
    console.error('Error fetching posts for sitemap:', error);
  }

  // ì´ë²¤íŠ¸ í˜ì´ì§€ë“¤
  try {
    const { data: events } = await supabase
      .from("events")
      .select("id, updated_at, created_at")
      .gte("event_date", new Date().toISOString())
      .order("event_date", { ascending: true })
      .limit(50);

    if (events) {
      events.forEach((event) => {
        routes.push({
          url: `${siteUrl}/events/${event.id}`,
          lastModified: new Date(event.updated_at || event.created_at),
          changeFrequency: 'weekly',
          priority: 0.7,
        });
      });
    }
  } catch (error) {
    console.error('Error fetching events for sitemap:', error);
  }

  // ì†Œëª¨ì„ í˜ì´ì§€ë“¤
  try {
    const { data: communities } = await supabase
      .from("communities")
      .select("id, updated_at, created_at")
      .order("created_at", { ascending: false })
      .limit(50);

    if (communities) {
      communities.forEach((community) => {
        routes.push({
          url: `${siteUrl}/communities/${community.id}`,
          lastModified: new Date(community.updated_at || community.created_at),
          changeFrequency: 'weekly',
          priority: 0.6,
        });
      });
    }
  } catch (error) {
    console.error('Error fetching communities for sitemap:', error);
  }

  return routes;
}
</file>

<file path="app/terms/page.tsx">
import { createClient } from "@/lib/supabase/server"
import { getCurrentUserProfile } from "@/lib/queries/profiles"
import { DashboardLayout } from "@/components/dashboard-layout"
import SidebarProfile from "@/components/sidebar-profile"
import { SiteHeader } from "@/components/site-header"
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"

export default async function TermsPage() {
  const supabase = await createClient()
  const userProfile = await getCurrentUserProfile(supabase)
  const userRole = userProfile?.profile?.role || null

  return (
    <DashboardLayout header={<SiteHeader />} sidebarProfile={<SidebarProfile />} userRole={userRole}>
      <div className="max-w-4xl mx-auto p-6 w-full">
          <Card className="border-slate-200 shadow-sm">
            <CardHeader>
              <CardTitle className="text-2xl font-bold">ì´ìš©ì•½ê´€</CardTitle>
              <p className="text-sm text-slate-500">ìµœì¢… ìˆ˜ì •ì¼: 2025ë…„ 11ì›” 20ì¼</p>
            </CardHeader>
            <CardContent className="prose prose-slate max-w-none">
              <div className="space-y-6 text-sm leading-relaxed text-slate-700">
                <section>
                  <h3 className="text-lg font-semibold text-slate-900 mb-2">ì œ1ì¡° (ëª©ì )</h3>
                  <p>
                    ë³¸ ì•½ê´€ì€ Seoul Founders Club(ì´í•˜ "ì»¤ë®¤ë‹ˆí‹°")ì´ ì œê³µí•˜ëŠ” ì˜¨ë¼ì¸ ë° ì˜¤í”„ë¼ì¸ ê¸°ë°˜ì˜ ì»¤ë®¤ë‹ˆí‹° ì„œë¹„ìŠ¤, ì´ë²¤íŠ¸, ì½˜í…ì¸  ì œê³µ ì„œë¹„ìŠ¤(ì´í•˜ "ì„œë¹„ìŠ¤")ì˜ ì´ìš©ê³¼ ê´€ë ¨í•˜ì—¬ ì»¤ë®¤ë‹ˆí‹°ì™€ íšŒì› ê°„ì˜ ê¶Œë¦¬Â·ì˜ë¬´ ë° ì±…ì„ì‚¬í•­ì„ ê·œì •í•¨ì„ ëª©ì ìœ¼ë¡œ í•©ë‹ˆë‹¤.
                  </p>
                </section>

                <section>
                  <h3 className="text-lg font-semibold text-slate-900 mb-2">ì œ2ì¡° (ìš©ì–´ì˜ ì •ì˜)</h3>
                  <p>
                    íšŒì›: ë³¸ ì•½ê´€ì— ë™ì˜í•˜ê³  ì»¤ë®¤ë‹ˆí‹°ê°€ ì œê³µí•˜ëŠ” ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ëŠ” ì<br/>
                    ì„œë¹„ìŠ¤: ì»¤ë®¤ë‹ˆí‹°ê°€ ìš´ì˜í•˜ëŠ” ì›¹ì‚¬ì´íŠ¸, í”Œë«í¼, ì´ë²¤íŠ¸, ì»¤ë®¤ë‹ˆí‹° í™œë™ ì „ë°˜<br/>
                    ì½˜í…ì¸ : ì»¤ë®¤ë‹ˆí‹°ê°€ ì œì‘í•˜ê±°ë‚˜ íšŒì›ì´ ì—…ë¡œë“œí•œ ê¸€, ì‚¬ì§„, ì˜ìƒ, í”„ë¡œí•„, ê²Œì‹œë¬¼ ë“± ëª¨ë“  ìë£Œ<br/>
                    ìœ ë£Œ ì„œë¹„ìŠ¤: ê²°ì œë¥¼ í†µí•´ ì°¸ì—¬í•˜ëŠ” ì´ë²¤íŠ¸, í´ë˜ìŠ¤, ë©¤ë²„ì‹­ ë“±<br/>
                    ìš´ì˜ì: ì»¤ë®¤ë‹ˆí‹°ì˜ ìš´ì˜ ë° ê´€ë¦¬ë¥¼ ë‹´ë‹¹í•˜ëŠ” ì
                  </p>
                </section>

                <section>
                  <h3 className="text-lg font-semibold text-slate-900 mb-2">ì œ3ì¡° (íšŒì›ì˜ ì˜ë¬´)</h3>
                  <p>
                    1. íšŒì›ì€ ê´€ê³„ ë²•ë ¹, ë³¸ ì•½ê´€, ê³µì§€ì‚¬í•­ ë“± ì»¤ë®¤ë‹ˆí‹°ê°€ ì •í•œ ê·œì •ì„ ì¤€ìˆ˜í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.<br/>
                    2. íšŒì›ì€ ë‹¤ìŒ ê° í˜¸ì˜ í–‰ìœ„ë¥¼ í•˜ì—¬ì„œëŠ” ì•ˆ ë©ë‹ˆë‹¤.<br/>
                    - íƒ€ì¸ì˜ ê³„ì • ë˜ëŠ” ì •ë³´ë¥¼ ë„ìš©í•˜ëŠ” í–‰ìœ„<br/>
                    - í—ˆìœ„ ì •ë³´ ë“±ë¡ ë° ì»¤ë®¤ë‹ˆí‹° ìš´ì˜ì„ ë°©í•´í•˜ëŠ” í–‰ìœ„<br/>
                    - ìš•ì„¤, ë¹„ë°©, ì°¨ë³„, í˜ì˜¤ ë“± ì»¤ë®¤ë‹ˆí‹° ì§ˆì„œë¥¼ ì €í•´í•˜ëŠ” í–‰ìœ„<br/>
                    - ìŒë€ë¬¼, ë¶ˆë²• ì •ë³´, ì €ì‘ê¶Œ ì¹¨í•´ ì •ë³´ ê²Œì‹œ<br/>
                    - ê´‘ê³ , ìŠ¤íŒ¸, ìƒì—…ì  í™ë³´ í–‰ìœ„<br/>
                    - ê¸°íƒ€ ë¶ˆë²• ë˜ëŠ” ë¶€ë‹¹í•œ í–‰ìœ„
                  </p>
                </section>

                <section>
                  <h3 className="text-lg font-semibold text-slate-900 mb-2">ì œ4ì¡° (ì„œë¹„ìŠ¤ì˜ ì œê³µ ë° ë³€ê²½)</h3>
                  <p>
                    1. ì»¤ë®¤ë‹ˆí‹°ëŠ” íšŒì›ì—ê²Œ ë‹¤ìŒê³¼ ê°™ì€ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤.<br/>
                    - ì˜¨ë¼ì¸ ì»¤ë®¤ë‹ˆí‹° ë° ê²Œì‹œíŒ ì„œë¹„ìŠ¤<br/>
                    - ì˜¨/ì˜¤í”„ë¼ì¸ ì´ë²¤íŠ¸, ë„¤íŠ¸ì›Œí‚¹, ëª¨ì„<br/>
                    - ë©¤ë²„ì‹­ í”„ë¡œê·¸ë¨ ë° íšŒì›ì „ìš© ì½˜í…ì¸ <br/>
                    2. ì»¤ë®¤ë‹ˆí‹°ëŠ” ì„œë¹„ìŠ¤ì˜ ì¼ë¶€ ë˜ëŠ” ì „ë¶€ë¥¼ ë³€ê²½Â·ì¤‘ë‹¨í•  ìˆ˜ ìˆìœ¼ë©°, ì‚¬ì „ ê³µì§€ë¥¼ ì›ì¹™ìœ¼ë¡œ í•©ë‹ˆë‹¤.<br/>
                    3. ë¶ˆê°€í”¼í•œ ìƒí™©ìœ¼ë¡œ ì‚¬ì „ ê³µì§€ê°€ ì–´ë ¤ìš´ ê²½ìš°, ì‚¬í›„ ê³µì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                  </p>
                </section>

                <section>
                  <h3 className="text-lg font-semibold text-slate-900 mb-2">ì œ5ì¡° (ìœ ë£Œ ì„œë¹„ìŠ¤ ë° í™˜ë¶ˆ ê·œì •)</h3>
                  <p>
                    1. ìœ ë£Œ ì„œë¹„ìŠ¤(ì´ë²¤íŠ¸, í´ë˜ìŠ¤, ë©¤ë²„ì‹­ ë“±)ì˜ ê¸ˆì•¡, ë‚´ìš©, ì¡°ê±´ì€ ê²°ì œ í™”ë©´ ë° ì•ˆë‚´ í˜ì´ì§€ì— ë”°ë¦…ë‹ˆë‹¤.<br/>
                    2. ê²°ì œ ì·¨ì†Œ ë° í™˜ë¶ˆì€ ì»¤ë®¤ë‹ˆí‹°ì˜ í™˜ë¶ˆ ì •ì±…ì„ ë”°ë¦…ë‹ˆë‹¤.<br/>
                    - ì´ë²¤íŠ¸/í´ë˜ìŠ¤: í–‰ì‚¬ ì‹œì‘ 24~48ì‹œê°„ ì „ ì·¨ì†Œ ê°€ëŠ¥ ì—¬ë¶€ ëª…ì‹œ<br/>
                    - ë©¤ë²„ì‹­: ì‚¬ìš© ê¸°ê°„ ë° ê¶Œí•œ ì´ìš© ì—¬ë¶€ë¥¼ ê³ ë ¤í•˜ì—¬ í™˜ë¶ˆ ê¸°ì¤€ ì ìš©<br/>
                    3. íšŒì›ì´ ë¶€ì •í•œ ë°©ë²•ìœ¼ë¡œ ê²°ì œí•œ ê²½ìš°, ì»¤ë®¤ë‹ˆí‹°ëŠ” í•´ë‹¹ ê²°ì œë¥¼ ì·¨ì†Œí•˜ê±°ë‚˜ íšŒì›ì˜ ì´ìš©ì„ ì œí•œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                  </p>
                </section>

                <section>
                  <h3 className="text-lg font-semibold text-slate-900 mb-2">ì œ6ì¡° (ê²Œì‹œë¬¼ì˜ ê´€ë¦¬)</h3>
                  <p>
                    1. íšŒì›ì´ ì„œë¹„ìŠ¤ ë‚´ì— ê²Œì‹œí•˜ëŠ” ëª¨ë“  ì½˜í…ì¸ ëŠ” íšŒì› ê°œì¸ì˜ ì±…ì„ í•˜ì— ì‘ì„±ë©ë‹ˆë‹¤.<br/>
                    2. ë‹¤ìŒì— í•´ë‹¹í•˜ëŠ” ê²Œì‹œë¬¼ì€ ì‚¬ì „ í†µë³´ ì—†ì´ ìˆ˜ì •Â·ì‚­ì œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br/>
                    - íƒ€ì¸ì˜ ê¶Œë¦¬ë¥¼ ì¹¨í•´í•˜ëŠ” ê²Œì‹œë¬¼<br/>
                    - ìš•ì„¤, ë¹„ë°©, ì°¨ë³„, ìŒë€ë¬¼ ë“± ì»¤ë®¤ë‹ˆí‹° ìš´ì˜ ê¸°ì¤€ ìœ„ë°˜<br/>
                    - í—ˆìœ„ ì‚¬ì‹¤, ë¶ˆë²• ì •ë³´<br/>
                    3. ì»¤ë®¤ë‹ˆí‹°ëŠ” ê²Œì‹œë¬¼ì´ ë²•ë ¹ì„ ìœ„ë°˜í•œë‹¤ê³  íŒë‹¨ë  ê²½ìš° ê´€ë ¨ ê¸°ê´€ì— ì‹ ê³ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                  </p>
                </section>

                <section>
                  <h3 className="text-lg font-semibold text-slate-900 mb-2">ì œ7ì¡° (ì €ì‘ê¶Œ ë° ì½˜í…ì¸  ì‚¬ìš©ê¶Œ)</h3>
                  <p>
                    1. íšŒì›ì´ ì‘ì„±í•œ ì½˜í…ì¸ ì˜ ì €ì‘ê¶Œì€ íšŒì›ì—ê²Œ ìˆìŠµë‹ˆë‹¤.<br/>
                    2. íšŒì›ì€ ì»¤ë®¤ë‹ˆí‹°ê°€ ì•„ë˜ ë²”ìœ„ ë‚´ì—ì„œ íšŒì› ì½˜í…ì¸ ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ë¹„ë…ì ì  ì‚¬ìš©ê¶Œì„ ë¶€ì—¬í•©ë‹ˆë‹¤.<br/>
                    - ì„œë¹„ìŠ¤ ìš´ì˜, í™ë³´ë¥¼ ìœ„í•œ ë…¸ì¶œ<br/>
                    - í–¥í›„ í”Œë«í¼ ê°œì„ ì„ ìœ„í•œ í™œìš©<br/>
                    3. ì»¤ë®¤ë‹ˆí‹°ê°€ ì €ì‘ë¬¼ì´ í¬í•¨ëœ ì½˜í…ì¸ ë¥¼ ì™¸ë¶€ ê´‘ê³ Â·ë§ˆì¼€íŒ…ì— í™œìš©í•  ê²½ìš°, ì‚¬ì „ ë™ì˜ë¥¼ ì–»ìŠµë‹ˆë‹¤.
                  </p>
                </section>

                <section>
                  <h3 className="text-lg font-semibold text-slate-900 mb-2">ì œ8ì¡° (ê°œì¸ì •ë³´ ë³´í˜¸)</h3>
                  <p>
                    1. ì»¤ë®¤ë‹ˆí‹°ëŠ” íšŒì›ì˜ ê°œì¸ì •ë³´ë¥¼ ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨ì— ë”°ë¼ ì²˜ë¦¬í•©ë‹ˆë‹¤.<br/>
                    2. ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨ì€ ì„œë¹„ìŠ¤ ë‚´ì— ë³„ë„ ê²Œì‹œí•˜ë©°, ë³¸ ì•½ê´€ê³¼ ë™ì¼í•œ íš¨ë ¥ì„ ê°€ì§‘ë‹ˆë‹¤.
                  </p>
                </section>

                <section>
                  <h3 className="text-lg font-semibold text-slate-900 mb-2">ì œ9ì¡° (íšŒì› ìê²© ì •ì§€ ë° íƒˆí‡´)</h3>
                  <p>
                    1. íšŒì›ì´ ì•„ë˜ ì‚¬í•­ì— í•´ë‹¹í•  ê²½ìš°, ì»¤ë®¤ë‹ˆí‹°ëŠ” íšŒì› ìê²©ì„ ì œí•œÂ·ì •ì§€ ë˜ëŠ” ê°•ì œ íƒˆí‡´ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br/>
                    - ì»¤ë®¤ë‹ˆí‹° ê·œì • ë°˜ë³µ ìœ„ë°˜<br/>
                    - íƒ€ íšŒì›ì—ê²Œ ì‹¬ê°í•œ í”¼í•´ë¥¼ ì£¼ëŠ” í–‰ìœ„<br/>
                    - ë¶ˆë²• í™œë™ ë° ë¶€ë‹¹ í–‰ìœ„<br/>
                    2. íšŒì›ì€ ì–¸ì œë“ ì§€ ì„œë¹„ìŠ¤ ë‚´ íƒˆí‡´ ì ˆì°¨ë¥¼ í†µí•´ íƒˆí‡´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                  </p>
                </section>

                <section>
                  <h3 className="text-lg font-semibold text-slate-900 mb-2">ì œ10ì¡° (ì±…ì„ ì œí•œ)</h3>
                  <p>
                    1. ì²œì¬ì§€ë³€, ì‹œìŠ¤í…œ ì¥ì•  ë“± ë¶ˆê°€í•­ë ¥ì  ì‚¬ìœ ë¡œ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•  ìˆ˜ ì—†ëŠ” ê²½ìš°, ì»¤ë®¤ë‹ˆí‹°ëŠ” ì±…ì„ì„ ì§€ì§€ ì•ŠìŠµë‹ˆë‹¤.<br/>
                    2. íšŒì›ì´ ê²Œì¬í•œ ì •ë³´Â·ìë£ŒÂ·ì‚¬ì‹¤ì˜ ì‹ ë¢°ë„ ë° ì •í™•ì„± ë“±ì— ê´€í•´ì„œëŠ” íšŒì› ìŠ¤ìŠ¤ë¡œê°€ ì±…ì„ì„ ì§‘ë‹ˆë‹¤.<br/>
                    3. íšŒì› ê°„ ë˜ëŠ” íšŒì›ê³¼ ì œ3ì ê°„ ë°œìƒí•œ ë¶„ìŸì— ëŒ€í•´ ì»¤ë®¤ë‹ˆí‹°ëŠ” ê°œì…í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
                  </p>
                </section>

                <section>
                  <h3 className="text-lg font-semibold text-slate-900 mb-2">ì œ11ì¡° (ë¶„ìŸ í•´ê²°)</h3>
                  <p>
                    ë³¸ ì•½ê´€ì— ê´€í•˜ì—¬ ë¶„ìŸì´ ë°œìƒí•˜ëŠ” ê²½ìš°, ëŒ€í•œë¯¼êµ­ ë²•ë ¹ì„ ë”°ë¥´ë©° ê´€í•  ë²•ì›ì€ ì„œìš¸ì¤‘ì•™ì§€ë°©ë²•ì›ìœ¼ë¡œ í•©ë‹ˆë‹¤.
                  </p>
                </section>
              </div>
            </CardContent>
          </Card>
      </div>
    </DashboardLayout>
  )
}
</file>

<file path="components.config.json.json">
{
  "$schema": "https://ui.shadcn.com/schema.json",
  "style": "new-york",
  "rsc": true,
  "tsx": true,
  "tailwind": {
    "config": "",
    "css": "app/globals.css",
    "baseColor": "neutral",
    "cssVariables": true,
    "prefix": ""
  },
  "aliases": {
    "components": "@/components",
    "utils": "@/lib/utils",
    "ui": "@/components/ui",
    "lib": "@/lib",
    "hooks": "@/hooks"
  },
  "iconLibrary": "lucide"
}
</file>

<file path="components/add-guest-form.tsx">
"use client"

import { useState } from "react"
import { useRouter } from "next/navigation"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { Label } from "@/components/ui/label"
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import { UserPlus, Loader2 } from "lucide-react"
import { addGuestParticipant } from "@/lib/actions/events"

type AddGuestFormProps = {
  eventId: string
}

export function AddGuestForm({ eventId }: AddGuestFormProps) {
  const [guestName, setGuestName] = useState("")
  const [guestContact, setGuestContact] = useState("")
  const [isSubmitting, setIsSubmitting] = useState(false)
  const router = useRouter()

  const handleSubmit = async (e: React.FormEvent<HTMLFormElement>) => {
    e.preventDefault()

    if (!guestName.trim()) {
      alert("ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.")
      return
    }

    setIsSubmitting(true)
    try {
      await addGuestParticipant(eventId, guestName.trim(), guestContact.trim() || undefined)
      setGuestName("")
      setGuestContact("")
      router.refresh()
      alert("ì°¸ê°€ìê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.")
    } catch (error) {
      console.error("Failed to add guest participant:", error)
      alert(error instanceof Error ? error.message : "ì°¸ê°€ì ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")
    } finally {
      setIsSubmitting(false)
    }
  }

  return (
    <Card className="border-slate-200">
      <CardHeader>
        <CardTitle className="flex items-center gap-2">
          <UserPlus className="h-5 w-5" />
          ì°¸ê°€ì ìˆ˜ë™ ë“±ë¡
        </CardTitle>
      </CardHeader>
      <CardContent>
        <form onSubmit={handleSubmit} className="space-y-4">
          <div className="space-y-2">
            <Label htmlFor="guest-name">ì´ë¦„ *</Label>
            <Input
              id="guest-name"
              type="text"
              placeholder="ì°¸ê°€ì ì´ë¦„"
              value={guestName}
              onChange={(e) => setGuestName(e.target.value)}
              required
              disabled={isSubmitting}
              className="border-slate-300"
            />
          </div>
          <div className="space-y-2">
            <Label htmlFor="guest-contact">ì—°ë½ì²˜ (ì„ íƒ)</Label>
            <Input
              id="guest-contact"
              type="text"
              placeholder="ì—°ë½ì²˜ (ì„ íƒì‚¬í•­)"
              value={guestContact}
              onChange={(e) => setGuestContact(e.target.value)}
              disabled={isSubmitting}
              className="border-slate-300"
            />
          </div>
          <Button type="submit" disabled={isSubmitting} className="w-full bg-slate-900 hover:bg-slate-800 text-white">
            {isSubmitting ? (
              <>
                <Loader2 className="mr-2 h-4 w-4 animate-spin" />
                ë“±ë¡ ì¤‘...
              </>
            ) : (
              "ë“±ë¡í•˜ê¸°"
            )}
          </Button>
        </form>
      </CardContent>
    </Card>
  )
}
</file>

<file path="components/admin/admin-breadcrumb.tsx">
"use client"

import Link from "next/link"
import { Home } from "lucide-react"
import {
  Breadcrumb,
  BreadcrumbItem,
  BreadcrumbLink,
  BreadcrumbList,
  BreadcrumbPage,
  BreadcrumbSeparator,
} from "@/components/ui/breadcrumb"

interface BreadcrumbItem {
  label: string
  href?: string
}

interface AdminBreadcrumbProps {
  items: BreadcrumbItem[]
}

export function AdminBreadcrumb({ items }: AdminBreadcrumbProps) {
  return (
    <Breadcrumb className="mb-6">
      <BreadcrumbList>
        <BreadcrumbItem>
          <BreadcrumbLink asChild>
            <Link href="/admin" className="flex items-center gap-1.5 text-slate-500 hover:text-slate-900">
              <Home className="h-4 w-4" />
              <span>ê´€ë¦¬ì</span>
            </Link>
          </BreadcrumbLink>
        </BreadcrumbItem>
        {items.map((item, index) => (
          <span key={index} className="contents">
            <BreadcrumbSeparator />
            <BreadcrumbItem>
              {item.href ? (
                <BreadcrumbLink asChild>
                  <Link href={item.href} className="text-slate-500 hover:text-slate-900">
                    {item.label}
                  </Link>
                </BreadcrumbLink>
              ) : (
                <BreadcrumbPage className="text-slate-900 font-medium">
                  {item.label}
                </BreadcrumbPage>
              )}
            </BreadcrumbItem>
          </span>
        ))}
      </BreadcrumbList>
    </Breadcrumb>
  )
}
</file>

<file path="components/admin/admin-view.tsx">
"use client"

import { useState } from "react"
import { Users, Calendar, FileText, Eye, Trash2, Medal, Briefcase } from "lucide-react"
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from "@/components/ui/table"
import { UserManagementRow } from "@/components/user-management"
import { DeleteEventButton } from "@/components/delete-event-button"
import Image from "next/image"
import Link from "next/link"
import { Button } from "@/components/ui/button"
import { cn } from "@/lib/utils"
import { BadgeManagementTab } from "./badge-management-tab"
import { PartnerApplicationsTab } from "./partner-applications-tab"
import { PostManagementTab } from "./posts/post-management-tab"
import { deletePost } from "@/lib/actions/posts"
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs"
import {
  AlertDialog,
  AlertDialogAction,
  AlertDialogCancel,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogTitle,
} from "@/components/ui/alert-dialog"

type TabType = "users" | "events" | "posts" | "badges" | "partner-applications"

type User = {
  id: string
  full_name: string | null
  email: string | null
  role: string | null
  membership_tier: string | null
  points: number | null
  created_at: string
}

type Event = {
  id: string
  title: string
  thumbnail_url: string | null
  event_date: string
  location: string
  created_at: string
  participantCount: number
  max_participants: number | null
  profiles: {
    id: string
    full_name: string | null
    avatar_url: string | null
  } | null
}

type Post = {
  id: string
  title: string
  created_at: string
  profiles: {
    id: string
    full_name: string | null
    avatar_url: string | null
  } | null
  board_categories: {
    id: string
    name: string
    slug: string
  } | null
}

type Badge = {
  id: string
  name: string
  icon: string
  category: string
  description: string | null
}

type PendingBadge = {
  id: string
  status: string
  evidence: string | null
  created_at: string
  profiles: {
    id: string
    full_name: string | null
    email: string | null
    avatar_url: string | null
  } | null
  badges: {
    id: string
    name: string
    icon: string
  } | null
}

type Category = {
  id: string
  name: string
  type: "insight" | "partner"
  created_at: string
}

type PartnerApplication = {
  id: string
  created_at: string
  status: "pending" | "approved" | "rejected"
  company_name: string | null
  current_usage: string | null
  profiles: {
    id: string
    full_name: string | null
    email: string | null
  } | null
  partners?: {
    id: string
    name: string
  } | null
  partner_name?: string | null
}

type BadgeCategory = {
  category_value: string
  category_label: string
  sort_order: number
}

type AdminViewProps = {
  users: User[]
  events: Event[]
  posts: Post[]
  badges: Badge[]
  pendingBadges: PendingBadge[]
  categories?: Category[]
  partnerApplications?: PartnerApplication[]
  badgeCategories?: BadgeCategory[]
  currentUserId: string
  isMaster: boolean
}

export function AdminView({ users, events, posts, badges, pendingBadges, categories = [], partnerApplications = [], badgeCategories = [], currentUserId, isMaster }: AdminViewProps) {
  const [activeTab, setActiveTab] = useState<TabType>("users")
  const [deletingPostId, setDeletingPostId] = useState<string | null>(null)
  const [showDeleteDialog, setShowDeleteDialog] = useState(false)
  const [isDeleting, setIsDeleting] = useState(false)

  // ë©”íŠ¸ë¦­ ì¹´ë“œ ì»´í¬ë„ŒíŠ¸
  const MetricCard = ({
    tab,
    label,
    count,
    icon: Icon,
  }: {
    tab: TabType
    label: string
    count: number
    icon: any
  }) => (
    <div
      onClick={() => setActiveTab(tab)}
      className={cn(
        "relative overflow-hidden rounded-xl border p-5 cursor-pointer transition-all duration-200 hover:shadow-md",
        "bg-white border-slate-200",
        activeTab === tab
          ? "ring-2 ring-slate-900 border-transparent shadow-md"
          : "hover:shadow-md"
      )}
    >
      <div className="flex justify-between items-start mb-2">
        <h3 className="text-sm font-medium text-slate-500">{label}</h3>
        <div
          className={cn(
            "p-2 rounded-full text-slate-400 transition-colors",
            activeTab === tab ? "bg-slate-900 text-white" : "bg-slate-50"
          )}
        >
          <Icon className="h-4 w-4" />
        </div>
      </div>
      <div className="flex items-baseline gap-1">
        <span className="text-3xl font-bold text-slate-900">{count}</span>
      </div>
    </div>
  )

  // ë‚ ì§œ í¬ë§·íŒ…
  const formatDate = (dateString: string) => {
    const date = new Date(dateString)
    return date.toLocaleDateString("ko-KR", {
      year: "numeric",
      month: "long",
      day: "numeric",
      hour: "2-digit",
      minute: "2-digit",
    })
  }

  const formatShortDate = (dateString: string) => {
    const date = new Date(dateString)
    return date.toLocaleDateString("ko-KR", {
      year: "numeric",
      month: "2-digit",
      day: "2-digit",
    })
  }

  const handleDeletePost = async () => {
    if (!deletingPostId) return
    
    setIsDeleting(true)
    try {
      await deletePost(deletingPostId)
      setShowDeleteDialog(false)
      setDeletingPostId(null)
      window.location.reload() // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ìœ¼ë¡œ ëª©ë¡ ê°±ì‹ 
    } catch (error) {
      console.error("Failed to delete post:", error)
      alert("ê²Œì‹œê¸€ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")
    } finally {
      setIsDeleting(false)
    }
  }

  return (
    <>
      <div className="w-full">
      <div className="mb-8">
        <h1 className="text-3xl font-bold tracking-tight text-slate-900">ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h1>
        <p className="mt-2 text-slate-600">Seoul Founders Club ì»¤ë®¤ë‹ˆí‹° ê´€ë¦¬</p>
      </div>

        {/* ë©”íŠ¸ë¦­ ì¹´ë“œ (íƒ­ ë²„íŠ¼) */}
        <div className="mb-8 grid gap-4 md:grid-cols-5">
          <MetricCard tab="users" label="ì „ì²´ íšŒì›" count={users.length} icon={Users} />
          <MetricCard tab="events" label="ì „ì²´ ì´ë²¤íŠ¸" count={events.length} icon={Calendar} />
          <MetricCard tab="posts" label="ê²Œì‹œíŒ ê´€ë¦¬" count={posts.length} icon={FileText} />
          <MetricCard tab="badges" label="ë±ƒì§€ ê´€ë¦¬" count={badges.length} icon={Medal} />
          <MetricCard tab="partner-applications" label="íŒŒíŠ¸ë„ˆìŠ¤ ì‹ ì²­" count={partnerApplications.length} icon={Briefcase} />
        </div>

        {/* í•˜ë‹¨ ì½˜í…ì¸  ì˜ì—­ */}
        <div className="bg-white border border-slate-200 rounded-xl p-6">
          {/* íšŒì› íƒ­ */}
          {activeTab === "users" && (
            <div>
              <h2 className="text-xl font-bold text-slate-900 mb-6">íšŒì› ëª©ë¡</h2>
              {users.length > 0 ? (
                <Table>
                  <TableHeader>
                    <TableRow>
                      <TableHead>í”„ë¡œí•„</TableHead>
                      <TableHead>ì´ë©”ì¼</TableHead>
                      <TableHead>ë“±ê¸‰</TableHead>
                      <TableHead>ê°€ì…ì¼</TableHead>
                      <TableHead className="text-right">ê´€ë¦¬</TableHead>
                    </TableRow>
                  </TableHeader>
                  <TableBody>
                    {users.map((user) => (
                      <UserManagementRow
                        key={user.id}
                        user={user}
                        currentUserId={currentUserId}
                        canChangeRole={isMaster}
                      />
                    ))}
                  </TableBody>
                </Table>
              ) : (
                <div className="py-12 text-center text-slate-500">íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤</div>
              )}
            </div>
          )}

          {/* ì´ë²¤íŠ¸ íƒ­ */}
          {activeTab === "events" && (
            <div>
              <h2 className="text-xl font-bold text-slate-900 mb-6">ì´ë²¤íŠ¸ ëª©ë¡</h2>
              {events.length > 0 ? (
                <Table>
                  <TableHeader>
                    <TableRow>
                      <TableHead>ì¸ë„¤ì¼</TableHead>
                      <TableHead>ì œëª©</TableHead>
                      <TableHead>ì¼ì‹œ</TableHead>
                      <TableHead>í˜¸ìŠ¤íŠ¸</TableHead>
                      <TableHead>ì°¸ì—¬ì¸ì›</TableHead>
                      <TableHead>ìƒíƒœ</TableHead>
                      <TableHead className="text-right">ê´€ë¦¬</TableHead>
                    </TableRow>
                  </TableHeader>
                  <TableBody>
                    {events.map((event) => {
                      const eventDate = new Date(event.event_date)
                      const isPast = eventDate < new Date()
                      const status = isPast ? "ì¢…ë£Œ" : "ì˜ˆì •"

                      return (
                        <TableRow key={event.id}>
                          <TableCell>
                            <div className="relative h-12 w-12 overflow-hidden rounded-lg bg-slate-100">
                              {event.thumbnail_url ? (
                                <Image
                                  src={event.thumbnail_url}
                                  alt={event.title}
                                  width={48}
                                  height={48}
                                  className="object-cover h-full w-full"
                                />
                              ) : (
                                <div className="flex h-full w-full items-center justify-center text-slate-400">
                                  <Calendar className="h-5 w-5" />
                                </div>
                              )}
                            </div>
                          </TableCell>
                          <TableCell>
                            <div className="font-medium text-slate-900">{event.title}</div>
                          </TableCell>
                          <TableCell>
                            <div className="text-sm text-slate-600">{formatDate(event.event_date)}</div>
                            <div className="text-xs text-slate-500">{event.location}</div>
                          </TableCell>
                          <TableCell>
                            <div className="text-sm text-slate-600">
                              {event.profiles?.full_name || "ì•Œ ìˆ˜ ì—†ìŒ"}
                            </div>
                          </TableCell>
                          <TableCell>
                            <div className="text-sm text-slate-600">
                              {event.participantCount}
                              {event.max_participants ? ` / ${event.max_participants}` : ""}ëª…
                            </div>
                          </TableCell>
                          <TableCell>
                            <span
                              className={cn(
                                "inline-flex items-center px-2 py-1 rounded-full text-xs font-medium",
                                isPast
                                  ? "bg-slate-100 text-slate-700"
                                  : "bg-green-50 text-green-700"
                              )}
                            >
                              {status}
                            </span>
                          </TableCell>
                          <TableCell className="text-right">
                            <DeleteEventButton eventId={event.id} />
                          </TableCell>
                        </TableRow>
                      )
                    })}
                  </TableBody>
                </Table>
              ) : (
                <div className="py-12 text-center text-slate-500">ë“±ë¡ëœ ì´ë²¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤</div>
              )}
            </div>
          )}

          {/* ê²Œì‹œíŒ ê´€ë¦¬ íƒ­ */}
          {activeTab === "posts" && (
            <div>
              <h2 className="text-xl font-bold text-slate-900 mb-6">ê²Œì‹œíŒ ê´€ë¦¬</h2>
              <Tabs defaultValue="all" className="w-full">
                <TabsList className="grid w-full max-w-2xl grid-cols-5 mb-6">
                  <TabsTrigger value="all">ì „ì²´</TabsTrigger>
                  <TabsTrigger value="free">ììœ ê²Œì‹œíŒ</TabsTrigger>
                  <TabsTrigger value="insights">ì¸ì‚¬ì´íŠ¸</TabsTrigger>
                  <TabsTrigger value="partners">íŒŒíŠ¸ë„ˆìŠ¤</TabsTrigger>
                  <TabsTrigger value="announcement">ê³µì§€ì‚¬í•­</TabsTrigger>
                </TabsList>

                <TabsContent value="all" className="mt-0">
                  <PostManagementTab
                    boardType="all"
                    initialPosts={posts}
                    initialCategories={categories}
                  />
                </TabsContent>

                <TabsContent value="free" className="mt-0">
                  <PostManagementTab
                    boardType="free"
                    initialPosts={posts.filter(p =>
                      p.board_categories?.slug === "free" || p.board_categories?.slug === "free-board"
                    )}
                    initialCategories={categories}
                  />
                </TabsContent>

                <TabsContent value="insights" className="mt-0">
                  <PostManagementTab
                    boardType="insights"
                    initialPosts={posts.filter(p => p.board_categories?.slug === "insights")}
                    initialCategories={categories.filter(c => c.type === "insight")}
                  />
                </TabsContent>

                <TabsContent value="partners" className="mt-0">
                  <PostManagementTab
                    boardType="partners"
                    initialPosts={posts.filter(p => p.board_categories?.slug === "partners")}
                    initialCategories={categories.filter(c => c.type === "partner")}
                  />
                </TabsContent>

                <TabsContent value="announcement" className="mt-0">
                  <PostManagementTab
                    boardType="announcement"
                    initialPosts={posts.filter(p =>
                      p.board_categories?.slug === "announcement" ||
                      p.board_categories?.slug === "announcements"
                    )}
                    initialCategories={categories}
                  />
                </TabsContent>
              </Tabs>
            </div>
          )}

          {/* ë±ƒì§€ ê´€ë¦¬ íƒ­ */}
          {activeTab === "badges" && (
            <BadgeManagementTab 
              badges={badges} 
              pendingBadges={pendingBadges}
              badgeCategories={badgeCategories}
            />
          )}

          {/* íŒŒíŠ¸ë„ˆìŠ¤ ì‹ ì²­ ê´€ë¦¬ íƒ­ */}
          {activeTab === "partner-applications" && (
            <PartnerApplicationsTab 
              applications={partnerApplications}
            />
          )}
        </div>
      </div>

      {/* ê²Œì‹œê¸€ ì‚­ì œ í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ */}
      <AlertDialog open={showDeleteDialog} onOpenChange={setShowDeleteDialog}>
        <AlertDialogContent className="bg-white z-[100]">
          <AlertDialogHeader>
            <AlertDialogTitle>ê²Œì‹œê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</AlertDialogTitle>
            <AlertDialogDescription>
              ì´ ì‘ì—…ì€ ì·¨ì†Œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê²Œì‹œê¸€ê³¼ ëª¨ë“  ëŒ“ê¸€ì´ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤.
            </AlertDialogDescription>
          </AlertDialogHeader>
          <AlertDialogFooter>
            <AlertDialogCancel>ì·¨ì†Œ</AlertDialogCancel>
            <AlertDialogAction onClick={handleDeletePost} disabled={isDeleting} className="bg-red-600 hover:bg-red-700">
              {isDeleting ? "ì‚­ì œ ì¤‘..." : "ì‚­ì œ"}
            </AlertDialogAction>
          </AlertDialogFooter>
        </AlertDialogContent>
      </AlertDialog>
    </>
  )
}
</file>

<file path="components/admin/category-management-tab.tsx">
"use client"

import { useState, useEffect } from "react"
import { createClient } from "@/lib/supabase/client"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { Trash2, Plus, Loader2 } from "lucide-react"
import {
  AlertDialog,
  AlertDialogAction,
  AlertDialogCancel,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogTitle,
} from "@/components/ui/alert-dialog"

type Category = {
  id: string
  name: string
  type: "insight" | "partner"
  created_at: string
}

type CategoryManagementTabProps = {
  initialCategories?: Category[]
}

export function CategoryManagementTab({ initialCategories = [] }: CategoryManagementTabProps) {
  const [activeType, setActiveType] = useState<"insight" | "partner">("insight")
  const [categories, setCategories] = useState<Category[]>(initialCategories)
  const [newCategoryName, setNewCategoryName] = useState("")
  const [isAdding, setIsAdding] = useState(false)
  const [deletingId, setDeletingId] = useState<string | null>(null)
  const [isDeleting, setIsDeleting] = useState(false)
  const supabase = createClient()

  // íƒ€ì…ë³„ ì¹´í…Œê³ ë¦¬ í•„í„°ë§
  const filteredCategories = categories.filter(cat => cat.type === activeType)

  // ì¹´í…Œê³ ë¦¬ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
  const refreshCategories = async () => {
    const { data, error } = await supabase
      .from("categories")
      .select("*")
      .order("created_at", { ascending: true })

    if (!error && data) {
      setCategories(data)
    } else if (error) {
      console.error("ì¹´í…Œê³ ë¦¬ ë¡œë“œ ì‹¤íŒ¨:", error)
    }
  }

  // ì»´í¬ë„ŒíŠ¸ ë§ˆìš´íŠ¸ ì‹œ ì¹´í…Œê³ ë¦¬ ìƒˆë¡œê³ ì¹¨
  useEffect(() => {
    const loadCategories = async () => {
      const { data, error } = await supabase
        .from("categories")
        .select("*")
        .order("created_at", { ascending: true })

      if (!error && data) {
        setCategories(data)
      } else if (error) {
        console.error("ì¹´í…Œê³ ë¦¬ ë¡œë“œ ì‹¤íŒ¨:", error)
      }
    }
    loadCategories()
  }, [])

  // ì¹´í…Œê³ ë¦¬ ì¶”ê°€
  const handleAddCategory = async () => {
    if (!newCategoryName.trim()) return

    setIsAdding(true)
    try {
      const { data, error } = await supabase
        .from("categories")
        .insert({
          name: newCategoryName.trim(),
          type: activeType,
        })
        .select()
        .single()

      if (error) throw error

      setCategories([...categories, data])
      setNewCategoryName("")
    } catch (error) {
      console.error("ì¹´í…Œê³ ë¦¬ ì¶”ê°€ ì‹¤íŒ¨:", error)
      alert("ì¹´í…Œê³ ë¦¬ ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")
    } finally {
      setIsAdding(false)
    }
  }

  // ì¹´í…Œê³ ë¦¬ ì‚­ì œ
  const handleDeleteCategory = async () => {
    if (!deletingId) return

    setIsDeleting(true)
    try {
      const { error } = await supabase
        .from("categories")
        .delete()
        .eq("id", deletingId)

      if (error) throw error

      setCategories(categories.filter(cat => cat.id !== deletingId))
      setDeletingId(null)
    } catch (error) {
      console.error("ì¹´í…Œê³ ë¦¬ ì‚­ì œ ì‹¤íŒ¨:", error)
      alert("ì¹´í…Œê³ ë¦¬ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")
    } finally {
      setIsDeleting(false)
    }
  }

  return (
    <div>
      <h2 className="text-xl font-bold text-slate-900 mb-6">ì¹´í…Œê³ ë¦¬ ê´€ë¦¬</h2>

      {/* íƒ­ ë²„íŠ¼ */}
      <div className="flex gap-2 mb-6 border-b border-slate-200">
        <button
          onClick={() => setActiveType("insight")}
          className={`px-4 py-2 font-medium transition-colors ${
            activeType === "insight"
              ? "border-b-2 border-slate-900 text-slate-900"
              : "text-slate-500 hover:text-slate-700"
          }`}
        >
          ì¸ì‚¬ì´íŠ¸ ì¹´í…Œê³ ë¦¬
        </button>
        <button
          onClick={() => setActiveType("partner")}
          className={`px-4 py-2 font-medium transition-colors ${
            activeType === "partner"
              ? "border-b-2 border-slate-900 text-slate-900"
              : "text-slate-500 hover:text-slate-700"
          }`}
        >
          íŒŒíŠ¸ë„ˆìŠ¤ ì¹´í…Œê³ ë¦¬
        </button>
      </div>

      {/* ì¹´í…Œê³ ë¦¬ ì¶”ê°€ í¼ */}
      <div className="mb-6 flex gap-2">
        <Input
          placeholder="ìƒˆ ì¹´í…Œê³ ë¦¬ ì´ë¦„ ì…ë ¥"
          value={newCategoryName}
          onChange={(e) => setNewCategoryName(e.target.value)}
          onKeyDown={(e) => {
            if (e.key === "Enter") {
              handleAddCategory()
            }
          }}
          className="flex-1"
        />
        <Button
          onClick={handleAddCategory}
          disabled={isAdding || !newCategoryName.trim()}
          className="gap-2"
        >
          {isAdding ? (
            <>
              <Loader2 className="h-4 w-4 animate-spin" />
              ì¶”ê°€ ì¤‘...
            </>
          ) : (
            <>
              <Plus className="h-4 w-4" />
              ì¶”ê°€
            </>
          )}
        </Button>
      </div>

      {/* ì¹´í…Œê³ ë¦¬ ëª©ë¡ */}
      {filteredCategories.length > 0 ? (
        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
          {filteredCategories.map((category) => (
            <div
              key={category.id}
              className="flex items-center justify-between p-3 border border-slate-200 rounded-lg hover:bg-slate-50 transition-colors"
            >
              <span className="font-medium text-slate-900 text-sm">{category.name}</span>
              <Button
                variant="outline"
                size="sm"
                className="h-8 w-8 p-0 border-red-300 text-red-600 hover:bg-red-50 shrink-0"
                onClick={() => setDeletingId(category.id)}
              >
                <Trash2 className="h-4 w-4" />
              </Button>
            </div>
          ))}
        </div>
      ) : (
        <div className="py-12 text-center text-slate-500">
          ë“±ë¡ëœ ì¹´í…Œê³ ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤
        </div>
      )}

      {/* ì‚­ì œ í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ */}
      <AlertDialog open={!!deletingId} onOpenChange={(open) => !open && setDeletingId(null)}>
        <AlertDialogContent className="bg-white z-[100]">
          <AlertDialogHeader>
            <AlertDialogTitle>ì¹´í…Œê³ ë¦¬ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</AlertDialogTitle>
            <AlertDialogDescription>
              ì´ ì‘ì—…ì€ ì·¨ì†Œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì¹´í…Œê³ ë¦¬ê°€ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤.
            </AlertDialogDescription>
          </AlertDialogHeader>
          <AlertDialogFooter>
            <AlertDialogCancel>ì·¨ì†Œ</AlertDialogCancel>
            <AlertDialogAction
              onClick={handleDeleteCategory}
              disabled={isDeleting}
              className="bg-red-600 hover:bg-red-700"
            >
              {isDeleting ? "ì‚­ì œ ì¤‘..." : "ì‚­ì œ"}
            </AlertDialogAction>
          </AlertDialogFooter>
        </AlertDialogContent>
      </AlertDialog>
    </div>
  )
}
</file>

<file path="components/admin/partner-applications-tab.tsx">
"use client"

import { useState } from "react"
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from "@/components/ui/table"
import { Button } from "@/components/ui/button"
import { Badge } from "@/components/ui/badge"
import { CheckCircle2, XCircle, Loader2 } from "lucide-react"
import { updatePartnerApplicationStatus } from "@/lib/actions/partner-applications"
import { useRouter } from "next/navigation"
import { cn } from "@/lib/utils"

type PartnerApplication = {
  id: string
  created_at: string
  status: "pending" | "approved" | "rejected"
  company_name: string | null
  current_usage: string | null
  profiles: {
    id: string
    full_name: string | null
    email: string | null
  } | null
  partners?: {
    id: string
    name: string
  } | null
  partner_name?: string | null
}

type PartnerApplicationsTabProps = {
  applications: PartnerApplication[]
}

export function PartnerApplicationsTab({ applications }: PartnerApplicationsTabProps) {
  const router = useRouter()
  const [updatingId, setUpdatingId] = useState<string | null>(null)

  const formatDate = (dateString: string) => {
    const date = new Date(dateString)
    return date.toLocaleDateString("ko-KR", {
      year: "numeric",
      month: "2-digit",
      day: "2-digit",
    })
  }

  const getStatusBadge = (status: string) => {
    switch (status) {
      case "pending":
        return (
          <Badge className="bg-yellow-100 text-yellow-700 border-yellow-300">
            ìŠ¹ì¸ ëŒ€ê¸°
          </Badge>
        )
      case "approved":
        return (
          <Badge className="bg-green-100 text-green-700 border-green-300">
            ìŠ¹ì¸ ì™„ë£Œ
          </Badge>
        )
      case "rejected":
        return (
          <Badge className="bg-red-100 text-red-700 border-red-300">
            ë°˜ë ¤ë¨
          </Badge>
        )
      default:
        return (
          <Badge className="bg-slate-100 text-slate-700">
            {status}
          </Badge>
        )
    }
  }

  const handleApprove = async (applicationId: string) => {
    setUpdatingId(applicationId)
    try {
      await updatePartnerApplicationStatus(applicationId, "approved")
      router.refresh()
    } catch (error) {
      console.error("ìŠ¹ì¸ ì‹¤íŒ¨:", error)
      alert("ìŠ¹ì¸ ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")
    } finally {
      setUpdatingId(null)
    }
  }

  const handleReject = async (applicationId: string) => {
    setUpdatingId(applicationId)
    try {
      await updatePartnerApplicationStatus(applicationId, "rejected")
      router.refresh()
    } catch (error) {
      console.error("ë°˜ë ¤ ì‹¤íŒ¨:", error)
      alert("ë°˜ë ¤ ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")
    } finally {
      setUpdatingId(null)
    }
  }

  return (
    <div>
      <h2 className="text-xl font-bold text-slate-900 mb-6">íŒŒíŠ¸ë„ˆìŠ¤ ì‹ ì²­ ê´€ë¦¬</h2>
      {applications.length > 0 ? (
        <Table>
          <TableHeader>
            <TableRow>
              <TableHead>ì‹ ì²­ì¼</TableHead>
              <TableHead>íŒŒíŠ¸ë„ˆì‚¬</TableHead>
              <TableHead>ì‹ ì²­ì(ì´ë©”ì¼)</TableHead>
              <TableHead>íšŒì‚¬ëª…</TableHead>
              <TableHead>í˜„ì¬ ì´ìš© ì—¬ë¶€</TableHead>
              <TableHead>ìƒíƒœ</TableHead>
              <TableHead className="text-right">ê´€ë¦¬</TableHead>
            </TableRow>
          </TableHeader>
          <TableBody>
            {applications.map((application) => (
              <TableRow key={application.id}>
                <TableCell>
                  <div className="text-sm text-slate-600">
                    {formatDate(application.created_at)}
                  </div>
                </TableCell>
                <TableCell>
                  <div className="font-medium text-slate-900">
                    {application.partners?.name || application.partner_name || "íŒŒíŠ¸ë„ˆ ì •ë³´ ì—†ìŒ"}
                  </div>
                </TableCell>
                <TableCell>
                  <div className="text-sm text-slate-900">
                    {application.profiles?.full_name || "ì´ë¦„ ì—†ìŒ"}
                  </div>
                  <div className="text-xs text-slate-500">
                    {application.profiles?.email || "ì´ë©”ì¼ ì—†ìŒ"}
                  </div>
                </TableCell>
                <TableCell>
                  <div className="text-sm text-slate-600">
                    {application.company_name || "-"}
                  </div>
                </TableCell>
                <TableCell>
                  <div className="text-sm text-slate-600">
                    {application.current_usage || "-"}
                  </div>
                </TableCell>
                <TableCell>
                  {getStatusBadge(application.status)}
                </TableCell>
                <TableCell className="text-right">
                  {application.status === "pending" && (
                    <div className="flex items-center justify-end gap-2">
                      <Button
                        size="sm"
                        variant="outline"
                        className="gap-2 border-green-300 text-green-700 hover:bg-green-50"
                        onClick={() => handleApprove(application.id)}
                        disabled={updatingId === application.id}
                      >
                        {updatingId === application.id ? (
                          <>
                            <Loader2 className="h-4 w-4 animate-spin" />
                            ì²˜ë¦¬ ì¤‘...
                          </>
                        ) : (
                          <>
                            <CheckCircle2 className="h-4 w-4" />
                            ìŠ¹ì¸
                          </>
                        )}
                      </Button>
                      <Button
                        size="sm"
                        variant="outline"
                        className="gap-2 border-red-300 text-red-600 hover:bg-red-50"
                        onClick={() => handleReject(application.id)}
                        disabled={updatingId === application.id}
                      >
                        {updatingId === application.id ? (
                          <>
                            <Loader2 className="h-4 w-4 animate-spin" />
                            ì²˜ë¦¬ ì¤‘...
                          </>
                        ) : (
                          <>
                            <XCircle className="h-4 w-4" />
                            ë°˜ë ¤
                          </>
                        )}
                      </Button>
                    </div>
                  )}
                </TableCell>
              </TableRow>
            ))}
          </TableBody>
        </Table>
      ) : (
        <div className="py-12 text-center text-slate-500">
          ë“±ë¡ëœ ì‹ ì²­ì´ ì—†ìŠµë‹ˆë‹¤
        </div>
      )}
    </div>
  )
}
</file>

<file path="components/admin/partners/partner-category-tab.tsx">
"use client"

import { useState, useEffect } from "react"
import { createClient } from "@/lib/supabase/client"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { Trash2, Plus, Loader2 } from "lucide-react"
import {
  AlertDialog,
  AlertDialogAction,
  AlertDialogCancel,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogTitle,
} from "@/components/ui/alert-dialog"

type Category = {
  id: string
  name: string
  type: "insight" | "partner"
  created_at: string
}

type PartnerCategoryTabProps = {
  initialCategories?: Category[]
}

export function PartnerCategoryTab({ initialCategories = [] }: PartnerCategoryTabProps) {
  const [categories, setCategories] = useState<Category[]>(
    initialCategories.filter(cat => cat.type === "partner")
  )
  const [newCategoryName, setNewCategoryName] = useState("")
  const [isAdding, setIsAdding] = useState(false)
  const [deletingId, setDeletingId] = useState<string | null>(null)
  const [isDeleting, setIsDeleting] = useState(false)
  const supabase = createClient()

  // ì¹´í…Œê³ ë¦¬ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
  const refreshCategories = async () => {
    const { data, error } = await supabase
      .from("categories")
      .select("*")
      .eq("type", "partner")
      .order("created_at", { ascending: true })

    if (!error && data) {
      setCategories(data)
    } else if (error) {
      console.error("ì¹´í…Œê³ ë¦¬ ë¡œë“œ ì‹¤íŒ¨:", error)
    }
  }

  // ì»´í¬ë„ŒíŠ¸ ë§ˆìš´íŠ¸ ì‹œ ì¹´í…Œê³ ë¦¬ ìƒˆë¡œê³ ì¹¨
  useEffect(() => {
    refreshCategories()
  }, [])

  // ì¹´í…Œê³ ë¦¬ ì¶”ê°€
  const handleAddCategory = async () => {
    if (!newCategoryName.trim()) return

    setIsAdding(true)
    try {
      const { data, error } = await supabase
        .from("categories")
        .insert({
          name: newCategoryName.trim(),
          type: "partner",
        })
        .select()
        .single()

      if (error) throw error

      setCategories([...categories, data])
      setNewCategoryName("")
    } catch (error) {
      console.error("ì¹´í…Œê³ ë¦¬ ì¶”ê°€ ì‹¤íŒ¨:", error)
      alert("ì¹´í…Œê³ ë¦¬ ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")
    } finally {
      setIsAdding(false)
    }
  }

  // ì¹´í…Œê³ ë¦¬ ì‚­ì œ
  const handleDeleteCategory = async () => {
    if (!deletingId) return

    setIsDeleting(true)
    try {
      const { error } = await supabase
        .from("categories")
        .delete()
        .eq("id", deletingId)

      if (error) throw error

      setCategories(categories.filter(cat => cat.id !== deletingId))
      setDeletingId(null)
    } catch (error) {
      console.error("ì¹´í…Œê³ ë¦¬ ì‚­ì œ ì‹¤íŒ¨:", error)
      alert("ì¹´í…Œê³ ë¦¬ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")
    } finally {
      setIsDeleting(false)
    }
  }

  return (
    <div>
      <h2 className="text-xl font-bold text-slate-900 mb-6">íŒŒíŠ¸ë„ˆìŠ¤ ì¹´í…Œê³ ë¦¬ ê´€ë¦¬</h2>

      {/* ì¹´í…Œê³ ë¦¬ ì¶”ê°€ í¼ */}
      <div className="mb-6 flex gap-2">
        <Input
          placeholder="ìƒˆ ì¹´í…Œê³ ë¦¬ ì´ë¦„ ì…ë ¥"
          value={newCategoryName}
          onChange={(e) => setNewCategoryName(e.target.value)}
          onKeyDown={(e) => {
            if (e.key === "Enter") {
              handleAddCategory()
            }
          }}
          className="flex-1"
        />
        <Button
          onClick={handleAddCategory}
          disabled={isAdding || !newCategoryName.trim()}
          className="gap-2"
        >
          {isAdding ? (
            <>
              <Loader2 className="h-4 w-4 animate-spin" />
              ì¶”ê°€ ì¤‘...
            </>
          ) : (
            <>
              <Plus className="h-4 w-4" />
              ì¶”ê°€
            </>
          )}
        </Button>
      </div>

      {/* ì¹´í…Œê³ ë¦¬ ëª©ë¡ */}
      {categories.length > 0 ? (
        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
          {categories.map((category) => (
            <div
              key={category.id}
              className="flex items-center justify-between p-3 border border-slate-200 rounded-lg hover:bg-slate-50 transition-colors"
            >
              <span className="font-medium text-slate-900 text-sm">{category.name}</span>
              <Button
                variant="outline"
                size="sm"
                className="h-8 w-8 p-0 border-red-300 text-red-600 hover:bg-red-50 shrink-0"
                onClick={() => setDeletingId(category.id)}
              >
                <Trash2 className="h-4 w-4" />
              </Button>
            </div>
          ))}
        </div>
      ) : (
        <div className="py-12 text-center text-slate-500">
          ë“±ë¡ëœ ì¹´í…Œê³ ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤
        </div>
      )}

      {/* ì‚­ì œ í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ */}
      <AlertDialog open={!!deletingId} onOpenChange={(open) => !open && setDeletingId(null)}>
        <AlertDialogContent className="bg-white z-[100]">
          <AlertDialogHeader>
            <AlertDialogTitle>ì¹´í…Œê³ ë¦¬ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</AlertDialogTitle>
            <AlertDialogDescription>
              ì´ ì‘ì—…ì€ ì·¨ì†Œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì¹´í…Œê³ ë¦¬ê°€ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤.
            </AlertDialogDescription>
          </AlertDialogHeader>
          <AlertDialogFooter>
            <AlertDialogCancel>ì·¨ì†Œ</AlertDialogCancel>
            <AlertDialogAction
              onClick={handleDeleteCategory}
              disabled={isDeleting}
              className="bg-red-600 hover:bg-red-700"
            >
              {isDeleting ? "ì‚­ì œ ì¤‘..." : "ì‚­ì œ"}
            </AlertDialogAction>
          </AlertDialogFooter>
        </AlertDialogContent>
      </AlertDialog>
    </div>
  )
}
</file>

<file path="components/admin/partners/partner-list-tab.tsx">
"use client"

import { useState, useEffect } from "react"
import { createClient } from "@/lib/supabase/client"
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from "@/components/ui/table"
import { Button } from "@/components/ui/button"
import { Badge } from "@/components/ui/badge"
import { Input } from "@/components/ui/input"
import { Textarea } from "@/components/ui/textarea"
import { Label } from "@/components/ui/label"
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "@/components/ui/select"
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogTitle,
} from "@/components/ui/dialog"
import {
  AlertDialog,
  AlertDialogAction,
  AlertDialogCancel,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogTitle,
} from "@/components/ui/alert-dialog"
import { Plus, Pencil, Trash2, Loader2, CheckCircle2 } from "lucide-react"
import { useRouter } from "next/navigation"

type PartnerService = {
  id: string
  title: string
  description: string
  category: string
  thumbnail_url: string | null
  is_verified: boolean
  created_at: string
  profiles?: {
    id: string
    full_name: string | null
  } | null
}

type Category = {
  id: string
  name: string
  type: "insight" | "partner"
}

type PartnerListTabProps = {
  initialServices?: PartnerService[]
  initialCategories?: Category[]
}

export function PartnerListTab({ initialServices = [], initialCategories = [] }: PartnerListTabProps) {
  const router = useRouter()
  const supabase = createClient()
  const [services, setServices] = useState<PartnerService[]>(initialServices)
  const [categories, setCategories] = useState<Category[]>(initialCategories)
  const [isDialogOpen, setIsDialogOpen] = useState(false)
  const [isDeleting, setIsDeleting] = useState(false)
  const [deletingId, setDeletingId] = useState<string | null>(null)
  const [isSaving, setIsSaving] = useState(false)
  const [editingService, setEditingService] = useState<PartnerService | null>(null)

  // í¼ ìƒíƒœ
  const [formData, setFormData] = useState({
    title: "",
    description: "",
    category: "",
    thumbnail_url: "",
    is_verified: false,
  })

  // ì¹´í…Œê³ ë¦¬ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
  useEffect(() => {
    const loadCategories = async () => {
      const { data } = await supabase
        .from("categories")
        .select("id, name, type")
        .eq("type", "partner")
        .order("created_at", { ascending: true })

      if (data) {
        setCategories(data)
      }
    }
    loadCategories()
  }, [])

  // ì„œë¹„ìŠ¤ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
  const refreshServices = async () => {
    const { data } = await supabase
      .from("partner_services")
      .select(`
        *,
        profiles:provider_id (
          id,
          full_name
        )
      `)
      .order("is_verified", { ascending: false })
      .order("created_at", { ascending: false })

    if (data) {
      setServices(data)
    }
  }

  // ìƒˆ íŒŒíŠ¸ë„ˆ ë“±ë¡ ëª¨ë‹¬ ì—´ê¸°
  const handleNewPartner = () => {
    setEditingService(null)
    setFormData({
      title: "",
      description: "",
      category: "",
      thumbnail_url: "",
      is_verified: false,
    })
    setIsDialogOpen(true)
  }

  // íŒŒíŠ¸ë„ˆ ìˆ˜ì • ëª¨ë‹¬ ì—´ê¸°
  const handleEditPartner = (service: PartnerService) => {
    setEditingService(service)
    setFormData({
      title: service.title,
      description: service.description,
      category: service.category,
      thumbnail_url: service.thumbnail_url || "",
      is_verified: service.is_verified,
    })
    setIsDialogOpen(true)
  }

  // íŒŒíŠ¸ë„ˆ ì €ì¥
  const handleSave = async () => {
    if (!formData.title.trim() || !formData.description.trim() || !formData.category) {
      alert("ì œëª©, ì„¤ëª…, ì¹´í…Œê³ ë¦¬ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.")
      return
    }

    setIsSaving(true)
    try {
      const { data: { user } } = await supabase.auth.getUser()
      if (!user) {
        throw new Error("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.")
      }

      if (editingService) {
        // ìˆ˜ì •
        const { error } = await supabase
          .from("partner_services")
          .update({
            title: formData.title.trim(),
            description: formData.description.trim(),
            category: formData.category,
            thumbnail_url: formData.thumbnail_url || null,
            is_verified: formData.is_verified,
          })
          .eq("id", editingService.id)

        if (error) throw error
      } else {
        // ìƒì„±
        const { error } = await supabase
          .from("partner_services")
          .insert({
            title: formData.title.trim(),
            description: formData.description.trim(),
            category: formData.category,
            thumbnail_url: formData.thumbnail_url || null,
            is_verified: formData.is_verified,
            provider_id: user.id,
          })

        if (error) throw error
      }

      setIsDialogOpen(false)
      refreshServices()
      router.refresh()
    } catch (error) {
      console.error("íŒŒíŠ¸ë„ˆ ì €ì¥ ì‹¤íŒ¨:", error)
      alert(error instanceof Error ? error.message : "íŒŒíŠ¸ë„ˆ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")
    } finally {
      setIsSaving(false)
    }
  }

  // íŒŒíŠ¸ë„ˆ ì‚­ì œ
  const handleDelete = async () => {
    if (!deletingId) return

    setIsDeleting(true)
    try {
      const { error } = await supabase
        .from("partner_services")
        .delete()
        .eq("id", deletingId)

      if (error) throw error

      setServices(services.filter(s => s.id !== deletingId))
      setDeletingId(null)
      router.refresh()
    } catch (error) {
      console.error("íŒŒíŠ¸ë„ˆ ì‚­ì œ ì‹¤íŒ¨:", error)
      alert("íŒŒíŠ¸ë„ˆ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")
    } finally {
      setIsDeleting(false)
    }
  }

  const formatDate = (dateString: string) => {
    const date = new Date(dateString)
    return date.toLocaleDateString("ko-KR", {
      year: "numeric",
      month: "2-digit",
      day: "2-digit",
    })
  }

  return (
    <div>
      <div className="flex items-center justify-between mb-6">
        <h2 className="text-xl font-bold text-slate-900">ì œíœ´ ì—…ì²´ ëª©ë¡</h2>
        <Button onClick={handleNewPartner} className="gap-2">
          <Plus className="h-4 w-4" />
          ìƒˆ íŒŒíŠ¸ë„ˆ ë“±ë¡
        </Button>
      </div>

      {services.length > 0 ? (
        <Table>
          <TableHeader>
            <TableRow>
              <TableHead>ì œëª©</TableHead>
              <TableHead>ì¹´í…Œê³ ë¦¬</TableHead>
              <TableHead>ì œê³µì</TableHead>
              <TableHead>ì¸ì¦ ìƒíƒœ</TableHead>
              <TableHead>ë“±ë¡ì¼</TableHead>
              <TableHead className="text-right">ê´€ë¦¬</TableHead>
            </TableRow>
          </TableHeader>
          <TableBody>
            {services.map((service) => (
              <TableRow key={service.id}>
                <TableCell>
                  <div className="font-medium text-slate-900">{service.title}</div>
                  <div className="text-sm text-slate-500 line-clamp-1 mt-1">
                    {service.description}
                  </div>
                </TableCell>
                <TableCell>
                  <Badge variant="secondary">{service.category}</Badge>
                </TableCell>
                <TableCell>
                  <div className="text-sm text-slate-600">
                    {service.profiles?.full_name || "ì•Œ ìˆ˜ ì—†ìŒ"}
                  </div>
                </TableCell>
                <TableCell>
                  {service.is_verified ? (
                    <Badge className="bg-green-100 text-green-700 border-green-300">
                      <CheckCircle2 className="h-3 w-3 mr-1" />
                      ì¸ì¦ë¨
                    </Badge>
                  ) : (
                    <Badge variant="outline">ë¯¸ì¸ì¦</Badge>
                  )}
                </TableCell>
                <TableCell>
                  <div className="text-sm text-slate-600">
                    {formatDate(service.created_at)}
                  </div>
                </TableCell>
                <TableCell className="text-right">
                  <div className="flex items-center justify-end gap-2">
                    <Button
                      size="sm"
                      variant="outline"
                      onClick={() => handleEditPartner(service)}
                    >
                      <Pencil className="h-4 w-4" />
                    </Button>
                    <Button
                      size="sm"
                      variant="outline"
                      className="border-red-300 text-red-600 hover:bg-red-50"
                      onClick={() => setDeletingId(service.id)}
                    >
                      <Trash2 className="h-4 w-4" />
                    </Button>
                  </div>
                </TableCell>
              </TableRow>
            ))}
          </TableBody>
        </Table>
      ) : (
        <div className="py-12 text-center text-slate-500">
          ë“±ë¡ëœ íŒŒíŠ¸ë„ˆê°€ ì—†ìŠµë‹ˆë‹¤
        </div>
      )}

      {/* íŒŒíŠ¸ë„ˆ ë“±ë¡/ìˆ˜ì • ë‹¤ì´ì–¼ë¡œê·¸ */}
      <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>
        <DialogContent className="max-w-2xl max-h-[90vh] overflow-y-auto">
          <DialogHeader>
            <DialogTitle>
              {editingService ? "íŒŒíŠ¸ë„ˆ ìˆ˜ì •" : "ìƒˆ íŒŒíŠ¸ë„ˆ ë“±ë¡"}
            </DialogTitle>
            <DialogDescription>
              ì œíœ´ ì—…ì²´ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.
            </DialogDescription>
          </DialogHeader>

          <div className="space-y-4">
            <div className="space-y-2">
              <Label htmlFor="title">ì œëª© *</Label>
              <Input
                id="title"
                value={formData.title}
                onChange={(e) => setFormData({ ...formData, title: e.target.value })}
                placeholder="íŒŒíŠ¸ë„ˆ ì„œë¹„ìŠ¤ ì œëª©"
              />
            </div>

            <div className="space-y-2">
              <Label htmlFor="category">ì¹´í…Œê³ ë¦¬ *</Label>
              <Select
                value={formData.category}
                onValueChange={(value) => setFormData({ ...formData, category: value })}
              >
                <SelectTrigger id="category">
                  <SelectValue placeholder="ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ì„¸ìš”" />
                </SelectTrigger>
                <SelectContent>
                  {categories.map((cat) => (
                    <SelectItem key={cat.id} value={cat.name}>
                      {cat.name}
                    </SelectItem>
                  ))}
                </SelectContent>
              </Select>
            </div>

            <div className="space-y-2">
              <Label htmlFor="description">ì„¤ëª… *</Label>
              <Textarea
                id="description"
                value={formData.description}
                onChange={(e) => setFormData({ ...formData, description: e.target.value })}
                placeholder="ì„œë¹„ìŠ¤ì— ëŒ€í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"
                rows={5}
              />
            </div>

            <div className="space-y-2">
              <Label htmlFor="thumbnail_url">ì¸ë„¤ì¼ URL</Label>
              <Input
                id="thumbnail_url"
                value={formData.thumbnail_url}
                onChange={(e) => setFormData({ ...formData, thumbnail_url: e.target.value })}
                placeholder="https://example.com/image.jpg"
              />
            </div>

            <div className="flex items-center space-x-2">
              <input
                type="checkbox"
                id="is_verified"
                checked={formData.is_verified}
                onChange={(e) => setFormData({ ...formData, is_verified: e.target.checked })}
                className="rounded border-slate-300"
              />
              <Label htmlFor="is_verified" className="cursor-pointer">
                SFC ì¸ì¦ íŒŒíŠ¸ë„ˆë¡œ í‘œì‹œ
              </Label>
            </div>
          </div>

          <DialogFooter>
            <Button variant="outline" onClick={() => setIsDialogOpen(false)}>
              ì·¨ì†Œ
            </Button>
            <Button onClick={handleSave} disabled={isSaving}>
              {isSaving ? (
                <>
                  <Loader2 className="mr-2 h-4 w-4 animate-spin" />
                  ì €ì¥ ì¤‘...
                </>
              ) : (
                "ì €ì¥"
              )}
            </Button>
          </DialogFooter>
        </DialogContent>
      </Dialog>

      {/* ì‚­ì œ í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ */}
      <AlertDialog open={!!deletingId} onOpenChange={(open) => !open && setDeletingId(null)}>
        <AlertDialogContent>
          <AlertDialogHeader>
            <AlertDialogTitle>íŒŒíŠ¸ë„ˆë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</AlertDialogTitle>
            <AlertDialogDescription>
              ì´ ì‘ì—…ì€ ì·¨ì†Œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. íŒŒíŠ¸ë„ˆ ì •ë³´ê°€ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤.
            </AlertDialogDescription>
          </AlertDialogHeader>
          <AlertDialogFooter>
            <AlertDialogCancel>ì·¨ì†Œ</AlertDialogCancel>
            <AlertDialogAction
              onClick={handleDelete}
              disabled={isDeleting}
              className="bg-red-600 hover:bg-red-700"
            >
              {isDeleting ? (
                <>
                  <Loader2 className="mr-2 h-4 w-4 animate-spin" />
                  ì‚­ì œ ì¤‘...
                </>
              ) : (
                "ì‚­ì œ"
              )}
            </AlertDialogAction>
          </AlertDialogFooter>
        </AlertDialogContent>
      </AlertDialog>
    </div>
  )
}
</file>

<file path="components/admin/posts/partner-category-tab-simple.tsx">
"use client"

import { useState, useEffect } from "react"
import { createClient } from "@/lib/supabase/client"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { Trash2, Plus, Loader2 } from "lucide-react"
import {
  AlertDialog,
  AlertDialogAction,
  AlertDialogCancel,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogTitle,
} from "@/components/ui/alert-dialog"

type Category = {
  id: string
  name: string
  type: "insight" | "partner"
  created_at: string
}

type PartnerCategoryTabProps = {
  initialCategories?: Category[]
  categoryType: "insight" | "partner"
}

export function PartnerCategoryTab({ initialCategories = [], categoryType }: PartnerCategoryTabProps) {
  const [categories, setCategories] = useState<Category[]>(
    initialCategories.filter(cat => cat.type === categoryType)
  )
  const [newCategoryName, setNewCategoryName] = useState("")
  const [isAdding, setIsAdding] = useState(false)
  const [deletingId, setDeletingId] = useState<string | null>(null)
  const [isDeleting, setIsDeleting] = useState(false)
  const supabase = createClient()

  // ì¹´í…Œê³ ë¦¬ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
  const refreshCategories = async () => {
    const { data, error } = await supabase
      .from("categories")
      .select("*")
      .eq("type", categoryType)
      .order("created_at", { ascending: true })

    if (!error && data) {
      setCategories(data)
    } else if (error) {
      console.error("ì¹´í…Œê³ ë¦¬ ë¡œë“œ ì‹¤íŒ¨:", error)
    }
  }

  // ì»´í¬ë„ŒíŠ¸ ë§ˆìš´íŠ¸ ì‹œ ì¹´í…Œê³ ë¦¬ ìƒˆë¡œê³ ì¹¨
  useEffect(() => {
    refreshCategories()
  }, [categoryType])

  // ì¹´í…Œê³ ë¦¬ ì¶”ê°€
  const handleAddCategory = async () => {
    if (!newCategoryName.trim()) return

    setIsAdding(true)
    try {
      const { data, error } = await supabase
        .from("categories")
        .insert({
          name: newCategoryName.trim(),
          type: categoryType,
        })
        .select()
        .single()

      if (error) throw error

      setCategories([...categories, data])
      setNewCategoryName("")
    } catch (error) {
      console.error("ì¹´í…Œê³ ë¦¬ ì¶”ê°€ ì‹¤íŒ¨:", error)
      alert("ì¹´í…Œê³ ë¦¬ ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")
    } finally {
      setIsAdding(false)
    }
  }

  // ì¹´í…Œê³ ë¦¬ ì‚­ì œ
  const handleDeleteCategory = async () => {
    if (!deletingId) return

    setIsDeleting(true)
    try {
      const { error } = await supabase
        .from("categories")
        .delete()
        .eq("id", deletingId)

      if (error) throw error

      setCategories(categories.filter(cat => cat.id !== deletingId))
      setDeletingId(null)
    } catch (error) {
      console.error("ì¹´í…Œê³ ë¦¬ ì‚­ì œ ì‹¤íŒ¨:", error)
      alert("ì¹´í…Œê³ ë¦¬ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")
    } finally {
      setIsDeleting(false)
    }
  }

  return (
    <div>
      {/* ì¹´í…Œê³ ë¦¬ ì¶”ê°€ í¼ */}
      <div className="mb-6 flex gap-2">
        <Input
          placeholder="ìƒˆ ì¹´í…Œê³ ë¦¬ ì´ë¦„ ì…ë ¥"
          value={newCategoryName}
          onChange={(e) => setNewCategoryName(e.target.value)}
          onKeyDown={(e) => {
            if (e.key === "Enter") {
              handleAddCategory()
            }
          }}
          className="flex-1"
        />
        <Button
          onClick={handleAddCategory}
          disabled={isAdding || !newCategoryName.trim()}
          className="gap-2"
        >
          {isAdding ? (
            <>
              <Loader2 className="h-4 w-4 animate-spin" />
              ì¶”ê°€ ì¤‘...
            </>
          ) : (
            <>
              <Plus className="h-4 w-4" />
              ì¶”ê°€
            </>
          )}
        </Button>
      </div>

      {/* ì¹´í…Œê³ ë¦¬ ëª©ë¡ */}
      {categories.length > 0 ? (
        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
          {categories.map((category) => (
            <div
              key={category.id}
              className="flex items-center justify-between p-3 border border-slate-200 rounded-lg hover:bg-slate-50 transition-colors"
            >
              <span className="font-medium text-slate-900 text-sm">{category.name}</span>
              <Button
                variant="outline"
                size="sm"
                className="h-8 w-8 p-0 border-red-300 text-red-600 hover:bg-red-50 shrink-0"
                onClick={() => setDeletingId(category.id)}
              >
                <Trash2 className="h-4 w-4" />
              </Button>
            </div>
          ))}
        </div>
      ) : (
        <div className="py-8 text-center text-slate-500">
          ë“±ë¡ëœ ì¹´í…Œê³ ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤
        </div>
      )}

      {/* ì‚­ì œ í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ */}
      <AlertDialog open={!!deletingId} onOpenChange={(open) => !open && setDeletingId(null)}>
        <AlertDialogContent className="bg-white z-[100]">
          <AlertDialogHeader>
            <AlertDialogTitle>ì¹´í…Œê³ ë¦¬ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</AlertDialogTitle>
            <AlertDialogDescription>
              ì´ ì‘ì—…ì€ ì·¨ì†Œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì¹´í…Œê³ ë¦¬ê°€ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤.
            </AlertDialogDescription>
          </AlertDialogHeader>
          <AlertDialogFooter>
            <AlertDialogCancel>ì·¨ì†Œ</AlertDialogCancel>
            <AlertDialogAction
              onClick={handleDeleteCategory}
              disabled={isDeleting}
              className="bg-red-600 hover:bg-red-700"
            >
              {isDeleting ? "ì‚­ì œ ì¤‘..." : "ì‚­ì œ"}
            </AlertDialogAction>
          </AlertDialogFooter>
        </AlertDialogContent>
      </AlertDialog>
    </div>
  )
}
</file>

<file path="components/admin/posts/post-management-tab.tsx">
"use client"

import { useState, useEffect } from "react"
import { createClient } from "@/lib/supabase/client"
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from "@/components/ui/table"
import { Button } from "@/components/ui/button"
import { Badge } from "@/components/ui/badge"
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "@/components/ui/select"
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuSeparator,
  DropdownMenuTrigger,
} from "@/components/ui/dropdown-menu"
import {
  AlertDialog,
  AlertDialogAction,
  AlertDialogCancel,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogTitle,
} from "@/components/ui/alert-dialog"
import { Separator } from "@/components/ui/separator"
import { Eye, MoreVertical, Trash2, EyeOff, MoveRight, Loader2 } from "lucide-react"
import Link from "next/link"
import { useRouter } from "next/navigation"
import { PartnerCategoryTab } from "./partner-category-tab-simple"
import { cn } from "@/lib/utils"

type Post = {
  id: string
  title: string
  created_at: string
  visibility?: string | null
  board_categories?: {
    id: string
    name: string | null
    slug: string | null
  } | null
  profiles?: {
    id: string
    full_name: string | null
  } | null
}

type Category = {
  id: string
  name: string
  type: "insight" | "partner"
  created_at?: string | null
}

type PostManagementTabProps = {
  boardType: "all" | "free" | "insights" | "partners" | "announcement"
  initialPosts?: Post[]
  initialCategories?: Category[]
}

// ê²Œì‹œíŒ íƒ€ì…ë³„ slug ë§¤í•‘
const BOARD_TYPE_SLUGS: Record<string, string[]> = {
  all: [],
  free: ["free", "free-board"],
  insights: ["insights"],
  partners: ["partners"],
  announcement: ["announcement", "announcements"],
}

// ì¹´í…Œê³ ë¦¬ê°€ í•„ìš”í•œ ê²Œì‹œíŒ íƒ€ì…
const CATEGORY_REQUIRED_BOARDS = ["insights", "partners"]

export function PostManagementTab({
  boardType,
  initialPosts = [],
  initialCategories = [],
}: PostManagementTabProps) {
  const router = useRouter()
  const supabase = createClient()
  const [posts, setPosts] = useState<Post[]>(initialPosts)
  const [categories, setCategories] = useState<Category[]>(initialCategories)
  const [selectedCategory, setSelectedCategory] = useState<string>("all")
  const [isDeleting, setIsDeleting] = useState(false)
  const [deletingId, setDeletingId] = useState<string | null>(null)
  const [isHiding, setIsHiding] = useState(false)
  const [hidingId, setHidingId] = useState<string | null>(null)

  // boardTypeì— ë”°ë¼ í•„í„°ë§ëœ ì¹´í…Œê³ ë¦¬
  const filteredCategories = categories.filter(cat => {
    if (boardType === "insights") {
      return cat.type === "insight"
    } else if (boardType === "partners") {
      return cat.type === "partner"
    }
    return false
  })

  // ì¹´í…Œê³ ë¦¬ í•„í„°ê°€ í•„ìš”í•œ ê²Œì‹œíŒì¸ì§€ í™•ì¸
  const showCategoryFilter = CATEGORY_REQUIRED_BOARDS.includes(boardType) && filteredCategories.length > 0

  // ì¹´í…Œê³ ë¦¬ í•„í„°ë§ëœ ê²Œì‹œê¸€
  const filteredPosts = selectedCategory === "all"
    ? posts
    : posts.filter(post => {
        // ê²Œì‹œê¸€ì˜ ì¹´í…Œê³ ë¦¬ ì •ë³´ê°€ ìˆëŠ” ê²½ìš° (ì¶”í›„ í™•ì¥ ê°€ëŠ¥)
        return true // í˜„ì¬ëŠ” ëª¨ë“  ê²Œì‹œê¸€ í‘œì‹œ
      })

  // ì¹´í…Œê³ ë¦¬ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
  useEffect(() => {
    if (CATEGORY_REQUIRED_BOARDS.includes(boardType)) {
      const loadCategories = async () => {
        const categoryType = boardType === "insights" ? "insight" : "partner"
        const { data } = await supabase
          .from("categories")
          .select("id, name, type")
          .eq("type", categoryType)
          .order("created_at", { ascending: true })

        if (data) {
          setCategories(data)
        }
      }
      loadCategories()
    }
  }, [boardType])

  // boardType ë³€ê²½ ì‹œ selectedCategory ì´ˆê¸°í™”
  useEffect(() => {
    setSelectedCategory("all")
  }, [boardType])

  // ê²Œì‹œê¸€ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
  const refreshPosts = async () => {
    const slugs = BOARD_TYPE_SLUGS[boardType] || []
    let query = supabase
      .from("posts")
      .select(`
        id,
        title,
        created_at,
        visibility,
        board_categories:board_category_id (
          id,
          name,
          slug
        ),
        profiles:author_id (
          id,
          full_name
        )
      `)
      .order("created_at", { ascending: false })

    if (boardType !== "all" && slugs.length > 0) {
      query = query.in("board_categories.slug", slugs)
    }

    const { data } = await query
    if (data) {
      const normalized = data.map((post: any) => {
        const category = Array.isArray(post.board_categories) ? post.board_categories[0] : post.board_categories
        const profile = Array.isArray(post.profiles) ? post.profiles[0] : post.profiles
        return { ...post, board_categories: category, profiles: profile }
      })
      setPosts(normalized)
    }
  }

  // ê²Œì‹œê¸€ ì‚­ì œ
  const handleDelete = async () => {
    if (!deletingId) return

    setIsDeleting(true)
    try {
      const { error } = await supabase
        .from("posts")
        .delete()
        .eq("id", deletingId)

      if (error) throw error

      setPosts(posts.filter(p => p.id !== deletingId))
      setDeletingId(null)
      router.refresh()
    } catch (error) {
      console.error("ê²Œì‹œê¸€ ì‚­ì œ ì‹¤íŒ¨:", error)
      alert("ê²Œì‹œê¸€ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")
    } finally {
      setIsDeleting(false)
    }
  }

  // ê²Œì‹œê¸€ ìˆ¨ê¸°ê¸°/ê³µê°œ
  const handleToggleVisibility = async () => {
    if (!hidingId) return

    setIsHiding(true)
    try {
      const post = posts.find(p => p.id === hidingId)
      const newVisibility = post?.visibility === "public" ? "hidden" : "public"

      const { error } = await supabase
        .from("posts")
        .update({ visibility: newVisibility })
        .eq("id", hidingId)

      if (error) throw error

      setPosts(posts.map(p =>
        p.id === hidingId ? { ...p, visibility: newVisibility } : p
      ))
      setHidingId(null)
      router.refresh()
    } catch (error) {
      console.error("ê²Œì‹œê¸€ ìƒíƒœ ë³€ê²½ ì‹¤íŒ¨:", error)
      alert("ê²Œì‹œê¸€ ìƒíƒœ ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")
    } finally {
      setIsHiding(false)
    }
  }

  const formatDate = (dateString: string) => {
    const date = new Date(dateString)
    return date.toLocaleDateString("ko-KR", {
      year: "numeric",
      month: "2-digit",
      day: "2-digit",
    })
  }

  const boardSlug = posts[0]?.board_categories?.slug || "free"
  const showCategoryManagement = CATEGORY_REQUIRED_BOARDS.includes(boardType)

  return (
    <div className="space-y-6">
      {/* ì¹´í…Œê³ ë¦¬ ê´€ë¦¬ ì˜ì—­ (ì¸ì‚¬ì´íŠ¸/íŒŒíŠ¸ë„ˆìŠ¤ë§Œ) */}
      {showCategoryManagement && (
        <>
          <div>
            <h3 className="text-lg font-semibold text-slate-900 mb-4">ì¹´í…Œê³ ë¦¬ ê´€ë¦¬</h3>
            <PartnerCategoryTab
              initialCategories={categories
                .filter(cat => cat.type === (boardType === "insights" ? "insight" : "partner"))
                .map(cat => ({ ...cat, created_at: cat.created_at || "" }))}
              categoryType={boardType === "insights" ? "insight" : "partner"}
            />
          </div>
          <Separator />
        </>
      )}

      {/* ê²Œì‹œê¸€ ëª©ë¡ ì˜ì—­ */}
      <div>
        <div className="flex items-center justify-between mb-6">
          <h3 className="text-lg font-semibold text-slate-900">ê²Œì‹œê¸€ ëª©ë¡</h3>
          {showCategoryFilter && (
            <Select value={selectedCategory} onValueChange={setSelectedCategory}>
              <SelectTrigger className="w-[200px]">
                <SelectValue placeholder="ì¹´í…Œê³ ë¦¬ í•„í„°" />
              </SelectTrigger>
              <SelectContent>
                <SelectItem value="all">ì „ì²´</SelectItem>
                {filteredCategories.map((cat) => (
                  <SelectItem key={cat.id} value={cat.id}>
                    {cat.name}
                  </SelectItem>
                ))}
              </SelectContent>
            </Select>
          )}
        </div>

        {filteredPosts.length > 0 ? (
          <Table>
            <TableHeader>
              <TableRow>
                <TableHead>ì œëª©</TableHead>
                <TableHead>ê²Œì‹œíŒ</TableHead>
                <TableHead>ì‘ì„±ì</TableHead>
                <TableHead>ì‘ì„±ì¼</TableHead>
                <TableHead>ìƒíƒœ</TableHead>
                <TableHead className="text-right">ê´€ë¦¬</TableHead>
              </TableRow>
            </TableHeader>
            <TableBody>
              {filteredPosts.map((post) => {
                const postSlug = post.board_categories?.slug || "free"
                const postUrl = `/community/board/${postSlug}/${post.id}`
                const isHidden = post.visibility === "hidden"

                return (
                  <TableRow key={post.id}>
                    <TableCell>
                      <div className="font-medium text-slate-900">{post.title}</div>
                    </TableCell>
                    <TableCell>
                      <Badge variant="secondary">
                        {post.board_categories?.name || "ê²Œì‹œíŒ"}
                      </Badge>
                    </TableCell>
                    <TableCell>
                      <div className="text-sm text-slate-600">
                        {post.profiles?.full_name || "ìµëª…"}
                      </div>
                    </TableCell>
                    <TableCell>
                      <div className="text-sm text-slate-600">
                        {formatDate(post.created_at)}
                      </div>
                    </TableCell>
                    <TableCell>
                      {isHidden ? (
                        <Badge variant="outline" className="text-slate-500">
                          <EyeOff className="h-3 w-3 mr-1" />
                          ìˆ¨ê¹€
                        </Badge>
                      ) : (
                        <Badge className="bg-green-100 text-green-700">ê³µê°œ</Badge>
                      )}
                    </TableCell>
                    <TableCell className="text-right">
                      <DropdownMenu>
                        <DropdownMenuTrigger asChild>
                          <Button variant="ghost" size="sm">
                            <MoreVertical className="h-4 w-4" />
                          </Button>
                        </DropdownMenuTrigger>
                        <DropdownMenuContent align="end">
                          <DropdownMenuItem asChild>
                            <Link href={postUrl} className="cursor-pointer">
                              <Eye className="mr-2 h-4 w-4" />
                              ë³´ê¸°
                            </Link>
                          </DropdownMenuItem>
                          <DropdownMenuItem
                            onClick={() => setHidingId(post.id)}
                            className="cursor-pointer"
                          >
                            <EyeOff className="mr-2 h-4 w-4" />
                            {isHidden ? "ê³µê°œí•˜ê¸°" : "ìˆ¨ê¸°ê¸°"}
                          </DropdownMenuItem>
                          <DropdownMenuSeparator />
                          <DropdownMenuItem
                            onClick={() => setDeletingId(post.id)}
                            className="cursor-pointer text-red-600"
                          >
                            <Trash2 className="mr-2 h-4 w-4" />
                            ì‚­ì œ
                          </DropdownMenuItem>
                        </DropdownMenuContent>
                      </DropdownMenu>
                    </TableCell>
                  </TableRow>
                )
              })}
            </TableBody>
          </Table>
        ) : (
          <div className="py-12 text-center text-slate-500">
            ë“±ë¡ëœ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤
          </div>
        )}
      </div>

      {/* ì‚­ì œ í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ */}
      <AlertDialog open={!!deletingId} onOpenChange={(open) => !open && setDeletingId(null)}>
        <AlertDialogContent>
          <AlertDialogHeader>
            <AlertDialogTitle>ê²Œì‹œê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</AlertDialogTitle>
            <AlertDialogDescription>
              ì´ ì‘ì—…ì€ ì·¨ì†Œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê²Œì‹œê¸€ê³¼ ëª¨ë“  ëŒ“ê¸€ì´ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤.
            </AlertDialogDescription>
          </AlertDialogHeader>
          <AlertDialogFooter>
            <AlertDialogCancel>ì·¨ì†Œ</AlertDialogCancel>
            <AlertDialogAction
              onClick={handleDelete}
              disabled={isDeleting}
              className="bg-red-600 hover:bg-red-700"
            >
              {isDeleting ? (
                <>
                  <Loader2 className="mr-2 h-4 w-4 animate-spin" />
                  ì‚­ì œ ì¤‘...
                </>
              ) : (
                "ì‚­ì œ"
              )}
            </AlertDialogAction>
          </AlertDialogFooter>
        </AlertDialogContent>
      </AlertDialog>

      {/* ìˆ¨ê¸°ê¸° í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ */}
      <AlertDialog open={!!hidingId} onOpenChange={(open) => !open && setHidingId(null)}>
        <AlertDialogContent>
          <AlertDialogHeader>
            <AlertDialogTitle>
              {posts.find(p => p.id === hidingId)?.visibility === "public"
                ? "ê²Œì‹œê¸€ì„ ìˆ¨ê¸°ì‹œê² ìŠµë‹ˆê¹Œ?"
                : "ê²Œì‹œê¸€ì„ ê³µê°œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?"}
            </AlertDialogTitle>
            <AlertDialogDescription>
              {posts.find(p => p.id === hidingId)?.visibility === "public"
                ? "ê²Œì‹œê¸€ì´ ëª©ë¡ì—ì„œ ìˆ¨ê²¨ì§‘ë‹ˆë‹¤. ë§í¬ë¥¼ ì•„ëŠ” ì‚¬ëŒì€ ì—¬ì „íˆ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."
                : "ê²Œì‹œê¸€ì´ ë‹¤ì‹œ ëª©ë¡ì— í‘œì‹œë©ë‹ˆë‹¤."}
            </AlertDialogDescription>
          </AlertDialogHeader>
          <AlertDialogFooter>
            <AlertDialogCancel>ì·¨ì†Œ</AlertDialogCancel>
            <AlertDialogAction
              onClick={handleToggleVisibility}
              disabled={isHiding}
            >
              {isHiding ? (
                <>
                  <Loader2 className="mr-2 h-4 w-4 animate-spin" />
                  ì²˜ë¦¬ ì¤‘...
                </>
              ) : (
                "í™•ì¸"
              )}
            </AlertDialogAction>
          </AlertDialogFooter>
        </AlertDialogContent>
      </AlertDialog>
    </div>
  )
}
</file>

<file path="components/auth-header.tsx">
import Link from "next/link"
import Image from "next/image"

/**
 * ì¸ì¦ í˜ì´ì§€(ë¡œê·¸ì¸, íšŒì›ê°€ì…, ì—ëŸ¬)ìš© ê³µí†µ í—¤ë”
 */
export function AuthHeader() {
  return (
    <header className="fixed inset-x-0 top-0 z-50 h-14 w-full border-b border-slate-200 bg-white/95 backdrop-blur supports-[backdrop-filter]:bg-white/90">
      <div className="mx-auto flex h-14 w-full max-w-7xl items-center px-4 lg:px-[27px]">
        <Link href="/" className="flex items-center hover:opacity-85 transition-opacity">
          <Image
            src="/images/logo-text.png"
            alt="Seoul Founders Club"
            width={120}
            height={24}
            className="h-6 w-auto object-contain"
            priority
          />
        </Link>
      </div>
    </header>
  )
}
</file>

<file path="components/badge-management-row.tsx">
"use client"

import { useState } from "react"
import { TableCell, TableRow } from "@/components/ui/table"
import { Button } from "@/components/ui/button"
import { Badge } from "@/components/ui/badge"
import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar"
import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from "@/components/ui/dialog"
import { updateBadgeStatus } from "@/lib/actions/admin"
import { CheckCircle2, XCircle, Eye, Loader2 } from "lucide-react"
import { useRouter } from "next/navigation"
import Image from "next/image"

type BadgeRequest = {
  id: string
  status: string
  evidence: string | null
  created_at: string
  profiles: {
    id: string
    full_name: string | null
    email: string | null
    avatar_url: string | null
  } | null
  badges: {
    id: string
    name: string
    icon: string
  } | null
}

export function BadgeManagementRow({ badgeRequest }: { badgeRequest: BadgeRequest }) {
  const router = useRouter()
  const [showEvidenceDialog, setShowEvidenceDialog] = useState(false)
  const [isProcessing, setIsProcessing] = useState(false)
  const [processingAction, setProcessingAction] = useState<'approve' | 'reject' | null>(null)

  const handleApprove = async () => {
    if (!confirm("ì´ ë±ƒì§€ ì‹ ì²­ì„ ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return

    setIsProcessing(true)
    setProcessingAction('approve')
    try {
      await updateBadgeStatus(badgeRequest.id, 'approved')
      router.refresh()
    } catch (error) {
      console.error("Failed to approve badge:", error)
      alert("ìŠ¹ì¸ ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")
    } finally {
      setIsProcessing(false)
      setProcessingAction(null)
    }
  }

  const handleReject = async () => {
    if (!confirm("ì´ ë±ƒì§€ ì‹ ì²­ì„ ê±°ì ˆí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return

    setIsProcessing(true)
    setProcessingAction('reject')
    try {
      await updateBadgeStatus(badgeRequest.id, 'rejected')
      router.refresh()
    } catch (error) {
      console.error("Failed to reject badge:", error)
      alert("ê±°ì ˆ ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")
    } finally {
      setIsProcessing(false)
      setProcessingAction(null)
    }
  }

  const user = badgeRequest.profiles
  const badge = badgeRequest.badges
  const evidence = badgeRequest.evidence || "ì¦ë¹™ ìë£Œ ì—†ìŒ"
  const evidencePreview = evidence.length > 50 ? evidence.substring(0, 50) + "..." : evidence

  return (
    <>
      <TableRow>
        <TableCell>
          <div className="flex items-center gap-3">
            <Avatar className="h-10 w-10">
              <AvatarImage src={user?.avatar_url || undefined} />
              <AvatarFallback className="bg-blue-600 text-white">
                {user?.full_name?.[0] || user?.email?.[0] || "U"}
              </AvatarFallback>
            </Avatar>
            <div>
              <div className="font-medium text-slate-900">
                {user?.full_name || "ì´ë¦„ ì—†ìŒ"}
              </div>
              <div className="text-sm text-slate-500">{user?.email}</div>
            </div>
          </div>
        </TableCell>
        <TableCell>
          {badge ? (
            <div className="flex items-center gap-2">
              <span className="text-lg">{badge.icon}</span>
              <span className="font-medium text-slate-900">{badge.name}</span>
            </div>
          ) : (
            <span className="text-slate-400">ë±ƒì§€ ì •ë³´ ì—†ìŒ</span>
          )}
        </TableCell>
        <TableCell>
          <div className="max-w-md">
            <p className="text-sm text-slate-700 line-clamp-2">{evidencePreview}</p>
            {evidence.length > 50 && (
              <Button
                variant="ghost"
                size="sm"
                onClick={() => setShowEvidenceDialog(true)}
                className="mt-1 h-7 text-xs"
              >
                <Eye className="h-3 w-3 mr-1" />
                ë³´ê¸°
              </Button>
            )}
          </div>
        </TableCell>
        <TableCell>
          <div className="text-sm text-slate-600">
            {new Date(badgeRequest.created_at).toLocaleDateString('ko-KR', {
              year: 'numeric',
              month: 'long',
              day: 'numeric',
            })}
          </div>
        </TableCell>
        <TableCell className="text-right">
          <div className="flex flex-col sm:flex-row items-end sm:items-center justify-end gap-2">
            <Button
              onClick={handleApprove}
              disabled={isProcessing}
              size="sm"
              className="bg-green-600 hover:bg-green-700 text-white w-full sm:w-auto"
            >
              {isProcessing && processingAction === 'approve' ? (
                <Loader2 className="h-3 w-3 animate-spin" />
              ) : (
                <>
                  <CheckCircle2 className="h-3 w-3 mr-1" />
                  ìŠ¹ì¸
                </>
              )}
            </Button>
            <Button
              onClick={handleReject}
              disabled={isProcessing}
              size="sm"
              variant="destructive"
              className="w-full sm:w-auto"
            >
              {isProcessing && processingAction === 'reject' ? (
                <Loader2 className="h-3 w-3 animate-spin" />
              ) : (
                <>
                  <XCircle className="h-3 w-3 mr-1" />
                  ë°˜ë ¤
                </>
              )}
            </Button>
          </div>
        </TableCell>
      </TableRow>

      {/* ì¦ë¹™ ìë£Œ ìƒì„¸ ë³´ê¸° Dialog */}
      <Dialog open={showEvidenceDialog} onOpenChange={setShowEvidenceDialog}>
        <DialogContent className="sm:max-w-lg bg-white rounded-xl">
          <DialogHeader>
            <DialogTitle className="text-lg font-bold">ì¦ë¹™ ìë£Œ</DialogTitle>
            <DialogDescription className="text-sm text-slate-500">
              ì‚¬ìš©ìê°€ ì œì¶œí•œ ì¦ë¹™ ìë£Œì…ë‹ˆë‹¤
            </DialogDescription>
          </DialogHeader>
          <div className="mt-4">
            <div className="p-4 bg-slate-50 rounded-lg border border-slate-200">
              <p className="text-sm text-slate-700 whitespace-pre-wrap break-words">
                {evidence}
              </p>
            </div>
          </div>
        </DialogContent>
      </Dialog>
    </>
  )
}
</file>

<file path="components/badge-manager.tsx">
"use client"

import { useState, useEffect } from "react"
import { createClient } from "@/lib/supabase/client"
import { toggleBadgeVisibility, grantBadge } from "@/lib/actions/badges"
import { Switch } from "@/components/ui/switch"
import { Label } from "@/components/ui/label"
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select"
import { Button } from "@/components/ui/button"
import { Plus } from "lucide-react"

type Badge = {
  id: string
  name: string
  icon: string
  category: string
  description: string | null
  is_active?: boolean
}

type UserBadge = {
  id: string
  badge_id: string
  is_visible: boolean
  badges: Badge
}

type BadgeManagerProps = {
  userId: string
}

export function BadgeManager({ userId }: BadgeManagerProps) {
  const [userBadges, setUserBadges] = useState<UserBadge[]>([])
  const [allBadges, setAllBadges] = useState<Badge[]>([])
  const [selectedBadgeId, setSelectedBadgeId] = useState<string>("")
  const [loading, setLoading] = useState(true)
  const [addingBadge, setAddingBadge] = useState(false)
  const supabase = createClient()

  useEffect(() => {
    const loadBadges = async () => {
      // Load user badges
      const { data: userBadgesData } = await supabase
        .from("user_badges")
        .select(`
          id,
          badge_id,
          is_visible,
          badges:badge_id (
            id,
            name,
            icon,
            category,
            description,
            is_active
          )
        `)
        .eq("user_id", userId)
        .order("created_at", { ascending: false })

      if (userBadgesData) {
        // Filter active badges
        const activeBadges = userBadgesData.filter((ub: any) => 
          ub.badges.is_active !== false
        )
        setUserBadges(activeBadges as any)
      }

      // Load all available badges (í™œì„±í™”ëœ ë±ƒì§€ë§Œ)
      const { data: allBadgesData } = await supabase
        .from("badges")
        .select("id, name, icon, category, description")
        .or("is_active.eq.true,is_active.is.null") // í™œì„±í™”ëœ ë±ƒì§€ë§Œ ì¡°íšŒ (true ë˜ëŠ” null)
        .order("category", { ascending: true })
        .order("name", { ascending: true })

      if (allBadgesData) {
        setAllBadges(allBadgesData as Badge[])
      }

      setLoading(false)
    }

    loadBadges()
  }, [userId, supabase])

  const handleToggleVisibility = async (badgeId: string, currentVisibility: boolean) => {
    try {
      await toggleBadgeVisibility(badgeId, !currentVisibility)
      
      // Update local state
      setUserBadges((prev) =>
        prev.map((ub) =>
          ub.badge_id === badgeId ? { ...ub, is_visible: !currentVisibility } : ub
        )
      )
    } catch (error) {
      console.error("Failed to toggle badge visibility:", error)
      alert("ë±ƒì§€ ë…¸ì¶œ ì„¤ì • ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")
    }
  }

  const handleAddBadge = async () => {
    if (!selectedBadgeId) {
      alert("ë±ƒì§€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.")
      return
    }

    // Check if badge already exists
    const existingBadge = userBadges.find((ub) => ub.badge_id === selectedBadgeId)
    if (existingBadge) {
      alert("ì´ë¯¸ ë¶€ì—¬ëœ ë±ƒì§€ì…ë‹ˆë‹¤.")
      return
    }

    setAddingBadge(true)
    try {
      await grantBadge(userId, selectedBadgeId)
      
      // Reload badges
      const { data } = await supabase
        .from("user_badges")
        .select(`
          id,
          badge_id,
          is_visible,
          badges:badge_id (
            id,
            name,
            icon,
            category,
            description,
            is_active
          )
        `)
        .eq("user_id", userId)
        .order("created_at", { ascending: false })

      if (data) {
        const activeData = data.filter((ub: any) => ub.badges.is_active !== false)
        setUserBadges(activeData as any)
      }
      
      setSelectedBadgeId("")
      alert("ë±ƒì§€ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.")
    } catch (error: any) {
      console.error("Failed to add badge:", error)
      alert(error.message || "ë±ƒì§€ ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")
    } finally {
      setAddingBadge(false)
    }
  }

  // Get badges that user doesn't have yet
  const availableBadges = allBadges.filter(
    (badge) => !userBadges.some((ub) => ub.badge_id === badge.id)
  )

  if (loading) {
    return <div className="text-sm text-slate-500">ë¡œë”© ì¤‘...</div>
  }

  if (userBadges.length === 0) {
    return (
      <div className="text-center py-8 text-slate-500">
        <p className="text-sm">ë³´ìœ í•œ ë±ƒì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
        <p className="text-xs mt-2 text-slate-400">ê´€ë¦¬ì ê²€ì¦ì„ í†µí•´ ë±ƒì§€ë¥¼ ë¶€ì—¬ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
      </div>
    )
  }

  // ì¹´í…Œê³ ë¦¬ë³„ë¡œ ê·¸ë£¹í™”
  const groupedBadges = userBadges.reduce((acc, ub) => {
    const category = ub.badges.category
    if (!acc[category]) {
      acc[category] = []
    }
    acc[category].push(ub)
    return acc
  }, {} as Record<string, UserBadge[]>)

  const categoryLabels: Record<string, string> = {
    asset: "ìì‚°",
    revenue: "ë§¤ì¶œ",
    influence: "ì¸í”Œë£¨ì–¸ì„œ",
    achievement: "íŠ¹ë³„ ì´ë ¥",
    community: "ì»¤ë®¤ë‹ˆí‹°",
  }

  return (
    <div className="space-y-6 bg-white">
      {/* ë±ƒì§€ ì¶”ê°€ ì„¹ì…˜ */}
      <div className="mb-6 p-4 border border-slate-200 rounded-lg bg-slate-50">
        <h3 className="text-sm font-semibold text-slate-900 mb-3">ë±ƒì§€ ì¶”ê°€</h3>
        <div className="flex gap-2">
          <Select value={selectedBadgeId} onValueChange={setSelectedBadgeId}>
            <SelectTrigger className="flex-1">
              <SelectValue placeholder="ë±ƒì§€ë¥¼ ì„ íƒí•˜ì„¸ìš”" />
            </SelectTrigger>
            <SelectContent className="z-[9999]">
              {availableBadges.length > 0 ? (
                availableBadges.map((badge) => (
                  <SelectItem key={badge.id} value={badge.id}>
                    <div className="flex items-center gap-2">
                      <span>{badge.icon}</span>
                      <span>{badge.name}</span>
                    </div>
                  </SelectItem>
                ))
              ) : (
                <SelectItem value="" disabled>
                  ì¶”ê°€í•  ìˆ˜ ìˆëŠ” ë±ƒì§€ê°€ ì—†ìŠµë‹ˆë‹¤
                </SelectItem>
              )}
            </SelectContent>
          </Select>
          <Button 
            onClick={handleAddBadge} 
            disabled={!selectedBadgeId || addingBadge}
            size="default"
            className="shrink-0"
          >
            {addingBadge ? "ì¶”ê°€ ì¤‘..." : <><Plus className="h-4 w-4 mr-1" />ì¶”ê°€</>}
          </Button>
        </div>
      </div>

      {/* ê¸°ì¡´ ë±ƒì§€ ëª©ë¡ */}
      {Object.entries(groupedBadges).map(([category, badges]) => (
        <div key={category}>
          <h4 className="mb-3 text-sm font-semibold text-slate-700 uppercase tracking-wide">
            {categoryLabels[category] || category}
          </h4>
          <div className="space-y-3">
            {badges.map((userBadge) => {
              const badge = userBadge.badges
              return (
                <Card key={userBadge.id} className="border-slate-200">
                  <CardContent className="p-4">
                    <div className="flex items-center justify-between">
                      <div className="flex items-center gap-3">
                        <span className="text-2xl">{badge.icon}</span>
                        <div>
                          <div className="font-semibold text-slate-900">{badge.name}</div>
                          {badge.description && (
                            <div className="text-xs text-slate-600 mt-0.5">{badge.description}</div>
                          )}
                        </div>
                      </div>
                      <div className="flex items-center gap-3">
                        <div className="flex flex-col items-end gap-1">
                          <Label htmlFor={`badge-${userBadge.id}`} className="text-xs text-slate-600 cursor-pointer">
                            {userBadge.is_visible ? "ë…¸ì¶œ ì¤‘" : "ìˆ¨ê¹€"}
                          </Label>
                          <Switch
                            id={`badge-${userBadge.id}`}
                            checked={userBadge.is_visible}
                            onCheckedChange={() => handleToggleVisibility(userBadge.badge_id, userBadge.is_visible)}
                          />
                        </div>
                      </div>
                    </div>
                  </CardContent>
                </Card>
              )
            })}
          </div>
        </div>
      ))}
      <div className="mt-4 p-3 rounded-lg bg-blue-50 border border-blue-200">
        <p className="text-xs text-blue-700">
          ğŸ’¡ ë…¸ì¶œëœ ë±ƒì§€ëŠ” ê²Œì‹œê¸€ ì‘ì„±ì ì´ë¦„ ì˜†ì— í‘œì‹œë©ë‹ˆë‹¤.
        </p>
      </div>
    </div>
  )
}
</file>

<file path="components/comment-section.tsx">
"use client";

import { useState } from "react";
import { useRouter } from 'next/navigation';
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Textarea } from "@/components/ui/textarea";
import { createClient } from "@/lib/supabase/client";
import { deleteComment } from "@/lib/actions/posts";
import { Trash2 } from "lucide-react";
import Link from "next/link";
import {
  AlertDialog,
  AlertDialogAction,
  AlertDialogCancel,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogTitle,
} from "@/components/ui/alert-dialog";

type Comment = {
  id: string;
  content: string;
  created_at: string;
  author_id: string;
  profiles: {
    id: string;
    full_name: string | null;
    avatar_url: string | null;
  } | null;
};

export function CommentSection({
  postId,
  userId,
  comments: initialComments,
  readOnly = false,
  onCommentAdded,
}: {
  postId: string;
  userId?: string;
  comments: Comment[];
  readOnly?: boolean;
  onCommentAdded?: () => void;
}) {
  const [comments, setComments] = useState<Comment[]>(initialComments);
  const [newComment, setNewComment] = useState("");
  const [isLoading, setIsLoading] = useState(false);
  const [deletingCommentId, setDeletingCommentId] = useState<string | null>(null);
  const [isDeleting, setIsDeleting] = useState(false);
  const router = useRouter();

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    if (!userId) return;

    const supabase = createClient();
    const trimmed = newComment.trim();
    if (!trimmed) return;
    setIsLoading(true);

    try {
      const { data: inserted, error } = await supabase
        .from("comments")
        .insert({
          post_id: postId,
          author_id: userId,
          content: trimmed,
        })
        .select(`
          *,
          profiles:author_id (
            id,
            full_name,
            avatar_url
          )
        `)
        .single();

      if (error) throw error;

      setNewComment("");

      if (inserted) {
        setComments((prev) => [...prev, inserted]);
      }

      // ì½œë°± í˜¸ì¶œ (ë¶€ëª¨ ì»´í¬ë„ŒíŠ¸ì—ì„œ ëŒ“ê¸€ ìˆ˜ ì—…ë°ì´íŠ¸ ë“±)
      onCommentAdded?.();

      // ì„œë²„ ì»´í¬ë„ŒíŠ¸ì¸ ê²½ìš°ì—ë§Œ refresh
      if (typeof window === 'undefined' || !onCommentAdded) {
        router.refresh();
      }
    } catch (error) {
      console.error("Failed to add comment:", error);
    } finally {
      setIsLoading(false);
    }
  };

  const handleDeleteComment = async (commentId: string) => {
    setIsDeleting(true);
    try {
      await deleteComment(commentId);
      
      // ëŒ“ê¸€ ëª©ë¡ì—ì„œ ì‚­ì œëœ ëŒ“ê¸€ ì œê±°
      setComments(comments.filter(comment => comment.id !== commentId));
      
      // ì½œë°± í˜¸ì¶œ (ë¶€ëª¨ ì»´í¬ë„ŒíŠ¸ì—ì„œ ëŒ“ê¸€ ìˆ˜ ì—…ë°ì´íŠ¸ ë“±)
      onCommentAdded?.();
      
      // ì„œë²„ ì»´í¬ë„ŒíŠ¸ì¸ ê²½ìš°ì—ë§Œ refresh
      if (typeof window === 'undefined' || !onCommentAdded) {
        router.refresh();
      }
    } catch (error) {
      console.error("Failed to delete comment:", error);
      alert("ëŒ“ê¸€ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
    } finally {
      setIsDeleting(false);
      setDeletingCommentId(null);
    }
  };

  return (
    <div className="space-y-6">
      {!readOnly && (
        <div>
          {!userId ? (
            <div className="text-center py-6 border border-slate-200 rounded-lg bg-slate-50">
              <p className="text-sm text-slate-600 mb-3">ëŒ“ê¸€ì„ ì‘ì„±í•˜ë ¤ë©´ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>
              <Link href="/auth/login">
                <Button size="sm">ë¡œê·¸ì¸í•˜ê¸°</Button>
              </Link>
            </div>
          ) : (
            <form onSubmit={handleSubmit} className="space-y-3">
              <Textarea
                placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”..."
                value={newComment}
                onChange={(e) => setNewComment(e.target.value)}
                required
                rows={3}
                className="resize-none"
              />
              <div className="flex justify-end">
                <Button type="submit" disabled={isLoading} size="sm">
                  {isLoading ? "ë“±ë¡ ì¤‘..." : "ëŒ“ê¸€ ë“±ë¡"}
                </Button>
              </div>
            </form>
          )}
        </div>
      )}

      {comments.length > 0 && (
        <div className="space-y-4">
          {comments.map((comment) => {
            const isAuthor = userId && comment.author_id === userId;
            return (
              <div key={comment.id} className="flex items-start gap-3 pb-4 border-b border-slate-100 last:border-b-0 last:pb-0">
                <div className="flex h-8 w-8 items-center justify-center rounded-full bg-gradient-to-br from-blue-500 to-purple-500 text-xs font-semibold text-white flex-shrink-0">
                  {comment.profiles?.full_name?.[0] || "U"}
                </div>
                <div className="flex-1 min-w-0">
                  <div className="mb-1.5 flex items-center justify-between gap-2">
                    <div className="flex items-center gap-2">
                      <p className="font-semibold text-sm text-slate-900">
                        {comment.profiles?.full_name || "ìµëª…"}
                      </p>
                      <p className="text-xs text-slate-500">
                        {new Date(comment.created_at).toLocaleDateString("ko-KR", {
                          month: "long",
                          day: "numeric",
                          hour: "2-digit",
                          minute: "2-digit",
                        })}
                      </p>
                    </div>
                    {isAuthor && (
                      <Button
                        variant="ghost"
                        size="sm"
                        className="h-7 w-7 p-0 text-slate-400 hover:text-red-600 hover:bg-red-50"
                        onClick={() => setDeletingCommentId(comment.id)}
                      >
                        <Trash2 className="h-3.5 w-3.5" />
                      </Button>
                    )}
                  </div>
                  <p className="text-sm text-slate-700 leading-relaxed">
                    {comment.content}
                  </p>
                </div>
              </div>
            );
          })}
        </div>
      )}

      <AlertDialog open={deletingCommentId !== null} onOpenChange={(open) => !open && setDeletingCommentId(null)}>
        <AlertDialogContent className="bg-white max-w-md">
          <AlertDialogHeader>
            <AlertDialogTitle>ëŒ“ê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</AlertDialogTitle>
            <AlertDialogDescription>
              ì´ ì‘ì—…ì€ ì·¨ì†Œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ëŒ“ê¸€ì´ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤.
            </AlertDialogDescription>
          </AlertDialogHeader>
          <AlertDialogFooter 
            style={{ display: 'flex', flexDirection: 'row', gap: '0.5rem', justifyContent: 'flex-end' }}
            className="!flex !flex-row gap-2 sm:justify-end"
          >
            <AlertDialogCancel variant="outline">ì·¨ì†Œ</AlertDialogCancel>
            <AlertDialogAction 
              onClick={() => deletingCommentId && handleDeleteComment(deletingCommentId)} 
              disabled={isDeleting} 
              variant="destructive" 
              className="bg-red-600 hover:bg-red-700 text-white"
            >
              {isDeleting ? "ì‚­ì œ ì¤‘..." : "ì‚­ì œ"}
            </AlertDialogAction>
          </AlertDialogFooter>
        </AlertDialogContent>
      </AlertDialog>
    </div>
  );
}
</file>

<file path="components/community-intro.tsx">
"use client"

import { useState } from "react"
import { Pencil, Check, X } from "lucide-react"
import { Button } from "@/components/ui/button"
import { Textarea } from "@/components/ui/textarea"
import { updateCommunityIntro } from "@/lib/actions/community"
import { toast } from "sonner"
import { PageHeader } from "@/components/page-header"

interface CommunityIntroProps {
  initialIntro: string
  canEdit: boolean
}

export function CommunityIntro({ initialIntro, canEdit }: CommunityIntroProps) {
  const [isEditing, setIsEditing] = useState(false)
  const [intro, setIntro] = useState(initialIntro)
  const [isLoading, setIsLoading] = useState(false)

  const handleSave = async () => {
    try {
      setIsLoading(true)
      await updateCommunityIntro(intro)
      setIsEditing(false)
      toast.success("ì»¤ë®¤ë‹ˆí‹° ì†Œê°œê¸€ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.")
    } catch (error) {
      console.error(error)
      toast.error("ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")
    } finally {
      setIsLoading(false)
    }
  }

  const handleCancel = () => {
    setIntro(initialIntro)
    setIsEditing(false)
  }

  if (isEditing) {
    return (
      <div className="w-full bg-white p-6 rounded-xl border border-slate-200 shadow-sm mb-8 animate-in fade-in zoom-in-95 duration-200">
        <div className="flex items-center justify-between mb-4">
          <h2 className="text-lg font-bold text-slate-900">ì»¤ë®¤ë‹ˆí‹° ì†Œê°œê¸€ ìˆ˜ì •</h2>
          <div className="flex gap-2">
            <Button size="sm" variant="ghost" onClick={handleCancel} disabled={isLoading}>
              <X className="h-4 w-4 mr-1" />
              ì·¨ì†Œ
            </Button>
            <Button size="sm" onClick={handleSave} disabled={isLoading}>
              <Check className="h-4 w-4 mr-1" />
              ì €ì¥
            </Button>
          </div>
        </div>
        <Textarea
          value={intro}
          onChange={(e) => setIntro(e.target.value)}
          className="min-h-[100px] text-base resize-none"
          placeholder="ì»¤ë®¤ë‹ˆí‹° ì†Œê°œê¸€ì„ ì…ë ¥í•˜ì„¸ìš”..."
        />
        <p className="text-xs text-slate-500 mt-2 text-right">
          {intro.length}ì
        </p>
      </div>
    )
  }

  return (
    <div className="relative group">
      <PageHeader
        title="ì»¤ë®¤ë‹ˆí‹°"
        description={intro}
        className="w-full"
        compact={true}
      />
      {canEdit && (
        <Button
          size="icon"
          variant="secondary"
          className="absolute top-4 right-4 opacity-0 group-hover:opacity-100 transition-opacity shadow-sm bg-white/80 hover:bg-white"
          onClick={() => setIsEditing(true)}
          title="ì†Œê°œê¸€ ìˆ˜ì •"
        >
          <Pencil className="h-4 w-4 text-slate-600" />
        </Button>
      )}
    </div>
  )
}
</file>

<file path="components/community-right-sidebar.tsx">
"use client"

import { useEffect, useState } from "react"
import { createClient } from "@/lib/supabase/client"
import { Card, CardContent } from "@/components/ui/card"
import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar"
import { Badge } from "@/components/ui/badge"
import { Button } from "@/components/ui/button"
import { ChevronRight, Pencil, Crown } from "lucide-react"
import { Skeleton } from "@/components/ui/skeleton"
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogFooter,
  DialogTrigger,
} from "@/components/ui/dialog"
import { Textarea } from "@/components/ui/textarea"
import { Label } from "@/components/ui/label"
import { toast } from "@/hooks/use-toast"
import { setCommunityLeader } from "@/lib/actions/community"
import { useRouter } from "next/navigation"

interface CommunityRightSidebarProps {
  slug: string
}

interface CommunityData {
  id: string
  community_id?: string
  name: string
  description?: string | null
  created_by?: string | null
  creator_profile?: {
    id: string
    full_name?: string | null
    avatar_url?: string | null
    company?: string | null
    position?: string | null
  } | null
  member_count?: number
  members?: Array<{
    id: string
    full_name?: string | null
    avatar_url?: string | null
    company?: string | null
    position?: string | null
    joined_at?: string
  }>
}

export function CommunityRightSidebar({ slug }: CommunityRightSidebarProps) {
  const [communityData, setCommunityData] = useState<CommunityData | null>(null)
  const [isLoading, setIsLoading] = useState(true)
  const [currentUser, setCurrentUser] = useState<any>(null)
  const [currentUserProfile, setCurrentUserProfile] = useState<any>(null)
  const [isDialogOpen, setIsDialogOpen] = useState(false)
  const [editDescription, setEditDescription] = useState("")
  const [isSaving, setIsSaving] = useState(false)
  const [selectedMemberForLeader, setSelectedMemberForLeader] = useState<string | null>(null)
  const [isSettingLeader, setIsSettingLeader] = useState(false)
  
  const supabase = createClient()
  const router = useRouter()

  useEffect(() => {
    async function fetchCommunityData() {
      try {
        setIsLoading(true)

        // í˜„ì¬ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        const { data: { user } } = await supabase.auth.getUser()
        setCurrentUser(user)

        // í˜„ì¬ ì‚¬ìš©ì í”„ë¡œí•„ ê°€ì ¸ì˜¤ê¸° (ê¶Œí•œ í™•ì¸ìš©)
        if (user) {
          const { data: profile } = await supabase
            .from("profiles")
            .select("role")
            .eq("id", user.id)
            .single()
          setCurrentUserProfile(profile)
        }

        // board_categoriesì—ì„œ ì»¤ë®¤ë‹ˆí‹° ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        const { data: category, error: categoryError } = await supabase
          .from("board_categories")
          .select("id, name, description, slug")
          .eq("slug", slug)
          .single()

        if (categoryError || !category) {
          console.error("ì»¤ë®¤ë‹ˆí‹° ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:", categoryError)
          setIsLoading(false)
          return
        }

        // communities í…Œì´ë¸”ì—ì„œ ì¶”ê°€ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (ìˆëŠ” ê²½ìš°)
        const { data: community } = await supabase
          .from("communities")
          .select(`
            id,
            name,
            description,
            created_by,
            profiles:created_by (
              id,
              full_name,
              avatar_url,
              company,
              position
            )
          `)
          .eq("name", category.name)
          .maybeSingle()

        // community_membersì—ì„œ ë©¤ë²„ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        let members: any[] = []
        let memberCount = 0

        if (community?.id) {
          const { data: communityMembers, error: membersError } = await supabase
            .from("community_members")
            .select(`
              user_id,
              joined_at,
              profiles:user_id (
                id,
                full_name,
                avatar_url,
                company,
                position
              )
            `)
            .eq("community_id", community.id)
            .order("joined_at", { ascending: false })
            .limit(10)

          if (!membersError && communityMembers) {
            members = communityMembers
              .map((cm: any) => ({
                id: cm.profiles?.id || cm.user_id,
                full_name: cm.profiles?.full_name || null,
                avatar_url: cm.profiles?.avatar_url || null,
                company: cm.profiles?.company || null,
                position: cm.profiles?.position || null,
                joined_at: cm.joined_at,
              }))
              .filter((m: any) => m.id) // ìœ íš¨í•œ ë©¤ë²„ë§Œ

            // ì „ì²´ ë©¤ë²„ ìˆ˜ ì¹´ìš´íŠ¸
            const { count } = await supabase
              .from("community_members")
              .select("*", { count: "exact", head: true })
              .eq("community_id", community.id)
            
            memberCount = count || 0
          }
        }

        const description = community ? (community.description || "") : (category.description || null)

        setCommunityData({
          id: category.id,
          community_id: community?.id,
          name: category.name,
          description: description,
          created_by: community?.created_by || null,
          creator_profile: (community?.profiles as any) || null,
          member_count: memberCount,
          members: members,
        })
        
        if (description) {
          setEditDescription(description)
        }
      } catch (error) {
        console.error("ì»¤ë®¤ë‹ˆí‹° ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:", error)
      } finally {
        setIsLoading(false)
      }
    }

    fetchCommunityData()
  }, [slug, supabase])

  const handleUpdateDescription = async () => {
    if (!communityData?.community_id) return
    
    setIsSaving(true)
    try {
      const { data, error } = await supabase
        .from("communities")
        .update({ description: editDescription })
        .eq("id", communityData.community_id)
        .select()
        .single()

      if (error) throw error

      setCommunityData(prev => prev ? ({ ...prev, description: data?.description || editDescription }) : null)
      setIsDialogOpen(false)
      toast({ 
        title: "ì„±ê³µ", 
        description: "ê°€ì´ë“œë¼ì¸ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤." 
      })
    } catch (error: any) {
      console.error("ì»¤ë®¤ë‹ˆí‹° ìˆ˜ì • ì˜¤ë¥˜:", error)
      // Supabase ì—ëŸ¬ ìƒì„¸ ì •ë³´ ë¡œê¹…
      if (error?.message) console.error("Error Message:", error.message)
      if (error?.details) console.error("Error Details:", error.details)
      if (error?.hint) console.error("Error Hint:", error.hint)
      
      toast({ 
        title: "ì˜¤ë¥˜", 
        description: `ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${error?.message || "ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"}`, 
        variant: "destructive" 
      })
    } finally {
      setIsSaving(false)
    }
  }

  const handleSetLeader = async (memberId: string) => {
    if (!communityData?.community_id) return
    
    setIsSettingLeader(true)
    try {
      await setCommunityLeader(communityData.community_id, memberId)
      
      toast({ 
        title: "ì„±ê³µ", 
        description: "ì»¤ë®¤ë‹ˆí‹° ë¦¬ë”ê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤." 
      })
      
      // ë°ì´í„° ê°±ì‹ 
      router.refresh()
      
      // ë¡œì»¬ ìƒíƒœë„ ì¦‰ì‹œ ì—…ë°ì´íŠ¸
      setCommunityData(prev => {
        if (!prev) return null
        const targetMember = prev.members?.find(m => m.id === memberId)
        if (!targetMember) return prev
        
        return {
          ...prev,
          created_by: memberId,
          creator_profile: {
            id: targetMember.id,
            full_name: targetMember.full_name,
            avatar_url: targetMember.avatar_url,
            company: targetMember.company,
            position: targetMember.position
          }
        }
      })
      
      setSelectedMemberForLeader(null)
    } catch (error: any) {
      console.error("ë¦¬ë” ì§€ì • ì˜¤ë¥˜:", error)
      toast({ 
        title: "ì˜¤ë¥˜", 
        description: error?.message || "ë¦¬ë” ì§€ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.", 
        variant: "destructive" 
      })
    } finally {
      setIsSettingLeader(false)
    }
  }

  if (isLoading) {
    return (
      <div className="flex flex-col gap-6">
        {[1, 2, 3].map((i) => (
          <Card key={i} className="bg-white border border-slate-200 rounded-xl shadow-sm">
            <CardContent className="p-5">
              <Skeleton className="h-6 w-32 mb-4" />
              <Skeleton className="h-4 w-full mb-2" />
              <Skeleton className="h-4 w-3/4" />
            </CardContent>
          </Card>
        ))}
      </div>
    )
  }

  if (!communityData) {
    return null
  }

  const isLeader = currentUser?.id && communityData.created_by === currentUser.id
  const isMaster = currentUserProfile?.role === 'master'

  return (
    <div className="flex flex-col gap-6">
      {/* Card 1: ì»¤ë®¤ë‹ˆí‹° ê°€ì´ë“œë¼ì¸ */}
      <Card className="bg-indigo-50 border-indigo-100 rounded-xl shadow-sm">
        <CardContent className="p-5">
          <div className="flex items-center justify-between mb-3">
            <div className="flex items-center gap-2">
              <span className="text-lg">ğŸ“Œ</span>
              <h3 className="text-base font-bold text-slate-900">ì»¤ë®¤ë‹ˆí‹° ê°€ì´ë“œë¼ì¸</h3>
            </div>
            {isLeader && (
              <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>
                <DialogTrigger asChild>
                  <Button variant="ghost" size="icon" className="h-6 w-6 text-indigo-400 hover:text-indigo-600 hover:bg-indigo-100">
                    <Pencil className="h-3.5 w-3.5" />
                  </Button>
                </DialogTrigger>
                <DialogContent>
                  <DialogHeader>
                    <DialogTitle>ì»¤ë®¤ë‹ˆí‹° ê°€ì´ë“œë¼ì¸ ìˆ˜ì •</DialogTitle>
                  </DialogHeader>
                  <div className="space-y-4 py-4">
                    <div className="space-y-2">
                      <Label htmlFor="guideline">ê°€ì´ë“œë¼ì¸ ë‚´ìš©</Label>
                      <Textarea 
                        id="guideline" 
                        value={editDescription} 
                        onChange={(e) => setEditDescription(e.target.value)}
                        placeholder="ì»¤ë®¤ë‹ˆí‹° ë©¤ë²„ë“¤ì´ ì§€ì¼œì•¼ í•  ê°€ì´ë“œë¼ì¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."
                        className="min-h-[150px]"
                      />
                    </div>
                  </div>
                  <DialogFooter>
                    <Button variant="outline" onClick={() => setIsDialogOpen(false)} disabled={isSaving}>ì·¨ì†Œ</Button>
                    <Button onClick={handleUpdateDescription} disabled={isSaving}>
                      {isSaving ? "ì €ì¥ ì¤‘..." : "ì €ì¥í•˜ê¸°"}
                    </Button>
                  </DialogFooter>
                </DialogContent>
              </Dialog>
            )}
          </div>
          {communityData.description ? (
            <div className="text-sm text-slate-700 leading-relaxed whitespace-pre-line">
              {communityData.description}
            </div>
          ) : (
            <ul className="text-sm text-slate-700 space-y-1.5 leading-relaxed">
              <li>â€¢ ì„œë¡œ ì¡´ì¤‘í•˜ë©° ì†Œí†µí•©ë‹ˆë‹¤</li>
              <li>â€¢ ê±´ì„¤ì ì¸ í”¼ë“œë°±ì„ ì œê³µí•©ë‹ˆë‹¤</li>
              <li>â€¢ ì»¤ë®¤ë‹ˆí‹°ì˜ ê°€ì¹˜ë¥¼ í•¨ê»˜ ë§Œë“¤ì–´ê°‘ë‹ˆë‹¤</li>
            </ul>
          )}
        </CardContent>
      </Card>

      {/* Card 2: ì»¤ë®¤ë‹ˆí‹° ë¦¬ë” */}
      {communityData.creator_profile && (
        <Card className="bg-white border border-slate-200 rounded-xl shadow-sm">
          <CardContent className="p-5">
            <div className="flex items-center gap-2 mb-4">
              <span className="text-lg">ğŸ‘‘</span>
              <h3 className="text-base font-bold text-slate-900">ì»¤ë®¤ë‹ˆí‹° ë¦¬ë”</h3>
            </div>
            <div className="flex items-center gap-3">
              <Avatar className="h-12 w-12 border-2 border-amber-200">
                <AvatarImage src={communityData.creator_profile.avatar_url || undefined} />
                <AvatarFallback className="bg-gradient-to-br from-amber-400 to-amber-600 text-white font-bold">
                  {communityData.creator_profile.full_name?.charAt(0) || "M"}
                </AvatarFallback>
              </Avatar>
              <div className="flex-1 min-w-0">
                <p className="font-semibold text-slate-900 text-sm truncate">
                  {communityData.creator_profile.full_name || "ë¦¬ë”"}
                </p>
              </div>
              <Badge className="bg-amber-100 text-amber-700 text-[10px] px-1.5 py-0.5 font-bold">
                ë¦¬ë”
              </Badge>
            </div>
          </CardContent>
        </Card>
      )}

      {/* Card 3: ì „ì²´ í´ëŸ½ ë©¤ë²„ */}
      <Card className="bg-white border border-slate-200 rounded-xl shadow-sm">
        <CardContent className="p-5">
          <div className="flex items-center gap-2 mb-4">
            <span className="text-lg">â—</span>
            <h3 className="text-base font-bold text-slate-900">
              ì „ì²´ í´ëŸ½ ë©¤ë²„ {communityData.member_count ? `(${communityData.member_count}ëª…)` : ""}
            </h3>
          </div>
          {communityData.members && communityData.members.length > 0 ? (
            <>
              <div className="space-y-3 mb-4">
                {communityData.members.map((member) => {
                  const isCurrentLeader = member.id === communityData.created_by
                  return (
                    <div key={member.id} className="flex items-center gap-3 group">
                      <Avatar className="h-10 w-10 border border-slate-200">
                        <AvatarImage src={member.avatar_url || undefined} />
                        <AvatarFallback className="bg-slate-100 text-slate-600 text-xs font-semibold">
                          {member.full_name?.charAt(0) || "M"}
                        </AvatarFallback>
                      </Avatar>
                      <div className="flex-1 min-w-0">
                        <p className="font-medium text-slate-900 text-sm truncate">
                          {member.full_name || "ë©¤ë²„"}
                        </p>
                      </div>
                      {isMaster && !isCurrentLeader && (
                        <Button
                          size="icon"
                          variant="ghost"
                          className="h-8 w-8 opacity-0 group-hover:opacity-100 transition-opacity"
                          onClick={() => setSelectedMemberForLeader(member.id)}
                          title="ë¦¬ë”ë¡œ ì§€ì •"
                        >
                          <Crown className="h-4 w-4 text-amber-500" />
                        </Button>
                      )}
                      {isCurrentLeader && (
                        <Badge className="bg-amber-100 text-amber-700 text-[10px] px-1.5 py-0.5 font-bold">
                          ë¦¬ë”
                        </Badge>
                      )}
                    </div>
                  )
                })}
              </div>
              {communityData.member_count && communityData.member_count > communityData.members.length && (
                <Button
                  variant="ghost"
                  className="w-full text-sm text-slate-600 hover:text-slate-900 hover:bg-slate-50"
                  disabled
                >
                  ë”ë³´ê¸° <ChevronRight className="h-4 w-4 ml-1" />
                </Button>
              )}
            </>
          ) : (
            <p className="text-sm text-slate-500">ë©¤ë²„ê°€ ì—†ìŠµë‹ˆë‹¤</p>
          )}
        </CardContent>
      </Card>

      {/* ë¦¬ë” ì§€ì • í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ */}
      <Dialog open={!!selectedMemberForLeader} onOpenChange={(open) => !open && setSelectedMemberForLeader(null)}>
        <DialogContent>
          <DialogHeader>
            <DialogTitle>ì»¤ë®¤ë‹ˆí‹° ë¦¬ë” ì§€ì •</DialogTitle>
          </DialogHeader>
          <div className="py-4">
            <p className="text-sm text-slate-600">
              <span className="font-bold text-slate-900">
                {communityData.members?.find(m => m.id === selectedMemberForLeader)?.full_name}
              </span>
              ë‹˜ì„ ì´ ì»¤ë®¤ë‹ˆí‹°ì˜ ë¦¬ë”ë¡œ ì§€ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?
            </p>
            <p className="text-xs text-slate-500 mt-2">
              ë¦¬ë”ëŠ” ì»¤ë®¤ë‹ˆí‹° ê°€ì´ë“œë¼ì¸ì„ ìˆ˜ì •í•˜ê³  ì»¤ë®¤ë‹ˆí‹°ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            </p>
          </div>
          <DialogFooter>
            <Button 
              variant="outline" 
              onClick={() => setSelectedMemberForLeader(null)}
              disabled={isSettingLeader}
            >
              ì·¨ì†Œ
            </Button>
            <Button 
              onClick={() => selectedMemberForLeader && handleSetLeader(selectedMemberForLeader)}
              disabled={isSettingLeader}
            >
              {isSettingLeader ? "ì²˜ë¦¬ ì¤‘..." : "ì§€ì •í•˜ê¸°"}
            </Button>
          </DialogFooter>
        </DialogContent>
      </Dialog>
    </div>
  )
}
</file>

<file path="components/customer-center/customer-center-content.tsx">
"use client"

import { useState } from "react"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { Textarea } from "@/components/ui/textarea"
import { Label } from "@/components/ui/label"
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "@/components/ui/select"
import { createInquiry } from "@/lib/actions/inquiries"
import { useToast } from "@/hooks/use-toast"
import { Loader2, Send } from "lucide-react"
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from "@/components/ui/card"

export function CustomerCenterContent() {
  const [inquiryType, setInquiryType] = useState("")
  const [inquiryTitle, setInquiryTitle] = useState("")
  const [inquiryContent, setInquiryContent] = useState("")
  const [isSubmitting, setIsSubmitting] = useState(false)
  const { toast } = useToast()

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    
    if (!inquiryType || !inquiryTitle.trim() || !inquiryContent.trim()) {
      toast({
        title: "ì…ë ¥ ì˜¤ë¥˜",
        description: "ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.",
        variant: "destructive",
      })
      return
    }

    setIsSubmitting(true)
    try {
      await createInquiry({
        type: inquiryType,
        title: inquiryTitle,
        content: inquiryContent,
      })

      toast({
        title: "ë¬¸ì˜ ë“±ë¡ ì™„ë£Œ",
        description: "ì†Œì¤‘í•œ ì˜ê²¬ ê°ì‚¬í•©ë‹ˆë‹¤. ë¹ ë¥¸ ì‹œì¼ ë‚´ì— ë‹µë³€ë“œë¦¬ê² ìŠµë‹ˆë‹¤.",
      })

      // í¼ ì´ˆê¸°í™”
      setInquiryType("")
      setInquiryTitle("")
      setInquiryContent("")
    } catch (error) {
      console.error("ë¬¸ì˜ ë“±ë¡ ì‹¤íŒ¨:", error)
      toast({
        title: "ë¬¸ì˜ ë“±ë¡ ì‹¤íŒ¨",
        description: error instanceof Error ? error.message : "ë¬¸ì˜ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.",
        variant: "destructive",
      })
    } finally {
      setIsSubmitting(false)
    }
  }

  const mainContent = (
    <div className="flex flex-col gap-6">
      <div className="flex flex-col gap-2 mb-2">
        <h1 className="text-2xl font-bold text-slate-900">ê³ ê°ì„¼í„°</h1>
        <p className="text-slate-600">ê¶ê¸ˆí•œ ì ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“ ì§€ ë¬¸ì˜í•´ì£¼ì„¸ìš”.</p>
      </div>

      <Card className="border-slate-200 shadow-sm bg-white">
        <CardHeader>
          <CardTitle className="flex items-center gap-2 text-lg">
            <Send className="h-5 w-5 text-indigo-600" />
            ë¬¸ì˜í•˜ê¸°
          </CardTitle>
          <CardDescription>
            ì„œë¹„ìŠ¤ ì´ìš© ì¤‘ ë¶ˆí¸í•œ ì ì´ë‚˜ ì œì•ˆí•˜ê³  ì‹¶ì€ ë‚´ìš©ì´ ìˆë‹¤ë©´ ì–¸ì œë“  ë§ì”€í•´ì£¼ì„¸ìš”.
          </CardDescription>
        </CardHeader>
        <CardContent>
          <form onSubmit={handleSubmit} className="space-y-6">
            <div className="space-y-2">
              <Label htmlFor="type" className="text-sm font-medium text-slate-900">
                ë¬¸ì˜ ìœ í˜• <span className="text-red-500">*</span>
              </Label>
              <Select value={inquiryType} onValueChange={setInquiryType} required>
                <SelectTrigger id="type" className="bg-white">
                  <SelectValue placeholder="ë¬¸ì˜ ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”" />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="service_inquiry">ì„œë¹„ìŠ¤ ì´ìš©ë¬¸ì˜</SelectItem>
                  <SelectItem value="bug_report">ì˜¤ë¥˜ ì œë³´</SelectItem>
                  <SelectItem value="feature_request">ê¸°ëŠ¥ ì œì•ˆ</SelectItem>
                  <SelectItem value="other">ê¸°íƒ€</SelectItem>
                </SelectContent>
              </Select>
            </div>

            <div className="space-y-2">
              <Label htmlFor="title" className="text-sm font-medium text-slate-900">
                ì œëª© <span className="text-red-500">*</span>
              </Label>
              <Input
                id="title"
                placeholder="ë¬¸ì˜ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”"
                value={inquiryTitle}
                onChange={(e) => setInquiryTitle(e.target.value)}
                required
                className="bg-white"
              />
            </div>

            <div className="space-y-2">
              <Label htmlFor="content" className="text-sm font-medium text-slate-900">
                ë‚´ìš© <span className="text-red-500">*</span>
              </Label>
              <Textarea
                id="content"
                placeholder="ë¬¸ì˜ ë‚´ìš©ì„ ìì„¸íˆ ì…ë ¥í•˜ì„¸ìš”"
                value={inquiryContent}
                onChange={(e) => setInquiryContent(e.target.value)}
                required
                rows={10}
                className="resize-none bg-white"
              />
            </div>

            <div className="flex justify-end">
              <Button
                type="submit"
                disabled={isSubmitting}
                className="w-full sm:w-auto min-w-[120px]"
              >
                {isSubmitting ? (
                  <>
                    <Loader2 className="mr-2 h-4 w-4 animate-spin" />
                    ë“±ë¡ ì¤‘...
                  </>
                ) : (
                  "ë¬¸ì˜ ë“±ë¡í•˜ê¸°"
                )}
              </Button>
            </div>
          </form>
        </CardContent>
      </Card>
    </div>
  )

  return mainContent
}
</file>

<file path="components/daily-login-checker.tsx">
"use client"

import { useEffect } from "react"
import { createClient } from "@/lib/supabase/client"

export function DailyLoginChecker() {
  useEffect(() => {
    const checkDailyLogin = async () => {
      const supabase = createClient()
      const {
        data: { user },
      } = await supabase.auth.getUser()

      if (user) {
        // ì¼ì¼ ë¡œê·¸ì¸ í¬ì¸íŠ¸ ì²´í¬ í•¨ìˆ˜ í˜¸ì¶œ
        try {
          await supabase.rpc("check_daily_login_points")
        } catch (error) {
          console.error("Failed to check daily login points:", error)
        }
      }
    }

    checkDailyLogin()
  }, [])

  return null
}
</file>

<file path="components/dashboard-layout.tsx">
import type { ReactNode } from "react"
import { cn } from "@/lib/utils"
import { Sidebar } from "@/components/sidebar"
import { MobileHeader } from "@/components/mobile-header"

interface DashboardLayoutProps {
  children: ReactNode
  header?: ReactNode
  rightSidebar?: ReactNode
  sidebarProfile?: ReactNode
  userRole?: string | null
  sidebar?: ReactNode
  mobileHeader?: ReactNode
}

export function DashboardLayout({ children, header, rightSidebar, sidebarProfile, userRole, sidebar, mobileHeader }: DashboardLayoutProps) {
  const hasAside = Boolean(rightSidebar || sidebarProfile)

  return (
    <div className="min-h-screen bg-slate-50">
      {/* 1. Global Header - Desktop only (lg ì´ìƒì—ì„œë§Œ í‘œì‹œ) */}
      {header && (
        <div className="hidden lg:block">
          {header}
        </div>
      )}

      {/* 2. Mobile Header (lg ë¯¸ë§Œì—ì„œë§Œ í‘œì‹œ) */}
      <div className="lg:hidden">
        {mobileHeader ? mobileHeader : <MobileHeader userRole={userRole} />}
      </div>

      {/* 2. Left Sidebar: Header ì•„ë˜ ë°°ì¹˜ (top-16) */}
      <aside className="fixed top-16 left-0 z-40 hidden h-[calc(100vh-4rem)] w-72 border-r border-slate-200/50 bg-white lg:block overflow-y-auto">
        {sidebar ? sidebar : <Sidebar userRole={userRole} />}
      </aside>

      {/* 3. Main Content Wrapper: Header ë†’ì´(pt-16) + Sidebar ë„ˆë¹„(pl-72) */}
      <main
        className={cn(
          "min-h-screen w-full transition-all duration-200 ease-in-out",
          header ? "pt-16 lg:pl-72" : "lg:pl-72"
        )}
      >
        <div
          className={cn(
            "w-full",
            hasAside ? "grid grid-cols-1 xl:grid-cols-[minmax(0,1fr)_20rem] gap-8" : ""
          )}
        >
          <div className={cn(hasAside ? "min-w-0" : "w-full")}>{children}</div>
          {hasAside && (
            <aside className="hidden lg:block">
              <div className="space-y-6 w-80">
                {sidebarProfile}
                {rightSidebar}
              </div>
            </aside>
          )}
        </div>
      </main>
    </div>
  )
}
</file>

<file path="components/event-share-button.tsx">
"use client"

import { Share2, Check } from "lucide-react"
import { Button } from "@/components/ui/button"
import { useState } from "react"
import { toast } from "@/hooks/use-toast"

type EventShareButtonProps = {
  title: string
  description?: string
  className?: string
  variant?: "default" | "outline" | "ghost" | "link" | "destructive" | "secondary"
  size?: "default" | "sm" | "lg" | "icon"
  children?: React.ReactNode
}

export function EventShareButton({
  title,
  description,
  className,
  variant = "outline",
  size = "default",
  children
}: EventShareButtonProps) {
  const [copied, setCopied] = useState(false)

  const handleShare = async () => {
    // í˜„ì¬ URLì´ ì´ë¯¸ ì§§ì€ ì½”ë“œ(/e/xxx)ì¸ ê²½ìš° ê·¸ëŒ€ë¡œ ì‚¬ìš©
    const currentUrl = window.location.href
    let shortUrl: string
    
    // /e/ ê²½ë¡œì¸ ê²½ìš° ê·¸ëŒ€ë¡œ ì‚¬ìš©
    if (currentUrl.includes('/e/')) {
      shortUrl = currentUrl
    } else {
      // /events/ ê²½ë¡œì¸ ê²½ìš° ì§§ì€ ì½”ë“œë¡œ ë³€í™˜
      const urlMatch = currentUrl.match(/\/events\/([^\/]+)/)
      if (urlMatch) {
        const fullId = urlMatch[1]
        // UUIDì˜ ì• 8ìë§Œ ì‚¬ìš© (ì„ì‹œ, ì‹¤ì œë¡œëŠ” ë‚ ì§œ ê¸°ë°˜ ì½”ë“œ ì‚¬ìš©)
        const shortId = fullId.substring(0, 8)
        shortUrl = currentUrl.replace(`/events/${fullId}`, `/e/${shortId}`)
      } else {
        // URL íŒŒì‹± ì‹¤íŒ¨ ì‹œ ê¸°ì¡´ ë°©ì‹ ì‚¬ìš©
        shortUrl = currentUrl.replace('/events/', '/e/')
      }
    }

    // 1. ëª¨ë°”ì¼ ë„¤ì´í‹°ë¸Œ ê³µìœ  (Web Share API) - ëª¨ë°”ì¼ì—ì„œë§Œ ì‹¤í–‰
    const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent)

    if (isMobile && navigator.share) {
      try {
        await navigator.share({
          title: title,
          text: description || title,
          url: shortUrl,
        })
        toast({
          description: "ê³µìœ ë˜ì—ˆìŠµë‹ˆë‹¤!",
          duration: 2000,
        })
        return
      } catch (error: any) {
        // ì‚¬ìš©ìê°€ ê³µìœ ë¥¼ ì·¨ì†Œí•œ ê²½ìš°ëŠ” ì •ìƒ ë™ì‘ì´ë¯€ë¡œ fallbackí•˜ì§€ ì•ŠìŒ
        if (error.name === 'AbortError') {
          return
        }
        // ë‹¤ë¥¸ ì—ëŸ¬ë©´ í´ë¦½ë³´ë“œ ë³µì‚¬ë¡œ fallback
        if (process.env.NODE_ENV === 'development') {
          console.log('Share API error, falling back to clipboard:', error)
        }
      }
    }

    // 2. PC ë“± ë¯¸ì§€ì› ë¸Œë¼ìš°ì €: í´ë¦½ë³´ë“œ ë³µì‚¬
    try {
      await navigator.clipboard.writeText(shortUrl)
      setCopied(true)
      toast({
        description: "ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!",
        duration: 2000,
      })
      setTimeout(() => setCopied(false), 2000)
    } catch (err) {
      console.error('Failed to copy:', err)
      toast({
        title: "ë³µì‚¬ ì‹¤íŒ¨",
        description: "ë§í¬ë¥¼ ë³µì‚¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ìˆ˜ë™ìœ¼ë¡œ ë³µì‚¬í•´ì£¼ì„¸ìš”.",
        variant: "destructive",
      })
    }
  }

  return (
    <Button
      variant={variant}
      size={size}
      onClick={handleShare}
      className={className}
    >
      {children ? (
        <>
          {copied ? (
            <>
              <Check className="h-4 w-4 mr-2" />
              ë³µì‚¬ë¨
            </>
          ) : (
            <>
              <Share2 className="h-4 w-4 mr-2" />
              {children}
            </>
          )}
        </>
      ) : (
        copied ? <Check className="h-4 w-4" /> : <Share2 className="h-4 w-4" />
      )}
    </Button>
  )
}
</file>

<file path="components/export-csv-button.tsx">
"use client";

import { Button } from "@/components/ui/button";
import { Download } from "lucide-react";

type Registration = {
  id: string;
  user_id: string | null;
  registered_at: string;
  guest_name?: string | null;
  guest_contact?: string | null;
  profiles?: {
    full_name?: string | null;
    email?: string | null;
  } | null;
};

type CustomField = {
  id: string;
  field_name: string;
  field_type: string;
  field_options: string[] | null;
  is_required: boolean;
};

type ExportCSVButtonProps = {
  registrations: Registration[];
  customFields: CustomField[];
  responseMap: Record<string, Record<string, string>>;
  eventTitle: string;
};

export function ExportCSVButton({
  registrations,
  customFields,
  responseMap,
  eventTitle,
}: ExportCSVButtonProps) {
  const handleExport = () => {
    // CSV í—¤ë” ìƒì„±
    const headers = ['ì´ë¦„', 'ì´ë©”ì¼/ì—°ë½ì²˜', 'ì‹ ì²­ì¼', 'ê²ŒìŠ¤íŠ¸ ì—¬ë¶€', ...customFields.map(f => f.field_name)];
    
    // CSV ë°ì´í„° ìƒì„±
    const rows = registrations.map((registration) => {
      const isGuest = !registration.user_id;
      const name = isGuest
        ? (registration.guest_name || "ê²ŒìŠ¤íŠ¸")
        : ((registration.profiles as any)?.full_name || "ìµëª…");
      const contact = isGuest
        ? (registration.guest_contact || '')
        : ((registration.profiles as any)?.email || '');
      const date = new Date(registration.registered_at).toLocaleString("ko-KR");
      const guestStatus = isGuest ? 'ê²ŒìŠ¤íŠ¸' : 'íšŒì›';
      
      const fieldResponses = customFields.map(field => {
        const response = responseMap[registration.id]?.[field.id] || '';
        // CSVì—ì„œ ì‰¼í‘œì™€ ë”°ì˜´í‘œ ì²˜ë¦¬
        return `"${String(response).replace(/"/g, '""')}"`;
      });
      
      return [name, contact, date, guestStatus, ...fieldResponses];
    });
    
    // CSV ë¬¸ìì—´ ìƒì„±
    const csvContent = [
      headers.map(h => `"${h.replace(/"/g, '""')}"`).join(','),
      ...rows.map(row => row.join(','))
    ].join('\n');
    
    // BOM ì¶”ê°€ (í•œê¸€ ê¹¨ì§ ë°©ì§€)
    const BOM = '\uFEFF';
    const blob = new Blob([BOM + csvContent], { type: 'text/csv;charset=utf-8;' });
    
    // ë‹¤ìš´ë¡œë“œ
    const link = document.createElement('a');
    const url = URL.createObjectURL(blob);
    link.setAttribute('href', url);
    link.setAttribute('download', `${eventTitle}_ì°¸ê°€ì_ëª©ë¡_${new Date().toISOString().split('T')[0]}.csv`);
    link.style.visibility = 'hidden';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  };

  return (
    <Button
      variant="outline"
      size="sm"
      onClick={handleExport}
      className="gap-2"
    >
      <Download className="h-4 w-4" />
      CSV ë‹¤ìš´ë¡œë“œ
    </Button>
  );
}
</file>

<file path="components/home/announcement-banner.tsx">
import { createClient } from "@/lib/supabase/server"
import Link from "next/link"
import { Megaphone, ChevronRight } from "lucide-react"

export default async function AnnouncementBanner() {
  const supabase = await createClient()

  // 1. ìµœì‹  ê³µì§€ì‚¬í•­ 1ê°œë§Œ ê°€ì ¸ì˜¤ê¸° (ë‚ ì§œ ì •ë³´ í¬í•¨)
  const { data: announcement } = await supabase
    .from("posts")
    .select("id, title, created_at, board_categories!inner(slug)")
    .eq("board_categories.slug", "announcement")
    .eq("visibility", "public")
    .order("created_at", { ascending: false })
    .limit(1)
    .maybeSingle()

  // ê³µì§€ì‚¬í•­ì´ ì—†ìœ¼ë©´ ë°°ë„ˆ ìì²´ë¥¼ ë³´ì—¬ì£¼ì§€ ì•ŠìŒ
  if (!announcement) return null

  // ë‚ ì§œ í¬ë§·íŒ… (ì˜ˆ: 2024.01.15)
  const formatDate = (dateString: string) => {
    const date = new Date(dateString)
    const year = date.getFullYear()
    const month = String(date.getMonth() + 1).padStart(2, '0')
    const day = String(date.getDate()).padStart(2, '0')
    return `${year}.${month}.${day}`
  }

  const category = Array.isArray(announcement.board_categories) ? announcement.board_categories[0] : announcement.board_categories
  const formattedDate = announcement.created_at ? formatDate(announcement.created_at) : ''

  return (
    <div className="bg-slate-50 border-b border-slate-200">
      <div className="mx-auto max-w-7xl px-4 md:px-8">
        <Link 
          href={`/community/board/${category?.slug || "announcement"}/${announcement.id}`}
          className="flex items-center gap-3 py-3 px-4 rounded-lg hover:bg-slate-100 transition-colors group"
        >
          {/* ì™¼ìª½: ì•„ì´ì½˜ + ê³µì§€ ë°°ì§€ */}
          <div className="flex items-center gap-2 flex-shrink-0">
            <Megaphone className="h-4 w-4 text-slate-500" />
            <span className="px-2 py-0.5 bg-blue-100 text-blue-700 text-xs font-semibold rounded">
              ê³µì§€
            </span>
          </div>

          {/* ì¤‘ì•™: ê³µì§€ì‚¬í•­ ì œëª© (truncate) */}
          <div className="flex-1 min-w-0">
            <span className="text-sm font-medium text-slate-900 truncate block">
              {announcement.title}
            </span>
          </div>

          {/* ì˜¤ë¥¸ìª½: ë‚ ì§œ + í™”ì‚´í‘œ */}
          <div className="flex items-center gap-2 flex-shrink-0">
            {formattedDate && (
              <span className="text-xs text-slate-500 hidden sm:inline">
                {formattedDate}
              </span>
            )}
            <ChevronRight className="h-4 w-4 text-slate-400 group-hover:text-slate-600 group-hover:translate-x-0.5 transition-all" />
          </div>
        </Link>
      </div>
    </div>
  )
}
</file>

<file path="components/home/events-section-container.tsx">
import { createClient } from "@/lib/supabase/server"
import { getUpcomingEvents } from "@/lib/queries/events"
import { getEventShortUrlSync } from "@/lib/utils/event-url"
import { EventsSection } from "@/components/home/events-section"

export async function EventsSectionContainer() {
    const supabase = await createClient()
    const events = await getUpcomingEvents(supabase, 4)

    // shortUrlì„ ë™ê¸°ì‹ìœ¼ë¡œ ìƒì„± (DB í˜¸ì¶œ ì—†ìŒ - ì„±ëŠ¥ ìµœì í™”)
    const formattedEvents = events.map((event) => ({
        ...event,
        shortUrl: getEventShortUrlSync(event.id, event.event_date)
    }))

    return <EventsSection events={formattedEvents as any} title="ì£¼ìš” ì´ë²¤íŠ¸" createLink="/e/new" showFilters={false} />
}
</file>

<file path="components/home/feed-section-container.tsx">
import { fetchFeedPosts } from "@/lib/actions/feed"
import { FeedSection } from "@/components/home/feed-section"

export async function FeedSectionContainer() {
    const posts = await fetchFeedPosts(1, "latest")
    return <FeedSection initialPosts={posts as any} />
}
</file>

<file path="components/home/filter-buttons.tsx">
"use client"

import * as React from "react"
import * as ToggleGroupPrimitive from "@radix-ui/react-toggle-group"
import { cn } from "@/lib/utils"

type BoardCategory = {
  id: string
  name: string
  slug: string
}

interface FilterButtonsProps {
  categories: BoardCategory[]
  selectedSlug: string
  onSelect: (slug: string) => void
}

export function FilterButtons({ categories, selectedSlug, onSelect }: FilterButtonsProps) {
  return (
    <ToggleGroupPrimitive.Root
      type="single"
      value={selectedSlug}
      onValueChange={(value) => {
        if (value) onSelect(value)
      }}
      className="flex flex-wrap gap-2 overflow-x-auto pb-2"
    >
      <ToggleGroupPrimitive.Item
        value="all"
        className={cn(
          "px-4 py-1.5 rounded-full border font-medium transition whitespace-nowrap text-sm",
          "focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-400 focus-visible:ring-offset-2",
          selectedSlug === "all"
            ? "bg-slate-900 text-white border-slate-900"
            : "bg-white border-slate-200 text-slate-700 hover:bg-slate-50"
        )}
      >
        ì „ì²´
      </ToggleGroupPrimitive.Item>
      {categories.map((category) => (
        <ToggleGroupPrimitive.Item
          key={category.id}
          value={category.slug}
          className={cn(
            "px-4 py-1.5 rounded-full border font-medium transition whitespace-nowrap text-sm",
            "focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-400 focus-visible:ring-offset-2",
            selectedSlug === category.slug
              ? "bg-slate-900 text-white border-slate-900"
              : "bg-white border-slate-200 text-slate-700 hover:bg-slate-50"
          )}
        >
          {category.name}
        </ToggleGroupPrimitive.Item>
      ))}
    </ToggleGroupPrimitive.Root>
  )
}
</file>

<file path="components/home/hero-section-container.tsx">
import { getCachedUserProfile } from "@/lib/queries/cached"
import { HeroSection } from "@/components/home/hero-section"

export async function HeroSectionContainer() {
    const userProfile = await getCachedUserProfile()
    const user = userProfile?.user || null
    const profile = userProfile?.profile || null

    return <HeroSection user={user} profile={profile} loginHref="/auth/login" />
}
</file>

<file path="components/home/latest-feed.tsx">
"use client"

import Link from "next/link"
import { PostCard } from "@/components/ui/post-card"
import type { PostForDisplay } from "@/lib/types/posts"
import { Card, CardContent } from "@/components/ui/card"
import { Button } from "@/components/ui/button"

type LatestFeedProps = {
  posts: PostForDisplay[]
}

export function LatestFeed({ posts }: LatestFeedProps) {
  return (
    <section className="space-y-4">
      <div className="flex items-center justify-between">
        <h2 className="text-lg sm:text-xl font-bold text-slate-900">ğŸ’¬ ìµœì‹  ì´ì•¼ê¸°</h2>
        <Link href="/community" className="text-sm font-medium text-indigo-600 hover:text-indigo-700">
          ë” ë³´ê¸°
        </Link>
      </div>

      <div className="w-full space-y-3">
        {posts.length === 0 ? (
          <EmptyState />
        ) : (
          posts.map((post) => (
            <PostCard
              key={post.id}
              postId={post.id}
              href={`/community/board/${post.board_categories?.slug ?? "community"}/${post.id}`}
              community={{
                name: post.board_categories?.name ?? "ì»¤ë®¤ë‹ˆí‹°",
                href: `/community/board/${post.board_categories?.slug ?? "community"}`,
                iconUrl: post.thumbnail_url ?? undefined,
              }}
              author={{ name: post.profiles?.full_name ?? "ìµëª…", avatarUrl: post.profiles?.avatar_url }}
              createdAt={post.created_at}
              title={post.title}
              content={post.content ?? undefined}
              contentRaw={(post as any).content ?? undefined}
              thumbnailUrl={post.thumbnail_url ?? undefined}
              commentsCount={post.comments_count ?? 0}
            />
          ))
        )}
      </div>
    </section>
  )
}

function EmptyState() {
  return (
    <Card className="border-dashed border-slate-200">
      <CardContent className="p-6 text-center space-y-3">
        <p className="text-sm text-slate-500">ì•„ì§ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤. ì²« ê¸€ì„ ì‘ì„±í•´ë³´ì„¸ìš”!</p>
        <Button asChild size="sm">
          <Link href="/community/posts/new">ê¸€ì“°ê¸°</Link>
        </Button>
      </CardContent>
    </Card>
  )
}
</file>

<file path="components/home/posts-section.tsx">
"use client"

import { useState, useMemo } from "react"
import { ToggleGroup, ToggleGroupItem } from "@/components/ui/toggle-group"
import { PostListItem } from "@/components/ui/post-list-item"
import { InsightCard } from "@/components/ui/insight-card"
import { Empty, EmptyContent, EmptyDescription, EmptyHeader, EmptyTitle, EmptyMedia } from "@/components/ui/empty"
import { Button } from "@/components/ui/button"
import { Skeleton } from "@/components/ui/skeleton"
import { LayoutGrid, List } from "lucide-react"
import Link from "next/link"
import { cn } from "@/lib/utils"

type Post = {
  id: string
  title: string
  content?: string | null
  created_at: string
  visibility?: "public" | "group"
  likes_count?: number
  comments_count?: number
  board_categories?: {
    name?: string | null
    slug?: string | null
  } | null
  profiles?: {
    full_name?: string | null
  } | null
  communities?: {
    name?: string | null
  } | null
  isMember?: boolean
}

type BoardCategory = {
  id: string
  name: string
  slug: string
}

interface PostsSectionProps {
  posts: Post[]
  boardCategories: BoardCategory[]
  selectedBoard?: string
  onBoardChange?: (slug: string) => void
  isLoading?: boolean
  hideTabs?: boolean // ì¹´í…Œê³ ë¦¬ í•„í„° íƒ­ ìˆ¨ê¸°ê¸° (ê°œë³„ ê²Œì‹œíŒìš©)
  viewMode?: "feed" | "list" | "blog" // blog ëª¨ë“œ ì¶”ê°€
  isInsight?: boolean // ì¸ì‚¬ì´íŠ¸ ê²Œì‹œíŒ ì—¬ë¶€ (viewMode="blog"ì™€ ë™ì¼ íš¨ê³¼)
  onViewModeChange?: (mode: "feed" | "list") => void // ë·° ëª¨ë“œ ë³€ê²½ ì½œë°±
  hideViewToggle?: boolean // ë·° ëª¨ë“œ í† ê¸€ ìˆ¨ê¸°ê¸° (ì™¸ë¶€ì—ì„œ ì œì–´í•  ë•Œ)
}

export function PostsSection({ 
  posts, 
  boardCategories,
  selectedBoard = "all",
  onBoardChange,
  isLoading = false,
  hideTabs = false,
  viewMode: propViewMode,
  isInsight = false,
  onViewModeChange,
  hideViewToggle = false
}: PostsSectionProps) {
  
  const [internalSelectedBoard, setInternalSelectedBoard] = useState("all")
  // ê³µì§€ì‚¬í•­/ììœ ê²Œì‹œíŒì€ ê¸°ë³¸ê°’ì„ "list"ë¡œ ì„¤ì •, ë‚˜ë¨¸ì§€ëŠ” "feed"
  const defaultViewMode = (selectedBoard === "announcement" || selectedBoard === "announcements" || selectedBoard === "free" || selectedBoard === "free-board") ? "list" : "feed"
  const [internalViewMode, setInternalViewMode] = useState<"feed" | "list">(propViewMode && propViewMode !== "blog" ? propViewMode : defaultViewMode)
  
  // propViewModeê°€ ìˆìœ¼ë©´ ê·¸ê²ƒì„ ì‚¬ìš©, ì—†ìœ¼ë©´ ë‚´ë¶€ ìƒíƒœ ì‚¬ìš©
  // isInsightê°€ trueë©´ ìë™ìœ¼ë¡œ blog ëª¨ë“œ
  const viewMode = isInsight ? "blog" : (propViewMode || internalViewMode)
  
  // ë·° ëª¨ë“œ ë³€ê²½ í•¸ë“¤ëŸ¬
  const handleViewModeChange = (mode: "feed" | "list") => {
    if (propViewMode && onViewModeChange) {
      // ì™¸ë¶€ì—ì„œ ì œì–´í•˜ëŠ” ê²½ìš°
      onViewModeChange(mode)
    } else {
      // ë‚´ë¶€ì—ì„œ ì œì–´í•˜ëŠ” ê²½ìš°
      setInternalViewMode(mode)
    }
  }
  const isBlogMode = viewMode === "blog"
  const currentBoard = onBoardChange ? selectedBoard : internalSelectedBoard
  const handleBoardChange = onBoardChange 
    ? onBoardChange 
    : (val: string) => setInternalSelectedBoard(val || "all")

  // ì œì™¸í•  ìŠ¬ëŸ¬ê·¸ ëª©ë¡ (ê³µì§€ì‚¬í•­, ììœ ê²Œì‹œíŒ, ì—´ì–´ì£¼ì„¸ìš”)
  const excludedSlugs = ['announcement', 'announcements', 'free', 'free-board', 'event-requests', 'requests']

  const filteredPosts = useMemo(() => {
    // 1. ê°œë³„ ê²Œì‹œíŒ ëª¨ë“œ(hideTabs=true)ë©´ í•„í„°ë§ ì—†ì´ ì›ë³¸ ê·¸ëŒ€ë¡œ ë°˜í™˜
    // ê°œë³„ ê²Œì‹œíŒ í˜ì´ì§€ì—ì„œëŠ” ì´ë¯¸ ì¿¼ë¦¬ ë‹¨ê³„ì—ì„œ í•„ìš”í•œ ê¸€ë§Œ ê°€ì ¸ì˜¤ê¸° ë•Œë¬¸
    if (hideTabs) {
      return posts;
    }

    // 2. í†µí•© í”¼ë“œ ëª¨ë“œ(hideTabs=false)ë©´ ì œì™¸ ëª©ë¡ì— ìˆëŠ” ì¹´í…Œê³ ë¦¬ì˜ ê¸€ì„ ìˆ¨ê¹€
    const baseFiltered = posts.filter((post) => {
      const postSlug = post.board_categories?.slug
      return !postSlug || !excludedSlugs.includes(postSlug)
    })

    if (currentBoard === "all") {
      return baseFiltered
    }
    return baseFiltered.filter(
      (post) => post.board_categories?.slug === currentBoard
    )
  }, [posts, currentBoard, hideTabs, excludedSlugs])

  // ì¤‘ë³µ ì¹´í…Œê³ ë¦¬ ì œê±° ë° ì œì™¸ ëª©ë¡ ì ìš© (slug ê¸°ì¤€)
  const uniqueCategories = useMemo(() => {
    const unique = new Map();
    boardCategories.forEach(cat => {
      // íƒ­ ìƒì„± ì‹œì—ë„ ì œì™¸ ëª©ë¡ ì ìš©
      if (!excludedSlugs.includes(cat.slug) && !unique.has(cat.slug)) {
        unique.set(cat.slug, cat);
      }
    });
    return Array.from(unique.values());
  }, [boardCategories, excludedSlugs]);

  return (
    <div className="w-full space-y-6 bg-transparent">
      {/* ìƒë‹¨ í—¤ë” ì˜ì—­: ì œëª© + ë·° ëª¨ë“œ í† ê¸€ */}
      <div className="flex items-center justify-between">
        {/* hideTabsê°€ trueì¼ ë•ŒëŠ” 'ìµœì‹  ê¸€' ì œëª© ìˆ¨ê¹€ (ê°œë³„ ê²Œì‹œíŒì—ì„œëŠ” PageHeaderê°€ ì´ë¯¸ ìˆìŒ) */}
        {!hideTabs && (
          <h2 className="text-2xl md:text-3xl font-bold text-slate-900">ìµœì‹  ê¸€</h2>
        )}
        
        {/* ë·° ëª¨ë“œ í† ê¸€ (ë¸”ë¡œê·¸ ëª¨ë“œì¼ ë•ŒëŠ” ìˆ¨ê¹€, hideViewToggleì´ trueì¼ ë•Œë„ ìˆ¨ê¹€) */}
        {!isBlogMode && !hideViewToggle && (
          <div className={cn(
            "inline-flex items-center p-1 bg-slate-100/80 rounded-xl",
            hideTabs && "ml-auto" // hideTabsì¼ ë•ŒëŠ” ìš°ì¸¡ ì •ë ¬
          )}>
            <button
              onClick={() => handleViewModeChange("feed")}
              className={cn(
                "flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium transition-all duration-200",
                viewMode === "feed"
                  ? "bg-white text-slate-900 shadow-sm font-bold"
                  : "text-slate-500 hover:text-slate-700"
              )}
            >
              <LayoutGrid className="h-3.5 w-3.5" />
              <span className="hidden sm:inline">í”¼ë“œí˜•</span>
            </button>
            <button
              onClick={() => handleViewModeChange("list")}
              className={cn(
                "flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium transition-all duration-200",
                viewMode === "list"
                  ? "bg-white text-slate-900 shadow-sm font-bold"
                  : "text-slate-500 hover:text-slate-700"
              )}
            >
              <List className="h-3.5 w-3.5" />
              <span className="hidden sm:inline">ë¦¬ìŠ¤íŠ¸í˜•</span>
            </button>
          </div>
        )}
      </div>

      {/* ì¹´í…Œê³ ë¦¬ í•„í„° (hideTabsê°€ falseì¼ ë•Œë§Œ í‘œì‹œ) */}
      {!hideTabs && (
        <div className="overflow-x-auto pb-2 scrollbar-hide">
          <ToggleGroup
            type="single"
            value={currentBoard}
            onValueChange={handleBoardChange}
            // â˜… ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼: ì—°í•œ íšŒìƒ‰ ë°°ê²½, ë‘¥ê·¼ ëª¨ì„œë¦¬, ë‚´ë¶€ íŒ¨ë”©
            className="inline-flex items-center p-1.5 rounded-2xl bg-slate-100/80 w-auto"
          >
            <ToggleGroupItem 
              value="all" 
              aria-label="ì „ì²´" 
              // â˜… ì•„ì´í…œ ìŠ¤íƒ€ì¼: ì„ íƒ ì‹œ í°ìƒ‰ ë°°ê²½ + ê·¸ë¦¼ì + íŒŒë€ í…ìŠ¤íŠ¸ / ë¹„ì„ íƒ ì‹œ íšŒìƒ‰ í…ìŠ¤íŠ¸
              className="rounded-xl px-4 py-2 text-sm font-medium text-slate-500 transition-all hover:text-slate-700 data-[state=on]:bg-white data-[state=on]:text-slate-900 data-[state=on]:shadow-sm data-[state=on]:font-bold h-9"
            >
              ì „ì²´
            </ToggleGroupItem>
            
            {uniqueCategories.map((category) => (
              <ToggleGroupItem
                key={category.id}
                value={category.slug}
                aria-label={category.name}
                className="rounded-xl px-4 py-2 text-sm font-medium text-slate-500 transition-all hover:text-slate-700 data-[state=on]:bg-white data-[state=on]:text-slate-900 data-[state=on]:shadow-sm data-[state=on]:font-bold h-9"
              >
                {category.name}
              </ToggleGroupItem>
            ))}
          </ToggleGroup>
        </div>
      )}

      {/* Posts List */}
      {/* ë¸”ë¡œê·¸ ëª¨ë“œì¼ ë•ŒëŠ” space-y-6, ë¦¬ìŠ¤íŠ¸ ë·°ì¼ ë•ŒëŠ” space-y-0 */}
      <div className={cn(
        "w-full",
        isBlogMode 
          ? "space-y-6" 
          : viewMode === "feed" 
            ? "space-y-4" 
            : "space-y-0 flex flex-col border-t border-slate-100"
      )}>
        {isLoading ? (
          [1, 2, 3, 4, 5].map((i) => {
            // ë¸”ë¡œê·¸ ëª¨ë“œì¼ ë•ŒëŠ” ë¸”ë¡œê·¸ ìŠ¤íƒ€ì¼ ìŠ¤ì¼ˆë ˆí†¤
            if (isBlogMode) {
              return (
                <div key={i} className="w-full bg-white border border-slate-200 rounded-2xl overflow-hidden">
                  <div className="flex flex-col md:flex-row">
                    <div className="flex-1 p-6 md:p-8">
                      <Skeleton className="h-5 w-20 mb-3" />
                      <Skeleton className="h-7 w-3/4 mb-3" />
                      <Skeleton className="h-4 w-full mb-2" />
                      <Skeleton className="h-4 w-2/3 mb-6" />
                      <div className="flex items-center gap-3 pt-4 border-t border-slate-100">
                        <Skeleton className="h-10 w-10 rounded-full" />
                        <Skeleton className="h-4 w-32" />
                      </div>
                    </div>
                    <Skeleton className="w-full md:w-64 lg:w-80 h-48 md:h-full" />
                  </div>
                </div>
              )
            }
            
            // ì¼ë°˜ ëª¨ë“œ ìŠ¤ì¼ˆë ˆí†¤
            return (
              <div key={i} className={cn(
                "w-full bg-white",
                viewMode === "feed" ? "h-24 rounded-xl border border-gray-200 p-4" : "h-16 border-b border-gray-100 px-4 py-3"
              )}>
                <Skeleton className="h-4 w-3/4 mb-2" />
                <Skeleton className="h-3 w-1/4" />
              </div>
            )
          })
        ) : filteredPosts.length > 0 ? (
          filteredPosts.map((post) => {
            const boardSlug = post.board_categories?.slug || "free-board"
            
            // ë¸”ë¡œê·¸ ëª¨ë“œì¼ ë•Œ InsightCard ì‚¬ìš©
            if (isBlogMode) {
              return (
                <InsightCard
                  key={post.id}
                  post={post}
                  href={`/community/board/${boardSlug}/${post.id}`}
                  hideCategory={hideTabs}
                />
              )
            }
            
            // ì¼ë°˜ ëª¨ë“œì¼ ë•Œ PostListItem ì‚¬ìš©
            return (
              <PostListItem
                key={post.id}
                post={post}
                href={`/community/board/${boardSlug}/${post.id}`}
                isMember={post.isMember ?? true}
                viewMode={viewMode}
                hideCategory={hideTabs}
              />
            )
          })
        ) : (
          <div className="p-16">
            <Empty className="bg-transparent">
              <EmptyHeader>
                <EmptyMedia variant="icon">
                  <svg className="h-16 w-16 text-slate-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                  </svg>
                </EmptyMedia>
                <EmptyTitle className="text-xl font-semibold text-slate-900">ì•„ì§ ì¡°ìš©í•˜ë„¤ìš” ğŸƒ</EmptyTitle>
                <EmptyDescription className="text-slate-500">ê°€ì¥ ë¨¼ì € ëŒ€í™”ë¥¼ ì‹œì‘í•´ë³´ì„¸ìš”!</EmptyDescription>
              </EmptyHeader>
              <EmptyContent>
                <Button asChild className="bg-slate-900 hover:bg-slate-800 text-white rounded-xl px-6">
                  <Link href="/community/posts/new">ê¸€ ì‘ì„±í•˜ê¸°</Link>
                </Button>
              </EmptyContent>
            </Empty>
          </div>
        )}
      </div>
    </div>
  )
}
</file>

<file path="components/home/reviews-section.tsx">
"use client"

import { useRef } from "react"
import { Swiper, SwiperSlide } from "swiper/react"
import { Navigation } from "swiper/modules"
import type { Swiper as SwiperType } from "swiper"
import { Skeleton } from "@/components/ui/skeleton"
import { cn } from "@/lib/utils"
import Image from "next/image"
import Link from "next/link"
import { MessageSquare, Heart } from "lucide-react"

import {
  Empty,
  EmptyContent,
  EmptyDescription,
  EmptyHeader,
  EmptyTitle,
} from "@/components/ui/empty"

import "swiper/css"
import "swiper/css/navigation"

import type { ReviewForDisplay } from "@/lib/types/posts"

type ReviewsSectionProps = {
  reviews: ReviewForDisplay[]
  isLoading?: boolean
}

// ë¡œì»¬ ReviewCard ì œê±°ë¨
import { ReviewCard } from "@/components/reviews/review-card"

export function ReviewsSection({ reviews, isLoading = false }: ReviewsSectionProps) {
  const swiperRef = useRef<SwiperType | null>(null)
  const hasReviews = reviews && reviews.length > 0

  return (
    <div className="w-full">
      {/* í—¤ë” */}
      <div className="flex items-center justify-between w-full mb-6">
        <h2 className="text-3xl font-bold text-slate-900">í›„ê¸° í•˜ì´ë¼ì´íŠ¸</h2>
      </div>

      {/* 1. ë¡œë”© ì¤‘ì¼ ë•Œ: ìŠ¤ì¼ˆë ˆí†¤ UI í‘œì‹œ */}
      {isLoading ? (
        <div className="md:hidden -mx-4 px-4">
          <div className="flex gap-4 overflow-hidden">
            {[1, 2].map((i) => (
              <div key={i} className="w-[85%] flex-shrink-0">
                <Skeleton className="w-full h-[280px] rounded-2xl" />
              </div>
            ))}
          </div>
        </div>
      ) : !hasReviews ? (
        /* 2. ë¡œë”© ëë‚¬ëŠ”ë° ë°ì´í„° ì—†ì„ ë•Œ: Empty UI í‘œì‹œ */
        <div className="bg-white border border-gray-200 rounded-3xl shadow-sm p-10">
          <Empty>
            <EmptyHeader>
              <EmptyTitle>ì•„ì§ í›„ê¸°ê°€ ì—†ì–´ìš”</EmptyTitle>
              <EmptyDescription>
                ì²« ë²ˆì§¸ ëª¨ì„ í›„ê¸°ë¥¼ ì‘ì„±í•´ë³´ì„¸ìš”.
              </EmptyDescription>
            </EmptyHeader>
          </Empty>
        </div>
      ) : (
        /* 3. ë°ì´í„° ìˆì„ ë•Œ: ì‹¤ì œ ì¹´ë“œ í‘œì‹œ */
        <>
          {/* ëª¨ë°”ì¼ Swiper */}
          <div className="md:hidden -mx-4 px-4">
            <Swiper
              modules={[Navigation]}
              onSwiper={(swiper) => (swiperRef.current = swiper)}
              spaceBetween={16}
              slidesPerView={1.2}
              centeredSlides={false}
              className="!pb-4"
            >
              {reviews.map((review) => (
                <SwiperSlide key={review.id}>
                  <ReviewCard review={review} />
                </SwiperSlide>
              ))}
            </Swiper>
          </div>

          {/* ë°ìŠ¤í¬íƒ‘/íƒœë¸”ë¦¿ Grid (2ì—´ ë°°ì¹˜) */}
          <div className="hidden md:grid grid-cols-2 gap-5 lg:gap-6">
            {reviews.map((review) => (
              <div key={review.id} className="w-full">
                <ReviewCard review={review} />
              </div>
            ))}
          </div>
        </>
      )}
    </div>
  )
}
</file>

<file path="components/layout/standard-layout.tsx">
import type { ReactNode } from "react"
import { DashboardLayout } from "@/components/dashboard-layout"
import { SiteHeader } from "@/components/site-header"
import { ThreeColumnLayout } from "@/components/layout/three-column-layout"
import { StandardRightSidebar } from "@/components/standard-right-sidebar"
import { createClient } from "@/lib/supabase/server"
import { getCurrentUserProfile } from "@/lib/queries/profiles"

interface StandardLayoutProps {
  children: ReactNode
}

/**
 * í‘œì¤€ 3ì—´ ë ˆì´ì•„ì›ƒ
 * - SiteHeader + DashboardLayout + ThreeColumnLayout + StandardRightSidebar ì¡°í•©
 * - about, community, customer-center, member ë“±ì—ì„œ ê³µí†µ ì‚¬ìš©
 */
export async function StandardLayout({ children }: StandardLayoutProps) {
  const supabase = await createClient()
  const userProfile = await getCurrentUserProfile(supabase)
  const userRole = userProfile?.profile?.role || null

  return (
    <DashboardLayout header={<SiteHeader />} userRole={userRole}>
      <ThreeColumnLayout rightSidebar={<StandardRightSidebar />}>
        {children}
      </ThreeColumnLayout>
    </DashboardLayout>
  )
}
</file>

<file path="components/like-button.tsx">
"use client";

import { useState, useEffect } from "react";
import { Heart } from 'lucide-react';
import { Button } from "@/components/ui/button";
import { createClient } from "@/lib/supabase/client";
import { cn } from "@/lib/utils";

const STORAGE_KEY = 'liked_posts';

export function LikeButton({
  postId,
  userId,
  initialLiked,
  initialCount,
  onLikeChange,
}: {
  postId: string;
  userId?: string;
  initialLiked: boolean;
  initialCount: number;
  onLikeChange?: (newCount: number) => void;
}) {
  const [liked, setLiked] = useState(initialLiked);
  const [count, setCount] = useState(initialCount);
  const [isProcessing, setIsProcessing] = useState(false);
  const supabase = createClient();

  // [ë¹„ë¡œê·¸ì¸] ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì²´í¬
  useEffect(() => {
    if (!userId && typeof window !== 'undefined') {
      const likedList = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
      if (likedList.includes(postId)) {
        setLiked(true);
      }
    }
  }, [userId, postId]);

  const handleLike = async (e: React.MouseEvent) => {
    e.preventDefault();
    e.stopPropagation();

    if (isProcessing) return;

    // 1. ë‚™ê´€ì  ì—…ë°ì´íŠ¸ (í™”ë©´ ë¨¼ì € ë°˜ì˜)
    const previousLiked = liked;
    const previousCount = count;
    const newLiked = !liked;
    const newCount = newLiked ? count + 1 : Math.max(0, count - 1);

    setLiked(newLiked);
    setCount(newCount);
    if (onLikeChange) onLikeChange(newCount);

    setIsProcessing(true);

    try {
      if (userId) {
        // [A] ë¡œê·¸ì¸ ìœ ì € ë¡œì§
        if (newLiked) {
          // ì¢‹ì•„ìš” ì¶”ê°€
          const { error } = await supabase.from("post_likes").insert({ post_id: postId, user_id: userId });
          if (error) throw error;
        } else {
          // ì¢‹ì•„ìš” ì·¨ì†Œ (ì‚­ì œ)
          const { error } = await supabase.from("post_likes").delete().eq("post_id", postId).eq("user_id", userId);
          if (error) throw error;
        }
      } else {
        // [B] ë¹„ë¡œê·¸ì¸ ìœ ì € ë¡œì§
        const likedList = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');

        if (newLiked) {
          // ì¢‹ì•„ìš” ì¶”ê°€ RPC
          const { error } = await supabase.rpc('increment_post_likes', { post_id: postId });
          if (error) throw error;

          if (!likedList.includes(postId)) {
            likedList.push(postId);
            localStorage.setItem(STORAGE_KEY, JSON.stringify(likedList));
          }
        } else {
          // ì¢‹ì•„ìš” ì·¨ì†Œ RPC (ìƒˆë¡œ ì¶”ê°€ëœ í•¨ìˆ˜)
          const { error } = await supabase.rpc('decrement_post_likes', { post_id: postId });
          if (error) throw error;

          const newList = likedList.filter((id: string) => id !== postId);
          localStorage.setItem(STORAGE_KEY, JSON.stringify(newList));
        }
      }
    } catch (error) {
      console.error("ì¢‹ì•„ìš” ì²˜ë¦¬ ì‹¤íŒ¨:", error);
      // ì‹¤íŒ¨ ì‹œ ë¡¤ë°±
      setLiked(previousLiked);
      setCount(previousCount);
      if (onLikeChange) onLikeChange(previousCount);
    } finally {
      setIsProcessing(false);
    }
  };

  return (
    <Button
      variant="ghost"
      size="sm"
      onClick={handleLike}
      className={cn(
        "gap-1.5 flex-row items-center justify-center p-1.5 min-w-[auto] h-auto hover:bg-slate-100 rounded-lg transition-colors group",
        liked ? "text-red-500 hover:text-red-600 hover:bg-red-50" : "text-slate-400 hover:text-slate-600"
      )}
    >
      <Heart
        className={cn(
            "h-4 w-4 transition-all duration-300",
            liked && "fill-current scale-110",
            !liked && "group-active:scale-90"
        )}
      />
      <span className="text-xs font-medium tabular-nums">{count}</span>
    </Button>
  );
}
</file>

<file path="components/manage-event-form-wrapper.tsx">
"use client"

import { useRouter } from "next/navigation"
import { NewEventForm } from "@/components/new-event-form"

type InitialData = {
  id: string
  title: string
  description: string
  event_date: string
  end_date?: string | null
  location?: string | null
  price?: number | null
  max_participants?: number | null
  thumbnail_url?: string | null
  event_type?: 'networking' | 'class' | 'activity' | null
}

export function ManageEventFormWrapper({
  userId,
  initialData
}: {
  userId: string
  initialData: InitialData
}) {
  const router = useRouter()

  const handleSuccess = () => {
    router.refresh()
  }

  return (
    <NewEventForm 
      userId={userId} 
      initialData={initialData}
      onSuccess={handleSuccess}
    />
  )
}
</file>

<file path="components/member-card.tsx">
"use client"

import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar"
import { cn } from "@/lib/utils"

type MemberCardProps = {
  name: string
  role?: string
  bio?: string
  imageUrl?: string
  className?: string
}

export function MemberCard({
  name,
  role,
  bio,
  imageUrl,
  className,
}: MemberCardProps) {
  const initials = name
    .split(" ")
    .map((n) => n[0])
    .join("")
    .toUpperCase()
    .slice(0, 2)

  return (
    <div
      className={cn(
        "bg-white rounded-2xl shadow-sm p-6 flex flex-col items-center text-center",
        "transition-all duration-300 hover:-translate-y-1 hover:shadow-md",
        className
      )}
    >
      {/* í”„ë¡œí•„ ì´ë¯¸ì§€ */}
      <Avatar className="w-24 h-24 mb-4 border-2 border-slate-100">
        <AvatarImage src={imageUrl} alt={name} className="object-cover" />
        <AvatarFallback className="bg-slate-100 text-slate-600 text-2xl font-bold">
          {initials}
        </AvatarFallback>
      </Avatar>

      {/* í…ìŠ¤íŠ¸ ì •ë³´ */}
      <div className="flex flex-col gap-1.5 mb-4 w-full">
        <h3 className="text-xl font-bold text-slate-900">{name}</h3>
        {role && (
          <p className="text-sm text-slate-500 font-medium">{role}</p>
        )}
        {bio && (
          <p className="text-sm text-slate-600 line-clamp-2 leading-relaxed mt-1">
            {bio}
          </p>
        )}
      </div>
    </div>
  )
}
</file>

<file path="components/member/member-detail-modal.tsx">
"use client"

import { Dialog, DialogContent, DialogHeader, DialogTitle } from "@/components/ui/dialog"
import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar"
import { Badge } from "@/components/ui/badge"
import { Button } from "@/components/ui/button"
import { Building2, MapPin, User } from "lucide-react"

export type MemberProfile = {
  id: string
  full_name: string
  avatar_url: string | null
  company: string | null
  position: string | null
  company_2: string | null
  position_2: string | null
  tagline: string | null
  introduction: string | null
  member_type: ("ì‚¬ì—…ê°€" | "íˆ¬ìì" | "í¬ë¦¬ì—ì´í„°")[] | null
  roles: string[]
  role: string | null
  badges: Array<{
    icon: string
    name: string
    description?: string | null
  }>
}

interface MemberDetailModalProps {
  member: MemberProfile | null
  isOpen: boolean
  onClose: () => void
  currentUserRole?: string | null
}

export function MemberDetailModal({ member, isOpen, onClose, currentUserRole }: MemberDetailModalProps) {
  if (!member) return null

  return (
    <Dialog open={isOpen} onOpenChange={(open) => !open && onClose()}>
      <DialogContent className="sm:max-w-md bg-white rounded-xl overflow-hidden p-0 gap-0">
        <div className="bg-slate-50 px-6 py-8 flex flex-col items-center text-center border-b border-slate-100">
          <Avatar className="h-24 w-24 mb-4 ring-4 ring-white shadow-sm bg-white">
            <AvatarImage
              src={member.avatar_url || `https://api.dicebear.com/9.x/notionists/svg?seed=${member.full_name}`}
              className="object-cover"
            />
            <AvatarFallback className="bg-blue-600 text-white text-2xl">
              {member.full_name?.[0] || "U"}
            </AvatarFallback>
          </Avatar>

          <DialogHeader>
            <DialogTitle className="text-2xl font-bold text-slate-900 text-center">
              {member.full_name}
            </DialogTitle>
          </DialogHeader>

          {(member.company || member.position || member.company_2 || member.position_2) && (
            <div className="flex flex-col gap-1 mt-2 items-center w-full">
              {(member.company || member.position) && (
                <div className="flex items-center gap-2 text-slate-600 text-sm font-medium justify-center">
                  {member.company && <span>{member.company}</span>}
                  {member.company && member.position && <span className="text-slate-300">|</span>}
                  {member.position && <span>{member.position}</span>}
                </div>
              )}
              {(member.company_2 || member.position_2) && (
                <div className="flex items-center gap-2 text-slate-600 text-sm font-medium justify-center">
                  {member.company_2 && <span>{member.company_2}</span>}
                  {member.company_2 && member.position_2 && <span className="text-slate-300">|</span>}
                  {member.position_2 && <span>{member.position_2}</span>}
                </div>
              )}
            </div>
          )}

          {member.roles && member.roles.length > 0 && (
            <div className="flex flex-wrap gap-1.5 justify-center mt-4">
              {member.roles.map((role) => (
                <Badge key={role} variant="secondary" className="bg-white border-slate-200 text-slate-700 font-normal">
                  {role}
                </Badge>
              ))}
            </div>
          )}
        </div>

        <div className="p-6 space-y-6">
          {/* Tagline Section (í•œë§ˆë””) */}
          <div className="space-y-3">
            <h4 className="text-sm font-semibold text-slate-900 flex items-center gap-2">
              <span className="w-1 h-4 bg-indigo-500 rounded-full"></span>
              ë‚˜ë¥¼ í‘œí˜„í•˜ëŠ” í•œë§ˆë””
            </h4>
            <p className="text-sm text-slate-600 whitespace-pre-wrap leading-relaxed bg-slate-50 p-4 rounded-lg border border-slate-100 min-h-[60px]">
              {member.tagline || <span className="text-slate-400">í•œë§ˆë””ê°€ ì—†ìŠµë‹ˆë‹¤</span>}
            </p>
          </div>

          {/* Introduction Section (ì†Œê°œ) */}
          <div className="space-y-3">
            <h4 className="text-sm font-semibold text-slate-900 flex items-center gap-2">
              <span className="w-1 h-4 bg-slate-500 rounded-full"></span>
              ì†Œê°œ
            </h4>
            <p className="text-sm text-slate-600 whitespace-pre-wrap leading-relaxed bg-slate-50 p-4 rounded-lg border border-slate-100 min-h-[60px]">
              {member.introduction || <span className="text-slate-400">ì†Œê°œê°€ ì—†ìŠµë‹ˆë‹¤</span>}
            </p>
          </div>

          {/* Badges Section (ë³´ìœ  ë±ƒì§€) */}
          {member.badges.length > 0 && (
            <div className="space-y-3">
              <h4 className="text-sm font-semibold text-slate-900 flex items-center gap-2">
                <span className="w-1 h-4 bg-indigo-500 rounded-full"></span>
                ë³´ìœ  ë±ƒì§€
              </h4>
              <div className="space-y-2">
                {member.badges.map((badge, idx) => (
                  <div
                    key={idx}
                    className="flex items-start gap-3 px-3 py-2 rounded-lg bg-slate-50 border border-slate-200"
                  >
                    <div className="h-10 w-10 flex items-center justify-center rounded-full bg-slate-100 text-slate-700 text-xl shrink-0 border border-slate-200">
                      <span>{badge.icon}</span>
                    </div>
                    <div className="flex-1 min-w-0">
                      <p className="text-xs font-semibold text-slate-900">
                        {badge.name}
                      </p>
                      {badge.description && (
                        <p className="mt-0.5 text-[11px] text-slate-600 leading-snug whitespace-pre-line">
                          {badge.description}
                        </p>
                      )}
                    </div>
                  </div>
                ))}
              </div>
            </div>
          )}
        </div>
      </DialogContent>
    </Dialog>
  )
}
</file>

<file path="components/member/member-list-client.tsx">
"use client"

import { useState, useMemo } from "react"
import { Card, CardContent } from "@/components/ui/card"
import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar"
import { Badge } from "@/components/ui/badge"
import { Button } from "@/components/ui/button"
import { MemberDetailModal, MemberProfile } from "./member-detail-modal"
import { cn } from "@/lib/utils"

interface MemberListClientProps {
  members: MemberProfile[]
  currentUserRole: string | null
}

function getShortBadgeLabel(name: string): string {
  // "ì»¤ë®¤ë‹ˆí‹° ë¦¬ë”" -> "ë¦¬ë”"ë¡œ ë‹¨ì¶•
  if (name === "ì»¤ë®¤ë‹ˆí‹° ë¦¬ë”") {
    return "ë¦¬ë”"
  }

  // ì˜ˆ: "ë§¤ì¶œ 10ì–µ+" -> "10ì–µ+" ë§Œ í‘œì‹œ
  if (/\+$/.test(name) && name.includes(" ")) {
    const parts = name.split(" ")
    return parts[parts.length - 1]
  }
  return name
}

export function MemberListClient({ members, currentUserRole }: MemberListClientProps) {
  const [selectedMember, setSelectedMember] = useState<MemberProfile | null>(null)
  const [selectedFilter, setSelectedFilter] = useState<"ì „ì²´" | "ì‚¬ì—…ê°€" | "íˆ¬ìì" | "í¬ë¦¬ì—ì´í„°">("ì „ì²´")

  const filteredMembers = useMemo(() => {
    if (selectedFilter === "ì „ì²´") {
      return members
    }
    return members.filter((member) =>
      member.member_type && Array.isArray(member.member_type) && member.member_type.includes(selectedFilter)
    )
  }, [members, selectedFilter])

  return (
    <>
      {/* í•„í„° ë²„íŠ¼ */}
      <div className="mb-6 flex gap-2">
        {(["ì „ì²´", "ì‚¬ì—…ê°€", "íˆ¬ìì", "í¬ë¦¬ì—ì´í„°"] as const).map((filter) => (
          <Button
            key={filter}
            variant={selectedFilter === filter ? "default" : "outline"}
            onClick={() => setSelectedFilter(filter)}
            className={cn(
              "h-9 px-4 text-sm rounded-full",
              selectedFilter === filter
                ? "bg-slate-900 hover:bg-slate-800 text-white"
                : "bg-white border-slate-200 text-slate-700 hover:bg-slate-50"
            )}
          >
            {filter}
          </Button>
        ))}
      </div>

      {filteredMembers.length > 0 ? (
        // í•œ ì¤„ì— ìµœëŒ€ 3ê°œ ì¹´ë“œ (ë°ìŠ¤í¬íƒ‘ ê¸°ì¤€)
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5">
          {filteredMembers.map((member) => (
            <div
              key={member.id}
              onClick={() => setSelectedMember(member)}
              className="cursor-pointer h-full"
            >
              <Card className="border-slate-200 bg-white hover:shadow-md transition-all duration-200 hover:-translate-y-1 h-full group overflow-hidden flex flex-col">
                <CardContent className="p-0 flex flex-col h-full">
                  {/* ìƒë‹¨ ì˜ì—­ */}
                  <div className="pt-3 px-4 pb-2 flex flex-col gap-2 flex-1">
                    <div className="flex items-center gap-3 ml-2">
                      <Avatar className="h-12 w-12 rounded-full group-hover:ring-4 group-hover:ring-indigo-50 transition-all bg-slate-50 flex-shrink-0 border border-slate-100 shadow-sm">
                        <AvatarImage
                          src={member.avatar_url || `https://api.dicebear.com/9.x/notionists/svg?seed=${member.full_name}`}
                          className="object-cover"
                        />
                        <AvatarFallback className="bg-slate-100 text-slate-500 text-lg font-medium rounded-full">
                          {member.full_name?.[0] || "U"}
                        </AvatarFallback>
                      </Avatar>

                      <div className="flex-1 min-w-0 flex flex-col gap-1">
                        <h3 className="font-bold text-slate-900 text-base truncate">
                          {member.full_name || "ìµëª…"}
                        </h3>

                        {/* ì†Œì† / ì§ì±… */}
                        <div className="text-sm text-slate-500 flex flex-col gap-0.5">
                          {(member.company || member.position) && (
                            <p className="truncate">
                              <span className="font-medium text-slate-700">{member.company}</span>
                              {member.company && member.position && <span className="mx-1 text-slate-300">|</span>}
                              <span>{member.position}</span>
                            </p>
                          )}
                          {(member.company_2 || member.position_2) && (
                            <p className="truncate">
                              <span className="font-medium text-slate-700">{member.company_2}</span>
                              {member.company_2 && member.position_2 && <span className="mx-1 text-slate-300">|</span>}
                              <span>{member.position_2}</span>
                            </p>
                          )}
                        </div>

                        {/* ì—­í•  (Role íƒœê·¸) */}
                        {member.roles && member.roles.length > 0 && (
                          <div className="flex flex-wrap gap-1">
                            {member.roles.slice(0, 2).map((role) => (
                              <Badge key={role} variant="secondary" className="text-[10px] px-1.5 py-0 h-4 bg-slate-100 text-slate-600 font-normal">
                                {role}
                              </Badge>
                            ))}
                            {member.roles.length > 2 && (
                              <Badge variant="secondary" className="text-[10px] px-1.5 py-0 h-4 bg-slate-100 text-slate-600 font-normal">
                                +{member.roles.length - 2}
                              </Badge>
                            )}
                          </div>
                        )}
                      </div>
                    </div>

                    {/* ì†Œê°œê¸€ ì˜ì—­ ê³ ì • */}
                    <div className="w-full mt-1 h-9 flex items-center justify-center text-center px-1">
                      <p className="text-xs text-slate-600 leading-snug break-keep whitespace-pre-line line-clamp-2 w-full">
                        {member.tagline || "\u00A0"}
                      </p>
                    </div>
                  </div>

                  {/* í•˜ë‹¨ ë°°ì§€ ì˜ì—­ (Footer) */}
                  <div className="w-full h-[72px] shrink-0 flex flex-col justify-center">
                    {member.badges.length > 0 ? (
                      <div className="flex w-full items-center justify-between gap-1 px-3">
                        {member.badges.slice(0, 3).map((badge, idx) => {
                          const shortLabel = getShortBadgeLabel(badge.name)
                          return (
                            <div
                              key={`${badge.name}-${idx}`}
                              className="flex-1 basis-1/3 min-w-0 flex flex-col items-center justify-center gap-1"
                            >
                              {/* ì›í˜• ì•„ì´ì½˜ */}
                              <div className="h-10 w-10 flex items-center justify-center rounded-full bg-slate-50 border border-slate-200 text-slate-700 shrink-0">
                                <span className="text-xl">{badge.icon}</span>
                              </div>
                              {/* í•˜ë‹¨ í…ìŠ¤íŠ¸ */}
                              <span className="text-xs text-slate-600 font-medium text-center leading-tight break-keep line-clamp-1">
                                {shortLabel}
                              </span>
                            </div>
                          )
                        })}
                      </div>
                    ) : (
                      /* ë°°ì§€ê°€ ì—†ì„ ë•Œë„ ë¹ˆ ë°•ìŠ¤ë¥¼ ë‘¬ì„œ ë””ìì¸ í†µì¼ì„± ìœ ì§€ */
                      <div className="h-full w-full" />
                    )}
                  </div>
                </CardContent>
              </Card>
            </div>
          ))}
        </div>
      ) : (
        <div className="py-12 text-center text-slate-500">
          <p>ê³µê°œëœ ë©¤ë²„ê°€ ì—†ìŠµë‹ˆë‹¤</p>
        </div>
      )}

      <MemberDetailModal
        member={selectedMember}
        isOpen={!!selectedMember}
        onClose={() => setSelectedMember(null)}
        currentUserRole={currentUserRole}
      />
    </>
  )
}
</file>

<file path="components/mobile-header-container.tsx">
import { getCachedUserProfile } from "@/lib/queries/cached"
import { MobileHeader } from "@/components/mobile-header"

export async function MobileHeaderContainer() {
    const userProfile = await getCachedUserProfile()
    const role = userProfile?.profile?.role

    return <MobileHeader userRole={role} />
}
</file>

<file path="components/mobile-header.tsx">
"use client"

import Link from "next/link"
import Image from "next/image"
import { Menu, BookOpen, Users, Calendar, Megaphone, MessageSquare, Ticket, Lightbulb, Zap, Headset, Briefcase, Shield } from "lucide-react"
import { NotificationsDropdown } from "@/components/notifications-dropdown"
import { Sheet, SheetContent, SheetHeader, SheetTitle, SheetTrigger } from "@/components/ui/sheet"
import { Button } from "@/components/ui/button"
import { usePathname } from "next/navigation"
import { cn } from "@/lib/utils"
import { useState, useEffect } from "react"
import { createClient } from "@/lib/supabase/client"

// ì‚¬ì´ë“œë°”ì™€ ë™ì¼í•œ ë©”ë‰´ êµ¬ì¡°
const navigationSections = [
  { 
    title: "ì†Œê°œ", 
    links: [
      { name: "SEOUL FOUNDERS CLUB", href: "/about", icon: BookOpen },
      { name: "ë©¤ë²„", href: "/member", icon: Users }
    ]
  },
  { 
    title: "ì„±ì¥", 
    links: [
      { name: "ì´ë²¤íŠ¸", href: "/e", icon: Calendar },
      { name: "ì¸ì‚¬ì´íŠ¸", href: "/community/board/insights", icon: Zap },
      { name: "íŒŒíŠ¸ë„ˆìŠ¤", href: "/partners", icon: Briefcase }
    ]
  },
  { 
    title: "ê²Œì‹œíŒ",
    links: [
      { name: "ê³µì§€ì‚¬í•­", href: "/community/board/announcements", icon: Megaphone },
      { name: "ììœ ê²Œì‹œíŒ", href: "/community/board/free", icon: MessageSquare }
    ]
  },
  { 
    title: "ì»¤ë®¤ë‹ˆí‹°",
    links: [
      { name: "ì»¤ë®¤ë‹ˆí‹° í™ˆ", href: "/community", icon: Ticket },
      { name: "ë°˜ê³¨", href: "/community/board/vangol", icon: Users },
      { name: "í•˜ì´í† í¬", href: "/community/board/hightalk", icon: Lightbulb }
    ]
  },
]

interface MobileHeaderProps {
  userRole?: string | null
}

export function MobileHeader({ userRole: initialUserRole }: MobileHeaderProps) {
  const pathname = usePathname()
  const [isOpen, setIsOpen] = useState(false)
  const [userRole, setUserRole] = useState<string | null>(initialUserRole || null)

  // í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì¸ì¦ ìƒíƒœ ì²´í¬ (ISR í˜¸í™˜)
  useEffect(() => {
    if (initialUserRole) return // propsë¡œ ì „ë‹¬ë°›ì€ ê²½ìš° ìŠ¤í‚µ

    const supabase = createClient()

    async function checkRole() {
      try {
        const { data: { session } } = await supabase.auth.getSession()
        if (session?.user) {
          const { data: profile } = await supabase
            .from("profiles")
            .select("role")
            .eq("id", session.user.id)
            .single()

          setUserRole(profile?.role || null)
        }
      } catch (error) {
        console.error("Role check error:", error)
      }
    }

    checkRole()
  }, [initialUserRole])

  const isAdmin = userRole === "admin" || userRole === "master"
  const showAdminMenu = isAdmin || pathname.startsWith('/admin')

  const isLinkActive = (href: string) => {
    if (href === '/community') return pathname === href
    return pathname.startsWith(href)
  }

  return (
    <header className="fixed top-0 left-0 right-0 h-14 bg-white/95 backdrop-blur-xl border-b border-slate-100 z-40 flex items-center justify-between px-4 transition-all duration-300 shadow-sm shadow-slate-900/5">
      {/* 1. ë¡œê³  */}
      <Link href="/" className="flex-shrink-0 relative z-50">
        <Image
          src="/images/ec-a0-9c-eb-aa-a9-20-ec-97-86-ec-9d-8c-1.png"
          alt="Seoul Founders Club"
          width={140}
          height={28}
          className="object-contain h-5 w-auto"
          priority
        />
      </Link>

      {/* 2. ìš°ì¸¡ ì•¡ì…˜ ì˜ì—­ */}
      <div className="flex items-center gap-1 flex-shrink-0">
        
        {/* ì•Œë¦¼ ì•„ì´ì½˜ */}
        <div className="relative">
          <NotificationsDropdown align="end" side="bottom" />
        </div>

        {/* í–„ë²„ê±° ë©”ë‰´ */}
        <Sheet open={isOpen} onOpenChange={setIsOpen}>
          <SheetTrigger asChild>
            <Button variant="ghost" size="icon" className="h-11 w-11 -mr-2 text-slate-700 hover:bg-slate-100 active:bg-slate-200 rounded-xl transition-colors">
              <Menu className="h-6 w-6" />
            </Button>
          </SheetTrigger>
          <SheetContent side="right" className="w-[85vw] max-w-[350px] p-0 bg-white/98 backdrop-blur-xl border-l border-slate-100 shadow-2xl">
            <SheetHeader className="p-6 border-b border-slate-100 text-left">
              <SheetTitle className="text-lg font-bold text-slate-900">ë©”ë‰´</SheetTitle>
            </SheetHeader>

            <div className="flex flex-col h-full overflow-y-auto py-4 pb-20">
              {navigationSections.map((section) => (
                <div key={section.title} className="mb-6 px-4">
                  <h4 className="mb-2 px-2 text-xs font-bold text-slate-400 uppercase tracking-wider">
                    {section.title}
                  </h4>
                  <div className="space-y-1">
                    {section.links.map((item) => {
                      const Icon = item.icon
                      const active = isLinkActive(item.href)
                      const isBoardLink = item.href.startsWith("/community/board/")

                      return (
                        <Link
                          key={item.name}
                          href={item.href}
                          prefetch={isBoardLink ? true : undefined}
                          onClick={() => setIsOpen(false)}
                          className={cn(
                            "flex items-center gap-4 px-4 py-3 text-base transition-all rounded-2xl active:scale-[0.98]",
                            active
                              ? "bg-slate-900 text-white font-semibold shadow-sm"
                              : "text-slate-600 hover:bg-slate-100 hover:text-slate-900 font-medium"
                          )}
                        >
                          <Icon className={cn("h-5 w-5 flex-shrink-0", active ? "text-white" : "text-slate-400")} />
                          <span>{item.name}</span>
                        </Link>
                      )
                    })}
                  </div>
                </div>
              ))}

              {/* ê¸°íƒ€ ì„¹ì…˜ */}
              <div className="mb-6 px-4">
                <h4 className="mb-2 px-2 text-xs font-bold text-slate-400 uppercase tracking-wider">
                  ê¸°íƒ€
                </h4>
                <div className="space-y-1">
                  <Link
                    href="/customer-center"
                    onClick={() => setIsOpen(false)}
                    className={cn(
                      "flex items-center gap-4 px-4 py-3 text-base transition-all rounded-2xl active:scale-[0.98]",
                      isLinkActive("/customer-center")
                        ? "bg-slate-900 text-white font-semibold shadow-sm"
                        : "text-slate-600 hover:bg-slate-100 hover:text-slate-900 font-medium"
                    )}
                  >
                    <Headset className={cn("h-5 w-5 flex-shrink-0", isLinkActive("/customer-center") ? "text-white" : "text-slate-400")} />
                    <span>ê³ ê°ì„¼í„°</span>
                  </Link>
                  {showAdminMenu && (
                    <Link
                      href="/admin"
                      onClick={() => setIsOpen(false)}
                      className={cn(
                        "flex items-center gap-4 px-4 py-3 text-base transition-all rounded-2xl active:scale-[0.98]",
                        isLinkActive("/admin")
                          ? "bg-slate-900 text-white font-semibold shadow-sm"
                          : "text-slate-600 hover:bg-slate-100 hover:text-slate-900 font-medium"
                      )}
                    >
                      <Shield className={cn("h-5 w-5 flex-shrink-0", isLinkActive("/admin") ? "text-white" : "text-slate-400")} />
                      <span>ê´€ë¦¬ì</span>
                    </Link>
                  )}
                </div>
              </div>

              {/* í•˜ë‹¨ ì—¬ë°± (í•˜ë‹¨ë°”ì— ê°€ë ¤ì§€ì§€ ì•Šë„ë¡) */}
              <div className="h-12" />
            </div>
          </SheetContent>
        </Sheet>
      </div>
    </header>
  )
}
</file>

<file path="components/new-announcement-form.tsx">
"use client";

import { useState } from "react";
import { useRouter } from 'next/navigation';
import { createClient } from "@/lib/supabase/client";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Card, CardContent } from "@/components/ui/card";
import { Label } from "@/components/ui/label";
import { RichTextEditor } from "@/components/rich-text-editor";
import { Loader2 } from 'lucide-react';

export function NewAnnouncementForm() {
  const router = useRouter();
  const supabase = createClient();
  const [loading, setLoading] = useState(false);
  const [formData, setFormData] = useState({
    title: "",
    content: "",
  });

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);

    try {
      const { data: { user } } = await supabase.auth.getUser();
      
      if (!user) {
        router.push("/auth/login");
        return;
      }

      const { error } = await supabase.from("posts").insert({
        title: formData.title,
        content: formData.content,
        category: "announcement",
        author_id: user.id,
      });

      if (error) throw error;

      router.push("/community/announcements");
      router.refresh();
    } catch (error) {
      console.error("Error creating announcement:", error);
      alert("ê³µì§€ì‚¬í•­ ì‘ì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤");
    } finally {
      setLoading(false);
    }
  };

  return (
    <Card className="border-slate-200">
      <CardContent className="p-6">
        <form onSubmit={handleSubmit} className="space-y-6">
          <div className="space-y-2">
            <Label htmlFor="title">ì œëª©</Label>
            <Input
              id="title"
              placeholder="ê³µì§€ì‚¬í•­ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”"
              value={formData.title}
              onChange={(e) =>
                setFormData({ ...formData, title: e.target.value })
              }
              required
              disabled={loading}
            />
          </div>

          <div className="space-y-2">
            <Label htmlFor="content">ë‚´ìš©</Label>
            <RichTextEditor
              content={formData.content}
              onChange={(html) =>
                setFormData({ ...formData, content: html })
              }
            />
          </div>

          <div className="flex gap-3">
            <Button type="submit" disabled={loading} className="flex-1">
              {loading && <Loader2 className="mr-2 h-4 w-4 animate-spin" />}
              ê³µì§€ì‚¬í•­ ì‘ì„±
            </Button>
            <Button
              type="button"
              variant="outline"
              onClick={() => router.back()}
              disabled={loading}
            >
              ì·¨ì†Œ
            </Button>
          </div>
        </form>
      </CardContent>
    </Card>
  );
}
</file>

<file path="components/new-post-form.tsx">
"use client";

import { useState, useEffect } from "react";
import { useRouter } from 'next/navigation';
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { RadioGroup, RadioGroupItem } from "@/components/ui/radio-group";
import { RichTextEditor } from "@/components/rich-text-editor";
import { createPost } from "@/lib/actions/posts";
import { createClient } from "@/lib/supabase/client";
import { ImagePlus, X } from "lucide-react";
import { Combobox } from "@/components/ui/combobox";

type NewPostFormProps = {
  userId?: string; // Optional: ì„œë²„ ì•¡ì…˜ì—ì„œ ìë™ìœ¼ë¡œ ê°€ì ¸ì˜´
  boardCategoryId?: string;
  communityId?: string;
  slug?: string; // ê²Œì‹œíŒ slug (ë¦¬ë‹¤ì´ë ‰íŠ¸ ê²½ë¡œ ê²°ì •ìš©)
  onSuccess?: () => void; // ì„±ê³µ ì‹œ ì½œë°± (ëª¨ë‹¬ ë‹«ê¸° ë“±)
}

export function NewPostForm({ userId, boardCategoryId, communityId, slug, onSuccess }: NewPostFormProps) {
  const [title, setTitle] = useState("");
  const [content, setContent] = useState("");
  const [visibility, setVisibility] = useState<"public" | "group">("group"); // ê¸°ë³¸ê°’: ê·¸ë£¹ ê³µê°œ
  const [selectedCategory, setSelectedCategory] = useState<string>("");
  const [insightCategories, setInsightCategories] = useState<Array<{ id: string; name: string }>>([]);
  const [partnerCategories, setPartnerCategories] = useState<Array<{ id: string; name: string }>>([]);
  const [images, setImages] = useState<File[]>([]);
  const [imagePreviews, setImagePreviews] = useState<string[]>([]);
  const MAX_IMAGES = 5;

  // ê³µê°œ ì„¤ì • ì˜µì…˜ì„ ë³´ì—¬ì¤„ì§€ ì—¬ë¶€ ê²°ì •
  // slugê°€ ì—†ê±°ë‚˜(ì¼ë°˜ ê¸€ì“°ê¸°), ê³µê°œ ê²Œì‹œíŒ ë¦¬ìŠ¤íŠ¸ì— í¬í•¨ë˜ë©´ ì˜µì…˜ì„ ìˆ¨ê¹€ (ìë™ ì „ì²´ ê³µê°œ)
  const isPublicBoard = !slug ||
    slug === "insights" ||
    slug === "free-board" || slug === "free" ||
    slug === "announcement" || slug === "announcements" ||
    slug === "event-requests";

  const isInsightBoard = slug === "insights";
  const isPartnerBoard = slug === "partners";

  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const router = useRouter();
  const supabase = createClient();

  // ì¸ì‚¬ì´íŠ¸ ì¹´í…Œê³ ë¦¬ ë¡œë“œ
  useEffect(() => {
    if (isInsightBoard) {
      const loadCategories = async () => {
        const { data, error } = await supabase
          .from("categories")
          .select("id, name")
          .eq("type", "insight")
          .order("created_at", { ascending: true });

        if (!error && data) {
          setInsightCategories(data);
        }
      };
      loadCategories();
    }
  }, [isInsightBoard, supabase]);

  // íŒŒíŠ¸ë„ˆìŠ¤ ì¹´í…Œê³ ë¦¬ ë¡œë“œ
  useEffect(() => {
    if (isPartnerBoard) {
      const loadCategories = async () => {
        const { data, error } = await supabase
          .from("categories")
          .select("id, name")
          .eq("type", "partner")
          .order("created_at", { ascending: true });

        if (!error && data) {
          setPartnerCategories(data);
        }
      };
      loadCategories();
    }
  }, [isPartnerBoard, supabase]);

  // ì´ë¯¸ì§€ íŒŒì¼ ì„ íƒ í•¸ë“¤ëŸ¬
  const handleImageSelect = (e: React.ChangeEvent<HTMLInputElement>) => {
    const files = Array.from(e.target.files || []);

    if (images.length + files.length > MAX_IMAGES) {
      setError(`ìµœëŒ€ ${MAX_IMAGES}ê°œì˜ ì´ë¯¸ì§€ë§Œ ì²¨ë¶€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`);
      return;
    }

    // ì´ë¯¸ì§€ íŒŒì¼ë§Œ í—ˆìš©
    const imageFiles = files.filter(file => file.type.startsWith('image/'));

    if (imageFiles.length !== files.length) {
      setError('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì²¨ë¶€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
      return;
    }

    setImages([...images, ...imageFiles]);

    // ë¯¸ë¦¬ë³´ê¸° ìƒì„±
    imageFiles.forEach(file => {
      const reader = new FileReader();
      reader.onloadend = () => {
        setImagePreviews(prev => [...prev, reader.result as string]);
      };
      reader.readAsDataURL(file);
    });
  };

  // ì´ë¯¸ì§€ ì œê±° í•¸ë“¤ëŸ¬
  const handleImageRemove = (index: number) => {
    setImages(images.filter((_, i) => i !== index));
    setImagePreviews(imagePreviews.filter((_, i) => i !== index));
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setIsLoading(true);
    setError(null);

    // ì¸ì‚¬ì´íŠ¸ ê²Œì‹œíŒì¼ ë•Œ ì¹´í…Œê³ ë¦¬ í•„ìˆ˜ ê²€ì¦
    if (isInsightBoard && !selectedCategory) {
      setError("ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.");
      setIsLoading(false);
      return;
    }

    try {
      // 1. ê²Œì‹œê¸€ ìƒì„±
      const postId = await createPost({
        title,
        content,
        visibility: isPublicBoard ? "public" : visibility,
        boardCategoryId,
        communityId,
        category: (isInsightBoard || isPartnerBoard) && selectedCategory ? selectedCategory : slug,
        categoryId: (isInsightBoard || isPartnerBoard) && selectedCategory ? selectedCategory : undefined,
      });

      // 2. ì´ë¯¸ì§€ ì—…ë¡œë“œ (Supabase Storage)
      if (images.length > 0 && postId) {
        for (let i = 0; i < images.length; i++) {
          const file = images[i];
          const fileExt = file.name.split('.').pop();
          const fileName = `${postId}/${Date.now()}_${i}.${fileExt}`;

          // Supabase Storageì— ì—…ë¡œë“œ
          const { data: uploadData, error: uploadError } = await supabase.storage
            .from('post-images')
            .upload(fileName, file);

          if (uploadError) {
            console.error('ì´ë¯¸ì§€ ì—…ë¡œë“œ ì˜¤ë¥˜:', uploadError);
            continue;
          }

          // ê³µê°œ URL ê°€ì ¸ì˜¤ê¸°
          const { data: { publicUrl } } = supabase.storage
            .from('post-images')
            .getPublicUrl(fileName);

          // post_images í…Œì´ë¸”ì— ì €ì¥
          await supabase
            .from('post_images')
            .insert({
              post_id: postId,
              image_url: publicUrl,
              sort_order: i,
            });
        }
      }

      // ì„±ê³µ ì½œë°± ì‹¤í–‰ (ëª¨ë‹¬ ë‹«ê¸° ë“±)
      if (onSuccess) {
        onSuccess()
      }

      // slugê°€ ìˆìœ¼ë©´ í•´ë‹¹ ê²Œì‹œíŒìœ¼ë¡œ, ì—†ìœ¼ë©´ ì¼ë°˜ ê²Œì‹œê¸€ ëª©ë¡ìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
      if (slug) {
        router.push(`/community/board/${slug}`);
      } else {
        router.push("/community/posts");
      }
      router.refresh();
    } catch (error: unknown) {
      setError(error instanceof Error ? error.message : "ê²Œì‹œê¸€ ì‘ì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <form onSubmit={handleSubmit} className="space-y-6">
      {/* ì¹´í…Œê³ ë¦¬ ì„ íƒ (ì¸ì‚¬ì´íŠ¸/íŒŒíŠ¸ë„ˆìŠ¤ ê²Œì‹œíŒì¼ ë•Œë§Œ, ì œëª© ìœ„ì— ë°°ì¹˜) */}
      {(isInsightBoard || isPartnerBoard) && (
        <div className="space-y-2">
          <Label htmlFor="category" className="text-sm font-medium text-slate-900">
            ì¹´í…Œê³ ë¦¬ {isInsightBoard && <span className="text-red-500">*</span>}
          </Label>
          <Combobox
            options={(isInsightBoard ? insightCategories : partnerCategories).map((cat) => ({
              value: cat.id,
              label: cat.name,
            }))}
            value={selectedCategory}
            onValueChange={setSelectedCategory}
            placeholder="ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”"
            searchPlaceholder="ì¹´í…Œê³ ë¦¬ ê²€ìƒ‰..."
            emptyText="ì¹´í…Œê³ ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤."
          />
        </div>
      )}

      <div className="space-y-2">
        <Label htmlFor="title" className="text-sm font-medium text-slate-900">
          ì œëª©
        </Label>
        <Input
          id="title"
          placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”"
          value={title}
          onChange={(e) => setTitle(e.target.value)}
          required
          className="w-full"
        />
      </div>

      <div className="space-y-2">
        <Label htmlFor="content" className="text-sm font-medium text-slate-900">
          ë‚´ìš©
        </Label>
        <RichTextEditor
          content={content}
          onChange={(html) => setContent(html)}
        />
      </div>

      {/* ì´ë¯¸ì§€ ì²¨ë¶€ */}
      <div className="space-y-2">
        <Label className="text-sm font-medium text-slate-900">
          ì´ë¯¸ì§€ ì²¨ë¶€ (ìµœëŒ€ {MAX_IMAGES}ê°œ)
        </Label>

        {/* ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° */}
        {imagePreviews.length > 0 && (
          <div className="grid grid-cols-3 gap-3 mb-3">
            {imagePreviews.map((preview, index) => (
              <div key={index} className="relative group">
                <img
                  src={preview}
                  alt={`ë¯¸ë¦¬ë³´ê¸° ${index + 1}`}
                  className="w-full h-32 object-cover rounded-lg border border-slate-200"
                />
                <button
                  type="button"
                  onClick={() => handleImageRemove(index)}
                  className="absolute top-2 right-2 p-1 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity"
                >
                  <X className="w-4 h-4" />
                </button>
              </div>
            ))}
          </div>
        )}

        {/* íŒŒì¼ ì„ íƒ ë²„íŠ¼ */}
        {images.length < MAX_IMAGES && (
          <label className="flex items-center justify-center w-full h-32 border-2 border-dashed border-slate-300 rounded-lg cursor-pointer hover:border-blue-500 hover:bg-blue-50 transition-colors">
            <div className="flex flex-col items-center gap-2">
              <ImagePlus className="w-8 h-8 text-slate-400" />
              <span className="text-sm text-slate-600">ì´ë¯¸ì§€ ì¶”ê°€ ({images.length}/{MAX_IMAGES})</span>
            </div>
            <input
              type="file"
              accept="image/*"
              multiple
              onChange={handleImageSelect}
              className="hidden"
            />
          </label>
        )}
      </div>

      {!isPublicBoard && (
        <div className="space-y-2">
          <Label>ê³µê°œ ì„¤ì •</Label>
          <RadioGroup
            value={visibility}
            onValueChange={(value) => setVisibility(value as "public" | "group")}
            className="mt-2"
          >
            <div className="flex items-center space-x-2 p-3 border border-slate-200 rounded-lg hover:bg-slate-50 transition-colors">
              <RadioGroupItem value="public" id="public" />
              <Label htmlFor="public" className="flex-1 cursor-pointer">
                <div className="flex items-center gap-2">
                  <span>ğŸŒ</span>
                  <div>
                    <div className="font-medium text-slate-900">ì „ì²´ ê³µê°œ</div>
                    <div className="text-xs text-slate-500">ë©¤ë²„ ëˆ„êµ¬ë‚˜ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
                  </div>
                </div>
              </Label>
            </div>
            <div className="flex items-center space-x-2 p-3 border border-slate-200 rounded-lg hover:bg-slate-50 transition-colors">
              <RadioGroupItem value="group" id="group" />
              <Label htmlFor="group" className="flex-1 cursor-pointer">
                <div className="flex items-center gap-2">
                  <span>ğŸ”’</span>
                  <div>
                    <div className="font-medium text-slate-900">ê·¸ë£¹ ê³µê°œ</div>
                    <div className="text-xs text-slate-500">ì´ ì»¤ë®¤ë‹ˆí‹° ë©¤ë²„ë§Œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
                  </div>
                </div>
              </Label>
            </div>
          </RadioGroup>
        </div>
      )}

      {error && (
        <p className="text-sm text-red-600">{error}</p>
      )}

      {/* ë²„íŠ¼ ì˜ì—­ ìˆ˜ì •: ìš°ì¸¡ ì •ë ¬ ë° ê°•ì¡° */}
      <div className="flex justify-end gap-3 pt-4 border-t border-slate-100">
        <Button
          type="button"
          variant="outline"
          onClick={() => {
            if (onSuccess) {
              onSuccess() // ëª¨ë‹¬ì´ ì—´ë ¤ìˆìœ¼ë©´ ëª¨ë‹¬ ë‹«ê¸°
            } else {
              router.back() // ì¼ë°˜ í˜ì´ì§€ë©´ ë’¤ë¡œ ê°€ê¸°
            }
          }}
          className="h-12 px-6 text-base"
        >
          ì·¨ì†Œ
        </Button>
        <Button
          type="submit"
          className="h-12 px-10 text-base font-bold bg-blue-600 hover:bg-blue-700 text-white shadow-md hover:shadow-lg transition-all"
          disabled={isLoading}
        >
          {isLoading ? "ì €ì¥ ì¤‘..." : "ì‘ì„±í•˜ê¸°"}
        </Button>
      </div>
    </form>
  );
}
</file>

<file path="components/new-project-form.tsx">
'use client';

import { useState } from 'react';
import { useRouter } from 'next/navigation';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Textarea } from '@/components/ui/textarea';
import { Label } from '@/components/ui/label';
import { createClient } from '@/lib/supabase/client';
import { Loader2, FolderKanban, X } from 'lucide-react';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "@/components/ui/select";
import { Badge } from '@/components/ui/badge';

const CATEGORIES = [
  'ì›¹ ê°œë°œ',
  'ëª¨ë°”ì¼ ì•±',
  'AI/ML',
  'ë¸”ë¡ì²´ì¸',
  'ê²Œì„',
  'IoT',
  'ë°ì´í„° ë¶„ì„',
  'ê¸°íƒ€',
];

export function NewProjectForm({ userId }: { userId: string }) {
  const router = useRouter();
  const [isLoading, setIsLoading] = useState(false);
  const [thumbnailUrl, setThumbnailUrl] = useState('');
  const [githubUrl, setGithubUrl] = useState('');
  const [techInput, setTechInput] = useState('');
  const [techStack, setTechStack] = useState<string[]>([]);

  const addTech = () => {
    if (techInput.trim() && !techStack.includes(techInput.trim())) {
      setTechStack([...techStack, techInput.trim()]);
      setTechInput('');
    }
  };

  const removeTech = (tech: string) => {
    setTechStack(techStack.filter(t => t !== tech));
  };

  async function onSubmit(event: React.FormEvent<HTMLFormElement>) {
    event.preventDefault();
    setIsLoading(true);

    const formData = new FormData(event.currentTarget);
    const title = formData.get('title') as string;
    const description = formData.get('description') as string;
    const category = formData.get('category') as string;
    const lookingForMembers = formData.get('lookingForMembers') === 'on';

    const supabase = createClient();

    try {
      // Create project
      const { data: project, error: projectError } = await supabase
        .from('projects')
        .insert({
          title,
          description,
          category,
          status: lookingForMembers ? 'recruiting' : 'active',
          looking_for_members: lookingForMembers,
          thumbnail_url: thumbnailUrl || null,
          github_url: githubUrl || null,
          created_by: userId,
        })
        .select()
        .single();

      if (projectError) throw projectError;

      // Add creator as project member
      const { error: memberError } = await supabase
        .from('project_members')
        .insert({
          project_id: project.id,
          user_id: userId,
          role: 'í”„ë¡œì íŠ¸ ë¦¬ë”',
        });

      if (memberError) throw memberError;

      // Add tech stack
      if (techStack.length > 0) {
        const techStackData = techStack.map(tech => ({
          project_id: project.id,
          technology: tech,
        }));

        const { error: techError } = await supabase
          .from('project_tech_stack')
          .insert(techStackData);

        if (techError) throw techError;
      }

      router.push(`/projects/${project.id}`);
      router.refresh();
    } catch (error) {
      console.error('Error creating project:', error);
      alert('í”„ë¡œì íŠ¸ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    } finally {
      setIsLoading(false);
    }
  }

  return (
    <form onSubmit={onSubmit} className="grid grid-cols-1 lg:grid-cols-3 gap-8">
      {/* Left: Thumbnail Preview */}
      <div className="lg:col-span-1">
        <div className="sticky top-8">
          <Label className="text-base font-semibold mb-3 block">í”„ë¡œì íŠ¸ ì¸ë„¤ì¼</Label>
          <div className="aspect-square w-full overflow-hidden rounded-lg bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center">
            {thumbnailUrl ? (
              <img
                src={thumbnailUrl || "/placeholder.svg"}
                alt="Thumbnail preview"
                className="h-full w-full object-cover"
              />
            ) : (
              <FolderKanban className="h-24 w-24 text-white opacity-80" />
            )}
          </div>
          <div className="mt-4">
            <Label htmlFor="thumbnailUrl" className="text-sm">ì¸ë„¤ì¼ ì´ë¯¸ì§€ URL</Label>
            <Input
              id="thumbnailUrl"
              type="url"
              placeholder="https://example.com/image.jpg"
              value={thumbnailUrl}
              onChange={(e) => setThumbnailUrl(e.target.value)}
              className="mt-2"
            />
            <p className="mt-2 text-xs text-slate-500">
              í”„ë¡œì íŠ¸ë¥¼ ëŒ€í‘œí•˜ëŠ” ì´ë¯¸ì§€ URLì„ ì…ë ¥í•˜ì„¸ìš”
            </p>
          </div>
        </div>
      </div>

      {/* Right: Form Fields */}
      <div className="lg:col-span-2 space-y-6">
        <div>
          <Label htmlFor="title" className="text-base font-semibold">
            í”„ë¡œì íŠ¸ ì´ë¦„ <span className="text-red-500">*</span>
          </Label>
          <Input
            id="title"
            name="title"
            required
            placeholder="ì˜ˆ: AI ê¸°ë°˜ ì±—ë´‡ ì„œë¹„ìŠ¤"
            className="mt-2 text-lg"
          />
        </div>

        <div>
          <Label htmlFor="category" className="text-base font-semibold">
            ì¹´í…Œê³ ë¦¬ <span className="text-red-500">*</span>
          </Label>
          <Select name="category" required>
            <SelectTrigger className="mt-2">
              <SelectValue placeholder="ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ì„¸ìš”" />
            </SelectTrigger>
            <SelectContent>
              {CATEGORIES.map((cat) => (
                <SelectItem key={cat} value={cat}>
                  {cat}
                </SelectItem>
              ))}
            </SelectContent>
          </Select>
        </div>

        <div>
          <Label htmlFor="description" className="text-base font-semibold">
            í”„ë¡œì íŠ¸ ì„¤ëª… <span className="text-red-500">*</span>
          </Label>
          <Textarea
            id="description"
            name="description"
            required
            rows={12}
            placeholder="í”„ë¡œì íŠ¸ì— ëŒ€í•œ ìì„¸í•œ ì„¤ëª…ì„ ì‘ì„±í•˜ì„¸ìš”..."
            className="mt-2 resize-none"
          />
          <p className="mt-2 text-sm text-slate-500">
            í”„ë¡œì íŠ¸ ëª©ì , ì£¼ìš” ê¸°ëŠ¥, ê¸°ëŒ€ íš¨ê³¼ ë“±ì„ ììœ ë¡­ê²Œ ì‘ì„±í•˜ì„¸ìš”
          </p>
        </div>

        <div>
          <Label htmlFor="githubUrl" className="text-base font-semibold">
            GitHub ì €ì¥ì†Œ
          </Label>
          <Input
            id="githubUrl"
            type="url"
            placeholder="https://github.com/username/repo"
            value={githubUrl}
            onChange={(e) => setGithubUrl(e.target.value)}
            className="mt-2"
          />
        </div>

        <div>
          <Label className="text-base font-semibold">ê¸°ìˆ  ìŠ¤íƒ</Label>
          <div className="mt-2 flex gap-2">
            <Input
              value={techInput}
              onChange={(e) => setTechInput(e.target.value)}
              onKeyDown={(e) => {
                if (e.key === 'Enter') {
                  e.preventDefault();
                  addTech();
                }
              }}
              placeholder="ì˜ˆ: React, Node.js, PostgreSQL"
            />
            <Button type="button" onClick={addTech} variant="outline">
              ì¶”ê°€
            </Button>
          </div>
          {techStack.length > 0 && (
            <div className="mt-3 flex flex-wrap gap-2">
              {techStack.map((tech) => (
                <Badge key={tech} variant="secondary" className="gap-1">
                  {tech}
                  <button
                    type="button"
                    onClick={() => removeTech(tech)}
                    className="ml-1 hover:text-red-600"
                  >
                    <X className="h-3 w-3" />
                  </button>
                </Badge>
              ))}
            </div>
          )}
        </div>

        <div className="flex items-center gap-2">
          <input
            type="checkbox"
            id="lookingForMembers"
            name="lookingForMembers"
            className="h-4 w-4 rounded border-slate-300"
          />
          <Label htmlFor="lookingForMembers" className="text-sm font-normal cursor-pointer">
            íŒ€ì›ì„ ëª¨ì§‘í•˜ê³  ìˆìŠµë‹ˆë‹¤
          </Label>
        </div>

        <div className="flex gap-3 pt-6">
          <Button
            type="submit"
            disabled={isLoading}
            className="flex-1 h-12 bg-slate-900 hover:bg-slate-800 text-white text-base"
          >
            {isLoading ? (
              <>
                <Loader2 className="mr-2 h-5 w-5 animate-spin" />
                í”„ë¡œì íŠ¸ ìƒì„± ì¤‘...
              </>
            ) : (
              'í”„ë¡œì íŠ¸ ë§Œë“¤ê¸°'
            )}
          </Button>
          <Button
            type="button"
            variant="outline"
            onClick={() => router.back()}
            className="h-12 px-8"
          >
            ì·¨ì†Œ
          </Button>
        </div>
      </div>
    </form>
  );
}
</file>

<file path="components/notifications-dropdown.tsx">
"use client"

import { useState, useEffect } from "react"
import { createClient } from "@/lib/supabase/client"
import { Bell } from "lucide-react"
import { useRouter } from "next/navigation"
import { Popover, PopoverContent, PopoverTrigger } from "@/components/ui/popover"
import { Button } from "@/components/ui/button"
import { cn } from "@/lib/utils"

interface Notification {
  id: string
  type: string
  title: string
  message: string
  related_post_id: string | null
  related_event_id: string | null
  is_read: boolean
  created_at: string
  actor_id: string | null
  profiles: {
    full_name: string
    avatar_url: string | null
  } | null
}

interface NotificationsDropdownProps {
  triggerClassName?: string
  align?: "center" | "start" | "end"
  side?: "top" | "right" | "bottom" | "left"
  initialUser?: any // ì„œë²„ì—ì„œ ì „ë‹¬ë°›ì€ user ì •ë³´
  initialNotifications?: Notification[] // ì„œë²„ì—ì„œ ë¯¸ë¦¬ ê°€ì ¸ì˜¨ ì•Œë¦¼ ë°ì´í„°
}

export default function NotificationsDropdown({
  triggerClassName,
  align = "end",
  side = "bottom",
  initialUser,
  initialNotifications = []
}: NotificationsDropdownProps) {
  // Hydration ì•ˆì „ì„ ìœ„í•œ mounted ìƒíƒœ
  const [mounted, setMounted] = useState(false)
  // ì„œë²„ì—ì„œ ë¯¸ë¦¬ ê°€ì ¸ì˜¨ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì´ˆê¸° ìƒíƒœë¡œ ì‚¬ìš©
  const [notifications, setNotifications] = useState<Notification[]>(initialNotifications)
  const [unreadCount, setUnreadCount] = useState(initialNotifications.filter((n) => !n.is_read).length)
  const [isOpen, setIsOpen] = useState(false)
  const [user, setUser] = useState<any>(initialUser || null)
  // initialNotificationsê°€ ìˆìœ¼ë©´ ë¡œë”© ì™„ë£Œ ìƒíƒœë¡œ ì‹œì‘
  const [isLoading, setIsLoading] = useState(!initialUser && initialNotifications.length === 0)
  const supabase = createClient()
  const router = useRouter()

  // í´ë¼ì´ì–¸íŠ¸ ë§ˆìš´íŠ¸ í™•ì¸
  useEffect(() => {
    setMounted(true)
  }, [])

  useEffect(() => {
    // initialUserê°€ ìˆìœ¼ë©´ ë¡œë”© ì™„ë£Œ
    if (initialUser) {
      setIsLoading(false)
    }

    async function fetchNotifications() {
      // ì´ë¯¸ userê°€ ìˆìœ¼ë©´ ì„¸ì…˜ ì²´í¬ ìŠ¤í‚µ
      const currentUser = user || initialUser

      if (!currentUser) {
        // í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì„¸ì…˜ í™•ì¸
        const { data: { session } } = await supabase.auth.getSession()
        if (!session?.user) {
          setUser(null)
          setIsLoading(false)
          return
        }
        setUser(session.user)
        setIsLoading(false)
      }

      const userId = currentUser?.id || user?.id
      if (!userId) return

      const { data, error } = await supabase
        .from("notifications")
        .select(`
          *,
          profiles:actor_id(full_name, avatar_url)
        `)
        .eq("user_id", userId)
        .order("created_at", { ascending: false })
        .limit(10)

      if (error) {
        console.error('[NotificationsDropdown] Error:', error)
        return
      }

      if (data) {
        setNotifications(data)
        setUnreadCount(data.filter((n) => !n.is_read).length)
      }
    }

    // ì„œë²„ì—ì„œ ë¯¸ë¦¬ ê°€ì ¸ì˜¨ ë°ì´í„°ê°€ ì—†ì„ ë•Œë§Œ í´ë¼ì´ì–¸íŠ¸ì—ì„œ fetch
    if (initialNotifications.length === 0 && !initialUser) {
      fetchNotifications()
    }

    // ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ êµ¬ë… (ë¡œê·¸ì¸ ì‚¬ìš©ìë§Œ)
    const currentUserId = initialUser?.id || user?.id
    if (!currentUserId) return

    const channel = supabase
      .channel(`notifications:${currentUserId}`)
      .on(
        "postgres_changes",
        {
          event: "INSERT",
          schema: "public",
          table: "notifications",
          filter: `user_id=eq.${currentUserId}`,
        },
        (payload) => {
          // ìƒˆ ì•Œë¦¼ì´ ì˜¤ë©´ ê¸°ì¡´ ëª©ë¡ì— ì¶”ê°€ (ì „ì²´ refetch ëŒ€ì‹ )
          const newNotification = payload.new as Notification
          // actor í”„ë¡œí•„ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
          if (newNotification.actor_id) {
            supabase
              .from("profiles")
              .select("full_name, avatar_url")
              .eq("id", newNotification.actor_id)
              .single()
              .then(({ data: profile }) => {
                setNotifications((prev) => [{
                  ...newNotification,
                  profiles: profile
                } as Notification, ...prev.slice(0, 9)])
                setUnreadCount((prev) => prev + 1)
              })
          } else {
            setNotifications((prev) => [{
              ...newNotification,
              profiles: null
            } as Notification, ...prev.slice(0, 9)])
            setUnreadCount((prev) => prev + 1)
          }
        },
      )
      .subscribe()

    return () => {
      supabase.removeChannel(channel)
    }
  }, [supabase, initialNotifications.length, initialUser, user])


  async function markAsRead(notificationId: string) {
    await supabase.from("notifications").update({ is_read: true }).eq("id", notificationId)

    setNotifications((prev) => prev.map((n) => (n.id === notificationId ? { ...n, is_read: true } : n)))
    setUnreadCount((prev) => Math.max(0, prev - 1))
  }

  async function markAllAsRead() {
    if (!user) return

    await supabase.from("notifications").update({ is_read: true }).eq("user_id", user.id).eq("is_read", false)

    setNotifications((prev) => prev.map((n) => ({ ...n, is_read: true })))
    setUnreadCount(0)
  }

  function handleNotificationClick(notification: Notification) {
    markAsRead(notification.id)
    setIsOpen(false)

    if (notification.related_post_id) {
      router.push(`/community/posts/${notification.related_post_id}`)
    } else if (notification.related_event_id) {
      router.push(`/e/${notification.related_event_id}`)
    }
  }

  // ë¡œë”© ì¤‘ì´ê±°ë‚˜ ë¹„ë¡œê·¸ì¸ ìƒíƒœì¼ ë•Œ ë‹¨ìˆœ ì•Œë¦¼ ì•„ì´ì½˜ í‘œì‹œ
  // (ë¡œë”© ì¤‘ì—ëŠ” ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸í•˜ì§€ ì•ŠìŒ)
  if (isLoading || !user) return (
    <Button
      variant="ghost"
      size="icon"
      className={cn(
        "relative h-10 w-10 rounded-lg border-0 hover:bg-slate-100 transition-all",
        triggerClassName
      )}
      aria-label="ì•Œë¦¼"
      onClick={() => {
        if (!isLoading && !user) {
          router.push("/auth/login")
        }
      }}
    >
      <Bell className="h-6 w-6 text-slate-400" />
    </Button>
  )

  return (
    <Popover open={isOpen} onOpenChange={setIsOpen}>
      <PopoverTrigger asChild>
        <Button
          variant="ghost"
          size="icon"
          className={cn(
            "relative h-10 w-10 rounded-lg border-0 hover:bg-slate-100 transition-all",
            isOpen && "bg-slate-100",
            triggerClassName
          )}
          aria-label="ì•Œë¦¼"
        >
          <Bell className={cn("h-6 w-6 transition-colors", isOpen ? "text-slate-900" : "text-slate-600")} />
          {mounted && unreadCount > 0 && (
            <span className="absolute top-2 right-2 h-2 w-2 bg-red-500 rounded-full border-2 border-white shadow-sm" />
          )}
        </Button>
      </PopoverTrigger>
      
      {/* Floating Card Panel */}
      <PopoverContent 
        className="w-[360px] max-w-[calc(100vw-2rem)] p-0 max-h-[70vh] bg-white border border-slate-200 shadow-xl rounded-xl flex flex-col overflow-hidden" 
        side={side}
        align={align}
        sideOffset={8}
        collisionPadding={10}
      >
        {/* í—¤ë” */}
        <div className="flex items-center justify-between p-6 border-b border-slate-100 bg-white shrink-0">
          <div className="flex items-center gap-2.5">
            <Bell className="h-5 w-5 text-slate-900" />
            <h3 className="font-bold text-xl text-slate-900">ì•Œë¦¼</h3>
            {mounted && unreadCount > 0 && (
              <span className="bg-red-600 text-white text-[11px] font-bold px-2 py-0.5 rounded-full shadow-sm">
                {unreadCount} NEW
              </span>
            )}
          </div>
          {unreadCount > 0 && (
            <button 
              onClick={markAllAsRead} 
              className="text-xs text-slate-500 hover:text-blue-600 font-medium transition-colors underline underline-offset-4"
            >
              ëª¨ë‘ ì½ìŒ
            </button>
          )}
        </div>

        {/* ë¦¬ìŠ¤íŠ¸ ì˜ì—­ */}
        <div className="overflow-y-auto flex-1 bg-white">
          {notifications.length === 0 ? (
            <div className="h-full flex flex-col items-center justify-center text-slate-400 p-8 space-y-4">
              <div className="w-20 h-20 bg-slate-50 rounded-full flex items-center justify-center">
                <Bell className="w-10 h-10 text-slate-300" />
              </div>
              <p className="text-base font-medium text-slate-500">ìƒˆë¡œìš´ ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤</p>
            </div>
          ) : (
            <div className="divide-y divide-slate-50">
              {notifications.map((notification) => (
                <button
                  key={notification.id}
                  onClick={() => handleNotificationClick(notification)}
                  className={cn(
                    "w-full p-6 text-left hover:bg-slate-50 transition-all duration-200 group relative",
                    !notification.is_read ? "bg-blue-50/30" : "bg-white"
                  )}
                >
                  {/* ì½ì§€ ì•ŠìŒ í‘œì‹œ ì  (ì¢Œì¸¡) */}
                  {!notification.is_read && (
                    <div className="absolute left-0 top-0 bottom-0 w-1 bg-blue-500" />
                  )}
                  
                  <div className="flex gap-4">
                    <div className="shrink-0 mt-1">
                      <div className="w-10 h-10 rounded-full bg-white border border-slate-100 flex items-center justify-center shadow-sm overflow-hidden">
                        {notification.profiles?.avatar_url ? (
                          <img src={notification.profiles.avatar_url} alt="" className="w-full h-full object-cover" />
                        ) : (
                          <span className="text-sm font-bold text-slate-400">{notification.profiles?.full_name?.[0] || "!"}</span>
                        )}
                      </div>
                    </div>
                    <div className="flex-1 min-w-0 space-y-1.5">
                      <div className="flex justify-between items-start">
                        <p className="font-bold text-sm text-slate-900 leading-tight">
                          {notification.title}
                        </p>
                        <span className="text-[10px] text-slate-400 shrink-0 font-medium" suppressHydrationWarning>
                          {new Date(notification.created_at).toLocaleDateString("ko-KR", {
                            month: "short",
                            day: "numeric",
                          })}
                        </span>
                      </div>
                      <p className="text-sm text-slate-600 line-clamp-2 leading-relaxed">
                        {notification.message}
                      </p>
                    </div>
                  </div>
                </button>
              ))}
            </div>
          )}
        </div>
      </PopoverContent>
    </Popover>
  )
}

export { NotificationsDropdown }
</file>

<file path="components/partner-apply-button.tsx">
"use client"

import { useState } from "react"
import { Button } from "@/components/ui/button"
import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from "@/components/ui/dialog"
import { Input } from "@/components/ui/input"
import { Label } from "@/components/ui/label"
import { Textarea } from "@/components/ui/textarea"
import { ArrowRight, Loader2 } from "lucide-react"
import { createClient } from "@/lib/supabase/client"
import { useRouter } from "next/navigation"
import { useToast } from "@/hooks/use-toast"

type PartnerApplyButtonProps = {
  partnerId?: string
  partnerName: string
  serviceTitle: string
}

export function PartnerApplyButton({ partnerId, partnerName, serviceTitle }: PartnerApplyButtonProps) {
  const [isDialogOpen, setIsDialogOpen] = useState(false)
  const [isLoading, setIsLoading] = useState(false)
  const [formData, setFormData] = useState({
    companyName: "",
    contactEmail: "",
    contactPhone: "",
    serviceDescription: "",
    currentUsage: "",
  })
  const router = useRouter()
  const { toast } = useToast()

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    
    if (!formData.companyName.trim() || !formData.contactEmail.trim() || !formData.serviceDescription.trim()) {
      toast({
        variant: "destructive",
        title: "ì…ë ¥ í•„ìš”",
        description: "í•„ìˆ˜ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.",
      })
      return
    }

    setIsLoading(true)
    const supabase = createClient()

    try {
      const { data: { user } } = await supabase.auth.getUser()
      
      if (!user) {
        toast({
          variant: "destructive",
          title: "ë¡œê·¸ì¸ í•„ìš”",
          description: "ì‹ ì²­í•˜ë ¤ë©´ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.",
        })
        router.push("/auth/login")
        return
      }

      const { error } = await supabase
        .from("partner_applications")
        .insert({
          user_id: user.id,
          partner_id: partnerId || null,
          partner_name: partnerName,
          company_name: formData.companyName.trim(),
          contact_email: formData.contactEmail.trim(),
          contact_phone: formData.contactPhone.trim() || null,
          service_description: formData.serviceDescription.trim(),
          current_usage: formData.currentUsage.trim() || null,
          status: "pending",
        })

      if (error) throw error

      toast({
        title: "ì‹ ì²­ ì™„ë£Œ",
        description: "íŒŒíŠ¸ë„ˆ í˜œíƒ ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ê²€í†  í›„ ì—°ë½ë“œë¦¬ê² ìŠµë‹ˆë‹¤.",
      })

      setIsDialogOpen(false)
      setFormData({
        companyName: "",
        contactEmail: "",
        contactPhone: "",
        serviceDescription: "",
        currentUsage: "",
      })
      router.refresh()
    } catch (error) {
      console.error("Partner application error:", error)
      toast({
        variant: "destructive",
        title: "ì‹ ì²­ ì‹¤íŒ¨",
        description: error instanceof Error ? error.message : "ì‹ ì²­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",
      })
    } finally {
      setIsLoading(false)
    }
  }

  return (
    <>
      <Button
        onClick={(e) => {
          e.stopPropagation()
          setIsDialogOpen(true)
        }}
        className="w-full bg-blue-600 hover:bg-blue-700 text-white"
      >
        íŒŒíŠ¸ë„ˆìŠ¤ ì‹ ì²­í•˜ê¸°
        <ArrowRight className="ml-2 h-4 w-4" />
      </Button>

      <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>
        <DialogContent className="sm:max-w-lg">
          <DialogHeader>
            <DialogTitle>íŒŒíŠ¸ë„ˆ í˜œíƒ ì‹ ì²­</DialogTitle>
            <DialogDescription>
              {serviceTitle}ì˜ ì œíœ´ í˜œíƒì„ ì‹ ì²­í•˜ì‹œë ¤ë©´ ì•„ë˜ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.
            </DialogDescription>
          </DialogHeader>

          <form onSubmit={handleSubmit} className="space-y-4 mt-4">
            <div>
              <Label htmlFor="companyName" className="text-sm font-medium text-slate-700">
                íšŒì‚¬ëª… <span className="text-red-500">*</span>
              </Label>
              <Input
                id="companyName"
                value={formData.companyName}
                onChange={(e) => setFormData({ ...formData, companyName: e.target.value })}
                placeholder="íšŒì‚¬ ë˜ëŠ” ì¡°ì§ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"
                className="mt-1.5"
                required
              />
            </div>

            <div>
              <Label htmlFor="contactEmail" className="text-sm font-medium text-slate-700">
                ì´ë©”ì¼ <span className="text-red-500">*</span>
              </Label>
              <Input
                id="contactEmail"
                type="email"
                value={formData.contactEmail}
                onChange={(e) => setFormData({ ...formData, contactEmail: e.target.value })}
                placeholder="contact@example.com"
                className="mt-1.5"
                required
              />
            </div>

            <div>
              <Label htmlFor="contactPhone" className="text-sm font-medium text-slate-700">
                ì—°ë½ì²˜
              </Label>
              <Input
                id="contactPhone"
                type="tel"
                value={formData.contactPhone}
                onChange={(e) => setFormData({ ...formData, contactPhone: e.target.value })}
                placeholder="010-1234-5678"
                className="mt-1.5"
              />
            </div>

            <div>
              <Label htmlFor="serviceDescription" className="text-sm font-medium text-slate-700">
                ì„œë¹„ìŠ¤ ì„¤ëª… <span className="text-red-500">*</span>
              </Label>
              <Textarea
                id="serviceDescription"
                value={formData.serviceDescription}
                onChange={(e) => setFormData({ ...formData, serviceDescription: e.target.value })}
                placeholder="ì–´ë–¤ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ê³  ê³„ì‹ ì§€ ê°„ë‹¨íˆ ì„¤ëª…í•´ì£¼ì„¸ìš”"
                rows={4}
                className="mt-1.5"
                required
              />
            </div>

            <div>
              <Label htmlFor="currentUsage" className="text-sm font-medium text-slate-700">
                í˜„ì¬ ì´ìš© ì—¬ë¶€
              </Label>
              <Input
                id="currentUsage"
                value={formData.currentUsage}
                onChange={(e) => setFormData({ ...formData, currentUsage: e.target.value })}
                placeholder="ì˜ˆ: í˜„ì¬ ì´ìš© ì¤‘ / ì´ìš© ì˜ˆì •"
                className="mt-1.5"
              />
            </div>

            <div className="flex justify-end gap-3 pt-4">
              <Button
                type="button"
                variant="outline"
                onClick={() => setIsDialogOpen(false)}
                disabled={isLoading}
              >
                ì·¨ì†Œ
              </Button>
              <Button
                type="submit"
                disabled={isLoading}
                className="bg-blue-600 hover:bg-blue-700"
              >
                {isLoading ? (
                  <>
                    <Loader2 className="mr-2 h-4 w-4 animate-spin" />
                    ì‹ ì²­ ì¤‘...
                  </>
                ) : (
                  "ì‹ ì²­í•˜ê¸°"
                )}
              </Button>
            </div>
          </form>
        </DialogContent>
      </Dialog>
    </>
  )
}
</file>

<file path="components/partner-proposal-button-client.tsx">
"use client"

import { useState } from "react"
import { Button } from "@/components/ui/button"
import { Plus } from "lucide-react"
import { PartnerProposalDialog } from "@/components/partner-proposal-dialog"

export function PartnerProposalButtonClient() {
  const [isDialogOpen, setIsDialogOpen] = useState(false)

  return (
    <>
      <Button
        onClick={() => setIsDialogOpen(true)}
        className="bg-white border border-gray-200 shadow-sm hover:bg-gray-50 text-black rounded-full px-4 h-10 inline-flex items-center gap-2"
      >
        <Plus className="w-4 h-4" />
        íŒŒíŠ¸ë„ˆìŠ¤ ì‹ ì²­
      </Button>

      <PartnerProposalDialog
        open={isDialogOpen}
        onOpenChange={setIsDialogOpen}
      />
    </>
  )
}
</file>

<file path="components/partner-proposal-dialog.tsx">
"use client"

import { useState, useEffect, useRef } from "react"
import { Button } from "@/components/ui/button"
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogDescription,
} from "@/components/ui/dialog"
import { Input } from "@/components/ui/input"
import { Label } from "@/components/ui/label"
import { Textarea } from "@/components/ui/textarea"
import { Loader2 } from "lucide-react"
import { createPartnerProposal } from "@/lib/actions/partner-proposals"
import { fetchUrlMetadata } from "@/lib/actions/utils"
import { useToast } from "@/hooks/use-toast"
import Image from "next/image"

type PartnerProposalDialogProps = {
  open: boolean
  onOpenChange: (open: boolean) => void
}

export function PartnerProposalDialog({ open, onOpenChange }: PartnerProposalDialogProps) {
  const [isLoading, setIsLoading] = useState(false)
  const [isFetchingThumbnail, setIsFetchingThumbnail] = useState(false)
  const [thumbnailUrl, setThumbnailUrl] = useState<string>("")
  const [formData, setFormData] = useState({
    contactName: "",
    contactEmail: "",
    companyName: "",
    serviceName: "",
    websiteUrl: "",
    benefitProposal: "",
  })
  const { toast } = useToast()
  const debounceTimerRef = useRef<NodeJS.Timeout | null>(null)

  // URLì—ì„œ ì¸ë„¤ì¼ ì¶”ì¶œ í•¨ìˆ˜
  const handleFetchThumbnail = async (url: string) => {
    if (!url || !url.trim()) {
      setThumbnailUrl("")
      return
    }

    // URL í˜•ì‹ ê²€ì¦
    try {
      new URL(url)
    } catch {
      setThumbnailUrl("")
      return
    }

    setIsFetchingThumbnail(true)
    try {
      const result = await fetchUrlMetadata(url)
      if (result.thumbnailUrl) {
        setThumbnailUrl(result.thumbnailUrl)
      } else {
        setThumbnailUrl("")
      }
    } catch (error) {
      console.error("Failed to fetch thumbnail:", error)
      setThumbnailUrl("")
    } finally {
      setIsFetchingThumbnail(false)
    }
  }

  // ì›¹ì‚¬ì´íŠ¸ URL ë³€ê²½ í•¸ë“¤ëŸ¬ (ë””ë°”ìš´ìŠ¤ ì ìš©)
  const handleWebsiteUrlChange = (value: string) => {
    setFormData({ ...formData, websiteUrl: value })
    setThumbnailUrl("") // ì´ˆê¸°í™”

    // ë””ë°”ìš´ìŠ¤: ì…ë ¥ì´ ë©ˆì¶˜ í›„ 1ì´ˆ ë’¤ì— ì¸ë„¤ì¼ ê°€ì ¸ì˜¤ê¸°
    if (debounceTimerRef.current) {
      clearTimeout(debounceTimerRef.current)
    }

    debounceTimerRef.current = setTimeout(() => {
      if (value && value.trim()) {
        handleFetchThumbnail(value)
      }
    }, 1000)
  }

  // ì›¹ì‚¬ì´íŠ¸ URL í¬ì»¤ìŠ¤ ì•„ì›ƒ í•¸ë“¤ëŸ¬
  const handleWebsiteUrlBlur = () => {
    if (formData.websiteUrl && formData.websiteUrl.trim() && !thumbnailUrl) {
      handleFetchThumbnail(formData.websiteUrl)
    }
  }

  // ë‹¤ì´ì–¼ë¡œê·¸ê°€ ë‹«í ë•Œ ìƒíƒœ ì´ˆê¸°í™”
  useEffect(() => {
    if (!open) {
      setFormData({
        contactName: "",
        contactEmail: "",
        companyName: "",
        serviceName: "",
        websiteUrl: "",
        benefitProposal: "",
      })
      setThumbnailUrl("")
      if (debounceTimerRef.current) {
        clearTimeout(debounceTimerRef.current)
      }
    }
  }, [open])

  const handleSubmit = async (e: React.FormEvent<HTMLFormElement>) => {
    e.preventDefault()

    // í•„ìˆ˜ í•„ë“œ ê²€ì¦
    if (
      !formData.contactName.trim() ||
      !formData.contactEmail.trim() ||
      !formData.companyName.trim() ||
      !formData.serviceName.trim() ||
      !formData.benefitProposal.trim()
    ) {
      toast({
        variant: "destructive",
        title: "ì…ë ¥ í•„ìš”",
        description: "í•„ìˆ˜ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.",
      })
      return
    }

    setIsLoading(true)

    try {
      const result = await createPartnerProposal({
        contactName: formData.contactName,
        contactEmail: formData.contactEmail,
        companyName: formData.companyName,
        serviceName: formData.serviceName,
        websiteUrl: formData.websiteUrl,
        benefitProposal: formData.benefitProposal,
        thumbnailUrl: thumbnailUrl,
      })

      // ì„±ê³µ ì‘ë‹µ í™•ì¸
      if (result && result.success === false) {
        throw new Error(result.error || "ì‹ ì²­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")
      }

      toast({
        title: "ì‹ ì²­ ì™„ë£Œ",
        description: "ì‹ ì²­ì´ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹´ë‹¹ìê°€ ê²€í†  í›„ ì—°ë½ë“œë¦½ë‹ˆë‹¤.",
      })

      // í¼ ì´ˆê¸°í™”
      setFormData({
        contactName: "",
        contactEmail: "",
        companyName: "",
        serviceName: "",
        websiteUrl: "",
        benefitProposal: "",
      })
      setThumbnailUrl("")

      onOpenChange(false)
    } catch (error) {
      console.error("Partner proposal error:", error)
      
      // ì—ëŸ¬ ë©”ì‹œì§€ ì¶”ì¶œ
      let errorMessage = "ì‹ ì²­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."
      if (error instanceof Error) {
        errorMessage = error.message
      } else if (typeof error === "string") {
        errorMessage = error
      }

      // DB í…Œì´ë¸” ê´€ë ¨ ì—ëŸ¬ì¸ ê²½ìš° ë” ëª…í™•í•œ ë©”ì‹œì§€
      if (errorMessage.includes("table") || errorMessage.includes("relation") || errorMessage.includes("does not exist")) {
        errorMessage = "ë°ì´í„°ë² ì´ìŠ¤ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”."
      }

      toast({
        variant: "destructive",
        title: "ì‹ ì²­ ì‹¤íŒ¨",
        description: errorMessage,
      })
    } finally {
      setIsLoading(false)
    }
  }

  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      <DialogContent className="sm:max-w-lg">
        <DialogHeader>
          <DialogTitle>ì œíœ´ íŒŒíŠ¸ë„ˆ ì‹ ì²­</DialogTitle>
          <DialogDescription>
            SFCì™€ ì œíœ´ë¥¼ ì›í•˜ì‹œëŠ” íŒŒíŠ¸ë„ˆì‚¬ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.
          </DialogDescription>
        </DialogHeader>

        <form onSubmit={handleSubmit} className="space-y-4 mt-4">
          <div>
            <Label htmlFor="contactName" className="text-sm font-medium text-slate-700">
              ë‹´ë‹¹ì ì„±í•¨ <span className="text-red-500">*</span>
            </Label>
            <Input
              id="contactName"
              value={formData.contactName}
              onChange={(e) => setFormData({ ...formData, contactName: e.target.value })}
              placeholder="í™ê¸¸ë™"
              className="mt-1.5"
              required
            />
          </div>

          <div>
            <Label htmlFor="contactEmail" className="text-sm font-medium text-slate-700">
              ì—°ë½ì²˜ (ì´ë©”ì¼) <span className="text-red-500">*</span>
            </Label>
            <Input
              id="contactEmail"
              type="email"
              value={formData.contactEmail}
              onChange={(e) => setFormData({ ...formData, contactEmail: e.target.value })}
              placeholder="contact@example.com"
              className="mt-1.5"
              required
            />
          </div>

          <div>
            <Label htmlFor="companyName" className="text-sm font-medium text-slate-700">
              íšŒì‚¬ëª… <span className="text-red-500">*</span>
            </Label>
            <Input
              id="companyName"
              value={formData.companyName}
              onChange={(e) => setFormData({ ...formData, companyName: e.target.value })}
              placeholder="(ì£¼)íšŒì‚¬ëª…"
              className="mt-1.5"
              required
            />
          </div>

          <div>
            <Label htmlFor="serviceName" className="text-sm font-medium text-slate-700">
              ì„œë¹„ìŠ¤ëª… <span className="text-red-500">*</span>
            </Label>
            <Input
              id="serviceName"
              value={formData.serviceName}
              onChange={(e) => setFormData({ ...formData, serviceName: e.target.value })}
              placeholder="ì„œë¹„ìŠ¤ ë˜ëŠ” ì œí’ˆëª…"
              className="mt-1.5"
              required
            />
          </div>

          <div>
            <Label htmlFor="websiteUrl" className="text-sm font-medium text-slate-700">
              ì›¹ì‚¬ì´íŠ¸ URL
            </Label>
            <Input
              id="websiteUrl"
              type="url"
              value={formData.websiteUrl}
              onChange={(e) => handleWebsiteUrlChange(e.target.value)}
              onBlur={handleWebsiteUrlBlur}
              placeholder="https://example.com"
              className="mt-1.5"
            />
            {isFetchingThumbnail && (
              <p className="mt-2 text-xs text-slate-500 flex items-center gap-2">
                <Loader2 className="h-3 w-3 animate-spin" />
                ì¸ë„¤ì¼ ì´ë¯¸ì§€ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘...
              </p>
            )}
            {thumbnailUrl && !isFetchingThumbnail && (
              <div className="mt-3">
                <Label className="text-xs text-slate-600 mb-2 block">ì‚¬ì´íŠ¸ ì¸ë„¤ì¼ ë¯¸ë¦¬ë³´ê¸°</Label>
                <div className="aspect-video w-full rounded-lg overflow-hidden border border-slate-200 bg-slate-50">
                  <Image
                    src={thumbnailUrl}
                    alt="Website thumbnail"
                    width={800}
                    height={450}
                    className="w-full h-full object-cover"
                    onError={() => setThumbnailUrl("")}
                  />
                </div>
              </div>
            )}
          </div>

          <div>
            <Label htmlFor="benefitProposal" className="text-sm font-medium text-slate-700">
              ì œì•ˆí•  í˜œíƒ ë‚´ìš© <span className="text-red-500">*</span>
            </Label>
            <Textarea
              id="benefitProposal"
              value={formData.benefitProposal}
              onChange={(e) => setFormData({ ...formData, benefitProposal: e.target.value })}
              placeholder="ì˜ˆ: 3ê°œì›” ë¬´ë£Œ ì´ìš©ê¶Œ ì œê³µ, ì²« ë‹¬ 50% í• ì¸ ë“±"
              rows={4}
              className="mt-1.5"
              required
            />
          </div>

          <div className="flex justify-end gap-3 pt-4">
            <Button
              type="button"
              variant="outline"
              onClick={() => onOpenChange(false)}
              disabled={isLoading}
            >
              ì·¨ì†Œ
            </Button>
            <Button 
              type="submit" 
              disabled={isLoading} 
              className="bg-slate-900 hover:bg-slate-800 text-white disabled:opacity-50 disabled:cursor-not-allowed"
            >
              {isLoading ? (
                <>
                  <Loader2 className="mr-2 h-4 w-4 animate-spin" />
                  ì œì¶œ ì¤‘...
                </>
              ) : (
                "ì‹ ì²­í•˜ê¸°"
              )}
            </Button>
          </div>
        </form>
      </DialogContent>
    </Dialog>
  )
}
</file>

<file path="components/payment/toss-payment-widget.tsx">
"use client";

import { useState } from "react";
import { loadTossPayments } from "@tosspayments/payment-sdk";
import { Button } from "@/components/ui/button";
import { Loader2 } from "lucide-react";
import { useToast } from "@/hooks/use-toast";

interface TossPaymentWidgetProps {
  amount: number;
  orderId: string;
  orderName: string;
  customerName: string;
  customerEmail: string;
  successUrl: string;
  failUrl: string;
}

export function TossPaymentWidget({
  amount,
  orderId,
  orderName,
  customerName,
  customerEmail,
  successUrl,
  failUrl,
}: TossPaymentWidgetProps) {
  const [isProcessing, setIsProcessing] = useState(false);
  const { toast } = useToast();

  const handlePayment = async () => {
    const clientKey = process.env.NEXT_PUBLIC_TOSS_CLIENT_KEY;

    if (!clientKey) {
      toast({
        variant: "destructive",
        title: "ì„¤ì • ì˜¤ë¥˜",
        description: "í´ë¼ì´ì–¸íŠ¸ í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.",
      });
      return;
    }

    setIsProcessing(true);

    try {
      // 1. í† ìŠ¤í˜ì´ë¨¼ì¸  ê°ì²´ ë¡œë“œ
      const tossPayments = await loadTossPayments(clientKey);

      // 2. ê²°ì œì°½ í˜¸ì¶œ (ì¹´ë“œ ê²°ì œ ê¸°ì¤€)
      await tossPayments.requestPayment("ì¹´ë“œ", {
        amount: amount,
        orderId: orderId,
        orderName: orderName,
        customerName: customerName,
        customerEmail: customerEmail,
        successUrl: `${window.location.origin}${successUrl}`,
        failUrl: `${window.location.origin}${failUrl}`,
      });
    } catch (error: any) {
      console.error("ê²°ì œ ì‹¤íŒ¨:", error);
      
      if (error.code === "USER_CANCEL") {
        // ì‚¬ìš©ìê°€ ê²°ì œì°½ì„ ë‹«ì€ ê²½ìš° -> ì•„ë¬´ê²ƒë„ ì•ˆ í•¨
      } else {
        toast({
          variant: "destructive",
          title: "ê²°ì œ ì‹¤íŒ¨",
          description: error.message || "ê²°ì œ ì§„í–‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",
        });
      }
      setIsProcessing(false);
    }
  };

  return (
    <div className="w-full py-8 flex flex-col items-center justify-center text-center space-y-4">
      <div className="bg-slate-50 p-6 rounded-lg border border-slate-100 w-full mb-4">
        <p className="text-slate-500 text-sm mb-1">ê²°ì œ ê¸ˆì•¡</p>
        <p className="text-3xl font-bold text-slate-900">{amount.toLocaleString()}ì›</p>
        <p className="text-slate-400 text-xs mt-2">{orderName}</p>
      </div>

      <Button
        className="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold h-14 text-lg rounded-xl shadow-lg transition-all hover:scale-[1.02]"
        onClick={handlePayment}
        disabled={isProcessing}
      >
        {isProcessing ? (
          <>
            <Loader2 className="mr-2 h-5 w-5 animate-spin" />
            ê²°ì œì°½ ë„ìš°ëŠ” ì¤‘...
          </>
        ) : (
          "ê²°ì œí•˜ê¸°"
        )}
      </Button>
      
      <p className="text-xs text-slate-400">
        ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ í† ìŠ¤í˜ì´ë¨¼ì¸  ê²°ì œì°½ì´ ì—´ë¦½ë‹ˆë‹¤.
      </p>
    </div>
  );
}
</file>

<file path="components/post-actions.tsx">
"use client"

import { useState } from "react"
import { useRouter } from "next/navigation"
import { Button } from "@/components/ui/button"
import { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from "@/components/ui/dropdown-menu"
import { MoreVertical, Edit, Trash2 } from "lucide-react"
import {
  AlertDialog,
  AlertDialogAction,
  AlertDialogCancel,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogTitle,
} from "@/components/ui/alert-dialog"
import { deletePost } from "@/lib/actions/posts"

type PostActionsProps = {
  postId: string
  isAuthor: boolean
  isMaster?: boolean
  isAdmin?: boolean
  slug?: string // ê²Œì‹œíŒ slug (ì„ íƒì‚¬í•­)
  redirectUrl?: string // ì‚­ì œ í›„ ë¦¬ë‹¤ì´ë ‰íŠ¸ URL (ì„ íƒì‚¬í•­)
}

export function PostActions({ postId, isAuthor, isMaster = false, isAdmin = false, slug, redirectUrl }: PostActionsProps) {
  const [showDeleteDialog, setShowDeleteDialog] = useState(false)
  const [isDeleting, setIsDeleting] = useState(false)
  const router = useRouter()

  const handleDelete = async () => {
    setIsDeleting(true)
    try {
      await deletePost(postId)
      // redirectUrlì´ ìˆìœ¼ë©´ ê·¸ê²ƒì„ ì‚¬ìš©, ì—†ìœ¼ë©´ ê¸°ë³¸ê°’
      const redirectPath = redirectUrl || (slug ? `/community/board/${slug}` : "/community/posts")
      router.push(redirectPath)
      router.refresh()
    } catch (error) {
      console.error("Failed to delete post:", error)
      alert("ê²Œì‹œê¸€ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")
    } finally {
      setIsDeleting(false)
    }
  }

  // ì‘ì„±ìê°€ ì•„ë‹ˆê³  ê´€ë¦¬ìë„ ì•„ë‹ˆë©´ ì•„ë¬´ê²ƒë„ í‘œì‹œí•˜ì§€ ì•ŠìŒ
  if (!isAuthor && !isMaster && !isAdmin) {
    return null
  }

  // ì‚­ì œ ê°€ëŠ¥ ì—¬ë¶€ (ì‘ì„±ì ë˜ëŠ” ê´€ë¦¬ì/ë§ˆìŠ¤í„°)
  const canDelete = isAuthor || isMaster || isAdmin
  // ìˆ˜ì • ê°€ëŠ¥ ì—¬ë¶€ (ì‘ì„±ìë§Œ)
  const canEdit = isAuthor

  return (
    <>
      <div className="h-8 w-8 shrink-0 flex items-center justify-center">
        <DropdownMenu modal={false}>
          <DropdownMenuTrigger asChild>
            <Button variant="ghost" size="icon" className="h-8 w-8">
              <MoreVertical className="h-4 w-4" />
            </Button>
          </DropdownMenuTrigger>
          <DropdownMenuContent 
            align="end" 
            className="bg-white border-slate-200 shadow-lg z-50"
            onCloseAutoFocus={(e) => e.preventDefault()}
          >
            {canEdit && (
              <DropdownMenuItem onClick={() => {
                // slugê°€ ìˆìœ¼ë©´ ê²Œì‹œíŒë³„ ìˆ˜ì • í˜ì´ì§€ë¡œ, ì—†ìœ¼ë©´ ê¸°ë³¸ ìˆ˜ì • í˜ì´ì§€ë¡œ
                const editUrl = slug 
                  ? `/community/board/${slug}/${postId}/edit`
                  : `/community/posts/${postId}/edit`
                router.push(editUrl)
              }} className="bg-white hover:bg-slate-50">
                <Edit className="mr-2 h-4 w-4" />
                ìˆ˜ì •
              </DropdownMenuItem>
            )}
            {canDelete && (
              <DropdownMenuItem className="text-red-600 bg-white hover:bg-red-50" onClick={() => setShowDeleteDialog(true)}>
                <Trash2 className="mr-2 h-4 w-4" />
                ì‚­ì œ
              </DropdownMenuItem>
            )}
          </DropdownMenuContent>
        </DropdownMenu>
      </div>

      <AlertDialog open={showDeleteDialog} onOpenChange={setShowDeleteDialog}>
        <AlertDialogContent className="bg-white">
          <AlertDialogHeader>
            <AlertDialogTitle>ê²Œì‹œê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</AlertDialogTitle>
            <AlertDialogDescription>
              ì´ ì‘ì—…ì€ ì·¨ì†Œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê²Œì‹œê¸€ê³¼ ëª¨ë“  ëŒ“ê¸€ì´ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤.
            </AlertDialogDescription>
          </AlertDialogHeader>
          <AlertDialogFooter>
            <AlertDialogCancel variant="outline">ì·¨ì†Œ</AlertDialogCancel>
            <AlertDialogAction 
              onClick={handleDelete} 
              disabled={isDeleting} 
              className="bg-red-600 hover:bg-red-700 text-white"
            >
              {isDeleting ? "ì‚­ì œ ì¤‘..." : "ì‚­ì œ"}
            </AlertDialogAction>
          </AlertDialogFooter>
        </AlertDialogContent>
      </AlertDialog>
    </>
  )
}
</file>

<file path="components/post-card.tsx">
"use client"

import Link from "next/link"
import { MessageSquare, Share2 } from "lucide-react"
import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar"
import { Badge } from "@/components/ui/badge"
import { Card, CardContent } from "@/components/ui/card"
import { Button } from "@/components/ui/button"
import { LikeButton } from "@/components/like-button"
import { cn } from "@/lib/utils"

export type PostCardData = {
  id: string
  title: string
  created_at: string
  content_preview?: string | null
  thumbnail_url?: string | null
  likes_count: number
  comments_count: number
  board_categories?: { name: string | null; slug: string | null } | null
  profiles?: { id: string; full_name: string | null; avatar_url: string | null } | null
  is_announcement?: boolean | null
}

type PostCardProps = {
  post: PostCardData
  href?: string
  userId?: string
  onLikeChange?: (count: number) => void
  className?: string
}

export function PostCard({ post, href = `/community/board/${post.board_categories?.slug ?? "community"}/${post.id}`, userId, onLikeChange, className }: PostCardProps) {
  const dateLabel = new Date(post.created_at).toLocaleDateString("ko-KR", {
    month: "short",
    day: "numeric",
  })

  return (
    <Card className={cn("border-0 bg-white shadow-sm shadow-slate-900/5 ring-1 ring-slate-900/[0.04] hover:shadow-md hover:ring-slate-900/[0.08] transition-all duration-200 group", className)}>
      <CardContent className="p-5 sm:p-6">
        {/* í—¤ë” */}
        <div className="flex items-center gap-3 mb-3">
          <Avatar className="h-8 w-8">
            <AvatarImage src={post.profiles?.avatar_url || undefined} />
            <AvatarFallback className="bg-slate-100 text-slate-500 text-xs font-semibold">
              {post.profiles?.full_name?.[0] || "U"}
            </AvatarFallback>
          </Avatar>
          <div className="flex-1 min-w-0">
            <div className="flex items-center gap-2 text-xs text-slate-500">
              <span className="truncate">{post.profiles?.full_name || "ìµëª…"}</span>
              <span>â€¢</span>
              <span>{dateLabel}</span>
            </div>
            {post.board_categories?.name && (
              <div className="flex items-center gap-1 mt-1">
                <Badge variant="secondary" className="text-[11px]">
                  {post.board_categories.name}
                </Badge>
                {post.is_announcement && (
                  <Badge variant="outline" className="text-[11px] border-amber-200 text-amber-700 bg-amber-50">
                    ê³µì§€
                  </Badge>
                )}
              </div>
            )}
          </div>
        </div>

        {/* ë³¸ë¬¸ */}
        <Link href={href} className="block group">
          <h3 className="text-lg sm:text-xl font-semibold text-slate-900 group-hover:text-blue-600 transition-colors leading-snug">
            {post.title}
          </h3>
          {post.content_preview && (
            <p className="mt-2 text-sm text-slate-600 line-clamp-2 whitespace-pre-line">
              {post.content_preview}
            </p>
          )}
          {post.thumbnail_url && (
            <div className="mt-3 overflow-hidden rounded-lg border border-slate-100 bg-slate-50">
              <img
                src={post.thumbnail_url}
                alt={post.title}
                className="h-44 w-full object-cover transition-transform duration-200 group-hover:scale-[1.01]"
                loading="lazy"
              />
            </div>
          )}
        </Link>

        {/* ì•¡ì…˜ ë°” */}
        <div className="mt-4 flex items-center gap-2 text-sm text-slate-500">
          <LikeButton
            postId={post.id}
            userId={userId}
            initialLiked={false}
            initialCount={post.likes_count || 0}
            onLikeChange={onLikeChange}
          />
          <Button variant="ghost" size="sm" className="gap-1.5 px-2 text-slate-500 hover:text-slate-700" asChild>
            <Link href={href}>
              <MessageSquare className="h-4 w-4" />
              <span className="text-xs">{post.comments_count || 0}</span>
            </Link>
          </Button>
          <Button
            variant="ghost"
            size="sm"
            className="gap-1.5 px-2 text-slate-500 hover:text-slate-700"
            onClick={() => {
              if (typeof navigator !== "undefined") {
                navigator.clipboard.writeText(`${window.location.origin}${href}`).catch(() => {})
              }
            }}
          >
            <Share2 className="h-4 w-4" />
            <span className="text-xs">ê³µìœ </span>
          </Button>
        </div>
      </CardContent>
    </Card>
  )
}
</file>

<file path="components/reviews/review-card.tsx">
"use client"

import { useState } from "react"
import { Star, ChevronDown, ChevronUp, Award, Calendar } from "lucide-react"
import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar"
import { Badge } from "@/components/ui/badge"
import { Button } from "@/components/ui/button"
import { Card } from "@/components/ui/card"
import type { ReviewForDisplay } from "@/lib/types/reviews"
import { cn } from "@/lib/utils"
import Link from "next/link"

interface ReviewCardProps {
    review: ReviewForDisplay
    className?: string
}

export function ReviewCard({ review, className }: ReviewCardProps) {
    const [isExpanded, setIsExpanded] = useState(false)

    const renderStars = (rating: number) => {
        const stars = []
        const fullStars = Math.floor(rating)
        const hasHalfStar = rating % 1 !== 0

        for (let i = 0; i < 5; i++) {
            if (i < fullStars) {
                stars.push(<Star key={i} className="h-3.5 w-3.5 fill-yellow-400 text-yellow-400" />)
            } else if (i === fullStars && hasHalfStar) {
                stars.push(
                    <div key={i} className="relative h-3.5 w-3.5">
                        <Star className="h-3.5 w-3.5 fill-gray-200 text-gray-300 absolute" />
                        <Star
                            className="h-3.5 w-3.5 fill-yellow-400 text-yellow-400 absolute"
                            style={{ clipPath: "polygon(0 0, 50% 0, 50% 100%, 0 100%)" }}
                        />
                    </div>
                )
            } else {
                stars.push(<Star key={i} className="h-3.5 w-3.5 fill-gray-200 text-gray-300" />)
            }
        }
        return stars
    }

    const getInitials = (name: string | null) => {
        if (!name) return "?"
        return name.split(" ").map((n) => n[0]).join("").toUpperCase().slice(0, 2)
    }

    const formatDate = (dateString: string) => {
        return new Date(dateString).toLocaleDateString("ko-KR", {
            year: "numeric",
            month: "long",
            day: "numeric",
        })
    }

    return (
        <Card
            className={cn(
                "group relative overflow-hidden",
                "bg-white/90 dark:bg-slate-900/90 backdrop-blur-xl",
                "border border-slate-200/60 dark:border-slate-700/60",
                "shadow-sm hover:shadow-lg transition-all duration-300",
                "hover:border-primary/30",
                className
            )}
        >
            {/* ë² ìŠ¤íŠ¸ ë±ƒì§€ */}
            {review.is_best && (
                <div className="absolute top-3 right-3 z-10">
                    <Badge className="bg-gradient-to-r from-amber-500 to-orange-500 text-white border-0 gap-1 shadow-sm text-xs">
                        <Award className="h-3 w-3" />
                        BEST
                    </Badge>
                </div>
            )}

            {/* ê°€ë¡œ ë ˆì´ì•„ì›ƒ */}
            <div className="flex flex-col sm:flex-row">
                {/* ì™¼ìª½: ë‚ ì§œ & ì‚¬ìš©ì ì •ë³´ & ë³„ì  - ì¤‘ì•™ ì •ë ¬ ì ìš© */}
                <div className="sm:w-48 flex-shrink-0 p-5 border-b sm:border-b-0 sm:border-r border-slate-100 dark:border-slate-800 bg-slate-50/50 dark:bg-slate-800/30 flex flex-col items-center text-center space-y-4">
                    <div className="w-full flex items-center gap-1.5 text-xs text-slate-500 dark:text-slate-400">
                        <Calendar className="h-3 w-3" />
                        <time>{formatDate(review.created_at)}</time>
                    </div>

                    <div className="flex flex-col items-center gap-3 w-full pt-1">
                        <Avatar className="h-14 w-14 ring-4 ring-white dark:ring-slate-900 shadow-sm">
                            <AvatarImage src={review.profiles?.avatar_url || undefined} />
                            <AvatarFallback className="bg-gradient-to-br from-primary/20 to-primary/10 text-primary font-semibold text-sm">
                                {getInitials(review.profiles?.full_name ?? "")}
                            </AvatarFallback>
                        </Avatar>

                        <div className="space-y-0.5">
                            <div className="flex items-center justify-center gap-1.5">
                                <h3 className="font-bold text-slate-900 dark:text-slate-50 text-[15px]">
                                    {review.profiles?.full_name || "ìµëª…"}
                                </h3>
                                {review.profiles?.role === "admin" && (
                                    <Badge variant="secondary" className="text-[10px] py-0 h-4 px-1">
                                        ìš´ì˜ì§„
                                    </Badge>
                                )}
                            </div>
                            {(review.profiles?.company || review.profiles?.position) && (
                                <p className="text-xs text-slate-500 dark:text-slate-400 line-clamp-1 max-w-[140px] mx-auto">
                                    {review.profiles?.company && review.profiles?.position
                                        ? `${review.profiles.company} Â· ${review.profiles.position}`
                                        : review.profiles?.company || review.profiles?.position}
                                </p>
                            )}
                        </div>

                        <div className="flex items-center gap-1.5 bg-white dark:bg-slate-900 px-2.5 py-1 rounded-full border border-slate-100 dark:border-slate-800 shadow-sm mt-1">
                            <div className="flex gap-0.5">{renderStars(review.rating)}</div>
                            <span className="text-xs font-bold text-slate-700 dark:text-slate-300 ml-0.5">
                                {review.rating.toFixed(1)}
                            </span>
                        </div>
                    </div>
                </div>

                {/* ì˜¤ë¥¸ìª½: ë¦¬ë·° ë‚´ìš© */}
                <div className="flex-1 p-5 space-y-3">
                    {/* í–‰ì‚¬ëª… + ë‚ ì§œ (ì•„ì´ì½˜ ì œê±°ë¨) */}
                    <Link href={`/events/${review.events.id}`} className="block group/event">
                        <div className="flex items-center justify-between p-2.5 rounded-lg bg-slate-50 dark:bg-slate-800/50 border border-slate-100 dark:border-slate-800 hover:border-primary/20 hover:bg-slate-100 dark:hover:bg-slate-800 transition-all duration-300">
                            <div className="flex items-center gap-2 min-w-0">
                                <Calendar className="h-4 w-4 text-primary shrink-0" />
                                <div className="flex flex-col gap-0.5 min-w-0">
                                    <h4 className="font-semibold text-sm text-slate-900 dark:text-slate-100 truncate pr-1 group-hover/event:text-primary transition-colors">
                                        {review.events.title}
                                    </h4>
                                    <span className="text-xs text-slate-500 dark:text-slate-400">
                                        {formatDate(review.events.event_date)}
                                    </span>
                                </div>
                            </div>
                            {/* ê³µìœ  ì•„ì´ì½˜(ExternalLink) ì œê±°ë¨ */}
                        </div>
                    </Link>

                    {/* í‚¤ì›Œë“œ */}
                    {review.keywords.length > 0 && (
                        <div className="flex flex-wrap gap-1.5">
                            {review.keywords.map((keyword, index) => (
                                <Badge
                                    key={index}
                                    variant="outline"
                                    className="bg-primary/5 border-primary/20 text-primary text-xs px-2.5 py-0.5 font-normal"
                                >
                                    {keyword}
                                </Badge>
                            ))}
                        </div>
                    )}

                    {/* í•œ ì¤„ í‰ */}
                    <blockquote className="relative pl-3 py-1 before:content-[''] before:absolute before:left-0 before:top-0 before:bottom-0 before:w-0.5 before:bg-gradient-to-b before:from-primary before:to-primary/50 before:rounded-full">
                        <p className="text-sm font-semibold text-slate-900 dark:text-slate-50 leading-relaxed line-clamp-2">
                            "{review.one_liner}"
                        </p>
                    </blockquote>

                    {/* ìƒì„¸ ë‚´ìš© */}
                    {review.detail_content && (
                        <div className="space-y-2 pt-2 border-t border-slate-100/50 dark:border-slate-800/50">
                            {isExpanded && (
                                <div className="prose prose-sm dark:prose-invert max-w-none animate-in fade-in duration-300">
                                    <p className="text-sm text-slate-600 dark:text-slate-300 whitespace-pre-wrap leading-relaxed">
                                        {review.detail_content}
                                    </p>
                                </div>
                            )}
                            <Button
                                variant="ghost"
                                size="sm"
                                onClick={() => setIsExpanded(!isExpanded)}
                                className="w-full justify-center gap-1 text-xs text-slate-500 hover:text-primary hover:bg-primary/5 h-8"
                            >
                                {isExpanded ? (
                                    <>
                                        ì ‘ê¸° <ChevronUp className="h-3 w-3" />
                                    </>
                                ) : (
                                    <>
                                        ë”ë³´ê¸° <ChevronDown className="h-3 w-3" />
                                    </>
                                )}
                            </Button>
                        </div>
                    )}

                    {/* ì´ë¯¸ì§€ */}
                    {review.images && review.images.length > 0 && (
                        <div className="grid grid-cols-4 gap-2 pt-1">
                            {review.images.slice(0, 4).map((image, index) => (
                                <div
                                    key={index}
                                    className="aspect-square rounded-md bg-slate-100 dark:bg-slate-800 overflow-hidden shadow-sm"
                                >
                                    <img
                                        src={image}
                                        alt={`í›„ê¸° ì´ë¯¸ì§€ ${index + 1}`}
                                        className="w-full h-full object-cover hover:scale-110 transition-transform duration-300"
                                    />
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            </div>
        </Card>
    )
}
</file>

<file path="components/reviews/review-modal.tsx">
"use client"

import { useState } from "react"
import { Star } from "lucide-react"
import {
    Dialog,
    DialogContent,
    DialogDescription,
    DialogHeader,
    DialogTitle,
    DialogTrigger,
} from "@/components/ui/dialog"
import { Button } from "@/components/ui/button"
import { Textarea } from "@/components/ui/textarea"
import { Input } from "@/components/ui/input"
import { toast } from "sonner"
import { cn } from "@/lib/utils"
import { Collapsible, CollapsibleContent, CollapsibleTrigger } from "@/components/ui/collapsible"
import { createReview } from "@/lib/actions/reviews"

const REVIEW_KEYWORDS = [
    "ì¸ì‚¬ì´íŠ¸ê°€ ë„˜ì³ìš”",
    "ë„¤íŠ¸ì›Œí‚¹ì´ ì¢‹ì•„ìš”",
    "ìš´ì˜ì´ ë§¤ë„ëŸ¬ì›Œìš”",
    "ë¶„ìœ„ê¸°ê°€ í¸ì•ˆí•´ìš”",
    "ë™ê¸°ë¶€ì—¬ê°€ ë¼ìš”",
    "ì‹¤ë¬´ì— ìœ ìš©í•´ìš”",
    "ë‹¤ìŒì— ë˜ ì˜¤ê³  ì‹¶ì–´ìš”",
    "ê°•ì—°ì´ ì•Œì°¨ìš”",
]

interface ReviewModalProps {
    userId: string
    eventId: string
    open?: boolean
    onOpenChange?: (open: boolean) => void
}

export function ReviewModal({ userId, eventId, open, onOpenChange }: ReviewModalProps) {
    const [rating, setRating] = useState(0)
    const [hoveredRating, setHoveredRating] = useState(0)
    const [selectedKeywords, setSelectedKeywords] = useState<string[]>([])
    const [oneLiner, setOneLiner] = useState("")
    const [detailContent, setDetailContent] = useState("")
    const [isOptionalOpen, setIsOptionalOpen] = useState(false)
    const [isSubmitting, setIsSubmitting] = useState(false)
    const [internalOpen, setInternalOpen] = useState(false)

    const isControlled = typeof open === "boolean" && typeof onOpenChange === "function"
    const isOpen = isControlled ? open : internalOpen
    const handleOpenChange = isControlled ? onOpenChange! : setInternalOpen

    const isValid = rating >= 0.5 && oneLiner.length >= 20 && oneLiner.length <= 100 && selectedKeywords.length > 0

    const handleStarClick = (index: number, isHalf: boolean) => {
        const newRating = index + (isHalf ? 0.5 : 1)
        setRating(newRating)
    }

    const toggleKeyword = (keyword: string) => {
        setSelectedKeywords((prev) =>
            prev.includes(keyword) ? prev.filter((k) => k !== keyword) : [...prev, keyword]
        )
    }

    const handleSubmit = async () => {
        // userId ì²´í¬ëŠ” í˜¸ì¶œí•˜ëŠ” ìª½(ReviewWriteButton)ì—ì„œ ì´ë¯¸ ìˆ˜í–‰í–ˆìœ¼ë¯€ë¡œ ì—¬ê¸°ì„  ìƒëµí•˜ê±°ë‚˜ ì´ì¤‘ ì²´í¬
        if (!userId) {
            toast.error("ë¡œê·¸ì¸ì´ í•„ìš”í•œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.")
            return
        }

        if (!isValid) return

            setIsSubmitting(true)
            try {
                await createReview({
                    user_id: userId,
                    event_id: eventId,
                    rating,
                    keywords: selectedKeywords,
                    one_liner: oneLiner,
                    detail_content: detailContent || null,
                    is_public: true,
                })

                toast.success("í›„ê¸°ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‰")

                // í¼ ì´ˆê¸°í™”
                setRating(0)
                setSelectedKeywords([])
                setOneLiner("")
                setDetailContent("")
                setIsOptionalOpen(false)
                handleOpenChange(false) // ë‹«ê¸°
            } catch (error: any) {
                console.error(error)
                toast.error(error.message || "í›„ê¸° ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.")
            } finally {
                setIsSubmitting(false)
            }
    }

    const renderStars = () => {
        return (
            <div className="flex gap-1.5">
                {[1, 2, 3, 4, 5].map((index) => {
                    const isFilled = rating >= index
                    const isHalfFilled = rating === index - 0.5

                    return (
                        <div
                            key={index}
                            className="relative cursor-pointer transition-transform hover:scale-110"
                            onMouseLeave={() => setHoveredRating(0)}
                        >
                            {/* ì™¼ìª½ ì ˆë°˜ (0.5ì ) */}
                            <div
                                className="absolute inset-0 w-1/2 z-10"
                                onMouseEnter={() => setHoveredRating(index - 0.5)}
                                onClick={() => handleStarClick(index - 1, true)}
                            />
                            {/* ì˜¤ë¥¸ìª½ ì ˆë°˜ (1ì ) */}
                            <div
                                className="absolute inset-0 left-1/2 w-1/2 z-10"
                                onMouseEnter={() => setHoveredRating(index)}
                                onClick={() => handleStarClick(index - 1, false)}
                            />

                            <Star
                                className={cn(
                                    "h-9 w-9 sm:h-10 sm:w-10 transition-colors duration-200",
                                    (hoveredRating >= index || isFilled)
                                        ? "fill-yellow-400 text-yellow-400 drop-shadow-sm"
                                        : (hoveredRating === index - 0.5 || isHalfFilled)
                                            ? "fill-yellow-400/50 text-yellow-400"
                                            : "fill-slate-100 text-slate-200"
                                )}
                                style={{
                                    clipPath:
                                        (hoveredRating === index - 0.5 || isHalfFilled) && !(hoveredRating >= index || isFilled)
                                            ? "polygon(0 0, 50% 0, 50% 100%, 0 100%)"
                                            : undefined,
                                }}
                            />
                            {/* ë°°ê²½ ë³„ (ë°˜ë§Œ ì±„ì›Œì¡Œì„ ë•Œ ë’¤ì— ê¹”ë¦¬ëŠ” íšŒìƒ‰ ë³„) */}
                            {(hoveredRating === index - 0.5 || isHalfFilled) && !(hoveredRating >= index || isFilled) && (
                                <Star
                                    className="absolute inset-0 h-9 w-9 sm:h-10 sm:w-10 fill-slate-100 text-slate-200 -z-10"
                                />
                            )}
                        </div>
                    )
                })}
            </div>
        )
    }

    return (
        <Dialog open={isOpen} onOpenChange={handleOpenChange}>
            <DialogContent className="max-w-xl max-h-[90vh] overflow-y-auto p-0 flex flex-col gap-0 select-none">
                <DialogHeader className="p-6 pb-2">
                    <DialogTitle className="text-2xl font-bold text-slate-900 tracking-tight">
                        âœ¨ í›„ê¸° ë‚¨ê¸°ê¸°
                    </DialogTitle>
                    <DialogDescription className="text-base text-slate-500">
                        ì´ ëª¨ì„, ì–´ë– ì…¨ë‚˜ìš”? ì†”ì§í•œ ì´ì•¼ê¸°ë¥¼ ë“¤ë ¤ì£¼ì„¸ìš”.
                    </DialogDescription>
                </DialogHeader>

                <div className="flex-1 overflow-y-auto px-6 py-2 space-y-8">
                    {/* 1ë‹¨ê³„: ë³„ì  ì„ íƒ */}
                    <div className="space-y-3 bg-slate-50/50 p-4 rounded-xl border border-slate-100">
                        <div className="flex items-center justify-between">
                            <label className="text-sm font-bold text-slate-900">
                                ë§Œì¡±ë„
                            </label>
                            <span className="text-sm font-bold text-yellow-500 bg-yellow-50 px-2 py-0.5 rounded-md border border-yellow-100">
                                {rating > 0 ? `${rating.toFixed(1)}ì ` : "ì„ íƒ ì „"}
                            </span>
                        </div>
                        <div className="flex justify-center py-2">
                            {renderStars()}
                        </div>
                        <p className="text-xs text-center text-slate-400">
                            ë°˜ ê°œ ë‹¨ìœ„ë¡œ í‰ê°€í•  ìˆ˜ ìˆì–´ìš”
                        </p>
                    </div>

                    {/* 2ë‹¨ê³„: í‚¤ì›Œë“œ ì„ íƒ */}
                    <div className="space-y-3">
                        <label className="text-sm font-bold text-slate-900 flex items-center gap-2">
                            ì¢‹ì•˜ë˜ ì  <span className="text-xs font-normal text-slate-400 bg-slate-100 px-1.5 py-0.5 rounded">ì¤‘ë³µ ê°€ëŠ¥</span>
                        </label>
                        <div className="flex flex-wrap gap-2">
                            {REVIEW_KEYWORDS.map((keyword) => {
                                const isSelected = selectedKeywords.includes(keyword)
                                return (
                                    <div
                                        key={keyword}
                                        onClick={() => toggleKeyword(keyword)}
                                        className={cn(
                                            "cursor-pointer text-sm px-3 py-2 rounded-lg border transition-all duration-200 flex items-center gap-2 select-none active:scale-95",
                                            isSelected
                                                ? "bg-slate-900 text-white border-slate-900 shadow-md ring-2 ring-slate-200 ring-offset-1 font-medium"
                                                : "bg-white text-slate-600 border-slate-200 hover:border-slate-300 hover:bg-slate-50"
                                        )}
                                    >
                                        <span>{keyword}</span>
                                        {isSelected && <span className="text-xs opacity-80">âœ“</span>}
                                    </div>
                                )
                            })}
                        </div>
                    </div>

                    {/* 3ë‹¨ê³„: í•œ ì¤„ í‰ */}
                    <div className="space-y-3">
                        <div className="flex items-center justify-between">
                            <label className="text-sm font-bold text-slate-900">
                                í•œ ì¤„ í‰ <span className="text-red-500">*</span>
                            </label>
                            <span
                                className={cn(
                                    "text-xs font-medium px-2 py-0.5 rounded-full transition-colors",
                                    oneLiner.length >= 20 && oneLiner.length <= 100
                                        ? "bg-green-100 text-green-700"
                                        : oneLiner.length > 100
                                            ? "bg-red-100 text-red-700"
                                            : "bg-slate-100 text-slate-500"
                                )}
                            >
                                {oneLiner.length} / 100
                            </span>
                        </div>
                        <Input
                            placeholder="ìµœì†Œ 20ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”"
                            value={oneLiner}
                            onChange={(e) => setOneLiner(e.target.value)}
                            maxLength={100}
                            className="h-12 text-base bg-white focus-visible:ring-slate-900 transition-shadow"
                        />
                        {oneLiner.length > 0 && oneLiner.length < 20 && (
                            <p className="text-xs text-red-500 flex items-center gap-1 animate-pulse">
                                ğŸš¨ ì¡°ê¸ˆë§Œ ë” ì‘ì„±í•´ì£¼ì„¸ìš”! ({20 - oneLiner.length}ì ë¶€ì¡±)
                            </p>
                        )}
                    </div>

                    {/* 4ë‹¨ê³„: ì„ íƒ ì‚¬í•­ (ì ‘ê¸°) */}
                    <div className="border-t border-slate-100 pt-2">
                        <Collapsible open={isOptionalOpen} onOpenChange={setIsOptionalOpen}>
                            <CollapsibleTrigger asChild>
                                <Button variant="ghost" className="w-full flex items-center justify-between p-0 h-10 hover:bg-transparent hover:text-slate-900 text-slate-500">
                                    <span className="text-sm font-medium flex items-center gap-2">
                                        <span className="text-lg">âœï¸</span> ë” ìì„¸íˆ ì“°ê³  ì‹¶ë‹¤ë©´ (ì„ íƒ)
                                    </span>
                                    <span className="text-xs bg-slate-100 px-2 py-1 rounded-full">
                                        {isOptionalOpen ? "ì ‘ê¸° â–²" : "í¼ì¹˜ê¸° â–¼"}
                                    </span>
                                </Button>
                            </CollapsibleTrigger>
                            <CollapsibleContent className="space-y-4 pt-4">
                                <Textarea
                                    placeholder="ììœ ë¡­ê²Œ í›„ê¸°ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš”."
                                    value={detailContent}
                                    onChange={(e) => setDetailContent(e.target.value)}
                                    rows={5}
                                    className="resize-none bg-slate-50 border-slate-200 focus:bg-white transition-colors"
                                />
                                <div className="border-2 border-dashed border-slate-200 rounded-xl p-6 text-center">
                                    <div className="text-2xl mb-2">ğŸ“¸</div>
                                    <p className="text-sm font-medium text-slate-900">ì‚¬ì§„ ì¶”ê°€</p>
                                    <p className="text-xs text-slate-400 mt-1">ì¤€ë¹„ ì¤‘ì¸ ê¸°ëŠ¥ì…ë‹ˆë‹¤</p>
                                </div>
                            </CollapsibleContent>
                        </Collapsible>
                    </div>
                </div>

                {/* í•˜ë‹¨ ë²„íŠ¼ */}
                <div className="p-6 border-t border-slate-100 bg-white">
                    <div className="flex gap-3">
                        <Button
                            variant="outline"
                            className="flex-1 h-12 text-base font-medium border-slate-200 hover:bg-slate-50 hover:text-slate-900"
                            onClick={() => handleOpenChange(false)}
                        >
                            ë‹«ê¸°
                        </Button>
                        <Button
                            className={cn(
                                "flex-[2] h-12 text-base font-bold shadow-md transition-all",
                                isValid
                                    ? "bg-slate-900 hover:bg-slate-800 text-white hover:shadow-lg hover:-translate-y-0.5"
                                    : "bg-slate-100 text-slate-400 shadow-none cursor-not-allowed"
                            )}
                            onClick={handleSubmit}
                            disabled={!isValid || isSubmitting}
                        >
                            {isSubmitting ? (
                                <span className="flex items-center gap-2">
                                    <span className="animate-spin text-xl">â—Œ</span> ë“±ë¡ ì¤‘...
                                </span>
                            ) : (
                                "âœ¨ í›„ê¸° ë“±ë¡ ì™„ë£Œ"
                            )}
                        </Button>
                    </div>
                </div>
            </DialogContent>
        </Dialog>
    )
}

interface ReviewWriteButtonProps {
    userId: string
    eventId: string
}

export function ReviewWriteButton({ userId, eventId }: ReviewWriteButtonProps) {
    const [isModalOpen, setIsModalOpen] = useState(false)

    const handleClick = () => {
        if (!userId) {
            toast.error("ë¡œê·¸ì¸ì´ í•„ìš”í•œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.", {
                description: "í›„ê¸°ë¥¼ ì‘ì„±í•˜ì‹œë ¤ë©´ ë¨¼ì € ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.",
                action: {
                    label: "ë¡œê·¸ì¸",
                    onClick: () => window.location.href = `/auth/login?next=${encodeURIComponent(window.location.pathname)}`
                }
            })
            return
        }
        setIsModalOpen(true)
    }

    return (
        <>
            <Button
                size="lg"
                className="bg-slate-900 text-white hover:bg-slate-800 font-medium px-8 shadow-sm transition-all hover:shadow-md"
                onClick={handleClick}
            >
                âœï¸ ìƒˆ í›„ê¸° ì‘ì„±
            </Button>

            <ReviewModal
                userId={userId}
                eventId={eventId}
                open={isModalOpen}
                onOpenChange={setIsModalOpen}
            />
        </>
    )
}
</file>

<file path="components/role-manager.tsx">
"use client";

import { useState } from "react";
import { Button } from "@/components/ui/button";
import { createClient } from "@/lib/supabase/client";
import { Shield, ShieldCheck, Loader2 } from 'lucide-react';
import { useRouter } from 'next/navigation';

export function RoleManager({ user }: { user: any }) {
  const [isLoading, setIsLoading] = useState(false);
  const router = useRouter();
  const supabase = createClient();

  const handleToggleAdmin = async () => {
    setIsLoading(true);
    try {
      const newRole = user.role === 'admin' ? 'member' : 'admin';
      const { error } = await supabase
        .from("profiles")
        .update({ role: newRole })
        .eq("id", user.id);

      if (!error) {
        router.refresh();
      }
    } catch (error) {
      console.error("Failed to update role:", error);
    } finally {
      setIsLoading(false);
    }
  };

  const isAdmin = user.role === 'admin';

  return (
    <div className="flex items-center justify-between rounded-lg border border-slate-200 p-4">
      <div className="flex items-center gap-4">
        <div className="flex h-12 w-12 items-center justify-center rounded-full bg-slate-200 text-lg font-medium text-slate-700">
          {user.full_name?.[0] || "U"}
        </div>
        <div>
          <div className="flex items-center gap-2">
            <p className="font-medium text-slate-900">
              {user.full_name || "ìµëª…"}
            </p>
            {isAdmin && (
              <span className="flex items-center gap-1 rounded-full bg-blue-100 px-2 py-0.5 text-xs font-medium text-blue-700">
                <ShieldCheck className="h-3 w-3" />
                ê´€ë¦¬ì
              </span>
            )}
          </div>
          <p className="text-sm text-slate-600">{user.email}</p>
        </div>
      </div>
      <Button
        variant={isAdmin ? "outline" : "default"}
        size="sm"
        onClick={handleToggleAdmin}
        disabled={isLoading}
      >
        {isLoading ? (
          <Loader2 className="h-4 w-4 animate-spin" />
        ) : isAdmin ? (
          <>
            <Shield className="mr-2 h-4 w-4" />
            ê´€ë¦¬ì í•´ì œ
          </>
        ) : (
          <>
            <ShieldCheck className="mr-2 h-4 w-4" />
            ê´€ë¦¬ì ì§€ì •
          </>
        )}
      </Button>
    </div>
  );
}
</file>

<file path="components/scrollbar-fix.tsx">
"use client"

import { useEffect } from "react"

/**
 * í˜ì´ì§€ ë¡œë“œ ì‹œ ìŠ¤í¬ë¡¤ë°”ë¡œ ì¸í•œ ë ˆì´ì•„ì›ƒ ì‹œí”„íŠ¸ë¥¼ ë°©ì§€í•˜ëŠ” ì»´í¬ë„ŒíŠ¸
 * 
 * ì¸ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ê°€ ì´ë¯¸ ì ìš©í–ˆì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ, í™•ì¸ í›„ í•„ìš”ì‹œ ë³´ì™„í•©ë‹ˆë‹¤.
 * ë¦¬ì‚¬ì´ì¦ˆ ì‹œì—ë„ ìŠ¤í¬ë¡¤ë°” ë„ˆë¹„ë¥¼ ì¬ê³„ì‚°í•©ë‹ˆë‹¤.
 */
export function ScrollbarFix() {
  useEffect(() => {
    const fixScrollbar = () => {
      try {
        // ìŠ¤í¬ë¡¤ë°” ë„ˆë¹„ ê³„ì‚°
        const scrollbarWidth = window.innerWidth - document.documentElement.clientWidth

        // ìŠ¤í¬ë¡¤ë°”ê°€ ì—†ëŠ” ê²½ìš° (ëª¨ë°”ì¼ ë“±) ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•ŠìŒ
        if (scrollbarWidth <= 0) return

        const body = document.body
        if (!body) return

        // ì¸ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ê°€ ì´ë¯¸ ì ìš©í–ˆëŠ”ì§€ í™•ì¸
        const alreadyApplied = body.style.getPropertyValue('--scrollbar-fix-applied')
        
        if (!alreadyApplied) {
          // ì¸ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ê°€ ì ìš©í•˜ì§€ ì•Šì€ ê²½ìš°ì—ë§Œ ì ìš©
          const currentPaddingRight = window.getComputedStyle(body).paddingRight
          const currentPaddingRightValue = parseInt(currentPaddingRight, 10) || 0

          // ì›ë³¸ padding-right ê°’ ì €ì¥
          body.style.setProperty('--body-padding-right-original', currentPaddingRight || '0px', 'important')
          
          // ìŠ¤í¬ë¡¤ë°” ë„ˆë¹„ë§Œí¼ padding-right ì¶”ê°€
          const newPaddingRight = currentPaddingRightValue + scrollbarWidth
          body.style.setProperty('padding-right', `${newPaddingRight}px`, 'important')
          body.style.setProperty('--scrollbar-fix-applied', 'true')
        } else {
          // ì´ë¯¸ ì ìš©ëœ ê²½ìš°, ê°’ì´ ì˜¬ë°”ë¥¸ì§€ í™•ì¸í•˜ê³  í•„ìš”ì‹œ ë³´ì •
          const currentPaddingRight = window.getComputedStyle(body).paddingRight
          const currentPaddingRightValue = parseInt(currentPaddingRight, 10) || 0
          const originalPadding = body.style.getPropertyValue('--body-padding-right-original')
          const originalPaddingValue = parseInt(originalPadding || '0', 10) || 0
          
          // ì˜ˆìƒë˜ëŠ” padding ê°’
          const expectedPadding = originalPaddingValue + scrollbarWidth
          
          // ì°¨ì´ê°€ ìˆìœ¼ë©´ ë³´ì • (ë°˜ì˜¬ë¦¼ ì˜¤ì°¨ í—ˆìš©: 2px)
          if (Math.abs(currentPaddingRightValue - expectedPadding) > 2) {
            body.style.setProperty('padding-right', `${expectedPadding}px`, 'important')
          }
        }
      } catch (error) {
        // ì—ëŸ¬ ë°œìƒ ì‹œ ë¬´ì‹œ
        console.warn('ScrollbarFix error:', error)
      }
    }

    // ì¦‰ì‹œ ì‹¤í–‰
    fixScrollbar()

    // ë¦¬ì‚¬ì´ì¦ˆ ì‹œì—ë„ ë‹¤ì‹œ ê³„ì‚° (ë””ë°”ìš´ì‹±)
    let resizeTimer: ReturnType<typeof setTimeout>
    const handleResize = () => {
      clearTimeout(resizeTimer)
      resizeTimer = setTimeout(fixScrollbar, 100)
    }

    window.addEventListener('resize', handleResize, { passive: true })

    return () => {
      window.removeEventListener('resize', handleResize)
      clearTimeout(resizeTimer)
    }
  }, [])

  return null
}
</file>

<file path="components/sidebar-container.tsx">
import { getCachedUserProfile } from "@/lib/queries/cached"
import { Sidebar } from "@/components/sidebar"

export async function SidebarContainer() {
    const userProfile = await getCachedUserProfile()
    const role = userProfile?.profile?.role

    return <Sidebar userRole={role} />
}
</file>

<file path="components/sidebar-logout-item.tsx">
"use client"

import { useState } from "react"
import { LogOut } from "lucide-react"
import { createClient } from "@/lib/supabase/client"
import { DropdownMenuItem } from "@/components/ui/dropdown-menu"

export function SidebarLogoutItem() {
  const [isSigningOut, setIsSigningOut] = useState(false)

  const handleSignOut = async () => {
    if (isSigningOut) return
    
    setIsSigningOut(true)
    try {
      const supabase = createClient()
      await supabase.auth.signOut()
      localStorage.clear()
      sessionStorage.clear()
      window.location.replace('/')
    } catch (error) {
      console.error("ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨:", error)
      setIsSigningOut(false)
    }
  }

  return (
    <DropdownMenuItem
      onClick={handleSignOut}
      disabled={isSigningOut}
      className="text-red-600 focus:text-red-600 focus:bg-red-50 cursor-pointer"
    >
      <LogOut className="mr-2 h-4 w-4" />
      {isSigningOut ? "ë¡œê·¸ì•„ì›ƒ ì¤‘..." : "ë¡œê·¸ì•„ì›ƒ"}
    </DropdownMenuItem>
  )
}
</file>

<file path="components/sidebar-profile-client.tsx">
"use client"

import { useState, useEffect } from "react"
import Link from "next/link"
import { LogIn } from "lucide-react"
import { Button } from "@/components/ui/button"
import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar"
import NotificationsDropdown from "@/components/notifications-dropdown"

interface SidebarProfileClientProps {
  user: {
    id: string
    email?: string | null
  } | null
  profile: {
    id: string
    full_name?: string | null
    avatar_url?: string | null
    role?: string | null
    points?: number | null
  } | null
}

export function SidebarProfileClient({ user, profile }: SidebarProfileClientProps) {
  const [isMounted, setIsMounted] = useState(false)

  // í•˜ì´ë“œë ˆì´ì…˜ ì—ëŸ¬ ë°©ì§€: ë§ˆìš´íŠ¸ í›„ì—ë§Œ ë“œë¡­ë‹¤ìš´ ë Œë”ë§
  useEffect(() => {
    setIsMounted(true)
  }, [])

  // ë¹„ë¡œê·¸ì¸ ìƒíƒœ UI
  if (!user || !profile) {
    return null
  }

  const userRole = profile?.role || "member"
  const displayName = profile?.full_name || user.email?.split("@")[0] || "ì‚¬ìš©ì"

  // ë¡œê·¸ì¸ ìƒíƒœ UI
  // isMountedê°€ falseì¼ ë•ŒëŠ” ë“œë¡­ë‹¤ìš´ ì—†ì´ ë‹¨ìˆœ ë§í¬ë§Œ í‘œì‹œ (í•˜ì´ë“œë ˆì´ì…˜ ì—ëŸ¬ ë°©ì§€)
  if (!isMounted) {
    return (
      <div className="px-4 py-3">
        <div className="flex items-center gap-3 w-full">
          <div className="flex items-center gap-3 w-full">
            <Link
              href="/community/profile"
              className="flex items-center gap-3 flex-1 min-w-0 p-1.5 rounded-lg hover:bg-slate-100 transition-colors"
            >
              <Avatar className="h-10 w-10 flex-shrink-0 border border-slate-100">
                <AvatarImage src={profile?.avatar_url || "/placeholder.svg"} />
                <AvatarFallback className="bg-blue-100 text-blue-600 text-sm font-bold">
                  {profile?.full_name?.charAt(0) || user.email?.charAt(0)?.toUpperCase() || "U"}
                </AvatarFallback>
              </Avatar>
              <div className="flex-1 min-w-0 text-left">
                <div className="text-sm font-bold text-slate-900 truncate">
                  {displayName}
                </div>
              </div>
            </Link>
            {/* ë¹„ë¡œê·¸ì¸ ì‹œ ë³´ì—¬ì¤„ ë”ë¯¸ ë²„íŠ¼ (ë ˆì´ì•„ì›ƒ ìœ ì§€ìš©) */}
            <div className="w-10 h-10" />
          </div>
        </div>
      </div>
    )
  }

  // ë§ˆìš´íŠ¸ëœ í›„ ë“œë¡­ë‹¤ìš´ ë©”ë‰´ ë Œë”ë§
  return (
    <div className="px-4 py-3">
      <div className="flex items-center gap-2 w-full">
        {/* ì¢Œì¸¡: í”„ë¡œí•„ ë§í¬ ì˜ì—­ */}
        <Link
          href="/community/profile"
          className="flex items-center gap-3 flex-1 min-w-0 p-1.5 rounded-lg hover:bg-slate-100 transition-colors"
        >
          <Avatar className="h-10 w-10 flex-shrink-0 border border-slate-100">
            <AvatarImage src={profile?.avatar_url || "/placeholder.svg"} />
            <AvatarFallback className="bg-blue-100 text-blue-600 text-sm font-bold">
              {profile?.full_name?.charAt(0) || user.email?.charAt(0)?.toUpperCase() || "U"}
            </AvatarFallback>
          </Avatar>
          <div className="flex-1 min-w-0 text-left">
            <div className="text-sm font-bold text-slate-900 truncate">
              {displayName}
            </div>
          </div>
        </Link>

        {/* ìš°ì¸¡: ì•Œë¦¼ ì•„ì´ì½˜ */}
        <div className="flex items-center">
          <NotificationsDropdown 
            triggerClassName="h-10 w-10" 
            side="right"
            align="end"
          />
        </div>
      </div>
    </div>
  )
}
</file>

<file path="components/sidebar-profile.tsx">
import { createClient } from "@/lib/supabase/server"
import { getCurrentUserProfile } from "@/lib/queries/profiles"
import { SidebarProfileClient } from "./sidebar-profile-client"

export default async function SidebarProfile() {
  const supabase = await createClient()
  const userProfile = await getCurrentUserProfile(supabase)

  // ë°ì´í„°ë§Œ í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ë¡œ ì „ë‹¬
  return (
    <SidebarProfileClient 
      user={userProfile?.user || null} 
      profile={userProfile?.profile || null} 
    />
  )
}
</file>

<file path="components/skeletons.tsx">
import { Skeleton } from "@/components/ui/skeleton"

export function SidebarSkeleton() {
    return (
        <div className="h-full w-full flex flex-col bg-white border-r border-slate-100 shadow-sm p-4 space-y-6">
            <div className="space-y-2">
                <Skeleton className="h-8 w-3/4 rounded-xl" />
                <Skeleton className="h-8 w-full rounded-xl" />
                <Skeleton className="h-8 w-5/6 rounded-xl" />
            </div>
            <div className="space-y-2">
                <Skeleton className="h-4 w-1/2 rounded-md" />
                <Skeleton className="h-8 w-full rounded-xl" />
                <Skeleton className="h-8 w-full rounded-xl" />
            </div>
        </div>
    )
}

export function HeroSkeleton() {
    return (
        <div className="mb-6 rounded-2xl bg-slate-900 h-[140px] w-full animate-pulse" />
    )
}

export function EventsSkeleton() {
    return (
        <div className="w-full space-y-6">
            <div className="flex justify-between items-center">
                <Skeleton className="h-8 w-32" />
                <Skeleton className="h-8 w-24 rounded-full" />
            </div>
            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 2xl:grid-cols-3 gap-5 lg:gap-6">
                {[1, 2, 3].map((i) => (
                    <div key={i} className="w-full aspect-[4/5] rounded-[20px] overflow-hidden">
                        <Skeleton className="w-full h-full" />
                    </div>
                ))}
            </div>
        </div>
    )
}

export function FeedSkeleton() {
    return (
        <div className="space-y-4">
            <div className="flex gap-2">
                <Skeleton className="h-10 w-16 rounded-full" />
                <Skeleton className="h-10 w-16 rounded-full" />
            </div>
            <div className="space-y-4">
                {[1, 2, 3].map((i) => (
                    <div key={i} className="h-48 rounded-lg border border-slate-200 bg-white p-4 space-y-3">
                        <div className="flex items-center gap-3">
                            <Skeleton className="h-10 w-10 rounded-full" />
                            <div className="space-y-1">
                                <Skeleton className="h-4 w-24" />
                                <Skeleton className="h-3 w-16" />
                            </div>
                        </div>
                        <Skeleton className="h-4 w-3/4" />
                        <Skeleton className="h-20 w-full" />
                    </div>
                ))}
            </div>
        </div>
    )
}
</file>

<file path="components/theme-provider.tsx">
'use client'

import * as React from 'react'
import {
  ThemeProvider as NextThemesProvider,
  type ThemeProviderProps,
} from 'next-themes'

export function ThemeProvider({ children, ...props }: ThemeProviderProps) {
  return <NextThemesProvider {...props}>{children}</NextThemesProvider>
}
</file>

<file path="components/ui/accordion.tsx">
'use client'

import * as React from 'react'
import * as AccordionPrimitive from '@radix-ui/react-accordion'
import { ChevronDownIcon } from 'lucide-react'

import { cn } from '@/lib/utils'

function Accordion({
  ...props
}: React.ComponentProps<typeof AccordionPrimitive.Root>) {
  return <AccordionPrimitive.Root data-slot="accordion" {...props} />
}

function AccordionItem({
  className,
  ...props
}: React.ComponentProps<typeof AccordionPrimitive.Item>) {
  return (
    <AccordionPrimitive.Item
      data-slot="accordion-item"
      className={cn('border-b last:border-b-0', className)}
      {...props}
    />
  )
}

function AccordionTrigger({
  className,
  children,
  ...props
}: React.ComponentProps<typeof AccordionPrimitive.Trigger>) {
  return (
    <AccordionPrimitive.Header className="flex">
      <AccordionPrimitive.Trigger
        data-slot="accordion-trigger"
        className={cn(
          'focus-visible:border-ring focus-visible:ring-ring/50 flex flex-1 items-start justify-between gap-4 rounded-md py-4 text-left text-sm font-medium transition-all outline-none hover:underline focus-visible:ring-[3px] disabled:pointer-events-none disabled:opacity-50 [&[data-state=open]>svg]:rotate-180',
          className,
        )}
        {...props}
      >
        {children}
        <ChevronDownIcon className="text-muted-foreground pointer-events-none size-4 shrink-0 translate-y-0.5 transition-transform duration-200" />
      </AccordionPrimitive.Trigger>
    </AccordionPrimitive.Header>
  )
}

function AccordionContent({
  className,
  children,
  ...props
}: React.ComponentProps<typeof AccordionPrimitive.Content>) {
  return (
    <AccordionPrimitive.Content
      data-slot="accordion-content"
      className="data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down overflow-hidden text-sm"
      {...props}
    >
      <div className={cn('pt-0 pb-4', className)}>{children}</div>
    </AccordionPrimitive.Content>
  )
}

export { Accordion, AccordionItem, AccordionTrigger, AccordionContent }
</file>

<file path="components/ui/alert-dialog.tsx">
"use client"

import * as React from "react"
import * as AlertDialogPrimitive from "@radix-ui/react-alert-dialog"

import { cn } from "@/lib/utils"
import { buttonVariants } from "@/components/ui/button"
import { lockBodyScroll, unlockBodyScroll } from "@/lib/utils/scroll-lock"

function AlertDialog({
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Root>) {
  return <AlertDialogPrimitive.Root data-slot="alert-dialog" {...props} />
}

function AlertDialogTrigger({
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Trigger>) {
  return (
    <AlertDialogPrimitive.Trigger data-slot="alert-dialog-trigger" {...props} />
  )
}

function AlertDialogPortal({
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Portal>) {
  return (
    <AlertDialogPrimitive.Portal data-slot="alert-dialog-portal" {...props} />
  )
}

function AlertDialogOverlay({
  className,
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Overlay>) {
  return (
    <AlertDialogPrimitive.Overlay
      data-slot="alert-dialog-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-[9999] bg-black/50",
        className
      )}
      {...props}
    />
  )
}

function AlertDialogContent({
  className,
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Content>) {
  // ëª¨ë‹¬ì´ ì—´ë¦´ ë•Œì™€ ë‹«í ë•Œ body scroll lock ê´€ë¦¬
  // Radix UIëŠ” ëª¨ë‹¬ì´ ì—´ë¦´ ë•Œë§Œ ì»´í¬ë„ŒíŠ¸ë¥¼ ë§ˆìš´íŠ¸í•˜ë¯€ë¡œ, ë§ˆìš´íŠ¸ ì‹œ lock, ì–¸ë§ˆìš´íŠ¸ ì‹œ unlock
  React.useEffect(() => {
    lockBodyScroll()
    return () => {
      unlockBodyScroll()
    }
  }, [])

  return (
    <AlertDialogPortal>
      <AlertDialogOverlay />
      <AlertDialogPrimitive.Content
        data-slot="alert-dialog-content"
        className={cn(
          "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-[9999] grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",
          className
        )}
        {...props}
      />
    </AlertDialogPortal>
  )
}

function AlertDialogHeader({
  className,
  ...props
}: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="alert-dialog-header"
      className={cn("flex flex-col gap-2 text-center sm:text-left", className)}
      {...props}
    />
  )
}

function AlertDialogFooter({
  className,
  ...props
}: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="alert-dialog-footer"
      className={cn(
        "flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",
        className
      )}
      style={props.style || {}}
      {...props}
    />
  )
}

function AlertDialogTitle({
  className,
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Title>) {
  return (
    <AlertDialogPrimitive.Title
      data-slot="alert-dialog-title"
      className={cn("text-lg font-semibold", className)}
      {...props}
    />
  )
}

function AlertDialogDescription({
  className,
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Description>) {
  return (
    <AlertDialogPrimitive.Description
      data-slot="alert-dialog-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  )
}

function AlertDialogAction({
  className,
  variant,
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Action> & {
  variant?: "default" | "destructive" | "outline" | "secondary" | "ghost" | "link"
}) {
  return (
    <AlertDialogPrimitive.Action
      className={cn(buttonVariants({ variant }), className)}
      {...props}
    />
  )
}

function AlertDialogCancel({
  className,
  variant = "outline",
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Cancel> & {
  variant?: "default" | "destructive" | "outline" | "secondary" | "ghost" | "link"
}) {
  return (
    <AlertDialogPrimitive.Cancel
      className={cn(buttonVariants({ variant }), className)}
      {...props}
    />
  )
}

export {
  AlertDialog,
  AlertDialogPortal,
  AlertDialogOverlay,
  AlertDialogTrigger,
  AlertDialogContent,
  AlertDialogHeader,
  AlertDialogFooter,
  AlertDialogTitle,
  AlertDialogDescription,
  AlertDialogAction,
  AlertDialogCancel,
}
</file>

<file path="components/ui/alert.tsx">
import * as React from 'react'
import { cva, type VariantProps } from 'class-variance-authority'

import { cn } from '@/lib/utils'

const alertVariants = cva(
  'relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current',
  {
    variants: {
      variant: {
        default: 'bg-card text-card-foreground',
        destructive:
          'text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90',
      },
    },
    defaultVariants: {
      variant: 'default',
    },
  },
)

function Alert({
  className,
  variant,
  ...props
}: React.ComponentProps<'div'> & VariantProps<typeof alertVariants>) {
  return (
    <div
      data-slot="alert"
      role="alert"
      className={cn(alertVariants({ variant }), className)}
      {...props}
    />
  )
}

function AlertTitle({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="alert-title"
      className={cn(
        'col-start-2 line-clamp-1 min-h-4 font-medium tracking-tight',
        className,
      )}
      {...props}
    />
  )
}

function AlertDescription({
  className,
  ...props
}: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="alert-description"
      className={cn(
        'text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed',
        className,
      )}
      {...props}
    />
  )
}

export { Alert, AlertTitle, AlertDescription }
</file>

<file path="components/ui/aspect-ratio.tsx">
'use client'

import * as AspectRatioPrimitive from '@radix-ui/react-aspect-ratio'

function AspectRatio({
  ...props
}: React.ComponentProps<typeof AspectRatioPrimitive.Root>) {
  return <AspectRatioPrimitive.Root data-slot="aspect-ratio" {...props} />
}

export { AspectRatio }
</file>

<file path="components/ui/avatar.tsx">
'use client'

import * as React from 'react'
import * as AvatarPrimitive from '@radix-ui/react-avatar'

import { cn } from '@/lib/utils'

function Avatar({
  className,
  ...props
}: React.ComponentProps<typeof AvatarPrimitive.Root>) {
  return (
    <AvatarPrimitive.Root
      data-slot="avatar"
      className={cn(
        'relative flex size-8 shrink-0 overflow-hidden rounded-full',
        className,
      )}
      {...props}
    />
  )
}

function AvatarImage({
  className,
  ...props
}: React.ComponentProps<typeof AvatarPrimitive.Image>) {
  return (
    <AvatarPrimitive.Image
      data-slot="avatar-image"
      className={cn('aspect-square size-full', className)}
      {...props}
    />
  )
}

function AvatarFallback({
  className,
  ...props
}: React.ComponentProps<typeof AvatarPrimitive.Fallback>) {
  return (
    <AvatarPrimitive.Fallback
      data-slot="avatar-fallback"
      className={cn(
        'bg-muted flex size-full items-center justify-center rounded-full',
        className,
      )}
      {...props}
    />
  )
}

export { Avatar, AvatarImage, AvatarFallback }
</file>

<file path="components/ui/badge.tsx">
import * as React from 'react'
import { Slot } from '@radix-ui/react-slot'
import { cva, type VariantProps } from 'class-variance-authority'

import { cn } from '@/lib/utils'

const badgeVariants = cva(
  'inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden',
  {
    variants: {
      variant: {
        default:
          'border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90',
        secondary:
          'border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90',
        destructive:
          'border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60',
        outline:
          'text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground',
      },
    },
    defaultVariants: {
      variant: 'default',
    },
  },
)

function Badge({
  className,
  variant,
  asChild = false,
  ...props
}: React.ComponentProps<'span'> &
  VariantProps<typeof badgeVariants> & { asChild?: boolean }) {
  const Comp = asChild ? Slot : 'span'

  return (
    <Comp
      data-slot="badge"
      className={cn(badgeVariants({ variant }), className)}
      {...props}
    />
  )
}

export { Badge, badgeVariants }
</file>

<file path="components/ui/breadcrumb.tsx">
import * as React from 'react'
import { Slot } from '@radix-ui/react-slot'
import { ChevronRight, MoreHorizontal } from 'lucide-react'

import { cn } from '@/lib/utils'

function Breadcrumb({ ...props }: React.ComponentProps<'nav'>) {
  return <nav aria-label="breadcrumb" data-slot="breadcrumb" {...props} />
}

function BreadcrumbList({ className, ...props }: React.ComponentProps<'ol'>) {
  return (
    <ol
      data-slot="breadcrumb-list"
      className={cn(
        'text-muted-foreground flex flex-wrap items-center gap-1.5 text-sm break-words sm:gap-2.5',
        className,
      )}
      {...props}
    />
  )
}

function BreadcrumbItem({ className, ...props }: React.ComponentProps<'li'>) {
  return (
    <li
      data-slot="breadcrumb-item"
      className={cn('inline-flex items-center gap-1.5', className)}
      {...props}
    />
  )
}

function BreadcrumbLink({
  asChild,
  className,
  ...props
}: React.ComponentProps<'a'> & {
  asChild?: boolean
}) {
  const Comp = asChild ? Slot : 'a'

  return (
    <Comp
      data-slot="breadcrumb-link"
      className={cn('hover:text-foreground transition-colors', className)}
      {...props}
    />
  )
}

function BreadcrumbPage({ className, ...props }: React.ComponentProps<'span'>) {
  return (
    <span
      data-slot="breadcrumb-page"
      role="link"
      aria-disabled="true"
      aria-current="page"
      className={cn('text-foreground font-normal', className)}
      {...props}
    />
  )
}

function BreadcrumbSeparator({
  children,
  className,
  ...props
}: React.ComponentProps<'li'>) {
  return (
    <li
      data-slot="breadcrumb-separator"
      role="presentation"
      aria-hidden="true"
      className={cn('[&>svg]:size-3.5', className)}
      {...props}
    >
      {children ?? <ChevronRight />}
    </li>
  )
}

function BreadcrumbEllipsis({
  className,
  ...props
}: React.ComponentProps<'span'>) {
  return (
    <span
      data-slot="breadcrumb-ellipsis"
      role="presentation"
      aria-hidden="true"
      className={cn('flex size-9 items-center justify-center', className)}
      {...props}
    >
      <MoreHorizontal className="size-4" />
      <span className="sr-only">More</span>
    </span>
  )
}

export {
  Breadcrumb,
  BreadcrumbList,
  BreadcrumbItem,
  BreadcrumbLink,
  BreadcrumbPage,
  BreadcrumbSeparator,
  BreadcrumbEllipsis,
}
</file>

<file path="components/ui/button-group.tsx">
import { Slot } from '@radix-ui/react-slot'
import { cva, type VariantProps } from 'class-variance-authority'

import { cn } from '@/lib/utils'
import { Separator } from '@/components/ui/separator'

const buttonGroupVariants = cva(
  "flex w-fit items-stretch [&>*]:focus-visible:z-10 [&>*]:focus-visible:relative [&>[data-slot=select-trigger]:not([class*='w-'])]:w-fit [&>input]:flex-1 has-[select[aria-hidden=true]:last-child]:[&>[data-slot=select-trigger]:last-of-type]:rounded-r-md has-[>[data-slot=button-group]]:gap-2",
  {
    variants: {
      orientation: {
        horizontal:
          '[&>*:not(:first-child)]:rounded-l-none [&>*:not(:first-child)]:border-l-0 [&>*:not(:last-child)]:rounded-r-none',
        vertical:
          'flex-col [&>*:not(:first-child)]:rounded-t-none [&>*:not(:first-child)]:border-t-0 [&>*:not(:last-child)]:rounded-b-none',
      },
    },
    defaultVariants: {
      orientation: 'horizontal',
    },
  },
)

function ButtonGroup({
  className,
  orientation,
  ...props
}: React.ComponentProps<'div'> & VariantProps<typeof buttonGroupVariants>) {
  return (
    <div
      role="group"
      data-slot="button-group"
      data-orientation={orientation}
      className={cn(buttonGroupVariants({ orientation }), className)}
      {...props}
    />
  )
}

function ButtonGroupText({
  className,
  asChild = false,
  ...props
}: React.ComponentProps<'div'> & {
  asChild?: boolean
}) {
  const Comp = asChild ? Slot : 'div'

  return (
    <Comp
      className={cn(
        "bg-muted flex items-center gap-2 rounded-md border px-4 text-sm font-medium shadow-xs [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    />
  )
}

function ButtonGroupSeparator({
  className,
  orientation = 'vertical',
  ...props
}: React.ComponentProps<typeof Separator>) {
  return (
    <Separator
      data-slot="button-group-separator"
      orientation={orientation}
      className={cn(
        'bg-input relative !m-0 self-stretch data-[orientation=vertical]:h-auto',
        className,
      )}
      {...props}
    />
  )
}

export {
  ButtonGroup,
  ButtonGroupSeparator,
  ButtonGroupText,
  buttonGroupVariants,
}
</file>

<file path="components/ui/button.tsx">
import * as React from 'react'
import { Slot } from '@radix-ui/react-slot'
import { cva, type VariantProps } from 'class-variance-authority'

import { cn } from '@/lib/utils'

const buttonVariants = cva(
  "inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-lg text-sm font-medium transition-all duration-150 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive active:scale-[0.98]",
  {
    variants: {
      variant: {
        default: 'bg-slate-900 text-white shadow-sm shadow-slate-900/20 hover:bg-slate-800 hover:shadow-md hover:shadow-slate-900/25',
        destructive:
          'bg-destructive text-white shadow-sm hover:bg-destructive/90 hover:shadow-md focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60',
        outline:
          'border border-slate-200 bg-white shadow-sm hover:bg-slate-50 hover:border-slate-300 hover:text-slate-900 dark:bg-input/30 dark:border-input dark:hover:bg-input/50',
        secondary:
          'bg-slate-100 text-slate-900 hover:bg-slate-200 shadow-sm',
        ghost:
          'hover:bg-slate-100 hover:text-slate-900 active:bg-slate-200 dark:hover:bg-accent/50',
        link: 'text-slate-900 underline-offset-4 hover:underline hover:text-slate-700',
      },
      size: {
        default: 'h-9 px-4 py-2 has-[>svg]:px-3',
        sm: 'h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5',
        lg: 'h-10 rounded-md px-6 has-[>svg]:px-4',
        icon: 'size-9',
        'icon-sm': 'size-8',
        'icon-lg': 'size-10',
      },
    },
    defaultVariants: {
      variant: 'default',
      size: 'default',
    },
  },
)

function Button({
  className,
  variant,
  size,
  asChild = false,
  ...props
}: React.ComponentProps<'button'> &
  VariantProps<typeof buttonVariants> & {
    asChild?: boolean
  }) {
  const Comp = asChild ? Slot : 'button'

  return (
    <Comp
      data-slot="button"
      className={cn(buttonVariants({ variant, size, className }))}
      {...props}
    />
  )
}

export { Button, buttonVariants }
</file>

<file path="components/ui/calendar.tsx">
'use client'

import * as React from 'react'
import {
  ChevronDownIcon,
  ChevronLeftIcon,
  ChevronRightIcon,
} from 'lucide-react'
import { DayButton, DayPicker, getDefaultClassNames } from 'react-day-picker'

import { cn } from '@/lib/utils'
import { Button, buttonVariants } from '@/components/ui/button'

function Calendar({
  className,
  classNames,
  showOutsideDays = true,
  captionLayout = 'label',
  buttonVariant = 'ghost',
  formatters,
  components,
  ...props
}: React.ComponentProps<typeof DayPicker> & {
  buttonVariant?: React.ComponentProps<typeof Button>['variant']
}) {
  const defaultClassNames = getDefaultClassNames()

  return (
    <DayPicker
      showOutsideDays={showOutsideDays}
      className={cn(
        'bg-background group/calendar p-3 [--cell-size:--spacing(8)] [[data-slot=card-content]_&]:bg-transparent [[data-slot=popover-content]_&]:bg-transparent',
        String.raw`rtl:**:[.rdp-button\_next>svg]:rotate-180`,
        String.raw`rtl:**:[.rdp-button\_previous>svg]:rotate-180`,
        className,
      )}
      captionLayout={captionLayout}
      formatters={{
        formatMonthDropdown: (date) =>
          date.toLocaleString('default', { month: 'short' }),
        ...formatters,
      }}
      classNames={{
        root: cn('w-fit', defaultClassNames.root),
        months: cn(
          'flex gap-4 flex-col md:flex-row relative',
          defaultClassNames.months,
        ),
        month: cn('flex flex-col w-full gap-4', defaultClassNames.month),
        nav: cn(
          'flex items-center gap-1 w-full absolute top-0 inset-x-0 justify-between',
          defaultClassNames.nav,
        ),
        button_previous: cn(
          buttonVariants({ variant: buttonVariant }),
          'size-(--cell-size) aria-disabled:opacity-50 p-0 select-none',
          defaultClassNames.button_previous,
        ),
        button_next: cn(
          buttonVariants({ variant: buttonVariant }),
          'size-(--cell-size) aria-disabled:opacity-50 p-0 select-none',
          defaultClassNames.button_next,
        ),
        month_caption: cn(
          'flex items-center justify-center h-(--cell-size) w-full px-(--cell-size)',
          defaultClassNames.month_caption,
        ),
        dropdowns: cn(
          'w-full flex items-center text-sm font-medium justify-center h-(--cell-size) gap-1.5',
          defaultClassNames.dropdowns,
        ),
        dropdown_root: cn(
          'relative has-focus:border-ring border border-input shadow-xs has-focus:ring-ring/50 has-focus:ring-[3px] rounded-md',
          defaultClassNames.dropdown_root,
        ),
        dropdown: cn(
          'absolute bg-popover inset-0 opacity-0',
          defaultClassNames.dropdown,
        ),
        caption_label: cn(
          'select-none font-medium',
          captionLayout === 'label'
            ? 'text-sm'
            : 'rounded-md pl-2 pr-1 flex items-center gap-1 text-sm h-8 [&>svg]:text-muted-foreground [&>svg]:size-3.5',
          defaultClassNames.caption_label,
        ),
        table: 'w-full border-collapse',
        weekdays: cn('flex', defaultClassNames.weekdays),
        weekday: cn(
          'text-muted-foreground rounded-md flex-1 font-normal text-[0.8rem] select-none',
          defaultClassNames.weekday,
        ),
        week: cn('flex w-full mt-2', defaultClassNames.week),
        week_number_header: cn(
          'select-none w-(--cell-size)',
          defaultClassNames.week_number_header,
        ),
        week_number: cn(
          'text-[0.8rem] select-none text-muted-foreground',
          defaultClassNames.week_number,
        ),
        day: cn(
          'relative w-full h-full p-0 text-center [&:first-child[data-selected=true]_button]:rounded-l-md [&:last-child[data-selected=true]_button]:rounded-r-md group/day aspect-square select-none',
          defaultClassNames.day,
        ),
        range_start: cn(
          'rounded-l-md bg-accent',
          defaultClassNames.range_start,
        ),
        range_middle: cn('rounded-none', defaultClassNames.range_middle),
        range_end: cn('rounded-r-md bg-accent', defaultClassNames.range_end),
        today: cn(
          'bg-accent text-accent-foreground rounded-md data-[selected=true]:rounded-none',
          defaultClassNames.today,
        ),
        outside: cn(
          'text-muted-foreground aria-selected:text-muted-foreground',
          defaultClassNames.outside,
        ),
        disabled: cn(
          'text-muted-foreground opacity-50',
          defaultClassNames.disabled,
        ),
        hidden: cn('invisible', defaultClassNames.hidden),
        ...classNames,
      }}
      components={{
        Root: ({ className, rootRef, ...props }) => {
          return (
            <div
              data-slot="calendar"
              ref={rootRef}
              className={cn(className)}
              {...props}
            />
          )
        },
        Chevron: ({ className, orientation, ...props }) => {
          if (orientation === 'left') {
            return (
              <ChevronLeftIcon className={cn('size-4', className)} {...props} />
            )
          }

          if (orientation === 'right') {
            return (
              <ChevronRightIcon
                className={cn('size-4', className)}
                {...props}
              />
            )
          }

          return (
            <ChevronDownIcon className={cn('size-4', className)} {...props} />
          )
        },
        DayButton: CalendarDayButton,
        WeekNumber: ({ children, ...props }) => {
          return (
            <td {...props}>
              <div className="flex size-(--cell-size) items-center justify-center text-center">
                {children}
              </div>
            </td>
          )
        },
        ...components,
      }}
      {...props}
    />
  )
}

function CalendarDayButton({
  className,
  day,
  modifiers,
  ...props
}: React.ComponentProps<typeof DayButton>) {
  const defaultClassNames = getDefaultClassNames()

  const ref = React.useRef<HTMLButtonElement>(null)
  React.useEffect(() => {
    if (modifiers.focused) ref.current?.focus()
  }, [modifiers.focused])

  return (
    <Button
      ref={ref}
      variant="ghost"
      size="icon"
      data-day={day.date.toLocaleDateString()}
      data-selected-single={
        modifiers.selected &&
        !modifiers.range_start &&
        !modifiers.range_end &&
        !modifiers.range_middle
      }
      data-range-start={modifiers.range_start}
      data-range-end={modifiers.range_end}
      data-range-middle={modifiers.range_middle}
      className={cn(
        'data-[selected-single=true]:bg-primary data-[selected-single=true]:text-primary-foreground data-[range-middle=true]:bg-accent data-[range-middle=true]:text-accent-foreground data-[range-start=true]:bg-primary data-[range-start=true]:text-primary-foreground data-[range-end=true]:bg-primary data-[range-end=true]:text-primary-foreground group-data-[focused=true]/day:border-ring group-data-[focused=true]/day:ring-ring/50 dark:hover:text-accent-foreground flex aspect-square size-auto w-full min-w-(--cell-size) flex-col gap-1 leading-none font-normal group-data-[focused=true]/day:relative group-data-[focused=true]/day:z-10 group-data-[focused=true]/day:ring-[3px] data-[range-end=true]:rounded-md data-[range-end=true]:rounded-r-md data-[range-middle=true]:rounded-none data-[range-start=true]:rounded-md data-[range-start=true]:rounded-l-md [&>span]:text-xs [&>span]:opacity-70',
        defaultClassNames.day,
        className,
      )}
      {...props}
    />
  )
}

export { Calendar, CalendarDayButton }
</file>

<file path="components/ui/card.tsx">
import * as React from 'react'

import { cn } from '@/lib/utils'

function Card({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="card"
      className={cn(
        'bg-card text-card-foreground flex flex-col gap-6 rounded-2xl border border-slate-200/60 py-6 shadow-md shadow-slate-900/5 ring-1 ring-slate-900/[0.04] transition-shadow hover:shadow-lg hover:shadow-slate-900/10',
        className,
      )}
      {...props}
    />
  )
}

function CardHeader({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="card-header"
      className={cn(
        '@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6',
        className,
      )}
      {...props}
    />
  )
}

function CardTitle({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="card-title"
      className={cn('leading-none font-semibold', className)}
      {...props}
    />
  )
}

function CardDescription({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="card-description"
      className={cn('text-muted-foreground text-sm', className)}
      {...props}
    />
  )
}

function CardAction({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="card-action"
      className={cn(
        'col-start-2 row-span-2 row-start-1 self-start justify-self-end',
        className,
      )}
      {...props}
    />
  )
}

function CardContent({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="card-content"
      className={cn('px-6', className)}
      {...props}
    />
  )
}

function CardFooter({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="card-footer"
      className={cn('flex items-center px-6 [.border-t]:pt-6', className)}
      {...props}
    />
  )
}

export {
  Card,
  CardHeader,
  CardFooter,
  CardTitle,
  CardAction,
  CardDescription,
  CardContent,
}
</file>

<file path="components/ui/carousel.tsx">
'use client'

import * as React from 'react'
import useEmblaCarousel, {
  type UseEmblaCarouselType,
} from 'embla-carousel-react'
import { ArrowLeft, ArrowRight } from 'lucide-react'

import { cn } from '@/lib/utils'
import { Button } from '@/components/ui/button'

type CarouselApi = UseEmblaCarouselType[1]
type UseCarouselParameters = Parameters<typeof useEmblaCarousel>
type CarouselOptions = UseCarouselParameters[0]
type CarouselPlugin = UseCarouselParameters[1]

type CarouselProps = {
  opts?: CarouselOptions
  plugins?: CarouselPlugin
  orientation?: 'horizontal' | 'vertical'
  setApi?: (api: CarouselApi) => void
}

type CarouselContextProps = {
  carouselRef: ReturnType<typeof useEmblaCarousel>[0]
  api: ReturnType<typeof useEmblaCarousel>[1]
  scrollPrev: () => void
  scrollNext: () => void
  canScrollPrev: boolean
  canScrollNext: boolean
} & CarouselProps

const CarouselContext = React.createContext<CarouselContextProps | null>(null)

function useCarousel() {
  const context = React.useContext(CarouselContext)

  if (!context) {
    throw new Error('useCarousel must be used within a <Carousel />')
  }

  return context
}

function Carousel({
  orientation = 'horizontal',
  opts,
  setApi,
  plugins,
  className,
  children,
  ...props
}: React.ComponentProps<'div'> & CarouselProps) {
  const [carouselRef, api] = useEmblaCarousel(
    {
      ...opts,
      axis: orientation === 'horizontal' ? 'x' : 'y',
    },
    plugins,
  )
  const [canScrollPrev, setCanScrollPrev] = React.useState(false)
  const [canScrollNext, setCanScrollNext] = React.useState(false)

  const onSelect = React.useCallback((api: CarouselApi) => {
    if (!api) return
    setCanScrollPrev(api.canScrollPrev())
    setCanScrollNext(api.canScrollNext())
  }, [])

  const scrollPrev = React.useCallback(() => {
    api?.scrollPrev()
  }, [api])

  const scrollNext = React.useCallback(() => {
    api?.scrollNext()
  }, [api])

  const handleKeyDown = React.useCallback(
    (event: React.KeyboardEvent<HTMLDivElement>) => {
      if (event.key === 'ArrowLeft') {
        event.preventDefault()
        scrollPrev()
      } else if (event.key === 'ArrowRight') {
        event.preventDefault()
        scrollNext()
      }
    },
    [scrollPrev, scrollNext],
  )

  React.useEffect(() => {
    if (!api || !setApi) return
    setApi(api)
  }, [api, setApi])

  React.useEffect(() => {
    if (!api) return
    onSelect(api)
    api.on('reInit', onSelect)
    api.on('select', onSelect)

    return () => {
      api?.off('select', onSelect)
    }
  }, [api, onSelect])

  return (
    <CarouselContext.Provider
      value={{
        carouselRef,
        api: api,
        opts,
        orientation:
          orientation || (opts?.axis === 'y' ? 'vertical' : 'horizontal'),
        scrollPrev,
        scrollNext,
        canScrollPrev,
        canScrollNext,
      }}
    >
      <div
        onKeyDownCapture={handleKeyDown}
        className={cn('relative', className)}
        role="region"
        aria-roledescription="carousel"
        data-slot="carousel"
        {...props}
      >
        {children}
      </div>
    </CarouselContext.Provider>
  )
}

function CarouselContent({ className, ...props }: React.ComponentProps<'div'>) {
  const { carouselRef, orientation } = useCarousel()

  return (
    <div
      ref={carouselRef}
      className="overflow-hidden"
      data-slot="carousel-content"
    >
      <div
        className={cn(
          'flex',
          orientation === 'horizontal' ? '-ml-4' : '-mt-4 flex-col',
          className,
        )}
        {...props}
      />
    </div>
  )
}

function CarouselItem({ className, ...props }: React.ComponentProps<'div'>) {
  const { orientation } = useCarousel()

  return (
    <div
      role="group"
      aria-roledescription="slide"
      data-slot="carousel-item"
      className={cn(
        'min-w-0 shrink-0 grow-0 basis-full',
        orientation === 'horizontal' ? 'pl-4' : 'pt-4',
        className,
      )}
      {...props}
    />
  )
}

function CarouselPrevious({
  className,
  variant = 'outline',
  size = 'icon',
  ...props
}: React.ComponentProps<typeof Button>) {
  const { orientation, scrollPrev, canScrollPrev } = useCarousel()

  return (
    <Button
      data-slot="carousel-previous"
      variant={variant}
      size={size}
      className={cn(
        'absolute size-8 rounded-full',
        orientation === 'horizontal'
          ? 'top-1/2 -left-12 -translate-y-1/2'
          : '-top-12 left-1/2 -translate-x-1/2 rotate-90',
        className,
      )}
      disabled={!canScrollPrev}
      onClick={scrollPrev}
      {...props}
    >
      <ArrowLeft />
      <span className="sr-only">Previous slide</span>
    </Button>
  )
}

function CarouselNext({
  className,
  variant = 'outline',
  size = 'icon',
  ...props
}: React.ComponentProps<typeof Button>) {
  const { orientation, scrollNext, canScrollNext } = useCarousel()

  return (
    <Button
      data-slot="carousel-next"
      variant={variant}
      size={size}
      className={cn(
        'absolute size-8 rounded-full',
        orientation === 'horizontal'
          ? 'top-1/2 -right-12 -translate-y-1/2'
          : '-bottom-12 left-1/2 -translate-x-1/2 rotate-90',
        className,
      )}
      disabled={!canScrollNext}
      onClick={scrollNext}
      {...props}
    >
      <ArrowRight />
      <span className="sr-only">Next slide</span>
    </Button>
  )
}

export {
  type CarouselApi,
  Carousel,
  CarouselContent,
  CarouselItem,
  CarouselPrevious,
  CarouselNext,
}
</file>

<file path="components/ui/chart.tsx">
'use client'

import * as React from 'react'
import * as RechartsPrimitive from 'recharts'

import { cn } from '@/lib/utils'

// Format: { THEME_NAME: CSS_SELECTOR }
const THEMES = { light: '', dark: '.dark' } as const

export type ChartConfig = {
  [k in string]: {
    label?: React.ReactNode
    icon?: React.ComponentType
  } & (
    | { color?: string; theme?: never }
    | { color?: never; theme: Record<keyof typeof THEMES, string> }
  )
}

type ChartContextProps = {
  config: ChartConfig
}

const ChartContext = React.createContext<ChartContextProps | null>(null)

function useChart() {
  const context = React.useContext(ChartContext)

  if (!context) {
    throw new Error('useChart must be used within a <ChartContainer />')
  }

  return context
}

function ChartContainer({
  id,
  className,
  children,
  config,
  ...props
}: React.ComponentProps<'div'> & {
  config: ChartConfig
  children: React.ComponentProps<
    typeof RechartsPrimitive.ResponsiveContainer
  >['children']
}) {
  const uniqueId = React.useId()
  const chartId = `chart-${id || uniqueId.replace(/:/g, '')}`

  return (
    <ChartContext.Provider value={{ config }}>
      <div
        data-slot="chart"
        data-chart={chartId}
        className={cn(
          "[&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border flex aspect-video justify-center text-xs [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-hidden [&_.recharts-sector]:outline-hidden [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-surface]:outline-hidden",
          className,
        )}
        {...props}
      >
        <ChartStyle id={chartId} config={config} />
        <RechartsPrimitive.ResponsiveContainer>
          {children}
        </RechartsPrimitive.ResponsiveContainer>
      </div>
    </ChartContext.Provider>
  )
}

const ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {
  const colorConfig = Object.entries(config).filter(
    ([, config]) => config.theme || config.color,
  )

  if (!colorConfig.length) {
    return null
  }

  return (
    <style
      dangerouslySetInnerHTML={{
        __html: Object.entries(THEMES)
          .map(
            ([theme, prefix]) => `
${prefix} [data-chart=${id}] {
${colorConfig
  .map(([key, itemConfig]) => {
    const color =
      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||
      itemConfig.color
    return color ? `  --color-${key}: ${color};` : null
  })
  .join('\n')}
}
`,
          )
          .join('\n'),
      }}
    />
  )
}

const ChartTooltip = RechartsPrimitive.Tooltip

function ChartTooltipContent({
  active,
  payload,
  className,
  indicator = 'dot',
  hideLabel = false,
  hideIndicator = false,
  label,
  labelFormatter,
  labelClassName,
  formatter,
  color,
  nameKey,
  labelKey,
  ...props
}: React.ComponentProps<typeof RechartsPrimitive.Tooltip> &
  React.ComponentProps<'div'> & {
    hideLabel?: boolean
    hideIndicator?: boolean
    indicator?: 'line' | 'dot' | 'dashed'
    nameKey?: string
    labelKey?: string
    payload?: any[]
    label?: any
  }) {
  const { config } = useChart()

  const tooltipLabel = React.useMemo(() => {
    if (hideLabel || !payload?.length) {
      return null
    }

    const [item] = payload
    const key = `${labelKey || item?.dataKey || item?.name || 'value'}`
    const itemConfig = getPayloadConfigFromPayload(config, item, key)
    const value =
      !labelKey && typeof label === 'string'
        ? config[label as keyof typeof config]?.label || label
        : itemConfig?.label

    if (labelFormatter) {
      return (
        <div className={cn('font-medium', labelClassName)}>
          {labelFormatter(value, payload)}
        </div>
      )
    }

    if (!value) {
      return null
    }

    return <div className={cn('font-medium', labelClassName)}>{value}</div>
  }, [
    label,
    labelFormatter,
    payload,
    hideLabel,
    labelClassName,
    config,
    labelKey,
  ])

  if (!active || !payload?.length) {
    return null
  }

  const nestLabel = payload.length === 1 && indicator !== 'dot'

  return (
    <div
      className={cn(
        'border border-opacity-50 bg-background grid min-w-[8rem] items-start gap-1.5 rounded-lg px-2.5 py-1.5 text-xs shadow-xl',
        className,
      )}
    >
      {!nestLabel ? tooltipLabel : null}
      <div className="grid gap-1.5">
        {payload.map((item, index) => {
          const key = `${nameKey || item.name || item.dataKey || 'value'}`
          const itemConfig = getPayloadConfigFromPayload(config, item, key)
          const indicatorColor = color || item.payload.fill || item.color

          return (
            <div
              key={item.dataKey}
              className={cn(
                '[&>svg]:text-muted-foreground flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5',
                indicator === 'dot' && 'items-center',
              )}
            >
              {formatter && item?.value !== undefined && item.name ? (
                formatter(item.value, item.name, item, index, item.payload)
              ) : (
                <>
                  {itemConfig?.icon ? (
                    <itemConfig.icon />
                  ) : (
                    !hideIndicator && (
                      <div
                        className={cn(
                          'shrink-0 rounded-[2px] border-(--color-border) bg-(--color-bg)',
                          {
                            'h-2.5 w-2.5': indicator === 'dot',
                            'w-1': indicator === 'line',
                            'w-0 border-[1.5px] border-dashed bg-transparent':
                              indicator === 'dashed',
                            'my-0.5': nestLabel && indicator === 'dashed',
                          },
                        )}
                        style={
                          {
                            '--color-bg': indicatorColor,
                            '--color-border': indicatorColor,
                          } as React.CSSProperties
                        }
                      />
                    )
                  )}
                  <div
                    className={cn(
                      'flex flex-1 justify-between leading-none',
                      nestLabel ? 'items-end' : 'items-center',
                    )}
                  >
                    <div className="grid gap-1.5">
                      {nestLabel ? tooltipLabel : null}
                      <span className="text-muted-foreground">
                        {itemConfig?.label || item.name}
                      </span>
                    </div>
                    {item.value && (
                      <span className="text-foreground font-mono font-medium tabular-nums">
                        {item.value.toLocaleString()}
                      </span>
                    )}
                  </div>
                </>
              )}
            </div>
          )
        })}
      </div>
    </div>
  )
}

const ChartLegend = RechartsPrimitive.Legend

function ChartLegendContent({
  className,
  hideIcon = false,
  payload,
  verticalAlign = 'bottom',
  nameKey,
}: React.ComponentProps<'div'> & {
    payload?: any[]
    verticalAlign?: 'top' | 'bottom' | 'middle'
    hideIcon?: boolean
    nameKey?: string
  }) {
  const { config } = useChart()

  if (!payload?.length) {
    return null
  }

  return (
    <div
      className={cn(
        'flex items-center justify-center gap-4',
        verticalAlign === 'top' ? 'pb-3' : 'pt-3',
        className,
      )}
    >
      {payload.map((item) => {
        const key = `${nameKey || item.dataKey || 'value'}`
        const itemConfig = getPayloadConfigFromPayload(config, item, key)

        return (
          <div
            key={item.value}
            className={
              '[&>svg]:text-muted-foreground flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3'
            }
          >
            {itemConfig?.icon && !hideIcon ? (
              <itemConfig.icon />
            ) : (
              <div
                className="h-2 w-2 shrink-0 rounded-[2px]"
                style={{
                  backgroundColor: item.color,
                }}
              />
            )}
            {itemConfig?.label}
          </div>
        )
      })}
    </div>
  )
}

// Helper to extract item config from a payload.
function getPayloadConfigFromPayload(
  config: ChartConfig,
  payload: unknown,
  key: string,
) {
  if (typeof payload !== 'object' || payload === null) {
    return undefined
  }

  const payloadPayload =
    'payload' in payload &&
    typeof payload.payload === 'object' &&
    payload.payload !== null
      ? payload.payload
      : undefined

  let configLabelKey: string = key

  if (
    key in payload &&
    typeof payload[key as keyof typeof payload] === 'string'
  ) {
    configLabelKey = payload[key as keyof typeof payload] as string
  } else if (
    payloadPayload &&
    key in payloadPayload &&
    typeof payloadPayload[key as keyof typeof payloadPayload] === 'string'
  ) {
    configLabelKey = payloadPayload[
      key as keyof typeof payloadPayload
    ] as string
  }

  return configLabelKey in config
    ? config[configLabelKey]
    : config[key as keyof typeof config]
}

export {
  ChartContainer,
  ChartTooltip,
  ChartTooltipContent,
  ChartLegend,
  ChartLegendContent,
  ChartStyle,
}
</file>

<file path="components/ui/checkbox.tsx">
'use client'

import * as React from 'react'
import * as CheckboxPrimitive from '@radix-ui/react-checkbox'
import { CheckIcon } from 'lucide-react'

import { cn } from '@/lib/utils'

function Checkbox({
  className,
  ...props
}: React.ComponentProps<typeof CheckboxPrimitive.Root>) {
  return (
    <CheckboxPrimitive.Root
      data-slot="checkbox"
      className={cn(
        'peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50',
        className,
      )}
      {...props}
    >
      <CheckboxPrimitive.Indicator
        data-slot="checkbox-indicator"
        className="flex items-center justify-center text-current transition-none"
      >
        <CheckIcon className="size-3.5" />
      </CheckboxPrimitive.Indicator>
    </CheckboxPrimitive.Root>
  )
}

export { Checkbox }
</file>

<file path="components/ui/collapsible.tsx">
'use client'

import * as CollapsiblePrimitive from '@radix-ui/react-collapsible'

function Collapsible({
  ...props
}: React.ComponentProps<typeof CollapsiblePrimitive.Root>) {
  return <CollapsiblePrimitive.Root data-slot="collapsible" {...props} />
}

function CollapsibleTrigger({
  ...props
}: React.ComponentProps<typeof CollapsiblePrimitive.CollapsibleTrigger>) {
  return (
    <CollapsiblePrimitive.CollapsibleTrigger
      data-slot="collapsible-trigger"
      {...props}
    />
  )
}

function CollapsibleContent({
  ...props
}: React.ComponentProps<typeof CollapsiblePrimitive.CollapsibleContent>) {
  return (
    <CollapsiblePrimitive.CollapsibleContent
      data-slot="collapsible-content"
      {...props}
    />
  )
}

export { Collapsible, CollapsibleTrigger, CollapsibleContent }
</file>

<file path="components/ui/combobox.tsx">
"use client"

import * as React from "react"
import { Check, ChevronsUpDown } from "lucide-react"
import { cn } from "@/lib/utils"
import { Button } from "@/components/ui/button"
import {
  Command,
  CommandEmpty,
  CommandGroup,
  CommandInput,
  CommandItem,
  CommandList,
} from "@/components/ui/command"
import {
  Popover,
  PopoverContent,
  PopoverTrigger,
} from "@/components/ui/popover"

export interface ComboboxOption {
  value: string
  label: string
}

interface ComboboxProps {
  options: ComboboxOption[]
  value?: string
  onValueChange?: (value: string) => void
  placeholder?: string
  searchPlaceholder?: string
  emptyText?: string
  className?: string
  disabled?: boolean
}

export function Combobox({
  options,
  value,
  onValueChange,
  placeholder = "ì„ íƒí•˜ì„¸ìš”...",
  searchPlaceholder = "ê²€ìƒ‰...",
  emptyText = "ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.",
  className,
  disabled = false,
}: ComboboxProps) {
  const [open, setOpen] = React.useState(false)

  const selectedOption = options.find((option) => option.value === value)

  return (
    <Popover open={open} onOpenChange={setOpen}>
      <PopoverTrigger asChild>
        <Button
          variant="outline"
          role="combobox"
          aria-expanded={open}
          disabled={disabled}
          className={cn(
            "w-full justify-between font-normal",
            !value && "text-muted-foreground",
            className
          )}
        >
          {selectedOption?.label || placeholder}
          <ChevronsUpDown className="ml-2 h-4 w-4 shrink-0 opacity-50" />
        </Button>
      </PopoverTrigger>
      <PopoverContent className="w-[--radix-popover-trigger-width] p-0" align="start">
        <Command>
          <CommandInput placeholder={searchPlaceholder} />
          <CommandList>
            <CommandEmpty>{emptyText}</CommandEmpty>
            <CommandGroup>
              {options.map((option) => (
                <CommandItem
                  key={option.value}
                  value={option.label}
                  onSelect={() => {
                    onValueChange?.(option.value === value ? "" : option.value)
                    setOpen(false)
                  }}
                >
                  <Check
                    className={cn(
                      "mr-2 h-4 w-4",
                      value === option.value ? "opacity-100" : "opacity-0"
                    )}
                  />
                  {option.label}
                </CommandItem>
              ))}
            </CommandGroup>
          </CommandList>
        </Command>
      </PopoverContent>
    </Popover>
  )
}
</file>

<file path="components/ui/command.tsx">
'use client'

import * as React from 'react'
import { Command as CommandPrimitive } from 'cmdk'
import { SearchIcon } from 'lucide-react'

import { cn } from '@/lib/utils'
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogHeader,
  DialogTitle,
} from '@/components/ui/dialog'

function Command({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive>) {
  return (
    <CommandPrimitive
      data-slot="command"
      className={cn(
        'bg-popover text-popover-foreground flex h-full w-full flex-col overflow-hidden rounded-md',
        className,
      )}
      {...props}
    />
  )
}

function CommandDialog({
  title = 'Command Palette',
  description = 'Search for a command to run...',
  children,
  className,
  ...props
}: React.ComponentProps<typeof Dialog> & {
  title?: string
  description?: string
  className?: string
}) {
  return (
    <Dialog {...props}>
      <DialogHeader className="sr-only">
        <DialogTitle>{title}</DialogTitle>
        <DialogDescription>{description}</DialogDescription>
      </DialogHeader>
      <DialogContent
        className={cn('overflow-hidden p-0', className)}
      >
        <Command className="[&_[cmdk-group-heading]]:text-muted-foreground **:data-[slot=command-input-wrapper]:h-12 [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group]]:px-2 [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5">
          {children}
        </Command>
      </DialogContent>
    </Dialog>
  )
}

function CommandInput({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive.Input>) {
  return (
    <div
      data-slot="command-input-wrapper"
      className="flex h-9 items-center gap-2 border-b px-3"
    >
      <SearchIcon className="size-4 shrink-0 opacity-50" />
      <CommandPrimitive.Input
        data-slot="command-input"
        className={cn(
          'placeholder:text-muted-foreground flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-hidden disabled:cursor-not-allowed disabled:opacity-50',
          className,
        )}
        {...props}
      />
    </div>
  )
}

function CommandList({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive.List>) {
  return (
    <CommandPrimitive.List
      data-slot="command-list"
      className={cn(
        'max-h-[300px] scroll-py-1 overflow-x-hidden overflow-y-auto',
        className,
      )}
      {...props}
    />
  )
}

function CommandEmpty({
  ...props
}: React.ComponentProps<typeof CommandPrimitive.Empty>) {
  return (
    <CommandPrimitive.Empty
      data-slot="command-empty"
      className="py-6 text-center text-sm"
      {...props}
    />
  )
}

function CommandGroup({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive.Group>) {
  return (
    <CommandPrimitive.Group
      data-slot="command-group"
      className={cn(
        'text-foreground [&_[cmdk-group-heading]]:text-muted-foreground overflow-hidden p-1 [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium',
        className,
      )}
      {...props}
    />
  )
}

function CommandSeparator({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive.Separator>) {
  return (
    <CommandPrimitive.Separator
      data-slot="command-separator"
      className={cn('bg-border -mx-1 h-px', className)}
      {...props}
    />
  )
}

function CommandItem({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive.Item>) {
  return (
    <CommandPrimitive.Item
      data-slot="command-item"
      className={cn(
        "data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled=true]:pointer-events-none data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    />
  )
}

function CommandShortcut({
  className,
  ...props
}: React.ComponentProps<'span'>) {
  return (
    <span
      data-slot="command-shortcut"
      className={cn(
        'text-muted-foreground ml-auto text-xs tracking-widest',
        className,
      )}
      {...props}
    />
  )
}

export {
  Command,
  CommandDialog,
  CommandInput,
  CommandList,
  CommandEmpty,
  CommandGroup,
  CommandItem,
  CommandShortcut,
  CommandSeparator,
}
</file>

<file path="components/ui/context-menu.tsx">
'use client'

import * as React from 'react'
import * as ContextMenuPrimitive from '@radix-ui/react-context-menu'
import { CheckIcon, ChevronRightIcon, CircleIcon } from 'lucide-react'

import { cn } from '@/lib/utils'

function ContextMenu({
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Root>) {
  return <ContextMenuPrimitive.Root data-slot="context-menu" {...props} />
}

function ContextMenuTrigger({
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Trigger>) {
  return (
    <ContextMenuPrimitive.Trigger data-slot="context-menu-trigger" {...props} />
  )
}

function ContextMenuGroup({
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Group>) {
  return (
    <ContextMenuPrimitive.Group data-slot="context-menu-group" {...props} />
  )
}

function ContextMenuPortal({
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Portal>) {
  return (
    <ContextMenuPrimitive.Portal data-slot="context-menu-portal" {...props} />
  )
}

function ContextMenuSub({
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Sub>) {
  return <ContextMenuPrimitive.Sub data-slot="context-menu-sub" {...props} />
}

function ContextMenuRadioGroup({
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.RadioGroup>) {
  return (
    <ContextMenuPrimitive.RadioGroup
      data-slot="context-menu-radio-group"
      {...props}
    />
  )
}

function ContextMenuSubTrigger({
  className,
  inset,
  children,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.SubTrigger> & {
  inset?: boolean
}) {
  return (
    <ContextMenuPrimitive.SubTrigger
      data-slot="context-menu-sub-trigger"
      data-inset={inset}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground flex cursor-default items-center rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    >
      {children}
      <ChevronRightIcon className="ml-auto" />
    </ContextMenuPrimitive.SubTrigger>
  )
}

function ContextMenuSubContent({
  className,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.SubContent>) {
  return (
    <ContextMenuPrimitive.SubContent
      data-slot="context-menu-sub-content"
      className={cn(
        'bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 min-w-[8rem] origin-[var(--radix-context-menu-content-transform-origin)] overflow-hidden rounded-md border p-1 shadow-lg',
        className,
      )}
      {...props}
    />
  )
}

function ContextMenuContent({
  className,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Content>) {
  return (
    <ContextMenuPrimitive.Portal>
      <ContextMenuPrimitive.Content
        data-slot="context-menu-content"
        className={cn(
          'bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-[var(--radix-context-menu-content-available-height)] min-w-[8rem] origin-[var(--radix-context-menu-content-transform-origin)] overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md',
          className,
        )}
        {...props}
      />
    </ContextMenuPrimitive.Portal>
  )
}

function ContextMenuItem({
  className,
  inset,
  variant = 'default',
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Item> & {
  inset?: boolean
  variant?: 'default' | 'destructive'
}) {
  return (
    <ContextMenuPrimitive.Item
      data-slot="context-menu-item"
      data-inset={inset}
      data-variant={variant}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    />
  )
}

function ContextMenuCheckboxItem({
  className,
  children,
  checked,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.CheckboxItem>) {
  return (
    <ContextMenuPrimitive.CheckboxItem
      data-slot="context-menu-checkbox-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-sm py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      checked={checked}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <ContextMenuPrimitive.ItemIndicator>
          <CheckIcon className="size-4" />
        </ContextMenuPrimitive.ItemIndicator>
      </span>
      {children}
    </ContextMenuPrimitive.CheckboxItem>
  )
}

function ContextMenuRadioItem({
  className,
  children,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.RadioItem>) {
  return (
    <ContextMenuPrimitive.RadioItem
      data-slot="context-menu-radio-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-sm py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <ContextMenuPrimitive.ItemIndicator>
          <CircleIcon className="size-2 fill-current" />
        </ContextMenuPrimitive.ItemIndicator>
      </span>
      {children}
    </ContextMenuPrimitive.RadioItem>
  )
}

function ContextMenuLabel({
  className,
  inset,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Label> & {
  inset?: boolean
}) {
  return (
    <ContextMenuPrimitive.Label
      data-slot="context-menu-label"
      data-inset={inset}
      className={cn(
        'text-foreground px-2 py-1.5 text-sm font-medium data-[inset]:pl-8',
        className,
      )}
      {...props}
    />
  )
}

function ContextMenuSeparator({
  className,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Separator>) {
  return (
    <ContextMenuPrimitive.Separator
      data-slot="context-menu-separator"
      className={cn('bg-border -mx-1 my-1 h-px', className)}
      {...props}
    />
  )
}

function ContextMenuShortcut({
  className,
  ...props
}: React.ComponentProps<'span'>) {
  return (
    <span
      data-slot="context-menu-shortcut"
      className={cn(
        'text-muted-foreground ml-auto text-xs tracking-widest',
        className,
      )}
      {...props}
    />
  )
}

export {
  ContextMenu,
  ContextMenuTrigger,
  ContextMenuContent,
  ContextMenuItem,
  ContextMenuCheckboxItem,
  ContextMenuRadioItem,
  ContextMenuLabel,
  ContextMenuSeparator,
  ContextMenuShortcut,
  ContextMenuGroup,
  ContextMenuPortal,
  ContextMenuSub,
  ContextMenuSubContent,
  ContextMenuSubTrigger,
  ContextMenuRadioGroup,
}
</file>

<file path="components/ui/dialog.tsx">
"use client"

import * as React from "react"
import * as DialogPrimitive from "@radix-ui/react-dialog"
import { X } from "lucide-react"
import { cn } from "@/lib/utils"
import { lockBodyScroll, unlockBodyScroll } from "@/lib/utils/scroll-lock"

const Dialog = DialogPrimitive.Root
const DialogTrigger = DialogPrimitive.Trigger
const DialogPortal = DialogPrimitive.Portal
const DialogClose = DialogPrimitive.Close

const DialogOverlay = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Overlay
    ref={ref}
    className={cn(
      "fixed inset-0 z-[100] bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className
    )}
    {...props}
  />
))
DialogOverlay.displayName = DialogPrimitive.Overlay.displayName

const DialogContent = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>
>(({ className, children, ...props }, ref) => {
  // ëª¨ë‹¬ì´ ì—´ë¦´ ë•Œì™€ ë‹«í ë•Œ body scroll lock ê´€ë¦¬
  React.useEffect(() => {
    // ëª¨ë‹¬ì´ ì—´ë¦´ ë•Œ body scroll lock
    lockBodyScroll()

    // ëª¨ë‹¬ì´ ë‹«í ë•Œ body scroll unlock
    return () => {
      unlockBodyScroll()
    }
  }, [])

  return (
    <DialogPortal>
      <DialogOverlay />
      <DialogPrimitive.Content
        ref={ref}
        className={cn(
          "fixed left-1/2 top-1/2 z-[101] grid w-full max-w-lg -translate-x-1/2 -translate-y-1/2 gap-4 border bg-white p-6 shadow-lg duration-200 sm:rounded-lg",
          "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95",
          "max-h-[90vh] md:max-h-[85vh] overflow-y-auto overscroll-contain",
          // ëª¨ë°”ì¼ì—ì„œ í‚¤ë³´ë“œê°€ ì˜¬ë¼ì˜¬ ë•Œ ìŠ¤í¬ë¡¤ ê°€ëŠ¥í•˜ë„ë¡ ìœ„ì¹˜ ì¡°ì •
          "md:translate-y-[-50%] translate-y-[-45%] sm:translate-y-[-50%]",
          className
        )}
        {...props}
      >
        {children}
        <DialogPrimitive.Close className="absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground">
          <X className="h-4 w-4" />
          <span className="sr-only">Close</span>
        </DialogPrimitive.Close>
      </DialogPrimitive.Content>
    </DialogPortal>
  )
})
DialogContent.displayName = DialogPrimitive.Content.displayName

const DialogHeader = ({ className, ...props }: React.HTMLAttributes<HTMLDivElement>) => (
  <div className={cn("flex flex-col space-y-1.5 text-center sm:text-left", className)} {...props} />
)
DialogHeader.displayName = "DialogHeader"

const DialogFooter = ({ className, ...props }: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",
      className
    )}
    {...props}
  />
)
DialogFooter.displayName = "DialogFooter"

const DialogTitle = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Title
    ref={ref}
    className={cn("text-lg font-semibold leading-none tracking-tight text-slate-900", className)}
    {...props}
  />
))
DialogTitle.displayName = DialogPrimitive.Title.displayName

const DialogDescription = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Description
    ref={ref}
    className={cn("text-sm text-slate-500", className)}
    {...props}
  />
))
DialogDescription.displayName = DialogPrimitive.Description.displayName

export {
  Dialog,
  DialogPortal,
  DialogOverlay,
  DialogClose,
  DialogTrigger,
  DialogContent,
  DialogHeader,
  DialogFooter,
  DialogTitle,
  DialogDescription,
}
</file>

<file path="components/ui/drawer.tsx">
'use client'

import * as React from 'react'
import { Drawer as DrawerPrimitive } from 'vaul'

import { cn } from '@/lib/utils'
import { lockBodyScroll, unlockBodyScroll } from '@/lib/utils/scroll-lock'

function Drawer({
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Root>) {
  return <DrawerPrimitive.Root data-slot="drawer" {...props} />
}

function DrawerTrigger({
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Trigger>) {
  return <DrawerPrimitive.Trigger data-slot="drawer-trigger" {...props} />
}

function DrawerPortal({
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Portal>) {
  return <DrawerPrimitive.Portal data-slot="drawer-portal" {...props} />
}

function DrawerClose({
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Close>) {
  return <DrawerPrimitive.Close data-slot="drawer-close" {...props} />
}

function DrawerOverlay({
  className,
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Overlay>) {
  return (
    <DrawerPrimitive.Overlay
      data-slot="drawer-overlay"
      className={cn(
        'data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50',
        className,
      )}
      {...props}
    />
  )
}

function DrawerContent({
  className,
  children,
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Content>) {
  // ëª¨ë‹¬ì´ ì—´ë¦´ ë•Œì™€ ë‹«í ë•Œ body scroll lock ê´€ë¦¬
  React.useEffect(() => {
    // ëª¨ë‹¬ì´ ì—´ë¦´ ë•Œ body scroll lock
    lockBodyScroll()

    // ëª¨ë‹¬ì´ ë‹«í ë•Œ body scroll unlock
    return () => {
      unlockBodyScroll()
    }
  }, [])

  return (
    <DrawerPortal data-slot="drawer-portal">
      <DrawerOverlay />
      <DrawerPrimitive.Content
        data-slot="drawer-content"
        className={cn(
          'group/drawer-content bg-background fixed z-50 flex h-auto flex-col',
          'data-[vaul-drawer-direction=top]:inset-x-0 data-[vaul-drawer-direction=top]:top-0 data-[vaul-drawer-direction=top]:mb-24 data-[vaul-drawer-direction=top]:max-h-[80vh] data-[vaul-drawer-direction=top]:rounded-b-lg data-[vaul-drawer-direction=top]:border-b',
          'data-[vaul-drawer-direction=bottom]:inset-x-0 data-[vaul-drawer-direction=bottom]:bottom-0 data-[vaul-drawer-direction=bottom]:mt-24 data-[vaul-drawer-direction=bottom]:max-h-[80vh] data-[vaul-drawer-direction=bottom]:rounded-t-lg data-[vaul-drawer-direction=bottom]:border-t',
          'data-[vaul-drawer-direction=right]:inset-y-0 data-[vaul-drawer-direction=right]:right-0 data-[vaul-drawer-direction=right]:w-3/4 data-[vaul-drawer-direction=right]:border-l data-[vaul-drawer-direction=right]:sm:max-w-sm',
          'data-[vaul-drawer-direction=left]:inset-y-0 data-[vaul-drawer-direction=left]:left-0 data-[vaul-drawer-direction=left]:w-3/4 data-[vaul-drawer-direction=left]:border-r data-[vaul-drawer-direction=left]:sm:max-w-sm',
          className,
        )}
        {...props}
      >
        <div className="bg-muted mx-auto mt-4 hidden h-2 w-[100px] shrink-0 rounded-full group-data-[vaul-drawer-direction=bottom]/drawer-content:block" />
        {children}
      </DrawerPrimitive.Content>
    </DrawerPortal>
  )
}

function DrawerHeader({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="drawer-header"
      className={cn(
        'flex flex-col gap-0.5 p-4 group-data-[vaul-drawer-direction=bottom]/drawer-content:text-center group-data-[vaul-drawer-direction=top]/drawer-content:text-center md:gap-1.5 md:text-left',
        className,
      )}
      {...props}
    />
  )
}

function DrawerFooter({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="drawer-footer"
      className={cn('mt-auto flex flex-col gap-2 p-4', className)}
      {...props}
    />
  )
}

function DrawerTitle({
  className,
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Title>) {
  return (
    <DrawerPrimitive.Title
      data-slot="drawer-title"
      className={cn('text-foreground font-semibold', className)}
      {...props}
    />
  )
}

function DrawerDescription({
  className,
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Description>) {
  return (
    <DrawerPrimitive.Description
      data-slot="drawer-description"
      className={cn('text-muted-foreground text-sm', className)}
      {...props}
    />
  )
}

export {
  Drawer,
  DrawerPortal,
  DrawerOverlay,
  DrawerTrigger,
  DrawerClose,
  DrawerContent,
  DrawerHeader,
  DrawerFooter,
  DrawerTitle,
  DrawerDescription,
}
</file>

<file path="components/ui/dropdown-menu.tsx">
'use client'

import * as React from 'react'
import * as DropdownMenuPrimitive from '@radix-ui/react-dropdown-menu'
import { CheckIcon, ChevronRightIcon, CircleIcon } from 'lucide-react'

import { cn } from '@/lib/utils'

function DropdownMenu({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Root>) {
  return <DropdownMenuPrimitive.Root data-slot="dropdown-menu" {...props} />
}

function DropdownMenuPortal({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Portal>) {
  return (
    <DropdownMenuPrimitive.Portal data-slot="dropdown-menu-portal" {...props} />
  )
}

function DropdownMenuTrigger({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Trigger>) {
  return (
    <DropdownMenuPrimitive.Trigger
      data-slot="dropdown-menu-trigger"
      {...props}
    />
  )
}

function DropdownMenuContent({
  className,
  sideOffset = 4,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Content>) {
  return (
    <DropdownMenuPrimitive.Portal>
      <DropdownMenuPrimitive.Content
        data-slot="dropdown-menu-content"
        sideOffset={sideOffset}
        className={cn(
          'bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] origin-[var(--radix-dropdown-menu-content-transform-origin)] overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md',
          className,
        )}
        {...props}
      />
    </DropdownMenuPrimitive.Portal>
  )
}

function DropdownMenuGroup({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Group>) {
  return (
    <DropdownMenuPrimitive.Group data-slot="dropdown-menu-group" {...props} />
  )
}

function DropdownMenuItem({
  className,
  inset,
  variant = 'default',
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Item> & {
  inset?: boolean
  variant?: 'default' | 'destructive'
}) {
  return (
    <DropdownMenuPrimitive.Item
      data-slot="dropdown-menu-item"
      data-inset={inset}
      data-variant={variant}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    />
  )
}

function DropdownMenuCheckboxItem({
  className,
  children,
  checked,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.CheckboxItem>) {
  return (
    <DropdownMenuPrimitive.CheckboxItem
      data-slot="dropdown-menu-checkbox-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-sm py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      checked={checked}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <DropdownMenuPrimitive.ItemIndicator>
          <CheckIcon className="size-4" />
        </DropdownMenuPrimitive.ItemIndicator>
      </span>
      {children}
    </DropdownMenuPrimitive.CheckboxItem>
  )
}

function DropdownMenuRadioGroup({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.RadioGroup>) {
  return (
    <DropdownMenuPrimitive.RadioGroup
      data-slot="dropdown-menu-radio-group"
      {...props}
    />
  )
}

function DropdownMenuRadioItem({
  className,
  children,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.RadioItem>) {
  return (
    <DropdownMenuPrimitive.RadioItem
      data-slot="dropdown-menu-radio-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-sm py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <DropdownMenuPrimitive.ItemIndicator>
          <CircleIcon className="size-2 fill-current" />
        </DropdownMenuPrimitive.ItemIndicator>
      </span>
      {children}
    </DropdownMenuPrimitive.RadioItem>
  )
}

function DropdownMenuLabel({
  className,
  inset,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Label> & {
  inset?: boolean
}) {
  return (
    <DropdownMenuPrimitive.Label
      data-slot="dropdown-menu-label"
      data-inset={inset}
      className={cn(
        'px-2 py-1.5 text-sm font-medium data-[inset]:pl-8',
        className,
      )}
      {...props}
    />
  )
}

function DropdownMenuSeparator({
  className,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Separator>) {
  return (
    <DropdownMenuPrimitive.Separator
      data-slot="dropdown-menu-separator"
      className={cn('bg-border -mx-1 my-1 h-px', className)}
      {...props}
    />
  )
}

function DropdownMenuShortcut({
  className,
  ...props
}: React.ComponentProps<'span'>) {
  return (
    <span
      data-slot="dropdown-menu-shortcut"
      className={cn(
        'text-muted-foreground ml-auto text-xs tracking-widest',
        className,
      )}
      {...props}
    />
  )
}

function DropdownMenuSub({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Sub>) {
  return <DropdownMenuPrimitive.Sub data-slot="dropdown-menu-sub" {...props} />
}

function DropdownMenuSubTrigger({
  className,
  inset,
  children,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.SubTrigger> & {
  inset?: boolean
}) {
  return (
    <DropdownMenuPrimitive.SubTrigger
      data-slot="dropdown-menu-sub-trigger"
      data-inset={inset}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    >
      {children}
      <ChevronRightIcon className="ml-auto size-4" />
    </DropdownMenuPrimitive.SubTrigger>
  )
}

function DropdownMenuSubContent({
  className,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.SubContent>) {
  return (
    <DropdownMenuPrimitive.SubContent
      data-slot="dropdown-menu-sub-content"
      className={cn(
        'bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 min-w-[8rem] origin-[var(--radix-dropdown-menu-content-transform-origin)] overflow-hidden rounded-md border p-1 shadow-lg',
        className,
      )}
      {...props}
    />
  )
}

export {
  DropdownMenu,
  DropdownMenuPortal,
  DropdownMenuTrigger,
  DropdownMenuContent,
  DropdownMenuGroup,
  DropdownMenuLabel,
  DropdownMenuItem,
  DropdownMenuCheckboxItem,
  DropdownMenuRadioGroup,
  DropdownMenuRadioItem,
  DropdownMenuSeparator,
  DropdownMenuShortcut,
  DropdownMenuSub,
  DropdownMenuSubTrigger,
  DropdownMenuSubContent,
}
</file>

<file path="components/ui/empty.tsx">
import { cva, type VariantProps } from 'class-variance-authority'

import { cn } from '@/lib/utils'

function Empty({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="empty"
      className={cn(
        'flex min-w-0 flex-1 flex-col items-center justify-center gap-6 rounded-lg border-dashed p-6 text-center text-balance md:p-12',
        className,
      )}
      {...props}
    />
  )
}

function EmptyHeader({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="empty-header"
      className={cn(
        'flex max-w-sm flex-col items-center gap-2 text-center',
        className,
      )}
      {...props}
    />
  )
}

const emptyMediaVariants = cva(
  'flex shrink-0 items-center justify-center mb-2 [&_svg]:pointer-events-none [&_svg]:shrink-0',
  {
    variants: {
      variant: {
        default: 'bg-transparent',
        icon: "bg-muted text-foreground flex size-10 shrink-0 items-center justify-center rounded-lg [&_svg:not([class*='size-'])]:size-6",
      },
    },
    defaultVariants: {
      variant: 'default',
    },
  },
)

function EmptyMedia({
  className,
  variant = 'default',
  ...props
}: React.ComponentProps<'div'> & VariantProps<typeof emptyMediaVariants>) {
  return (
    <div
      data-slot="empty-icon"
      data-variant={variant}
      className={cn(emptyMediaVariants({ variant, className }))}
      {...props}
    />
  )
}

function EmptyTitle({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="empty-title"
      className={cn('text-lg font-medium tracking-tight', className)}
      {...props}
    />
  )
}

function EmptyDescription({ className, ...props }: React.ComponentProps<'p'>) {
  return (
    <div
      data-slot="empty-description"
      className={cn(
        'text-muted-foreground [&>a:hover]:text-primary text-sm/relaxed [&>a]:underline [&>a]:underline-offset-4',
        className,
      )}
      {...props}
    />
  )
}

function EmptyContent({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="empty-content"
      className={cn(
        'flex w-full max-w-sm min-w-0 flex-col items-center gap-4 text-sm text-balance',
        className,
      )}
      {...props}
    />
  )
}

export {
  Empty,
  EmptyHeader,
  EmptyTitle,
  EmptyDescription,
  EmptyContent,
  EmptyMedia,
}
</file>

<file path="components/ui/field.tsx">
'use client'

import { useMemo } from 'react'
import { cva, type VariantProps } from 'class-variance-authority'

import { cn } from '@/lib/utils'
import { Label } from '@/components/ui/label'
import { Separator } from '@/components/ui/separator'

function FieldSet({ className, ...props }: React.ComponentProps<'fieldset'>) {
  return (
    <fieldset
      data-slot="field-set"
      className={cn(
        'flex flex-col gap-6',
        'has-[>[data-slot=checkbox-group]]:gap-3 has-[>[data-slot=radio-group]]:gap-3',
        className,
      )}
      {...props}
    />
  )
}

function FieldLegend({
  className,
  variant = 'legend',
  ...props
}: React.ComponentProps<'legend'> & { variant?: 'legend' | 'label' }) {
  return (
    <legend
      data-slot="field-legend"
      data-variant={variant}
      className={cn(
        'mb-3 font-medium',
        'data-[variant=legend]:text-base',
        'data-[variant=label]:text-sm',
        className,
      )}
      {...props}
    />
  )
}

function FieldGroup({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="field-group"
      className={cn(
        'group/field-group @container/field-group flex w-full flex-col gap-7 data-[slot=checkbox-group]:gap-3 [&>[data-slot=field-group]]:gap-4',
        className,
      )}
      {...props}
    />
  )
}

const fieldVariants = cva(
  'group/field flex w-full gap-3 data-[invalid=true]:text-destructive',
  {
    variants: {
      orientation: {
        vertical: ['flex-col [&>*]:w-full [&>.sr-only]:w-auto'],
        horizontal: [
          'flex-row items-center',
          '[&>[data-slot=field-label]]:flex-auto',
          'has-[>[data-slot=field-content]]:items-start has-[>[data-slot=field-content]]:[&>[role=checkbox],[role=radio]]:mt-px',
        ],
        responsive: [
          'flex-col [&>*]:w-full [&>.sr-only]:w-auto @md/field-group:flex-row @md/field-group:items-center @md/field-group:[&>*]:w-auto',
          '@md/field-group:[&>[data-slot=field-label]]:flex-auto',
          '@md/field-group:has-[>[data-slot=field-content]]:items-start @md/field-group:has-[>[data-slot=field-content]]:[&>[role=checkbox],[role=radio]]:mt-px',
        ],
      },
    },
    defaultVariants: {
      orientation: 'vertical',
    },
  },
)

function Field({
  className,
  orientation = 'vertical',
  ...props
}: React.ComponentProps<'div'> & VariantProps<typeof fieldVariants>) {
  return (
    <div
      role="group"
      data-slot="field"
      data-orientation={orientation}
      className={cn(fieldVariants({ orientation }), className)}
      {...props}
    />
  )
}

function FieldContent({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="field-content"
      className={cn(
        'group/field-content flex flex-1 flex-col gap-1.5 leading-snug',
        className,
      )}
      {...props}
    />
  )
}

function FieldLabel({
  className,
  ...props
}: React.ComponentProps<typeof Label>) {
  return (
    <Label
      data-slot="field-label"
      className={cn(
        'group/field-label peer/field-label flex w-fit gap-2 leading-snug group-data-[disabled=true]/field:opacity-50',
        'has-[>[data-slot=field]]:w-full has-[>[data-slot=field]]:flex-col has-[>[data-slot=field]]:rounded-md has-[>[data-slot=field]]:border [&>*]:data-[slot=field]:p-4',
        'has-data-[state=checked]:bg-primary/5 has-data-[state=checked]:border-primary dark:has-data-[state=checked]:bg-primary/10',
        className,
      )}
      {...props}
    />
  )
}

function FieldTitle({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="field-label"
      className={cn(
        'flex w-fit items-center gap-2 text-sm leading-snug font-medium group-data-[disabled=true]/field:opacity-50',
        className,
      )}
      {...props}
    />
  )
}

function FieldDescription({ className, ...props }: React.ComponentProps<'p'>) {
  return (
    <p
      data-slot="field-description"
      className={cn(
        'text-muted-foreground text-sm leading-normal font-normal group-has-[[data-orientation=horizontal]]/field:text-balance',
        'last:mt-0 nth-last-2:-mt-1 [[data-variant=legend]+&]:-mt-1.5',
        '[&>a:hover]:text-primary [&>a]:underline [&>a]:underline-offset-4',
        className,
      )}
      {...props}
    />
  )
}

function FieldSeparator({
  children,
  className,
  ...props
}: React.ComponentProps<'div'> & {
  children?: React.ReactNode
}) {
  return (
    <div
      data-slot="field-separator"
      data-content={!!children}
      className={cn(
        'relative -my-2 h-5 text-sm group-data-[variant=outline]/field-group:-mb-2',
        className,
      )}
      {...props}
    >
      <Separator className="absolute inset-0 top-1/2" />
      {children && (
        <span
          className="bg-background text-muted-foreground relative mx-auto block w-fit px-2"
          data-slot="field-separator-content"
        >
          {children}
        </span>
      )}
    </div>
  )
}

function FieldError({
  className,
  children,
  errors,
  ...props
}: React.ComponentProps<'div'> & {
  errors?: Array<{ message?: string } | undefined>
}) {
  const content = useMemo(() => {
    if (children) {
      return children
    }

    if (!errors) {
      return null
    }

    if (errors.length === 1 && errors[0]?.message) {
      return errors[0].message
    }

    return (
      <ul className="ml-4 flex list-disc flex-col gap-1">
        {errors.map(
          (error, index) =>
            error?.message && <li key={index}>{error.message}</li>,
        )}
      </ul>
    )
  }, [children, errors])

  if (!content) {
    return null
  }

  return (
    <div
      role="alert"
      data-slot="field-error"
      className={cn('text-destructive text-sm font-normal', className)}
      {...props}
    >
      {content}
    </div>
  )
}

export {
  Field,
  FieldLabel,
  FieldDescription,
  FieldError,
  FieldGroup,
  FieldLegend,
  FieldSeparator,
  FieldSet,
  FieldContent,
  FieldTitle,
}
</file>

<file path="components/ui/form.tsx">
'use client'

import * as React from 'react'
import * as LabelPrimitive from '@radix-ui/react-label'
import { Slot } from '@radix-ui/react-slot'
import {
  Controller,
  FormProvider,
  useFormContext,
  useFormState,
  type ControllerProps,
  type FieldPath,
  type FieldValues,
} from 'react-hook-form'

import { cn } from '@/lib/utils'
import { Label } from '@/components/ui/label'

const Form = FormProvider

type FormFieldContextValue<
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>,
> = {
  name: TName
}

const FormFieldContext = React.createContext<FormFieldContextValue>(
  {} as FormFieldContextValue,
)

const FormField = <
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>,
>({
  ...props
}: ControllerProps<TFieldValues, TName>) => {
  return (
    <FormFieldContext.Provider value={{ name: props.name }}>
      <Controller {...props} />
    </FormFieldContext.Provider>
  )
}

const useFormField = () => {
  const fieldContext = React.useContext(FormFieldContext)
  const itemContext = React.useContext(FormItemContext)
  const { getFieldState } = useFormContext()
  const formState = useFormState({ name: fieldContext.name })
  const fieldState = getFieldState(fieldContext.name, formState)

  if (!fieldContext) {
    throw new Error('useFormField should be used within <FormField>')
  }

  const { id } = itemContext

  return {
    id,
    name: fieldContext.name,
    formItemId: `${id}-form-item`,
    formDescriptionId: `${id}-form-item-description`,
    formMessageId: `${id}-form-item-message`,
    ...fieldState,
  }
}

type FormItemContextValue = {
  id: string
}

const FormItemContext = React.createContext<FormItemContextValue>(
  {} as FormItemContextValue,
)

function FormItem({ className, ...props }: React.ComponentProps<'div'>) {
  const id = React.useId()

  return (
    <FormItemContext.Provider value={{ id }}>
      <div
        data-slot="form-item"
        className={cn('grid gap-2', className)}
        {...props}
      />
    </FormItemContext.Provider>
  )
}

function FormLabel({
  className,
  ...props
}: React.ComponentProps<typeof LabelPrimitive.Root>) {
  const { error, formItemId } = useFormField()

  return (
    <Label
      data-slot="form-label"
      data-error={!!error}
      className={cn('data-[error=true]:text-destructive', className)}
      htmlFor={formItemId}
      {...props}
    />
  )
}

function FormControl({ ...props }: React.ComponentProps<typeof Slot>) {
  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()

  return (
    <Slot
      data-slot="form-control"
      id={formItemId}
      aria-describedby={
        !error
          ? `${formDescriptionId}`
          : `${formDescriptionId} ${formMessageId}`
      }
      aria-invalid={!!error}
      {...props}
    />
  )
}

function FormDescription({ className, ...props }: React.ComponentProps<'p'>) {
  const { formDescriptionId } = useFormField()

  return (
    <p
      data-slot="form-description"
      id={formDescriptionId}
      className={cn('text-muted-foreground text-sm', className)}
      {...props}
    />
  )
}

function FormMessage({ className, ...props }: React.ComponentProps<'p'>) {
  const { error, formMessageId } = useFormField()
  const body = error ? String(error?.message ?? '') : props.children

  if (!body) {
    return null
  }

  return (
    <p
      data-slot="form-message"
      id={formMessageId}
      className={cn('text-destructive text-sm', className)}
      {...props}
    >
      {body}
    </p>
  )
}

export {
  useFormField,
  Form,
  FormItem,
  FormLabel,
  FormControl,
  FormDescription,
  FormMessage,
  FormField,
}
</file>

<file path="components/ui/hover-card.tsx">
'use client'

import * as React from 'react'
import * as HoverCardPrimitive from '@radix-ui/react-hover-card'

import { cn } from '@/lib/utils'

function HoverCard({
  ...props
}: React.ComponentProps<typeof HoverCardPrimitive.Root>) {
  return <HoverCardPrimitive.Root data-slot="hover-card" {...props} />
}

function HoverCardTrigger({
  ...props
}: React.ComponentProps<typeof HoverCardPrimitive.Trigger>) {
  return (
    <HoverCardPrimitive.Trigger data-slot="hover-card-trigger" {...props} />
  )
}

function HoverCardContent({
  className,
  align = 'center',
  sideOffset = 4,
  ...props
}: React.ComponentProps<typeof HoverCardPrimitive.Content>) {
  return (
    <HoverCardPrimitive.Portal data-slot="hover-card-portal">
      <HoverCardPrimitive.Content
        data-slot="hover-card-content"
        align={align}
        sideOffset={sideOffset}
        className={cn(
          'bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-64 origin-[var(--radix-hover-card-content-transform-origin)] rounded-md border p-4 shadow-md outline-hidden',
          className,
        )}
        {...props}
      />
    </HoverCardPrimitive.Portal>
  )
}

export { HoverCard, HoverCardTrigger, HoverCardContent }
</file>

<file path="components/ui/input-group.tsx">
'use client'

import { cva, type VariantProps } from 'class-variance-authority'

import { cn } from '@/lib/utils'
import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import { Textarea } from '@/components/ui/textarea'

function InputGroup({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="input-group"
      role="group"
      className={cn(
        'group/input-group border-input dark:bg-input/30 relative flex w-full items-center rounded-md border shadow-xs transition-[color,box-shadow] outline-none',
        'h-9 has-[>textarea]:h-auto',

        // Variants based on alignment.
        'has-[>[data-align=inline-start]]:[&>input]:pl-2',
        'has-[>[data-align=inline-end]]:[&>input]:pr-2',
        'has-[>[data-align=block-start]]:h-auto has-[>[data-align=block-start]]:flex-col has-[>[data-align=block-start]]:[&>input]:pb-3',
        'has-[>[data-align=block-end]]:h-auto has-[>[data-align=block-end]]:flex-col has-[>[data-align=block-end]]:[&>input]:pt-3',

        // Focus state.
        'has-[[data-slot=input-group-control]:focus-visible]:border-ring has-[[data-slot=input-group-control]:focus-visible]:ring-ring/50 has-[[data-slot=input-group-control]:focus-visible]:ring-[3px]',

        // Error state.
        'has-[[data-slot][aria-invalid=true]]:ring-destructive/20 has-[[data-slot][aria-invalid=true]]:border-destructive dark:has-[[data-slot][aria-invalid=true]]:ring-destructive/40',

        className,
      )}
      {...props}
    />
  )
}

const inputGroupAddonVariants = cva(
  "text-muted-foreground flex h-auto cursor-text items-center justify-center gap-2 py-1.5 text-sm font-medium select-none [&>svg:not([class*='size-'])]:size-4 [&>kbd]:rounded-[calc(var(--radius)-5px)] group-data-[disabled=true]/input-group:opacity-50",
  {
    variants: {
      align: {
        'inline-start':
          'order-first pl-3 has-[>button]:ml-[-0.45rem] has-[>kbd]:ml-[-0.35rem]',
        'inline-end':
          'order-last pr-3 has-[>button]:mr-[-0.4rem] has-[>kbd]:mr-[-0.35rem]',
        'block-start':
          'order-first w-full justify-start px-3 pt-3 [.border-b]:pb-3 group-has-[>input]/input-group:pt-2.5',
        'block-end':
          'order-last w-full justify-start px-3 pb-3 [.border-t]:pt-3 group-has-[>input]/input-group:pb-2.5',
      },
    },
    defaultVariants: {
      align: 'inline-start',
    },
  },
)

function InputGroupAddon({
  className,
  align = 'inline-start',
  ...props
}: React.ComponentProps<'div'> & VariantProps<typeof inputGroupAddonVariants>) {
  return (
    <div
      role="group"
      data-slot="input-group-addon"
      data-align={align}
      className={cn(inputGroupAddonVariants({ align }), className)}
      onClick={(e) => {
        if ((e.target as HTMLElement).closest('button')) {
          return
        }
        e.currentTarget.parentElement?.querySelector('input')?.focus()
      }}
      {...props}
    />
  )
}

const inputGroupButtonVariants = cva(
  'text-sm shadow-none flex gap-2 items-center',
  {
    variants: {
      size: {
        xs: "h-6 gap-1 px-2 rounded-[calc(var(--radius)-5px)] [&>svg:not([class*='size-'])]:size-3.5 has-[>svg]:px-2",
        sm: 'h-8 px-2.5 gap-1.5 rounded-md has-[>svg]:px-2.5',
        'icon-xs':
          'size-6 rounded-[calc(var(--radius)-5px)] p-0 has-[>svg]:p-0',
        'icon-sm': 'size-8 p-0 has-[>svg]:p-0',
      },
    },
    defaultVariants: {
      size: 'xs',
    },
  },
)

function InputGroupButton({
  className,
  type = 'button',
  variant = 'ghost',
  size = 'xs',
  ...props
}: Omit<React.ComponentProps<typeof Button>, 'size'> &
  VariantProps<typeof inputGroupButtonVariants>) {
  return (
    <Button
      type={type}
      data-size={size}
      variant={variant}
      className={cn(inputGroupButtonVariants({ size }), className)}
      {...props}
    />
  )
}

function InputGroupText({ className, ...props }: React.ComponentProps<'span'>) {
  return (
    <span
      className={cn(
        "text-muted-foreground flex items-center gap-2 text-sm [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    />
  )
}

function InputGroupInput({
  className,
  ...props
}: React.ComponentProps<'input'>) {
  return (
    <Input
      data-slot="input-group-control"
      className={cn(
        'flex-1 rounded-none border-0 bg-transparent shadow-none focus-visible:ring-0 dark:bg-transparent',
        className,
      )}
      {...props}
    />
  )
}

function InputGroupTextarea({
  className,
  ...props
}: React.ComponentProps<'textarea'>) {
  return (
    <Textarea
      data-slot="input-group-control"
      className={cn(
        'flex-1 resize-none rounded-none border-0 bg-transparent py-3 shadow-none focus-visible:ring-0 dark:bg-transparent',
        className,
      )}
      {...props}
    />
  )
}

export {
  InputGroup,
  InputGroupAddon,
  InputGroupButton,
  InputGroupText,
  InputGroupInput,
  InputGroupTextarea,
}
</file>

<file path="components/ui/input-otp.tsx">
'use client'

import * as React from 'react'
import { OTPInput, OTPInputContext } from 'input-otp'
import { MinusIcon } from 'lucide-react'

import { cn } from '@/lib/utils'

function InputOTP({
  className,
  containerClassName,
  ...props
}: React.ComponentProps<typeof OTPInput> & {
  containerClassName?: string
}) {
  return (
    <OTPInput
      data-slot="input-otp"
      containerClassName={cn(
        'flex items-center gap-2 has-disabled:opacity-50',
        containerClassName,
      )}
      className={cn('disabled:cursor-not-allowed', className)}
      {...props}
    />
  )
}

function InputOTPGroup({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="input-otp-group"
      className={cn('flex items-center', className)}
      {...props}
    />
  )
}

function InputOTPSlot({
  index,
  className,
  ...props
}: React.ComponentProps<'div'> & {
  index: number
}) {
  const inputOTPContext = React.useContext(OTPInputContext)
  const { char, hasFakeCaret, isActive } = inputOTPContext?.slots[index] ?? {}

  return (
    <div
      data-slot="input-otp-slot"
      data-active={isActive}
      className={cn(
        'data-[active=true]:border-ring data-[active=true]:ring-ring/50 data-[active=true]:aria-invalid:ring-destructive/20 dark:data-[active=true]:aria-invalid:ring-destructive/40 aria-invalid:border-destructive data-[active=true]:aria-invalid:border-destructive dark:bg-input/30 border-input relative flex h-9 w-9 items-center justify-center border-y border-r text-sm shadow-xs transition-all outline-none first:rounded-l-md first:border-l last:rounded-r-md data-[active=true]:z-10 data-[active=true]:ring-[3px]',
        className,
      )}
      {...props}
    >
      {char}
      {hasFakeCaret && (
        <div className="pointer-events-none absolute inset-0 flex items-center justify-center">
          <div className="animate-caret-blink bg-foreground h-4 w-px duration-1000" />
        </div>
      )}
    </div>
  )
}

function InputOTPSeparator({ ...props }: React.ComponentProps<'div'>) {
  return (
    <div data-slot="input-otp-separator" role="separator" {...props}>
      <MinusIcon />
    </div>
  )
}

export { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }
</file>

<file path="components/ui/input.tsx">
import * as React from 'react'

import { cn } from '@/lib/utils'

function Input({ className, type, ...props }: React.ComponentProps<'input'>) {
  return (
    <input
      type={type}
      data-slot="input"
      className={cn(
        'file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm',
        'focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]',
        'aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive',
        className,
      )}
      {...props}
    />
  )
}

export { Input }
</file>

<file path="components/ui/insight-card.tsx">
"use client"

import Link from "next/link"
import Image from "next/image"
import { formatRelativeTime } from "@/lib/format-time"
import { Avatar, AvatarImage, AvatarFallback } from "@/components/ui/avatar"
import { cn } from "@/lib/utils"

type Post = {
  id: string
  title: string
  content?: string | null
  created_at: string
  thumbnail_url?: string | null
  profiles?: {
    full_name?: string | null
    id?: string
    avatar_url?: string | null
  } | null
  board_categories?: {
    name?: string | null
    slug?: string | null
  } | null
}

type InsightCardProps = {
  post: Post
  href: string
  className?: string
  hideCategory?: boolean
}

export function InsightCard({ post, href, className, hideCategory = false }: InsightCardProps) {
  // HTML íƒœê·¸ ì œê±°í•˜ê³  í…ìŠ¤íŠ¸ë§Œ ì¶”ì¶œ
  const getPlainText = (html?: string | null) => {
    if (!html) return ""
    return html.replace(/<[^>]*>/g, "").trim()
  }

  const contentPreview = getPlainText(post.content)
  const categoryName = post.board_categories?.name || "ì¸ì‚¬ì´íŠ¸"

  return (
    <Link href={href} className={cn("block group", className)}>
      <div className="bg-white border border-slate-200 rounded-2xl overflow-hidden hover:shadow-lg hover:border-slate-300 transition-all duration-300">
        <div className="flex flex-col md:flex-row">
          {/* ì¢Œì¸¡: ì½˜í…ì¸  ì˜ì—­ */}
          <div className="flex-1 p-6 md:p-8 flex flex-col justify-between">
            <div>
              {/* íƒœê·¸ ë° ì¹´í…Œê³ ë¦¬ (hideCategoryê°€ falseì¼ ë•Œë§Œ í‘œì‹œ) */}
              {!hideCategory && (
                <div className="flex items-center gap-2 mb-3">
                  <span className="inline-flex items-center px-3 py-1 rounded-full bg-blue-50 text-blue-700 text-xs font-semibold">
                    #{categoryName}
                  </span>
                </div>
              )}

              {/* ì œëª© */}
              <h3 className="text-xl md:text-2xl font-bold text-slate-900 mb-3 leading-tight group-hover:text-blue-600 transition-colors line-clamp-2">
                {post.title}
              </h3>

              {/* ë³¸ë¬¸ ë¯¸ë¦¬ë³´ê¸° (2-3ì¤„) */}
              {contentPreview && (
                <p className="text-slate-600 text-sm md:text-base leading-relaxed line-clamp-3 mb-4">
                  {contentPreview}
                </p>
              )}
            </div>

            {/* ì‘ì„±ì ì •ë³´ */}
            <div className="flex items-center gap-3 pt-4 border-t border-slate-100">
              <Avatar className="h-10 w-10 flex-shrink-0">
                <AvatarImage src={post.profiles?.avatar_url || undefined} />
                <AvatarFallback className="bg-gradient-to-br from-blue-500 to-purple-500 text-white text-sm font-semibold">
                  {(post.profiles?.full_name || "ìµëª…")[0]?.toUpperCase() || "U"}
                </AvatarFallback>
              </Avatar>
              <div className="flex-1 min-w-0">
                <div className="flex items-center gap-2 flex-wrap">
                  <span className="text-sm font-semibold text-slate-900">
                    {post.profiles?.full_name || "ìµëª…"}
                  </span>
                  <span className="text-xs text-slate-400">Â·</span>
                  <span className="text-xs text-slate-400">
                    {formatRelativeTime(post.created_at)}
                  </span>
                </div>
              </div>
            </div>
          </div>

          {/* ìš°ì¸¡: ì¸ë„¤ì¼ ì´ë¯¸ì§€ */}
          {post.thumbnail_url && (
            <div className="relative w-full md:w-64 lg:w-80 h-48 md:h-auto flex-shrink-0">
              <Image
                src={post.thumbnail_url}
                alt={post.title}
                fill
                className="object-cover transition-transform duration-300 group-hover:scale-105"
              />
            </div>
          )}
        </div>
      </div>
    </Link>
  )
}
</file>

<file path="components/ui/item.tsx">
import * as React from 'react'
import { Slot } from '@radix-ui/react-slot'
import { cva, type VariantProps } from 'class-variance-authority'

import { cn } from '@/lib/utils'
import { Separator } from '@/components/ui/separator'

function ItemGroup({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      role="list"
      data-slot="item-group"
      className={cn('group/item-group flex flex-col', className)}
      {...props}
    />
  )
}

function ItemSeparator({
  className,
  ...props
}: React.ComponentProps<typeof Separator>) {
  return (
    <Separator
      data-slot="item-separator"
      orientation="horizontal"
      className={cn('my-0', className)}
      {...props}
    />
  )
}

const itemVariants = cva(
  'group/item flex items-center border border-transparent text-sm rounded-md transition-colors [a&]:hover:bg-accent/50 [a&]:transition-colors duration-100 flex-wrap outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]',
  {
    variants: {
      variant: {
        default: 'bg-transparent',
        outline: 'border-gray-200 dark:border-gray-800',
        muted: 'bg-muted/50',
      },
      size: {
        default: 'p-4 gap-4 ',
        sm: 'py-3 px-4 gap-2.5',
      },
    },
    defaultVariants: {
      variant: 'default',
      size: 'default',
    },
  },
)

function Item({
  className,
  variant = 'default',
  size = 'default',
  asChild = false,
  ...props
}: React.ComponentProps<'div'> &
  VariantProps<typeof itemVariants> & { asChild?: boolean }) {
  const Comp = asChild ? Slot : 'div'
  return (
    <Comp
      data-slot="item"
      data-variant={variant}
      data-size={size}
      className={cn(itemVariants({ variant, size, className }))}
      {...props}
    />
  )
}

const itemMediaVariants = cva(
  'flex shrink-0 items-center justify-center gap-2 group-has-[[data-slot=item-description]]/item:self-start [&_svg]:pointer-events-none group-has-[[data-slot=item-description]]/item:translate-y-0.5',
  {
    variants: {
      variant: {
        default: 'bg-transparent',
        icon: "size-8 border rounded-sm bg-muted [&_svg:not([class*='size-'])]:size-4",
        image:
          'size-10 rounded-sm overflow-hidden [&_img]:size-full [&_img]:object-cover',
      },
    },
    defaultVariants: {
      variant: 'default',
    },
  },
)

function ItemMedia({
  className,
  variant = 'default',
  ...props
}: React.ComponentProps<'div'> & VariantProps<typeof itemMediaVariants>) {
  return (
    <div
      data-slot="item-media"
      data-variant={variant}
      className={cn(itemMediaVariants({ variant, className }))}
      {...props}
    />
  )
}

function ItemContent({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="item-content"
      className={cn(
        'flex flex-1 flex-col gap-1 [&+[data-slot=item-content]]:flex-none',
        className,
      )}
      {...props}
    />
  )
}

function ItemTitle({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="item-title"
      className={cn(
        'flex w-fit items-center gap-2 text-sm leading-snug font-medium',
        className,
      )}
      {...props}
    />
  )
}

function ItemDescription({ className, ...props }: React.ComponentProps<'p'>) {
  return (
    <p
      data-slot="item-description"
      className={cn(
        'text-muted-foreground line-clamp-2 text-sm leading-normal font-normal text-balance',
        '[&>a:hover]:text-primary [&>a]:underline [&>a]:underline-offset-4',
        className,
      )}
      {...props}
    />
  )
}

function ItemActions({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="item-actions"
      className={cn('flex items-center gap-2', className)}
      {...props}
    />
  )
}

function ItemHeader({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="item-header"
      className={cn(
        'flex basis-full items-center justify-between gap-2',
        className,
      )}
      {...props}
    />
  )
}

function ItemFooter({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="item-footer"
      className={cn(
        'flex basis-full items-center justify-between gap-2',
        className,
      )}
      {...props}
    />
  )
}

export {
  Item,
  ItemMedia,
  ItemContent,
  ItemActions,
  ItemGroup,
  ItemSeparator,
  ItemTitle,
  ItemDescription,
  ItemHeader,
  ItemFooter,
}
</file>

<file path="components/ui/kbd.tsx">
import { cn } from '@/lib/utils'

function Kbd({ className, ...props }: React.ComponentProps<'kbd'>) {
  return (
    <kbd
      data-slot="kbd"
      className={cn(
        'bg-muted w-fit text-muted-foreground pointer-events-none inline-flex h-5 min-w-5 items-center justify-center gap-1 rounded-sm px-1 font-sans text-xs font-medium select-none',
        "[&_svg:not([class*='size-'])]:size-3",
        '[[data-slot=tooltip-content]_&]:bg-background/20 [[data-slot=tooltip-content]_&]:text-background dark:[[data-slot=tooltip-content]_&]:bg-background/10',
        className,
      )}
      {...props}
    />
  )
}

function KbdGroup({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <kbd
      data-slot="kbd-group"
      className={cn('inline-flex items-center gap-1', className)}
      {...props}
    />
  )
}

export { Kbd, KbdGroup }
</file>

<file path="components/ui/label.tsx">
'use client'

import * as React from 'react'
import * as LabelPrimitive from '@radix-ui/react-label'

import { cn } from '@/lib/utils'

function Label({
  className,
  ...props
}: React.ComponentProps<typeof LabelPrimitive.Root>) {
  return (
    <LabelPrimitive.Root
      data-slot="label"
      className={cn(
        'flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50',
        className,
      )}
      {...props}
    />
  )
}

export { Label }
</file>

<file path="components/ui/menubar.tsx">
'use client'

import * as React from 'react'
import * as MenubarPrimitive from '@radix-ui/react-menubar'
import { CheckIcon, ChevronRightIcon, CircleIcon } from 'lucide-react'

import { cn } from '@/lib/utils'

function Menubar({
  className,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Root>) {
  return (
    <MenubarPrimitive.Root
      data-slot="menubar"
      className={cn(
        'bg-background flex h-9 items-center gap-1 rounded-md border p-1 shadow-xs',
        className,
      )}
      {...props}
    />
  )
}

function MenubarMenu({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {
  return <MenubarPrimitive.Menu data-slot="menubar-menu" {...props} />
}

function MenubarGroup({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Group>) {
  return <MenubarPrimitive.Group data-slot="menubar-group" {...props} />
}

function MenubarPortal({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {
  return <MenubarPrimitive.Portal data-slot="menubar-portal" {...props} />
}

function MenubarRadioGroup({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {
  return (
    <MenubarPrimitive.RadioGroup data-slot="menubar-radio-group" {...props} />
  )
}

function MenubarTrigger({
  className,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Trigger>) {
  return (
    <MenubarPrimitive.Trigger
      data-slot="menubar-trigger"
      className={cn(
        'focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground flex items-center rounded-sm px-2 py-1 text-sm font-medium outline-hidden select-none',
        className,
      )}
      {...props}
    />
  )
}

function MenubarContent({
  className,
  align = 'start',
  alignOffset = -4,
  sideOffset = 8,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Content>) {
  return (
    <MenubarPortal>
      <MenubarPrimitive.Content
        data-slot="menubar-content"
        align={align}
        alignOffset={alignOffset}
        sideOffset={sideOffset}
        className={cn(
          'bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 min-w-[12rem] origin-[var(--radix-menubar-content-transform-origin)] overflow-hidden rounded-md border p-1 shadow-md',
          className,
        )}
        {...props}
      />
    </MenubarPortal>
  )
}

function MenubarItem({
  className,
  inset,
  variant = 'default',
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Item> & {
  inset?: boolean
  variant?: 'default' | 'destructive'
}) {
  return (
    <MenubarPrimitive.Item
      data-slot="menubar-item"
      data-inset={inset}
      data-variant={variant}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    />
  )
}

function MenubarCheckboxItem({
  className,
  children,
  checked,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.CheckboxItem>) {
  return (
    <MenubarPrimitive.CheckboxItem
      data-slot="menubar-checkbox-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-xs py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      checked={checked}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <MenubarPrimitive.ItemIndicator>
          <CheckIcon className="size-4" />
        </MenubarPrimitive.ItemIndicator>
      </span>
      {children}
    </MenubarPrimitive.CheckboxItem>
  )
}

function MenubarRadioItem({
  className,
  children,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.RadioItem>) {
  return (
    <MenubarPrimitive.RadioItem
      data-slot="menubar-radio-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-xs py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <MenubarPrimitive.ItemIndicator>
          <CircleIcon className="size-2 fill-current" />
        </MenubarPrimitive.ItemIndicator>
      </span>
      {children}
    </MenubarPrimitive.RadioItem>
  )
}

function MenubarLabel({
  className,
  inset,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Label> & {
  inset?: boolean
}) {
  return (
    <MenubarPrimitive.Label
      data-slot="menubar-label"
      data-inset={inset}
      className={cn(
        'px-2 py-1.5 text-sm font-medium data-[inset]:pl-8',
        className,
      )}
      {...props}
    />
  )
}

function MenubarSeparator({
  className,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Separator>) {
  return (
    <MenubarPrimitive.Separator
      data-slot="menubar-separator"
      className={cn('bg-border -mx-1 my-1 h-px', className)}
      {...props}
    />
  )
}

function MenubarShortcut({
  className,
  ...props
}: React.ComponentProps<'span'>) {
  return (
    <span
      data-slot="menubar-shortcut"
      className={cn(
        'text-muted-foreground ml-auto text-xs tracking-widest',
        className,
      )}
      {...props}
    />
  )
}

function MenubarSub({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {
  return <MenubarPrimitive.Sub data-slot="menubar-sub" {...props} />
}

function MenubarSubTrigger({
  className,
  inset,
  children,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.SubTrigger> & {
  inset?: boolean
}) {
  return (
    <MenubarPrimitive.SubTrigger
      data-slot="menubar-sub-trigger"
      data-inset={inset}
      className={cn(
        'focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground flex cursor-default items-center rounded-sm px-2 py-1.5 text-sm outline-none select-none data-[inset]:pl-8',
        className,
      )}
      {...props}
    >
      {children}
      <ChevronRightIcon className="ml-auto h-4 w-4" />
    </MenubarPrimitive.SubTrigger>
  )
}

function MenubarSubContent({
  className,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.SubContent>) {
  return (
    <MenubarPrimitive.SubContent
      data-slot="menubar-sub-content"
      className={cn(
        'bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 min-w-[8rem] origin-[var(--radix-menubar-content-transform-origin)] overflow-hidden rounded-md border p-1 shadow-lg',
        className,
      )}
      {...props}
    />
  )
}

export {
  Menubar,
  MenubarPortal,
  MenubarMenu,
  MenubarTrigger,
  MenubarContent,
  MenubarGroup,
  MenubarSeparator,
  MenubarLabel,
  MenubarItem,
  MenubarShortcut,
  MenubarCheckboxItem,
  MenubarRadioGroup,
  MenubarRadioItem,
  MenubarSub,
  MenubarSubTrigger,
  MenubarSubContent,
}
</file>

<file path="components/ui/navigation-menu.tsx">
import * as React from 'react'
import * as NavigationMenuPrimitive from '@radix-ui/react-navigation-menu'
import { cva } from 'class-variance-authority'
import { ChevronDownIcon } from 'lucide-react'

import { cn } from '@/lib/utils'

function NavigationMenu({
  className,
  children,
  viewport = true,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Root> & {
  viewport?: boolean
}) {
  return (
    <NavigationMenuPrimitive.Root
      data-slot="navigation-menu"
      data-viewport={viewport}
      className={cn(
        'group/navigation-menu relative flex max-w-max flex-1 items-center justify-center',
        className,
      )}
      {...props}
    >
      {children}
      {viewport && <NavigationMenuViewport />}
    </NavigationMenuPrimitive.Root>
  )
}

function NavigationMenuList({
  className,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.List>) {
  return (
    <NavigationMenuPrimitive.List
      data-slot="navigation-menu-list"
      className={cn(
        'group flex flex-1 list-none items-center justify-center gap-1',
        className,
      )}
      {...props}
    />
  )
}

function NavigationMenuItem({
  className,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Item>) {
  return (
    <NavigationMenuPrimitive.Item
      data-slot="navigation-menu-item"
      className={cn('relative', className)}
      {...props}
    />
  )
}

const navigationMenuTriggerStyle = cva(
  'group inline-flex h-9 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground disabled:pointer-events-none disabled:opacity-50 data-[state=open]:hover:bg-accent data-[state=open]:text-accent-foreground data-[state=open]:focus:bg-accent data-[state=open]:bg-accent/50 focus-visible:ring-ring/50 outline-none transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1',
)

function NavigationMenuTrigger({
  className,
  children,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Trigger>) {
  return (
    <NavigationMenuPrimitive.Trigger
      data-slot="navigation-menu-trigger"
      className={cn(navigationMenuTriggerStyle(), 'group', className)}
      {...props}
    >
      {children}{' '}
      <ChevronDownIcon
        className="relative top-[1px] ml-1 size-3 transition duration-300 group-data-[state=open]:rotate-180"
        aria-hidden="true"
      />
    </NavigationMenuPrimitive.Trigger>
  )
}

function NavigationMenuContent({
  className,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Content>) {
  return (
    <NavigationMenuPrimitive.Content
      data-slot="navigation-menu-content"
      className={cn(
        'data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 top-0 left-0 w-full p-2 pr-2.5 md:absolute md:w-auto',
        'group-data-[viewport=false]/navigation-menu:bg-popover group-data-[viewport=false]/navigation-menu:text-popover-foreground group-data-[viewport=false]/navigation-menu:data-[state=open]:animate-in group-data-[viewport=false]/navigation-menu:data-[state=closed]:animate-out group-data-[viewport=false]/navigation-menu:data-[state=closed]:zoom-out-95 group-data-[viewport=false]/navigation-menu:data-[state=open]:zoom-in-95 group-data-[viewport=false]/navigation-menu:data-[state=open]:fade-in-0 group-data-[viewport=false]/navigation-menu:data-[state=closed]:fade-out-0 group-data-[viewport=false]/navigation-menu:top-full group-data-[viewport=false]/navigation-menu:mt-1.5 group-data-[viewport=false]/navigation-menu:overflow-hidden group-data-[viewport=false]/navigation-menu:rounded-md group-data-[viewport=false]/navigation-menu:border group-data-[viewport=false]/navigation-menu:shadow group-data-[viewport=false]/navigation-menu:duration-200 **:data-[slot=navigation-menu-link]:focus:ring-0 **:data-[slot=navigation-menu-link]:focus:outline-none',
        className,
      )}
      {...props}
    />
  )
}

function NavigationMenuViewport({
  className,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Viewport>) {
  return (
    <div
      className={'absolute top-full left-0 isolate z-50 flex justify-center'}
    >
      <NavigationMenuPrimitive.Viewport
        data-slot="navigation-menu-viewport"
        className={cn(
          'origin-top-center bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border shadow md:w-[var(--radix-navigation-menu-viewport-width)]',
          className,
        )}
        {...props}
      />
    </div>
  )
}

function NavigationMenuLink({
  className,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Link>) {
  return (
    <NavigationMenuPrimitive.Link
      data-slot="navigation-menu-link"
      className={cn(
        "data-[active=true]:focus:bg-accent data-[active=true]:hover:bg-accent data-[active=true]:bg-accent/50 data-[active=true]:text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus-visible:ring-ring/50 [&_svg:not([class*='text-'])]:text-muted-foreground flex flex-col gap-1 rounded-sm p-2 text-sm transition-all outline-none focus-visible:ring-[3px] focus-visible:outline-1 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    />
  )
}

function NavigationMenuIndicator({
  className,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Indicator>) {
  return (
    <NavigationMenuPrimitive.Indicator
      data-slot="navigation-menu-indicator"
      className={cn(
        'data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden',
        className,
      )}
      {...props}
    >
      <div className="bg-border relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm shadow-md" />
    </NavigationMenuPrimitive.Indicator>
  )
}

export {
  NavigationMenu,
  NavigationMenuList,
  NavigationMenuItem,
  NavigationMenuContent,
  NavigationMenuTrigger,
  NavigationMenuLink,
  NavigationMenuIndicator,
  NavigationMenuViewport,
  navigationMenuTriggerStyle,
}
</file>

<file path="components/ui/pagination.tsx">
import * as React from 'react'
import {
  ChevronLeftIcon,
  ChevronRightIcon,
  MoreHorizontalIcon,
} from 'lucide-react'

import { cn } from '@/lib/utils'
import { Button, buttonVariants } from '@/components/ui/button'

function Pagination({ className, ...props }: React.ComponentProps<'nav'>) {
  return (
    <nav
      role="navigation"
      aria-label="pagination"
      data-slot="pagination"
      className={cn('mx-auto flex w-full justify-center', className)}
      {...props}
    />
  )
}

function PaginationContent({
  className,
  ...props
}: React.ComponentProps<'ul'>) {
  return (
    <ul
      data-slot="pagination-content"
      className={cn('flex flex-row items-center gap-1', className)}
      {...props}
    />
  )
}

function PaginationItem({ ...props }: React.ComponentProps<'li'>) {
  return <li data-slot="pagination-item" {...props} />
}

type PaginationLinkProps = {
  isActive?: boolean
} & Pick<React.ComponentProps<typeof Button>, 'size'> &
  React.ComponentProps<'a'>

function PaginationLink({
  className,
  isActive,
  size = 'icon',
  ...props
}: PaginationLinkProps) {
  return (
    <a
      aria-current={isActive ? 'page' : undefined}
      data-slot="pagination-link"
      data-active={isActive}
      className={cn(
        buttonVariants({
          variant: isActive ? 'outline' : 'ghost',
          size,
        }),
        className,
      )}
      {...props}
    />
  )
}

function PaginationPrevious({
  className,
  ...props
}: React.ComponentProps<typeof PaginationLink>) {
  return (
    <PaginationLink
      aria-label="Go to previous page"
      size="default"
      className={cn('gap-1 px-2.5 sm:pl-2.5', className)}
      {...props}
    >
      <ChevronLeftIcon />
      <span className="hidden sm:block">Previous</span>
    </PaginationLink>
  )
}

function PaginationNext({
  className,
  ...props
}: React.ComponentProps<typeof PaginationLink>) {
  return (
    <PaginationLink
      aria-label="Go to next page"
      size="default"
      className={cn('gap-1 px-2.5 sm:pr-2.5', className)}
      {...props}
    >
      <span className="hidden sm:block">Next</span>
      <ChevronRightIcon />
    </PaginationLink>
  )
}

function PaginationEllipsis({
  className,
  ...props
}: React.ComponentProps<'span'>) {
  return (
    <span
      aria-hidden
      data-slot="pagination-ellipsis"
      className={cn('flex size-9 items-center justify-center', className)}
      {...props}
    >
      <MoreHorizontalIcon className="size-4" />
      <span className="sr-only">More pages</span>
    </span>
  )
}

export {
  Pagination,
  PaginationContent,
  PaginationLink,
  PaginationItem,
  PaginationPrevious,
  PaginationNext,
  PaginationEllipsis,
}
</file>

<file path="components/ui/popover.tsx">
'use client'

import * as React from 'react'
import * as PopoverPrimitive from '@radix-ui/react-popover'

import { cn } from '@/lib/utils'

function Popover({
  ...props
}: React.ComponentProps<typeof PopoverPrimitive.Root>) {
  return <PopoverPrimitive.Root data-slot="popover" {...props} />
}

function PopoverTrigger({
  ...props
}: React.ComponentProps<typeof PopoverPrimitive.Trigger>) {
  return <PopoverPrimitive.Trigger data-slot="popover-trigger" {...props} />
}

function PopoverContent({
  className,
  align = 'center',
  sideOffset = 4,
  ...props
}: React.ComponentProps<typeof PopoverPrimitive.Content>) {
  return (
    <PopoverPrimitive.Portal>
      <PopoverPrimitive.Content
        data-slot="popover-content"
        align={align}
        sideOffset={sideOffset}
        className={cn(
          'bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-[var(--radix-popover-content-transform-origin)] rounded-md border p-4 shadow-md outline-hidden',
          className,
        )}
        {...props}
      />
    </PopoverPrimitive.Portal>
  )
}

function PopoverAnchor({
  ...props
}: React.ComponentProps<typeof PopoverPrimitive.Anchor>) {
  return <PopoverPrimitive.Anchor data-slot="popover-anchor" {...props} />
}

export { Popover, PopoverTrigger, PopoverContent, PopoverAnchor }
</file>

<file path="components/ui/post-list-item.tsx">
"use client"

import Link from "next/link"
import { MessageSquare, Lock } from "lucide-react"
import { cn } from "@/lib/utils"
import { formatRelativeTime } from "@/lib/format-time"
import { Avatar, AvatarImage, AvatarFallback } from "@/components/ui/avatar"
import Image from "next/image"
import { useRouter } from "next/navigation"

type Badge = {
  icon: string
  name: string
}

type Post = {
  id: string
  title: string
  content?: string | null
  created_at: string
  visibility?: "public" | "group"
  comments_count?: number
  thumbnail_url?: string | null
  board_categories?: {
    name?: string | null
    slug?: string | null
  } | null
  profiles?: {
    full_name?: string | null
    id?: string
    avatar_url?: string | null
  } | null
  visible_badges?: Badge[]
  communities?: {
    name?: string | null
  } | null
  isMember?: boolean
  post_images?: Array<{
    id: string
    image_url: string
    sort_order: number
  }>
}

type PostListItemProps = {
  post: Post
  href: string
  className?: string
  isMember?: boolean
  viewMode?: "feed" | "list"
  hideCategory?: boolean
}

export function PostListItem({
  post,
  href,
  className,
  isMember = true,
  viewMode = "feed",
  hideCategory = false
}: PostListItemProps) {
  const router = useRouter()

  // contentì—ì„œ HTML íƒœê·¸ ì œê±°í•˜ê³  í…ìŠ¤íŠ¸ë§Œ ì¶”ì¶œ (ë¯¸ë¦¬ë³´ê¸°ìš©)
  const getPlainText = (html?: string | null) => {
    if (!html) return ""
    // ì •ê·œì‹ ì´ìŠ¤ì¼€ì´í”„ ì²˜ë¦¬
    return html.replace(/<[^>]*>/g, "").trim()
  }

  const contentPreview = getPlainText(post.content)
  // ì¹´í…Œê³ ë¦¬ ì´ë¦„ í‘œì‹œ (hideCategoryê°€ trueì´ê±°ë‚˜, ììœ ê²Œì‹œíŒ/ë°˜ê³¨/í•˜ì´í† í¬ì¸ ê²½ìš° ìˆ¨ê¹€)
  const boardSlug = post.board_categories?.slug
  const categoryName = hideCategory
    ? null
    : (boardSlug === "free-board" || boardSlug === "free" || boardSlug === "vangol" || boardSlug === "hightalk")
      ? null
      : (post.board_categories?.name || post.communities?.name || "ê²Œì‹œíŒ")
  const isGroupOnly = post.visibility === "group" && !isMember

  // ëŒ€í‘œ ë±ƒì§€ (ì²« ë²ˆì§¸ ë±ƒì§€ë§Œ)
  const primaryBadge = post.visible_badges && post.visible_badges.length > 0 ? post.visible_badges[0] : null

  // ë¦¬ìŠ¤íŠ¸í˜• ë·° (ë°€ë„ ë†’ì€ ì„¸ë ¨ëœ ë””ìì¸)
  if (viewMode === "list") {
    return (
      <div
        className={cn("block w-full group cursor-pointer", className)}
        onClick={() => {
          window.scrollTo(0, 0)
          router.push(href)
        }}
      >
        {/* íŒ¨ë”© ì¶•ì†Œ: py-2.5 -> py-2, hover íš¨ê³¼ ê°œì„  */}
        <div className="flex items-center gap-3 py-2 pl-4 pr-4 bg-white border-b border-slate-100 group-hover:bg-slate-50/80 transition-colors duration-150">

          {/* ì¹´í…Œê³ ë¦¬ ë±ƒì§€ (í¬ê¸° ë° í°íŠ¸ ë¯¸ì„¸ ì¡°ì •) - ììœ ê²Œì‹œíŒ ì œì™¸ */}
          {categoryName && (
            <span className="bg-slate-100 text-slate-600 rounded-md px-2 py-0.5 text-[11px] font-medium flex-shrink-0 w-16 text-center">
              {categoryName}
            </span>
          )}

          {/* ì œëª© ë° ë‚´ìš© */}
          <div className="flex-1 min-w-0 flex items-center gap-2">
            {/* ì œëª© */}
            <h3 className="text-[15px] font-medium text-slate-900 truncate group-hover:text-blue-600 transition-colors">
              {post.title}
            </h3>
          </div>

          {/* ë°ìŠ¤í¬íƒ‘ ì •ë³´ (ìš°ì¸¡ ì •ë ¬, ê³ ì • ë„ˆë¹„) */}
          <div className="hidden sm:flex items-center gap-4 text-xs text-slate-400 flex-shrink-0">
            <span className="text-slate-500 w-24 text-left truncate">{post.profiles?.full_name || "ìµëª…"}</span>
            <span className="w-20 text-right whitespace-nowrap">{formatRelativeTime(post.created_at)}</span>

            {/* ëŒ“ê¸€ ì•„ì´ì½˜ ì˜ì—­ (í´ë¦­ ì‹œ ìƒì„¸ í˜ì´ì§€ ì´ë™) */}
            <div
              className="flex items-center justify-center w-12 flex-shrink-0 cursor-pointer hover:bg-slate-100 rounded-full p-1"
              onClick={(e) => {
                e.stopPropagation()
                window.scrollTo(0, 0)
                router.push(href)
              }}
            >
              {(post.comments_count || 0) > 0 ? (
                <div className="flex items-center gap-0.5 text-blue-500">
                  <MessageSquare className="h-3 w-3 fill-current" />
                  <span>{post.comments_count}</span>
                </div>
              ) : (
                <div className="flex items-center gap-0.5 text-slate-300">
                  <MessageSquare className="h-3 w-3" />
                  <span className="text-slate-300">0</span>
                </div>
              )}
            </div>
          </div>

          {/* ëª¨ë°”ì¼ ì •ë³´ (ì•„ì´ì½˜ë§Œ ê°„ëµíˆ, ê³ ì • ìœ„ì¹˜) */}
          <div className="flex sm:hidden items-center gap-2 text-xs text-slate-400 flex-shrink-0">
            {/* ëŒ“ê¸€ ì•„ì´ì½˜ ì˜ì—­ (í´ë¦­ ì‹œ ìƒì„¸ í˜ì´ì§€ ì´ë™) */}
            <div
              className="flex items-center justify-center w-10 flex-shrink-0 cursor-pointer"
              onClick={(e) => {
                e.stopPropagation()
                window.scrollTo(0, 0)
                router.push(href)
              }}
            >
              {(post.comments_count || 0) > 0 ? (
                <div className="flex items-center gap-0.5 text-blue-500">
                  <MessageSquare className="h-3 w-3 fill-current" />
                  <span>{post.comments_count}</span>
                </div>
              ) : (
                <div className="flex items-center gap-0.5 text-slate-300">
                  <MessageSquare className="h-3 w-3" />
                </div>
              )}
            </div>
          </div>
        </div>
      </div>
    )
  }

  // í”¼ë“œí˜• ë·° (ì¹´ë“œí˜• ë§í¬, ë‹¨ìˆœí™”)
  return (
    <Link href={href} className={cn("block", className)}>
      <div
        className={cn(
          "flex flex-col bg-white rounded-2xl overflow-hidden border border-slate-100 shadow-sm transition-all duration-300 hover:shadow-md hover:border-slate-300 hover:-translate-y-0.5",
          className
        )}
      >
        {/* ì¸ë„¤ì¼ ì´ë¯¸ì§€ (í”¼ë“œí˜• ë·°ì—ì„œë§Œ í‘œì‹œ) */}
        {post.thumbnail_url && (
          <div className="relative w-full aspect-[2/1] md:aspect-[21/9] overflow-hidden">
            <Image
              src={post.thumbnail_url}
              alt={post.title}
              fill
              className="object-cover transition-transform duration-300 hover:scale-105"
            />
          </div>
        )}
        <div className="p-5">
          {/* í—¤ë”: ì‘ì„±ì ì•„ë°”íƒ€ + ë©”íƒ€ ì •ë³´ */}
          <div className="flex items-center gap-3 mb-4">
            <Avatar className="h-8 w-8 flex-shrink-0">
              <AvatarImage src={post.profiles?.avatar_url || undefined} />
              <AvatarFallback className="bg-gradient-to-br from-blue-500 to-purple-500 text-white text-xs font-semibold">
                {(post.profiles?.full_name || "ìµëª…")[0]?.toUpperCase() || "U"}
              </AvatarFallback>
            </Avatar>
            <div className="flex-1 min-w-0">
              <div className="flex items-center gap-2 flex-wrap">
                <span className="text-sm font-semibold text-slate-900">{post.profiles?.full_name || "ìµëª…"}</span>
                {primaryBadge && (
                  <span className="inline-flex items-center gap-1 bg-slate-100 text-slate-700 rounded px-1.5 py-0.5 text-xs">
                    <span>{primaryBadge.icon}</span>
                    <span>{primaryBadge.name}</span>
                  </span>
                )}
                {categoryName && (
                  <>
                    <span className="bg-blue-50 text-blue-600 rounded-full px-2 py-0.5 text-xs font-bold">
                      {categoryName}
                    </span>
                    <span className="text-xs text-slate-400">Â·</span>
                  </>
                )}
                <span className="text-xs text-slate-400">{formatRelativeTime(post.created_at)}</span>
              </div>
            </div>
          </div>

          {/* ë³¸ë¬¸ ì˜ì—­ */}
          <div className="mb-4 relative">
            {/* ì œëª© */}
            <h3 className="text-lg font-bold tracking-tight text-slate-900 mb-2.5 leading-snug hover:text-blue-600 transition-colors">
              {post.title}
            </h3>

            {/* ë‚´ìš© ë¯¸ë¦¬ë³´ê¸° */}
            <div className="relative">
              <p className={cn(
                "text-slate-600 leading-relaxed line-clamp-3",
                isGroupOnly ? "blur-sm select-none" : ""
              )}>
                {contentPreview}
              </p>

              {/* ê·¸ë¼ë°ì´ì…˜ ë§ˆìŠ¤í¬ (ë” ì½ìœ¼ë ¤ë©´ ëˆ„ë¥´ì„¸ìš” ë‰˜ì•™ìŠ¤) */}
              {!isGroupOnly && contentPreview.length > 150 && (
                <div className="absolute bottom-0 left-0 right-0 h-12 bg-gradient-to-t from-white via-white/80 to-transparent pointer-events-none" />
              )}

              {isGroupOnly && (
                <div className="absolute inset-0 flex items-center justify-center bg-white/60 backdrop-blur-[1px] rounded-lg">
                  <div className="flex flex-col items-center gap-2 text-center px-4">
                    <Lock className="h-5 w-5 text-slate-400" />
                    <p className="text-sm font-medium text-slate-700">ë©¤ë²„ ì „ìš© ê¸€ì…ë‹ˆë‹¤</p>
                  </div>
                </div>
              )}
            </div>
          </div>

          {/* í‘¸í„° (ì•¡ì…˜ ë²„íŠ¼) */}
          <div className="flex items-center gap-4 pt-2">
            {/* ëŒ“ê¸€ ì •ë³´ í‘œì‹œ (ë§í¬ ì—†ìŒ, ì¹´ë“œ í´ë¦­ ì‹œ ì´ë™) */}
            <div className="flex items-center gap-1.5 text-sm text-slate-600 px-3 py-1.5 rounded-lg">
              <MessageSquare className="h-4 w-4" />
              <span className="font-medium">{post.comments_count || 0}</span>
            </div>
          </div>
        </div>
      </div>
    </Link>
  )
}
</file>

<file path="components/ui/progress.tsx">
'use client'

import * as React from 'react'
import * as ProgressPrimitive from '@radix-ui/react-progress'

import { cn } from '@/lib/utils'

function Progress({
  className,
  value,
  ...props
}: React.ComponentProps<typeof ProgressPrimitive.Root>) {
  return (
    <ProgressPrimitive.Root
      data-slot="progress"
      className={cn(
        'bg-primary/20 relative h-2 w-full overflow-hidden rounded-full',
        className,
      )}
      {...props}
    >
      <ProgressPrimitive.Indicator
        data-slot="progress-indicator"
        className="bg-primary h-full w-full flex-1 transition-all"
        style={{ transform: `translateX(-${100 - (value || 0)}%)` }}
      />
    </ProgressPrimitive.Root>
  )
}

export { Progress }
</file>

<file path="components/ui/radio-group.tsx">
'use client'

import * as React from 'react'
import * as RadioGroupPrimitive from '@radix-ui/react-radio-group'
import { CircleIcon } from 'lucide-react'

import { cn } from '@/lib/utils'

function RadioGroup({
  className,
  ...props
}: React.ComponentProps<typeof RadioGroupPrimitive.Root>) {
  return (
    <RadioGroupPrimitive.Root
      data-slot="radio-group"
      className={cn('grid gap-3', className)}
      {...props}
    />
  )
}

function RadioGroupItem({
  className,
  ...props
}: React.ComponentProps<typeof RadioGroupPrimitive.Item>) {
  return (
    <RadioGroupPrimitive.Item
      data-slot="radio-group-item"
      className={cn(
        'border-input text-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 aspect-square size-4 shrink-0 rounded-full border shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50',
        className,
      )}
      {...props}
    >
      <RadioGroupPrimitive.Indicator
        data-slot="radio-group-indicator"
        className="relative flex items-center justify-center"
      >
        <CircleIcon className="fill-primary absolute top-1/2 left-1/2 size-2 -translate-x-1/2 -translate-y-1/2" />
      </RadioGroupPrimitive.Indicator>
    </RadioGroupPrimitive.Item>
  )
}

export { RadioGroup, RadioGroupItem }
</file>

<file path="components/ui/resizable.tsx">
'use client'

import * as React from 'react'
import { GripVerticalIcon } from 'lucide-react'
import * as ResizablePrimitive from 'react-resizable-panels'

import { cn } from '@/lib/utils'

function ResizablePanelGroup({
  className,
  ...props
}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) {
  return (
    <ResizablePrimitive.PanelGroup
      data-slot="resizable-panel-group"
      className={cn(
        'flex h-full w-full data-[panel-group-direction=vertical]:flex-col',
        className,
      )}
      {...props}
    />
  )
}

function ResizablePanel({
  ...props
}: React.ComponentProps<typeof ResizablePrimitive.Panel>) {
  return <ResizablePrimitive.Panel data-slot="resizable-panel" {...props} />
}

function ResizableHandle({
  withHandle,
  className,
  ...props
}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {
  withHandle?: boolean
}) {
  return (
    <ResizablePrimitive.PanelResizeHandle
      data-slot="resizable-handle"
      className={cn(
        'bg-border focus-visible:ring-ring relative flex w-px items-center justify-center after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:ring-1 focus-visible:ring-offset-1 focus-visible:outline-hidden data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:translate-x-0 data-[panel-group-direction=vertical]:after:-translate-y-1/2 [&[data-panel-group-direction=vertical]>div]:rotate-90',
        className,
      )}
      {...props}
    >
      {withHandle && (
        <div className="bg-border z-10 flex h-4 w-3 items-center justify-center rounded-xs border">
          <GripVerticalIcon className="size-2.5" />
        </div>
      )}
    </ResizablePrimitive.PanelResizeHandle>
  )
}

export { ResizablePanelGroup, ResizablePanel, ResizableHandle }
</file>

<file path="components/ui/scroll-area.tsx">
'use client'

import * as React from 'react'
import * as ScrollAreaPrimitive from '@radix-ui/react-scroll-area'

import { cn } from '@/lib/utils'

function ScrollArea({
  className,
  children,
  ...props
}: React.ComponentProps<typeof ScrollAreaPrimitive.Root>) {
  return (
    <ScrollAreaPrimitive.Root
      data-slot="scroll-area"
      className={cn('relative', className)}
      {...props}
    >
      <ScrollAreaPrimitive.Viewport
        data-slot="scroll-area-viewport"
        className="focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1"
      >
        {children}
      </ScrollAreaPrimitive.Viewport>
      <ScrollBar />
      <ScrollAreaPrimitive.Corner />
    </ScrollAreaPrimitive.Root>
  )
}

function ScrollBar({
  className,
  orientation = 'vertical',
  ...props
}: React.ComponentProps<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>) {
  return (
    <ScrollAreaPrimitive.ScrollAreaScrollbar
      data-slot="scroll-area-scrollbar"
      orientation={orientation}
      className={cn(
        'flex touch-none p-px transition-colors select-none',
        orientation === 'vertical' &&
          'h-full w-2.5 border-l border-l-transparent',
        orientation === 'horizontal' &&
          'h-2.5 flex-col border-t border-t-transparent',
        className,
      )}
      {...props}
    >
      <ScrollAreaPrimitive.ScrollAreaThumb
        data-slot="scroll-area-thumb"
        className="bg-border relative flex-1 rounded-full"
      />
    </ScrollAreaPrimitive.ScrollAreaScrollbar>
  )
}

export { ScrollArea, ScrollBar }
</file>

<file path="components/ui/select.tsx">
'use client'

import * as React from 'react'
import * as SelectPrimitive from '@radix-ui/react-select'
import { CheckIcon, ChevronDownIcon, ChevronUpIcon } from 'lucide-react'

import { cn } from '@/lib/utils'

function Select({
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Root>) {
  return <SelectPrimitive.Root data-slot="select" {...props} />
}

function SelectGroup({
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Group>) {
  return <SelectPrimitive.Group data-slot="select-group" {...props} />
}

function SelectValue({
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Value>) {
  return <SelectPrimitive.Value data-slot="select-value" {...props} />
}

function SelectTrigger({
  className,
  size = 'default',
  children,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Trigger> & {
  size?: 'sm' | 'default'
}) {
  return (
    <SelectPrimitive.Trigger
      data-slot="select-trigger"
      data-size={size}
      className={cn(
        "border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    >
      {children}
      <SelectPrimitive.Icon asChild>
        <ChevronDownIcon className="size-4 opacity-50" />
      </SelectPrimitive.Icon>
    </SelectPrimitive.Trigger>
  )
}

function SelectContent({
  className,
  children,
  position = 'popper',
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Content>) {
  return (
    <SelectPrimitive.Portal>
      <SelectPrimitive.Content
        data-slot="select-content"
        className={cn(
          'bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-[100] max-h-[var(--radix-select-content-available-height)] min-w-[8rem] origin-[var(--radix-select-content-transform-origin)] overflow-x-hidden overflow-y-auto rounded-md border shadow-md bg-white',
          position === 'popper' &&
            'data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1',
          className,
        )}
        position={position}
        {...props}
      >
        <SelectScrollUpButton />
        <SelectPrimitive.Viewport
          className={cn(
            'p-1',
            position === 'popper' &&
              'h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1',
          )}
        >
          {children}
        </SelectPrimitive.Viewport>
        <SelectScrollDownButton />
      </SelectPrimitive.Content>
    </SelectPrimitive.Portal>
  )
}

function SelectLabel({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Label>) {
  return (
    <SelectPrimitive.Label
      data-slot="select-label"
      className={cn('text-muted-foreground px-2 py-1.5 text-xs', className)}
      {...props}
    />
  )
}

function SelectItem({
  className,
  children,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Item>) {
  return (
    <SelectPrimitive.Item
      data-slot="select-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",
        className,
      )}
      {...props}
    >
      <span className="absolute right-2 flex size-3.5 items-center justify-center">
        <SelectPrimitive.ItemIndicator>
          <CheckIcon className="size-4" />
        </SelectPrimitive.ItemIndicator>
      </span>
      <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>
    </SelectPrimitive.Item>
  )
}

function SelectSeparator({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Separator>) {
  return (
    <SelectPrimitive.Separator
      data-slot="select-separator"
      className={cn('bg-border pointer-events-none -mx-1 my-1 h-px', className)}
      {...props}
    />
  )
}

function SelectScrollUpButton({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.ScrollUpButton>) {
  return (
    <SelectPrimitive.ScrollUpButton
      data-slot="select-scroll-up-button"
      className={cn(
        'flex cursor-default items-center justify-center py-1',
        className,
      )}
      {...props}
    >
      <ChevronUpIcon className="size-4" />
    </SelectPrimitive.ScrollUpButton>
  )
}

function SelectScrollDownButton({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.ScrollDownButton>) {
  return (
    <SelectPrimitive.ScrollDownButton
      data-slot="select-scroll-down-button"
      className={cn(
        'flex cursor-default items-center justify-center py-1',
        className,
      )}
      {...props}
    >
      <ChevronDownIcon className="size-4" />
    </SelectPrimitive.ScrollDownButton>
  )
}

export {
  Select,
  SelectContent,
  SelectGroup,
  SelectItem,
  SelectLabel,
  SelectScrollDownButton,
  SelectScrollUpButton,
  SelectSeparator,
  SelectTrigger,
  SelectValue,
}
</file>

<file path="components/ui/separator.tsx">
'use client'

import * as React from 'react'
import * as SeparatorPrimitive from '@radix-ui/react-separator'

import { cn } from '@/lib/utils'

function Separator({
  className,
  orientation = 'horizontal',
  decorative = true,
  ...props
}: React.ComponentProps<typeof SeparatorPrimitive.Root>) {
  return (
    <SeparatorPrimitive.Root
      data-slot="separator"
      decorative={decorative}
      orientation={orientation}
      className={cn(
        'bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px',
        className,
      )}
      {...props}
    />
  )
}

export { Separator }
</file>

<file path="components/ui/sheet.tsx">
"use client"

import * as React from "react"
import * as SheetPrimitive from "@radix-ui/react-dialog"
import { XIcon } from "lucide-react"

import { cn } from "@/lib/utils"
import { lockBodyScroll, unlockBodyScroll } from "@/lib/utils/scroll-lock"

function Sheet({ ...props }: React.ComponentProps<typeof SheetPrimitive.Root>) {
  return <SheetPrimitive.Root data-slot="sheet" {...props} />
}

function SheetTrigger({ ...props }: React.ComponentProps<typeof SheetPrimitive.Trigger>) {
  return <SheetPrimitive.Trigger data-slot="sheet-trigger" {...props} />
}

function SheetClose({ ...props }: React.ComponentProps<typeof SheetPrimitive.Close>) {
  return <SheetPrimitive.Close data-slot="sheet-close" {...props} />
}

function SheetPortal({ ...props }: React.ComponentProps<typeof SheetPrimitive.Portal>) {
  return <SheetPrimitive.Portal data-slot="sheet-portal" {...props} />
}

function SheetOverlay({ className, ...props }: React.ComponentProps<typeof SheetPrimitive.Overlay>) {
  return (
    <SheetPrimitive.Overlay
      data-slot="sheet-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className,
      )}
      {...props}
    />
  )
}

function SheetContent({
  className,
  children,
  side = "right",
  hideClose,
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Content> & {
  side?: "top" | "right" | "bottom" | "left"
  hideClose?: boolean
}) {
  // ëª¨ë‹¬ì´ ì—´ë¦´ ë•Œì™€ ë‹«í ë•Œ body scroll lock ê´€ë¦¬
  React.useEffect(() => {
    // ëª¨ë‹¬ì´ ì—´ë¦´ ë•Œ body scroll lock
    lockBodyScroll()

    // ëª¨ë‹¬ì´ ë‹«í ë•Œ body scroll unlock
    return () => {
      unlockBodyScroll()
    }
  }, [])

  return (
    <SheetPortal>
      <SheetOverlay />
      <SheetPrimitive.Content
        data-slot="sheet-content"
        className={cn(
          "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out fixed z-50 flex flex-col gap-4 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500",
          side === "right" &&
            "data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right inset-y-0 right-0 h-full w-3/4 border-l sm:max-w-sm",
          side === "left" &&
            "data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left inset-y-0 left-0 h-full w-3/4 border-r sm:max-w-sm",
          side === "top" &&
            "data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top inset-x-0 top-0 h-auto border-b",
          side === "bottom" &&
            "data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom inset-x-0 bottom-0 h-auto border-t",
          className,
        )}
        {...props}
      >
        {children}
        {!hideClose && (
          <SheetPrimitive.Close className="ring-offset-background focus:ring-ring data-[state=open]:bg-secondary absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none">
            <XIcon className="size-4" />
            <span className="sr-only">Close</span>
          </SheetPrimitive.Close>
        )}
      </SheetPrimitive.Content>
    </SheetPortal>
  )
}

function SheetHeader({ className, ...props }: React.ComponentProps<"div">) {
  return <div data-slot="sheet-header" className={cn("flex flex-col gap-1.5 p-4", className)} {...props} />
}

function SheetFooter({ className, ...props }: React.ComponentProps<"div">) {
  return <div data-slot="sheet-footer" className={cn("mt-auto flex flex-col gap-2 p-4", className)} {...props} />
}

function SheetTitle({ className, ...props }: React.ComponentProps<typeof SheetPrimitive.Title>) {
  return (
    <SheetPrimitive.Title
      data-slot="sheet-title"
      className={cn("text-foreground font-semibold", className)}
      {...props}
    />
  )
}

function SheetDescription({ className, ...props }: React.ComponentProps<typeof SheetPrimitive.Description>) {
  return (
    <SheetPrimitive.Description
      data-slot="sheet-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  )
}

export { Sheet, SheetTrigger, SheetClose, SheetContent, SheetHeader, SheetFooter, SheetTitle, SheetDescription }
</file>

<file path="components/ui/sidebar.tsx">
'use client'

import * as React from 'react'
import { Slot } from '@radix-ui/react-slot'
import { cva, VariantProps } from 'class-variance-authority'
import { PanelLeftIcon } from 'lucide-react'

import { useIsMobile } from '@/hooks/use-mobile'
import { cn } from '@/lib/utils'
import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import { Separator } from '@/components/ui/separator'
import {
  Sheet,
  SheetContent,
  SheetDescription,
  SheetHeader,
  SheetTitle,
} from '@/components/ui/sheet'
import { Skeleton } from '@/components/ui/skeleton'
import {
  Tooltip,
  TooltipContent,
  TooltipProvider,
  TooltipTrigger,
} from '@/components/ui/tooltip'

const SIDEBAR_COOKIE_NAME = 'sidebar_state'
const SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7
const SIDEBAR_WIDTH = '16rem'
const SIDEBAR_WIDTH_MOBILE = '18rem'
const SIDEBAR_WIDTH_ICON = '3rem'
const SIDEBAR_KEYBOARD_SHORTCUT = 'b'

type SidebarContextProps = {
  state: 'expanded' | 'collapsed'
  open: boolean
  setOpen: (open: boolean) => void
  openMobile: boolean
  setOpenMobile: (open: boolean) => void
  isMobile: boolean
  toggleSidebar: () => void
}

const SidebarContext = React.createContext<SidebarContextProps | null>(null)

function useSidebar() {
  const context = React.useContext(SidebarContext)
  if (!context) {
    throw new Error('useSidebar must be used within a SidebarProvider.')
  }

  return context
}

function SidebarProvider({
  defaultOpen = true,
  open: openProp,
  onOpenChange: setOpenProp,
  className,
  style,
  children,
  ...props
}: React.ComponentProps<'div'> & {
  defaultOpen?: boolean
  open?: boolean
  onOpenChange?: (open: boolean) => void
}) {
  const isMobile = useIsMobile()
  const [openMobile, setOpenMobile] = React.useState(false)

  // This is the internal state of the sidebar.
  // We use openProp and setOpenProp for control from outside the component.
  const [_open, _setOpen] = React.useState(defaultOpen)
  const open = openProp ?? _open
  const setOpen = React.useCallback(
    (value: boolean | ((value: boolean) => boolean)) => {
      const openState = typeof value === 'function' ? value(open) : value
      if (setOpenProp) {
        setOpenProp(openState)
      } else {
        _setOpen(openState)
      }

      // This sets the cookie to keep the sidebar state.
      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`
    },
    [setOpenProp, open],
  )

  // Helper to toggle the sidebar.
  const toggleSidebar = React.useCallback(() => {
    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)
  }, [isMobile, setOpen, setOpenMobile])

  // Adds a keyboard shortcut to toggle the sidebar.
  React.useEffect(() => {
    const handleKeyDown = (event: KeyboardEvent) => {
      if (
        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&
        (event.metaKey || event.ctrlKey)
      ) {
        event.preventDefault()
        toggleSidebar()
      }
    }

    window.addEventListener('keydown', handleKeyDown)
    return () => window.removeEventListener('keydown', handleKeyDown)
  }, [toggleSidebar])

  // We add a state so that we can do data-state="expanded" or "collapsed".
  // This makes it easier to style the sidebar with Tailwind classes.
  const state = open ? 'expanded' : 'collapsed'

  const contextValue = React.useMemo<SidebarContextProps>(
    () => ({
      state,
      open,
      setOpen,
      isMobile,
      openMobile,
      setOpenMobile,
      toggleSidebar,
    }),
    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar],
  )

  return (
    <SidebarContext.Provider value={contextValue}>
      <TooltipProvider delayDuration={0}>
        <div
          data-slot="sidebar-wrapper"
          style={
            {
              '--sidebar-width': SIDEBAR_WIDTH,
              '--sidebar-width-icon': SIDEBAR_WIDTH_ICON,
              ...style,
            } as React.CSSProperties
          }
          className={cn(
            'group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full',
            className,
          )}
          {...props}
        >
          {children}
        </div>
      </TooltipProvider>
    </SidebarContext.Provider>
  )
}

function Sidebar({
  side = 'left',
  variant = 'sidebar',
  collapsible = 'offcanvas',
  className,
  children,
  ...props
}: React.ComponentProps<'div'> & {
  side?: 'left' | 'right'
  variant?: 'sidebar' | 'floating' | 'inset'
  collapsible?: 'offcanvas' | 'icon' | 'none'
}) {
  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()

  if (collapsible === 'none') {
    return (
      <div
        data-slot="sidebar"
        className={cn(
          'bg-sidebar text-sidebar-foreground flex h-full w-(--sidebar-width) flex-col',
          className,
        )}
        {...props}
      >
        {children}
      </div>
    )
  }

  if (isMobile) {
    return (
      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>
        <SheetContent
          data-sidebar="sidebar"
          data-slot="sidebar"
          data-mobile="true"
          className="bg-sidebar text-sidebar-foreground w-(--sidebar-width) p-0 [&>button]:hidden"
          style={
            {
              '--sidebar-width': SIDEBAR_WIDTH_MOBILE,
            } as React.CSSProperties
          }
          side={side}
        >
          <SheetHeader className="sr-only">
            <SheetTitle>Sidebar</SheetTitle>
            <SheetDescription>Displays the mobile sidebar.</SheetDescription>
          </SheetHeader>
          <div className="flex h-full w-full flex-col">{children}</div>
        </SheetContent>
      </Sheet>
    )
  }

  return (
    <div
      className="group peer text-sidebar-foreground hidden md:block"
      data-state={state}
      data-collapsible={state === 'collapsed' ? collapsible : ''}
      data-variant={variant}
      data-side={side}
      data-slot="sidebar"
    >
      {/* This is what handles the sidebar gap on desktop */}
      <div
        data-slot="sidebar-gap"
        className={cn(
          'relative w-(--sidebar-width) bg-transparent transition-[width] duration-200 ease-linear',
          'group-data-[collapsible=offcanvas]:w-0',
          'group-data-[side=right]:rotate-180',
          variant === 'floating' || variant === 'inset'
            ? 'group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+(--spacing(4)))]'
            : 'group-data-[collapsible=icon]:w-(--sidebar-width-icon)',
        )}
      />
      <div
        data-slot="sidebar-container"
        className={cn(
          'fixed inset-y-0 z-10 hidden h-svh w-(--sidebar-width) transition-[left,right,width] duration-200 ease-linear md:flex',
          side === 'left'
            ? 'left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]'
            : 'right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]',
          // Adjust the padding for floating and inset variants.
          variant === 'floating' || variant === 'inset'
            ? 'p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+(--spacing(4))+2px)]'
            : 'group-data-[collapsible=icon]:w-(--sidebar-width-icon) group-data-[side=left]:border-r group-data-[side=right]:border-l',
          className,
        )}
        {...props}
      >
        <div
          data-sidebar="sidebar"
          data-slot="sidebar-inner"
          className="bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm"
        >
          {children}
        </div>
      </div>
    </div>
  )
}

function SidebarTrigger({
  className,
  onClick,
  ...props
}: React.ComponentProps<typeof Button>) {
  const { toggleSidebar } = useSidebar()

  return (
    <Button
      data-sidebar="trigger"
      data-slot="sidebar-trigger"
      variant="ghost"
      size="icon"
      className={cn('size-7', className)}
      onClick={(event) => {
        onClick?.(event)
        toggleSidebar()
      }}
      {...props}
    >
      <PanelLeftIcon />
      <span className="sr-only">Toggle Sidebar</span>
    </Button>
  )
}

function SidebarRail({ className, ...props }: React.ComponentProps<'button'>) {
  const { toggleSidebar } = useSidebar()

  return (
    <button
      data-sidebar="rail"
      data-slot="sidebar-rail"
      aria-label="Toggle Sidebar"
      tabIndex={-1}
      onClick={toggleSidebar}
      title="Toggle Sidebar"
      className={cn(
        'hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex',
        'in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize',
        '[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize',
        'hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full',
        '[[data-side=left][data-collapsible=offcanvas]_&]:-right-2',
        '[[data-side=right][data-collapsible=offcanvas]_&]:-left-2',
        className,
      )}
      {...props}
    />
  )
}

function SidebarInset({ className, ...props }: React.ComponentProps<'main'>) {
  return (
    <main
      data-slot="sidebar-inset"
      className={cn(
        'bg-background relative flex w-full flex-1 flex-col',
        'md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2',
        className,
      )}
      {...props}
    />
  )
}

function SidebarInput({
  className,
  ...props
}: React.ComponentProps<typeof Input>) {
  return (
    <Input
      data-slot="sidebar-input"
      data-sidebar="input"
      className={cn('bg-background h-8 w-full shadow-none', className)}
      {...props}
    />
  )
}

function SidebarHeader({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="sidebar-header"
      data-sidebar="header"
      className={cn('flex flex-col gap-2 p-2', className)}
      {...props}
    />
  )
}

function SidebarFooter({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="sidebar-footer"
      data-sidebar="footer"
      className={cn('flex flex-col gap-2 p-2', className)}
      {...props}
    />
  )
}

function SidebarSeparator({
  className,
  ...props
}: React.ComponentProps<typeof Separator>) {
  return (
    <Separator
      data-slot="sidebar-separator"
      data-sidebar="separator"
      className={cn('bg-sidebar-border mx-2 w-auto', className)}
      {...props}
    />
  )
}

function SidebarContent({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="sidebar-content"
      data-sidebar="content"
      className={cn(
        'flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden',
        className,
      )}
      {...props}
    />
  )
}

function SidebarGroup({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="sidebar-group"
      data-sidebar="group"
      className={cn('relative flex w-full min-w-0 flex-col p-2', className)}
      {...props}
    />
  )
}

function SidebarGroupLabel({
  className,
  asChild = false,
  ...props
}: React.ComponentProps<'div'> & { asChild?: boolean }) {
  const Comp = asChild ? Slot : 'div'

  return (
    <Comp
      data-slot="sidebar-group-label"
      data-sidebar="group-label"
      className={cn(
        'text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0',
        'group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0',
        className,
      )}
      {...props}
    />
  )
}

function SidebarGroupAction({
  className,
  asChild = false,
  ...props
}: React.ComponentProps<'button'> & { asChild?: boolean }) {
  const Comp = asChild ? Slot : 'button'

  return (
    <Comp
      data-slot="sidebar-group-action"
      data-sidebar="group-action"
      className={cn(
        'text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0',
        // Increases the hit area of the button on mobile.
        'after:absolute after:-inset-2 md:after:hidden',
        'group-data-[collapsible=icon]:hidden',
        className,
      )}
      {...props}
    />
  )
}

function SidebarGroupContent({
  className,
  ...props
}: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="sidebar-group-content"
      data-sidebar="group-content"
      className={cn('w-full text-sm', className)}
      {...props}
    />
  )
}

function SidebarMenu({ className, ...props }: React.ComponentProps<'ul'>) {
  return (
    <ul
      data-slot="sidebar-menu"
      data-sidebar="menu"
      className={cn('flex w-full min-w-0 flex-col gap-1', className)}
      {...props}
    />
  )
}

function SidebarMenuItem({ className, ...props }: React.ComponentProps<'li'>) {
  return (
    <li
      data-slot="sidebar-menu-item"
      data-sidebar="menu-item"
      className={cn('group/menu-item relative', className)}
      {...props}
    />
  )
}

const sidebarMenuButtonVariants = cva(
  'peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:size-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0',
  {
    variants: {
      variant: {
        default: 'hover:bg-sidebar-accent hover:text-sidebar-accent-foreground',
        outline:
          'bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]',
      },
      size: {
        default: 'h-8 text-sm',
        sm: 'h-7 text-xs',
        lg: 'h-12 text-sm group-data-[collapsible=icon]:p-0!',
      },
    },
    defaultVariants: {
      variant: 'default',
      size: 'default',
    },
  },
)

function SidebarMenuButton({
  asChild = false,
  isActive = false,
  variant = 'default',
  size = 'default',
  tooltip,
  className,
  ...props
}: React.ComponentProps<'button'> & {
  asChild?: boolean
  isActive?: boolean
  tooltip?: string | React.ComponentProps<typeof TooltipContent>
} & VariantProps<typeof sidebarMenuButtonVariants>) {
  const Comp = asChild ? Slot : 'button'
  const { isMobile, state } = useSidebar()

  const button = (
    <Comp
      data-slot="sidebar-menu-button"
      data-sidebar="menu-button"
      data-size={size}
      data-active={isActive}
      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}
      {...props}
    />
  )

  if (!tooltip) {
    return button
  }

  if (typeof tooltip === 'string') {
    tooltip = {
      children: tooltip,
    }
  }

  return (
    <Tooltip>
      <TooltipTrigger asChild>{button}</TooltipTrigger>
      <TooltipContent
        side="right"
        align="center"
        hidden={state !== 'collapsed' || isMobile}
        {...tooltip}
      />
    </Tooltip>
  )
}

function SidebarMenuAction({
  className,
  asChild = false,
  showOnHover = false,
  ...props
}: React.ComponentProps<'button'> & {
  asChild?: boolean
  showOnHover?: boolean
}) {
  const Comp = asChild ? Slot : 'button'

  return (
    <Comp
      data-slot="sidebar-menu-action"
      data-sidebar="menu-action"
      className={cn(
        'text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0',
        // Increases the hit area of the button on mobile.
        'after:absolute after:-inset-2 md:after:hidden',
        'peer-data-[size=sm]/menu-button:top-1',
        'peer-data-[size=default]/menu-button:top-1.5',
        'peer-data-[size=lg]/menu-button:top-2.5',
        'group-data-[collapsible=icon]:hidden',
        showOnHover &&
          'peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0',
        className,
      )}
      {...props}
    />
  )
}

function SidebarMenuBadge({
  className,
  ...props
}: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="sidebar-menu-badge"
      data-sidebar="menu-badge"
      className={cn(
        'text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none',
        'peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground',
        'peer-data-[size=sm]/menu-button:top-1',
        'peer-data-[size=default]/menu-button:top-1.5',
        'peer-data-[size=lg]/menu-button:top-2.5',
        'group-data-[collapsible=icon]:hidden',
        className,
      )}
      {...props}
    />
  )
}

function SidebarMenuSkeleton({
  className,
  showIcon = false,
  ...props
}: React.ComponentProps<'div'> & {
  showIcon?: boolean
}) {
  // Random width between 50 to 90%.
  const width = React.useMemo(() => {
    return `${Math.floor(Math.random() * 40) + 50}%`
  }, [])

  return (
    <div
      data-slot="sidebar-menu-skeleton"
      data-sidebar="menu-skeleton"
      className={cn('flex h-8 items-center gap-2 rounded-md px-2', className)}
      {...props}
    >
      {showIcon && (
        <Skeleton
          className="size-4 rounded-md"
          data-sidebar="menu-skeleton-icon"
        />
      )}
      <Skeleton
        className="h-4 max-w-(--skeleton-width) flex-1"
        data-sidebar="menu-skeleton-text"
        style={
          {
            '--skeleton-width': width,
          } as React.CSSProperties
        }
      />
    </div>
  )
}

function SidebarMenuSub({ className, ...props }: React.ComponentProps<'ul'>) {
  return (
    <ul
      data-slot="sidebar-menu-sub"
      data-sidebar="menu-sub"
      className={cn(
        'border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5',
        'group-data-[collapsible=icon]:hidden',
        className,
      )}
      {...props}
    />
  )
}

function SidebarMenuSubItem({
  className,
  ...props
}: React.ComponentProps<'li'>) {
  return (
    <li
      data-slot="sidebar-menu-sub-item"
      data-sidebar="menu-sub-item"
      className={cn('group/menu-sub-item relative', className)}
      {...props}
    />
  )
}

function SidebarMenuSubButton({
  asChild = false,
  size = 'md',
  isActive = false,
  className,
  ...props
}: React.ComponentProps<'a'> & {
  asChild?: boolean
  size?: 'sm' | 'md'
  isActive?: boolean
}) {
  const Comp = asChild ? Slot : 'a'

  return (
    <Comp
      data-slot="sidebar-menu-sub-button"
      data-sidebar="menu-sub-button"
      data-size={size}
      data-active={isActive}
      className={cn(
        'text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline-hidden focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0',
        'data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground',
        size === 'sm' && 'text-xs',
        size === 'md' && 'text-sm',
        'group-data-[collapsible=icon]:hidden',
        className,
      )}
      {...props}
    />
  )
}

export {
  Sidebar,
  SidebarContent,
  SidebarFooter,
  SidebarGroup,
  SidebarGroupAction,
  SidebarGroupContent,
  SidebarGroupLabel,
  SidebarHeader,
  SidebarInput,
  SidebarInset,
  SidebarMenu,
  SidebarMenuAction,
  SidebarMenuBadge,
  SidebarMenuButton,
  SidebarMenuItem,
  SidebarMenuSkeleton,
  SidebarMenuSub,
  SidebarMenuSubButton,
  SidebarMenuSubItem,
  SidebarProvider,
  SidebarRail,
  SidebarSeparator,
  SidebarTrigger,
  useSidebar,
}
</file>

<file path="components/ui/skeleton.tsx">
import { cn } from '@/lib/utils'

function Skeleton({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="skeleton"
      className={cn('bg-accent animate-pulse rounded-md', className)}
      {...props}
    />
  )
}

export { Skeleton }
</file>

<file path="components/ui/slider.tsx">
'use client'

import * as React from 'react'
import * as SliderPrimitive from '@radix-ui/react-slider'

import { cn } from '@/lib/utils'

function Slider({
  className,
  defaultValue,
  value,
  min = 0,
  max = 100,
  ...props
}: React.ComponentProps<typeof SliderPrimitive.Root>) {
  const _values = React.useMemo(
    () =>
      Array.isArray(value)
        ? value
        : Array.isArray(defaultValue)
          ? defaultValue
          : [min, max],
    [value, defaultValue, min, max],
  )

  return (
    <SliderPrimitive.Root
      data-slot="slider"
      defaultValue={defaultValue}
      value={value}
      min={min}
      max={max}
      className={cn(
        'relative flex w-full touch-none items-center select-none data-[disabled]:opacity-50 data-[orientation=vertical]:h-full data-[orientation=vertical]:min-h-44 data-[orientation=vertical]:w-auto data-[orientation=vertical]:flex-col',
        className,
      )}
      {...props}
    >
      <SliderPrimitive.Track
        data-slot="slider-track"
        className={
          'bg-muted relative grow overflow-hidden rounded-full data-[orientation=horizontal]:h-1.5 data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-1.5'
        }
      >
        <SliderPrimitive.Range
          data-slot="slider-range"
          className={
            'bg-primary absolute data-[orientation=horizontal]:h-full data-[orientation=vertical]:w-full'
          }
        />
      </SliderPrimitive.Track>
      {Array.from({ length: _values.length }, (_, index) => (
        <SliderPrimitive.Thumb
          data-slot="slider-thumb"
          key={index}
          className="border-primary ring-ring/50 block size-4 shrink-0 rounded-full border bg-white shadow-sm transition-[color,box-shadow] hover:ring-4 focus-visible:ring-4 focus-visible:outline-hidden disabled:pointer-events-none disabled:opacity-50"
        />
      ))}
    </SliderPrimitive.Root>
  )
}

export { Slider }
</file>

<file path="components/ui/sonner.tsx">
'use client'

import { useTheme } from 'next-themes'
import { Toaster as Sonner, ToasterProps } from 'sonner'

const Toaster = ({ ...props }: ToasterProps) => {
  const { theme = 'system' } = useTheme()

  return (
    <Sonner
      theme={theme as ToasterProps['theme']}
      className="toaster group"
      style={
        {
          '--normal-bg': 'var(--popover)',
          '--normal-text': 'var(--popover-foreground)',
          '--normal-border': 'var(--border)',
        } as React.CSSProperties
      }
      {...props}
    />
  )
}

export { Toaster }
</file>

<file path="components/ui/spinner.tsx">
import { Loader2Icon } from 'lucide-react'

import { cn } from '@/lib/utils'

function Spinner({ className, ...props }: React.ComponentProps<'svg'>) {
  return (
    <Loader2Icon
      role="status"
      aria-label="Loading"
      className={cn('size-4 animate-spin', className)}
      {...props}
    />
  )
}

export { Spinner }
</file>

<file path="components/ui/switch.tsx">
'use client'

import * as React from 'react'
import * as SwitchPrimitive from '@radix-ui/react-switch'

import { cn } from '@/lib/utils'

function Switch({
  className,
  ...props
}: React.ComponentProps<typeof SwitchPrimitive.Root>) {
  return (
    <SwitchPrimitive.Root
      data-slot="switch"
      className={cn(
        'peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-gray-300 focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-gray-600 inline-flex h-6 w-11 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all duration-200 outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50',
        className,
      )}
      {...props}
    >
      <SwitchPrimitive.Thumb
        data-slot="switch-thumb"
        className={
          'bg-white dark:bg-gray-800 pointer-events-none block size-5 rounded-full ring-0 transition-all duration-200 shadow-sm data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0.5'
        }
      />
    </SwitchPrimitive.Root>
  )
}

export { Switch }
</file>

<file path="components/ui/table.tsx">
'use client'

import * as React from 'react'

import { cn } from '@/lib/utils'

function Table({ className, ...props }: React.ComponentProps<'table'>) {
  return (
    <div
      data-slot="table-container"
      className="relative w-full overflow-x-auto"
    >
      <table
        data-slot="table"
        className={cn('w-full caption-bottom text-sm', className)}
        {...props}
      />
    </div>
  )
}

function TableHeader({ className, ...props }: React.ComponentProps<'thead'>) {
  return (
    <thead
      data-slot="table-header"
      className={cn('[&_tr]:border-b', className)}
      {...props}
    />
  )
}

function TableBody({ className, ...props }: React.ComponentProps<'tbody'>) {
  return (
    <tbody
      data-slot="table-body"
      className={cn('[&_tr:last-child]:border-0', className)}
      {...props}
    />
  )
}

function TableFooter({ className, ...props }: React.ComponentProps<'tfoot'>) {
  return (
    <tfoot
      data-slot="table-footer"
      className={cn(
        'bg-muted/50 border-t font-medium [&>tr]:last:border-b-0',
        className,
      )}
      {...props}
    />
  )
}

function TableRow({ className, ...props }: React.ComponentProps<'tr'>) {
  return (
    <tr
      data-slot="table-row"
      className={cn(
        'hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors',
        className,
      )}
      {...props}
    />
  )
}

function TableHead({ className, ...props }: React.ComponentProps<'th'>) {
  return (
    <th
      data-slot="table-head"
      className={cn(
        'text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]',
        className,
      )}
      {...props}
    />
  )
}

function TableCell({ className, ...props }: React.ComponentProps<'td'>) {
  return (
    <td
      data-slot="table-cell"
      className={cn(
        'p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]',
        className,
      )}
      {...props}
    />
  )
}

function TableCaption({
  className,
  ...props
}: React.ComponentProps<'caption'>) {
  return (
    <caption
      data-slot="table-caption"
      className={cn('text-muted-foreground mt-4 text-sm', className)}
      {...props}
    />
  )
}

export {
  Table,
  TableHeader,
  TableBody,
  TableFooter,
  TableHead,
  TableRow,
  TableCell,
  TableCaption,
}
</file>

<file path="components/ui/tabs.tsx">
'use client'

import * as React from 'react'
import * as TabsPrimitive from '@radix-ui/react-tabs'

import { cn } from '@/lib/utils'

function Tabs({
  className,
  ...props
}: React.ComponentProps<typeof TabsPrimitive.Root>) {
  return (
    <TabsPrimitive.Root
      data-slot="tabs"
      className={cn('flex flex-col gap-2', className)}
      {...props}
    />
  )
}

function TabsList({
  className,
  ...props
}: React.ComponentProps<typeof TabsPrimitive.List>) {
  return (
    <TabsPrimitive.List
      data-slot="tabs-list"
      className={cn(
        'bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]',
        className,
      )}
      {...props}
    />
  )
}

function TabsTrigger({
  className,
  ...props
}: React.ComponentProps<typeof TabsPrimitive.Trigger>) {
  return (
    <TabsPrimitive.Trigger
      data-slot="tabs-trigger"
      className={cn(
        "data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    />
  )
}

function TabsContent({
  className,
  ...props
}: React.ComponentProps<typeof TabsPrimitive.Content>) {
  return (
    <TabsPrimitive.Content
      data-slot="tabs-content"
      className={cn('flex-1 outline-none', className)}
      {...props}
    />
  )
}

export { Tabs, TabsList, TabsTrigger, TabsContent }
</file>

<file path="components/ui/textarea.tsx">
import * as React from 'react'

import { cn } from '@/lib/utils'

function Textarea({ className, ...props }: React.ComponentProps<'textarea'>) {
  return (
    <textarea
      data-slot="textarea"
      className={cn(
        'border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm',
        className,
      )}
      {...props}
    />
  )
}

export { Textarea }
</file>

<file path="components/ui/toast.tsx">
'use client'

import * as React from 'react'
import * as ToastPrimitives from '@radix-ui/react-toast'
import { cva, type VariantProps } from 'class-variance-authority'
import { X } from 'lucide-react'

import { cn } from '@/lib/utils'

const ToastProvider = ToastPrimitives.Provider

const ToastViewport = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Viewport>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Viewport
    ref={ref}
    className={cn(
      'fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]',
      className,
    )}
    {...props}
  />
))
ToastViewport.displayName = ToastPrimitives.Viewport.displayName

const toastVariants = cva(
  'group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg z-50 transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full',
  {
    variants: {
      variant: {
        default: 'border border-slate-200 bg-white dark:bg-gray-800 text-foreground shadow-lg',
        destructive:
          'destructive group border-destructive bg-destructive text-destructive-foreground shadow-lg',
      },
    },
    defaultVariants: {
      variant: 'default',
    },
  },
)

const Toast = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Root>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &
    VariantProps<typeof toastVariants>
>(({ className, variant, ...props }, ref) => {
  return (
    <ToastPrimitives.Root
      ref={ref}
      className={cn(toastVariants({ variant }), className)}
      {...props}
    />
  )
})
Toast.displayName = ToastPrimitives.Root.displayName

const ToastAction = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Action>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Action
    ref={ref}
    className={cn(
      'inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive',
      className,
    )}
    {...props}
  />
))
ToastAction.displayName = ToastPrimitives.Action.displayName

const ToastClose = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Close>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Close
    ref={ref}
    className={cn(
      'absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600',
      className,
    )}
    toast-close=""
    {...props}
  >
    <X className="h-4 w-4" />
  </ToastPrimitives.Close>
))
ToastClose.displayName = ToastPrimitives.Close.displayName

const ToastTitle = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Title>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Title
    ref={ref}
    className={cn('text-sm font-semibold', className)}
    {...props}
  />
))
ToastTitle.displayName = ToastPrimitives.Title.displayName

const ToastDescription = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Description>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Description
    ref={ref}
    className={cn('text-sm opacity-90', className)}
    {...props}
  />
))
ToastDescription.displayName = ToastPrimitives.Description.displayName

type ToastProps = React.ComponentPropsWithoutRef<typeof Toast>

type ToastActionElement = React.ReactElement<typeof ToastAction>

export {
  type ToastProps,
  type ToastActionElement,
  ToastProvider,
  ToastViewport,
  Toast,
  ToastTitle,
  ToastDescription,
  ToastClose,
  ToastAction,
}
</file>

<file path="components/ui/toaster.tsx">
'use client'

import { useToast } from '@/hooks/use-toast'
import {
  Toast,
  ToastClose,
  ToastDescription,
  ToastProvider,
  ToastTitle,
  ToastViewport,
} from '@/components/ui/toast'

export function Toaster() {
  const { toasts } = useToast()

  return (
    <ToastProvider>
      {toasts.map(function ({ id, title, description, action, ...props }) {
        return (
          <Toast key={id} {...props}>
            <div className="grid gap-1">
              {title && <ToastTitle>{title}</ToastTitle>}
              {description && (
                <ToastDescription>{description}</ToastDescription>
              )}
            </div>
            {action}
            <ToastClose />
          </Toast>
        )
      })}
      <ToastViewport />
    </ToastProvider>
  )
}
</file>

<file path="components/ui/toggle-group.tsx">
'use client'

import * as React from 'react'
import * as ToggleGroupPrimitive from '@radix-ui/react-toggle-group'
import { type VariantProps } from 'class-variance-authority'

import { cn } from '@/lib/utils'
import { toggleVariants } from '@/components/ui/toggle'

const ToggleGroupContext = React.createContext<
  VariantProps<typeof toggleVariants>
>({
  size: 'default',
  variant: 'default',
})

function ToggleGroup({
  className,
  variant,
  size,
  children,
  ...props
}: React.ComponentProps<typeof ToggleGroupPrimitive.Root> &
  VariantProps<typeof toggleVariants>) {
  return (
    <ToggleGroupPrimitive.Root
      data-slot="toggle-group"
      data-variant={variant}
      data-size={size}
      className={cn(
        'group/toggle-group flex w-fit items-center rounded-md data-[variant=outline]:shadow-xs',
        className,
      )}
      {...props}
    >
      <ToggleGroupContext.Provider value={{ variant, size }}>
        {children}
      </ToggleGroupContext.Provider>
    </ToggleGroupPrimitive.Root>
  )
}

function ToggleGroupItem({
  className,
  children,
  variant,
  size,
  ...props
}: React.ComponentProps<typeof ToggleGroupPrimitive.Item> &
  VariantProps<typeof toggleVariants>) {
  const context = React.useContext(ToggleGroupContext)

  return (
    <ToggleGroupPrimitive.Item
      data-slot="toggle-group-item"
      data-variant={context.variant || variant}
      data-size={context.size || size}
      className={cn(
        toggleVariants({
          variant: context.variant || variant,
          size: context.size || size,
        }),
        'min-w-0 flex-1 shrink-0 rounded-none shadow-none first:rounded-l-md last:rounded-r-md focus:z-10 focus-visible:z-10 data-[variant=outline]:border-l-0 data-[variant=outline]:first:border-l',
        className,
      )}
      {...props}
    >
      {children}
    </ToggleGroupPrimitive.Item>
  )
}

export { ToggleGroup, ToggleGroupItem }
</file>

<file path="components/ui/toggle.tsx">
'use client'

import * as React from 'react'
import * as TogglePrimitive from '@radix-ui/react-toggle'
import { cva, type VariantProps } from 'class-variance-authority'

import { cn } from '@/lib/utils'

const toggleVariants = cva(
  "inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium hover:bg-muted hover:text-muted-foreground disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 [&_svg]:shrink-0 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] outline-none transition-[color,box-shadow] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive whitespace-nowrap",
  {
    variants: {
      variant: {
        default: 'bg-transparent',
        outline:
          'border border-input bg-transparent shadow-xs hover:bg-accent hover:text-accent-foreground',
      },
      size: {
        default: 'h-9 px-2 min-w-9',
        sm: 'h-8 px-1.5 min-w-8',
        lg: 'h-10 px-2.5 min-w-10',
      },
    },
    defaultVariants: {
      variant: 'default',
      size: 'default',
    },
  },
)

function Toggle({
  className,
  variant,
  size,
  ...props
}: React.ComponentProps<typeof TogglePrimitive.Root> &
  VariantProps<typeof toggleVariants>) {
  return (
    <TogglePrimitive.Root
      data-slot="toggle"
      className={cn(toggleVariants({ variant, size, className }))}
      {...props}
    />
  )
}

export { Toggle, toggleVariants }
</file>

<file path="components/ui/tooltip.tsx">
'use client'

import * as React from 'react'
import * as TooltipPrimitive from '@radix-ui/react-tooltip'

import { cn } from '@/lib/utils'

function TooltipProvider({
  delayDuration = 0,
  ...props
}: React.ComponentProps<typeof TooltipPrimitive.Provider>) {
  return (
    <TooltipPrimitive.Provider
      data-slot="tooltip-provider"
      delayDuration={delayDuration}
      {...props}
    />
  )
}

function Tooltip({
  ...props
}: React.ComponentProps<typeof TooltipPrimitive.Root>) {
  return (
    <TooltipProvider>
      <TooltipPrimitive.Root data-slot="tooltip" {...props} />
    </TooltipProvider>
  )
}

function TooltipTrigger({
  ...props
}: React.ComponentProps<typeof TooltipPrimitive.Trigger>) {
  return <TooltipPrimitive.Trigger data-slot="tooltip-trigger" {...props} />
}

function TooltipContent({
  className,
  sideOffset = 0,
  children,
  ...props
}: React.ComponentProps<typeof TooltipPrimitive.Content>) {
  return (
    <TooltipPrimitive.Portal>
      <TooltipPrimitive.Content
        data-slot="tooltip-content"
        sideOffset={sideOffset}
        className={cn(
          'bg-foreground text-background animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-fit origin-[var(--radix-tooltip-content-transform-origin)] rounded-md px-3 py-1.5 text-xs text-balance',
          className,
        )}
        {...props}
      >
        {children}
      </TooltipPrimitive.Content>
    </TooltipPrimitive.Portal>
  )
}

export { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }
</file>

<file path="components/user-badges.tsx">
"use client"

import { cn } from "@/lib/utils"

type Badge = {
  icon: string
  name: string
}

type UserBadgesProps = {
  badges?: Badge[]
  className?: string
}

export function UserBadges({ badges, className }: UserBadgesProps) {
  if (!badges || badges.length === 0) {
    return null
  }

  return (
    <div className={cn("flex items-center gap-1.5", className)}>
      {badges.map((badge, index) => (
        <span
          key={index}
          className="inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-slate-100 text-slate-700 text-xs font-medium border border-slate-200"
          title={badge.name}
        >
          <span className="text-sm">{badge.icon}</span>
        </span>
      ))}
    </div>
  )
}
</file>

<file path="components/user-management.tsx">
"use client"

import { useState } from "react"
import { Shield, Crown, Medal } from "lucide-react"
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select"
import { Button } from "@/components/ui/button"
import { Dialog, DialogContent, DialogHeader, DialogTitle } from "@/components/ui/dialog"
import { TableRow, TableCell } from "@/components/ui/table"
import { Avatar, AvatarFallback } from "@/components/ui/avatar"
import { BadgeManager } from "@/components/badge-manager"
import { updateUserRole, updateUserMembershipTier } from "@/lib/actions/admin"

type UserProfile = {
  id: string
  full_name: string | null
  email: string | null
  role: string | null
  membership_tier: string | null
  points: number | null
  created_at: string
}

export function UserManagementRow({
  user,
  currentUserId,
  canChangeRole = false,
}: {
  user: UserProfile
  currentUserId: string
  canChangeRole?: boolean
}) {
  const [role, setRole] = useState(user.role || "member")
  const [membershipTier, setMembershipTier] = useState(user.membership_tier || "basic")
  const [isUpdating, setIsUpdating] = useState(false)
  const [showBadgeManager, setShowBadgeManager] = useState(false)

  const handleRoleChange = async (newRole: string) => {
    // ê°™ì€ ì—­í• ë¡œ ë³€ê²½í•˜ë ¤ëŠ” ê²½ìš° ë¬´ì‹œ
    if (newRole === role) {
      return
    }
    
    setIsUpdating(true)
    try {
      const result = await updateUserRole(user.id, newRole)
      console.log("Role update result:", result)
      
      if (result?.success) {
        setRole(newRole)
        // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ (ì„ íƒì‚¬í•­)
        // alert(`ì—­í• ì´ "${newRole}"ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`)
        // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨í•˜ì—¬ ë³€ê²½ì‚¬í•­ ë°˜ì˜
        window.location.reload()
      } else {
        throw new Error("ì—…ë°ì´íŠ¸ ê²°ê³¼ë¥¼ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.")
      }
    } catch (error) {
      console.error("Failed to update role:", error)
      const errorMessage = error instanceof Error ? error.message : "ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"
      alert(`ê¶Œí•œ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨: ${errorMessage}`)
      // ì‹¤íŒ¨ ì‹œ ì›ë˜ ê°’ìœ¼ë¡œ ë˜ëŒë¦¬ê¸°
      setRole(user.role || "member")
    } finally {
      setIsUpdating(false)
    }
  }

  const handleMembershipChange = async (newTier: string) => {
    setIsUpdating(true)
    try {
      await updateUserMembershipTier(user.id, newTier)
      setMembershipTier(newTier)
    } catch (error) {
      console.error("Failed to update membership:", error)
    } finally {
      setIsUpdating(false)
    }
  }

  const getRoleBadge = () => {
    if (role === "master") {
      return (
        <span className="inline-flex items-center gap-1 rounded-full bg-amber-100 px-2 py-0.5 text-xs font-medium text-amber-700">
          <Crown className="h-3 w-3" />
          MASTER
        </span>
      )
    }
    if (role === "admin") {
      return (
        <span className="inline-flex items-center gap-1 rounded-full bg-blue-100 px-2 py-0.5 text-xs font-medium text-blue-700">
          <Shield className="h-3 w-3" />
          ê´€ë¦¬ì
        </span>
      )
    }
    return <span className="text-sm text-slate-600">ì¼ë°˜ íšŒì›</span>
  }

  const getMembershipBadge = () => {
    const badges = {
      basic: { color: "bg-slate-100 text-slate-700", label: "Basic" },
      plus: { color: "bg-blue-100 text-blue-700", label: "Plus" },
      pro: { color: "bg-purple-100 text-purple-700", label: "Pro" },
      master: { color: "bg-amber-100 text-amber-700", label: "Master" },
    }

    const badge = badges[membershipTier as keyof typeof badges] || badges.basic

    return <span className={`rounded-full px-2 py-0.5 text-xs font-medium ${badge.color}`}>{badge.label}</span>
  }

  const formatDate = (dateString: string) => {
    const date = new Date(dateString)
    const year = date.getFullYear()
    const month = String(date.getMonth() + 1).padStart(2, "0")
    const day = String(date.getDate()).padStart(2, "0")
    return `${year}. ${month}. ${day}.`
  }

  const formatPoints = (points: number | null) => {
    const value = points || 0
    return value.toLocaleString() + " P"
  }

  const isCurrentUser = user.id === currentUserId

  return (
    <>
      <TableRow>
        {/* ì´ë¦„ */}
        <TableCell className="py-4">
          <div className="flex items-center gap-3">
            <Avatar className="h-10 w-10">
              <AvatarFallback className="bg-slate-200 text-slate-700">
                {user.full_name?.[0]?.toUpperCase() || "U"}
              </AvatarFallback>
            </Avatar>
            <div>
              <div className="font-medium text-slate-900">{user.full_name || "ìµëª…"}</div>
            </div>
          </div>
        </TableCell>

        {/* ì´ë©”ì¼ */}
        <TableCell className="py-4">
          <div className="text-sm text-slate-600">{user.email || "-"}</div>
        </TableCell>

        {/* í¬ì¸íŠ¸ ìˆ¨ê¹€ */}
        {/* <TableCell className="py-4">
          <div className="font-medium text-slate-900">{formatPoints(user.points)}</div>
        </TableCell>
        */}

        {/* ë“±ê¸‰ */}
        <TableCell className="py-4">
          {getRoleBadge()}
        </TableCell>

        {/* ê°€ì…ì¼ */}
        <TableCell className="py-4">
          <div className="text-sm text-slate-600">{formatDate(user.created_at)}</div>
        </TableCell>

        {/* ê´€ë¦¬ */}
        <TableCell className="text-right py-4">
          {!isCurrentUser ? (
            <div className="flex items-center justify-end gap-2">
              <Button
                variant="outline"
                size="sm"
                onClick={() => setShowBadgeManager(true)}
                className="gap-2"
              >
                <Medal className="h-4 w-4" />
                ë±ƒì§€ ê´€ë¦¬
              </Button>

              {canChangeRole && (
                <Select value={role} onValueChange={handleRoleChange} disabled={isUpdating}>
                  <SelectTrigger className="w-32 h-9">
                    <SelectValue />
                  </SelectTrigger>
                  <SelectContent className="z-50">
                    <SelectItem value="member">ì¼ë°˜ íšŒì›</SelectItem>
                    <SelectItem value="admin">ê´€ë¦¬ì</SelectItem>
                    <SelectItem value="master">MASTER</SelectItem>
                  </SelectContent>
                </Select>
              )}
            </div>
          ) : (
            <span className="text-sm text-slate-400">ë³¸ì¸</span>
          )}
        </TableCell>
      </TableRow>

      {/* ë±ƒì§€ ê´€ë¦¬ ëª¨ë‹¬ */}
      <Dialog open={showBadgeManager} onOpenChange={setShowBadgeManager}>
        <DialogContent className="sm:max-w-lg bg-white rounded-xl">
          <DialogHeader>
            <DialogTitle className="flex items-center gap-2">
              <Medal className="h-5 w-5" />
              ë±ƒì§€ ê´€ë¦¬ ë° ë“±ë¡
            </DialogTitle>
          </DialogHeader>
          <div className="mt-6 max-h-[80vh] overflow-y-auto">
            <BadgeManager userId={user.id} />
          </div>
        </DialogContent>
      </Dialog>
    </>
  )
}
</file>

<file path="DEPLOYMENT_DEBUG.md">
# ë°°í¬ í™˜ê²½ ë””ë²„ê¹… ê°€ì´ë“œ

## í˜„ì¬ ìƒí™©
- ë¡œì»¬ì—ì„œëŠ” ë°ì´í„°ê°€ ì •ìƒì ìœ¼ë¡œ ë³´ì„
- ë°°í¬ ì‚¬ì´íŠ¸(https://sfc-ten.vercel.app/)ì—ì„œëŠ” ë°ì´í„°ê°€ ì•ˆ ë³´ì„
- í™˜ê²½ ë³€ìˆ˜ëŠ” ì œëŒ€ë¡œ ì„¤ì •ë˜ì–´ ìˆìŒ

## ì¦‰ì‹œ í™•ì¸í•  ê²ƒ

### 1. ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬ í™•ì¸ (ê°€ì¥ ì¤‘ìš”!)

ë°°í¬ ì‚¬ì´íŠ¸(https://sfc-ten.vercel.app/)ì—ì„œ:
1. **F12** ë˜ëŠ” **ìš°í´ë¦­ â†’ ê²€ì‚¬** í´ë¦­
2. **Console íƒ­** í™•ì¸
   - ì—ëŸ¬ ë©”ì‹œì§€ê°€ ìˆëŠ”ì§€ í™•ì¸
   - ë¹¨ê°„ìƒ‰ ì—ëŸ¬ ë©”ì‹œì§€ í™•ì¸
3. **Network íƒ­** í™•ì¸
   - í•„í„°ì—ì„œ "Fetch/XHR" ì„ íƒ
   - í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ (F5)
   - `/rest/v1/events` ìš”ì²­ ì°¾ê¸°
   - `/rest/v1/posts` ìš”ì²­ ì°¾ê¸°
   - ê° ìš”ì²­ í´ë¦­ â†’ **Response** íƒ­ í™•ì¸
     - ë°ì´í„°ê°€ ìˆëŠ”ì§€?
     - ì—ëŸ¬ ë©”ì‹œì§€ê°€ ìˆëŠ”ì§€?
   - **Status** ì½”ë“œ í™•ì¸
     - 200: ì •ìƒ
     - 401: ì¸ì¦ ì˜¤ë¥˜
     - 403: ê¶Œí•œ ì˜¤ë¥˜
     - 500: ì„œë²„ ì˜¤ë¥˜

### 2. Vercel ë¡œê·¸ í™•ì¸

1. **Vercel Dashboard** ì ‘ì†
2. í”„ë¡œì íŠ¸ ì„ íƒ
3. **Deployments** íƒ­
4. ê°€ì¥ ìµœê·¼ ë°°í¬ í´ë¦­
5. **Functions** íƒ­ ë˜ëŠ” **Logs** íƒ­ í™•ì¸
6. ì—ëŸ¬ ë©”ì‹œì§€ í™•ì¸

### 3. Supabase ë¡œê·¸ í™•ì¸

1. **Supabase Dashboard** ì ‘ì†
2. í”„ë¡œì íŠ¸ ì„ íƒ
3. **Logs** â†’ **API Logs** ì´ë™
4. ìµœê·¼ ìš”ì²­ í™•ì¸
5. ì—ëŸ¬ê°€ ìˆëŠ”ì§€ í™•ì¸

## ê°€ëŠ¥í•œ ì›ì¸ ë° í•´ê²°

### ì›ì¸ 1: ë‹¤ë¥¸ Supabase í”„ë¡œì íŠ¸ë¥¼ ì‚¬ìš© ì¤‘

**í™•ì¸ ë°©ë²•:**
- ë¡œì»¬ `.env.local` íŒŒì¼ì˜ `NEXT_PUBLIC_SUPABASE_URL` í™•ì¸
- Vercel í™˜ê²½ ë³€ìˆ˜ì˜ `NEXT_PUBLIC_SUPABASE_URL` í™•ì¸
- ë‘ ê°’ì´ **ë™ì¼í•œì§€** í™•ì¸

**í•´ê²°:**
- Vercel í™˜ê²½ ë³€ìˆ˜ë¥¼ ë¡œì»¬ê³¼ ë™ì¼í•˜ê²Œ ìˆ˜ì •

### ì›ì¸ 2: RLS ì •ì±…ì´ ë°°í¬ í™˜ê²½ì—ì„œ ì œëŒ€ë¡œ ì ìš©ë˜ì§€ ì•ŠìŒ

**í™•ì¸ ë°©ë²•:**
Supabase SQL Editorì—ì„œ ì‹¤í–‰:
```sql
-- RLS ì •ì±… í™•ì¸
SELECT 
  tablename,
  policyname,
  cmd,
  qual
FROM pg_policies 
WHERE schemaname = 'public' 
AND tablename IN ('posts', 'events', 'board_categories', 'profiles')
AND cmd = 'SELECT'
ORDER BY tablename, policyname;
```

**í•´ê²°:**
- `scripts/017_ensure_public_read_policies.sql` ì¬ì‹¤í–‰
- `scripts/022_fix_inner_join_rls.sql` ì‹¤í–‰

### ì›ì¸ 3: ì¿¼ë¦¬ ì—ëŸ¬ê°€ ì¡°ìš©íˆ ë°œìƒ

**í™•ì¸ ë°©ë²•:**
- ë¸Œë¼ìš°ì € Consoleì—ì„œ ì—ëŸ¬ í™•ì¸
- Vercel ë¡œê·¸ì—ì„œ ì—ëŸ¬ í™•ì¸
- ì½”ë“œì— ì¶”ê°€í•œ `console.error` í™•ì¸

**í•´ê²°:**
- `app/page.tsx`ì— ì—ëŸ¬ ë¡œê¹… ì¶”ê°€ë¨ (ì´ë¯¸ ì™„ë£Œ)
- Vercel Functions ë¡œê·¸ì—ì„œ í™•ì¸

### ì›ì¸ 4: ì‹œê°„ëŒ€ ë¬¸ì œ

ë°°í¬ í™˜ê²½ê³¼ ë¡œì»¬ì˜ ì‹œê°„ëŒ€ê°€ ë‹¤ë¥¼ ìˆ˜ ìˆìŒ

**í™•ì¸:**
- `event_date >= NOW()` ì¡°ê±´ í™•ì¸
- ë°°í¬ í™˜ê²½ì—ì„œ `NOW()` ê°’ í™•ì¸

## ë””ë²„ê¹… ë‹¨ê³„

### Step 1: ë¸Œë¼ìš°ì €ì—ì„œ ì§ì ‘ í™•ì¸
ë°°í¬ ì‚¬ì´íŠ¸ì—ì„œ F12 â†’ Network íƒ­ â†’ API ìš”ì²­ í™•ì¸

### Step 2: Vercel ë¡œê·¸ í™•ì¸
Vercel Dashboard â†’ Deployments â†’ ìµœê·¼ ë°°í¬ â†’ Logs

### Step 3: Supabase ë¡œê·¸ í™•ì¸
Supabase Dashboard â†’ Logs â†’ API Logs

### Step 4: SQL ìŠ¤í¬ë¦½íŠ¸ ì¬ì‹¤í–‰
- `scripts/017_ensure_public_read_policies.sql` ì¬ì‹¤í–‰
- `scripts/022_fix_inner_join_rls.sql` ì‹¤í–‰

### Step 5: ì‹¤ì œ ì¿¼ë¦¬ í…ŒìŠ¤íŠ¸
Supabase SQL Editorì—ì„œ `scripts/020_test_anonymous_queries.sql` ì‹¤í–‰

## ì¶”ê°€ í™•ì¸

ë°°í¬ ì‚¬ì´íŠ¸ì—ì„œ ì§ì ‘ API í˜¸ì¶œ í…ŒìŠ¤íŠ¸:

ë¸Œë¼ìš°ì € Consoleì—ì„œ ì‹¤í–‰:
```javascript
// ì´ë²¤íŠ¸ ì¡°íšŒ í…ŒìŠ¤íŠ¸
fetch('https://YOUR_SUPABASE_URL/rest/v1/events?event_date=gte.' + new Date().toISOString() + '&select=*&order=event_date.asc&limit=9', {
  headers: {
    'apikey': 'YOUR_ANON_KEY',
    'Authorization': 'Bearer YOUR_ANON_KEY'
  }
})
.then(r => r.json())
.then(console.log)
.catch(console.error)

// ê²Œì‹œê¸€ ì¡°íšŒ í…ŒìŠ¤íŠ¸
fetch('https://YOUR_SUPABASE_URL/rest/v1/posts?select=*&limit=10', {
  headers: {
    'apikey': 'YOUR_ANON_KEY',
    'Authorization': 'Bearer YOUR_ANON_KEY'
  }
})
.then(r => r.json())
.then(console.log)
.catch(console.error)
```

ì´ê²ƒìœ¼ë¡œ ìµëª… ì‚¬ìš©ìë¡œ API í˜¸ì¶œì´ ë˜ëŠ”ì§€ ì§ì ‘ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
</file>

<file path="FIX_API_KEY_ERROR.md">
# âš ï¸ Invalid API Key ì—ëŸ¬ í•´ê²° ë°©ë²•

## ë¬¸ì œ ì¦ìƒ
ë””ë²„ê·¸ í˜ì´ì§€(`/debug`)ì—ì„œ ëª¨ë“  ì¿¼ë¦¬ê°€ "Invalid API key" ì—ëŸ¬ ë°œìƒ

## ì¦‰ì‹œ í•´ê²° ë°©ë²•

### 1ë‹¨ê³„: Supabaseì—ì„œ ì˜¬ë°”ë¥¸ API Key í™•ì¸

1. **Supabase Dashboard ì ‘ì†**
   - https://supabase.com/dashboard
   - í”„ë¡œì íŠ¸ ì„ íƒ

2. **Settings â†’ API ì´ë™**

3. **ë‹¤ìŒ ê°’ ë³µì‚¬ (ì •í™•íˆ!)**
   - **Project URL** â†’ ì˜ˆ: `https://yzmapsgsxgjxxtaqhelu.supabase.co`
   - **anon public** í‚¤ â†’ ë§¤ìš° ê¸´ JWT í† í° í˜•íƒœ

### 2ë‹¨ê³„: Vercel í™˜ê²½ ë³€ìˆ˜ í™•ì¸ ë° ìˆ˜ì •

1. **Vercel Dashboard ì ‘ì†**
   - https://vercel.com/dashboard
   - í”„ë¡œì íŠ¸ ì„ íƒ

2. **Settings â†’ Environment Variables**

3. **ê¸°ì¡´ í™˜ê²½ ë³€ìˆ˜ ì‚­ì œ í›„ ì¬ìƒì„±**

   **ì‚­ì œ:**
   - `NEXT_PUBLIC_SUPABASE_URL` ì‚­ì œ (ìˆë‹¤ë©´)
   - `NEXT_PUBLIC_SUPABASE_ANON_KEY` ì‚­ì œ (ìˆë‹¤ë©´)

   **ìƒˆë¡œ ì¶”ê°€:**
   - "Add New" ë²„íŠ¼ í´ë¦­
   - **Key**: `NEXT_PUBLIC_SUPABASE_URL`
   - **Value**: Supabaseì—ì„œ ë³µì‚¬í•œ Project URL (ì „ì²´)
   - **Environment**: âœ… Production, âœ… Preview, âœ… Development ëª¨ë‘ ì„ íƒ
   - "Save" í´ë¦­
   
   - ë‹¤ì‹œ "Add New" ë²„íŠ¼ í´ë¦­
   - **Key**: `NEXT_PUBLIC_SUPABASE_ANON_KEY`
   - **Value**: Supabaseì—ì„œ ë³µì‚¬í•œ **anon public** í‚¤ (ì „ì²´, ë§¤ìš° ê¸´ ë¬¸ìì—´)
   - **Environment**: âœ… Production, âœ… Preview, âœ… Development ëª¨ë‘ ì„ íƒ
   - "Save" í´ë¦­

### 3ë‹¨ê³„: ì¬ë°°í¬

1. **Vercel Dashboard â†’ Deployments**
2. ê°€ì¥ ìµœê·¼ ë°°í¬ í´ë¦­
3. "..." ë©”ë‰´ â†’ **"Redeploy"** ì„ íƒ
4. ì¬ë°°í¬ ì™„ë£Œ ëŒ€ê¸°

### 4ë‹¨ê³„: í™•ì¸

1. **ë°°í¬ ì™„ë£Œ í›„**: https://sfc-ten.vercel.app/debug ì ‘ì†
2. **í™˜ê²½ ë³€ìˆ˜ ì„¹ì…˜** í™•ì¸:
   - Supabase URL: âœ… í‘œì‹œë˜ì–´ì•¼ í•¨
   - Anon Key: âœ… SET í‘œì‹œë˜ì–´ì•¼ í•¨
3. **ëª¨ë“  ì¿¼ë¦¬**ê°€ âœ… ì„±ê³µí•´ì•¼ í•¨

## ì£¼ì˜ì‚¬í•­

- âŒ **service_role** í‚¤ë¥¼ ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš” (ê´€ë¦¬ì í‚¤, ë³´ì•ˆ ìœ„í—˜)
- âœ… **anon public** í‚¤ë§Œ ì‚¬ìš©í•˜ì„¸ìš”
- í™˜ê²½ ë³€ìˆ˜ ê°’ ë³µì‚¬ ì‹œ **ì•ë’¤ ê³µë°± ì—†ì´** ì •í™•íˆ ë³µì‚¬
- Production, Preview, Development **ëª¨ë‘**ì— ì„¤ì •
- í™˜ê²½ ë³€ìˆ˜ ìˆ˜ì • í›„ **ë°˜ë“œì‹œ ì¬ë°°í¬**

## ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] Supabaseì—ì„œ Project URL ë³µì‚¬
- [ ] Supabaseì—ì„œ anon public í‚¤ ë³µì‚¬ (service_role ì•„ë‹˜!)
- [ ] Vercelì—ì„œ ê¸°ì¡´ í™˜ê²½ ë³€ìˆ˜ ì‚­ì œ
- [ ] Vercelì—ì„œ `NEXT_PUBLIC_SUPABASE_URL` ìƒˆë¡œ ì¶”ê°€ (ëª¨ë“  í™˜ê²½ ì„ íƒ)
- [ ] Vercelì—ì„œ `NEXT_PUBLIC_SUPABASE_ANON_KEY` ìƒˆë¡œ ì¶”ê°€ (ëª¨ë“  í™˜ê²½ ì„ íƒ)
- [ ] Vercelì—ì„œ ì¬ë°°í¬ (Redeploy)
- [ ] `/debug` í˜ì´ì§€ì—ì„œ ì—ëŸ¬ ì‚¬ë¼ì¡ŒëŠ”ì§€ í™•ì¸
</file>

<file path="GOOGLE_MAPS_API_SETUP.md">
# Google Maps API í‚¤ ì„¤ì • ê°€ì´ë“œ

## ë¬¸ì œ ì¦ìƒ

```
Google Maps JavaScript API error: RefererNotAllowedMapError
Your site URL to be authorized: http://localhost:3000/
```

ì´ ì—ëŸ¬ëŠ” Google Cloud Consoleì—ì„œ API í‚¤ì˜ ì°¸ì¡° URL ì œí•œ ì„¤ì •ì— í˜„ì¬ ì‚¬ì´íŠ¸ê°€ í¬í•¨ë˜ì–´ ìˆì§€ ì•Šì•„ì„œ ë°œìƒí•©ë‹ˆë‹¤.

## í•´ê²° ë°©ë²•

### 1ë‹¨ê³„: Google Cloud Console ì ‘ì†

1. [Google Cloud Console](https://console.cloud.google.com/) ì ‘ì†
2. í”„ë¡œì íŠ¸ ì„ íƒ (Seoul Founders Club í”„ë¡œì íŠ¸)

### 2ë‹¨ê³„: API í‚¤ ì°¾ê¸°

1. **APIs & Services** â†’ **Credentials** ë©”ë‰´ë¡œ ì´ë™
2. ì‚¬ìš© ì¤‘ì¸ Google Maps API í‚¤ë¥¼ ì°¾ìŠµë‹ˆë‹¤
   - Key nameì´ "Google Maps API Key" ë˜ëŠ” ìœ ì‚¬í•œ ì´ë¦„ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤
   - ë˜ëŠ” `NEXT_PUBLIC_GOOGLE_MAPS_API_KEY` í™˜ê²½ ë³€ìˆ˜ì— ì„¤ì •ëœ í‚¤ë¥¼ ì°¾ìŠµë‹ˆë‹¤

### 3ë‹¨ê³„: API í‚¤ í¸ì§‘

1. ì°¾ì€ API í‚¤ë¥¼ í´ë¦­í•˜ì—¬ ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™
2. **"Application restrictions"** ì„¹ì…˜ í™•ì¸

### 4ë‹¨ê³„: ì°¸ì¡° URL ì¶”ê°€

**ì˜µì…˜ A: HTTP referrers (ì›¹ ì‚¬ì´íŠ¸) ì œí•œ ì‚¬ìš© (ê¶Œì¥)**

1. **Application restrictions** ì„¹ì…˜ì—ì„œ **"HTTP referrers (web sites)"** ì„ íƒ
2. **"Website restrictions"** ì„¹ì…˜ì— ë‹¤ìŒ URLë“¤ì„ ì¶”ê°€:

   ```
   http://localhost:3000/*
   http://localhost:3000
   https://seoulfounders.club/*
   https://seoulfounders.club
   https://*.vercel.app/*
   ```

   ê° URLì„ í•œ ì¤„ì— í•˜ë‚˜ì”© ì…ë ¥í•©ë‹ˆë‹¤.

3. **"Save"** ë²„íŠ¼ í´ë¦­

**ì˜µì…˜ B: ì œí•œ ì—†ìŒ (ê°œë°œ í™˜ê²½ ì „ìš©, ê¶Œì¥í•˜ì§€ ì•ŠìŒ)**

âš ï¸ **ì£¼ì˜**: ë³´ì•ˆìƒ ê¶Œì¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. í”„ë¡œë•ì…˜ì—ì„œëŠ” ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”.

1. **Application restrictions** ì„¹ì…˜ì—ì„œ **"None"** ì„ íƒ
2. **"Save"** ë²„íŠ¼ í´ë¦­

### 5ë‹¨ê³„: API í‚¤ ì œí•œ í™•ì¸ (ì„ íƒ ì‚¬í•­)

1. **API restrictions** ì„¹ì…˜ í™•ì¸
2. ë‹¤ìŒ APIë“¤ì´ í™œì„±í™”ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸:
   - âœ… Maps JavaScript API
   - âœ… Places API (ìë™ì™„ì„± ê¸°ëŠ¥ ì‚¬ìš© ì‹œ)
   - âœ… Geocoding API (ì£¼ì†Œ ë³€í™˜ ì‚¬ìš© ì‹œ)

### 6ë‹¨ê³„: ë³€ê²½ ì‚¬í•­ ì ìš© ëŒ€ê¸°

- ë³€ê²½ ì‚¬í•­ì´ ì ìš©ë˜ëŠ”ë° ë³´í†µ **5ë¶„ ì´ë‚´** ì†Œìš”ë©ë‹ˆë‹¤
- ë¸Œë¼ìš°ì €ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ë©´ ì—ëŸ¬ê°€ ì‚¬ë¼ì§‘ë‹ˆë‹¤

## ë¡œì»¬ ê°œë°œìš© ì°¸ì¡° URL ëª©ë¡

ë¡œì»¬ ê°œë°œ í™˜ê²½ì—ì„œëŠ” ë‹¤ìŒì„ ì¶”ê°€í•˜ì„¸ìš”:

```
http://localhost:3000/*
http://localhost:3000
http://127.0.0.1:3000/*
http://127.0.0.1:3000
```

## í”„ë¡œë•ì…˜ ë°°í¬ìš© ì°¸ì¡° URL ëª©ë¡

í”„ë¡œë•ì…˜ ë°°í¬ í›„ì—ëŠ” ë‹¤ìŒë„ ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤:

```
https://seoulfounders.club/*
https://seoulfounders.club
https://www.seoulfounders.club/*
https://www.seoulfounders.club
```

Vercelì— ë°°í¬í•˜ëŠ” ê²½ìš°:

```
https://*.vercel.app/*
https://your-project-name.vercel.app/*
```

## ì°¸ê³ ì‚¬í•­

1. **ì™€ì¼ë“œì¹´ë“œ ì‚¬ìš©**: 
   - `/*`ë¡œ ëë‚˜ë©´ í•´ë‹¹ ë„ë©”ì¸ì˜ ëª¨ë“  ê²½ë¡œ í—ˆìš©
   - `*`ëŠ” ëª¨ë“  ì„œë¸Œë„ë©”ì¸ í—ˆìš©

2. **í”„ë¡œí† ì½œ êµ¬ë¶„**:
   - `http://`ì™€ `https://`ëŠ” ë³„ë„ë¡œ ë“±ë¡í•´ì•¼ í•©ë‹ˆë‹¤
   - ë¡œì»¬ ê°œë°œ: `http://`
   - í”„ë¡œë•ì…˜: `https://`

3. **ë³€ê²½ ì‚¬í•­ ë°˜ì˜ ì‹œê°„**:
   - ë³´í†µ ì¦‰ì‹œ ì ìš©ë˜ì§€ë§Œ, ìµœëŒ€ 5ë¶„ê¹Œì§€ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤

4. **í™˜ê²½ ë³€ìˆ˜ í™•ì¸**:
   - `.env.local` íŒŒì¼ì— `NEXT_PUBLIC_GOOGLE_MAPS_API_KEY`ê°€ ì˜¬ë°”ë¥´ê²Œ ì„¤ì •ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”

## ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] Google Cloud Consoleì—ì„œ API í‚¤ ì°¾ê¸°
- [ ] Application restrictionsì—ì„œ "HTTP referrers (web sites)" ì„ íƒ
- [ ] `http://localhost:3000/*` ì¶”ê°€
- [ ] í”„ë¡œë•ì…˜ ë„ë©”ì¸ ì¶”ê°€ (í•„ìš”ì‹œ)
- [ ] Save í´ë¦­
- [ ] ë¸Œë¼ìš°ì € ìƒˆë¡œê³ ì¹¨í•˜ì—¬ ì—ëŸ¬ í•´ê²° í™•ì¸

## ì¶”ê°€ ë„ì›€ë§

- [Google Maps Platform ë¬¸ì„œ](https://developers.google.com/maps/documentation/javascript/get-api-key)
- [API í‚¤ ì œí•œ ì„¤ì • ê°€ì´ë“œ](https://cloud.google.com/docs/authentication/api-keys#restricting_apis)
</file>

<file path="GOOGLE_OAUTH_SETUP.md">
# Google OAuth ì„¤ì • ê°€ì´ë“œ

Seoul Founders Clubì—ì„œ Google ë¡œê·¸ì¸ì„ ì‚¬ìš©í•˜ë ¤ë©´ ë‹¤ìŒ ë‹¨ê³„ë¥¼ ë”°ë¥´ì„¸ìš”.

## 1. Google Cloud Console ì„¤ì •

1. [Google Cloud Console](https://console.cloud.google.com/) ì ‘ì†
2. ìƒˆ í”„ë¡œì íŠ¸ ìƒì„± ë˜ëŠ” ê¸°ì¡´ í”„ë¡œì íŠ¸ ì„ íƒ
3. **APIs & Services** â†’ **Credentials** ì´ë™
4. **+ CREATE CREDENTIALS** â†’ **OAuth client ID** ì„ íƒ
5. ë™ì˜ í™”ë©´ êµ¬ì„± (ì²˜ìŒì¸ ê²½ìš°)
   - User Type: **External** ì„ íƒ
   - ì•± ì´ë¦„, ì§€ì› ì´ë©”ì¼ ì…ë ¥
   - ì €ì¥ ë° ê³„ì†

6. OAuth Client ID ìƒì„±
   - Application type: **Web application**
   - Name: Seoul Founders Club (ë˜ëŠ” ì›í•˜ëŠ” ì´ë¦„)
   
7. **Authorized JavaScript origins** ì¶”ê°€:
   \`\`\`
   https://your-project-ref.supabase.co
   \`\`\`
   (Supabase Dashboard â†’ Project Settings â†’ APIì—ì„œ í™•ì¸)

8. **Authorized redirect URIs** ì¶”ê°€:
   \`\`\`
   https://your-project-ref.supabase.co/auth/v1/callback
   \`\`\`

9. **CREATE** í´ë¦­
10. ìƒì„±ëœ **Client ID**ì™€ **Client Secret** ë³µì‚¬

## 2. Supabase Dashboard ì„¤ì •

1. [Supabase Dashboard](https://supabase.com/dashboard) ì ‘ì†
2. í”„ë¡œì íŠ¸ ì„ íƒ
3. **Authentication** â†’ **Providers** ë©”ë‰´ë¡œ ì´ë™
4. ëª©ë¡ì—ì„œ **Google** ì°¾ê¸°
5. **Enabled** í† ê¸€ì„ ì¼œê¸°
6. Google Cloud Consoleì—ì„œ ë³µì‚¬í•œ ì •ë³´ ì…ë ¥:
   - **Client ID**: ë³µì‚¬í•œ Client ID ë¶™ì—¬ë„£ê¸°
   - **Client Secret**: ë³µì‚¬í•œ Client Secret ë¶™ì—¬ë„£ê¸°
7. **Save** ë²„íŠ¼ í´ë¦­

## 3. ë°°í¬ ì‹œ ì¶”ê°€ ì„¤ì •

v0 í”„ë¦¬ë·°ë‚˜ Vercelì— ë°°í¬í•œ ê²½ìš°, Google Cloud Consoleì˜ **Authorized JavaScript origins**ì™€ **Authorized redirect URIs**ì— ì¶”ê°€ URLì„ ë“±ë¡í•´ì•¼ í•©ë‹ˆë‹¤:

### v0 í”„ë¦¬ë·°:
\`\`\`
https://your-preview-url.vercel.app
https://your-preview-url.vercel.app/auth/callback
\`\`\`

### í”„ë¡œë•ì…˜ ë°°í¬:
\`\`\`
https://your-domain.com
https://your-domain.com/auth/callback
\`\`\`

## 4. í…ŒìŠ¤íŠ¸

1. ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
2. "Googleë¡œ ë¡œê·¸ì¸" ë²„íŠ¼ í´ë¦­
3. Google ê³„ì • ì„ íƒ
4. ê¶Œí•œ ìŠ¹ì¸
5. ìë™ìœ¼ë¡œ ë©”ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸

## ë¬¸ì œ í•´ê²°

### "redirect_uri_mismatch" ì—ëŸ¬
- Google Cloud Consoleì˜ Authorized redirect URIsê°€ ì •í™•íˆ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸
- Supabaseì˜ ì •í™•í•œ URLì„ ì‚¬ìš©í–ˆëŠ”ì§€ í™•ì¸: `https://your-project-ref.supabase.co/auth/v1/callback`

### "Access blocked: This app's request is invalid"
- Google Cloud Consoleì—ì„œ OAuth ë™ì˜ í™”ë©´ì„ ì™„ì„±í–ˆëŠ”ì§€ í™•ì¸
- ì•± ê²Œì‹œ ìƒíƒœ í™•ì¸ (í…ŒìŠ¤íŠ¸ ëª¨ë“œì¸ ê²½ìš° í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì ì¶”ê°€)

### ë¡œê·¸ì¸ í›„ ë¦¬ë‹¤ì´ë ‰íŠ¸ê°€ ì‘ë™í•˜ì§€ ì•ŠìŒ
- `/auth/callback` ë¼ìš°íŠ¸ê°€ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
- ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ ì—ëŸ¬ ë©”ì‹œì§€ í™•ì¸
</file>

<file path="hooks/use-mobile.ts">
import * as React from 'react'

const MOBILE_BREAKPOINT = 768

export function useIsMobile() {
  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)

  React.useEffect(() => {
    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)
    const onChange = () => {
      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)
    }
    mql.addEventListener('change', onChange)
    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)
    return () => mql.removeEventListener('change', onChange)
  }, [])

  return !!isMobile
}
</file>

<file path="hooks/use-toast.ts">
'use client'

// Inspired by react-hot-toast library
import * as React from 'react'

import type { ToastActionElement, ToastProps } from '@/components/ui/toast'

const TOAST_LIMIT = 1
const TOAST_REMOVE_DELAY = 1000000

type ToasterToast = ToastProps & {
  id: string
  title?: React.ReactNode
  description?: React.ReactNode
  action?: ToastActionElement
}

const actionTypes = {
  ADD_TOAST: 'ADD_TOAST',
  UPDATE_TOAST: 'UPDATE_TOAST',
  DISMISS_TOAST: 'DISMISS_TOAST',
  REMOVE_TOAST: 'REMOVE_TOAST',
} as const

let count = 0

function genId() {
  count = (count + 1) % Number.MAX_SAFE_INTEGER
  return count.toString()
}

type ActionType = typeof actionTypes

type Action =
  | {
      type: ActionType['ADD_TOAST']
      toast: ToasterToast
    }
  | {
      type: ActionType['UPDATE_TOAST']
      toast: Partial<ToasterToast>
    }
  | {
      type: ActionType['DISMISS_TOAST']
      toastId?: ToasterToast['id']
    }
  | {
      type: ActionType['REMOVE_TOAST']
      toastId?: ToasterToast['id']
    }

interface State {
  toasts: ToasterToast[]
}

const toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()

const addToRemoveQueue = (toastId: string) => {
  if (toastTimeouts.has(toastId)) {
    return
  }

  const timeout = setTimeout(() => {
    toastTimeouts.delete(toastId)
    dispatch({
      type: 'REMOVE_TOAST',
      toastId: toastId,
    })
  }, TOAST_REMOVE_DELAY)

  toastTimeouts.set(toastId, timeout)
}

export const reducer = (state: State, action: Action): State => {
  switch (action.type) {
    case 'ADD_TOAST':
      return {
        ...state,
        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),
      }

    case 'UPDATE_TOAST':
      return {
        ...state,
        toasts: state.toasts.map((t) =>
          t.id === action.toast.id ? { ...t, ...action.toast } : t,
        ),
      }

    case 'DISMISS_TOAST': {
      const { toastId } = action

      // ! Side effects ! - This could be extracted into a dismissToast() action,
      // but I'll keep it here for simplicity
      if (toastId) {
        addToRemoveQueue(toastId)
      } else {
        state.toasts.forEach((toast) => {
          addToRemoveQueue(toast.id)
        })
      }

      return {
        ...state,
        toasts: state.toasts.map((t) =>
          t.id === toastId || toastId === undefined
            ? {
                ...t,
                open: false,
              }
            : t,
        ),
      }
    }
    case 'REMOVE_TOAST':
      if (action.toastId === undefined) {
        return {
          ...state,
          toasts: [],
        }
      }
      return {
        ...state,
        toasts: state.toasts.filter((t) => t.id !== action.toastId),
      }
  }
}

const listeners: Array<(state: State) => void> = []

let memoryState: State = { toasts: [] }

function dispatch(action: Action) {
  memoryState = reducer(memoryState, action)
  listeners.forEach((listener) => {
    listener(memoryState)
  })
}

type Toast = Omit<ToasterToast, 'id'>

function toast({ ...props }: Toast) {
  const id = genId()

  const update = (props: ToasterToast) =>
    dispatch({
      type: 'UPDATE_TOAST',
      toast: { ...props, id },
    })
  const dismiss = () => dispatch({ type: 'DISMISS_TOAST', toastId: id })

  dispatch({
    type: 'ADD_TOAST',
    toast: {
      ...props,
      id,
      open: true,
      onOpenChange: (open) => {
        if (!open) dismiss()
      },
    },
  })

  return {
    id: id,
    dismiss,
    update,
  }
}

function useToast() {
  const [state, setState] = React.useState<State>(memoryState)

  React.useEffect(() => {
    listeners.push(setState)
    return () => {
      const index = listeners.indexOf(setState)
      if (index > -1) {
        listeners.splice(index, 1)
      }
    }
  }, [state])

  return {
    ...state,
    toast,
    dismiss: (toastId?: string) => dispatch({ type: 'DISMISS_TOAST', toastId }),
  }
}

export { useToast, toast }
</file>

<file path="lib/actions/admin.ts">
"use server"

import { createClient } from "@/lib/supabase/server"
import { revalidatePath } from "next/cache"
import { isMasterAdmin } from "@/lib/utils"

export async function updateUserRole(userId: string, role: string) {
  const supabase = await createClient()

  const {
    data: { user },
  } = await supabase.auth.getUser()

  if (!user) {
    throw new Error("Unauthorized")
  }

  // Check if current user is master admin (only master can change roles)
  const { data: profile } = await supabase
    .from("profiles")
    .select("role, email")
    .eq("id", user.id)
    .single()

  if (!profile || !isMasterAdmin(profile.role, profile.email)) {
    throw new Error("Unauthorized: Only master admins can change user roles")
  }

  // Validate role value
  if (!["member", "admin", "master"].includes(role)) {
    throw new Error("Invalid role value")
  }

  // Prevent changing own role from master to something else
  if (user.id === userId && profile.role === "master" && role !== "master") {
    throw new Error("Cannot change your own master role")
  }

  // Update role with select to verify update
  console.log(`[updateUserRole] ì‹œì‘: userId=${userId}, newRole=${role}, currentUserId=${user.id}`)
  
  const { data, error } = await supabase
    .from("profiles")
    .update({ role })
    .eq("id", userId)
    .select("id, role, email") // ì—…ë°ì´íŠ¸ëœ ë°ì´í„°ë¥¼ ë°˜í™˜ë°›ê¸° ìœ„í•´ .select() ì¶”ê°€

  if (error) {
    console.error("[updateUserRole] Supabase ì—ëŸ¬:", {
      code: error.code,
      message: error.message,
      details: error.details,
      hint: error.hint,
      userId,
      role,
      currentUserId: user.id,
    })
    
    // RLS ì •ì±… ë¬¸ì œ (42501: insufficient_privilege)
    if (error.code === '42501') {
      throw new Error(`ê¶Œí•œ ë¶€ì¡±: ì—­í•  ì—…ë°ì´íŠ¸ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. RLS ì •ì±…ì„ í™•ì¸í•´ì£¼ì„¸ìš”. (ì—ëŸ¬ ì½”ë“œ: ${error.code})`)
    }
    
    // ê¸°íƒ€ ì—ëŸ¬
    throw new Error(`ì—­í•  ì—…ë°ì´íŠ¸ ì‹¤íŒ¨: ${error.message} (ì—ëŸ¬ ì½”ë“œ: ${error.code})`)
  }
  
  // ì‹¤ì œë¡œ ì—…ë°ì´íŠ¸ëœ í–‰ì´ ìˆëŠ”ì§€ í™•ì¸
  if (!data || data.length === 0) {
    console.error("[updateUserRole] DB ì—…ë°ì´íŠ¸ ì‹¤íŒ¨: ìˆ˜ì •ëœ í–‰ì´ ì—†ìŠµë‹ˆë‹¤.", {
      userId,
      role,
      currentUserId: user.id,
      returnedData: data,
      possibleCauses: [
        "RLS ì •ì±…ì´ UPDATEë¥¼ ë§‰ê³  ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤",
        "userIdê°€ ì¡´ì¬í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤",
        "ì¡°ê±´ì— ë§ëŠ” í–‰ì´ ì—†ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤",
      ],
    })
    throw new Error("DB ì—…ë°ì´íŠ¸ ì‹¤íŒ¨: ìˆ˜ì •ëœ í–‰ì´ ì—†ìŠµë‹ˆë‹¤. RLS ì •ì±… ë˜ëŠ” userIdë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.")
  }
  
  console.log(`[updateUserRole] ì„±ê³µ: userId=${userId}, updatedData=`, data)
  console.log(`[updateUserRole] ì—…ë°ì´íŠ¸ëœ í–‰ ìˆ˜: ${data.length}`)

  revalidatePath("/admin/users")
  revalidatePath("/admin/roles")
  return { success: true, updatedData: data[0] }
}

export async function updateUserMembershipTier(userId: string, membershipTier: string) {
  const supabase = await createClient()

  const {
    data: { user },
  } = await supabase.auth.getUser()

  if (!user) {
    throw new Error("Unauthorized")
  }

  // Check if current user is admin or master
  const { data: profile } = await supabase
    .from("profiles")
    .select("role, email")
    .eq("id", user.id)
    .single()

  if (!profile) {
    throw new Error("Unauthorized")
  }

  // Use isAdmin helper to check admin or master
  const { isAdmin } = await import("@/lib/utils")
  if (!isAdmin(profile.role, profile.email)) {
    throw new Error("Unauthorized")
  }

  // Update membership tier
  const { error } = await supabase.from("profiles").update({ membership_tier: membershipTier }).eq("id", userId)

  if (error) {
    throw new Error(error.message)
  }

  revalidatePath("/admin/users")
  return { success: true }
}

export async function updateBadgeStatus(
  userBadgeId: string,
  status: 'approved' | 'rejected',
  rejectionReason?: string
) {
  const supabase = await createClient()

  const {
    data: { user },
  } = await supabase.auth.getUser()

  if (!user) {
    throw new Error("Unauthorized")
  }

  // Check if current user is admin or master
  const { data: profile } = await supabase
    .from("profiles")
    .select("role, email")
    .eq("id", user.id)
    .single()

  if (!profile) {
    throw new Error("Unauthorized")
  }

  // Use isAdmin helper to check admin or master
  const { isAdmin } = await import("@/lib/utils")
  if (!isAdmin(profile.role, profile.email)) {
    throw new Error("Unauthorized: Only admins can update badge status")
  }

  // ë¨¼ì € user_badge ì •ë³´ ê°€ì ¸ì˜¤ê¸° (ì•Œë¦¼ ìƒì„±ì„ ìœ„í•´)
  const { data: userBadge } = await supabase
    .from("user_badges")
    .select(`
      user_id,
      badges:badge_id (name, icon)
    `)
    .eq("id", userBadgeId)
    .single()

  // Update badge status
  const updateData: { status: string; is_visible?: boolean; rejection_reason?: string | null } = { status }

  // ìŠ¹ì¸ ì‹œ is_visibleì„ trueë¡œ ì„¤ì •
  if (status === 'approved') {
    updateData.is_visible = true
    updateData.rejection_reason = null
  } else {
    // ê±°ì ˆ ì‹œ is_visibleì„ falseë¡œ ìœ ì§€í•˜ê³  ë°˜ë ¤ ì‚¬ìœ  ì €ì¥
    updateData.is_visible = false
    updateData.rejection_reason = rejectionReason || null
  }

  const { error } = await supabase
    .from("user_badges")
    .update(updateData)
    .eq("id", userBadgeId)

  if (error) {
    throw new Error(error.message)
  }

  // ì•Œë¦¼ ìƒì„±
  if (userBadge?.user_id) {
    const badge = Array.isArray(userBadge.badges) ? userBadge.badges[0] : userBadge.badges
    const badgeName = badge?.name || 'ë±ƒì§€'
    const badgeIcon = badge?.icon || 'ğŸ…'

    if (status === 'approved') {
      await supabase.from("notifications").insert({
        user_id: userBadge.user_id,
        type: 'badge_approved',
        title: 'ë±ƒì§€ ìŠ¹ì¸',
        message: `${badgeIcon} ${badgeName} ë±ƒì§€ ì‹ ì²­ì´ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.`,
        actor_id: user.id,
      })
    } else {
      const reasonText = rejectionReason ? `\nì‚¬ìœ : ${rejectionReason}` : ''
      await supabase.from("notifications").insert({
        user_id: userBadge.user_id,
        type: 'badge_rejected',
        title: 'ë±ƒì§€ ë°˜ë ¤',
        message: `${badgeIcon} ${badgeName} ë±ƒì§€ ì‹ ì²­ì´ ë°˜ë ¤ë˜ì—ˆìŠµë‹ˆë‹¤.${reasonText}`,
        actor_id: user.id,
      })
    }
  }

  revalidatePath("/admin/badges")
  revalidatePath("/admin")
  return { success: true }
}

export async function createBadge(name: string, icon: string, category: string, description: string | null) {
  const supabase = await createClient()

  const {
    data: { user },
  } = await supabase.auth.getUser()

  if (!user) {
    throw new Error("Unauthorized")
  }

  // Check if current user is admin or master
  const { data: profile } = await supabase
    .from("profiles")
    .select("role, email")
    .eq("id", user.id)
    .single()

  if (!profile) {
    throw new Error("Unauthorized")
  }

  // Use isAdmin helper to check admin or master
  const { isAdmin } = await import("@/lib/utils")
  if (!isAdmin(profile.role, profile.email)) {
    throw new Error("Unauthorized: Only admins can create badges")
  }

  // Insert new badge
  const { error } = await supabase
    .from("badges")
    .insert({
      name,
      icon,
      category,
      description,
    })

  if (error) {
    throw new Error(error.message)
  }

  revalidatePath("/admin")
  revalidatePath("/about")
  return { success: true }
}

export async function updateBadge(badgeId: string, name: string, icon: string, category: string, description: string | null) {
  const supabase = await createClient()

  const {
    data: { user },
  } = await supabase.auth.getUser()

  if (!user) {
    throw new Error("Unauthorized")
  }

  // Check if current user is admin or master
  const { data: profile } = await supabase
    .from("profiles")
    .select("role, email")
    .eq("id", user.id)
    .single()

  if (!profile) {
    throw new Error("Unauthorized")
  }

  // Use isAdmin helper to check admin or master
  const { isAdmin } = await import("@/lib/utils")
  if (!isAdmin(profile.role, profile.email)) {
    throw new Error("Unauthorized: Only admins can update badges")
  }

  // Update badge
  const { error } = await supabase
    .from("badges")
    .update({
      name,
      icon,
      category,
      description,
    })
    .eq("id", badgeId)

  if (error) {
    throw new Error(error.message)
  }

  revalidatePath("/admin")
  revalidatePath("/about")
  return { success: true }
}

export async function deleteBadge(badgeId: string) {
  const supabase = await createClient()

  const {
    data: { user },
  } = await supabase.auth.getUser()

  if (!user) {
    throw new Error("Unauthorized")
  }

  // Check if current user is admin or master
  const { data: profile } = await supabase
    .from("profiles")
    .select("role, email")
    .eq("id", user.id)
    .single()

  if (!profile) {
    throw new Error("Unauthorized")
  }

  // Use isAdmin helper to check admin or master
  const { isAdmin } = await import("@/lib/utils")
  if (!isAdmin(profile.role, profile.email)) {
    throw new Error("Unauthorized: Only admins can delete badges")
  }

  // Delete badge (cascade delete will handle user_badges)
  const { error } = await supabase
    .from("badges")
    .delete()
    .eq("id", badgeId)

  if (error) {
    throw new Error(error.message)
  }

  revalidatePath("/admin")
  revalidatePath("/about")
  return { success: true }
}

export async function toggleBadgeActive(badgeId: string, isActive: boolean) {
  const supabase = await createClient()

  const {
    data: { user },
  } = await supabase.auth.getUser()

  if (!user) {
    throw new Error("Unauthorized")
  }

  // Check if current user is admin or master
  const { data: profile } = await supabase
    .from("profiles")
    .select("role, email")
    .eq("id", user.id)
    .single()

  if (!profile) {
    throw new Error("Unauthorized")
  }

  // Use isAdmin helper to check admin or master
  const { isAdmin } = await import("@/lib/utils")
  if (!isAdmin(profile.role, profile.email)) {
    throw new Error("Unauthorized: Only admins can toggle badge active status")
  }

  // Update badge active status
  // is_active ì»¬ëŸ¼ì´ ì—†ì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì—ëŸ¬ ì²˜ë¦¬
  // âš ï¸ RLS ì •ì±… í™•ì¸ í•„ìš”: Supabaseì˜ Row Level Security ì •ì±…ì´ UPDATEë¥¼ ë§‰ê³  ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  //    badges í…Œì´ë¸”ì— ê´€ë¦¬ì(admin, master)ê°€ UPDATEí•  ìˆ˜ ìˆëŠ” ì •ì±…ì´ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.
  console.log(`[toggleBadgeActive] ì‹œì‘: badgeId=${badgeId}, isActive=${isActive}, userId=${user.id}`)
  
  const { data, error } = await supabase
    .from("badges")
    .update({ is_active: isActive })
    .eq("id", badgeId)
    .select() // ì—…ë°ì´íŠ¸ëœ ë°ì´í„°ë¥¼ ë°˜í™˜ë°›ê¸° ìœ„í•´ .select() ì¶”ê°€

  if (error) {
    console.error("[toggleBadgeActive] Supabase ì—ëŸ¬:", {
      code: error.code,
      message: error.message,
      details: error.details,
      hint: error.hint,
      badgeId,
      isActive,
      userId: user.id,
    })
    
    // ì»¬ëŸ¼ì´ ì—†ëŠ” ê²½ìš° (42703: undefined_column)
    if (error.code === '42703') {
      throw new Error("is_active ì»¬ëŸ¼ì´ ë°ì´í„°ë² ì´ìŠ¤ì— ì—†ìŠµë‹ˆë‹¤. ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸(034_add_badge_is_active.sql)ë¥¼ ì‹¤í–‰í•´ì£¼ì„¸ìš”.")
    }
    
    // RLS ì •ì±… ë¬¸ì œ (42501: insufficient_privilege)
    if (error.code === '42501') {
      throw new Error(`ê¶Œí•œ ë¶€ì¡±: ë±ƒì§€ ì—…ë°ì´íŠ¸ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. ê´€ë¦¬ì ê¶Œí•œì„ í™•ì¸í•´ì£¼ì„¸ìš”. (ì—ëŸ¬ ì½”ë“œ: ${error.code})`)
    }
    
    // ê¸°íƒ€ ì—ëŸ¬
    throw new Error(`ë±ƒì§€ ìƒíƒœ ë³€ê²½ ì‹¤íŒ¨: ${error.message} (ì—ëŸ¬ ì½”ë“œ: ${error.code})`)
  }
  
  // ì‹¤ì œë¡œ ì—…ë°ì´íŠ¸ëœ í–‰ì´ ìˆëŠ”ì§€ í™•ì¸
  if (!data || data.length === 0) {
    console.error("[toggleBadgeActive] DB ì—…ë°ì´íŠ¸ ì‹¤íŒ¨: ìˆ˜ì •ëœ í–‰ì´ ì—†ìŠµë‹ˆë‹¤.", {
      badgeId,
      isActive,
      userId: user.id,
      returnedData: data,
      possibleCauses: [
        "RLS ì •ì±…ì´ UPDATEë¥¼ ë§‰ê³  ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤",
        "badgeIdê°€ ì¡´ì¬í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤",
        "ì¡°ê±´ì— ë§ëŠ” í–‰ì´ ì—†ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤",
      ],
    })
    throw new Error("DB ì—…ë°ì´íŠ¸ ì‹¤íŒ¨: ìˆ˜ì •ëœ í–‰ì´ ì—†ìŠµë‹ˆë‹¤. RLS ì •ì±… ë˜ëŠ” badgeIdë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.")
  }
  
  console.log(`[toggleBadgeActive] ì„±ê³µ: badgeId=${badgeId}, updatedData=`, data)
  console.log(`[toggleBadgeActive] ì—…ë°ì´íŠ¸ëœ í–‰ ìˆ˜: ${data.length}`)

  revalidatePath("/admin")
  revalidatePath("/about")
  return { success: true, updatedData: data[0] }
}
</file>

<file path="lib/actions/badge-categories.ts">
"use server"

import { createClient } from "@/lib/supabase/server"
import { createAdminClient } from "@/lib/supabase/admin"
import { revalidatePath } from "next/cache"
import { isAdmin } from "@/lib/utils"

/**
 * ë±ƒì§€ ì¹´í…Œê³ ë¦¬ ìˆœì„œ ì—…ë°ì´íŠ¸
 * 
 * ì£¼ì˜: badge_categories í…Œì´ë¸”ì— sort_order ì»¬ëŸ¼ì´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.
 * ë§Œì•½ ì»¬ëŸ¼ì´ ì—†ë‹¤ë©´ ë‹¤ìŒ SQLì„ ì‹¤í–‰í•˜ì„¸ìš”:
 * 
 * ALTER TABLE public.badge_categories
 * ADD COLUMN IF NOT EXISTS sort_order INTEGER DEFAULT 0 NOT NULL;
 * 
 * CREATE INDEX IF NOT EXISTS idx_badge_categories_sort_order 
 * ON public.badge_categories(sort_order);
 */
export async function updateBadgeCategoryOrder(items: { category_value: string; sort_order: number }[]) {
  // ì‚¬ìš©ì ì¸ì¦ í™•ì¸ (ì¼ë°˜ í´ë¼ì´ì–¸íŠ¸ ì‚¬ìš©)
  const supabase = await createClient()

  const {
    data: { user },
  } = await supabase.auth.getUser()

  if (!user) {
    throw new Error("Unauthorized")
  }

  // ê´€ë¦¬ì ê¶Œí•œ í™•ì¸
  const { data: profile } = await supabase
    .from("profiles")
    .select("role, email")
    .eq("id", user.id)
    .single()

  if (!profile || !isAdmin(profile.role, profile.email)) {
    throw new Error("Unauthorized: Only admins can update badge category order")
  }

  // RLS ìš°íšŒë¥¼ ìœ„í•´ Service Role Keyë¥¼ ì‚¬ìš©í•˜ëŠ” ê´€ë¦¬ì í´ë¼ì´ì–¸íŠ¸ ì‚¬ìš©
  const supabaseAdmin = createAdminClient()

  // íŠ¸ëœì­ì…˜ìœ¼ë¡œ ì¼ê´„ ì—…ë°ì´íŠ¸
  const updates = items.map((item) =>
    supabaseAdmin
      .from("badge_categories")
      .update({ sort_order: item.sort_order, updated_at: new Date().toISOString() })
      .eq("category_value", item.category_value)
  )

  const results = await Promise.all(updates)

  // ì—ëŸ¬ í™•ì¸ ë° ìƒì„¸ ë¡œê¹…
  const errors = results.filter((result) => result.error)
  if (errors.length > 0) {
    console.error("Failed to update badge category order:")
    console.error("Error details:", JSON.stringify(errors, null, 2))
    
    // ê° ì—ëŸ¬ì˜ ìƒì„¸ ì •ë³´ ì¶œë ¥
    errors.forEach((result, index) => {
      console.error(`Error ${index + 1}:`, {
        message: result.error?.message,
        code: result.error?.code,
        details: result.error?.details,
        hint: result.error?.hint,
      })
    })
    
    throw new Error(
      `ì¹´í…Œê³ ë¦¬ ìˆœì„œ ì—…ë°ì´íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ${errors.length}ê°œì˜ í•­ëª©ì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.` +
      ` ì²« ë²ˆì§¸ ì˜¤ë¥˜: ${errors[0]?.error?.message || "Unknown error"}`
    )
  }

  revalidatePath("/admin")
  revalidatePath("/about")
  return { success: true }
}

export async function createBadgeCategory(label: string, value: string) {
  const supabase = await createClient()
  const { data: { user } } = await supabase.auth.getUser()

  if (!user) {
    throw new Error("Unauthorized")
  }

  const { data: profile } = await supabase
    .from("profiles")
    .select("role, email")
    .eq("id", user.id)
    .single()

  if (!profile || !isAdmin(profile.role, profile.email)) {
    throw new Error("Unauthorized: Only admins can create badge categories")
  }

  const supabaseAdmin = createAdminClient()

  // ë§ˆì§€ë§‰ ìˆœì„œ ì¡°íšŒ
  const { data: lastCategory } = await supabaseAdmin
    .from("badge_categories")
    .select("sort_order")
    .order("sort_order", { ascending: false })
    .limit(1)
    .single()

  const nextOrder = (lastCategory?.sort_order ?? 0) + 1

  const { error } = await supabaseAdmin
    .from("badge_categories")
    .insert({
      category_label: label,
      category_value: value,
      sort_order: nextOrder,
    })

  if (error) {
    console.error("Failed to create badge category:", error)
    throw new Error(error.message)
  }

  revalidatePath("/admin")
  revalidatePath("/about")
  return { success: true }
}

export async function updateBadgeCategory(oldValue: string, label: string) {
  const supabase = await createClient()
  const { data: { user } } = await supabase.auth.getUser()

  if (!user) {
    throw new Error("Unauthorized")
  }

  const { data: profile } = await supabase
    .from("profiles")
    .select("role, email")
    .eq("id", user.id)
    .single()

  if (!profile || !isAdmin(profile.role, profile.email)) {
    throw new Error("Unauthorized: Only admins can update badge categories")
  }

  const supabaseAdmin = createAdminClient()

  const { error } = await supabaseAdmin
    .from("badge_categories")
    .update({
      category_label: label,
      updated_at: new Date().toISOString(),
    })
    .eq("category_value", oldValue)

  if (error) {
    console.error("Failed to update badge category:", error)
    throw new Error(error.message)
  }

  revalidatePath("/admin")
  revalidatePath("/about")
  return { success: true }
}

export async function deleteBadgeCategory(value: string) {
  const supabase = await createClient()
  const { data: { user } } = await supabase.auth.getUser()

  if (!user) {
    throw new Error("Unauthorized")
  }

  const { data: profile } = await supabase
    .from("profiles")
    .select("role, email")
    .eq("id", user.id)
    .single()

  if (!profile || !isAdmin(profile.role, profile.email)) {
    throw new Error("Unauthorized: Only admins can delete badge categories")
  }

  const supabaseAdmin = createAdminClient()

  // 1. í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì— ì†í•œ ë±ƒì§€ê°€ ìˆëŠ”ì§€ í™•ì¸
  const { count, error: countError } = await supabaseAdmin
    .from("badges")
    .select("*", { count: 'exact', head: true })
    .eq("category", value)

  if (countError) {
    throw new Error(countError.message)
  }

  if (count && count > 0) {
    throw new Error("ì´ ì¹´í…Œê³ ë¦¬ì— ì†í•œ ë±ƒì§€ê°€ ìˆì–´ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë±ƒì§€ë¥¼ ë¨¼ì € ì‚­ì œí•˜ê±°ë‚˜ ë‹¤ë¥¸ ì¹´í…Œê³ ë¦¬ë¡œ ì´ë™í•´ì£¼ì„¸ìš”.")
  }

  const { error } = await supabaseAdmin
    .from("badge_categories")
    .delete()
    .eq("category_value", value)

  if (error) {
    console.error("Failed to delete badge category:", error)
    throw new Error(error.message)
  }

  revalidatePath("/admin")
  revalidatePath("/about")
  return { success: true }
}
</file>

<file path="lib/actions/badges.ts">
"use server"

import { createClient } from "@/lib/supabase/server"
import { revalidatePath } from "next/cache"

export async function toggleBadgeVisibility(badgeId: string, isVisible: boolean) {
  const supabase = await createClient()

  const {
    data: { user },
  } = await supabase.auth.getUser()

  if (!user) {
    throw new Error("Unauthorized")
  }

  // Update badge visibility
  const { error } = await supabase
    .from("user_badges")
    .update({ is_visible: isVisible })
    .eq("user_id", user.id)
    .eq("badge_id", badgeId)

  if (error) {
    throw new Error(error.message)
  }

  revalidatePath("/community/profile")
  return { success: true }
}

export async function grantBadge(userId: string, badgeId: string) {
  const supabase = await createClient()

  const {
    data: { user },
  } = await supabase.auth.getUser()

  if (!user) {
    throw new Error("Unauthorized")
  }

  // Check if badge already exists for user
  const { data: existing } = await supabase
    .from("user_badges")
    .select("id")
    .eq("user_id", userId)
    .eq("badge_id", badgeId)
    .single()

  if (existing) {
    throw new Error("ì´ë¯¸ ë¶€ì—¬ëœ ë±ƒì§€ì…ë‹ˆë‹¤.")
  }

  // Insert new user_badge
  const { error } = await supabase
    .from("user_badges")
    .insert({
      user_id: userId,
      badge_id: badgeId,
      is_visible: true, // ê¸°ë³¸ê°’ìœ¼ë¡œ ë…¸ì¶œ ì„¤ì •
    })

  if (error) {
    throw new Error(error.message)
  }

  revalidatePath("/community/profile")
  return { success: true }
}

export async function removeBadge(userBadgeId: string) {
  const supabase = await createClient()

  const {
    data: { user },
  } = await supabase.auth.getUser()

  if (!user) {
    throw new Error("Unauthorized")
  }

  // Delete user_badge
  const { error } = await supabase
    .from("user_badges")
    .delete()
    .eq("id", userBadgeId)
    .eq("user_id", user.id)

  if (error) {
    throw new Error(error.message)
  }

  revalidatePath("/community/profile")
  return { success: true }
}

export async function requestBadge(
  userId: string, 
  badgeId: string, 
  evidence: string,
  proofUrl?: string | null
) {
  const supabase = await createClient()

  const {
    data: { user },
  } = await supabase.auth.getUser()

  if (!user) {
    throw new Error("Unauthorized")
  }

  // ë³¸ì¸ë§Œ ì‹ ì²­ ê°€ëŠ¥
  if (user.id !== userId) {
    throw new Error("Unauthorized")
  }

  // Check if badge already exists for user
  const { data: existing, error: existingError } = await supabase
    .from("user_badges")
    .select("id, status")
    .eq("user_id", userId)
    .eq("badge_id", badgeId)
    .maybeSingle()

  // ì—ëŸ¬ê°€ ë°œìƒí–ˆì§€ë§Œ "not found"ê°€ ì•„ë‹Œ ê²½ìš°ì—ë§Œ ì—ëŸ¬ ì²˜ë¦¬
  if (existingError && existingError.code !== 'PGRST116') {
    console.error("Error checking existing badge:", existingError)
    throw new Error(`ë±ƒì§€ í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${existingError.message}`)
  }

  if (existing) {
    // status ì»¬ëŸ¼ì´ ì—†ëŠ” ê²½ìš°ë¥¼ ëŒ€ë¹„ (ê¸°ì¡´ ë°ì´í„° í˜¸í™˜ì„±)
    const status = existing.status || 'approved'
    
    if (status === 'pending') {
      throw new Error("ì´ë¯¸ ì‹ ì²­ ëŒ€ê¸° ì¤‘ì¸ ë±ƒì§€ì…ë‹ˆë‹¤.")
    }
    if (status === 'approved') {
      throw new Error("ì´ë¯¸ ìŠ¹ì¸ëœ ë±ƒì§€ì…ë‹ˆë‹¤.")
    }
    // rejectedì¸ ê²½ìš° ì¬ì‹ ì²­ ê°€ëŠ¥í•˜ë„ë¡ ê¸°ì¡´ ë ˆì½”ë“œ ì‚­ì œ
    const { error: deleteError } = await supabase
      .from("user_badges")
      .delete()
      .eq("id", existing.id)
    
    if (deleteError) {
      console.error("Error deleting existing badge:", deleteError)
      throw new Error(`ê¸°ì¡´ ë±ƒì§€ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${deleteError.message}`)
    }
  }

  // Insert new user_badge with pending status
  const { error } = await supabase
    .from("user_badges")
    .insert({
      user_id: userId,
      badge_id: badgeId,
      status: 'pending',
      evidence: evidence.trim() || null,
      proof_url: proofUrl || null,
      is_visible: false, // ìŠ¹ì¸ ì „ê¹Œì§€ëŠ” ë…¸ì¶œí•˜ì§€ ì•ŠìŒ
    })

  if (error) {
    throw new Error(error.message)
  }

  revalidatePath("/community/profile")
  return { success: true }
}
</file>

<file path="lib/actions/community-moderators.ts">
"use server"

import { createClient } from "@/lib/supabase/server"
import { createAdminClient } from "@/lib/supabase/admin"
import { revalidatePath } from "next/cache"
import { isAdmin } from "@/lib/utils"

/**
 * ì»¤ë®¤ë‹ˆí‹° ê´€ë¦¬ì ì¶”ê°€
 */
export async function addModerator(communityId: string, userId: string, role: "owner" | "moderator" = "moderator") {
    const supabase = await createClient()

    const {
        data: { user },
    } = await supabase.auth.getUser()

    if (!user) {
        throw new Error("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.")
    }

    // í˜„ì¬ ì‚¬ìš©ìê°€ ê´€ë¦¬ì ê¶Œí•œì´ ìˆëŠ”ì§€ í™•ì¸
    const { data: profile } = await supabase
        .from("profiles")
        .select("role, email")
        .eq("id", user.id)
        .single()

    const isGlobalAdmin = isAdmin(profile?.role, profile?.email)

    // ê¸€ë¡œë²Œ ê´€ë¦¬ìê°€ ì•„ë‹ˆë©´ ì»¤ë®¤ë‹ˆí‹° ownerì¸ì§€ í™•ì¸
    if (!isGlobalAdmin) {
        const { data: moderator } = await supabase
            .from("community_moderators")
            .select("role")
            .eq("community_id", communityId)
            .eq("user_id", user.id)
            .single()

        if (!moderator || moderator.role !== "owner") {
            throw new Error("ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. ì»¤ë®¤ë‹ˆí‹° ì†Œìœ ìë§Œ ê´€ë¦¬ìë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.")
        }
    }

    // Service Role Keyë¥¼ ì‚¬ìš©í•˜ì—¬ ê´€ë¦¬ì ì¶”ê°€
    const supabaseAdmin = createAdminClient()

    const { error } = await supabaseAdmin
        .from("community_moderators")
        .insert({
            community_id: communityId,
            user_id: userId,
            role: role,
        })

    if (error) {
        console.error("ê´€ë¦¬ì ì¶”ê°€ ì˜¤ë¥˜:", error)
        throw new Error("ê´€ë¦¬ì ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")
    }

    revalidatePath("/community")
    return { success: true }
}

/**
 * ì»¤ë®¤ë‹ˆí‹° ê´€ë¦¬ì ì œê±°
 */
export async function removeModerator(communityId: string, userId: string) {
    const supabase = await createClient()

    const {
        data: { user },
    } = await supabase.auth.getUser()

    if (!user) {
        throw new Error("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.")
    }

    // í˜„ì¬ ì‚¬ìš©ìê°€ ê´€ë¦¬ì ê¶Œí•œì´ ìˆëŠ”ì§€ í™•ì¸
    const { data: profile } = await supabase
        .from("profiles")
        .select("role, email")
        .eq("id", user.id)
        .single()

    const isGlobalAdmin = isAdmin(profile?.role, profile?.email)

    // ê¸€ë¡œë²Œ ê´€ë¦¬ìê°€ ì•„ë‹ˆë©´ ì»¤ë®¤ë‹ˆí‹° ownerì¸ì§€ í™•ì¸
    if (!isGlobalAdmin) {
        const { data: moderator } = await supabase
            .from("community_moderators")
            .select("role")
            .eq("community_id", communityId)
            .eq("user_id", user.id)
            .single()

        if (!moderator || moderator.role !== "owner") {
            throw new Error("ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. ì»¤ë®¤ë‹ˆí‹° ì†Œìœ ìë§Œ ê´€ë¦¬ìë¥¼ ì œê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.")
        }
    }

    // Service Role Keyë¥¼ ì‚¬ìš©í•˜ì—¬ ê´€ë¦¬ì ì œê±°
    const supabaseAdmin = createAdminClient()

    const { error } = await supabaseAdmin
        .from("community_moderators")
        .delete()
        .eq("community_id", communityId)
        .eq("user_id", userId)

    if (error) {
        console.error("ê´€ë¦¬ì ì œê±° ì˜¤ë¥˜:", error)
        throw new Error("ê´€ë¦¬ì ì œê±°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")
    }

    revalidatePath("/community")
    return { success: true }
}

/**
 * ì»¤ë®¤ë‹ˆí‹° ê´€ë¦¬ì ê¶Œí•œ í™•ì¸
 */
export async function checkModeratorRole(communityId: string, userId: string) {
    const supabase = await createClient()

    const { data, error } = await supabase
        .from("community_moderators")
        .select("role")
        .eq("community_id", communityId)
        .eq("user_id", userId)
        .single()

    if (error && error.code !== "PGRST116") {
        console.error("ê´€ë¦¬ì ê¶Œí•œ í™•ì¸ ì˜¤ë¥˜:", error)
        return null
    }

    return data?.role || null
}
</file>

<file path="lib/actions/inquiries.ts">
"use server"

import { createClient } from "@/lib/supabase/server"
import { revalidatePath } from "next/cache"

export async function createInquiry(data: {
  type: string
  title: string
  content: string
}) {
  const supabase = await createClient()

  // í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸° (ì„ íƒì‚¬í•­ - ë¹„ë¡œê·¸ì¸ ì‚¬ìš©ìë„ ë¬¸ì˜ ê°€ëŠ¥í•˜ë„ë¡)
  const {
    data: { user },
  } = await supabase.auth.getUser()

  const insertData: any = {
    type: data.type.trim(),
    title: data.title.trim(),
    content: data.content.trim(),
    user_id: user?.id || null, // ë¡œê·¸ì¸í•œ ê²½ìš°ì—ë§Œ user_id ì €ì¥
    status: "pending", // ê¸°ë³¸ ìƒíƒœ: ëŒ€ê¸° ì¤‘
  }

  const { error } = await supabase.from("inquiries").insert(insertData).select("id").single()

  if (error) {
    // í…Œì´ë¸”ì´ ì—†ì„ ê²½ìš°ë¥¼ ëŒ€ë¹„í•œ ì—ëŸ¬ ì²˜ë¦¬
    if (error.code === "42P01") {
      throw new Error("ë¬¸ì˜ í…Œì´ë¸”ì´ ì•„ì§ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.")
    }
    throw new Error(error.message)
  }

  revalidatePath("/customer-center")
  return { success: true }
}
</file>

<file path="lib/actions/partner-applications.ts">
"use server"

import { createClient } from "@/lib/supabase/server"
import { revalidatePath } from "next/cache"
import { isAdmin } from "@/lib/utils"

export async function updatePartnerApplicationStatus(
  applicationId: string,
  status: "approved" | "rejected"
) {
  const supabase = await createClient()

  // ê´€ë¦¬ì ê¶Œí•œ í™•ì¸
  const {
    data: { user },
  } = await supabase.auth.getUser()

  if (!user) {
    throw new Error("Unauthorized")
  }

  const { data: profile } = await supabase
    .from("profiles")
    .select("role, email")
    .eq("id", user.id)
    .single()

  if (!profile || !isAdmin(profile.role, profile.email)) {
    throw new Error("Unauthorized: Only admins can update partner applications")
  }

  // ìƒíƒœ ì—…ë°ì´íŠ¸
  const { error } = await supabase
    .from("partner_applications")
    .update({ status })
    .eq("id", applicationId)

  if (error) {
    throw new Error(error.message)
  }

  revalidatePath("/admin")
  return { success: true }
}
</file>

<file path="lib/actions/partner-proposals.ts">
"use server"

import { createClient } from "@/lib/supabase/server"
import { revalidatePath } from "next/cache"

export async function createPartnerProposal(data: {
  contactName: string
  contactEmail: string
  companyName: string
  serviceName: string
  websiteUrl?: string
  benefitProposal: string
  thumbnailUrl?: string
}) {
  const supabase = await createClient()

  // ì´ë©”ì¼ í˜•ì‹ ê²€ì¦
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/
  if (!emailRegex.test(data.contactEmail)) {
    throw new Error("ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.")
  }

  // URL í˜•ì‹ ê²€ì¦ (ìˆëŠ” ê²½ìš°)
  if (data.websiteUrl && data.websiteUrl.trim() !== "") {
    try {
      new URL(data.websiteUrl)
    } catch {
      throw new Error("ì˜¬ë°”ë¥¸ ì›¹ì‚¬ì´íŠ¸ URL í˜•ì‹ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.")
    }
  }

  const { data: userData } = await supabase.auth.getUser()

  if (!userData.user) {
    return { success: false, error: "ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤." }
  }

  const { error } = await supabase
    .from("partner_proposals")
    .insert({
      user_id: userData.user.id,
      contact_name: data.contactName.trim(),
      contact_email: data.contactEmail.trim(),
      company_name: data.companyName.trim(),
      service_name: data.serviceName.trim(),
      website_url: data.websiteUrl?.trim() || null,
      thumbnail_url: data.thumbnailUrl?.trim() || null,
      benefit_proposal: data.benefitProposal.trim(),
      status: "pending",
    })

  if (error) {
    console.error("Failed to create partner proposal:", error)
    
    // í…Œì´ë¸”ì´ ì—†ëŠ” ê²½ìš° ëª…í™•í•œ ì—ëŸ¬ ë©”ì‹œì§€
    if (error.code === "42P01" || error.message.includes("does not exist") || error.message.includes("relation")) {
      return { 
        success: false, 
        error: "ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”." 
      }
    }
    
    // ê¸°íƒ€ ì—ëŸ¬
    return { 
      success: false, 
      error: error.message || "íŒŒíŠ¸ë„ˆìŠ¤ ì‹ ì²­ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”." 
    }
  }

  revalidatePath("/partners")
  return { success: true }
}
</file>

<file path="lib/actions/posts.ts">
"use server"

import { createClient } from "@/lib/supabase/server"
import { revalidatePath } from "next/cache"
import { isMasterAdmin, isAdmin } from "@/lib/utils"

export async function createPost(data: {
  title: string
  content: string
  visibility?: "public" | "group"
  boardCategoryId?: string
  communityId?: string
  category?: string
  categoryId?: string // categories í…Œì´ë¸”ì˜ id (insight/partner íƒ€ì…)
  // â˜… ë³´ì•ˆ: authorId ë“±ì€ ë¬´ì‹œë¨ (í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë³´ë‚´ë„ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ)
}) {
  const supabase = await createClient()

  // â˜… ë³´ì•ˆ: ë¬´ì¡°ê±´ í˜„ì¬ ë¡œê·¸ì¸í•œ ì„¸ì…˜ì˜ IDë§Œ ì‚¬ìš©
  const {
    data: { user },
  } = await supabase.auth.getUser()

  if (!user) {
    throw new Error("Unauthorized")
  }

  // â˜… ë³´ì•ˆ: í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë³´ë‚¸ authorId ë“±ì€ ë¬´ì‹œí•˜ê³ , ì„¸ì…˜ì˜ user.idë§Œ ì‚¬ìš©
  const insertData: any = {
    title: data.title.trim(),
    content: data.content.trim(),
    author_id: user.id, // â˜… ë¬´ì¡°ê±´ ì„¸ì…˜ì˜ user.idë§Œ ì‚¬ìš©
    visibility: data.visibility || "public",
  }

  if (data.boardCategoryId) {
    insertData.board_category_id = data.boardCategoryId
  }

  if (data.communityId) {
    insertData.community_id = data.communityId
  }

  if (data.category) {
    insertData.category = data.category
  }

  if (data.categoryId) {
    insertData.category_id = data.categoryId
  }

  const { data: newPost, error } = await supabase.from("posts").insert(insertData).select("id").single()

  if (error) {
    throw new Error(error.message)
  }

  revalidatePath("/community")
  revalidatePath("/community/posts")
  // ê²Œì‹œíŒ ê²½ë¡œë„ ì¬ê²€ì¦
  revalidatePath("/community/board/[slug]", "page")
  revalidatePath(`/community/board`, "layout")
  return newPost?.id || null
}

export async function updatePost(
  postId: string, 
  data: {
    title?: string
    content?: string
    visibility?: "public" | "group"
    boardCategoryId?: string
  }
) {
  const supabase = await createClient()

  const {
    data: { user },
  } = await supabase.auth.getUser()

  if (!user) {
    throw new Error("Unauthorized")
  }

  // Get user profile to check role
  const { data: profile } = await supabase
    .from("profiles")
    .select("role, email")
    .eq("id", user.id)
    .single()

  // Verify post ownership
  const { data: post } = await supabase.from("posts").select("author_id").eq("id", postId).single()

  if (!post) {
    throw new Error("Post not found")
  }

  // Check if user is author or admin/master
  const isAuthor = post.author_id === user.id
  const isMaster = profile ? isMasterAdmin(profile.role, profile.email) : false
  
  if (!isAuthor && !isMaster) {
    throw new Error("Unauthorized")
  }

  const updateData: any = {
    updated_at: new Date().toISOString(),
  }
  
  if (data.title !== undefined) updateData.title = data.title.trim()
  if (data.content !== undefined) updateData.content = data.content.trim()
  if (data.visibility !== undefined) updateData.visibility = data.visibility
  if (data.boardCategoryId !== undefined) updateData.board_category_id = data.boardCategoryId

  const { error } = await supabase
    .from("posts")
    .update(updateData)
    .eq("id", postId)

  if (error) {
    throw new Error(error.message)
  }

  revalidatePath(`/community/posts/${postId}`)
  revalidatePath("/community")
  revalidatePath("/community/posts")
  // ê²Œì‹œíŒ ê²½ë¡œë„ ì¬ê²€ì¦
  revalidatePath("/community/board/[slug]", "page")
  revalidatePath(`/community/board`, "layout")
  return { success: true }
}

export async function deletePost(postId: string) {
  const supabase = await createClient()

  const {
    data: { user },
  } = await supabase.auth.getUser()

  if (!user) {
    throw new Error("Unauthorized")
  }

  // Get user profile to check role
  const { data: profile } = await supabase
    .from("profiles")
    .select("role, email")
    .eq("id", user.id)
    .single()

  // Verify post ownership
  const { data: post } = await supabase.from("posts").select("author_id").eq("id", postId).single()

  if (!post) {
    throw new Error("Post not found")
  }

  // Check if user is author or admin/master
  const isAuthor = post.author_id === user.id
  const isMaster = profile ? isMasterAdmin(profile.role, profile.email) : false
  const isUserAdmin = profile ? isAdmin(profile.role, profile.email) : false

  if (!isAuthor && !isMaster && !isUserAdmin) {
    throw new Error("Unauthorized")
  }

  // Delete post (comments will be cascade deleted by DB)
  const { error } = await supabase.from("posts").delete().eq("id", postId)

  if (error) {
    throw new Error(error.message)
  }

  revalidatePath("/community/posts")
  revalidatePath(`/community/board`)
  // ê²Œì‹œíŒ ê²½ë¡œë„ ì¬ê²€ì¦
  revalidatePath("/community/board/[slug]", "page")
  revalidatePath(`/community/board`, "layout")
  return { success: true }
}

/**
 * ìµëª… ì¢‹ì•„ìš” (ë¹„ë¡œê·¸ì¸ ì‚¬ìš©ììš©)
 * posts.likes_countë¥¼ ì§ì ‘ ì¦ê°€ì‹œí‚¤ëŠ” RPC í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.
 */
export async function likePostAnonymously(postId: string) {
  const supabase = await createClient()

  // RPC í•¨ìˆ˜ í˜¸ì¶œ
  const { error } = await supabase.rpc('increment_post_likes', {
    post_id: postId
  })

  if (error) {
    console.error('ìµëª… ì¢‹ì•„ìš” ì‹¤íŒ¨:', error)
    throw new Error(error.message)
  }

  // ê´€ë ¨ ê²½ë¡œ ì¬ê²€ì¦
  revalidatePath("/community")
  revalidatePath("/community/board")

  return { success: true }
}

/**
 * ëŒ“ê¸€ ì‚­ì œ
 * ì‘ì„±ìë§Œ ìì‹ ì˜ ëŒ“ê¸€ì„ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
 */
export async function deleteComment(commentId: string) {
  const supabase = await createClient()

  const {
    data: { user },
  } = await supabase.auth.getUser()

  if (!user) {
    throw new Error("Unauthorized")
  }

  // Verify comment ownership
  const { data: comment } = await supabase
    .from("comments")
    .select("author_id, post_id")
    .eq("id", commentId)
    .single()

  if (!comment) {
    throw new Error("Comment not found")
  }

  // Check if user is author
  if (comment.author_id !== user.id) {
    throw new Error("Unauthorized")
  }

  // Delete comment
  const { error } = await supabase.from("comments").delete().eq("id", commentId)

  if (error) {
    throw new Error(error.message)
  }

  // ê´€ë ¨ ê²½ë¡œ ì¬ê²€ì¦
  revalidatePath("/community/posts")
  revalidatePath("/community/board")
  if (comment.post_id) {
    revalidatePath(`/community/posts/${comment.post_id}`)
    revalidatePath(`/community/board/[slug]/[id]`, "page")
  }

  return { success: true }
}
</file>

<file path="lib/actions/reviews.ts">
"use server"

import { createClient } from "@/lib/supabase/server"
import { revalidatePath } from "next/cache"
import type {
    Review,
    ReviewInsertData,
    ReviewUpdateData,
    ReviewForDisplay,
} from "@/lib/types/reviews"

/**
 * ìƒˆ í›„ê¸° ìƒì„±
 */
export async function createReview(data: ReviewInsertData) {
    const supabase = await createClient()

    const { data: review, error } = await supabase
        .from("reviews")
        .insert(data)
        .select()
        .single()

    if (error) {
        console.error("í›„ê¸° ìƒì„± ì‹¤íŒ¨ ìƒì„¸:", JSON.stringify(error, null, 2))
        throw new Error(`í›„ê¸° ì‘ì„± ì‹¤íŒ¨: ${error.message} (Code: ${error.code})`)
    }

    revalidatePath("/reviews")
    return review as Review
}

/**
 * í›„ê¸° ìˆ˜ì •
 */
export async function updateReview(id: string, data: ReviewUpdateData) {
    const supabase = await createClient()

    const { data: review, error } = await supabase
        .from("reviews")
        .update({ ...data, updated_at: new Date().toISOString() })
        .eq("id", id)
        .select()
        .single()

    if (error) {
        console.error("í›„ê¸° ìˆ˜ì • ì‹¤íŒ¨:", error)
        throw new Error("í›„ê¸°ë¥¼ ìˆ˜ì •í•˜ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")
    }

    revalidatePath("/reviews")
    return review as Review
}

/**
 * í›„ê¸° ì‚­ì œ
 */
export async function deleteReview(id: string) {
    const supabase = await createClient()

    const { error } = await supabase.from("reviews").delete().eq("id", id)

    if (error) {
        console.error("í›„ê¸° ì‚­ì œ ì‹¤íŒ¨:", error)
        throw new Error("í›„ê¸°ë¥¼ ì‚­ì œí•˜ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")
    }

    revalidatePath("/reviews")
}

/**
 * ì´ë²¤íŠ¸ë³„ í›„ê¸° ì¡°íšŒ
 */
export async function getReviewsByEvent(eventId: string) {
    const supabase = await createClient()

    const { data: reviews, error } = await supabase
        .from("reviews")
        .select(
            `
      *,
      profiles(
        id,
        full_name,
        avatar_url,
        role,
        company,
        position
      ),
      events(
        id,
        title,
        event_date,
        thumbnail_url
      )
    `
        )
        .eq("event_id", eventId)
        .eq("is_public", true)
        .order("created_at", { ascending: false })

    if (error) {
        console.error("í›„ê¸° ì¡°íšŒ ì‹¤íŒ¨:", error)
        throw new Error("í›„ê¸°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")
    }

    return reviews as ReviewForDisplay[]
}

/**
 * ì‚¬ìš©ìë³„ í›„ê¸° ì¡°íšŒ
 */
export async function getUserReviews(userId: string) {
    const supabase = await createClient()

    const { data: reviews, error } = await supabase
        .from("reviews")
        .select(
            `
      *,
      profiles(
        id,
        full_name,
        avatar_url,
        role,
        company,
        position
      ),
      events(
        id,
        title,
        event_date,
        thumbnail_url
      )
    `
        )
        .eq("user_id", userId)
        .order("created_at", { ascending: false })

    if (error) {
        console.error("í›„ê¸° ì¡°íšŒ ì‹¤íŒ¨:", error)
        throw new Error("í›„ê¸°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")
    }

    return reviews as ReviewForDisplay[]
}

/**
 * ëª¨ë“  ê³µê°œ í›„ê¸° ì¡°íšŒ
 */
export async function getAllPublicReviews(limit = 20) {
    const supabase = await createClient()

    const { data: reviews, error } = await supabase
        .from("reviews")
        .select(
            `
      *,
      profiles(
        id,
        full_name,
        avatar_url,
        role,
        company,
        position
      ),
      events(
        id,
        title,
        event_date,
        thumbnail_url
      )
    `
        )
        .eq("is_public", true)
        .order("created_at", { ascending: false })
        .limit(limit)

    if (error) {
        console.error("í›„ê¸° ì¡°íšŒ ì‹¤íŒ¨:", error)
        throw new Error("í›„ê¸°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")
    }

    return reviews as ReviewForDisplay[]
}

/**
 * ë² ìŠ¤íŠ¸ í›„ê¸° ì¡°íšŒ
 */
export async function getBestReviews(limit = 10) {
    const supabase = await createClient()

    const { data: reviews, error } = await supabase
        .from("reviews")
        .select(
            `
      *,
      profiles(
        id,
        full_name,
        avatar_url,
        role,
        company,
        position
      ),
      events(
        id,
        title,
        event_date,
        thumbnail_url
      )
    `
        )
        .eq("is_public", true)
        .eq("is_best", true)
        .order("created_at", { ascending: false })
        .limit(limit)

    if (error) {
        console.error("ë² ìŠ¤íŠ¸ í›„ê¸° ì¡°íšŒ ì‹¤íŒ¨:", error)
        throw new Error("ë² ìŠ¤íŠ¸ í›„ê¸°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")
    }

    return reviews as ReviewForDisplay[]
}
</file>

<file path="lib/actions/user.ts">
"use server"

import { createClient } from "@/lib/supabase/server"
import { revalidatePath } from "next/cache"

export async function updateProfileAvatar(avatarUrl: string) {
  const supabase = await createClient()

  const {
    data: { user },
  } = await supabase.auth.getUser()

  if (!user) {
    throw new Error("Unauthorized")
  }

  // Update avatar_url in profiles table
  const { error } = await supabase
    .from("profiles")
    .update({ avatar_url: avatarUrl })
    .eq("id", user.id)

  if (error) {
    throw new Error(error.message)
  }

  revalidatePath("/community/profile")
  return { success: true }
}

export async function updateProfileVisibility(isPublic: boolean) {
  const supabase = await createClient()

  const {
    data: { user },
  } = await supabase.auth.getUser()

  if (!user) {
    throw new Error("Unauthorized")
  }

  // Update is_profile_public in profiles table
  const { error } = await supabase
    .from("profiles")
    .update({ is_profile_public: isPublic })
    .eq("id", user.id)

  if (error) {
    throw new Error(error.message)
  }

  revalidatePath("/community/profile")
  revalidatePath("/member")
  return { success: true }
}

export async function updateProfileInfo(data: {
  full_name?: string
  company?: string
  position?: string
  company_2?: string
  position_2?: string
  tagline?: string
  introduction?: string
  member_type?: ("ì‚¬ì—…ê°€" | "íˆ¬ìì" | "í¬ë¦¬ì—ì´í„°")[] | null
  is_profile_public?: boolean
}) {
  try {
    const supabase = await createClient()

    const {
      data: { user },
    } = await supabase.auth.getUser()

    if (!user) {
      throw new Error("Unauthorized")
    }

    // Update profile info
    // null ê°’ ì²˜ë¦¬ë¥¼ ëª…í™•í•˜ê²Œ í•˜ì—¬ DB ì—ëŸ¬ ë°©ì§€
    // member_type ìœ íš¨ì„± ê²€ì‚¬ ë° ì •ë¦¬
    let memberTypeValue: string[] | null = null
    if (Array.isArray(data.member_type) && data.member_type.length > 0) {
      // í—ˆìš©ëœ ê°’ë§Œ í•„í„°ë§í•˜ê³  ì¤‘ë³µ ì œê±°
      const allowedValues = ['ì‚¬ì—…ê°€', 'íˆ¬ìì', 'í¬ë¦¬ì—ì´í„°']
      const filtered = data.member_type
        .filter((v): v is "ì‚¬ì—…ê°€" | "íˆ¬ìì" | "í¬ë¦¬ì—ì´í„°" => 
          typeof v === 'string' && allowedValues.includes(v)
        )
      // ì¤‘ë³µ ì œê±°
      const unique = Array.from(new Set(filtered))
      // ìµœëŒ€ 2ê°œê¹Œì§€ë§Œ, ê·¸ë¦¬ê³  ìµœì†Œ 1ê°œ ì´ìƒì´ì–´ì•¼ í•¨
      if (unique.length > 0 && unique.length <= 2) {
        memberTypeValue = unique.slice(0, 2)
      } else {
        memberTypeValue = null
      }
    }
    
    // ìµœì¢… ê²€ì¦: ë¹ˆ ë°°ì—´ì´ë©´ nullë¡œ ë³€í™˜
    if (Array.isArray(memberTypeValue) && memberTypeValue.length === 0) {
      memberTypeValue = null
    }
    
    // ë””ë²„ê¹… ë¡œê·¸
    console.log('[updateProfileInfo] member_type ì²˜ë¦¬:', {
      input: data.member_type,
      processed: memberTypeValue,
      isArray: Array.isArray(memberTypeValue),
      length: Array.isArray(memberTypeValue) ? memberTypeValue.length : null
    })
    
    const updates: any = {
      full_name: data.full_name?.trim() || null,
      company: data.company?.trim() || null,
      position: data.position?.trim() || null,
      company_2: data.company_2?.trim() || null,
      position_2: data.position_2?.trim() || null,
      tagline: data.tagline?.trim() || null,
      introduction: data.introduction?.trim() || null,
      member_type: memberTypeValue,
      is_profile_public: data.is_profile_public ?? false,
      updated_at: new Date().toISOString(),
    }
    
    // ìµœì¢… ì—…ë°ì´íŠ¸ ê°ì²´ ê²€ì¦
    if (Array.isArray(updates.member_type)) {
      if (updates.member_type.length === 0) {
        updates.member_type = null
      } else if (updates.member_type.length > 2) {
        updates.member_type = updates.member_type.slice(0, 2)
      }
    }

    // ìµœì¢… ì—…ë°ì´íŠ¸ ì „ ê²€ì¦ ë¡œê·¸
    console.log('[updateProfileInfo] ìµœì¢… ì—…ë°ì´íŠ¸ ê°ì²´:', {
      member_type: updates.member_type,
      member_type_type: typeof updates.member_type,
      isArray: Array.isArray(updates.member_type),
      length: Array.isArray(updates.member_type) ? updates.member_type.length : null
    })
    
    // 1. ì „ì²´ ì—…ë°ì´íŠ¸ ì‹œë„
    const { error } = await supabase
      .from("profiles")
      .update(updates)
      .eq("id", user.id)

    if (error) {
      console.error("Supabase Update Error (Full):", error)
      console.error("ì—…ë°ì´íŠ¸ ì‹œë„í•œ ë°ì´í„°:", JSON.stringify(updates, null, 2))
      
      // member_type ê´€ë ¨ ì²´í¬ ì œì•½ ì¡°ê±´ ì˜¤ë¥˜ì¸ ê²½ìš°
      if (error.message.includes("profiles_member_type_check")) {
        console.error("member_type ì²´í¬ ì œì•½ ì¡°ê±´ ìœ„ë°˜!")
        console.error("member_type ê°’:", updates.member_type)
        console.error("member_type íƒ€ì…:", typeof updates.member_type)
        console.error("member_type isArray:", Array.isArray(updates.member_type))
        if (Array.isArray(updates.member_type)) {
          console.error("member_type length:", updates.member_type.length)
          console.error("member_type ë‚´ìš©:", updates.member_type)
        }
        // member_typeì„ nullë¡œ ì„¤ì •í•˜ê³  ì¬ì‹œë„
        const safeUpdates = { ...updates, member_type: null }
        const { error: retryError } = await supabase
          .from("profiles")
          .update(safeUpdates)
          .eq("id", user.id)
        if (retryError) {
          throw new Error(`member_type ì €ì¥ ì‹¤íŒ¨: ${error.message}. ê¸°ë³¸ ì •ë³´ë§Œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`)
        }
        return { success: true, warning: "member_type ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ê¸°ë³¸ ì •ë³´ëŠ” ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤." }
      }
      
      // 2. ë§Œì•½ ì»¬ëŸ¼ ì—†ìŒ ì—ëŸ¬ë¼ë©´ ê¸°ë³¸ ì •ë³´ë§Œì´ë¼ë„ ì—…ë°ì´íŠ¸ ì‹œë„
      // company_2, position_2ë„ ì—†ì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ê°€ì¥ ê¸°ë³¸ ì»¬ëŸ¼ë“¤ë§Œ ì—…ë°ì´íŠ¸ ì‹œë„
      if (error.code === 'PGRST204' || error.message.includes("Could not find the")) {
        console.log("Retrying update with minimal columns...")
        const basicUpdates = {
          full_name: updates.full_name,
          company: updates.company,
          position: updates.position,
          introduction: updates.introduction,
          is_profile_public: updates.is_profile_public,
          updated_at: updates.updated_at,
        }
        const { error: retryError } = await supabase
          .from("profiles")
          .update(basicUpdates)
          .eq("id", user.id)
          
        if (retryError) {
          throw new Error(retryError.message)
        }
        // ë¶€ë¶„ ì„±ê³µ
        return { success: true, warning: "ê¸°ë³¸ ì •ë³´ëŠ” ì €ì¥ë˜ì—ˆìœ¼ë‚˜, ì¶”ê°€ ì •ë³´(ë‘ ë²ˆì§¸ ì†Œì†, ì†Œì…œ ë§í¬ ë“±) ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. (DB ì—…ë°ì´íŠ¸ í•„ìš”)" }
      }
      
      throw new Error(error.message)
    }

    revalidatePath("/community/profile")
    revalidatePath("/member")
    return { success: true }
    
  } catch (error) {
    console.error("updateProfileInfo Error:", error)
    const errorMessage = error instanceof Error ? error.message : "Failed to update profile"
    return { success: false, error: errorMessage }
  }
}
</file>

<file path="lib/actions/utils.ts">
"use server"

/**
 * URLì˜ ë©”íƒ€ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ì„œ og:imageë¥¼ ì¶”ì¶œí•˜ëŠ” Server Action
 * @param url - ë©”íƒ€ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ URL
 * @returns og:image URL ë˜ëŠ” ë¹ˆ ë¬¸ìì—´
 */
export async function fetchUrlMetadata(url: string): Promise<{ thumbnailUrl: string }> {
  try {
    // URL ìœ íš¨ì„± ê²€ì‚¬
    if (!url || !url.trim()) {
      return { thumbnailUrl: "" }
    }

    // URL í˜•ì‹ ê²€ì¦
    let validUrl: URL
    try {
      validUrl = new URL(url)
    } catch {
      return { thumbnailUrl: "" }
    }

    // HTTP/HTTPSë§Œ í—ˆìš©
    if (!["http:", "https:"].includes(validUrl.protocol)) {
      return { thumbnailUrl: "" }
    }

    // cheerioë¥¼ ë™ì ìœ¼ë¡œ import (ì„œë²„ ì‚¬ì´ë“œì—ì„œë§Œ ì‚¬ìš©)
    const cheerio = await import("cheerio")

    // URLì—ì„œ HTML ê°€ì ¸ì˜¤ê¸°
    const response = await fetch(url, {
      headers: {
        "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36",
      },
      // íƒ€ì„ì•„ì›ƒ ì„¤ì • (10ì´ˆ)
      signal: AbortSignal.timeout(10000),
    })

    if (!response.ok) {
      return { thumbnailUrl: "" }
    }

    const html = await response.text()
    const $ = cheerio.load(html)

    // og:image ë©”íƒ€ íƒœê·¸ ì°¾ê¸°
    let thumbnailUrl = $('meta[property="og:image"]').attr("content") || 
                       $('meta[name="og:image"]').attr("content") || 
                       $('meta[property="twitter:image"]').attr("content") ||
                       ""

    // ìƒëŒ€ ê²½ë¡œì¸ ê²½ìš° ì ˆëŒ€ ê²½ë¡œë¡œ ë³€í™˜
    if (thumbnailUrl && !thumbnailUrl.startsWith("http")) {
      if (thumbnailUrl.startsWith("//")) {
        thumbnailUrl = `${validUrl.protocol}${thumbnailUrl}`
      } else if (thumbnailUrl.startsWith("/")) {
        thumbnailUrl = `${validUrl.origin}${thumbnailUrl}`
      } else {
        thumbnailUrl = `${validUrl.origin}/${thumbnailUrl}`
      }
    }

    return { thumbnailUrl: thumbnailUrl.trim() }
  } catch (error) {
    console.error("Error fetching URL metadata:", error)
    return { thumbnailUrl: "" }
  }
}
</file>

<file path="lib/api/posts.ts">
import { createClient } from "@/lib/supabase/client"

export const fetchPosts = async ({
  categorySlug,
  page = 1,
  limit = 15,
}: {
  categorySlug: string
  page?: number
  limit?: number
}) => {
  const supabase = createClient()
  const from = (page - 1) * limit
  const to = from + limit - 1

  // ìŠ¬ëŸ¬ê·¸ ì •ê·œí™” (DBì™€ URLì˜ ë¶ˆì¼ì¹˜ í•´ê²°)
  let dbSlug = categorySlug
  if (categorySlug === 'free') {
    dbSlug = 'free-board'
  }
  if (categorySlug === 'announcements') {
    dbSlug = 'announcement'
  }
  if (categorySlug === 'insights') {
    dbSlug = 'insights'
  }

  // categorySlugê°€ "all"ì´ ì•„ë‹ ë•ŒëŠ” !innerë¡œ ê°•ì œí•˜ì—¬ ì—„ê²©í•œ í•„í„°ë§
  let query
  if (categorySlug !== "all") {
    // íŠ¹ì • ì¹´í…Œê³ ë¦¬: Inner Joinìœ¼ë¡œ ê°•ì œí•˜ì—¬ ì •í™•í•œ í•„í„°ë§
    query = supabase
      .from("posts")
      .select(
        `
        *,
        profiles:author_id(full_name, avatar_url),
        board_categories!inner(name, slug),
        _count: comments(count),
        post_images(id, image_url, sort_order)
      `,
        { count: "exact" }
      )
      .eq("board_categories.slug", dbSlug)
      .order("created_at", { ascending: false })
      .range(from, to)
  } else {
    // allì¸ ê²½ìš°: Left Join ì‚¬ìš© (ê³µì§€ì‚¬í•­/ììœ ê²Œì‹œíŒ/event-requests/reviews ì œì™¸)
    query = supabase
      .from("posts")
      .select(
        `
        *,
        profiles:author_id(full_name, avatar_url),
        board_categories(name, slug),
        _count: comments(count),
        post_images(id, image_url, sort_order)
      `,
        { count: "exact" }
      )
      .not('board_categories.slug', 'in', '("announcement","free-board","event-requests","reviews")')
      .order("created_at", { ascending: false })
      .range(from, to)
  }

  const { data, error, count } = await query

  if (error) throw error

  if (!data || data.length === 0) {
    return { posts: [], count: count || 0 }
  }

  // ì‹¤ì œ ì¢‹ì•„ìš” ë° ëŒ“ê¸€ ìˆ˜ ì¡°íšŒ (ë³‘ë ¬ ì²˜ë¦¬)
  const postIds = data.map((post: any) => post.id)
  
  const [likesResult, commentsResult] = await Promise.all([
    supabase
      .from("post_likes")
      .select("post_id")
      .in("post_id", postIds),
    supabase
      .from("comments")
      .select("post_id")
      .in("post_id", postIds)
  ])

  // ì¹´ìš´íŠ¸ ë§µ ìƒì„±
  const likesCountMap = new Map<string, number>()
  const commentsCountMap = new Map<string, number>()

  ;(likesResult.data || []).forEach((like: { post_id: string }) => {
    likesCountMap.set(like.post_id, (likesCountMap.get(like.post_id) || 0) + 1)
  })

  ;(commentsResult.data || []).forEach((comment: { post_id: string }) => {
    commentsCountMap.set(comment.post_id, (commentsCountMap.get(comment.post_id) || 0) + 1)
  })

  // ì‹¤ì œ ì¹´ìš´íŠ¸ë¥¼ ê²Œì‹œê¸€ ë°ì´í„°ì— ì¶”ê°€
  const postsWithCounts = data.map((post: any) => ({
    ...post,
    likes_count: likesCountMap.get(post.id) || 0,
    comments_count: commentsCountMap.get(post.id) || 0,
  }))

  return { posts: postsWithCounts, count: count || 0 }
}
</file>

<file path="lib/auth/server.ts">
import { createClient } from "@/lib/supabase/server"
import { redirect } from "next/navigation"
import { isAdmin, isMasterAdmin } from "@/lib/utils"

/**
 * ë¡œê·¸ì¸ì´ í•„ìˆ˜ì¸ í˜ì´ì§€ì—ì„œ ì‚¬ìš©
 * ì‚¬ìš©ìê°€ ë¡œê·¸ì¸í•˜ì§€ ì•Šì•˜ìœ¼ë©´ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë””ë ‰ì…˜
 * @returns {Promise<{ user: User, supabase: SupabaseClient }>}
 */
export async function requireAuth() {
  const supabase = await createClient()
  
  // ë””ë²„ê¹…: ì¿ í‚¤ í™•ì¸
  const cookieStore = await import("next/headers").then(m => m.cookies())
  const allCookies = cookieStore.getAll()
  const authCookies = allCookies.filter(c => 
    c.name.includes('auth') || 
    c.name.includes('access') || 
    c.name.includes('refresh') ||
    c.name.includes('supabase')
  )
  
  if (process.env.NODE_ENV === 'development') {
    console.log("[requireAuth] Cookie check:", {
      totalCookies: allCookies.length,
      authCookies: authCookies.map(c => ({ name: c.name, hasValue: !!c.value, valueLength: c.value?.length || 0 })),
      allCookieNames: allCookies.map(c => c.name),
    })
  }
  
  // getUserë¥¼ ì‚¬ìš©í•˜ì—¬ JWT í† í° ê²€ì¦ (ì¿ í‚¤ì—ì„œ ìë™ìœ¼ë¡œ ì½ìŒ)
  // getUserëŠ” ì¿ í‚¤ì—ì„œ access_tokenì„ ì½ê³  Supabase ì„œë²„ì—ì„œ ê²€ì¦í•©ë‹ˆë‹¤
  const {
    data: { user },
    error,
  } = await supabase.auth.getUser()

  // ì¸ì¦ ì˜¤ë¥˜ê°€ ìˆê±°ë‚˜ ì‚¬ìš©ìê°€ ì—†ìœ¼ë©´ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë””ë ‰ì…˜
  if (error || !user) {
    // ë””ë²„ê¹…ì„ ìœ„í•œ ìƒì„¸ ë¡œê·¸
    console.error("[requireAuth] Auth error:", {
      error: error?.message,
      errorCode: error?.status,
      errorName: error?.name,
      hasUser: !!user,
      authCookiesCount: authCookies.length,
      cookieNames: allCookies.map(c => c.name),
      cookieValues: authCookies.map(c => ({ name: c.name, valuePreview: c.value?.substring(0, 20) || "empty" })),
    })
    redirect("/auth/login")
  }

  if (process.env.NODE_ENV === 'development') {
    console.log("[requireAuth] Auth successful:", {
      userId: user.id,
      email: user.email,
    })
  }

  return { user, supabase }
}

/**
 * ê´€ë¦¬ì ê¶Œí•œì´ í•„ìˆ˜ì¸ í˜ì´ì§€ì—ì„œ ì‚¬ìš©
 * ì‚¬ìš©ìê°€ ë¡œê·¸ì¸í•˜ì§€ ì•Šì•˜ê±°ë‚˜ ê´€ë¦¬ìê°€ ì•„ë‹ˆë©´ ë¦¬ë””ë ‰ì…˜
 * @returns {Promise<{ user: User, profile: Profile, supabase: SupabaseClient, isMaster: boolean }>}
 */
export async function requireAdmin() {
  const { user, supabase } = await requireAuth()

  const { data: profile, error: profileError } = await supabase
    .from("profiles")
    .select("role, email")
    .eq("id", user.id)
    .single()

  if (profileError || !profile) {
    console.error("Profile fetch error:", profileError)
    redirect("/")
  }

  if (!isAdmin(profile.role, profile.email)) {
    redirect("/")
  }

  const isMaster = isMasterAdmin(profile.role, profile.email)

  return { user, profile, supabase, isMaster }
}

/**
 * ë§ˆìŠ¤í„° ê¶Œí•œì´ í•„ìˆ˜ì¸ í˜ì´ì§€ì—ì„œ ì‚¬ìš©
 * ì‚¬ìš©ìê°€ ë¡œê·¸ì¸í•˜ì§€ ì•Šì•˜ê±°ë‚˜ ë§ˆìŠ¤í„°ê°€ ì•„ë‹ˆë©´ ë¦¬ë””ë ‰ì…˜
 * @returns {Promise<{ user: User, profile: Profile, supabase: SupabaseClient }>}
 */
export async function requireMaster() {
  const { user, supabase } = await requireAuth()

  const { data: profile } = await supabase
    .from("profiles")
    .select("role, email")
    .eq("id", user.id)
    .single()

  if (!profile || !isMasterAdmin(profile.role, profile.email)) {
    redirect("/admin")
  }

  return { user, profile, supabase }
}

/**
 * ì„ íƒì  ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸° (ë¡œê·¸ì¸í•˜ì§€ ì•Šì•„ë„ ë¨)
 * @returns {Promise<{ user: User | null, supabase: SupabaseClient }>}
 */
export async function getUser() {
  const supabase = await createClient()
  const {
    data: { user },
  } = await supabase.auth.getUser()

  return { user: user || null, supabase }
}
</file>

<file path="lib/format-time.ts">
/**
 * ìƒëŒ€ ì‹œê°„ì„ í•œêµ­ì–´ë¡œ í¬ë§·íŒ…
 * ì˜ˆ: "1ë¶„ ì „", "1ì‹œê°„ ì „", "2ì¼ ì „", "1ì£¼ ì „", "1ê°œì›” ì „"
 */
export function formatRelativeTime(dateString: string): string {
  const date = new Date(dateString)
  const now = new Date()
  const diffInSeconds = Math.floor((now.getTime() - date.getTime()) / 1000)

  if (diffInSeconds < 60) {
    return "ë°©ê¸ˆ ì „"
  }

  const diffInMinutes = Math.floor(diffInSeconds / 60)
  if (diffInMinutes < 60) {
    return `${diffInMinutes}ë¶„ ì „`
  }

  const diffInHours = Math.floor(diffInMinutes / 60)
  if (diffInHours < 24) {
    return `${diffInHours}ì‹œê°„ ì „`
  }

  const diffInDays = Math.floor(diffInHours / 24)
  if (diffInDays < 7) {
    return `${diffInDays}ì¼ ì „`
  }

  const diffInWeeks = Math.floor(diffInDays / 7)
  if (diffInWeeks < 4) {
    return `${diffInWeeks}ì£¼ ì „`
  }

  const diffInMonths = Math.floor(diffInDays / 30)
  if (diffInMonths < 12) {
    return `${diffInMonths}ê°œì›” ì „`
  }

  const diffInYears = Math.floor(diffInDays / 365)
  return `${diffInYears}ë…„ ì „`
}

/**
 * ë‚ ì§œì™€ ì‹œê°„ì„ "2025. 12. 05 Â· 19:00" í˜•ì‹ìœ¼ë¡œ í¬ë§·íŒ…
 */
export function formatDateTime(dateString: string, timeString?: string | null): string {
  const date = new Date(dateString)
  const year = date.getFullYear()
  const month = String(date.getMonth() + 1).padStart(2, "0")
  const day = String(date.getDate()).padStart(2, "0")

  if (timeString) {
    // timeStringì´ "19:00" í˜•ì‹ì¸ ê²½ìš°
    return `${year}. ${month}. ${day} Â· ${timeString}`
  }

  // timeStringì´ ì—†ìœ¼ë©´ ì‹œê°„ ì¶”ì¶œ
  const hours = String(date.getHours()).padStart(2, "0")
  const minutes = String(date.getMinutes()).padStart(2, "0")
  return `${year}. ${month}. ${day} Â· ${hours}:${minutes}`
}

/**
 * ë‚ ì§œë§Œ "12. 05" í˜•ì‹ìœ¼ë¡œ í¬ë§·íŒ… (ì›”ê³¼ ì¼ë§Œ)
 */
export function formatDateShort(dateString: string): string {
  const date = new Date(dateString)
  const month = String(date.getMonth() + 1).padStart(2, "0")
  const day = String(date.getDate()).padStart(2, "0")
  return `${month}. ${day}`
}
</file>

<file path="lib/hooks/usePosts.ts">
import { useQuery } from "@tanstack/react-query"
import { fetchPosts } from "@/lib/api/posts"

export function usePosts(categorySlug: string, page: number = 1) {
  return useQuery({
    queryKey: ["posts", categorySlug, page], // ìºì‹±ì˜ ê¸°ì¤€ì´ ë˜ëŠ” í‚¤
    queryFn: () => fetchPosts({ categorySlug, page }),
    placeholderData: (previousData) => previousData, // ì´ì „ ë°ì´í„°ë¥¼ ìœ ì§€í•˜ë©° ìƒˆ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜´ (í˜ì´ì§• UX ê°œì„ )
    staleTime: 60 * 1000, // 1ë¶„ê°„ì€ ë°ì´í„°ë¥¼ freshí•˜ê²Œ ìœ ì§€ (ì¬ìš”ì²­ ì•ˆí•¨)
  })
}
</file>

<file path="lib/hooks/usePrefetchPosts.ts">
import { useQueryClient } from "@tanstack/react-query"
import { fetchPosts } from "@/lib/api/posts"

export function usePrefetchPosts() {
  const queryClient = useQueryClient()

  const prefetch = (categorySlug: string) => {
    queryClient.prefetchQuery({
      queryKey: ["posts", categorySlug, 1], // 1í˜ì´ì§€ ë°ì´í„°ë¥¼ ë¯¸ë¦¬ ê°€ì ¸ì˜´
      queryFn: () => fetchPosts({ categorySlug, page: 1 }),
      staleTime: 60 * 1000, // 1ë¶„ê°„ì€ ì‹ ì„ í•œ ê²ƒìœ¼ë¡œ ê°„ì£¼
    })
  }

  return prefetch
}
</file>

<file path="lib/queries/announcements.ts">
import { SupabaseClient } from "@supabase/supabase-js"

/**
 * ìµœì‹  ê³µì§€ì‚¬í•­ 1ê°œ ê°€ì ¸ì˜¤ê¸°
 */
export async function getLatestAnnouncement(supabase: SupabaseClient) {
  const { data, error } = await supabase
    .from("posts")
    .select(`
      id,
      title,
      board_categories!inner (slug)
    `)
    .eq("board_categories.slug", "announcement")
    .order("created_at", { ascending: false })
    .limit(1)
    .maybeSingle()

  if (error) {
    console.error("Error fetching announcement:", error)
    return null
  }

  return data
}
</file>

<file path="lib/queries/badges.ts">
/**
 * ë±ƒì§€ ê´€ë ¨ ì¿¼ë¦¬ í•¨ìˆ˜
 * ë±ƒì§€ ë°ì´í„° í˜ì¹­ ë¡œì§ì˜ ì¬ì‚¬ìš©ì„±ì„ ë†’ì´ê¸° ìœ„í•œ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
 */

import type { SupabaseClient } from "@supabase/supabase-js"
import type { VisibleBadge } from "@/lib/types/badges"

/**
 * ì—¬ëŸ¬ ì‚¬ìš©ìì˜ ë…¸ì¶œëœ ë±ƒì§€ ì •ë³´ë¥¼ í•œ ë²ˆì— ê°€ì ¸ì˜µë‹ˆë‹¤.
 * N+1 ë¬¸ì œë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ ë°°ì¹˜ë¡œ ì¡°íšŒí•©ë‹ˆë‹¤.
 * @param supabase Supabase í´ë¼ì´ì–¸íŠ¸
 * @param userIds ì‚¬ìš©ì ID ë°°ì—´
 * @returns Map<userId, VisibleBadge[]> í˜•íƒœì˜ ë±ƒì§€ ë§µ
 */
export async function getBadgesForUsers(
  supabase: SupabaseClient,
  userIds: string[]
): Promise<Map<string, VisibleBadge[]>> {
  const badgesMap = new Map<string, VisibleBadge[]>()

  if (userIds.length === 0) {
    return badgesMap
  }

  try {
    const { data: allBadgesData, error: badgesError } = await supabase
      .from("user_badges")
      .select(`
        user_id,
        badges:badge_id (
          icon,
          name
        )
      `)
      .in("user_id", userIds)
      .eq("is_visible", true)

    if (badgesError) {
      console.error("ë±ƒì§€ ë¡œë“œ ì˜¤ë¥˜:", badgesError)
      return badgesMap
    }

    if (allBadgesData) {
      allBadgesData.forEach((ub) => {
        if (ub.badges && ub.user_id) {
          const badge = Array.isArray(ub.badges) ? ub.badges[0] : ub.badges
          const existing = badgesMap.get(ub.user_id) || []
          badgesMap.set(ub.user_id, [
            ...existing,
            { icon: badge?.icon, name: badge?.name },
          ])
        }
      })
    }
  } catch (error) {
    console.error("getBadgesForUsers ì˜¤ë¥˜:", error)
  }

  return badgesMap
}
</file>

<file path="lib/queries/board-categories.ts">
import { SupabaseClient } from "@supabase/supabase-js"

export type BoardCategory = {
  id: string
  name: string
  slug: string
}

/**
 * í™œì„±í™”ëœ ê²Œì‹œíŒ ì¹´í…Œê³ ë¦¬ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
 */
export async function getBoardCategories(
  supabase: SupabaseClient
): Promise<BoardCategory[]> {
  const { data, error } = await supabase
    .from("board_categories")
    .select("id, name, slug")
    .eq("is_active", true)
    .order("order_index", { ascending: true })

  if (error) {
    console.error("Error fetching board categories:", error)
    return []
  }

  return (data || []) as BoardCategory[]
}
</file>

<file path="lib/queries/cached.ts">
/**
 * ìºì‹œëœ ì¿¼ë¦¬ í•¨ìˆ˜ë“¤
 * Reactì˜ cache()ë¥¼ ì‚¬ìš©í•˜ì—¬ ë™ì¼ ìš”ì²­ ë‚´ì—ì„œ ì¿¼ë¦¬ ì¤‘ë³µ í˜¸ì¶œì„ ë°©ì§€í•©ë‹ˆë‹¤.
 * ì„œë²„ ì»´í¬ë„ŒíŠ¸ ê°„ì— ë°ì´í„°ë¥¼ ê³µìœ í•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.
 */

import { cache } from "react"
import { createClient } from "@/lib/supabase/server"
import type { UserWithProfile } from "@/lib/types/profile"

/**
 * ê²½ëŸ‰í™”ëœ í”„ë¡œí•„ íƒ€ì… (í—¤ë”/ì‚¬ì´ë“œë°”ìš©)
 */
type LightProfile = {
  id: string
  full_name: string | null
  avatar_url: string | null
  role: string | null
  points: number
}

/**
 * ìºì‹œëœ ì‚¬ìš©ì í”„ë¡œí•„ ì¡°íšŒ (ê²½ëŸ‰í™” ë²„ì „)
 * í—¤ë”, ì‚¬ì´ë“œë°”, íˆì–´ë¡œ ì„¹ì…˜ì— í•„ìš”í•œ ìµœì†Œí•œì˜ í•„ë“œë§Œ ì¡°íšŒí•©ë‹ˆë‹¤.
 * ë™ì¼ ìš”ì²­ ë‚´ì—ì„œ ì—¬ëŸ¬ ë²ˆ í˜¸ì¶œí•´ë„ í•œ ë²ˆë§Œ DB ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
 */
export const getCachedUserProfile = cache(async (): Promise<UserWithProfile | null> => {
  const supabase = await createClient()

  try {
    // ì„¸ì…˜ ì—†ìœ¼ë©´ getUser() í˜¸ì¶œ ì—†ì´ ì¦‰ì‹œ ë°˜í™˜ (ë¹„ë¡œê·¸ì¸ ìµœì í™”)
    const { data: { session } } = await supabase.auth.getSession()
    if (!session) {
      return null
    }

    const { data: { user }, error: userError } = await supabase.auth.getUser()
    if (userError || !user) {
      return null
    }

    // í—¤ë”/ì‚¬ì´ë“œë°”ì— í•„ìš”í•œ ìµœì†Œ í•„ë“œë§Œ ì¡°íšŒ (5ê°œ í•„ë“œ)
    const { data: profile, error: profileError } = await supabase
      .from("profiles")
      .select("id, full_name, avatar_url, role, points")
      .eq("id", user.id)
      .single()

    if (profileError) {
      console.error("í”„ë¡œí•„ ì¡°íšŒ ì˜¤ë¥˜:", profileError)
      return { user, profile: null }
    }

    return {
      user,
      profile: profile as LightProfile as any,
    }
  } catch (error) {
    console.error("getCachedUserProfile ì˜¤ë¥˜:", error)
    return null
  }
})

/**
 * ìºì‹œëœ ê³µì§€ì‚¬í•­ ì¡°íšŒ (ìµœê·¼ 3ê°œ)
 */
export const getCachedAnnouncements = cache(async () => {
  const supabase = await createClient()

  const { data, error } = await supabase
    .from("posts")
    .select(`
      id,
      title,
      board_categories!inner(slug)
    `)
    .eq("board_categories.slug", "announcement")
    .order("created_at", { ascending: false })
    .limit(3)

  if (error || !data) {
    return []
  }

  return data.map((post: any) => ({
    id: post.id,
    title: post.title,
  }))
})
</file>

<file path="lib/queries/feed.ts">
import { SupabaseClient } from "@supabase/supabase-js"

type FeedItem =
  | ({ kind: "post" } & {
      id: string
      title: string
      created_at: string
      likes_count: number
      comments_count: number
      content_preview?: string | null
      thumbnail_url?: string | null
      board_categories?: { name: string | null; slug: string | null } | null
      related_event_id?: string | null
      is_announcement?: boolean | null
      is_event?: boolean | null
      profiles?: { id: string; full_name: string | null; avatar_url: string | null } | null
    })
  | ({ kind: "event" } & {
      id: string
      title: string
      event_date: string
      location?: string | null
      thumbnail_url?: string | null
      current_participants?: number | null
      max_participants?: number | null
      event_type?: string | null
    })

export async function getCommunityFeed(
  supabase: SupabaseClient,
  filter: "latest" | "popular" = "latest",
  limit = 30
): Promise<FeedItem[]> {
  // 1) ê²Œì‹œê¸€ ê°€ì ¸ì˜¤ê¸°
  let postQuery = supabase
    .from("posts")
    .select(`
      id, title, content, created_at, likes_count, comments_count, thumbnail_url, related_event_id,
      is_announcement, is_event,
      profiles:author_id (id, full_name, avatar_url),
      board_categories(name, slug)
    `)

  if (filter === "popular") {
    postQuery = postQuery.order("likes_count", { ascending: false }).order("created_at", { ascending: false })
  } else {
    postQuery = postQuery.order("created_at", { ascending: false })
  }

  postQuery = postQuery.limit(limit)

  // 2) ì´ë²¤íŠ¸ ê°€ì ¸ì˜¤ê¸° (ê°„ë‹¨ ì •ë ¬)
  let eventQuery = supabase
    .from("events")
    .select(`
      id, title, thumbnail_url, event_date, location, max_participants,
      event_registrations (count),
      event_type
    `)
    .order("event_date", { ascending: true })
    .limit(Math.ceil(limit / 2))

  const [postsResult, eventsResult] = await Promise.all([postQuery, eventQuery])

  const posts = (postsResult.data || []).map((p: any) => ({
    kind: "post" as const,
    ...p,
    content_preview: p.content ? String(p.content).replace(/<[^>]*>/g, "").slice(0, 160) : null,
    likes_count: p.likes_count || 0,
    comments_count: p.comments_count || 0,
    board_categories: Array.isArray(p.board_categories) ? p.board_categories[0] : p.board_categories,
    profiles: Array.isArray(p.profiles) ? p.profiles[0] : p.profiles,
  }))

  const events = (eventsResult.data || []).map((e: any) => ({
    kind: "event" as const,
    id: e.id,
    title: e.title,
    event_date: e.event_date,
    location: e.location,
    thumbnail_url: e.thumbnail_url,
    max_participants: e.max_participants,
    current_participants: e.event_registrations?.[0]?.count || 0,
    event_type: e.event_type || null,
  }))

  if (filter === "popular") {
    posts.sort((a, b) => (b.likes_count || 0) - (a.likes_count || 0))
  }

  // 3) ê²Œì‹œê¸€ + ì´ë²¤íŠ¸ í†µí•© (ê°„ë‹¨ ë¨¸ì§€: ìµœì‹ ìˆœìœ¼ë¡œ ì„ë˜ ì´ë²¤íŠ¸ëŠ” ì‚¬ì´ì— ì‚½ì…)
  const merged: FeedItem[] = []
  const maxLen = Math.max(posts.length, events.length)
  for (let i = 0; i < maxLen; i++) {
    if (posts[i]) merged.push(posts[i])
    if (events[i] && filter === "latest") merged.push(events[i]) // ìµœì‹  íƒ­ì—ì„œëŠ” ìì—°ìŠ¤ëŸ½ê²Œ ë¼ì›Œ ë„£ê¸°
  }

  // ì¸ê¸° íƒ­ì—ì„œëŠ” ê²Œì‹œê¸€ ìš°ì„ , ì´ë²¤íŠ¸ëŠ” ë’¤ì— ì¶”ê°€
  if (filter === "popular") {
    merged.push(...events)
  }

  return merged.slice(0, limit)
}
</file>

<file path="lib/queries/profiles.ts">
/**
 * í”„ë¡œí•„ ê´€ë ¨ ì¿¼ë¦¬ í•¨ìˆ˜
 * í”„ë¡œí•„ ë°ì´í„° í˜ì¹­ ë¡œì§ì˜ ì¬ì‚¬ìš©ì„±ì„ ë†’ì´ê¸° ìœ„í•œ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
 */

import type { SupabaseClient } from "@supabase/supabase-js"
import type { User, Profile, UserWithProfile } from "@/lib/types/profile"

/**
 * í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì˜ í”„ë¡œí•„ ì •ë³´ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
 * @param supabase Supabase í´ë¼ì´ì–¸íŠ¸
 * @returns ì‚¬ìš©ìì™€ í”„ë¡œí•„ ì •ë³´ë¥¼ í¬í•¨í•œ ê°ì²´, ë˜ëŠ” null (ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ê²½ìš°)
 */
export async function getCurrentUserProfile(
  supabase: SupabaseClient
): Promise<UserWithProfile | null> {
  try {
    // ì„¸ì…˜ ì—†ìœ¼ë©´ getUser() í˜¸ì¶œ ì—†ì´ ì¦‰ì‹œ ë°˜í™˜ (ë¹„ë¡œê·¸ì¸ ìµœì í™”)
    const { data: { session } } = await supabase.auth.getSession()
    if (!session) {
      return null
    }

    const { data: { user }, error: userError } = await supabase.auth.getUser()

    if (userError || !user) {
      return null
    }

    const { data: profile, error: profileError } = await supabase
      .from("profiles")
      .select("id, email, full_name, avatar_url, bio, role, roles, points, company, position, company_2, position_2, tagline, introduction, is_profile_public, membership_tier, last_login_date, created_at, updated_at")
      .eq("id", user.id)
      .single()

    if (profileError) {
      console.error("í”„ë¡œí•„ ì¡°íšŒ ì˜¤ë¥˜:", profileError)

      // ìƒˆ ì»¬ëŸ¼(tagline) ë¯¸ì ìš© ë“±ìœ¼ë¡œ ì¸í•œ ìŠ¤í‚¤ë§ˆ ë¶ˆì¼ì¹˜ì¼ ìˆ˜ ìˆìœ¼ë¯€ë¡œ
      // ì•ˆì „í•œ ìµœì†Œ ì»¬ëŸ¼ìœ¼ë¡œ í•œ ë²ˆ ë” ì¬ì‹œë„í•˜ì—¬ ë¡œê·¸ì¸ ìì²´ëŠ” ë§‰ì§€ ì•Šë„ë¡ ì²˜ë¦¬
      try {
        const { data: fallbackProfile, error: fallbackError } = await supabase
          .from("profiles")
          .select("id, email, full_name, avatar_url, bio, role, roles, points, company, position, company_2, position_2, introduction, is_profile_public, membership_tier, last_login_date, created_at, updated_at")
          .eq("id", user.id)
          .single()

        if (!fallbackError && fallbackProfile) {
          return {
            user,
            profile: fallbackProfile as Profile | null,
          }
        }
      } catch (fallbackException) {
        console.error("í”„ë¡œí•„ fallback ì¡°íšŒ ì˜¤ë¥˜:", fallbackException)
      }

      // fallbackë„ ì‹¤íŒ¨í•œ ê²½ìš°ì—ëŠ” í”„ë¡œí•„ ì—†ì´ ë¡œê·¸ì¸ë§Œ ìœ ì§€
      return { user, profile: null }
    }

    return {
      user,
      profile: profile as Profile | null,
    }
  } catch (error) {
    console.error("getCurrentUserProfile ì˜¤ë¥˜:", error)
    return null
  }
}
</file>

<file path="lib/supabase/admin.ts">
import { createClient } from "@supabase/supabase-js"

/**
 * Service Role Keyë¥¼ ì‚¬ìš©í•˜ëŠ” ê´€ë¦¬ì í´ë¼ì´ì–¸íŠ¸
 * RLS ì •ì±…ì„ ìš°íšŒí•˜ì—¬ ëª¨ë“  ë°ì´í„°ì— ì ‘ê·¼ ê°€ëŠ¥
 * ì£¼ì˜: ì´ í´ë¼ì´ì–¸íŠ¸ëŠ” ì„œë²„ ì‚¬ì´ë“œì—ì„œë§Œ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.
 */
export function createAdminClient() {
  const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL
  const supabaseServiceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY

  if (!supabaseUrl) {
    throw new Error("NEXT_PUBLIC_SUPABASE_URL is not set")
  }

  if (!supabaseServiceRoleKey) {
    throw new Error("SUPABASE_SERVICE_ROLE_KEY is not set. Please add it to your environment variables.")
  }

  return createClient(supabaseUrl, supabaseServiceRoleKey, {
    auth: {
      autoRefreshToken: false,
      persistSession: false,
    },
  })
}
</file>

<file path="lib/supabase/middleware.ts">
import { createClient } from "@supabase/supabase-js"
import { NextResponse, type NextRequest } from "next/server"

export async function updateSession(request: NextRequest) {
  const supabase = createClient(process.env.NEXT_PUBLIC_SUPABASE_URL!, process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!)

  // ì¿ í‚¤ì—ì„œ í† í° ê°€ì ¸ì˜¤ê¸°
  const accessToken = request.cookies.get("sb-access-token")?.value

  if (accessToken) {
    const {
      data: { user },
      error,
    } = await supabase.auth.getUser(accessToken)

    const pathname = request.nextUrl.pathname
    const protectedPaths = ["/admin"]
    const isProtectedPath = protectedPaths.some((path) => pathname === path || pathname.startsWith(path + "/"))

    if (isProtectedPath && (!user || error)) {
      const url = request.nextUrl.clone()
      url.pathname = "/auth/login"
      return NextResponse.redirect(url)
    }
  }

  return NextResponse.next()
}
</file>

<file path="lib/supabase/server.ts">
import { createServerClient } from "@supabase/ssr"
import { cookies } from "next/headers"

export async function createClient() {
  const cookieStore = await cookies()

  // @supabase/ssrì˜ createServerClientë¥¼ ì‚¬ìš©í•˜ì—¬ ì¿ í‚¤ ìë™ ì²˜ë¦¬
  return createServerClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        getAll() {
          return cookieStore.getAll()
        },
        setAll(cookiesToSet) {
          try {
            cookiesToSet.forEach(({ name, value, options }) => {
              cookieStore.set(name, value, options)
            })
          } catch {
            // The `setAll` method was called from a Server Component.
            // This can be ignored if you have middleware refreshing user sessions.
          }
        },
      },
    }
  )
}
</file>

<file path="lib/types/badges.ts">
/**
 * ë±ƒì§€ ê´€ë ¨ íƒ€ì… ì •ì˜
 * Supabase badges ë° user_badges í…Œì´ë¸” íƒ€ì…
 */

/**
 * ë±ƒì§€ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ íƒ€ì…
 * badges í…Œì´ë¸”ì˜ ëª¨ë“  ì»¬ëŸ¼ì„ í¬í•¨
 */
export type Badge = {
  id: string
  name: string
  icon: string
  category: string
  description: string | null
  is_active?: boolean | null // ë±ƒì§€ ê³µê°œ/ë¹„ê³µê°œ ìƒíƒœ (ê´€ë¦¬ììš©)
  created_at: string
}

/**
 * ì‚¬ìš©ì ë±ƒì§€ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ íƒ€ì…
 * user_badges í…Œì´ë¸”ì˜ ëª¨ë“  ì»¬ëŸ¼ì„ í¬í•¨
 */
export type UserBadge = {
  id: string
  user_id: string
  badge_id: string
  is_visible: boolean
  status?: 'pending' | 'approved' | 'rejected' | null
  evidence?: string | null
  created_at: string
  updated_at: string
}

/**
 * ì‚¬ìš©ì ë±ƒì§€ (ë±ƒì§€ ì •ë³´ í¬í•¨)
 * ì¡°ì¸ëœ ì¿¼ë¦¬ ê²°ê³¼ íƒ€ì…
 */
export type UserBadgeWithBadge = UserBadge & {
  badges: Badge | null
}

/**
 * í‘œì‹œìš© ë±ƒì§€ íƒ€ì… (ê°„ì†Œí™”)
 */
export type VisibleBadge = {
  icon: string
  name: string
}

/**
 * ë±ƒì§€ ì¹´í…Œê³ ë¦¬ íƒ€ì…
 */
export type BadgeCategory =
  | "personal_asset"
  | "corporate_revenue"
  | "investment"
  | "valuation"
  | "influence"
  | "professional_license"
  | "community"
</file>

<file path="lib/types/events.ts">
/**
 * ì´ë²¤íŠ¸ ê´€ë ¨ íƒ€ì… ì •ì˜
 * Supabase events í…Œì´ë¸” ë° ê´€ë ¨ í…Œì´ë¸” íƒ€ì…
 */

/**
 * ì´ë²¤íŠ¸ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ íƒ€ì…
 * events í…Œì´ë¸”ì˜ ëª¨ë“  ì»¬ëŸ¼ì„ í¬í•¨
 */
export type Event = {
  id: string
  title: string
  description: string
  event_date: string
  end_date: string | null
  location: string | null
  price: number | null
  max_participants: number | null
  thumbnail_url: string | null
  event_type: "networking" | "class" | "activity" | null
  created_by: string
  created_at: string
  updated_at: string
}

/**
 * ì´ë²¤íŠ¸ í‘œì‹œìš© íƒ€ì… (ì¡°ì¸ëœ ë°ì´í„° í¬í•¨)
 */
export type EventForDisplay = {
  id: string
  title: string
  thumbnail_url?: string | null
  event_date: string
  event_time?: string | null
  location?: string | null
  max_participants?: number | null
  current_participants: number
  event_type?: "networking" | "class" | "activity" | null
}

/**
 * ì´ë²¤íŠ¸ ìƒì„¸ ì •ë³´ íƒ€ì… (í”„ë¡œí•„ ì •ë³´ í¬í•¨)
 */
export type EventWithProfile = Event & {
  profiles?: {
    id: string
    full_name: string | null
    avatar_url: string | null
    bio: string | null
  } | null
}

/**
 * ì´ë²¤íŠ¸ ë“±ë¡ ì •ë³´ íƒ€ì…
 * event_registrations í…Œì´ë¸”
 */
export type EventRegistration = {
  id: string
  event_id: string
  user_id: string | null
  guest_name: string | null
  guest_contact: string | null
  registered_at: string
  status?: string | null
}

/**
 * ì´ë²¤íŠ¸ ë“±ë¡ ì •ë³´ (ì´ë²¤íŠ¸ ì •ë³´ í¬í•¨)
 */
export type EventRegistrationWithEvent = EventRegistration & {
  events: Event | null
}

/**
 * í”„ë¡œí•„ í˜ì´ì§€ì—ì„œ ì‚¬ìš©í•˜ëŠ” ì´ë²¤íŠ¸ ë¦¬ìŠ¤íŠ¸ ì•„ì´í…œ íƒ€ì…
 */
export type EventListItem = {
  id: string
  title: string
  thumbnail_url: string | null
  event_date: string
  location: string | null
  created_at: string
  registration_date?: string | null
  status?: string | null
}

/**
 * ì´ë²¤íŠ¸ ìƒì„± ì‹œ ì‚¬ìš©í•˜ëŠ” ë°ì´í„° íƒ€ì…
 */
export type EventInsertData = {
  title: string
  description: string
  event_date: string
  end_date?: string | null
  location?: string | null
  price?: number | null
  max_participants?: number | null
  thumbnail_url?: string | null
  event_type?: "networking" | "class" | "activity" | null
  created_by: string
}

/**
 * ì´ë²¤íŠ¸ ìˆ˜ì • ì‹œ ì‚¬ìš©í•˜ëŠ” ë°ì´í„° íƒ€ì…
 */
export type EventUpdateData = {
  title: string
  description: string
  event_date: string
  end_date?: string | null
  location?: string | null
  price?: number | null
  max_participants?: number | null
  thumbnail_url?: string | null
  event_type?: "networking" | "class" | "activity" | null
  updated_at: string
}
</file>

<file path="lib/types/home.ts">
/**
 * í™ˆ í˜ì´ì§€ ê´€ë ¨ íƒ€ì… ì •ì˜
 * í™ˆ í˜ì´ì§€ì—ì„œ ì‚¬ìš©í•˜ëŠ” ë°ì´í„° íƒ€ì…
 */

import type { EventCardEvent } from "@/components/ui/event-card"
import type { PostForDisplay } from "./posts"
import type { ReviewForDisplay } from "./posts"
import type { BoardCategory } from "./posts"
import type { User } from "./profile"
import type { Profile } from "./profile"

/**
 * í™ˆ í˜ì´ì§€ ì´ˆê¸° ë°ì´í„° íƒ€ì…
 */
export type HomePageData = {
  announcement: { id: string; title: string } | null
  events: EventCardEvent[]
  posts: PostForDisplay[]
  eventRequests: PostForDisplay[]
  reviews: ReviewForDisplay[]
  boardCategories: BoardCategory[]
  user: User | null
  profile: Profile | null
}

/**
 * í™ˆ í˜ì´ì§€ í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ Props íƒ€ì…
 */
export type HomePageClientProps = {
  children?: React.ReactNode
  initialAnnouncement?: { id: string; title: string } | null
  initialEvents?: EventCardEvent[]
  initialPosts?: PostForDisplay[]
  initialEventRequests?: PostForDisplay[]
  initialReviews?: ReviewForDisplay[]
  initialBoardCategories?: BoardCategory[]
  initialUser?: User | null
  initialProfile?: Profile | null
}
</file>

<file path="lib/types/posts.ts">
/**
 * ê²Œì‹œê¸€ ê´€ë ¨ íƒ€ì… ì •ì˜
 * Supabase posts í…Œì´ë¸” ë° ê´€ë ¨ í…Œì´ë¸” íƒ€ì…
 */

/**
 * ê²Œì‹œê¸€ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ íƒ€ì…
 * posts í…Œì´ë¸”ì˜ ëª¨ë“  ì»¬ëŸ¼ì„ í¬í•¨
 */
export type Post = {
  id: string
  title: string
  content: string
  author_id: string
  board_category_id: string | null
  community_id: string | null
  related_event_id: string | null
  visibility: "public" | "group"
  likes_count: number
  comments_count: number
  created_at: string
  updated_at: string
  thumbnail_url?: string | null
}

/**
 * ê²Œì‹œíŒ ì¹´í…Œê³ ë¦¬ íƒ€ì…
 */
export type BoardCategory = {
  id: string
  name: string
  slug: string
  description: string | null
  order_index: number
  is_active: boolean
}

/**
 * ê²Œì‹œê¸€ í‘œì‹œìš© íƒ€ì… (ì¡°ì¸ëœ ë°ì´í„° í¬í•¨)
 * lib/queries/posts.tsì˜ PostForDisplayì™€ í˜¸í™˜
 */
export type PostForDisplay = {
  id: string
  title: string
  content?: string | null
  created_at: string
  visibility?: "public" | "group"
  likes_count?: number
  comments_count?: number
  thumbnail_url?: string | null
  profiles?: {
    id?: string
    full_name?: string | null
    avatar_url?: string | null
  } | null
  board_categories?: {
    name?: string | null
    slug?: string | null
  } | null
  communities?: {
    name?: string | null
  } | null
}

import { ReviewForDisplay as OriginalReviewForDisplay } from "./reviews"

/**
 * í›„ê¸° í‘œì‹œìš© íƒ€ì…
 * lib/types/reviews.tsì˜ íƒ€ì…ì„ í™•ì¥í•˜ì—¬ ê¸°ì¡´ ì½”ë“œì™€ì˜ í˜¸í™˜ì„± ìœ ì§€
 */
export type ReviewForDisplay = OriginalReviewForDisplay & {
  likes_count?: number
  comments_count?: number
  title?: string // í˜¸í™˜ì„±
  content?: string | null // í˜¸í™˜ì„±
}

/**
 * í”„ë¡œí•„ í˜ì´ì§€ì—ì„œ ì‚¬ìš©í•˜ëŠ” ê²Œì‹œê¸€ ë¦¬ìŠ¤íŠ¸ ì•„ì´í…œ íƒ€ì…
 */
export type PostListItem = {
  id: string
  title: string
  created_at: string
  board_categories?: {
    name: string | null
    slug: string | null
  } | null
  likes_count?: number
  comments_count?: number
}
</file>

<file path="lib/types/profile.ts">
/**
 * í”„ë¡œí•„ ê´€ë ¨ íƒ€ì… ì •ì˜
 * Supabase profiles í…Œì´ë¸” ë° auth.usersì™€ ì—°ê´€ëœ íƒ€ì…
 */

import type { User as SupabaseUser } from "@supabase/supabase-js"

/**
 * Supabase Auth User íƒ€ì… (í™•ì¥ ê°€ëŠ¥)
 */
export type User = SupabaseUser

/**
 * í”„ë¡œí•„ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ íƒ€ì…
 * profiles í…Œì´ë¸”ì˜ ëª¨ë“  ì»¬ëŸ¼ì„ í¬í•¨
 */
export type Profile = {
  id: string
  email: string
  full_name: string | null
  avatar_url: string | null
  bio: string | null
  role: "member" | "admin" | "master"
  roles: string[] | null
  points: number
  company: string | null
  position: string | null
  company_2: string | null // ì¶”ê°€
  position_2: string | null // ì¶”ê°€
  tagline: string | null
  introduction: string | null
  is_profile_public: boolean
  member_type: ("ì‚¬ì—…ê°€" | "íˆ¬ìì" | "í¬ë¦¬ì—ì´í„°")[] | null
  membership_tier: string | null
  last_login_date: string | null
  created_at: string
  updated_at: string
}

/**
 * í”„ë¡œí•„ í‘œì‹œìš© íƒ€ì… (ì¼ë¶€ í•„ë“œë§Œ ì„ íƒ)
 */
export type ProfileForDisplay = {
  id: string
  full_name: string | null
  avatar_url: string | null
  role: "member" | "admin" | "master"
  points: number
  company: string | null
  position: string | null
  company_2: string | null // ì¶”ê°€
  position_2: string | null // ì¶”ê°€
  tagline: string | null
  introduction: string | null
  is_profile_public: boolean
  member_type: ("ì‚¬ì—…ê°€" | "íˆ¬ìì" | "í¬ë¦¬ì—ì´í„°")[] | null
  bio: string | null
  created_at: string
}

/**
 * ì‚¬ìš©ìì™€ í”„ë¡œí•„ì„ í•¨ê»˜ ë°˜í™˜í•˜ëŠ” íƒ€ì…
 */
export type UserWithProfile = {
  user: User
  profile: Profile | null
}
</file>

<file path="lib/types/reviews.ts">
/**
 * í›„ê¸°(Reviews) ê´€ë ¨ íƒ€ì… ì •ì˜
 * Supabase reviews í…Œì´ë¸” ë° ê´€ë ¨ íƒ€ì…
 */

/**
 * í›„ê¸° ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ íƒ€ì…
 * reviews í…Œì´ë¸”ì˜ ëª¨ë“  ì»¬ëŸ¼ì„ í¬í•¨
 */
export type Review = {
    id: string
    user_id: string
    event_id: string // í•„ìˆ˜ í•„ë“œ
    rating: number // 0.5 ~ 5.0 (ë°˜ê°œ ë‹¨ìœ„)
    keywords: string[]
    one_liner: string // 20-100ì
    detail_content: string | null
    images: string[]
    is_best: boolean
    is_public: boolean
    created_at: string
    updated_at: string
}

/**
 * í›„ê¸° ìƒì„± ì‹œ ì‚¬ìš©í•˜ëŠ” ë°ì´í„° íƒ€ì…
 */
export type ReviewInsertData = {
    user_id: string
    event_id: string // í•„ìˆ˜
    rating: number // 0.5 ~ 5.0
    keywords: string[]
    one_liner: string
    detail_content?: string | null
    images?: string[]
    is_public?: boolean
}

/**
 * í›„ê¸° ìˆ˜ì • ì‹œ ì‚¬ìš©í•˜ëŠ” ë°ì´í„° íƒ€ì…
 */
export type ReviewUpdateData = Partial<Omit<ReviewInsertData, "user_id">>

/**
 * í›„ê¸° í‘œì‹œìš© íƒ€ì… (í”„ë¡œí•„ ì •ë³´ í¬í•¨)
 */
export type ReviewForDisplay = Review & {
    profiles: {
        id: string
        full_name: string | null
        avatar_url: string | null
        role: "member" | "admin" | "master"
        company: string | null
        position: string | null
    } | null
    events: {
        id: string
        title: string
        event_date: string
        thumbnail_url: string | null
    }
}

/**
 * ë¯¸ë¦¬ ì •ì˜ëœ í‚¤ì›Œë“œ ëª©ë¡
 */
export const REVIEW_KEYWORDS = [
    "âš¡ï¸ ë™ê¸°ë¶€ì—¬",
    "ğŸ§  ìƒˆë¡œìš´ ê´€ì ",
    "ğŸ¤ ì¢‹ì€ ì¸ë§¥",
    "ğŸ›  ì‹¤ë¬´ ê¿€íŒ",
    "ğŸ’¼ íˆ¬ì ê¸°íšŒ",
    "ğŸ· ì¦ê±°ìš´ ë¶„ìœ„ê¸°",
    "ğŸŒ¿ íë§/ì¶©ì „",
    "ğŸ—£ï¸ ììœ ë¡œìš´ ì†Œí†µ",
    "ğŸ‰ ì•Œì°¬ êµ¬ì„±",
    "ğŸ§¸ ê°€ë²¼ìš´ ì‹œì‘",
] as const

export type ReviewKeyword = (typeof REVIEW_KEYWORDS)[number]
</file>

<file path="lib/types/unsplash.ts">
/**
 * Unsplash API ê´€ë ¨ íƒ€ì… ì •ì˜
 */

export type UnsplashImage = {
  id: string
  urls: {
    thumb: string
    small: string
    regular: string
    full: string
  }
  alt_description: string | null
  description: string | null
  width: number
  height: number
  user: {
    name: string
    username: string
  }
}

export type UnsplashSearchResponse = {
  success: boolean
  results?: UnsplashImage[]
  error?: string
}
</file>

<file path="lib/utils.ts">
import { clsx, type ClassValue } from 'clsx'
import { twMerge } from 'tailwind-merge'

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}

/**
 * ë§ˆìŠ¤í„° ê´€ë¦¬ì ì´ë©”ì¼ ëª©ë¡ (í™˜ê²½ ë³€ìˆ˜ì—ì„œ ì½ì–´ì˜´)
 * .env.localì— MASTER_ADMIN_EMAILS=email1@example.com,email2@example.com í˜•ì‹ìœ¼ë¡œ ì„¤ì •
 */
function getMasterAdminEmails(): string[] {
  const emails = process.env.NEXT_PUBLIC_MASTER_ADMIN_EMAILS || ''
  return emails.split(',').map(email => email.trim()).filter(Boolean)
}

/**
 * í˜„ì¬ ì‚¬ìš©ìê°€ ë§ˆìŠ¤í„° ê´€ë¦¬ìì¸ì§€ í™•ì¸í•˜ëŠ” í—¬í¼ í•¨ìˆ˜
 * @param userRole - ì‚¬ìš©ìì˜ role ê°’ ('member', 'admin', 'master')
 * @param userEmail - ì‚¬ìš©ìì˜ ì´ë©”ì¼ ì£¼ì†Œ (ì„ íƒì‚¬í•­, ì´ë©”ì¼ ê¸°ë°˜ ì²´í¬ìš©)
 * @returns ë§ˆìŠ¤í„° ê´€ë¦¬ì ì—¬ë¶€
 */
export function isMasterAdmin(userRole?: string | null, userEmail?: string | null): boolean {
  // roleì´ 'master'ì¸ ê²½ìš°
  if (userRole === 'master') {
    return true
  }

  // ì´ë©”ì¼ ê¸°ë°˜ ì²´í¬ (í™˜ê²½ ë³€ìˆ˜ì—ì„œ ë§ˆìŠ¤í„° ì´ë©”ì¼ ëª©ë¡ í™•ì¸)
  if (userEmail && getMasterAdminEmails().includes(userEmail)) {
    return true
  }

  return false
}

/**
 * í˜„ì¬ ì‚¬ìš©ìê°€ ê´€ë¦¬ì(admin ë˜ëŠ” master)ì¸ì§€ í™•ì¸í•˜ëŠ” í—¬í¼ í•¨ìˆ˜
 * @param userRole - ì‚¬ìš©ìì˜ role ê°’ ('member', 'admin', 'master')
 * @param userEmail - ì‚¬ìš©ìì˜ ì´ë©”ì¼ ì£¼ì†Œ (ì„ íƒì‚¬í•­, ì´ë©”ì¼ ê¸°ë°˜ ì²´í¬ìš©)
 * @returns ê´€ë¦¬ì ì—¬ë¶€
 */
export function isAdmin(userRole?: string | null, userEmail?: string | null): boolean {
  if (userRole === 'admin' || userRole === 'master') {
    return true
  }

  // ì´ë©”ì¼ ê¸°ë°˜ ë§ˆìŠ¤í„° ì²´í¬
  if (userEmail && getMasterAdminEmails().includes(userEmail)) {
    return true
  }

  return false
}
</file>

<file path="lib/utils/comments-tree.ts">
import type { CommentNode } from "@/lib/actions/comments"

// í”Œë«í•œ ëŒ“ê¸€ ëª©ë¡ì„ íŠ¸ë¦¬ë¡œ ë³€í™˜
export function buildCommentTree(flat: CommentNode[]): CommentNode[] {
  const map = new Map<string, CommentNode>()
  const roots: CommentNode[] = []

  flat.forEach((node) => {
    map.set(node.id, { ...node, children: [] })
  })

  flat.forEach((node) => {
    const current = map.get(node.id)!
    if (node.parent_id) {
      const parent = map.get(node.parent_id)
      if (parent) {
        parent.children?.push(current)
      } else {
        roots.push(current) // parentê°€ ì—†ìœ¼ë©´ ë£¨íŠ¸ ì·¨ê¸‰ (ë°ì´í„° ë³´í˜¸)
      }
    } else {
      roots.push(current)
    }
  })

  return roots
}
</file>

<file path="lib/utils/event-detail.tsx">
/**
 * ì´ë²¤íŠ¸ ìƒì„¸ í˜ì´ì§€ ê³µí†µ ë Œë”ë§ ë¡œì§
 * /e/[id]ì™€ /events/[id]ì—ì„œ ê³µí†µìœ¼ë¡œ ì‚¬ìš©
 */

import { createClient } from "@/lib/supabase/server";
import { notFound } from 'next/navigation';
import { Card, CardContent } from "@/components/ui/card";
import { Calendar, MapPin, Users, ChevronLeft, AlertCircle, Ticket, Edit } from 'lucide-react';
import { RegisterButton } from "@/components/register-button";
import Link from "next/link";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar";
import { Separator } from "@/components/ui/separator";
import { EventShareButton } from "@/components/event-share-button";
import { DeleteEventButton } from "@/components/delete-event-button";
import { FloatingActionBar } from "@/components/floating-action-bar";

export default async function EventDetailContent({ 
  eventId, 
  basePath = '/events' 
}: { 
  eventId: string; 
  basePath?: string;
}) {
  const supabase = await createClient();
  const { data: { user } } = await supabase.auth.getUser();

  // ì´ë²¤íŠ¸ ì •ë³´ ì¡°íšŒ
  let event;
  try {
    const { data, error } = await supabase
      .from("events")
      .select(`
        *,
        profiles:created_by (
          id,
          full_name,
          avatar_url,
          email,
          bio
        )
      `)
      .eq("id", eventId)
      .single();

    if (error || !data) {
      notFound();
    }

    event = data;
  } catch (error) {
    notFound();
  }

  // ì‚¬ìš©ì ë“±ë¡ ì—¬ë¶€ ì¡°íšŒ
  let userRegistration = null;
  if (user) {
    const { data: registrationData } = await supabase
      .from("event_registrations")
      .select("id, payment_status")
      .eq("event_id", eventId)
      .eq("user_id", user.id)
      .single();

    userRegistration = registrationData;
  }

  // ì°¸ì„ì ìˆ˜ ì¡°íšŒ
  const { count: attendeesCount } = await supabase
    .from("event_registrations")
    .select("*", { count: "exact", head: true })
    .eq("event_id", eventId);

  // ì°¸ì„ì ëª©ë¡ ì¡°íšŒ
  const { data: attendeesData } = await supabase
    .from("event_registrations")
    .select(`
      id,
      user_id,
      guest_name,
      profiles:user_id (
        id,
        full_name,
        avatar_url
      )
    `)
    .eq("event_id", eventId);

  const attendees = attendeesData || [];
  const isRegistered = !!userRegistration;
  const isPastEvent = new Date(event.event_date) < new Date();
  const isFull = event.max_participants && attendeesCount && attendeesCount >= event.max_participants;
  const isCreator = user && event.created_by === user.id;
  const isCompleted = event.status === 'completed';

  // ë‚ ì§œ/ì‹œê°„ í¬ë§·íŒ…
  const eventDate = new Date(event.event_date);
  const dateStr = eventDate.toLocaleDateString("ko-KR", {
    year: "numeric",
    month: "long",
    day: "numeric",
    weekday: "short",
  });
  const timeStr = eventDate.toLocaleTimeString("ko-KR", {
    hour: "numeric",
    minute: "2-digit",
  });

  const CardHeader = ({ icon: Icon, title, rightElement }: { icon: React.ComponentType<{ className?: string }>, title: string, rightElement?: React.ReactNode }) => (
    <div className="flex items-center justify-between pb-4 border-b border-slate-100 mb-6">
      <div className="flex items-center gap-2">
        <div className="p-1.5 rounded-md bg-slate-50 text-slate-500 border border-slate-100">
          <Icon className="h-4 w-4" />
        </div>
        <h3 className="text-lg font-bold text-slate-900 tracking-tight">{title}</h3>
      </div>
      {rightElement}
    </div>
  );

  return (
    <div className="w-full">
      {/* ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ */}
      <div className="mb-6 flex items-center justify-between">
        <Link href="/events" className="group flex items-center text-sm font-medium text-slate-500 hover:text-slate-900 transition-colors">
          <div className="mr-2 flex h-8 w-8 items-center justify-center rounded-full bg-white border border-slate-200 group-hover:border-slate-300 shadow-sm transition-all">
            <ChevronLeft className="h-4 w-4" />
          </div>
          ì´ë²¤íŠ¸ ëª©ë¡
        </Link>
      </div>

      <div className="flex flex-col gap-8">
        {/* [ROW 1] */}
        <div className="grid grid-cols-1 lg:grid-cols-12 gap-8 items-start">
          {/* Row 1 - Left (8) */}
          <div className="lg:col-span-8 bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden h-full">
            <div className="relative aspect-video w-full bg-slate-100">
              <img
                src={event.thumbnail_url || "/placeholder.svg"}
                alt={event.title}
                className="absolute inset-0 h-full w-full object-cover"
              />
              <div className="absolute top-4 left-4">
                {isCompleted ? (
                  <Badge className="bg-slate-800 text-white border-none px-3 py-1.5 text-sm font-medium">ì¢…ë£Œë¨</Badge>
                ) : isPastEvent ? (
                  <Badge variant="secondary" className="bg-slate-200 text-slate-700 border-none px-3 py-1.5 text-sm font-medium">ê¸°ê°„ ë§Œë£Œ</Badge>
                ) : isFull ? (
                  <Badge variant="destructive" className="px-3 py-1.5 text-sm font-medium">ë§ˆê°ì„ë°•</Badge>
                ) : (
                  <Badge className="bg-green-600 hover:bg-green-700 text-white border-none px-3 py-1.5 text-sm font-medium shadow-sm">
                    ëª¨ì§‘ì¤‘
                  </Badge>
                )}
              </div>
            </div>

            <div className="p-4 sm:p-8">
              <h1 className="text-2xl sm:text-3xl font-bold text-slate-900 leading-tight mb-4 sm:mb-8">
                {event.title}
              </h1>

              <div className="grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-4">
                {/* ë‚ ì§œ */}
                <div className="flex items-center gap-3 p-3 sm:p-5 rounded-xl sm:rounded-2xl bg-slate-50 border border-slate-100">
                  <div className="flex h-10 w-10 sm:h-11 sm:w-11 shrink-0 items-center justify-center rounded-lg sm:rounded-xl bg-white text-slate-900 shadow-sm border border-slate-100">
                    <Calendar className="h-4 w-4 sm:h-5 sm:w-5" />
                  </div>
                  <div className="flex-1 min-w-0">
                    <p className="text-sm sm:text-base font-bold text-slate-900 truncate">{dateStr} {timeStr}</p>
                  </div>
                </div>

                {/* ì¥ì†Œ */}
                <div className="flex items-center gap-3 p-3 sm:p-5 rounded-xl sm:rounded-2xl bg-slate-50 border border-slate-100">
                  <div className="flex h-10 w-10 sm:h-11 sm:w-11 shrink-0 items-center justify-center rounded-lg sm:rounded-xl bg-white text-slate-900 shadow-sm border border-slate-100">
                    <MapPin className="h-4 w-4 sm:h-5 sm:w-5" />
                  </div>
                  <div className="flex-1 min-w-0">
                    <p className="text-sm sm:text-base font-bold text-slate-900 truncate">{event.location}</p>
                  </div>
                </div>

                {/* í˜¸ìŠ¤íŠ¸ */}
                <div className="flex items-center gap-3 p-3 sm:p-5 rounded-xl sm:rounded-2xl bg-slate-50 border border-slate-100">
                  <Avatar className="h-10 w-10 sm:h-11 sm:w-11 border border-slate-100 shrink-0">
                    <AvatarImage src={event.profiles?.avatar_url || undefined} />
                    <AvatarFallback className="bg-slate-900 text-white font-bold text-xs sm:text-sm">
                      {event.profiles?.full_name?.[0] || "H"}
                    </AvatarFallback>
                  </Avatar>
                  <div className="flex-1 min-w-0">
                    <p className="text-xs text-slate-500 font-medium mb-0.5">í˜¸ìŠ¤íŠ¸</p>
                    <p className="text-sm sm:text-base font-bold text-slate-900 truncate">
                      {event.profiles?.full_name || "ì•Œ ìˆ˜ ì—†ìŒ"}
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          {/* Row 1 - Right (4) */}
          <Card id="register-card" className="lg:col-span-4 border-slate-200 shadow-md bg-white h-full flex flex-col">
            <CardContent className="p-6 flex flex-col h-full">
              <CardHeader
                icon={Ticket}
                title="ì°¸ê°€ ì‹ ì²­"
                rightElement={
                  <Badge variant="outline" className="font-medium text-slate-500 border-slate-200 bg-slate-50">
                    {event.price && event.price > 0 ? `${event.price.toLocaleString()}ì›` : 'Free'}
                  </Badge>
                }
              />

              <div className="mb-8">
                <div className="flex justify-between items-end mb-2">
                  <span className="text-sm text-slate-500 font-medium">í˜„ì¬ ëª¨ì§‘ í˜„í™©</span>
                  <div className="text-right">
                    <span className="text-2xl font-bold text-slate-900">{attendeesCount || 0}</span>
                    <span className="text-slate-400 text-sm font-medium ml-1">
                      / {event.max_participants ? event.max_participants : 'âˆ'}
                    </span>
                  </div>
                </div>
                {event.max_participants && event.max_participants > 0 ? (
                  <div className="w-full bg-slate-100 rounded-full h-2.5 overflow-hidden">
                    <div
                      className={`h-full rounded-full transition-all duration-500 ease-out ${isFull ? 'bg-red-500' : 'bg-slate-900'}`}
                      style={{ width: `${Math.min(100, ((attendeesCount || 0) / event.max_participants) * 100)}%` }}
                    />
                  </div>
                ) : null}
              </div>

              <div className="flex flex-col flex-1">
                <div className="flex flex-col gap-2">
                  {isPastEvent ? (
                    <Button className="w-full bg-slate-100 text-slate-500 hover:bg-slate-200 border-0 h-11 text-sm font-medium" disabled>
                      <AlertCircle className="mr-2 h-4 w-4" />
                      ì´ë²¤íŠ¸ê°€ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤
                    </Button>
                  ) : isCreator ? (
                    <>
                      <Link href={`${basePath}/${eventId}/edit`}>
                        <Button className="w-full bg-slate-900 text-white hover:bg-slate-800 h-11 text-sm font-medium">
                          <Edit className="mr-2 h-4 w-4" />
                          ì´ë²¤íŠ¸ ìˆ˜ì •
                        </Button>
                      </Link>

                      <Link href={`${basePath}/${eventId}/manage`}>
                        <Button variant="outline" className="w-full bg-white border-slate-300 text-slate-700 hover:bg-slate-50 h-11 text-sm font-medium">
                          <Users className="mr-2 h-4 w-4" />
                          ì°¸ì„ì ê´€ë¦¬
                        </Button>
                      </Link>

                      <EventShareButton
                        title={event.title}
                        description={event.description?.replace(/<[^>]*>/g, "").substring(0, 100) || event.title}
                        variant="outline"
                        className="w-full border-slate-200 text-slate-600 hover:bg-slate-50 hover:text-slate-900 h-10 text-sm font-medium transition-all shadow-sm hover:shadow"
                      >
                        ê³µìœ í•˜ê¸°
                      </EventShareButton>
                    </>
                  ) : (
                    <>
                      <RegisterButton
                        eventId={event.id}
                        userId={user?.id}
                        isRegistered={isRegistered}
                        paymentStatus={userRegistration?.payment_status}
                        isFull={!!isFull}
                        price={event.price || 0}
                      />

                      <Separator className="my-2 bg-slate-100" />

                      <EventShareButton
                        title={event.title}
                        description={event.description?.replace(/<[^>]*>/g, "").substring(0, 100) || event.title}
                        variant="outline"
                        className="w-full border-slate-200 text-slate-600 hover:bg-slate-50 hover:text-slate-900 h-10 text-sm font-medium transition-all shadow-sm hover:shadow"
                      >
                        ê³µìœ í•˜ê¸°
                      </EventShareButton>
                    </>
                  )}
                </div>

                {isCreator && !isPastEvent && (
                  <div className="mt-auto pt-4 border-t border-slate-100">
                    <DeleteEventButton
                      eventId={eventId}
                      variant="outline"
                      className="w-full border-red-200 text-red-600 hover:bg-red-50 hover:border-red-300 h-11 text-base font-medium"
                    />
                  </div>
                )}
              </div>
            </CardContent>
          </Card>
        </div>

        {/* [ROW 2] */}
        <div className="grid grid-cols-1 lg:grid-cols-12 gap-10 items-start">
          {/* Row 2 - Left (8) : ìƒì„¸ ë‚´ìš© */}
          <Card className="lg:col-span-8 border-slate-200 shadow-sm bg-white">
            <CardContent className="p-6 sm:p-8">
              <div
                className="prose prose-slate max-w-none prose-headings:font-bold prose-p:text-slate-600 prose-p:leading-relaxed prose-strong:text-slate-900"
                dangerouslySetInnerHTML={{ __html: event.description || "" }}
              />
            </CardContent>
          </Card>

          {/* Row 2 - Right (4) : ì°¸ì„ì ë©¤ë²„ */}
          <Card className="lg:col-span-4 border-slate-200 shadow-sm bg-white">
            <CardContent className="p-6">
              <CardHeader
                icon={Users}
                title="ì°¸ì„ì ë©¤ë²„"
                rightElement={
                  <span className="text-xs font-bold text-slate-500 bg-slate-100 px-2.5 py-1 rounded-full">
                    {attendeesCount || 0}ëª…
                  </span>
                }
              />

              {attendees && Array.isArray(attendees) && attendees.length > 0 ? (
                <div className="flex flex-wrap gap-3 max-h-[400px] overflow-y-auto">
                  {attendees.map((attendee: any, index: number) => {
                    const profile = Array.isArray(attendee.profiles)
                      ? attendee.profiles[0]
                      : attendee.profiles;
                    const name = profile?.full_name || attendee.guest_name || "ìµëª…";
                    return (
                      <div key={attendee.id || index} className="flex flex-col items-center gap-1.5 w-14 group cursor-default">
                        <Avatar className="h-12 w-12 border-2 border-white shadow-sm transition-all duration-200 group-hover:scale-105 group-hover:border-slate-200">
                          <AvatarImage src={profile?.avatar_url || undefined} />
                          <AvatarFallback className="bg-slate-100 text-slate-500 font-bold text-xs">
                            {name[0]}
                          </AvatarFallback>
                        </Avatar>
                        <span className="text-xs text-slate-600 truncate w-full text-center font-medium group-hover:text-slate-900">
                          {name}
                        </span>
                      </div>
                    );
                  })}
                </div>
              ) : (
                <div className="py-8 text-center bg-slate-50/50 rounded-xl border border-dashed border-slate-200">
                  <p className="text-slate-500 text-xs">ì•„ì§ ì°¸ì„ìê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                </div>
              )}
            </CardContent>
          </Card>
        </div>
      </div>

      {/* [Mobile Only] í•˜ë‹¨ ê³ ì • ì•¡ì…˜ ë°” */}
      <FloatingActionBar
        eventId={eventId}
        userId={user?.id}
        isRegistered={isRegistered}
        paymentStatus={userRegistration?.payment_status}
        isFull={!!isFull}
        price={event.price || 0}
        isPastEvent={isPastEvent}
        isCreator={!!isCreator}
        eventTitle={event.title}
        dateStr={dateStr}
        timeStr={timeStr}
        location={event.location}
      />
    </div>
  );
}
</file>

<file path="lib/utils/event-url.ts">
/**
 * ì´ë²¤íŠ¸ URL ê´€ë ¨ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
 * ë‚ ì§œ ê¸°ë°˜ ì§§ì€ ì½”ë“œ ìƒì„± ë° íŒŒì‹±
 * í˜•ì‹: MMdd + ìˆœì„œë²ˆí˜¸(01, 02, 03...)
 * ì˜ˆ: 121901 -> 12ì›” 19ì¼ì— ì²«ë²ˆì§¸ë¡œ ë§Œë“¤ì–´ì§„ ì´ë²¤íŠ¸
 */

/**
 * DB í˜¸ì¶œ ì—†ì´ shortUrl ìƒì„± (ê°„ë‹¨ ë²„ì „)
 * í˜•ì‹: MMddXX (ì• 2ìë¦¬ ID ì‚¬ìš©)
 * ì„±ëŠ¥ ìµœì í™”ë¥¼ ìœ„í•´ DB ì¡°íšŒ ì—†ì´ ì¦‰ì‹œ ìƒì„±
 */
export function formatShortCodeSync(eventId: string, eventDate: string): string {
  const date = new Date(eventDate)
  const month = String(date.getMonth() + 1).padStart(2, '0')
  const day = String(date.getDate()).padStart(2, '0')
  // ì´ë²¤íŠ¸ IDì˜ ì• 2ìë¦¬ë¥¼ ìˆœì„œ ëŒ€ìš©ìœ¼ë¡œ ì‚¬ìš©
  const idSuffix = eventId.substring(0, 2)
  return `${month}${day}${idSuffix}`
}

/**
 * ë™ê¸°ì‹ shortUrl ìƒì„± (DB í˜¸ì¶œ ì—†ìŒ)
 */
export function getEventShortUrlSync(eventId: string, eventDate: string): string {
  const shortCode = formatShortCodeSync(eventId, eventDate)
  return `/e/${shortCode}`
}

/**
 * ì´ë²¤íŠ¸ IDì™€ ë‚ ì§œë¡œ ì§§ì€ ì½”ë“œ ìƒì„±
 * í•´ë‹¹ ë‚ ì§œì— ëª‡ ë²ˆì§¸ë¡œ ë§Œë“¤ì–´ì§„ ì´ë²¤íŠ¸ì¸ì§€ ê³„ì‚°
 * ì˜ˆ: 12ì›” 19ì¼ ì²«ë²ˆì§¸ ì´ë²¤íŠ¸ -> "121901"
 */
export async function generateShortCode(
  eventId: string, 
  eventDate: string,
  supabase: any
): Promise<string> {
  const date = new Date(eventDate)
  const month = date.getMonth() + 1
  const day = date.getDate()
  const monthStr = String(month).padStart(2, '0')
  const dayStr = String(day).padStart(2, '0')
  const datePrefix = `${monthStr}${dayStr}` // ì˜ˆ: "1219"
  
  // ì—°ë„ì™€ ìƒê´€ì—†ì´ í•´ë‹¹ MMddì— í•´ë‹¹í•˜ëŠ” ëª¨ë“  ì´ë²¤íŠ¸ ì°¾ê¸°
  // ìµœì‹  ì—°ë„ë¶€í„° ìµœê·¼ 10ë…„ê¹Œì§€ ê²€ìƒ‰
  const currentYear = new Date().getFullYear()
  let allMatchingEvents: any[] = []
  
  // event_date ê¸°ì¤€ìœ¼ë¡œ ê²€ìƒ‰ (ì´ë²¤íŠ¸ê°€ ì—´ë¦¬ëŠ” ë‚ ì§œ ê¸°ì¤€)
  // ë‚ ì§œ ë¶€ë¶„ë§Œ ë¹„êµí•˜ê¸° ìœ„í•´ ëª¨ë“  ì´ë²¤íŠ¸ë¥¼ ê°€ì ¸ì˜¨ í›„ í•„í„°ë§
  const { data: allEventsForDate, error: fetchError } = await supabase
    .from("events")
    .select("id, created_at, event_date")
    .order("created_at", { ascending: true })
  
  if (fetchError) {
    console.error(`Error fetching events:`, fetchError)
    return `${datePrefix}01` // ê¸°ë³¸ê°’: ì²«ë²ˆì§¸
  }
  
  // ë‚ ì§œ ë¶€ë¶„ë§Œ ë¹„êµí•˜ì—¬ í•„í„°ë§ (ì‹œê°„ëŒ€ ë¬´ì‹œ)
  if (allEventsForDate && allEventsForDate.length > 0) {
    allEventsForDate.forEach((event: any) => {
      const eventDate = new Date(event.event_date)
      const eventMonth = eventDate.getMonth() + 1
      const eventDay = eventDate.getDate()
      
      // MMddê°€ ì¼ì¹˜í•˜ëŠ” ì´ë²¤íŠ¸ë§Œ ì¶”ê°€
      if (eventMonth === month && eventDay === day) {
        allMatchingEvents.push(event)
      }
    })
  }
  
  // ëª¨ë“  ì—°ë„ì—ì„œ ì°¾ì€ ì´ë²¤íŠ¸ë“¤ì„ created_at ìˆœì„œë¡œ ì •ë ¬ (ê°™ì€ ë‚ ì§œì˜ ì´ë²¤íŠ¸ ìˆœì„œ ê²°ì •)
  allMatchingEvents.sort((a, b) => {
    const dateA = new Date(a.created_at).getTime()
    const dateB = new Date(b.created_at).getTime()
    return dateA - dateB
  })
  
  if (allMatchingEvents.length === 0) {
    return `${datePrefix}01` // ê¸°ë³¸ê°’: ì²«ë²ˆì§¸
  }
  
  // í˜„ì¬ ì´ë²¤íŠ¸ê°€ ëª‡ ë²ˆì§¸ì¸ì§€ ì°¾ê¸°
  const eventIndex = allMatchingEvents.findIndex(e => e.id === eventId)
  
  if (eventIndex >= 0) {
    // ì´ë²¤íŠ¸ë¥¼ ì°¾ì€ ê²½ìš°: ì¸ë±ìŠ¤ + 1 (1-based)
    const orderNumber = eventIndex + 1
    const orderSuffix = String(orderNumber).padStart(2, '0')
    return `${datePrefix}${orderSuffix}` // ì˜ˆ: "121901"
  } else {
    // ì´ë²¤íŠ¸ë¥¼ ì°¾ì§€ ëª»í•œ ê²½ìš°: ë§ˆì§€ë§‰ ìˆœì„œ + 1
    // (ì´ë²¤íŠ¸ê°€ ë°©ê¸ˆ ìƒì„±ë˜ì–´ ì•„ì§ ì¿¼ë¦¬ ê²°ê³¼ì— í¬í•¨ë˜ì§€ ì•Šì•˜ì„ ìˆ˜ ìˆìŒ)
    const orderNumber = allMatchingEvents.length + 1
    const orderSuffix = String(orderNumber).padStart(2, '0')
    return `${datePrefix}${orderSuffix}` // ì˜ˆ: "121902"
  }
}

/**
 * ì´ë²¤íŠ¸ì˜ ì§§ì€ URL ìƒì„±
 * ì˜ˆ: /e/121901
 */
export async function getEventShortUrl(
  eventId: string, 
  eventDate: string,
  supabase: any
): Promise<string> {
  const shortCode = await generateShortCode(eventId, eventDate, supabase)
  return `/e/${shortCode}`
}

/**
 * ì§§ì€ ì½”ë“œì—ì„œ ë‚ ì§œ ì ‘ë‘ì‚¬ì™€ ìˆœì„œë²ˆí˜¸ ì¶”ì¶œ
 */
export function parseShortCode(shortCode: string): { datePrefix: string; orderNumber: number } | null {
  if (shortCode.length < 6) return null
  
  const datePrefix = shortCode.substring(0, 4) // MMdd
  const orderSuffix = shortCode.substring(4, 6) // ìˆœì„œë²ˆí˜¸ (01, 02, 03...)
  const orderNumber = parseInt(orderSuffix, 10)
  
  if (isNaN(orderNumber) || orderNumber < 1) return null
  
  return { datePrefix, orderNumber }
}

/**
 * ì§§ì€ ì½”ë“œë¡œ ì´ë²¤íŠ¸ë¥¼ ì°¾ê¸° ìœ„í•œ ì¿¼ë¦¬ ì¡°ê±´ ìƒì„±
 * ë‚ ì§œ ì ‘ë‘ì‚¬(MMdd)ì™€ ìˆœì„œë²ˆí˜¸ë¡œ ê²€ìƒ‰
 */
export function buildEventQueryFromShortCode(shortCode: string) {
  const parsed = parseShortCode(shortCode)
  if (!parsed) return null
  
  const { datePrefix, orderNumber } = parsed
  
  // MMdd í˜•ì‹ì—ì„œ ì›”ê³¼ ì¼ ì¶”ì¶œ
  const month = parseInt(datePrefix.substring(0, 2), 10)
  const day = parseInt(datePrefix.substring(2, 4), 10)
  
  return {
    month,
    day,
    orderNumber, // 1-based index
  }
}
</file>

<file path="lib/utils/scroll-lock.ts">
/**
 * ëª¨ë‹¬ì´ ì—´ë¦´ ë•Œ ìŠ¤í¬ë¡¤ë°”ë¡œ ì¸í•œ ë ˆì´ì•„ì›ƒ ì‹œí”„íŠ¸ë¥¼ ë°©ì§€í•˜ëŠ” ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
 * 
 * Radix UIì˜ Dialog, Sheet ë“±ì€ ëª¨ë‹¬ì´ ì—´ë¦´ ë•Œ bodyì— overflow: hiddenì„ ì ìš©í•©ë‹ˆë‹¤.
 * ì´ë¡œ ì¸í•´ ìŠ¤í¬ë¡¤ë°”ê°€ ì‚¬ë¼ì§€ë©´ì„œ ë ˆì´ì•„ì›ƒì´ ì™¼ìª½ìœ¼ë¡œ ë°€ë¦¬ëŠ” ë¬¸ì œê°€ ë°œìƒí•©ë‹ˆë‹¤.
 * 
 * í•´ê²° ë°©ë²•: bodyì— ìŠ¤í¬ë¡¤ë°” ë„ˆë¹„ë§Œí¼ padding-rightë¥¼ ì¶”ê°€í•˜ì—¬ ê³µê°„ì„ ìœ ì§€í•©ë‹ˆë‹¤.
 * 
 * ì—¬ëŸ¬ ëª¨ë‹¬ì´ ë™ì‹œì— ì—´ë¦´ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ref countingì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
 */

const SCROLLBAR_WIDTH_VAR = '--scrollbar-width'
const BODY_PADDING_VAR = '--body-padding-right-original'

// ref countingì„ ìœ„í•œ ë³€ìˆ˜
let lockCount = 0
let originalPaddingRight: string | null = null

/**
 * ìŠ¤í¬ë¡¤ë°”ì˜ ë„ˆë¹„ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤ (px)
 * ì—¬ëŸ¬ ë°©ë²•ì„ ì‹œë„í•˜ì—¬ ê°€ì¥ ì •í™•í•œ ê°’ì„ ì–»ìŠµë‹ˆë‹¤
 */
function getScrollbarWidth(): number {
  if (typeof window === 'undefined') return 0

  const root = document.documentElement
  const cached = root.style.getPropertyValue(SCROLLBAR_WIDTH_VAR)
  if (cached) {
    const width = parseInt(cached, 10)
    if (!isNaN(width) && width > 0) {
      return width
    }
  }

  // ë°©ë²• 1: window.innerWidthì™€ document.documentElement.clientWidthì˜ ì°¨ì´
  // ì´ê²ƒì´ ê°€ì¥ ì •í™•í•œ ì‹¤ì œ ìŠ¤í¬ë¡¤ë°” ë„ˆë¹„ì…ë‹ˆë‹¤
  const scrollbarWidth1 = window.innerWidth - document.documentElement.clientWidth

  // ë°©ë²• 2: ì„ì‹œ ìš”ì†Œë¥¼ ë§Œë“¤ì–´ì„œ ê³„ì‚° (fallback)
  const outer = document.createElement('div')
  outer.style.visibility = 'hidden'
  outer.style.overflow = 'scroll'
  ;(outer.style as any).msOverflowStyle = 'scrollbar' // IE, Edge ëŒ€ì‘
  outer.style.position = 'absolute'
  outer.style.top = '-9999px'
  outer.style.width = '100px'
  outer.style.height = '100px'
  document.body.appendChild(outer)

  const inner = document.createElement('div')
  inner.style.width = '100%'
  inner.style.height = '100%'
  outer.appendChild(inner)

  const scrollbarWidth2 = outer.offsetWidth - inner.offsetWidth

  document.body.removeChild(outer)

  // ë‘ ë°©ë²• ì¤‘ ë” í° ê°’ì„ ì‚¬ìš© (ì•ˆì „í•˜ê²Œ)
  const scrollbarWidth = Math.max(scrollbarWidth1, scrollbarWidth2)

  // CSS ë³€ìˆ˜ë¡œ ìºì‹±
  if (scrollbarWidth > 0) {
    root.style.setProperty(SCROLLBAR_WIDTH_VAR, `${scrollbarWidth}`)
  }

  return scrollbarWidth
}

/**
 * ëª¨ë‹¬ì´ ì—´ë¦´ ë•Œ bodyì— ìŠ¤í¬ë¡¤ë°” ë„ˆë¹„ë§Œí¼ paddingì„ ì¶”ê°€í•©ë‹ˆë‹¤
 * ì—¬ëŸ¬ ëª¨ë‹¬ì´ ë™ì‹œì— ì—´ë¦´ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ref counting ì‚¬ìš©
 * 
 * ì£¼ì˜: ì¸ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ê°€ ì´ë¯¸ paddingì„ ì ìš©í–ˆì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ í™•ì¸ í•„ìš”
 */
export function lockBodyScroll(): void {
  if (typeof window === 'undefined') return

  const scrollbarWidth = getScrollbarWidth()
  
  // ìŠ¤í¬ë¡¤ë°”ê°€ ì—†ëŠ” ê²½ìš° (ëª¨ë°”ì¼ ë“±) ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•ŠìŒ
  if (scrollbarWidth === 0) return

  lockCount++

  const body = document.body

  // ì²« ë²ˆì§¸ lockì¼ ë•Œë§Œ ì›ë³¸ padding-right ê°’ ì €ì¥
  if (lockCount === 1) {
    // ì¸ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ê°€ ì´ë¯¸ ì ìš©í–ˆëŠ”ì§€ í™•ì¸
    const alreadyApplied = body.style.getPropertyValue('--scrollbar-fix-applied')
    const existingOriginalPadding = body.style.getPropertyValue('--body-padding-right-original')
    
    if (alreadyApplied && existingOriginalPadding) {
      // ì¸ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ê°€ ì´ë¯¸ ì ìš©í•œ ê²½ìš°, ê·¸ ê°’ì„ ì‚¬ìš©
      originalPaddingRight = existingOriginalPadding
      // ì¶”ê°€ë¡œ ìŠ¤í¬ë¡¤ë°” ë„ˆë¹„ë§Œí¼ ë” ì¶”ê°€ (ëª¨ë‹¬ì´ ì—´ë¦´ ë•Œ overflow: hiddenì´ ì ìš©ë˜ë¯€ë¡œ)
      const currentPaddingRight = window.getComputedStyle(body).paddingRight
      const currentPaddingRightValue = parseInt(currentPaddingRight, 10) || 0
      // ì´ë¯¸ ìŠ¤í¬ë¡¤ë°” ë„ˆë¹„ê°€ í¬í•¨ë˜ì–´ ìˆì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ í™•ì¸
      const basePadding = parseInt(existingOriginalPadding, 10) || 0
      if (currentPaddingRightValue < basePadding + scrollbarWidth) {
        body.style.setProperty('padding-right', `${basePadding + scrollbarWidth}px`, 'important')
      }
    } else {
      // ì¸ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ê°€ ì ìš©í•˜ì§€ ì•Šì€ ê²½ìš° ì§ì ‘ ì²˜ë¦¬
      const currentPaddingRight = window.getComputedStyle(body).paddingRight
      originalPaddingRight = currentPaddingRight || '0px'
      
      const currentPaddingRightValue = parseInt(originalPaddingRight, 10) || 0
      const newPaddingRight = currentPaddingRightValue + scrollbarWidth
      
      body.style.setProperty('--body-padding-right-original', originalPaddingRight, 'important')
      body.style.setProperty('padding-right', `${newPaddingRight}px`, 'important')
    }
  }
}

/**
 * ëª¨ë‹¬ì´ ë‹«í ë•Œ bodyì˜ paddingì„ ì›ë˜ëŒ€ë¡œ ë³µì›í•©ë‹ˆë‹¤
 * ëª¨ë“  ëª¨ë‹¬ì´ ë‹«í ë•Œë§Œ ì‹¤ì œë¡œ ë³µì›
 * 
 * ì£¼ì˜: ì¸ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ê°€ ì´ë¯¸ paddingì„ ì ìš©í–ˆì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ í™•ì¸ í•„ìš”
 */
export function unlockBodyScroll(): void {
  if (typeof window === 'undefined') return

  lockCount = Math.max(0, lockCount - 1)

  // ëª¨ë“  ëª¨ë‹¬ì´ ë‹«í ë•Œë§Œ ì‹¤ì œë¡œ ë³µì›
  if (lockCount === 0) {
    const body = document.body
    
    // ì¸ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ê°€ ì ìš©í•œ ì›ë³¸ paddingì´ ìˆëŠ”ì§€ í™•ì¸
    const inlineOriginalPadding = body.style.getPropertyValue('--body-padding-right-original')
    
    if (originalPaddingRight !== null) {
      // ëª¨ë‹¬ lockì—ì„œ ì €ì¥í•œ ê°’ìœ¼ë¡œ ë³µì›
      body.style.setProperty('padding-right', originalPaddingRight, 'important')
      originalPaddingRight = null
    } else if (inlineOriginalPadding) {
      // ì¸ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ê°€ ì ìš©í•œ ê°’ìœ¼ë¡œ ë³µì›
      body.style.setProperty('padding-right', inlineOriginalPadding, 'important')
    } else {
      // ì €ì¥ëœ ê°’ì´ ì—†ìœ¼ë©´ ì œê±°
      body.style.removeProperty('padding-right')
    }
  }
}
</file>

<file path="MOBILE_TEST_RESULTS.md">
# Seoul Founders Club - ëª¨ë°”ì¼ ë°˜ì‘í˜• í…ŒìŠ¤íŠ¸ ê²°ê³¼

**í…ŒìŠ¤íŠ¸ ì¼ì‹œ**: 2025ë…„ 12ì›” 2ì¼  
**í…ŒìŠ¤íŠ¸ í™˜ê²½**: iPhone SE (375x667) - `http://localhost:3000`

---

## ğŸ“± ëª¨ë°”ì¼ ë°˜ì‘í˜• ì¢…í•© í‰ê°€

### âœ… **ì „ì²´ í‰ê°€: ìš°ìˆ˜**

ëª¨ë“  í˜ì´ì§€ê°€ ëª¨ë°”ì¼ì—ì„œ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ë©°, ë ˆì´ì•„ì›ƒ ê¹¨ì§ì´ë‚˜ ê¸°ëŠ¥ ì œì•½ì´ ì—†ìŠµë‹ˆë‹¤.

---

## ğŸ“‹ í˜ì´ì§€ë³„ ìƒì„¸ í…ŒìŠ¤íŠ¸ ê²°ê³¼

### 1. í™ˆí˜ì´ì§€ (`/`) âœ…

**ë ˆì´ì•„ì›ƒ**:
- âœ… ëª¨ë°”ì¼ í—¤ë” ì •ìƒ í‘œì‹œ (ë¡œê³ , ì•Œë¦¼ ì•„ì´ì½˜, í–„ë²„ê±° ë©”ë‰´)
- âœ… Hero ì„¹ì…˜ ê¹”ë”í•˜ê²Œ í‘œì‹œ
  - íƒ€ì´í‹€: "ìƒˆë¡œìš´ ê°€ì¹˜ë¥¼ ë§Œë“œëŠ” ì‚¬ëŒë“¤ì˜ ë² ì´ìŠ¤ìº í”„"
  - ì„¤ëª… í…ìŠ¤íŠ¸ 2ì¤„ë¡œ ì •ë¦¬
  - "3ì´ˆë§Œì— ê°€ì…í•˜ê¸°" ë²„íŠ¼ ì¤‘ì•™ ì •ë ¬
- âœ… ì´ë²¤íŠ¸ ì„¹ì…˜
  - íƒ€ì´í‹€ + í•„í„° ë²„íŠ¼ (ì „ì²´/ë„¤íŠ¸ì›Œí‚¹/í´ë˜ìŠ¤/ì•¡í‹°ë¹„í‹°)
  - ì´ë²¤íŠ¸ ì¹´ë“œ: ë‹¨ì¼ ì»¬ëŸ¼, ì¹´ë“œí˜• ë ˆì´ì•„ì›ƒ
  - ì¸ë„¤ì¼ ì´ë¯¸ì§€ ì •ìƒ í‘œì‹œ
- âœ… í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ë°” ê³ ì • (í™ˆ/ì´ë²¤íŠ¸/ë§Œë“¤ê¸°/ì»¤ë®¤ë‹ˆí‹°/ë¡œê·¸ì¸)

**ì˜ë¦¬ê±°ë‚˜ ê²¹ì¹˜ëŠ” ë¶€ë¶„**: ì—†ìŒ

**ê¸°ëŠ¥**:
- âœ… ì•Œë¦¼ ì•„ì´ì½˜ í´ë¦­ ê°€ëŠ¥
- âœ… í–„ë²„ê±° ë©”ë‰´ í´ë¦­ ê°€ëŠ¥ (ì‚¬ì´ë“œë°” í¼ì¹¨)
- âœ… ì´ë²¤íŠ¸ í•„í„° ë²„íŠ¼ ì •ìƒ ì‘ë™
- âœ… ì¹´ë“œ ìŠ¤í¬ë¡¤ ì •ìƒ

**ìŠ¤í¬ë¦°ìƒ·**: `mobile-home-top.png`, `mobile-home-middle.png`, `mobile-home-bottom.png`

---

### 2. ë©¤ë²„ ë¦¬ìŠ¤íŠ¸ (`/member`) âœ…

**ë ˆì´ì•„ì›ƒ**:
- âœ… ë°°ë„ˆ ì„¹ì…˜ ì •ìƒ í‘œì‹œ
  - íƒ€ì´í‹€: "ë©¤ë²„"
  - ì„¤ëª…: "ê°ìì˜ ì˜ì—­ì—ì„œ ì„±ê³¼ë¥¼ ì¦ëª…í•œ, ê²€ì¦ëœ ë©¤ë²„ë“¤ì„ ë§Œë‚˜ë³´ì„¸ìš”"
- âœ… ë©¤ë²„ ì¹´ë“œ: ë‹¨ì¼ ì»¬ëŸ¼ (ì„¸ë¡œí˜•)
  - í”„ë¡œí•„ ì‚¬ì§„ ìƒë‹¨ ì¤‘ì•™ ë°°ì¹˜
  - ì´ë¦„ ì¤‘ì•™ ì •ë ¬
  - ì†Œì†/ì§ì±… ì •ë³´
  - ì†Œê°œê¸€ 3ì¤„
  - ë±ƒì§€ í•˜ë‹¨ ì¤‘ì•™ ë°°ì¹˜
- âœ… ì´ ë©¤ë²„ ìˆ˜ í‘œì‹œ ("ì´ 1ëª…")

**ì˜ë¦¬ê±°ë‚˜ ê²¹ì¹˜ëŠ” ë¶€ë¶„**: ì—†ìŒ

**ë°œê²¬ëœ ë¬¸ì œì **: ì—†ìŒ

**ê°œì„  ì œì•ˆ**:
- ë©¤ë²„ ì¹´ë“œê°€ ì„¸ë¡œí˜•ìœ¼ë¡œ ì˜ êµ¬ì„±ë˜ì–´ ìˆìŒ
- í”„ë¡œí•„ ì‚¬ì§„ì´ ìƒë‹¨ ì¤‘ì•™ì— ë°°ì¹˜ë˜ì–´ ëª¨ë°”ì¼ì—ì„œ ë³´ê¸° í¸í•¨
- í…ìŠ¤íŠ¸ê°€ ì ì ˆíˆ ì¤„ë°”ê¿ˆë˜ì–´ ê°€ë…ì„± ì¢‹ìŒ

**ìŠ¤í¬ë¦°ìƒ·**: `mobile-member.png`

---

### 3. ì»¤ë®¤ë‹ˆí‹° í™ˆ (`/community`) âœ…

**ë ˆì´ì•„ì›ƒ**:
- âœ… ë°°ë„ˆ ì •ìƒ í‘œì‹œ
  - íƒ€ì´í‹€: "ì»¤ë®¤ë‹ˆí‹°"
  - ì„¤ëª…: "ë‹¤ì–‘í•œ ì£¼ì œë¡œ ì†Œí†µí•˜ê³  í•¨ê»˜ ì„±ì¥í•˜ëŠ” ê³µê°„ì…ë‹ˆë‹¤"
- âœ… ì»¤ë®¤ë‹ˆí‹° ì¹´ë“œ 2ê°œ (ë°˜ê³¨, í•˜ì´í† í¬)
  - ë‹¨ì¼ ì»¬ëŸ¼ ë°°ì¹˜
  - ì•„ì´ì½˜ + íƒ€ì´í‹€ + ì„¤ëª…
  - ìš°ì¸¡ í™”ì‚´í‘œ ì•„ì´ì½˜
- âœ… ìµœì‹  ê¸€ ì„¹ì…˜
  - "í”¼ë“œí˜•/ë¦¬ìŠ¤íŠ¸í˜•" í† ê¸€ ë²„íŠ¼ (ìš°ì¸¡ ìƒë‹¨)
  - ì»¤ë®¤ë‹ˆí‹° íƒ­ í•„í„° (ì „ì²´/ë°˜ê³¨/í•˜ì´í† í¬)
  - ê²Œì‹œê¸€ ì¹´ë“œ ë¦¬ìŠ¤íŠ¸

**ì˜ë¦¬ê±°ë‚˜ ê²¹ì¹˜ëŠ” ë¶€ë¶„**: ì—†ìŒ

**ê¸°ëŠ¥**:
- âœ… ì»¤ë®¤ë‹ˆí‹° ì¹´ë“œ í´ë¦­ ê°€ëŠ¥
- âœ… í”¼ë“œí˜•/ë¦¬ìŠ¤íŠ¸í˜• í† ê¸€ ì •ìƒ ì‘ë™
- âœ… íƒ­ í•„í„° ì •ìƒ ì‘ë™
- âœ… ê²Œì‹œê¸€ ì¹´ë“œ í´ë¦­ ê°€ëŠ¥

**ê°œì„  ì œì•ˆ**:
- í•˜ì´í† í¬ ì„¤ëª… í…ìŠ¤íŠ¸ê°€ ê¸¸ì–´ì„œ 2ì¤„ë¡œ ì˜ë¦¼ (`...` ì²˜ë¦¬)
- ì´ëŠ” ì˜ë„ëœ ë””ìì¸ìœ¼ë¡œ ë³´ì´ë©°, ë¬¸ì œ ì—†ìŒ

**ìŠ¤í¬ë¦°ìƒ·**: `mobile-community.png`

---

### 4. ë°˜ê³¨ ê²Œì‹œíŒ (`/community/board/vangol`) âœ…

**ë ˆì´ì•„ì›ƒ**:
- âœ… ë°°ë„ˆ ì •ìƒ í‘œì‹œ
  - íƒ€ì´í‹€: "ë°˜ê³¨"
  - ì„¤ëª…: "ë°˜ê³¨ ëª¨ì„ ì „ìš©"
- âœ… "ì°¸ì—¬í•˜ê¸°" ë²„íŠ¼ (ìš°ì¸¡ ìƒë‹¨, íŒŒë€ìƒ‰, ê³ ì •)
- âœ… ê²Œì‹œíŒ ì œëª© ("ë°˜ê³¨") + "í”¼ë“œí˜•/ë¦¬ìŠ¤íŠ¸í˜•" í† ê¸€
- âœ… ê²Œì‹œê¸€ ì¹´ë“œ
  - ì‘ì„±ì í”„ë¡œí•„ ì‚¬ì§„ + ì´ë¦„
  - ì†Œì† (ì˜ˆ: "ë°˜ê³¨") + ì‘ì„± ì‹œê°„
  - ê²Œì‹œê¸€ ì œëª© (ì´ëª¨ì§€ í¬í•¨)
  - ê²Œì‹œê¸€ ë‚´ìš© ë¯¸ë¦¬ë³´ê¸° (2ì¤„)
  - ì¢‹ì•„ìš”/ëŒ“ê¸€ ìˆ˜

**ì˜ë¦¬ê±°ë‚˜ ê²¹ì¹˜ëŠ” ë¶€ë¶„**: ì—†ìŒ

**ê¸°ëŠ¥**:
- âœ… "ì°¸ì—¬í•˜ê¸°" ë²„íŠ¼ í´ë¦­ ê°€ëŠ¥
- âœ… í”¼ë“œí˜•/ë¦¬ìŠ¤íŠ¸í˜• í† ê¸€ ì •ìƒ ì‘ë™
- âœ… ê²Œì‹œê¸€ ì¹´ë“œ í´ë¦­ ê°€ëŠ¥

**íŠ¹ì´ì‚¬í•­**:
- "ì°¸ì—¬í•˜ê¸°" ë²„íŠ¼ì´ ìš°ì¸¡ ìƒë‹¨ì— ê³ ì •ë˜ì–´ ìˆì–´ ìŠ¤í¬ë¡¤ ì‹œì—ë„ í•­ìƒ ë³´ì„
- ì´ëŠ” ì¢‹ì€ UX ì„¤ê³„

**ìŠ¤í¬ë¦°ìƒ·**: `mobile-vangol-top.png`, `mobile-vangol-bottom.png`

---

### 5. ì´ë²¤íŠ¸ ëª©ë¡ (`/events`) âœ…

**ë ˆì´ì•„ì›ƒ**:
- âœ… ë°°ë„ˆ ì •ìƒ í‘œì‹œ
  - íƒ€ì´í‹€: "ì´ë²¤íŠ¸"
  - ì„¤ëª…: "í•¨ê»˜ ì„±ì¥í•˜ëŠ” ë„¤íŠ¸ì›Œí‚¹ íŒŒí‹°ì™€ ì¸ì‚¬ì´íŠ¸ ì„¸ë¯¸ë‚˜ë¥¼ ë†“ì¹˜ì§€ ë§ˆì„¸ìš”"
- âœ… "ë‹¤ê°€ì˜¤ëŠ” ì´ë²¤íŠ¸" í—¤ë”
- âœ… í•„í„° ë²„íŠ¼ (ì „ì²´/ë„¤íŠ¸ì›Œí‚¹/í´ë˜ìŠ¤/ì•¡í‹°ë¹„í‹°)
- âœ… ì´ë²¤íŠ¸ ì¹´ë“œ
  - ì¸ë„¤ì¼ ì´ë¯¸ì§€ (ê³ ì–‘ì´ ì‚¬ì§„)
  - ì¹´í…Œê³ ë¦¬ ë±ƒì§€ (í´ë˜ìŠ¤, ë„¤íŠ¸ì›Œí‚¹, ì•¡í‹°ë¹„í‹°)
  - ì œëª© (2ì¤„)
  - í˜¸ìŠ¤íŠ¸ ì •ë³´ (ì•„ë°”íƒ€ + ì´ë¦„)
  - ë‚ ì§œ, ì‹œê°„, ì¥ì†Œ
  - ì°¸ê°€ì ìˆ˜ (2/15)

**ì˜ë¦¬ê±°ë‚˜ ê²¹ì¹˜ëŠ” ë¶€ë¶„**: ì—†ìŒ

**ê¸°ëŠ¥**:
- âœ… í•„í„° ë²„íŠ¼ ì •ìƒ ì‘ë™
- âœ… ì´ë²¤íŠ¸ ì¹´ë“œ í´ë¦­ ê°€ëŠ¥
- âœ… ê°€ë¡œ ìŠ¤í¬ë¡¤ (ì´ë²¤íŠ¸ ì¹´ë“œê°€ ì—¬ëŸ¬ ê°œì¼ ê²½ìš°)

**ìš°ìˆ˜í•œ ì **:
- ì´ë²¤íŠ¸ ì¹´ë“œê°€ ëª¨ë°”ì¼ì—ì„œ ë§¤ìš° ë³´ê¸° ì¢‹ìŒ
- ì¸ë„¤ì¼ ì´ë¯¸ì§€ê°€ ì¹´ë“œ ì „ì²´ë¥¼ ì±„ìš°ë©° ê·¸ë¼ë””ì–¸íŠ¸ ì˜¤ë²„ë ˆì´ë¡œ ê°€ë…ì„± í™•ë³´
- ì •ë³´ ë°°ì¹˜ê°€ ê¹”ë”í•¨

**ìŠ¤í¬ë¦°ìƒ·**: `mobile-events.png`

---

### 6. About í˜ì´ì§€ (`/about`) âœ…

**ë ˆì´ì•„ì›ƒ**:
- âœ… Hero ì„¹ì…˜
  - ë°°ê²½ ì´ë¯¸ì§€ ì •ìƒ í‘œì‹œ
  - íƒ€ì´í‹€: "ìƒˆë¡œìš´ ê°€ì¹˜ë¥¼ ë§Œë“œëŠ” ì‚¬ëŒë“¤ì˜ ë² ì´ìŠ¤ìº í”„"
  - ì„¤ëª… í…ìŠ¤íŠ¸
  - "3ì´ˆë§Œì— ê°€ì…í•˜ê¸°" ë²„íŠ¼
- âœ… "ìš°ë¦¬ëŠ” ì„œë¡œì˜ ì„±ì¥ ë™ë ¥ì…ë‹ˆë‹¤" ì„¹ì…˜
  - íƒ€ì´í‹€ + ì„¤ëª… ì¤‘ì•™ ì •ë ¬
  - í…ìŠ¤íŠ¸ ì¤„ë°”ê¿ˆ ì ì ˆ
- âœ… (ìŠ¤í¬ë¡¤ í•„ìš”) ë±ƒì§€ ì‹œìŠ¤í…œ ì„¹ì…˜
- âœ… (ìŠ¤í¬ë¡¤ í•„ìš”) CTA ì„¹ì…˜

**ì˜ë¦¬ê±°ë‚˜ ê²¹ì¹˜ëŠ” ë¶€ë¶„**: ì—†ìŒ

**ê¸°ëŠ¥**:
- âœ… ìŠ¤í¬ë¡¤ ì •ìƒ ì‘ë™
- âœ… ë²„íŠ¼ í´ë¦­ ê°€ëŠ¥

**íŠ¹ì´ì‚¬í•­**:
- About í˜ì´ì§€ ìŠ¤í¬ë¡¤ì´ ì‘ë™í•˜ì§€ ì•ŠëŠ” ê²ƒì²˜ëŸ¼ ë³´ì˜€ìœ¼ë‚˜, ì‹¤ì œë¡œëŠ” í˜ì´ì§€ ë†’ì´ê°€ ì§§ì•„ì„œ ìŠ¤í¬ë¡¤ì´ í•„ìš” ì—†ì—ˆìŒ
- ì»¨í…ì¸ ê°€ ë‹¨ì¼ í™”ë©´ì— ëª¨ë‘ í‘œì‹œë  ì •ë„ë¡œ ê°„ê²°í•¨

**ìŠ¤í¬ë¦°ìƒ·**: `mobile-about-top.png`, `mobile-about-middle.png`, `mobile-about-bottom.png`

---

## ğŸ¯ ê³µí†µ UI ìš”ì†Œ í…ŒìŠ¤íŠ¸

### ëª¨ë°”ì¼ í—¤ë” âœ…

**êµ¬ì„±**:
- ì¢Œì¸¡: Seoul Founders Club ë¡œê³ 
- ìš°ì¸¡: ì•Œë¦¼ ì•„ì´ì½˜ + í–„ë²„ê±° ë©”ë‰´ ë²„íŠ¼

**í…ŒìŠ¤íŠ¸ ê²°ê³¼**:
- âœ… ê³ ì • í—¤ë” (ìŠ¤í¬ë¡¤ ì‹œì—ë„ ìƒë‹¨ ê³ ì •)
- âœ… ë°°ê²½ ë¸”ëŸ¬ íš¨ê³¼ (backdrop-blur) ì ìš©
- âœ… ë¡œê³  í´ë¦­ â†’ í™ˆìœ¼ë¡œ ì´ë™
- âœ… ì•Œë¦¼ ì•„ì´ì½˜ í´ë¦­ â†’ ì•Œë¦¼ ë“œë¡­ë‹¤ìš´ (ë¹„ë¡œê·¸ì¸ ì‹œ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™)
- âœ… í–„ë²„ê±° ë©”ë‰´ í´ë¦­ â†’ ì‚¬ì´ë“œë°” í¼ì¹¨

**ìŠ¤í¬ë¦°ìƒ·**: `mobile-menu-open.png`

---

### í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ë°” âœ…

**êµ¬ì„±**:
- í™ˆ | ì´ë²¤íŠ¸ | ë§Œë“¤ê¸° | ì»¤ë®¤ë‹ˆí‹° | ë¡œê·¸ì¸

**í…ŒìŠ¤íŠ¸ ê²°ê³¼**:
- âœ… í•˜ë‹¨ ê³ ì • (ìŠ¤í¬ë¡¤ ì‹œì—ë„ í•˜ë‹¨ ê³ ì •)
- âœ… ì•„ì´ì½˜ + í…ìŠ¤íŠ¸ ë ˆì´ë¸”
- âœ… ê° ë²„íŠ¼ í´ë¦­ ì‹œ í•´ë‹¹ í˜ì´ì§€ë¡œ ì´ë™
- âœ… í˜„ì¬ í˜ì´ì§€ ê°•ì¡° í‘œì‹œ (ìƒ‰ìƒ ë³€ê²½)

**ìš°ìˆ˜í•œ ì **:
- ëª¨ë°”ì¼ì—ì„œ íƒìƒ‰ì´ ë§¤ìš° í¸ë¦¬
- ì£¼ìš” í˜ì´ì§€ì— ë¹ ë¥´ê²Œ ì ‘ê·¼ ê°€ëŠ¥

---

### ì‚¬ì´ë“œë°” (í–„ë²„ê±° ë©”ë‰´) âœ…

**êµ¬ì„±**:
- ë¡œê³ 
- ë¡œê·¸ì¸ / íšŒì›ê°€ì… ë²„íŠ¼ (ìƒë‹¨)
- ë„¤ë¹„ê²Œì´ì…˜ ë©”ë‰´
  - í™ˆ
  - SEOUL FOUNDERS CLUB â†’ ë©¤ë²„
  - ì´ë²¤íŠ¸ â†’ ì¸ì‚¬ì´íŠ¸ â†’ íŒŒíŠ¸ë„ˆìŠ¤
  - ê³µì§€ì‚¬í•­ â†’ ììœ ê²Œì‹œíŒ
  - ì»¤ë®¤ë‹ˆí‹° â†’ ë°˜ê³¨ â†’ í•˜ì´í† í¬
  - ê³ ê°ì„¼í„°
- ë¡œê·¸ì¸ / íšŒì›ê°€ì… ë²„íŠ¼ (í•˜ë‹¨)

**í…ŒìŠ¤íŠ¸ ê²°ê³¼**:
- âœ… í–„ë²„ê±° ë©”ë‰´ í´ë¦­ ì‹œ ì¢Œì¸¡ì—ì„œ ìŠ¬ë¼ì´ë“œ ì¸
- âœ… ì˜¤ë²„ë ˆì´ í´ë¦­ ì‹œ ë‹«í˜
- âœ… ëª¨ë“  ë§í¬ ì •ìƒ ì‘ë™
- âœ… ìŠ¤í¬ë¡¤ ê°€ëŠ¥ (ë©”ë‰´ê°€ ë§ì„ ê²½ìš°)

---

## ğŸ” ë°œê²¬ëœ ì´ìŠˆ

### âš ï¸ ì—†ìŒ

ëª¨ë“  í˜ì´ì§€ì—ì„œ ë ˆì´ì•„ì›ƒ ê¹¨ì§, í…ìŠ¤íŠ¸ ì˜ë¦¼, ìš”ì†Œ ê²¹ì¹¨ ë“±ì˜ ë¬¸ì œê°€ ë°œê²¬ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.

---

## ğŸ’¡ ê°œì„  ì œì•ˆ

### 1. ì•Œë¦¼ ì•„ì´ì½˜ ìœ„ì¹˜ (ìš°ì„ ìˆœìœ„: Low)

**í˜„ì¬ ìƒíƒœ**:
- ëª¨ë°”ì¼ í—¤ë” ìš°ì¸¡ ìƒë‹¨ì— ì•Œë¦¼ ì•„ì´ì½˜ì´ ìˆìŒ

**ì œì•ˆ**:
- í˜„ì¬ ìœ„ì¹˜ê°€ ì ì ˆí•¨
- PCì™€ ëª¨ë°”ì¼ ëª¨ë‘ì—ì„œ ì¼ê´€ëœ ìœ„ì¹˜

---

### 2. ì»¤ë®¤ë‹ˆí‹° ì¹´ë“œ ì„¤ëª… í…ìŠ¤íŠ¸ (ìš°ì„ ìˆœìœ„: Low)

**í˜„ì¬ ìƒíƒœ**:
- í•˜ì´í† í¬ ì„¤ëª…ì´ ê¸¸ì–´ì„œ 2ì¤„ë¡œ ì˜ë¦¼ (`...` ì²˜ë¦¬)

**ì œì•ˆ**:
- ì´ëŠ” ì˜ë„ëœ ë””ìì¸ìœ¼ë¡œ ë³´ì„
- ì „ì²´ ì„¤ëª…ì´ í•„ìš”í•˜ë©´ ì¹´ë“œ í´ë¦­ ì‹œ í™•ì¸ ê°€ëŠ¥
- í˜„ì¬ ìƒíƒœ ìœ ì§€ ê¶Œì¥

---

### 3. ì´ë²¤íŠ¸ ì¹´ë“œ ê°€ë¡œ ìŠ¤í¬ë¡¤ (ìš°ì„ ìˆœìœ„: Low)

**í˜„ì¬ ìƒíƒœ**:
- ì´ë²¤íŠ¸ ì¹´ë“œê°€ ê°€ë¡œë¡œ ë‚˜ì—´ë˜ì–´ ì¢Œìš° ìŠ¤í¬ë¡¤

**ê´€ì°°**:
- ëª¨ë°”ì¼ì—ì„œ ê°€ë¡œ ìŠ¤í¬ë¡¤ì€ ì¼ë°˜ì ì´ì§€ ì•ŠìŒ
- ê·¸ëŸ¬ë‚˜ í˜„ì¬ êµ¬í˜„ì€ ìŠ¤ì™€ì´í”„ ì œìŠ¤ì²˜ë¡œ ìì—°ìŠ¤ëŸ½ê²Œ ì‘ë™

**ì œì•ˆ**:
- í˜„ì¬ ìƒíƒœ ìœ ì§€
- ë˜ëŠ” ëª¨ë°”ì¼ì—ì„œëŠ” ì„¸ë¡œ ìŠ¤í¬ë¡¤ (ë‹¨ì¼ ì»¬ëŸ¼)ë¡œ ë³€ê²½ ê³ ë ¤

---

## ğŸ“Š ê¸°ëŠ¥ êµ¬í˜„ ì—¬ë¶€

### âœ… ëª¨ë“  ê¸°ëŠ¥ì´ ëª¨ë°”ì¼ì—ì„œ ì •ìƒ ì‘ë™

| ê¸°ëŠ¥ | PC | ëª¨ë°”ì¼ | ë¹„ê³  |
|------|-----|--------|------|
| ë„¤ë¹„ê²Œì´ì…˜ | âœ… ì‚¬ì´ë“œë°” | âœ… í–„ë²„ê±° ë©”ë‰´ + í•˜ë‹¨ ë°” | ëª¨ë°”ì¼ ì „ìš© UI |
| ì•Œë¦¼ | âœ… ì‚¬ì´ë“œë°” í•˜ë‹¨ | âœ… í—¤ë” ìš°ì¸¡ ìƒë‹¨ | ìœ„ì¹˜ ë‹¤ë¦„ |
| ì´ë²¤íŠ¸ í•„í„° | âœ… | âœ… | ë™ì¼ |
| ê²Œì‹œíŒ í•„í„° | âœ… | âœ… | ë™ì¼ |
| ë©¤ë²„ ì¹´ë“œ ë ˆì´ì•„ì›ƒ | âœ… 3ì—´ ê·¸ë¦¬ë“œ | âœ… ë‹¨ì¼ ì»¬ëŸ¼ (ì„¸ë¡œí˜•) | ë°˜ì‘í˜• ì ìš© |
| ì»¤ë®¤ë‹ˆí‹° ì¹´ë“œ | âœ… 2ì—´ ê·¸ë¦¬ë“œ | âœ… ë‹¨ì¼ ì»¬ëŸ¼ | ë°˜ì‘í˜• ì ìš© |
| ì´ë²¤íŠ¸ ì¹´ë“œ | âœ… ê·¸ë¦¬ë“œ + ë¦¬ìŠ¤íŠ¸ | âœ… ê°€ë¡œ ìŠ¤í¬ë¡¤ | ëª¨ë°”ì¼ ìµœì í™” |
| ê²Œì‹œê¸€ ì¹´ë“œ | âœ… | âœ… | ë™ì¼ |
| ë²„íŠ¼/ë§í¬ | âœ… | âœ… | ë™ì¼ |
| í¼ ì…ë ¥ | - | - | í…ŒìŠ¤íŠ¸ í•„ìš” (ë¡œê·¸ì¸ í›„) |

---

## ğŸ¨ ë°˜ì‘í˜• ë””ìì¸ í‰ê°€

### âœ… ìš°ìˆ˜í•œ ì 

1. **ì¼ê´€ëœ ë””ìì¸ ì–¸ì–´**
   - PCì™€ ëª¨ë°”ì¼ì—ì„œ ìƒ‰ìƒ, íƒ€ì´í¬ê·¸ë˜í”¼, ê°„ê²©ì´ ì¼ê´€ë¨
   - ë¸Œëœë“œ ì•„ì´ë´í‹°í‹°ê°€ ì˜ ìœ ì§€ë¨

2. **ì ì‘í˜• ë ˆì´ì•„ì›ƒ**
   - ê·¸ë¦¬ë“œ ì‹œìŠ¤í…œì´ ëª¨ë°”ì¼ì—ì„œ ë‹¨ì¼ ì»¬ëŸ¼ìœ¼ë¡œ ìì—°ìŠ¤ëŸ½ê²Œ ì „í™˜
   - ì¹´ë“œ ë†’ì´/ë„ˆë¹„ê°€ ëª¨ë°”ì¼ í™”ë©´ì— ìµœì í™”

3. **í„°ì¹˜ ì¹œí™”ì  UI**
   - ë²„íŠ¼ í¬ê¸°ê°€ ì¶©ë¶„íˆ í¼ (ìµœì†Œ 44x44px ê¶Œì¥ì‚¬í•­ ì¶©ì¡±)
   - í´ë¦­ ì˜ì—­ì´ ëª…í™•í•¨
   - ìŠ¤ì™€ì´í”„ ì œìŠ¤ì²˜ ì§€ì› (ì´ë²¤íŠ¸ ì¹´ë“œ)

4. **í…ìŠ¤íŠ¸ ê°€ë…ì„±**
   - í°íŠ¸ í¬ê¸°ê°€ ëª¨ë°”ì¼ì—ì„œ ì ì ˆí•¨
   - ì¤„ ê°„ê²©ì´ ì¶©ë¶„í•¨
   - í…ìŠ¤íŠ¸ ì¤„ë°”ê¿ˆì´ ìì—°ìŠ¤ëŸ¬ì›€

5. **ì„±ëŠ¥**
   - í˜ì´ì§€ ë¡œë“œ ì†ë„ ë¹ ë¦„
   - ì´ë¯¸ì§€ ìµœì í™” (next/image)
   - ê¹œë¹¡ì„ ì—†ìŒ

---

## ğŸ“± í…ŒìŠ¤íŠ¸ í™˜ê²½

- **ê¸°ê¸°**: iPhone SE (1ì„¸ëŒ€) ì‹œë®¬ë ˆì´ì…˜
- **í™”ë©´ í¬ê¸°**: 375 x 667px
- **ë¸Œë¼ìš°ì €**: Chrome DevTools Mobile Emulation

---

## ğŸ† ìµœì¢… í‰ê°€

**ì ìˆ˜**: 10/10

**ì´í‰**:
- âœ… ëª¨ë“  í˜ì´ì§€ê°€ ëª¨ë°”ì¼ì—ì„œ ì™„ë²½í•˜ê²Œ ì‘ë™
- âœ… ë ˆì´ì•„ì›ƒ ê¹¨ì§ì´ë‚˜ ê²¹ì¹¨ ì—†ìŒ
- âœ… ëª¨ë“  ê¸°ëŠ¥ì´ ëª¨ë°”ì¼ì—ì„œ êµ¬í˜„ë¨
- âœ… í„°ì¹˜ ì¸í„°í˜ì´ìŠ¤ ìµœì í™”
- âœ… ë°˜ì‘í˜• ë””ìì¸ ìš°ìˆ˜
- âœ… ì„±ëŠ¥ ìš°ìˆ˜

**ê¶Œì¥ì‚¬í•­**:
- í˜„ì¬ ìƒíƒœë¡œ í”„ë¡œë•ì…˜ ë°°í¬ ê°€ëŠ¥
- ì¶”ê°€ í…ŒìŠ¤íŠ¸: iPad (íƒœë¸”ë¦¿) í¬ê¸°ë„ í™•ì¸ ê¶Œì¥
- ì‹¤ì œ ê¸°ê¸°ì—ì„œë„ í…ŒìŠ¤íŠ¸ ê¶Œì¥ (íŠ¹íˆ iPhone, Android í°)

---

## ğŸ“¸ ìŠ¤í¬ë¦°ìƒ· ëª©ë¡

ëª¨ë“  ìŠ¤í¬ë¦°ìƒ·ì€ ë‹¤ìŒ ìœ„ì¹˜ì— ì €ì¥ë¨:
`C:\Users\USER-PC\AppData\Local\Temp\cursor\screenshots\`

### ëª¨ë°”ì¼ ìŠ¤í¬ë¦°ìƒ· (iPhone SE 375x667)

1. `mobile-home-top.png` - í™ˆ í˜ì´ì§€ ìƒë‹¨
2. `mobile-home-middle.png` - í™ˆ í˜ì´ì§€ ì¤‘ê°„
3. `mobile-home-bottom.png` - í™ˆ í˜ì´ì§€ í•˜ë‹¨
4. `mobile-member.png` - ë©¤ë²„ ë¦¬ìŠ¤íŠ¸ í˜ì´ì§€
5. `mobile-community.png` - ì»¤ë®¤ë‹ˆí‹° í™ˆ í˜ì´ì§€
6. `mobile-vangol-top.png` - ë°˜ê³¨ ê²Œì‹œíŒ ìƒë‹¨
7. `mobile-vangol-bottom.png` - ë°˜ê³¨ ê²Œì‹œíŒ í•˜ë‹¨
8. `mobile-events.png` - ì´ë²¤íŠ¸ ëª©ë¡ í˜ì´ì§€
9. `mobile-about-top.png` - About í˜ì´ì§€ ìƒë‹¨
10. `mobile-about-middle.png` - About í˜ì´ì§€ ì¤‘ê°„
11. `mobile-about-bottom.png` - About í˜ì´ì§€ í•˜ë‹¨
12. `mobile-menu-open.png` - í–„ë²„ê±° ë©”ë‰´ ì—´ë¦¼

---

## ğŸ“ ì¶”ê°€ í…ŒìŠ¤íŠ¸ ê¶Œì¥ì‚¬í•­

### ë‹¤ë¥¸ í™”ë©´ í¬ê¸°

1. **iPhone 14 Pro** (393 x 852)
2. **Samsung Galaxy S22** (360 x 800)
3. **iPad** (768 x 1024) - íƒœë¸”ë¦¿ ë ˆì´ì•„ì›ƒ
4. **iPad Pro** (1024 x 1366)

### ë‹¤ë¥¸ ë¸Œë¼ìš°ì €

1. Safari (iOS)
2. Chrome (Android)
3. Samsung Internet

### ë‹¤ë¥¸ ì‹œë‚˜ë¦¬ì˜¤

1. **ë¡œê·¸ì¸ í›„ í…ŒìŠ¤íŠ¸**
   - í”„ë¡œí•„ í¸ì§‘ í™”ë©´
   - ì•Œë¦¼ ë“œë¡­ë‹¤ìš´
   - ê²Œì‹œê¸€ ì‘ì„± í¼

2. **ê°€ë¡œ ëª¨ë“œ (Landscape)**
   - ëª¨ë“  í˜ì´ì§€ ê°€ë¡œ ëª¨ë“œ í™•ì¸

3. **ë‹¤í¬ ëª¨ë“œ**
   - ì‹œìŠ¤í…œ ë‹¤í¬ ëª¨ë“œ ì§€ì› ì—¬ë¶€

---

**í…ŒìŠ¤íŠ¸ ì™„ë£Œ ì¼ì‹œ**: 2025ë…„ 12ì›” 2ì¼  
**í…ŒìŠ¤í„°**: AI Assistant
</file>

<file path="package.json">
{
  "name": "my-v0-project",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "build": "next build",
    "dev": "node --dns-result-order=ipv4first node_modules/next/dist/bin/next dev --webpack",
    "dev:turbo": "node --dns-result-order=ipv4first node_modules/next/dist/bin/next dev --turbopack",
    "dev:clean": "rm -rf .next && npm run dev",
    "lint": "eslint .",
    "start": "next start"
  },
  "dependencies": {
    "@dnd-kit/core": "^6.3.1",
    "@dnd-kit/sortable": "^10.0.0",
    "@dnd-kit/utilities": "^3.2.2",
    "@hookform/resolvers": "^3.10.0",
    "@radix-ui/react-accordion": "1.2.2",
    "@radix-ui/react-alert-dialog": "latest",
    "@radix-ui/react-aspect-ratio": "1.1.1",
    "@radix-ui/react-avatar": "1.1.2",
    "@radix-ui/react-checkbox": "1.1.3",
    "@radix-ui/react-collapsible": "1.1.2",
    "@radix-ui/react-context-menu": "latest",
    "@radix-ui/react-dialog": "^1.1.15",
    "@radix-ui/react-dropdown-menu": "latest",
    "@radix-ui/react-hover-card": "latest",
    "@radix-ui/react-label": "2.1.1",
    "@radix-ui/react-menubar": "latest",
    "@radix-ui/react-navigation-menu": "1.2.3",
    "@radix-ui/react-popover": "^1.1.15",
    "@radix-ui/react-progress": "1.1.1",
    "@radix-ui/react-radio-group": "1.2.2",
    "@radix-ui/react-scroll-area": "1.2.2",
    "@radix-ui/react-select": "^2.2.6",
    "@radix-ui/react-separator": "1.1.1",
    "@radix-ui/react-slider": "1.2.2",
    "@radix-ui/react-slot": "latest",
    "@radix-ui/react-switch": "1.1.2",
    "@radix-ui/react-tabs": "1.1.2",
    "@radix-ui/react-toast": "^1.2.15",
    "@radix-ui/react-toggle": "1.1.1",
    "@radix-ui/react-toggle-group": "1.1.1",
    "@radix-ui/react-tooltip": "latest",
    "@radix-ui/react-visually-hidden": "^1.2.4",
    "@react-google-maps/api": "^2.20.7",
    "@supabase/ssr": "0.7.0",
    "@supabase/supabase-js": "latest",
    "@tanstack/react-query": "^5.90.11",
    "@tanstack/react-query-devtools": "^5.91.1",
    "@tiptap/core": "latest",
    "@tiptap/extension-image": "latest",
    "@tiptap/pm": "latest",
    "@tiptap/react": "latest",
    "@tiptap/starter-kit": "latest",
    "@tosspayments/payment-sdk": "^1.9.2",
    "@tosspayments/payment-widget-sdk": "^0.12.1",
    "@tosspayments/tosspayments-sdk": "^2.4.1",
    "@vercel/analytics": "1.3.1",
    "@vercel/blob": "latest",
    "autoprefixer": "^10.4.20",
    "cheerio": "^1.1.2",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.1.1",
    "cmdk": "1.0.4",
    "date-fns": "4.1.0",
    "embla-carousel-react": "8.5.1",
    "input-otp": "1.4.1",
    "lucide-react": "^0.454.0",
    "next": "^16.0.7",
    "next-themes": "^0.4.6",
    "react": "^18.3.1",
    "react-day-picker": "9.8.0",
    "react-dom": "^18.3.1",
    "react-hook-form": "^7.60.0",
    "react-resizable-panels": "^2.1.7",
    "recharts": "latest",
    "sonner": "^1.7.4",
    "swiper": "^12.0.3",
    "tailwind-merge": "^2.5.5",
    "tailwindcss-animate": "^1.0.7",
    "vaul": "^0.9.9",
    "zod": "3.25.76"
  },
  "devDependencies": {
    "@tailwindcss/postcss": "^4.1.9",
    "@tailwindcss/typography": "^0.5.19",
    "@types/node": "^22",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "postcss": "^8.5",
    "tailwindcss": "^4.1.9",
    "tw-animate-css": "1.3.3",
    "typescript": "^5"
  }
}
</file>

<file path="postcss.config.mjs">
/** @type {import('postcss-load-config').Config} */
const config = {
  plugins: {
    '@tailwindcss/postcss': {},
  },
}

export default config
</file>

<file path="public/icon.svg">
<svg width="180" height="180" viewBox="0 0 180 180" fill="none" xmlns="http://www.w3.org/2000/svg">
  <style>
    @media (prefers-color-scheme: light) {
      .background { fill: black; }
      .foreground { fill: white; }
    }
    @media (prefers-color-scheme: dark) {
      .background { fill: white; }
      .foreground { fill: black; }
    }
  </style>
  <g clip-path="url(#clip0_7960_43945)">
    <rect class="background" width="180" height="180" rx="37" />
    <g style="transform: scale(95%); transform-origin: center">
      <path class="foreground"
        d="M101.141 53H136.632C151.023 53 162.689 64.6662 162.689 79.0573V112.904H148.112V79.0573C148.112 78.7105 148.098 78.3662 148.072 78.0251L112.581 112.898C112.701 112.902 112.821 112.904 112.941 112.904H148.112V126.672H112.941C98.5504 126.672 86.5638 114.891 86.5638 100.5V66.7434H101.141V100.5C101.141 101.15 101.191 101.792 101.289 102.422L137.56 66.7816C137.255 66.7563 136.945 66.7434 136.632 66.7434H101.141V53Z" />
      <path class="foreground"
        d="M65.2926 124.136L14 66.7372H34.6355L64.7495 100.436V66.7372H80.1365V118.47C80.1365 126.278 70.4953 129.958 65.2926 124.136Z" />
    </g>
  </g>
  <defs>
    <clipPath id="clip0_7960_43945">
      <rect width="180" height="180" fill="white" />
    </clipPath>
  </defs>
</svg>
</file>

<file path="public/placeholder-logo.svg">
<svg xmlns="http://www.w3.org/2000/svg" width="215" height="48" fill="none"><path fill="#000" d="M57.588 9.6h6L73.828 38h-5.2l-2.36-6.88h-11.36L52.548 38h-5.2l10.24-28.4Zm7.16 17.16-4.16-12.16-4.16 12.16h8.32Zm23.694-2.24c-.186-1.307-.706-2.32-1.56-3.04-.853-.72-1.866-1.08-3.04-1.08-1.68 0-2.986.613-3.92 1.84-.906 1.227-1.36 2.947-1.36 5.16s.454 3.933 1.36 5.16c.934 1.227 2.24 1.84 3.92 1.84 1.254 0 2.307-.373 3.16-1.12.854-.773 1.387-1.867 1.6-3.28l5.12.24c-.186 1.68-.733 3.147-1.64 4.4-.906 1.227-2.08 2.173-3.52 2.84-1.413.667-2.986 1-4.72 1-2.08 0-3.906-.453-5.48-1.36-1.546-.907-2.76-2.2-3.64-3.88-.853-1.68-1.28-3.627-1.28-5.84 0-2.24.427-4.187 1.28-5.84.88-1.68 2.094-2.973 3.64-3.88 1.574-.907 3.4-1.36 5.48-1.36 1.68 0 3.227.32 4.64.96 1.414.64 2.56 1.56 3.44 2.76.907 1.2 1.454 2.6 1.64 4.2l-5.12.28Zm11.486-7.72.12 3.4c.534-1.227 1.307-2.173 2.32-2.84 1.04-.693 2.267-1.04 3.68-1.04 1.494 0 2.76.387 3.8 1.16 1.067.747 1.827 1.813 2.28 3.2.507-1.44 1.294-2.52 2.36-3.24 1.094-.747 2.414-1.12 3.96-1.12 1.414 0 2.64.307 3.68.92s1.84 1.52 2.4 2.72c.56 1.2.84 2.667.84 4.4V38h-4.96V25.92c0-1.813-.293-3.187-.88-4.12-.56-.96-1.413-1.44-2.56-1.44-.906 0-1.68.213-2.32.64-.64.427-1.133 1.053-1.48 1.88-.32.827-.48 1.84-.48 3.04V38h-4.56V25.92c0-1.2-.133-2.213-.4-3.04-.24-.827-.626-1.453-1.16-1.88-.506-.427-1.133-.64-1.88-.64-.906 0-1.68.227-2.32.68-.64.427-1.133 1.053-1.48 1.88-.32.827-.48 1.827-.48 3V38h-4.96V16.8h4.48Zm26.723 10.6c0-2.24.427-4.187 1.28-5.84.854-1.68 2.067-2.973 3.64-3.88 1.574-.907 3.4-1.36 5.48-1.36 1.84 0 3.494.413 4.96 1.24 1.467.827 2.64 2.08 3.52 3.76.88 1.653 1.347 3.693 1.4 6.12v1.32h-15.08c.107 1.813.614 3.227 1.52 4.24.907.987 2.134 1.48 3.68 1.48.987 0 1.88-.253 2.68-.76a4.803 4.803 0 0 0 1.84-2.2l5.08.36c-.64 2.027-1.84 3.64-3.6 4.84-1.733 1.173-3.733 1.76-6 1.76-2.08 0-3.906-.453-5.48-1.36-1.573-.907-2.786-2.2-3.64-3.88-.853-1.68-1.28-3.627-1.28-5.84Zm15.16-2.04c-.213-1.733-.76-3.013-1.64-3.84-.853-.827-1.893-1.24-3.12-1.24-1.44 0-2.6.453-3.48 1.36-.88.88-1.44 2.12-1.68 3.72h9.92ZM163.139 9.6V38h-5.04V9.6h5.04Zm8.322 7.2.24 5.88-.64-.36c.32-2.053 1.094-3.56 2.32-4.52 1.254-.987 2.787-1.48 4.6-1.48 2.32 0 4.107.733 5.36 2.2 1.254 1.44 1.88 3.387 1.88 5.84V38h-4.96V25.92c0-1.253-.12-2.28-.36-3.08-.24-.8-.64-1.413-1.2-1.84-.533-.427-1.253-.64-2.16-.64-1.44 0-2.573.48-3.4 1.44-.8.933-1.2 2.307-1.2 4.12V38h-4.96V16.8h4.48Zm30.003 7.72c-.186-1.307-.706-2.32-1.56-3.04-.853-.72-1.866-1.08-3.04-1.08-1.68 0-2.986.613-3.92 1.84-.906 1.227-1.36 2.947-1.36 5.16s.454 3.933 1.36 5.16c.934 1.227 2.24 1.84 3.92 1.84 1.254 0 2.307-.373 3.16-1.12.854-.773 1.387-1.867 1.6-3.28l5.12.24c-.186 1.68-.733 3.147-1.64 4.4-.906 1.227-2.08 2.173-3.52 2.84-1.413.667-2.986 1-4.72 1-2.08 0-3.906-.453-5.48-1.36-1.546-.907-2.76-2.2-3.64-3.88-.853-1.68-1.28-3.627-1.28-5.84 0-2.24.427-4.187 1.28-5.84.88-1.68 2.094-2.973 3.64-3.88 1.574-.907 3.4-1.36 5.48-1.36 1.68 0 3.227.32 4.64.96 1.414.64 2.56 1.56 3.44 2.76.907 1.2 1.454 2.6 1.64 4.2l-5.12.28Zm11.443 8.16V38h-5.6v-5.32h5.6Z"/><path fill="#171717" fill-rule="evenodd" d="m7.839 40.783 16.03-28.054L20 6 0 40.783h7.839Zm8.214 0H40L27.99 19.894l-4.02 7.032 3.976 6.914H20.02l-3.967 6.943Z" clip-rule="evenodd"/></svg>
</file>

<file path="public/placeholder.svg">
<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="1200" fill="none"><rect width="1200" height="1200" fill="#EAEAEA" rx="3"/><g opacity=".5"><g opacity=".5"><path fill="#FAFAFA" d="M600.709 736.5c-75.454 0-136.621-61.167-136.621-136.62 0-75.454 61.167-136.621 136.621-136.621 75.453 0 136.62 61.167 136.62 136.621 0 75.453-61.167 136.62-136.62 136.62Z"/><path stroke="#C9C9C9" stroke-width="2.418" d="M600.709 736.5c-75.454 0-136.621-61.167-136.621-136.62 0-75.454 61.167-136.621 136.621-136.621 75.453 0 136.62 61.167 136.62 136.621 0 75.453-61.167 136.62-136.62 136.62Z"/></g><path stroke="url(#a)" stroke-width="2.418" d="M0-1.209h553.581" transform="scale(1 -1) rotate(45 1163.11 91.165)"/><path stroke="url(#b)" stroke-width="2.418" d="M404.846 598.671h391.726"/><path stroke="url(#c)" stroke-width="2.418" d="M599.5 795.742V404.017"/><path stroke="url(#d)" stroke-width="2.418" d="m795.717 796.597-391.441-391.44"/><path fill="#fff" d="M600.709 656.704c-31.384 0-56.825-25.441-56.825-56.824 0-31.384 25.441-56.825 56.825-56.825 31.383 0 56.824 25.441 56.824 56.825 0 31.383-25.441 56.824-56.824 56.824Z"/><g clip-path="url(#e)"><path fill="#666" fill-rule="evenodd" d="M616.426 586.58h-31.434v16.176l3.553-3.554.531-.531h9.068l.074-.074 8.463-8.463h2.565l7.18 7.181V586.58Zm-15.715 14.654 3.698 3.699 1.283 1.282-2.565 2.565-1.282-1.283-5.2-5.199h-6.066l-5.514 5.514-.073.073v2.876a2.418 2.418 0 0 0 2.418 2.418h26.598a2.418 2.418 0 0 0 2.418-2.418v-8.317l-8.463-8.463-7.181 7.181-.071.072Zm-19.347 5.442v4.085a6.045 6.045 0 0 0 6.046 6.045h26.598a6.044 6.044 0 0 0 6.045-6.045v-7.108l1.356-1.355-1.282-1.283-.074-.073v-17.989h-38.689v23.43l-.146.146.146.147Z" clip-rule="evenodd"/></g><path stroke="#C9C9C9" stroke-width="2.418" d="M600.709 656.704c-31.384 0-56.825-25.441-56.825-56.824 0-31.384 25.441-56.825 56.825-56.825 31.383 0 56.824 25.441 56.824 56.825 0 31.383-25.441 56.824-56.824 56.824Z"/></g><defs><linearGradient id="a" x1="554.061" x2="-.48" y1=".083" y2=".087" gradientUnits="userSpaceOnUse"><stop stop-color="#C9C9C9" stop-opacity="0"/><stop offset=".208" stop-color="#C9C9C9"/><stop offset=".792" stop-color="#C9C9C9"/><stop offset="1" stop-color="#C9C9C9" stop-opacity="0"/></linearGradient><linearGradient id="b" x1="796.912" x2="404.507" y1="599.963" y2="599.965" gradientUnits="userSpaceOnUse"><stop stop-color="#C9C9C9" stop-opacity="0"/><stop offset=".208" stop-color="#C9C9C9"/><stop offset=".792" stop-color="#C9C9C9"/><stop offset="1" stop-color="#C9C9C9" stop-opacity="0"/></linearGradient><linearGradient id="c" x1="600.792" x2="600.794" y1="403.677" y2="796.082" gradientUnits="userSpaceOnUse"><stop stop-color="#C9C9C9" stop-opacity="0"/><stop offset=".208" stop-color="#C9C9C9"/><stop offset=".792" stop-color="#C9C9C9"/><stop offset="1" stop-color="#C9C9C9" stop-opacity="0"/></linearGradient><linearGradient id="d" x1="404.85" x2="796.972" y1="403.903" y2="796.02" gradientUnits="userSpaceOnUse"><stop stop-color="#C9C9C9" stop-opacity="0"/><stop offset=".208" stop-color="#C9C9C9"/><stop offset=".792" stop-color="#C9C9C9"/><stop offset="1" stop-color="#C9C9C9" stop-opacity="0"/></linearGradient><clipPath id="e"><path fill="#fff" d="M581.364 580.535h38.689v38.689h-38.689z"/></clipPath></defs></svg>
</file>

<file path="QUICK_FIX.md">
# ë¹ ë¥¸ ë¬¸ì œ í•´ê²° ê°€ì´ë“œ

## ê°€ì¥ ê°€ëŠ¥ì„± ë†’ì€ ì›ì¸

### 1. ì‹¤ì œë¡œ ë°ì´í„°ê°€ ì—†ëŠ” ê²½ìš° (90% ê°€ëŠ¥ì„±) â­
í˜„ì¬ "ì•„ì§ ì˜ˆì •ëœ ì´ë²¤íŠ¸ê°€ ì—†ì–´ìš”", "ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤"ê°€ í‘œì‹œë˜ëŠ” ê²ƒì€:
- âœ… UIëŠ” ì •ìƒ ì‘ë™ ì¤‘
- âŒ ë°ì´í„°ë² ì´ìŠ¤ì— ì‹¤ì œ ë°ì´í„°ê°€ ì—†ëŠ” ìƒíƒœ

### 2. í™•ì¸ ë°©ë²•

**Supabase SQL Editorì—ì„œ ì‹¤í–‰:**
```sql
-- ì´ë²¤íŠ¸ ê°œìˆ˜ í™•ì¸
SELECT COUNT(*) as total, 
       COUNT(*) FILTER (WHERE event_date >= NOW()) as upcoming
FROM events;

-- ê²Œì‹œê¸€ ê°œìˆ˜ í™•ì¸
SELECT COUNT(*) as total,
       COUNT(*) FILTER (WHERE board_category_id IS NOT NULL) as with_category
FROM posts;
```

ë§Œì•½ ë‘˜ ë‹¤ 0ì´ë©´ â†’ **ë°ì´í„°ê°€ ì—†ëŠ” ê²ƒì´ ì •ìƒ**ì…ë‹ˆë‹¤.

## í•´ê²° ë°©ë²•

### ë°©ë²• 1: í…ŒìŠ¤íŠ¸ ë°ì´í„° ë§Œë“¤ê¸° (ì¶”ì²œ)

1. **ë¡œê·¸ì¸** â†’ ë°°í¬ ì‚¬ì´íŠ¸ì—ì„œ ë¡œê·¸ì¸
2. **ì´ë²¤íŠ¸ ë§Œë“¤ê¸°** â†’ "+ ìƒˆ ì´ë²¤íŠ¸" ë²„íŠ¼ í´ë¦­
   - ì œëª©: "í…ŒìŠ¤íŠ¸ ì´ë²¤íŠ¸"
   - ë‚ ì§œ: ë‚´ì¼ ë‚ ì§œ ì„ íƒ
   - ì¥ì†Œ: "ì„œìš¸"
3. **ê²Œì‹œê¸€ ë§Œë“¤ê¸°** â†’ "ê¸€ ì‘ì„±í•˜ê¸°" ë²„íŠ¼ í´ë¦­
   - ì¹´í…Œê³ ë¦¬ ì„ íƒ (ììœ ê²Œì‹œíŒ ë“±)
   - ì œëª©ê³¼ ë‚´ìš© ì‘ì„±
4. **ë¡œê·¸ì•„ì›ƒ**
5. **í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨**

ì´ë ‡ê²Œ í•˜ë©´ ë¡œê·¸ì¸ ì—†ì´ë„ ë°ì´í„°ê°€ ë³´ì—¬ì•¼ í•©ë‹ˆë‹¤.

### ë°©ë²• 2: SQLë¡œ ì§ì ‘ ë°ì´í„° ì¶”ê°€

Supabase SQL Editorì—ì„œ ì‹¤í–‰:
```sql
-- í…ŒìŠ¤íŠ¸ ì´ë²¤íŠ¸ ì¶”ê°€ (created_byëŠ” ì‹¤ì œ ì‚¬ìš©ì IDë¡œ ë³€ê²½)
INSERT INTO events (title, description, event_date, location, created_by)
SELECT 
  'í…ŒìŠ¤íŠ¸ ì´ë²¤íŠ¸',
  'í…ŒìŠ¤íŠ¸ìš© ì´ë²¤íŠ¸ì…ë‹ˆë‹¤',
  NOW() + INTERVAL '1 day',
  'ì„œìš¸',
  id
FROM profiles
LIMIT 1;

-- í…ŒìŠ¤íŠ¸ ê²Œì‹œê¸€ ì¶”ê°€ (board_category_id í™•ì¸ í•„ìš”)
INSERT INTO posts (title, content, author_id, board_category_id)
SELECT 
  'í…ŒìŠ¤íŠ¸ ê²Œì‹œê¸€',
  'í…ŒìŠ¤íŠ¸ìš© ê²Œì‹œê¸€ì…ë‹ˆë‹¤',
  id,
  (SELECT id FROM board_categories WHERE slug = 'free' LIMIT 1)
FROM profiles
LIMIT 1;
```

### ë°©ë²• 3: RLS ì •ì±… ì¬í™•ì¸

ë§Œì•½ ë°ì´í„°ê°€ ìˆëŠ”ë°ë„ ì•ˆ ë³´ì´ë©´:
```sql
-- scripts/019_fix_anonymous_access.sql ì¬ì‹¤í–‰
```

## ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] ë°ì´í„°ë² ì´ìŠ¤ì— ì‹¤ì œë¡œ ë°ì´í„°ê°€ ìˆëŠ”ê°€?
- [ ] RLS ì •ì±…ì´ ì œëŒ€ë¡œ ì„¤ì •ë˜ì—ˆëŠ”ê°€?
- [ ] board_category_idê°€ NULLì´ ì•„ë‹Œê°€?
- [ ] event_dateê°€ ë¯¸ë˜ ë‚ ì§œì¸ê°€?
- [ ] ë¸Œë¼ìš°ì € ì½˜ì†”ì— ì—ëŸ¬ê°€ ì—†ëŠ”ê°€?

## ë””ë²„ê¹…

ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬ (F12):
1. **Console íƒ­** â†’ ì—ëŸ¬ í™•ì¸
2. **Network íƒ­** â†’ API í˜¸ì¶œ í™•ì¸
   - `/rest/v1/events` ìš”ì²­ í™•ì¸
   - `/rest/v1/posts` ìš”ì²­ í™•ì¸
   - ì‘ë‹µ ìƒíƒœ ì½”ë“œì™€ ë°ì´í„° í™•ì¸

## ìµœì¢… í™•ì¸

ë°°í¬ ì‚¬ì´íŠ¸ì—ì„œ:
1. ë¸Œë¼ìš°ì € ìºì‹œ í´ë¦¬ì–´ (Ctrl+Shift+R)
2. ë¡œê·¸ì•„ì›ƒ ìƒíƒœ í™•ì¸
3. í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
4. ë„¤íŠ¸ì›Œí¬ íƒ­ì—ì„œ API ì‘ë‹µ í™•ì¸
</file>

<file path="REDDIT_COMPARISON.md">
# Redditê³¼ ë¹„êµí•œ ê¸°ëŠ¥ ê°œì„  ì œì•ˆì„œ

## í˜„ì¬ ìƒíƒœ ë¶„ì„

### âœ… ì´ë¯¸ êµ¬í˜„ëœ ê¸°ëŠ¥
1. **ì»¤ë®¤ë‹ˆí‹° ì‹œìŠ¤í…œ** - ì„œë¸Œë ˆë”§ê³¼ ìœ ì‚¬í•œ communities ì‹œìŠ¤í…œ
2. **ê¸°ë³¸ ëŒ“ê¸€ ì‹œìŠ¤í…œ** - í”Œë« êµ¬ì¡°ì˜ ëŒ“ê¸€
3. **ì¢‹ì•„ìš” ì‹œìŠ¤í…œ** - Upvoteë§Œ êµ¬í˜„ (Downvote ì—†ìŒ)
4. **ì•Œë¦¼ ì‹œìŠ¤í…œ** - ê¸°ë³¸ì ì¸ ì•Œë¦¼ ê¸°ëŠ¥
5. **ê²Œì‹œíŒ ë¶„ë¥˜** - ì¹´í…Œê³ ë¦¬ë³„ ê²Œì‹œíŒ
6. **ì‚¬ìš©ì í”„ë¡œí•„** - í”„ë¡œí•„, ë±ƒì§€ ì‹œìŠ¤í…œ

---

## ğŸ”´ Redditì— ë¹„í•´ ë¶€ì¡±í•œ í•µì‹¬ ê¸°ëŠ¥

### 1. **íˆ¬í‘œ ì‹œìŠ¤í…œ (Upvote/Downvote)** â­â­â­â­â­ (ìµœìš°ì„ )
**í˜„ì¬ ìƒíƒœ:**
- ì¢‹ì•„ìš”ë§Œ ìˆìŒ (upvoteë§Œ)
- ì ìˆ˜ ì‹œìŠ¤í…œì´ ë‹¨ìˆœí•¨

**Reddit ë°©ì‹:**
- Upvote/Downvote ëª¨ë‘ ê°€ëŠ¥
- ì ìˆ˜ = Upvote - Downvote
- ì‚¬ìš©ìë³„ íˆ¬í‘œ ìƒíƒœ ì¶”ì  (upvoted/downvoted/neutral)

**êµ¬í˜„ ì œì•ˆ:**
```sql
-- post_votes í…Œì´ë¸” ìƒì„±
CREATE TABLE post_votes (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  post_id UUID REFERENCES posts(id) ON DELETE CASCADE,
  user_id UUID REFERENCES profiles(id) ON DELETE CASCADE,
  vote_type SMALLINT NOT NULL CHECK (vote_type IN (1, -1)), -- 1: upvote, -1: downvote
  created_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(post_id, user_id)
);

-- posts í…Œì´ë¸”ì— score ì»¬ëŸ¼ ì¶”ê°€
ALTER TABLE posts ADD COLUMN score INTEGER DEFAULT 0;
```

---

### 2. **ì¤‘ì²© ëŒ“ê¸€ ìŠ¤ë ˆë“œ** â­â­â­â­â­ (ìµœìš°ì„ )
**í˜„ì¬ ìƒíƒœ:**
- í”Œë« êµ¬ì¡°ì˜ ëŒ“ê¸€ë§Œ ì§€ì›
- ëŒ“ê¸€ì— ë‹µê¸€ ë¶ˆê°€

**Reddit ë°©ì‹:**
- ë¬´í•œ ì¤‘ì²© ëŒ“ê¸€ ìŠ¤ë ˆë“œ
- ê° ëŒ“ê¸€ì´ ë¶€ëª¨ ëŒ“ê¸€ ì°¸ì¡°
- ìŠ¤ë ˆë“œ í˜•íƒœë¡œ í‘œì‹œ

**êµ¬í˜„ ì œì•ˆ:**
```sql
-- comments í…Œì´ë¸”ì— parent_id ì¶”ê°€
ALTER TABLE comments 
ADD COLUMN parent_id UUID REFERENCES comments(id) ON DELETE CASCADE,
ADD COLUMN depth INTEGER DEFAULT 0,
ADD COLUMN path TEXT; -- materialized path for faster queries

-- ì¸ë±ìŠ¤ ì¶”ê°€
CREATE INDEX idx_comments_parent_id ON comments(parent_id);
CREATE INDEX idx_comments_path ON comments(path);
```

---

### 3. **Hot/Top/Rising ì •ë ¬ ì•Œê³ ë¦¬ì¦˜** â­â­â­â­ (ë†’ì€ ìš°ì„ ìˆœìœ„)
**í˜„ì¬ ìƒíƒœ:**
- ìµœì‹ ìˆœ (created_at DESC)ë§Œ ì£¼ë¡œ ì‚¬ìš©
- ì¢‹ì•„ìš”ìˆœ (likes_count DESC) ì¼ë¶€ ì§€ì›

**Reddit ë°©ì‹:**
- **Hot**: ì‹œê°„ ê°€ì¤‘ ì ìˆ˜ ì•Œê³ ë¦¬ì¦˜ (ìµœê·¼ í™œë™ì— ë” ê°€ì¤‘ì¹˜)
- **Top**: íŠ¹ì • ê¸°ê°„ ë™ì•ˆì˜ ìµœê³  ì ìˆ˜ (Today, Week, Month, All-time)
- **Rising**: ë¹ ë¥´ê²Œ ìƒìŠ¹í•˜ëŠ” ê²Œì‹œê¸€
- **New**: ìµœì‹ ìˆœ
- **Controversial**: ì°¬ë°˜ì´ ê·¹ëª…í•œ ê²Œì‹œê¸€

**êµ¬í˜„ ì œì•ˆ:**
```sql
-- Hot ì•Œê³ ë¦¬ì¦˜ì„ ìœ„í•œ í•¨ìˆ˜
CREATE OR REPLACE FUNCTION calculate_hot_score(
  score INTEGER,
  created_at TIMESTAMPTZ
) RETURNS NUMERIC AS $$
BEGIN
  -- Redditì˜ hot ì•Œê³ ë¦¬ì¦˜ ë³€í˜•
  -- ë” ìµœê·¼ì— ì‘ì„±ëœ ê²Œì‹œê¸€ì´ ë” ë†’ì€ ì ìˆ˜
  DECLARE
    time_diff_hours NUMERIC;
    sign INTEGER;
    order_val NUMERIC;
  BEGIN
    time_diff_hours := EXTRACT(EPOCH FROM (NOW() - created_at)) / 3600;
    
    IF score > 0 THEN
      sign := 1;
    ELSIF score < 0 THEN
      sign := -1;
    ELSE
      sign := 0;
    END IF;
    
    order_val := LOG(GREATEST(ABS(score), 1));
    
    RETURN sign * order_val + time_diff_hours / 45000;
  END;
END;
$$ LANGUAGE plpgsql IMMUTABLE;

-- ì¸ë±ìŠ¤ ì¶”ê°€ (ì„±ëŠ¥ ìµœì í™”)
CREATE INDEX idx_posts_hot_score ON posts((calculate_hot_score(score, created_at)) DESC);
```

---

### 4. **ê²€ìƒ‰ ê¸°ëŠ¥** â­â­â­â­ (ë†’ì€ ìš°ì„ ìˆœìœ„)
**í˜„ì¬ ìƒíƒœ:**
- ê²€ìƒ‰ ê¸°ëŠ¥ ì—†ìŒ

**Reddit ë°©ì‹:**
- ê²Œì‹œê¸€ ì œëª©/ë‚´ìš© ê²€ìƒ‰
- ì„œë¸Œë ˆë”§ë³„ ê²€ìƒ‰
- ì‘ì„±ì ê²€ìƒ‰
- ê³ ê¸‰ í•„í„° (ë‚ ì§œ, ì ìˆ˜ ë²”ìœ„ ë“±)

**êµ¬í˜„ ì œì•ˆ:**
- **ì˜µì…˜ 1**: PostgreSQL Full-Text Search (ê°„ë‹¨, ë¹ ë¥¸ êµ¬í˜„)
- **ì˜µì…˜ 2**: Elasticsearch/Meilisearch (ê³ ê¸‰ ê²€ìƒ‰, í™•ì¥ ê°€ëŠ¥)
- **ì˜µì…˜ 3**: Supabase Vector Search (AI ê¸°ë°˜ ìœ ì‚¬ë„ ê²€ìƒ‰ ê°€ëŠ¥)

```sql
-- Full-Text Searchë¥¼ ìœ„í•œ ì»¬ëŸ¼ ì¶”ê°€
ALTER TABLE posts 
ADD COLUMN search_vector tsvector;

-- íŠ¸ë¦¬ê±°ë¡œ ìë™ ì—…ë°ì´íŠ¸
CREATE OR REPLACE FUNCTION posts_search_trigger() RETURNS trigger AS $$
BEGIN
  NEW.search_vector := 
    setweight(to_tsvector('korean', COALESCE(NEW.title, '')), 'A') ||
    setweight(to_tsvector('korean', COALESCE(NEW.content, '')), 'B');
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER tsvectorupdate BEFORE INSERT OR UPDATE
ON posts FOR EACH ROW EXECUTE FUNCTION posts_search_trigger();
```

---

### 5. **ê²Œì‹œê¸€ ì €ì¥/ë¶ë§ˆí¬** â­â­â­ (ì¤‘ê°„ ìš°ì„ ìˆœìœ„)
**í˜„ì¬ ìƒíƒœ:**
- ì €ì¥ ê¸°ëŠ¥ ì—†ìŒ

**Reddit ë°©ì‹:**
- ê²Œì‹œê¸€ ì €ì¥í•˜ì—¬ ë‚˜ì¤‘ì— ë‹¤ì‹œ ë³¼ ìˆ˜ ìˆìŒ
- ì €ì¥ëœ ê²Œì‹œê¸€ ëª¨ìŒ í˜ì´ì§€

**êµ¬í˜„ ì œì•ˆ:**
```sql
CREATE TABLE saved_posts (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES profiles(id) ON DELETE CASCADE,
  post_id UUID REFERENCES posts(id) ON DELETE CASCADE,
  saved_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(user_id, post_id)
);
```

---

### 6. **ì‚¬ìš©ì íŒ”ë¡œìš°/êµ¬ë…** â­â­â­ (ì¤‘ê°„ ìš°ì„ ìˆœìœ„)
**í˜„ì¬ ìƒíƒœ:**
- ì»¤ë®¤ë‹ˆí‹° ê°€ì…/íƒˆí‡´ë§Œ ìˆìŒ
- ë‹¤ë¥¸ ì‚¬ìš©ì íŒ”ë¡œìš° ê¸°ëŠ¥ ì—†ìŒ

**Reddit ë°©ì‹:**
- íŠ¹ì • ì‚¬ìš©ìì˜ í™œë™ í”¼ë“œ êµ¬ë…
- íŒ”ë¡œìš°í•œ ì‚¬ìš©ìì˜ ê²Œì‹œê¸€ë§Œ ë³´ê¸°

**êµ¬í˜„ ì œì•ˆ:**
```sql
CREATE TABLE user_follows (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  follower_id UUID REFERENCES profiles(id) ON DELETE CASCADE,
  following_id UUID REFERENCES profiles(id) ON DELETE CASCADE,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(follower_id, following_id),
  CHECK (follower_id != following_id)
);
```

---

### 7. **ë§í¬ ê²Œì‹œê¸€** â­â­â­ (ì¤‘ê°„ ìš°ì„ ìˆœìœ„)
**í˜„ì¬ ìƒíƒœ:**
- í…ìŠ¤íŠ¸/ì´ë¯¸ì§€ ê²Œì‹œê¸€ë§Œ ì§€ì›
- ì™¸ë¶€ ë§í¬ ê³µìœ  ë¶ˆê°€

**Reddit ë°©ì‹:**
- ë§í¬ ê²Œì‹œê¸€ (ì™¸ë¶€ URL)
- í…ìŠ¤íŠ¸ ê²Œì‹œê¸€
- ì´ë¯¸ì§€/ë¹„ë””ì˜¤ ê²Œì‹œê¸€

**êµ¬í˜„ ì œì•ˆ:**
```sql
ALTER TABLE posts
ADD COLUMN post_type TEXT DEFAULT 'text' CHECK (post_type IN ('text', 'link', 'image', 'video')),
ADD COLUMN link_url TEXT,
ADD COLUMN link_preview JSONB; -- Open Graph ë©”íƒ€ë°ì´í„° ì €ì¥
```

---

### 8. **ê²Œì‹œê¸€ ì‹ ê³  ê¸°ëŠ¥** â­â­â­ (ì¤‘ê°„ ìš°ì„ ìˆœìœ„)
**í˜„ì¬ ìƒíƒœ:**
- ì‹ ê³  ê¸°ëŠ¥ ì—†ìŒ

**êµ¬í˜„ ì œì•ˆ:**
```sql
CREATE TABLE reports (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES profiles(id) ON DELETE CASCADE,
  post_id UUID REFERENCES posts(id) ON DELETE SET NULL,
  comment_id UUID REFERENCES comments(id) ON DELETE SET NULL,
  reason TEXT NOT NULL,
  description TEXT,
  status TEXT DEFAULT 'pending' CHECK (status IN ('pending', 'reviewed', 'resolved', 'dismissed')),
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

---

### 9. **ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ê°•í™”** â­â­ (ë‚®ì€ ìš°ì„ ìˆœìœ„)
**í˜„ì¬ ìƒíƒœ:**
- ì•Œë¦¼ë§Œ ì‹¤ì‹œê°„ (Supabase Realtime)
- ê²Œì‹œê¸€/ëŒ“ê¸€ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ì œí•œì 

**ê°œì„  ì œì•ˆ:**
- Supabase Realtimeìœ¼ë¡œ ëŒ“ê¸€/íˆ¬í‘œ ì‹¤ì‹œê°„ ë°˜ì˜
- ìƒˆë¡œìš´ ê²Œì‹œê¸€ ì‹¤ì‹œê°„ í‘œì‹œ
- ì˜¨ë¼ì¸ ì‚¬ìš©ì ìˆ˜ í‘œì‹œ

---

## êµ¬í˜„ ìš°ì„ ìˆœìœ„

### Phase 1: í•µì‹¬ ê¸°ëŠ¥ (1-2ì£¼)
1. âœ… **Upvote/Downvote ì‹œìŠ¤í…œ** - Redditì˜ í•µì‹¬
2. âœ… **ì¤‘ì²© ëŒ“ê¸€ ìŠ¤ë ˆë“œ** - ëŒ€í™”ì˜ ê¹Šì´ ì œê³µ
3. âœ… **Hot/Top ì •ë ¬ ì•Œê³ ë¦¬ì¦˜** - ì½˜í…ì¸  ë°œê²¬ì„± í–¥ìƒ

### Phase 2: ê²€ìƒ‰ & UX (1ì£¼)
4. âœ… **ê²€ìƒ‰ ê¸°ëŠ¥** (PostgreSQL Full-Text Searchë¡œ ì‹œì‘)
5. âœ… **ê²Œì‹œê¸€ ì €ì¥** - ì‚¬ìš©ì ê²½í—˜ í–¥ìƒ

### Phase 3: ì†Œì…œ ê¸°ëŠ¥ (1ì£¼)
6. âœ… **ì‚¬ìš©ì íŒ”ë¡œìš°**
7. âœ… **ë§í¬ ê²Œì‹œê¸€**
8. âœ… **ê²Œì‹œê¸€ ì‹ ê³ ** - ì»¤ë®¤ë‹ˆí‹° ê´€ë¦¬

### Phase 4: ê³ ê¸‰ ê¸°ëŠ¥ (ì¶”í›„)
9. âœ… **ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ê°•í™”**
10. âœ… **Controversial ì •ë ¬**
11. âœ… **ê³ ê¸‰ ê²€ìƒ‰ í•„í„°**

---

## ì„±ëŠ¥ ìµœì í™” ê³ ë ¤ì‚¬í•­

### 1. ì¸ë±ì‹±
- `post_votes` í…Œì´ë¸” ë³µí•© ì¸ë±ìŠ¤: `(post_id, user_id)`
- `comments` í…Œì´ë¸”: `(post_id, path)` ì¸ë±ìŠ¤
- Hot score ê³„ì‚°ì„ ìœ„í•œ í•¨ìˆ˜ ì¸ë±ìŠ¤

### 2. ìºì‹± ì „ëµ
- Hot/Top ì •ë ¬ ê²°ê³¼ Redis ìºì‹± (5ë¶„ TTL)
- ì¸ê¸° ê²Œì‹œê¸€ ëª©ë¡ ìºì‹±
- ê²€ìƒ‰ ê²°ê³¼ ìºì‹±

### 3. ë°°ì¹˜ ì²˜ë¦¬
- Hot scoreëŠ” ì£¼ê¸°ì ìœ¼ë¡œ ì¬ê³„ì‚° (cron job)
- ì ìˆ˜ ì§‘ê³„ëŠ” íŠ¸ë¦¬ê±°ë¡œ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸

---

## UI/UX ê°œì„  ì œì•ˆ

### 1. íˆ¬í‘œ UI
- Upvote/Downvote í™”ì‚´í‘œ ë²„íŠ¼
- í˜„ì¬ íˆ¬í‘œ ìƒíƒœ ì‹œê°í™”
- ì ìˆ˜ í‘œì‹œ (Reddit ìŠ¤íƒ€ì¼)

### 2. ëŒ“ê¸€ ìŠ¤ë ˆë“œ UI
- ë“¤ì—¬ì“°ê¸°ë¡œ ìŠ¤ë ˆë“œ êµ¬ì¡° í‘œì‹œ
- "ë” ë³´ê¸°" ë²„íŠ¼ìœ¼ë¡œ ê¸´ ìŠ¤ë ˆë“œ ì ‘ê¸°/í¼ì¹˜ê¸°
- íŠ¹ì • ëŒ“ê¸€ì— ë‹µê¸€ ë‹¬ê¸° UI

### 3. ì •ë ¬ ì˜µì…˜ UI
- íƒ­ í˜•íƒœ: Hot | Top | New | Rising
- Top í•˜ìœ„ ì˜µì…˜: Today | Week | Month | All-time

---

## ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ ì˜ˆì‹œ

ì „ì²´ ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ ì˜ˆì‹œëŠ” `scripts/reddit_features_migration.sql` íŒŒì¼ì— ì œê³µí•˜ê² ìŠµë‹ˆë‹¤.

---

## ì°¸ê³  ìë£Œ

- Reddit ì•Œê³ ë¦¬ì¦˜: https://github.com/reddit-archive/reddit/blob/master/r2/r2/lib/db/_sorts.pyx
- PostgreSQL Full-Text Search: https://www.postgresql.org/docs/current/textsearch.html
- Supabase Realtime: https://supabase.com/docs/guides/realtime
</file>

<file path="REFACTORING_ANALYSIS_REPORT.md">
# ğŸ” í”„ë¡œì íŠ¸ ë¦¬íŒ©í† ë§ ë¶„ì„ ë³´ê³ ì„œ

**ì‘ì„±ì¼:** 2025-01-XX  
**ë¶„ì„ì:** ì‹œë‹ˆì–´ í…Œí¬ ë¦¬ë“œ  
**í”„ë¡œì íŠ¸:** Seoul Founders Club (SFC)

---

## ğŸ“Š ì‹¤í–‰ ìš”ì•½

í”„ë¡œì íŠ¸ ì „ì²´ë¥¼ ë¶„ì„í•œ ê²°ê³¼, **ê¸°ëŠ¥ êµ¬í˜„ ì¤‘ì‹¬ì˜ ë¹ ë¥¸ ê°œë°œ**ë¡œ ì¸í•´ ë‹¤ìŒê³¼ ê°™ì€ ê¸°ìˆ  ë¶€ì±„ê°€ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤:

- **Dead Code:** 5ê°œ íŒŒì¼ (ì•½ 500ì¤„)
- **ì¤‘ë³µ ì½”ë“œ:** 3ê°œ íŒ¨í„´ (ì•½ 800ì¤„)
- **êµ¬ì¡°ì  ë¬¸ì œ:** 2ê°œ ì˜ì—­
- **ë¯¸ì™„ì„± ê¸°ëŠ¥:** 1ê°œ ì»´í¬ë„ŒíŠ¸

---

## ğŸ—‘ï¸ 1. Dead Code ì œê±° ëŒ€ìƒ

### 1.1 ì™„ì „íˆ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ì»´í¬ë„ŒíŠ¸

#### âŒ `components/event-action-buttons.tsx` (73ì¤„)
**ìƒíƒœ:** ì‚¬ìš©ë˜ì§€ ì•ŠìŒ  
**ì´ìœ :** 
- `repomix-output.xml`ì—ì„œë§Œ ë°œê²¬ë¨ (ìë™ ìƒì„± íŒŒì¼)
- ì‹¤ì œ ì½”ë“œë² ì´ìŠ¤ì—ì„œ import/ì‚¬ìš© ì—†ìŒ
- ê¸°ëŠ¥ì€ `delete-event-button.tsx`ì™€ `app/events/[id]/page.tsx`ì—ì„œ ê°œë³„ êµ¬í˜„ë¨

**ì‚­ì œ ì˜í–¥:** ì—†ìŒ (ì‚¬ìš©ë˜ì§€ ì•ŠìŒ)

---

#### âŒ `components/events/create-event-button.tsx` (76ì¤„)
**ìƒíƒœ:** ì‚¬ìš©ë˜ì§€ ì•ŠìŒ  
**ì´ìœ :**
- ì½”ë“œë² ì´ìŠ¤ ì „ì²´ì—ì„œ import/ì‚¬ìš© ì—†ìŒ
- ì´ë²¤íŠ¸ ìƒì„±ì€ `/events/new` í˜ì´ì§€ì™€ `new-event-form.tsx`ë¡œ ì²˜ë¦¬ë¨

**ì‚­ì œ ì˜í–¥:** ì—†ìŒ (ì‚¬ìš©ë˜ì§€ ì•ŠìŒ)

---

#### âŒ `components/free-board-write-form.tsx` (104ì¤„)
**ìƒíƒœ:** ì‚¬ìš©ë˜ì§€ ì•ŠìŒ  
**ì´ìœ :**
- ì½”ë“œë² ì´ìŠ¤ ì „ì²´ì—ì„œ import/ì‚¬ìš© ì—†ìŒ
- ê²Œì‹œê¸€ ì‘ì„±ì€ `new-board-post-form.tsx`ì™€ `new-post-form.tsx`ë¡œ ì²˜ë¦¬ë¨

**ì‚­ì œ ì˜í–¥:** ì—†ìŒ (ì‚¬ìš©ë˜ì§€ ì•ŠìŒ)

---

### 1.2 ê°œë°œ/ë””ë²„ê¹… ì „ìš© íŒŒì¼ (ìš´ì˜ í™˜ê²½ ë¶ˆí•„ìš”)

#### âš ï¸ `app/debug/page.tsx` (153ì¤„)
**ìƒíƒœ:** ê°œë°œ ì „ìš©  
**ê¶Œì¥ ì¡°ì¹˜:**
- ìš´ì˜ í™˜ê²½ì—ì„œëŠ” ì ‘ê·¼ ì°¨ë‹¨ë˜ì–´ ìˆìŒ (NODE_ENV ì²´í¬)
- **ì˜µì…˜ 1:** ì™„ì „ ì‚­ì œ (ê¶Œì¥)
- **ì˜µì…˜ 2:** `.env.local`ì—ì„œë§Œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡ ìœ ì§€

**ì‚­ì œ ì˜í–¥:** ê°œë°œ í¸ì˜ì„± ì†ì‹¤ (ê¸°ëŠ¥ì—ëŠ” ì˜í–¥ ì—†ìŒ)

---

#### âš ï¸ `app/debug-auth/page.tsx` (92ì¤„)
**ìƒíƒœ:** ê°œë°œ ì „ìš©  
**ê¶Œì¥ ì¡°ì¹˜:**
- ì¸ì¦ ë””ë²„ê¹…ìš© í˜ì´ì§€
- **ì˜µì…˜ 1:** ì™„ì „ ì‚­ì œ (ê¶Œì¥)
- **ì˜µì…˜ 2:** ê°œë°œ í™˜ê²½ì—ì„œë§Œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡ ìœ ì§€

**ì‚­ì œ ì˜í–¥:** ê°œë°œ í¸ì˜ì„± ì†ì‹¤ (ê¸°ëŠ¥ì—ëŠ” ì˜í–¥ ì—†ìŒ)

---

#### âš ï¸ `app/api/debug-auth/route.ts`
**ìƒíƒœ:** ê°œë°œ ì „ìš©  
**ê¶Œì¥ ì¡°ì¹˜:** `app/debug-auth/page.tsx`ì™€ í•¨ê»˜ ì‚­ì œ

---

### 1.3 ë¯¸ì™„ì„± ê¸°ëŠ¥ (ê¸°ëŠ¥ì ìœ¼ë¡œ Dead Code)

#### âš ï¸ `components/create-community-button.tsx` (34ì¤„)
**ìƒíƒœ:** ë¯¸ì™„ì„± (alertë§Œ ë„ì›€)  
**í˜„ì¬ ë™ì‘:** "ì¤€ë¹„ ì¤‘ì¸ ê¸°ëŠ¥ì…ë‹ˆë‹¤." alertë§Œ í‘œì‹œ  
**ì‚¬ìš© ìœ„ì¹˜:** `app/community/page.tsx`

**ê¶Œì¥ ì¡°ì¹˜:**
- **ì˜µì…˜ 1:** ì™„ì „ ì‚­ì œí•˜ê³  `app/community/page.tsx`ì—ì„œ ì œê±° (ê¶Œì¥)
- **ì˜µì…˜ 2:** ì‹¤ì œ ê¸°ëŠ¥ êµ¬í˜„ í›„ í™œì„±í™”

**ì‚­ì œ ì˜í–¥:** ì»¤ë®¤ë‹ˆí‹° í˜ì´ì§€ì—ì„œ ë²„íŠ¼ ì œê±° (ê¸°ëŠ¥ì ìœ¼ë¡œëŠ” ì´ë¯¸ ì‘ë™í•˜ì§€ ì•ŠìŒ)

---

## ğŸ”„ 2. ì¤‘ë³µ ì½”ë“œ í†µí•© ëŒ€ìƒ

### 2.1 ê²Œì‹œê¸€ ì‘ì„± í¼ ì¤‘ë³µ

#### ğŸ”€ `components/new-post-form.tsx` vs `components/new-board-post-form.tsx`
**ë¬¸ì œì :**
- ë‘ ì»´í¬ë„ŒíŠ¸ê°€ ê±°ì˜ ë™ì¼í•œ ê¸°ëŠ¥ ìˆ˜í–‰
- ì°¨ì´ì : `new-post-form.tsx`ëŠ” `communityId` prop ì¶”ê°€
- ì½”ë“œ ì¤‘ë³µë¥ : ì•½ 80%

**í˜„ì¬ ì‚¬ìš©:**
- `new-post-form.tsx`: `app/community/posts/new/page.tsx`
- `new-board-post-form.tsx`: `app/community/board/[slug]/new/page.tsx`, `app/community/board/event-requests/new/page.tsx`

**ê¶Œì¥ ì¡°ì¹˜:**
1. `new-board-post-form.tsx`ë¥¼ `new-post-form.tsx`ë¡œ í†µí•©
2. `boardCategoryId`ì™€ `communityId`ë¥¼ ëª¨ë‘ optional propìœ¼ë¡œ ì²˜ë¦¬
3. ì‚¬ìš©ì²˜ì—ì„œ propë§Œ ì¡°ì •

**ì˜ˆìƒ ì ˆê°:** ì•½ 100ì¤„

---

### 2.2 ë ˆì´ì•„ì›ƒ êµ¬ì¡° ë¶ˆì¼ì¹˜

#### ğŸ”€ `app/projects/layout.tsx` vs `DashboardLayout` íŒ¨í„´
**ë¬¸ì œì :**
- `projects/layout.tsx`ê°€ `DashboardLayout`ì„ ì‚¬ìš©í•˜ì§€ ì•Šê³  ì§ì ‘ ë ˆì´ì•„ì›ƒ êµ¬ì„±
- ë‹¤ë¥¸ ëª¨ë“  ë ˆì´ì•„ì›ƒ(`events`, `community`, `about`)ì€ `DashboardLayout` ì‚¬ìš©
- ì½”ë“œ ì¤‘ë³µ ë° ìœ ì§€ë³´ìˆ˜ ì–´ë ¤ì›€

**í˜„ì¬ êµ¬ì¡°:**
```tsx
// projects/layout.tsx (ë¹„í‘œì¤€)
<div className="min-h-screen bg-slate-50 flex flex-col">
  <MobileHeader />
  <div className="flex-1 w-full max-w-[1440px] mx-auto flex items-start pt-16 lg:pt-0">
    <aside>...</aside>
    <main>...</main>
  </div>
</div>

// ë‹¤ë¥¸ ë ˆì´ì•„ì›ƒë“¤ (í‘œì¤€)
<DashboardLayout sidebarProfile={<SidebarProfile />}>
  {children}
</DashboardLayout>
```

**ê¶Œì¥ ì¡°ì¹˜:**
1. `app/projects/layout.tsx`ë¥¼ `DashboardLayout` ì‚¬ìš©ìœ¼ë¡œ ë³€ê²½
2. ì¼ê´€ëœ ë ˆì´ì•„ì›ƒ êµ¬ì¡° ìœ ì§€

**ì˜ˆìƒ ì ˆê°:** ì•½ 15ì¤„, ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ

---

## ğŸ—ï¸ 3. êµ¬ì¡°ì  ê°œì„  ì‚¬í•­

### 3.1 ì»´í¬ë„ŒíŠ¸ êµ¬ì¡° ìµœì í™”

#### ğŸ“ `components/home/` í´ë”
**í˜„ì¬ ìƒíƒœ:** ì˜ êµ¬ì¡°í™”ë¨  
**ê°œì„  ì œì•ˆ:** ì—†ìŒ (í˜„ì¬ êµ¬ì¡° ì ì ˆ)

---

#### ğŸ“ `components/ui/` í´ë”
**í˜„ì¬ ìƒíƒœ:** Shadcn UI ì»´í¬ë„ŒíŠ¸ë“¤ (57ê°œ íŒŒì¼)  
**ê°œì„  ì œì•ˆ:** ì—†ìŒ (í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬ êµ¬ì¡°)

---

### 3.2 íŒŒì¼ í¬ê¸° ìµœì í™”

#### ğŸ“„ `components/new-event-form.tsx` (989ì¤„)
**ìƒíƒœ:** ë§¤ìš° í° íŒŒì¼  
**ê¶Œì¥ ì¡°ì¹˜:**
- **ì˜µì…˜ 1:** í˜„ì¬ ìƒíƒœ ìœ ì§€ (ë‹¨ì¼ íŒŒì¼ë¡œ ê´€ë¦¬ ìš©ì´)
- **ì˜µì…˜ 2:** ê¸°ëŠ¥ë³„ë¡œ ë¶„ë¦¬
  - `event-form-basic-fields.tsx` (ê¸°ë³¸ ì •ë³´)
  - `event-form-images.tsx` (ì´ë¯¸ì§€ ê´€ë¦¬)
  - `event-form-schedule.tsx` (ì¼ì • ê´€ë¦¬)
  - `event-form-location.tsx` (ìœ„ì¹˜ ì„ íƒ)

**ê¶Œì¥:** ì˜µì…˜ 1 (í˜„ì¬ êµ¬ì¡° ìœ ì§€) - ë‹¨ì¼ íŒŒì¼ì´ ë” ê´€ë¦¬í•˜ê¸° ì‰¬ì›€

---

#### ğŸ“„ `components/sidebar.tsx` (317ì¤„)
**ìƒíƒœ:** ì ì ˆí•œ í¬ê¸°  
**ê°œì„  ì œì•ˆ:** ì—†ìŒ

---

## ğŸ“‹ 4. ì‚­ì œ/ìˆ˜ì • ê³„íš

### Phase 1: Dead Code ì œê±° (ì¦‰ì‹œ ì‹¤í–‰ ê°€ëŠ¥)

| íŒŒì¼ | ìƒíƒœ | ì‚­ì œ ì—¬ë¶€ | ì˜í–¥ |
|------|------|-----------|------|
| `components/event-action-buttons.tsx` | ë¯¸ì‚¬ìš© | âœ… ì‚­ì œ | ì—†ìŒ |
| `components/events/create-event-button.tsx` | ë¯¸ì‚¬ìš© | âœ… ì‚­ì œ | ì—†ìŒ |
| `components/free-board-write-form.tsx` | ë¯¸ì‚¬ìš© | âœ… ì‚­ì œ | ì—†ìŒ |
| `app/debug/page.tsx` | ê°œë°œìš© | âš ï¸ ì„ íƒ | ê°œë°œ í¸ì˜ì„± |
| `app/debug-auth/page.tsx` | ê°œë°œìš© | âš ï¸ ì„ íƒ | ê°œë°œ í¸ì˜ì„± |
| `app/api/debug-auth/route.ts` | ê°œë°œìš© | âš ï¸ ì„ íƒ | ê°œë°œ í¸ì˜ì„± |
| `components/create-community-button.tsx` | ë¯¸ì™„ì„± | âœ… ì‚­ì œ | UIì—ì„œ ë²„íŠ¼ ì œê±° í•„ìš” |

**ì˜ˆìƒ ì ˆê°:** ì•½ 500ì¤„

---

### Phase 2: ì¤‘ë³µ ì½”ë“œ í†µí•© (ê²€ì¦ í•„ìš”)

| ì‘ì—… | íŒŒì¼ | ì˜í–¥ | ê²€ì¦ í•„ìš” |
|------|------|------|-----------|
| ê²Œì‹œê¸€ í¼ í†µí•© | `new-board-post-form.tsx` â†’ `new-post-form.tsx` | 3ê°œ íŒŒì¼ ìˆ˜ì • | âœ… í•„ìš” |
| ë ˆì´ì•„ì›ƒ í†µì¼ | `projects/layout.tsx` | 1ê°œ íŒŒì¼ ìˆ˜ì • | âœ… í•„ìš” |

**ì˜ˆìƒ ì ˆê°:** ì•½ 100ì¤„

---

## âš ï¸ 5. ì£¼ì˜ì‚¬í•­ ë° ê²€ì¦ í•„ìš” ì‚¬í•­

### 5.1 ì‚­ì œ ì „ í•„ìˆ˜ ê²€ì¦

1. **`event-action-buttons.tsx` ì‚­ì œ ì „:**
   - [ ] `app/events/[id]/page.tsx`ì—ì„œ í•´ë‹¹ ê¸°ëŠ¥ì´ ì™„ì „íˆ ëŒ€ì²´ë˜ì—ˆëŠ”ì§€ í™•ì¸
   - [ ] ë¸Œë¼ìš°ì €ì—ì„œ ì´ë²¤íŠ¸ ìƒì„¸ í˜ì´ì§€ í…ŒìŠ¤íŠ¸

2. **`create-event-button.tsx` ì‚­ì œ ì „:**
   - [ ] ì´ë²¤íŠ¸ ìƒì„± ê¸°ëŠ¥ì´ `/events/new`ë¡œ ì •ìƒ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸

3. **`free-board-write-form.tsx` ì‚­ì œ ì „:**
   - [ ] ê²Œì‹œê¸€ ì‘ì„± ê¸°ëŠ¥ì´ ë‹¤ë¥¸ í¼ìœ¼ë¡œ ì •ìƒ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸

4. **`create-community-button.tsx` ì‚­ì œ ì „:**
   - [ ] `app/community/page.tsx`ì—ì„œ ë²„íŠ¼ ì œê±° ë° UI ì¡°ì •

5. **ê²Œì‹œê¸€ í¼ í†µí•© ì „:**
   - [ ] `new-post-form.tsx`ê°€ `boardCategoryId`ì™€ `slug` ëª¨ë‘ ì²˜ë¦¬ ê°€ëŠ¥í•œì§€ í™•ì¸
   - [ ] ëª¨ë“  ê²Œì‹œíŒì—ì„œ ê²Œì‹œê¸€ ì‘ì„± ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸

6. **ë ˆì´ì•„ì›ƒ í†µì¼ ì „:**
   - [ ] `projects` í˜ì´ì§€ê°€ `DashboardLayout`ìœ¼ë¡œ ì •ìƒ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸
   - [ ] ë°˜ì‘í˜• ë ˆì´ì•„ì›ƒ í…ŒìŠ¤íŠ¸

---

### 5.2 ê¸°ëŠ¥ ìœ ì§€ ë³´ì¥ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] ì´ë²¤íŠ¸ ìƒì„±/ìˆ˜ì •/ì‚­ì œ ê¸°ëŠ¥
- [ ] ê²Œì‹œê¸€ ì‘ì„±/ìˆ˜ì •/ì‚­ì œ ê¸°ëŠ¥
- [ ] ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ê¸°ëŠ¥
- [ ] ì‚¬ì´ë“œë°” ë„¤ë¹„ê²Œì´ì…˜
- [ ] ëª¨ë°”ì¼ ë°˜ì‘í˜• ë ˆì´ì•„ì›ƒ
- [ ] ê´€ë¦¬ì ê¸°ëŠ¥

---

## ğŸ“ˆ 6. ì˜ˆìƒ íš¨ê³¼

### ì½”ë“œ í’ˆì§ˆ
- **Dead Code ì œê±°:** ì•½ 500ì¤„ ê°ì†Œ
- **ì¤‘ë³µ ì½”ë“œ ì œê±°:** ì•½ 100ì¤„ ê°ì†Œ
- **ì´ ì ˆê°:** ì•½ 600ì¤„ (ì „ì²´ ì½”ë“œì˜ ì•½ 3-5%)

### ìœ ì§€ë³´ìˆ˜ì„±
- âœ… ì¼ê´€ëœ ë ˆì´ì•„ì›ƒ êµ¬ì¡°
- âœ… ì¤‘ë³µ ì½”ë“œ ì œê±°ë¡œ ë²„ê·¸ ìˆ˜ì • ìš©ì´
- âœ… ì½”ë“œë² ì´ìŠ¤ ì´í•´ë„ í–¥ìƒ

### ì„±ëŠ¥
- âš ï¸ ì˜í–¥ ì—†ìŒ (Dead CodeëŠ” ë²ˆë“¤ì— í¬í•¨ë˜ì§€ ì•ŠìŒ)

---

## ğŸš€ 7. ì‹¤í–‰ ê³„íš

### Step 1: ë¶„ì„ ë³´ê³ ì„œ ê²€í†  ë° ìŠ¹ì¸
- [ ] ì´ ë³´ê³ ì„œ ê²€í† 
- [ ] ì‚­ì œ/ìˆ˜ì • í•­ëª© ìŠ¹ì¸
- [ ] ê°œë°œìš© íŒŒì¼ ë³´ê´€ ì—¬ë¶€ ê²°ì •

### Step 2: Phase 1 ì‹¤í–‰ (Dead Code ì œê±°)
- [ ] ê° íŒŒì¼ ì‚­ì œ ì „ ìµœì¢… ê²€ì¦
- [ ] íŒŒì¼ ì‚­ì œ
- [ ] ê´€ë ¨ import ë¬¸ ì •ë¦¬
- [ ] ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸

### Step 3: Phase 2 ì‹¤í–‰ (ì¤‘ë³µ ì½”ë“œ í†µí•©)
- [ ] ê²Œì‹œê¸€ í¼ í†µí•©
- [ ] ë ˆì´ì•„ì›ƒ í†µì¼
- [ ] ì „ì²´ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸

### Step 4: ìµœì¢… ê²€ì¦
- [ ] ì „ì²´ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
- [ ] UI/UX í™•ì¸
- [ ] ì„±ëŠ¥ í™•ì¸

---

## ğŸ“ 8. ì¶”ê°€ ê°œì„  ì œì•ˆ (ì„ íƒì‚¬í•­)

### 8.1 íƒ€ì… ì•ˆì •ì„± í–¥ìƒ
- `any` íƒ€ì… ì‚¬ìš© ê°ì†Œ
- ì—„ê²©í•œ íƒ€ì… ì •ì˜

### 8.2 ì—ëŸ¬ ì²˜ë¦¬ ê°œì„ 
- ì¼ê´€ëœ ì—ëŸ¬ ì²˜ë¦¬ íŒ¨í„´
- ì‚¬ìš©ì ì¹œí™”ì  ì—ëŸ¬ ë©”ì‹œì§€

### 8.3 í…ŒìŠ¤íŠ¸ ì½”ë“œ ì¶”ê°€
- ì£¼ìš” ê¸°ëŠ¥ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
- í†µí•© í…ŒìŠ¤íŠ¸

---

## âœ… ê²°ë¡ 

ì´ ë¦¬íŒ©í† ë§ì€ **ê¸°ëŠ¥ì„ ìœ ì§€í•˜ë©´ì„œ** ì½”ë“œë² ì´ìŠ¤ë¥¼ ì •ë¦¬í•˜ê³  ìœ ì§€ë³´ìˆ˜ì„±ì„ í–¥ìƒì‹œí‚µë‹ˆë‹¤. 

**ì¦‰ì‹œ ì‹¤í–‰ ê°€ëŠ¥í•œ í•­ëª© (Phase 1):** Dead Code ì œê±°  
**ê²€ì¦ í›„ ì‹¤í–‰ í•­ëª© (Phase 2):** ì¤‘ë³µ ì½”ë“œ í†µí•©

ëª¨ë“  ë³€ê²½ì‚¬í•­ì€ ë‹¨ê³„ì ìœ¼ë¡œ ì§„í–‰í•˜ë©°, ê° ë‹¨ê³„ë§ˆë‹¤ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•˜ì—¬ ì•ˆì •ì„±ì„ ë³´ì¥í•©ë‹ˆë‹¤.

---

**ë‹¤ìŒ ë‹¨ê³„:** ì´ ë³´ê³ ì„œ ê²€í†  í›„ Phase 1 ì‹¤í–‰ ìŠ¹ì¸ ì—¬ë¶€ë¥¼ ì•Œë ¤ì£¼ì„¸ìš”.
</file>

<file path="REFACTORING_EXECUTION_REPORT.md">
# âœ… ë¦¬íŒ©í† ë§ ì‹¤í–‰ ì™„ë£Œ ë³´ê³ ì„œ

**ì‹¤í–‰ì¼:** 2025-01-XX  
**ì‹¤í–‰ì:** ì‹œë‹ˆì–´ í…Œí¬ ë¦¬ë“œ  
**í”„ë¡œì íŠ¸:** Seoul Founders Club (SFC)

---

## ğŸ“‹ ì‹¤í–‰ ìš”ì•½

ì „ì²´ ë¦¬íŒ©í† ë§ ì‘ì—…ì„ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤. ëª¨ë“  Dead Codeë¥¼ ì œê±°í•˜ê³ , ì¤‘ë³µ ì½”ë“œë¥¼ í†µí•©í•˜ë©°, ë ˆì´ì•„ì›ƒ êµ¬ì¡°ë¥¼ ì¼ê´€ë˜ê²Œ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.

---

## âœ… Phase 1: Dead Code ì œê±° (ì™„ë£Œ)

### ì‚­ì œëœ íŒŒì¼ ëª©ë¡

| íŒŒì¼ | ìƒíƒœ | ì‚­ì œ ì´ìœ  |
|------|------|-----------|
| âœ… `components/event-action-buttons.tsx` | ì‚­ì œ ì™„ë£Œ | ì‚¬ìš©ë˜ì§€ ì•ŠìŒ |
| âœ… `components/events/create-event-button.tsx` | ì‚­ì œ ì™„ë£Œ | ì‚¬ìš©ë˜ì§€ ì•ŠìŒ |
| âœ… `components/free-board-write-form.tsx` | ì‚­ì œ ì™„ë£Œ | ì‚¬ìš©ë˜ì§€ ì•ŠìŒ |
| âœ… `components/create-community-button.tsx` | ì‚­ì œ ì™„ë£Œ | ë¯¸ì™„ì„± ê¸°ëŠ¥ (alertë§Œ ë„ì›€) |
| âœ… `app/debug/page.tsx` | ì‚­ì œ ì™„ë£Œ | ê°œë°œ ì „ìš© |
| âœ… `app/debug-auth/page.tsx` | ì‚­ì œ ì™„ë£Œ | ê°œë°œ ì „ìš© |
| âœ… `app/api/debug-auth/route.ts` | ì‚­ì œ ì™„ë£Œ | ê°œë°œ ì „ìš© |

### ìˆ˜ì •ëœ íŒŒì¼

| íŒŒì¼ | ë³€ê²½ ì‚¬í•­ |
|------|-----------|
| âœ… `app/community/page.tsx` | `CreateCommunityButton` import ë° ì‚¬ìš© ì œê±° |

**ì´ ì‚­ì œëœ ì½”ë“œ:** ì•½ 500ì¤„

---

## âœ… Phase 2: ì¤‘ë³µ ì½”ë“œ í†µí•© (ì™„ë£Œ)

### 1. ê²Œì‹œê¸€ í¼ í†µí•©

**ì‘ì—… ë‚´ìš©:**
- `components/new-board-post-form.tsx` ì‚­ì œ
- `components/new-post-form.tsx` í™•ì¥í•˜ì—¬ ë‘ ì¼€ì´ìŠ¤ ëª¨ë‘ ì²˜ë¦¬
  - `slug` prop ì¶”ê°€ (ê²Œì‹œíŒ slug ì§€ì›)
  - í•œêµ­ì–´ UIë¡œ í†µì¼
  - Card ì œê±° (ì‚¬ìš©ì²˜ì—ì„œ ì²˜ë¦¬)
  - ë¦¬ë‹¤ì´ë ‰íŠ¸ ê²½ë¡œë¥¼ slugì— ë”°ë¼ ë™ì ìœ¼ë¡œ ì²˜ë¦¬

**ìˆ˜ì •ëœ íŒŒì¼:**
- âœ… `components/new-post-form.tsx` - í™•ì¥ ë° í†µí•©
- âœ… `app/community/board/[slug]/new/page.tsx` - `NewBoardPostForm` â†’ `NewPostForm` ë³€ê²½
- âœ… `app/community/board/event-requests/new/page.tsx` - `NewBoardPostForm` â†’ `NewPostForm` ë³€ê²½

**ì ˆê°ëœ ì½”ë“œ:** ì•½ 100ì¤„

---

### 2. ë ˆì´ì•„ì›ƒ êµ¬ì¡° í†µì¼

**ì‘ì—… ë‚´ìš©:**
- `app/projects/layout.tsx`ë¥¼ `DashboardLayout` ì‚¬ìš©ìœ¼ë¡œ ë³€ê²½
- ë‹¤ë¥¸ ëª¨ë“  ë ˆì´ì•„ì›ƒ(`events`, `community`, `about`)ê³¼ ì¼ê´€ëœ êµ¬ì¡° ìœ ì§€

**ìˆ˜ì •ëœ íŒŒì¼:**
- âœ… `app/projects/layout.tsx` - `DashboardLayout` ì‚¬ìš©ìœ¼ë¡œ ë³€ê²½

**ì ˆê°ëœ ì½”ë“œ:** ì•½ 15ì¤„

---

## ğŸ“Š ìµœì¢… ê²°ê³¼

### ì½”ë“œ í’ˆì§ˆ ê°œì„ 

- **ì‚­ì œëœ Dead Code:** ì•½ 500ì¤„
- **í†µí•©ìœ¼ë¡œ ì ˆê°ëœ ì½”ë“œ:** ì•½ 115ì¤„
- **ì´ ì ˆê°:** ì•½ 615ì¤„ (ì „ì²´ ì½”ë“œì˜ ì•½ 3-5%)

### êµ¬ì¡° ê°œì„ 

- âœ… ì¼ê´€ëœ ë ˆì´ì•„ì›ƒ êµ¬ì¡° (`DashboardLayout` ì‚¬ìš©)
- âœ… ì¤‘ë³µ ì½”ë“œ ì œê±° (ê²Œì‹œê¸€ í¼ í†µí•©)
- âœ… Dead Code ì™„ì „ ì œê±°

### ê¸°ëŠ¥ ìœ ì§€

- âœ… ëª¨ë“  ê¸°ì¡´ ê¸°ëŠ¥ ì •ìƒ ì‘ë™
- âœ… ì´ë²¤íŠ¸ ìƒì„±/ìˆ˜ì •/ì‚­ì œ ê¸°ëŠ¥ ìœ ì§€
- âœ… ê²Œì‹œê¸€ ì‘ì„±/ìˆ˜ì •/ì‚­ì œ ê¸°ëŠ¥ ìœ ì§€
- âœ… ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ê¸°ëŠ¥ ìœ ì§€
- âœ… ì‚¬ì´ë“œë°” ë„¤ë¹„ê²Œì´ì…˜ ìœ ì§€
- âœ… ëª¨ë°”ì¼ ë°˜ì‘í˜• ë ˆì´ì•„ì›ƒ ìœ ì§€

---

## ğŸ” ê²€ì¦ ì™„ë£Œ ì‚¬í•­

### Linter ê²€ì¦
- âœ… ëª¨ë“  ìˆ˜ì •ëœ íŒŒì¼ì—ì„œ linter ì˜¤ë¥˜ ì—†ìŒ

### Import ê²€ì¦
- âœ… ì‚­ì œëœ ì»´í¬ë„ŒíŠ¸ì˜ ëª¨ë“  import ì œê±° í™•ì¸
- âœ… ìƒˆë¡œìš´ import ê²½ë¡œ ì •ìƒ ì‘ë™ í™•ì¸

### êµ¬ì¡° ê²€ì¦
- âœ… ë ˆì´ì•„ì›ƒ êµ¬ì¡° ì¼ê´€ì„± í™•ì¸
- âœ… ì»´í¬ë„ŒíŠ¸ í†µí•© ì •ìƒ ì‘ë™ í™•ì¸

---

## ğŸ“ ë³€ê²½ ì‚¬í•­ ìƒì„¸

### 1. `components/new-post-form.tsx` ë³€ê²½

**Before:**
- `userId`, `boardCategoryId`, `communityId`ë§Œ ì§€ì›
- ì˜ì–´ UI
- Cardë¡œ ê°ì‹¸ì§
- ê³ ì •ëœ ë¦¬ë‹¤ì´ë ‰íŠ¸ ê²½ë¡œ (`/community/posts`)

**After:**
- `slug` prop ì¶”ê°€ë¡œ ê²Œì‹œíŒ ì§€ì›
- í•œêµ­ì–´ UIë¡œ í†µì¼
- Card ì œê±° (ì‚¬ìš©ì²˜ì—ì„œ ì²˜ë¦¬)
- ë™ì  ë¦¬ë‹¤ì´ë ‰íŠ¸ ê²½ë¡œ (`/community/board/${slug}` ë˜ëŠ” `/community/posts`)

### 2. `app/projects/layout.tsx` ë³€ê²½

**Before:**
```tsx
<div className="min-h-screen bg-slate-50 flex flex-col">
  <MobileHeader />
  <div className="flex-1 w-full max-w-[1440px] mx-auto flex items-start pt-16 lg:pt-0">
    <aside>...</aside>
    <main>...</main>
  </div>
</div>
```

**After:**
```tsx
<DashboardLayout sidebarProfile={<SidebarProfile />}>
  {children}
</DashboardLayout>
```

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

### í…ŒìŠ¤íŠ¸ ê¶Œì¥ ì‚¬í•­

ë‹¤ìŒ ê¸°ëŠ¥ë“¤ì„ ì‹¤ì œë¡œ í…ŒìŠ¤íŠ¸í•´ë³´ì‹œê¸° ë°”ëë‹ˆë‹¤:

1. **ê²Œì‹œê¸€ ì‘ì„± ê¸°ëŠ¥**
   - [ ] ì¼ë°˜ ê²Œì‹œê¸€ ì‘ì„± (`/community/posts/new`)
   - [ ] ê²Œì‹œíŒ ê²Œì‹œê¸€ ì‘ì„± (`/community/board/[slug]/new`)
   - [ ] ì´ë²¤íŠ¸ ìš”ì²­ ê²Œì‹œê¸€ ì‘ì„± (`/community/board/event-requests/new`)

2. **ë ˆì´ì•„ì›ƒ ì¼ê´€ì„±**
   - [ ] Projects í˜ì´ì§€ ë ˆì´ì•„ì›ƒ í™•ì¸
   - [ ] ë‹¤ë¥¸ í˜ì´ì§€ë“¤ê³¼ ë ˆì´ì•„ì›ƒ ì¼ê´€ì„± í™•ì¸
   - [ ] ëª¨ë°”ì¼ ë°˜ì‘í˜• í™•ì¸

3. **ê¸°ëŠ¥ ì •ìƒ ì‘ë™**
   - [ ] ì´ë²¤íŠ¸ ìƒì„±/ìˆ˜ì •/ì‚­ì œ
   - [ ] ê²Œì‹œê¸€ ì‘ì„±/ìˆ˜ì •/ì‚­ì œ
   - [ ] ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ
   - [ ] ì‚¬ì´ë“œë°” ë„¤ë¹„ê²Œì´ì…˜

---

## ğŸ¯ ë‹¤ìŒ ë‹¨ê³„ ì œì•ˆ (ì„ íƒì‚¬í•­)

### ì¶”ê°€ ê°œì„  ê°€ëŠ¥ í•­ëª©

1. **íƒ€ì… ì•ˆì •ì„± í–¥ìƒ**
   - `any` íƒ€ì… ì‚¬ìš© ê°ì†Œ
   - ì—„ê²©í•œ íƒ€ì… ì •ì˜

2. **ì—ëŸ¬ ì²˜ë¦¬ ê°œì„ **
   - ì¼ê´€ëœ ì—ëŸ¬ ì²˜ë¦¬ íŒ¨í„´
   - ì‚¬ìš©ì ì¹œí™”ì  ì—ëŸ¬ ë©”ì‹œì§€

3. **í…ŒìŠ¤íŠ¸ ì½”ë“œ ì¶”ê°€**
   - ì£¼ìš” ê¸°ëŠ¥ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
   - í†µí•© í…ŒìŠ¤íŠ¸

4. **ì„±ëŠ¥ ìµœì í™”**
   - ë¶ˆí•„ìš”í•œ ë¦¬ë Œë”ë§ ë°©ì§€
   - ì½”ë“œ ìŠ¤í”Œë¦¬íŒ…

---

## âœ… ê²°ë¡ 

ë¦¬íŒ©í† ë§ ì‘ì—…ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. 

- **ê¸°ëŠ¥ ìœ ì§€:** âœ… ëª¨ë“  ê¸°ëŠ¥ ì •ìƒ ì‘ë™
- **ì½”ë“œ í’ˆì§ˆ:** âœ… Dead Code ì œê±° ë° ì¤‘ë³µ ì½”ë“œ í†µí•©
- **êµ¬ì¡° ê°œì„ :** âœ… ì¼ê´€ëœ ë ˆì´ì•„ì›ƒ êµ¬ì¡°

í”„ë¡œì íŠ¸ì˜ ìœ ì§€ë³´ìˆ˜ì„±ì´ í¬ê²Œ í–¥ìƒë˜ì—ˆìœ¼ë©°, í–¥í›„ ê°œë°œ ì‹œ ë” íš¨ìœ¨ì ìœ¼ë¡œ ì‘ì—…í•  ìˆ˜ ìˆëŠ” ê¸°ë°˜ì´ ë§ˆë ¨ë˜ì—ˆìŠµë‹ˆë‹¤.

---

**ì‘ì„±ì¼:** 2025-01-XX  
**ìƒíƒœ:** âœ… ì™„ë£Œ
</file>

<file path="REFACTORING_FINAL_REPORT.md">
# ë¦¬íŒ©í† ë§ ìµœì¢… ì™„ë£Œ ë³´ê³ ì„œ

## ğŸ“‹ ê°œìš”

Seoul Founders Club í”„ë¡œì íŠ¸ì˜ ì „ë©´ì ì¸ ë¦¬íŒ©í† ë§ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. 4ë‹¨ê³„ì— ê±¸ì³ ì½”ë“œ í’ˆì§ˆ, íƒ€ì… ì•ˆì „ì„±, ì„±ëŠ¥, ìœ ì§€ë³´ìˆ˜ì„±ì„ í¬ê²Œ ê°œì„ í–ˆìŠµë‹ˆë‹¤.

---

## âœ… ì™„ë£Œëœ ì‘ì—…

### Phase 1: íƒ€ì… ì•ˆì „ì„± ê°œì„ 
- **ëª©í‘œ**: `any` íƒ€ì… ì œê±° ë° ëª…ì‹œì  íƒ€ì… ì •ì˜
- **ê²°ê³¼**:
  - `lib/types/` ë””ë ‰í† ë¦¬ ìƒì„± ë° 5ê°œ íƒ€ì… íŒŒì¼ ìƒì„±
    - `profile.ts`: User, Profile, UserWithProfile ë“±
    - `events.ts`: Event, EventForDisplay, EventInsertData ë“±
    - `posts.ts`: PostForDisplay, ReviewForDisplay, BoardCategory ë“±
    - `badges.ts`: Badge, VisibleBadge, UserBadgeWithBadge ë“±
    - `home.ts`: HomePageClientProps ë“±
  - ì£¼ìš” íŒŒì¼ì— íƒ€ì… ì ìš©: `app/community/profile/page.tsx`, `components/home/home-page-client.tsx`, `lib/queries/posts.ts`, `lib/actions/events.ts`
  - **íƒ€ì… ì•ˆì „ì„±**: `any` íƒ€ì… ëŒ€í­ ê°ì†Œ

### Phase 2: ì¤‘ë³µ ì½”ë“œ ì œê±°
- **ëª©í‘œ**: ë°˜ë³µë˜ëŠ” Supabase ë°ì´í„° í˜ì¹­ ë¡œì§ì„ ì¬ì‚¬ìš© í•¨ìˆ˜ë¡œ í†µí•©
- **ê²°ê³¼**:
  - `lib/queries/profiles.ts` ìƒì„±: `getCurrentUserProfile()` í•¨ìˆ˜
  - `lib/queries/badges.ts` ìƒì„±: `getBadgesForUsers()` í•¨ìˆ˜
  - 6ê°œ íŒŒì¼ì—ì„œ ì¤‘ë³µ ë¡œì§ ì œê±° ë° ì¬ì‚¬ìš© í•¨ìˆ˜ ì ìš©
    - `app/page.tsx`
    - `components/home/home-page-client.tsx`
    - `components/sidebar-profile.tsx`
    - `app/community/profile/page.tsx`
    - `lib/queries/posts.ts`
    - `lib/actions/events.ts`
  - **ì½”ë“œ ì¤‘ë³µ**: í”„ë¡œí•„/ë±ƒì§€ í˜ì¹­ ë¡œì§ ì¤‘ì•™í™”

### Phase 3: ë°ì´í„° í˜ì¹­ ìµœì í™”
- **ëª©í‘œ**: `SELECT *` ì œê±° ë° í•„ìš”í•œ í•„ë“œë§Œ ëª…ì‹œì ìœ¼ë¡œ ì„ íƒ
- **ê²°ê³¼**:
  - 13ê°œ íŒŒì¼ì—ì„œ `select("*")` ì œê±°
    - `lib/queries/profiles.ts`
    - `app/admin/page.tsx` (profiles, events, posts)
    - `app/admin/users/page.tsx`
    - `app/admin/events/page.tsx`
    - `app/admin/roles/page.tsx`
    - `components/sidebar.tsx`
    - `app/community/board/[slug]/page.tsx`
    - `app/events/[id]/manage/page.tsx`
    - `app/events/[id]/edit/page.tsx`
    - `app/community/board/[slug]/[id]/page.tsx`
    - `app/community/board/[slug]/new/page.tsx`
    - `app/community/board/event-requests/new/page.tsx`
    - `components/register-button.tsx`
  - **ì„±ëŠ¥ ê°œì„ **: ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½ ê°ì†Œ, DB ì¿¼ë¦¬ ìµœì í™”

### Phase 4: ìµœì¢… ì •ë¦¬ ë° ì•ˆì •í™”
- **ëª©í‘œ**: Production-ready ìƒíƒœë¡œ ì •ë¦¬
- **ê²°ê³¼**:
  - **Console.log ì •ë¦¬**: ê°œë°œ í™˜ê²½ì—ì„œë§Œ ì‹¤í–‰ë˜ë„ë¡ ìˆ˜ì • (6ê°œ íŒŒì¼)
    - `app/community/board/[slug]/page.tsx`
    - `lib/queries/posts.ts` (2ê°œ)
    - `lib/auth/server.ts` (2ê°œ)
    - `lib/supabase/server.ts` (2ê°œ)
    - `components/event-share-button.tsx`
  - **TODO ì£¼ì„ ì •ë¦¬**: `app/community/page.tsx`ì˜ TODO ì£¼ì„ì„ ì„¤ëª… ì£¼ì„ìœ¼ë¡œ ë³€ê²½
  - **Debug í˜ì´ì§€ ì ‘ê·¼ ì œí•œ**: ìš´ì˜ í™˜ê²½ì—ì„œ ì ‘ê·¼ ì°¨ë‹¨ ê°•í™”
    - `app/debug/page.tsx`: Production í™˜ê²½ì—ì„œ ì ‘ê·¼ ë¶ˆê°€ ë©”ì‹œì§€ í‘œì‹œ
  - **ì—ëŸ¬ ë¡œê¹… ìœ ì§€**: `console.error`ëŠ” ì—ëŸ¬ ì¶”ì ì„ ìœ„í•´ ìœ ì§€

---

## ğŸ“Š ê°œì„  ì§€í‘œ

### ì½”ë“œ í’ˆì§ˆ
- âœ… íƒ€ì… ì•ˆì „ì„±: `any` íƒ€ì… ëŒ€í­ ê°ì†Œ
- âœ… ì½”ë“œ ì¤‘ë³µ: í”„ë¡œí•„/ë±ƒì§€ í˜ì¹­ ë¡œì§ ì¤‘ì•™í™”
- âœ… ì¿¼ë¦¬ ìµœì í™”: `SELECT *` â†’ ëª…ì‹œì  í•„ë“œ ì„ íƒ

### ì„±ëŠ¥
- âœ… ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½ ê°ì†Œ: ë¶ˆí•„ìš”í•œ ë°ì´í„° ì „ì†¡ ì œê±°
- âœ… DB ì¿¼ë¦¬ ìµœì í™”: í•„ìš”í•œ í•„ë“œë§Œ ì¡°íšŒ

### ìœ ì§€ë³´ìˆ˜ì„±
- âœ… ì¬ì‚¬ìš© ê°€ëŠ¥í•œ í•¨ìˆ˜: `getCurrentUserProfile`, `getBadgesForUsers`
- âœ… ëª…ì‹œì  íƒ€ì… ì •ì˜: `lib/types/` ë””ë ‰í† ë¦¬ êµ¬ì¡°í™”
- âœ… ê¹”ë”í•œ ì½”ë“œ: Console.log ì •ë¦¬, TODO ì •ë¦¬

### ë³´ì•ˆ
- âœ… Debug í˜ì´ì§€ ì ‘ê·¼ ì œí•œ: ìš´ì˜ í™˜ê²½ì—ì„œ ì°¨ë‹¨
- âœ… ê°œë°œ ë¡œê·¸ ì œê±°: Production ë¹Œë“œì—ì„œ ë¶ˆí•„ìš”í•œ ë¡œê·¸ ì œê±°

---

## ğŸ¯ ë¹Œë“œ ê²°ê³¼

### ìµœì¢… ë¹Œë“œ ìƒíƒœ
```
âœ“ Compiled successfully
âœ“ Collecting page data using 23 workers
âœ“ Generating static pages using 23 workers (35/35)
âœ“ Finalizing page optimization
```

### ìƒì„±ëœ í˜ì´ì§€
- ì´ 35ê°œ í˜ì´ì§€ ì •ìƒ ìƒì„±
- ëª¨ë“  ë¼ìš°íŠ¸ ì •ìƒ ì‘ë™
- íƒ€ì… ì˜¤ë¥˜ ì—†ìŒ
- ëŸ°íƒ€ì„ ì˜¤ë¥˜ ì—†ìŒ

---

## ğŸ“ ì£¼ìš” ë³€ê²½ íŒŒì¼

### ìƒˆë¡œ ìƒì„±ëœ íŒŒì¼
- `lib/types/profile.ts`
- `lib/types/events.ts`
- `lib/types/posts.ts`
- `lib/types/badges.ts`
- `lib/types/home.ts`
- `lib/queries/profiles.ts`
- `lib/queries/badges.ts`

### ì£¼ìš” ìˆ˜ì • íŒŒì¼
- `app/page.tsx`
- `components/home/home-page-client.tsx`
- `components/sidebar-profile.tsx`
- `app/community/profile/page.tsx`
- `lib/queries/posts.ts`
- `lib/actions/events.ts`
- `app/admin/**/*.tsx` (3ê°œ íŒŒì¼)
- `app/community/board/**/*.tsx` (4ê°œ íŒŒì¼)
- `app/events/**/*.tsx` (2ê°œ íŒŒì¼)
- `lib/auth/server.ts`
- `lib/supabase/server.ts`
- `app/debug/page.tsx`

---

## ğŸš€ ë°°í¬ ì¤€ë¹„ ìƒíƒœ

### âœ… ì™„ë£Œëœ í•­ëª©
- [x] íƒ€ì… ì•ˆì „ì„± ê°œì„ 
- [x] ì½”ë“œ ì¤‘ë³µ ì œê±°
- [x] ë°ì´í„° í˜ì¹­ ìµœì í™”
- [x] Console.log ì •ë¦¬
- [x] TODO ì£¼ì„ ì •ë¦¬
- [x] Debug í˜ì´ì§€ ì ‘ê·¼ ì œí•œ
- [x] ë¹Œë“œ ì„±ê³µ í™•ì¸
- [x] ëª¨ë“  ê¸°ëŠ¥ ì •ìƒ ì‘ë™ í™•ì¸

### ğŸ“ ê¶Œì¥ ì‚¬í•­
1. **í™˜ê²½ ë³€ìˆ˜ í™•ì¸**: Production í™˜ê²½ì—ì„œ ëª¨ë“  í™˜ê²½ ë³€ìˆ˜ê°€ ì˜¬ë°”ë¥´ê²Œ ì„¤ì •ë˜ì—ˆëŠ”ì§€ í™•ì¸
2. **RLS ì •ì±… ê²€í† **: Supabase RLS ì •ì±…ì´ Production í™˜ê²½ì—ì„œë„ ì •ìƒ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸
3. **ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§**: ë°°í¬ í›„ ì‹¤ì œ ì‚¬ìš©ëŸ‰ì— ë”°ë¥¸ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ê¶Œì¥
4. **ì—ëŸ¬ ì¶”ì **: `console.error` ë¡œê·¸ë¥¼ ì—ëŸ¬ ì¶”ì  ì„œë¹„ìŠ¤(ì˜ˆ: Sentry)ì™€ ì—°ë™ ê³ ë ¤

---

## ğŸ‰ ê²°ë¡ 

4ë‹¨ê³„ ë¦¬íŒ©í† ë§ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìœ¼ë©°, í”„ë¡œì íŠ¸ëŠ” **Production-ready** ìƒíƒœì…ë‹ˆë‹¤.

- âœ… íƒ€ì… ì•ˆì „ì„± í–¥ìƒ
- âœ… ì½”ë“œ í’ˆì§ˆ ê°œì„ 
- âœ… ì„±ëŠ¥ ìµœì í™”
- âœ… ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ
- âœ… ë³´ì•ˆ ê°•í™”

ëª¨ë“  ê¸°ëŠ¥ì´ ì •ìƒ ì‘ë™í•˜ë©°, ë¹Œë“œë„ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë°°í¬ ì¤€ë¹„ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ğŸš€
</file>

<file path="REFACTORING_PHASE3_4_REPORT.md">
# âœ… Phase 3 & 4 ë¦¬íŒ©í† ë§ ì™„ë£Œ ë³´ê³ ì„œ

**ì‹¤í–‰ì¼:** 2025-01-XX  
**ì‹¤í–‰ì:** ì‹œë‹ˆì–´ í…Œí¬ ë¦¬ë“œ  
**í”„ë¡œì íŠ¸:** Seoul Founders Club (SFC)

---

## ğŸ“‹ ì‹¤í–‰ ìš”ì•½

Phase 3 (íƒ€ì… ì•ˆì „ì„± ê°•í™”)ì™€ Phase 4 (ì—ëŸ¬ ì²˜ë¦¬ ê°•í™”) ì‘ì—…ì„ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤.

---

## âœ… Phase 3: íƒ€ì… ì•ˆì „ì„± ê°•í™” (ì™„ë£Œ)

### 1. íƒ€ì… ì •ì˜ ë³´ì™„

#### ìƒˆë¡œ ìƒì„±ëœ íƒ€ì… íŒŒì¼
- âœ… `lib/types/unsplash.ts` - Unsplash API íƒ€ì… ì •ì˜
  - `UnsplashImage` íƒ€ì…
  - `UnsplashSearchResponse` íƒ€ì…

### 2. `any` íƒ€ì… ì œê±°

#### ìˆ˜ì •ëœ íŒŒì¼

| íŒŒì¼ | ë³€ê²½ ì‚¬í•­ | Before | After |
|------|-----------|--------|-------|
| âœ… `app/community/page.tsx` | `post: any` ì œê±° | `(post: any)` | `(post: PostForDisplay)` |
| âœ… `components/new-event-form.tsx` | `unsplashResults: any[]` ì œê±° | `any[]` | `UnsplashImage[]` |
| âœ… `components/new-event-form.tsx` | `error: any` ì œê±° | `error: any` | `error` (íƒ€ì… ì¶”ë¡ ) |
| âœ… `components/register-button.tsx` | `error: any` ì œê±° (3ê³³) | `error: any` | `error` (íƒ€ì… ì¶”ë¡ ) |

**ê°œì„  íš¨ê³¼:**
- íƒ€ì… ì•ˆì „ì„± í–¥ìƒ
- ì»´íŒŒì¼ íƒ€ì„ ì—ëŸ¬ ê°ì§€ ê°€ëŠ¥
- IDE ìë™ì™„ì„± ë° íƒ€ì… ì²´í¬ ê°œì„ 

### 3. íƒ€ì… ì ìš©

- âœ… `app/actions/unsplash.ts` - ë°˜í™˜ íƒ€ì… ëª…ì‹œ (`UnsplashSearchResponse`)
- âœ… `app/community/page.tsx` - `PostForDisplay` íƒ€ì… import ë° ì‚¬ìš©

---

## âœ… Phase 4: ì—ëŸ¬ ì²˜ë¦¬ ê°•í™” (ì™„ë£Œ)

### 1. ì „ì—­ ì—ëŸ¬ í˜ì´ì§€ ìƒì„±

#### ìƒˆë¡œ ìƒì„±ëœ íŒŒì¼

| íŒŒì¼ | ìš©ë„ | ê¸°ëŠ¥ |
|------|------|------|
| âœ… `app/error.tsx` | í˜ì´ì§€ ë ˆë²¨ ì—ëŸ¬ ì²˜ë¦¬ | "ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤" ì•ˆë‚´ + ë‹¤ì‹œ ì‹œë„ ë²„íŠ¼ |
| âœ… `app/global-error.tsx` | ì•± ì „ì²´ ì—ëŸ¬ ì²˜ë¦¬ | ì‹¬ê°í•œ ì˜¤ë¥˜ ë°œìƒ ì‹œ ì•ˆë‚´ + ë‹¤ì‹œ ì‹œë„ ë²„íŠ¼ |

**íŠ¹ì§•:**
- ì‚¬ìš©ì ì¹œí™”ì  ì—ëŸ¬ ë©”ì‹œì§€
- "ë‹¤ì‹œ ì‹œë„" ë²„íŠ¼ ì œê³µ
- "í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°" ë²„íŠ¼ ì œê³µ
- ì—ëŸ¬ ì½”ë“œ í‘œì‹œ (digest)

### 2. Toast ì‹œìŠ¤í…œ í†µí•©

#### Toaster ì»´í¬ë„ŒíŠ¸ ì¶”ê°€
- âœ… `app/layout.tsx`ì— `<Toaster />` ì¶”ê°€
- ì „ì—­ì ìœ¼ë¡œ toast ì•Œë¦¼ ì‚¬ìš© ê°€ëŠ¥

### 3. `alert()` â†’ `toast()` ë³€ê²½

#### ìˆ˜ì •ëœ íŒŒì¼

| íŒŒì¼ | ë³€ê²½ëœ alert ê°œìˆ˜ | ë³€ê²½ ë‚´ìš© |
|------|------------------|-----------|
| âœ… `components/new-event-form.tsx` | 4ê°œ | ì´ë¯¸ì§€ ì—…ë¡œë“œ, ê²€ìƒ‰, ì œì¶œ ê²€ì¦, ì—ëŸ¬ ì²˜ë¦¬ |
| âœ… `components/register-button.tsx` | 10ê°œ | ì‚¬ìš©ì ì‹ ì²­, ê²ŒìŠ¤íŠ¸ ì‹ ì²­, ì·¨ì†Œ ì‹œ ëª¨ë“  ê²€ì¦ ë° ì—ëŸ¬ ì²˜ë¦¬ |

**ë³€ê²½ ì˜ˆì‹œ:**

**Before:**
```tsx
alert("ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨")
```

**After:**
```tsx
toast({
  variant: "destructive",
  title: "ì—…ë¡œë“œ ì‹¤íŒ¨",
  description: "ì´ë¯¸ì§€ ì—…ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.",
})
```

**ê°œì„  íš¨ê³¼:**
- âœ… ë” ì„¸ë ¨ëœ UI/UX
- âœ… ì¼ê´€ëœ ì—ëŸ¬ ë©”ì‹œì§€ ìŠ¤íƒ€ì¼
- âœ… ì‚¬ìš©ìê°€ ê³„ì† ì‘ì—…í•  ìˆ˜ ìˆìŒ (alertëŠ” ë¸”ë¡œí‚¹)
- âœ… ìš°ì¸¡ í•˜ë‹¨ì— í‘œì‹œë˜ì–´ ë°©í•´ê°€ ì ìŒ

---

## ğŸ“Š ìµœì¢… ê²°ê³¼

### íƒ€ì… ì•ˆì „ì„±
- **`any` íƒ€ì… ì œê±°:** 5ê³³
- **ìƒˆ íƒ€ì… ì •ì˜:** 1ê°œ íŒŒì¼ (`unsplash.ts`)
- **íƒ€ì… ì ìš©:** 3ê°œ íŒŒì¼

### ì—ëŸ¬ ì²˜ë¦¬
- **ì—ëŸ¬ í˜ì´ì§€ ìƒì„±:** 2ê°œ (`error.tsx`, `global-error.tsx`)
- **alert â†’ toast ë³€ê²½:** 14ê°œ
- **Toaster í†µí•©:** ì™„ë£Œ

### ì½”ë“œ í’ˆì§ˆ
- âœ… íƒ€ì… ì•ˆì „ì„± í–¥ìƒ
- âœ… ì‚¬ìš©ì ê²½í—˜ ê°œì„ 
- âœ… ì¼ê´€ëœ ì—ëŸ¬ ì²˜ë¦¬ íŒ¨í„´

---

## ğŸ” ê²€ì¦ ì™„ë£Œ ì‚¬í•­

### Linter ê²€ì¦
- âœ… ëª¨ë“  ìˆ˜ì •ëœ íŒŒì¼ì—ì„œ linter ì˜¤ë¥˜ ì—†ìŒ

### íƒ€ì… ê²€ì¦
- âœ… `any` íƒ€ì… ì œê±° í™•ì¸
- âœ… íƒ€ì… ì •ì˜ ì •í™•ì„± í™•ì¸

### ê¸°ëŠ¥ ê²€ì¦
- âœ… Toast ì‹œìŠ¤í…œ ì •ìƒ ì‘ë™ í™•ì¸
- âœ… ì—ëŸ¬ í˜ì´ì§€ êµ¬ì¡° í™•ì¸

---

## ğŸ“ ë³€ê²½ ì‚¬í•­ ìƒì„¸

### 1. íƒ€ì… ì •ì˜ ì¶”ê°€ (`lib/types/unsplash.ts`)

```typescript
export type UnsplashImage = {
  id: string
  urls: {
    thumb: string
    small: string
    regular: string
    full: string
  }
  alt_description: string | null
  description: string | null
  width: number
  height: number
  user: {
    name: string
    username: string
  }
}

export type UnsplashSearchResponse = {
  success: boolean
  results?: UnsplashImage[]
  error?: string
}
```

### 2. ì—ëŸ¬ í˜ì´ì§€ (`app/error.tsx`)

- Next.jsì˜ `error.tsx` í‘œì¤€ íŒ¨í„´ ì‚¬ìš©
- `reset()` í•¨ìˆ˜ë¡œ ì—ëŸ¬ ë³µêµ¬ ì‹œë„
- ì‚¬ìš©ì ì¹œí™”ì  UI

### 3. ê¸€ë¡œë²Œ ì—ëŸ¬ í˜ì´ì§€ (`app/global-error.tsx`)

- ì•± ì „ì²´ ì—ëŸ¬ ì²˜ë¦¬
- `html` ë° `body` íƒœê·¸ í¬í•¨ (í•„ìˆ˜)
- ì‹¬ê°í•œ ì˜¤ë¥˜ì— ëŒ€í•œ ì•ˆë‚´

### 4. Toast í†µí•©

**`app/layout.tsx` ë³€ê²½:**
```tsx
import { Toaster } from "@/components/ui/toaster"

// ...
<Providers>
  <DailyLoginChecker />
  {children}
  <MobileActionBar />
  <Toaster /> {/* ì¶”ê°€ */}
</Providers>
```

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

### í…ŒìŠ¤íŠ¸ ê¶Œì¥ ì‚¬í•­

ë‹¤ìŒ ê¸°ëŠ¥ë“¤ì„ ì‹¤ì œë¡œ í…ŒìŠ¤íŠ¸í•´ë³´ì‹œê¸° ë°”ëë‹ˆë‹¤:

1. **Toast ì•Œë¦¼**
   - [ ] ì´ë²¤íŠ¸ ìƒì„± ì‹œ ì—ëŸ¬ ë°œìƒ â†’ toast í‘œì‹œ í™•ì¸
   - [ ] ì´ë²¤íŠ¸ ì°¸ê°€ ì‹ ì²­ ì‹œ ì—ëŸ¬ ë°œìƒ â†’ toast í‘œì‹œ í™•ì¸
   - [ ] ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨ â†’ toast í‘œì‹œ í™•ì¸

2. **ì—ëŸ¬ í˜ì´ì§€**
   - [ ] ì˜ë„ì ìœ¼ë¡œ ì—ëŸ¬ ë°œìƒ ì‹œì¼œì„œ `error.tsx` í‘œì‹œ í™•ì¸
   - [ ] "ë‹¤ì‹œ ì‹œë„" ë²„íŠ¼ ì‘ë™ í™•ì¸
   - [ ] "í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°" ë²„íŠ¼ ì‘ë™ í™•ì¸

3. **íƒ€ì… ì•ˆì „ì„±**
   - [ ] TypeScript ì»´íŒŒì¼ ì˜¤ë¥˜ ì—†ìŒ í™•ì¸
   - [ ] IDE ìë™ì™„ì„± ì •ìƒ ì‘ë™ í™•ì¸

---

## ğŸ¯ ê°œì„  íš¨ê³¼

### ê°œë°œì ê²½í—˜
- âœ… íƒ€ì… ì•ˆì „ì„± í–¥ìƒìœ¼ë¡œ ë²„ê·¸ ì‚¬ì „ ë°©ì§€
- âœ… IDE ìë™ì™„ì„± ë° íƒ€ì… ì²´í¬ ê°œì„ 
- âœ… ì—ëŸ¬ ì²˜ë¦¬ íŒ¨í„´ í†µì¼

### ì‚¬ìš©ì ê²½í—˜
- âœ… ì„¸ë ¨ëœ toast ì•Œë¦¼ (alert ëŒ€ì‹ )
- âœ… ì—ëŸ¬ ë°œìƒ ì‹œ ëª…í™•í•œ ì•ˆë‚´
- âœ… ì¬ì‹œë„ ê¸°ëŠ¥ ì œê³µ

---

## âœ… ê²°ë¡ 

Phase 3ì™€ Phase 4 ì‘ì—…ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.

- **íƒ€ì… ì•ˆì „ì„±:** âœ… `any` íƒ€ì… ì œê±° ë° ëª…í™•í•œ íƒ€ì… ì •ì˜
- **ì—ëŸ¬ ì²˜ë¦¬:** âœ… ì „ì—­ ì—ëŸ¬ í˜ì´ì§€ ë° toast ì‹œìŠ¤í…œ í†µí•©
- **ì‚¬ìš©ì ê²½í—˜:** âœ… ê°œì„ ëœ ì—ëŸ¬ ì•Œë¦¼ ë° ì•ˆë‚´

í”„ë¡œì íŠ¸ì˜ ì•ˆì •ì„±ê³¼ ì‚¬ìš©ì ê²½í—˜ì´ í¬ê²Œ í–¥ìƒë˜ì—ˆìŠµë‹ˆë‹¤.

---

**ì‘ì„±ì¼:** 2025-01-XX  
**ìƒíƒœ:** âœ… ì™„ë£Œ
</file>

<file path="REFACTORING_PLAN.md">
# ğŸ”§ SFC í”„ë¡œì íŠ¸ ë¦¬íŒ©í† ë§ ê³„íšì„œ

## ğŸ“Š ë¶„ì„ ê²°ê³¼ ìš”ì•½

### 1. Dead Code (ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” íŒŒì¼)

#### ì™„ì „íˆ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” íŒŒì¼
- âœ… `app/home-page-content.tsx` - ì–´ë””ì„œë„ importë˜ì§€ ì•ŠìŒ
- âœ… `app/community/_components/latest-posts-section.tsx` - ì‚¬ìš©ë˜ì§€ ì•ŠìŒ
- âœ… `app/community/_components/latest-post-item.tsx` - ì‚¬ìš©ë˜ì§€ ì•ŠìŒ
- âœ… `app/api/debug/` - ë¹ˆ ë””ë ‰í† ë¦¬
- âœ… `components/ui/use-mobile.tsx` - `hooks/use-mobile.ts`ì™€ ì¤‘ë³µ
- âœ… `components/ui/use-toast.ts` - `hooks/use-toast.ts`ì™€ ì¤‘ë³µ

### 2. ì¤‘ë³µ ì½”ë“œ íŒ¨í„´

#### A. ì¤‘ë³µ ì»´í¬ë„ŒíŠ¸
1. **EventsSection ì¤‘ë³µ**
   - `app/community/_components/events-section.tsx` (ê°„ë‹¨í•œ ë²„ì „)
   - `components/home/events-section.tsx` (ì™„ì „í•œ ë²„ì „, Swiper í¬í•¨)
   - **í•´ê²°**: `components/home/events-section.tsx`ë§Œ ìœ ì§€í•˜ê³  ë‹¤ë¥¸ ê³³ì—ì„œ ì¬ì‚¬ìš©

2. **PostsSection ì¤‘ë³µ**
   - `app/community/_components/posts-section.tsx` (ê°„ë‹¨í•œ ë²„ì „)
   - `components/home/posts-section.tsx` (ì™„ì „í•œ ë²„ì „, ìŠ¤ì¼ˆë ˆí†¤ í¬í•¨)
   - **í•´ê²°**: `components/home/posts-section.tsx`ë§Œ ìœ ì§€í•˜ê³  ë‹¤ë¥¸ ê³³ì—ì„œ ì¬ì‚¬ìš©

#### B. ì¤‘ë³µ ì¸ì¦ ì²´í¬ íŒ¨í„´ (41ê³³ì—ì„œ ë°˜ë³µ)
```typescript
// ì´ íŒ¨í„´ì´ 41ê³³ì—ì„œ ë°˜ë³µë¨
const supabase = await createClient()
const { data: { user } } = await supabase.auth.getUser()
if (!user) {
  redirect("/auth/login")
}
```
**í•´ê²°**: `lib/auth/server.ts`ì— `requireAuth()` í—¬í¼ í•¨ìˆ˜ ìƒì„±

#### C. ì¤‘ë³µ ê´€ë¦¬ì ê¶Œí•œ ì²´í¬ íŒ¨í„´
```typescript
// ì´ íŒ¨í„´ì´ ì—¬ëŸ¬ ê³³ì—ì„œ ë°˜ë³µë¨
const { data: profile } = await supabase
  .from("profiles")
  .select("role, email")
  .eq("id", user.id)
  .single()
if (!profile || !isAdmin(profile.role, profile.email)) {
  redirect("/")
}
```
**í•´ê²°**: `lib/auth/server.ts`ì— `requireAdmin()` í—¬í¼ í•¨ìˆ˜ ìƒì„±

#### D. ì¤‘ë³µ ë°ì´í„° í˜ì¹­ íŒ¨í„´
1. **ê³µì§€ì‚¬í•­ í˜ì¹­** - ì—¬ëŸ¬ í˜ì´ì§€ì—ì„œ ë™ì¼í•œ ì¿¼ë¦¬ ë°˜ë³µ
2. **ì´ë²¤íŠ¸ í˜ì¹­** - ì—¬ëŸ¬ í˜ì´ì§€ì—ì„œ ìœ ì‚¬í•œ ì¿¼ë¦¬ ë°˜ë³µ
3. **ê²Œì‹œê¸€ í˜ì¹­** - ì—¬ëŸ¬ í˜ì´ì§€ì—ì„œ ìœ ì‚¬í•œ ì¿¼ë¦¬ ë°˜ë³µ
**í•´ê²°**: `lib/queries/` ë””ë ‰í† ë¦¬ì— ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ì¿¼ë¦¬ í•¨ìˆ˜ ìƒì„±

### 3. êµ¬ì¡°ì  ë¬¸ì œ

#### A. ì»´í¬ë„ŒíŠ¸ ìœ„ì¹˜ í˜¼ì¬
- `app/community/_components/` - í˜ì´ì§€ë³„ ì»´í¬ë„ŒíŠ¸
- `components/home/` - í™ˆ ê´€ë ¨ ì»´í¬ë„ŒíŠ¸
- **ë¬¸ì œ**: ê°™ì€ ê¸°ëŠ¥ì˜ ì»´í¬ë„ŒíŠ¸ê°€ ì—¬ëŸ¬ ê³³ì— ë¶„ì‚°
- **í•´ê²°**: ê³µí†µ ì»´í¬ë„ŒíŠ¸ëŠ” `components/`ì—, í˜ì´ì§€ë³„ ì»´í¬ë„ŒíŠ¸ë§Œ `app/*/_components/`ì—

#### B. í´ë¼ì´ì–¸íŠ¸/ì„œë²„ ì»´í¬ë„ŒíŠ¸ í˜¼ì¬
- `app/page.tsx` - í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ (ë°ì´í„° í˜ì¹­ì„ í´ë¼ì´ì–¸íŠ¸ì—ì„œ)
- `app/community/page.tsx` - ì„œë²„ ì»´í¬ë„ŒíŠ¸ (ë°ì´í„° í˜ì¹­ì„ ì„œë²„ì—ì„œ)
- **ë¬¸ì œ**: ë™ì¼í•œ ê¸°ëŠ¥ì´ì§€ë§Œ ë‹¤ë¥¸ ë°©ì‹ìœ¼ë¡œ êµ¬í˜„
- **í•´ê²°**: ê°€ëŠ¥í•œ í•œ ì„œë²„ ì»´í¬ë„ŒíŠ¸ë¡œ í†µì¼

## ğŸ¯ ë¦¬íŒ©í† ë§ ì‹¤í–‰ ê³„íš

### Phase 1: Dead Code ì œê±° (ì•ˆì „)
1. âœ… `app/home-page-content.tsx` ì‚­ì œ
2. âœ… `app/community/_components/latest-posts-section.tsx` ì‚­ì œ
3. âœ… `app/community/_components/latest-post-item.tsx` ì‚­ì œ
4. âœ… `components/ui/use-mobile.tsx` ì‚­ì œ (hooks ë²„ì „ ì‚¬ìš©)
5. âœ… `components/ui/use-toast.ts` ì‚­ì œ (hooks ë²„ì „ ì‚¬ìš©)
6. âœ… `app/api/debug/` ë¹ˆ ë””ë ‰í† ë¦¬ í™•ì¸ í›„ ì‚­ì œ

### Phase 2: ì¤‘ë³µ ì»´í¬ë„ŒíŠ¸ í†µí•©
1. âœ… `app/community/_components/events-section.tsx` ì‚­ì œ
   - `app/community/page.tsx`ì—ì„œ `components/home/events-section.tsx` ì‚¬ìš©í•˜ë„ë¡ ìˆ˜ì •
2. âœ… `app/community/_components/posts-section.tsx` ì‚­ì œ
   - `app/community/page.tsx`ì—ì„œ `components/home/posts-section.tsx` ì‚¬ìš©í•˜ë„ë¡ ìˆ˜ì •

### Phase 3: ì¸ì¦ í—¬í¼ í•¨ìˆ˜ ìƒì„±
1. âœ… `lib/auth/server.ts` ìƒì„±
   - `requireAuth()` - ë¡œê·¸ì¸ í•„ìˆ˜ í˜ì´ì§€ìš©
   - `requireAdmin()` - ê´€ë¦¬ì ê¶Œí•œ í•„ìˆ˜ í˜ì´ì§€ìš©
   - `getUser()` - ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸° (ì„ íƒì )
2. âœ… ëª¨ë“  í˜ì´ì§€ì—ì„œ ì¤‘ë³µ ì¸ì¦ ì½”ë“œë¥¼ í—¬í¼ í•¨ìˆ˜ë¡œ êµì²´

### Phase 4: ë°ì´í„° í˜ì¹­ í•¨ìˆ˜ ëª¨ë“ˆí™”
1. âœ… `lib/queries/announcements.ts` - ê³µì§€ì‚¬í•­ ì¿¼ë¦¬
2. âœ… `lib/queries/events.ts` - ì´ë²¤íŠ¸ ì¿¼ë¦¬
3. âœ… `lib/queries/posts.ts` - ê²Œì‹œê¸€ ì¿¼ë¦¬
4. âœ… `lib/queries/board-categories.ts` - ê²Œì‹œíŒ ì¹´í…Œê³ ë¦¬ ì¿¼ë¦¬
5. âœ… ëª¨ë“  í˜ì´ì§€ì—ì„œ ì¤‘ë³µ ì¿¼ë¦¬ë¥¼ ëª¨ë“ˆí™”ëœ í•¨ìˆ˜ë¡œ êµì²´

### Phase 5: êµ¬ì¡° ì •ë¦¬
1. âœ… `app/community/_components/` ì •ë¦¬
   - ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ì»´í¬ë„ŒíŠ¸ ì‚­ì œ
   - ë‚¨ì€ ì»´í¬ë„ŒíŠ¸ëŠ” ì‹¤ì œë¡œ í˜ì´ì§€ë³„ë¡œ í•„ìš”í•œ ê²ƒë§Œ ìœ ì§€
2. âœ… ì»´í¬ë„ŒíŠ¸ import ê²½ë¡œ ì •ë¦¬

## âš ï¸ ì£¼ì˜ì‚¬í•­

1. **ê¸°ëŠ¥ ìœ ì§€**: ëª¨ë“  ë¦¬íŒ©í† ë§ì€ ê¸°ì¡´ ê¸°ëŠ¥ì„ 100% ìœ ì§€í•´ì•¼ í•¨
2. **ë‹¨ê³„ì  ì§„í–‰**: í•œ ë²ˆì— ëª¨ë“  ê²ƒì„ ë°”ê¾¸ì§€ ì•Šê³  ë‹¨ê³„ë³„ë¡œ ì§„í–‰
3. **í…ŒìŠ¤íŠ¸**: ê° ë‹¨ê³„ë§ˆë‹¤ ì£¼ìš” ê¸°ëŠ¥ì´ ì •ìƒ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸
4. **ì‚­ì œ ì „ ê²€ì¦**: íŒŒì¼ ì‚­ì œ ì „ì— grepìœ¼ë¡œ ì°¸ì¡° ì—¬ë¶€ ì¬í™•ì¸

## ğŸ“ ì˜ˆìƒ íš¨ê³¼

1. **ì½”ë“œ ë¼ì¸ ìˆ˜ ê°ì†Œ**: ì•½ 500-800 ë¼ì¸ ê°ì†Œ ì˜ˆìƒ
2. **ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ**: ì¤‘ë³µ ì½”ë“œ ì œê±°ë¡œ ë²„ê·¸ ìˆ˜ì •ì´ í•œ ê³³ì—ì„œë§Œ í•„ìš”
3. **ì¼ê´€ì„± í–¥ìƒ**: ì¸ì¦/ë°ì´í„° í˜ì¹­ íŒ¨í„´ í†µì¼
4. **ì„±ëŠ¥ ê°œì„ **: ë¶ˆí•„ìš”í•œ ì½”ë“œ ì œê±°ë¡œ ë²ˆë“¤ í¬ê¸° ê°ì†Œ

## ğŸš€ ì‹¤í–‰ ìˆœì„œ

1. Phase 1 ì‹¤í–‰ (Dead Code ì œê±°)
2. Phase 2 ì‹¤í–‰ (ì¤‘ë³µ ì»´í¬ë„ŒíŠ¸ í†µí•©)
3. Phase 3 ì‹¤í–‰ (ì¸ì¦ í—¬í¼ ìƒì„±)
4. Phase 4 ì‹¤í–‰ (ë°ì´í„° í˜ì¹­ ëª¨ë“ˆí™”)
5. Phase 5 ì‹¤í–‰ (êµ¬ì¡° ì •ë¦¬)

ê° PhaseëŠ” ë…ë¦½ì ìœ¼ë¡œ ì‹¤í–‰ ê°€ëŠ¥í•˜ë©°, ì¤‘ê°„ì— ë¬¸ì œê°€ ë°œìƒí•˜ë©´ í•´ë‹¹ Phaseë§Œ ë¡¤ë°± ê°€ëŠ¥í•©ë‹ˆë‹¤.
</file>

<file path="RLS_FIX_INSTRUCTIONS.md">
# RLS ì •ì±… ë³µêµ¬ ê°€ì´ë“œ

## ğŸ¯ ëª©ì 

`getLatestReviews` í•¨ìˆ˜ì—ì„œ ë°œìƒí•˜ëŠ” RLS ì¶©ëŒ ë¬¸ì œë¥¼ í•´ê²°í•˜ì—¬, ìµëª… ì‚¬ìš©ì(ë¹„ë¡œê·¸ì¸ ìƒíƒœ)ë„ í›„ê¸° ë°ì´í„°ë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.

## ğŸ“‹ ë¬¸ì œ ì›ì¸

`getLatestReviews` í•¨ìˆ˜ëŠ” ë‹¤ìŒ í…Œì´ë¸”ë“¤ì„ JOINí•©ë‹ˆë‹¤:
- `posts` (ê²Œì‹œê¸€)
- `board_categories` (ì¹´í…Œê³ ë¦¬)
- `events` (ê´€ë ¨ ì´ë²¤íŠ¸)
- `profiles` (ì‘ì„±ì í”„ë¡œí•„)

ìµëª… ì‚¬ìš©ìê°€ ì´ ë³µì¡í•œ JOIN ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•  ë•Œ, **í•˜ë‚˜ë¼ë„ SELECT ê¶Œí•œì´ ì—†ìœ¼ë©´ ì „ì²´ ì¿¼ë¦¬ê°€ ì‹¤íŒ¨**í•©ë‹ˆë‹¤.

## âœ… í•´ê²° ë°©ë²•

### 1ë‹¨ê³„: Supabase Dashboard ì ‘ì†

1. [Supabase Dashboard](https://supabase.com/dashboard) ì ‘ì†
2. í”„ë¡œì íŠ¸ ì„ íƒ
3. ì¢Œì¸¡ ë©”ë‰´ì—ì„œ **SQL Editor** í´ë¦­

### 2ë‹¨ê³„: RLS ì •ì±… ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰

1. **New Query** ë²„íŠ¼ í´ë¦­
2. ì•„ë˜ íŒŒì¼ì˜ ë‚´ìš©ì„ ë³µì‚¬í•˜ì—¬ ë¶™ì—¬ë„£ê¸°:
   - `scripts/026_fix_rls_visibility.sql`
3. **Run** ë²„íŠ¼ í´ë¦­ (ë˜ëŠ” `Ctrl + Enter`)

### 3ë‹¨ê³„: ì •ì±… í™•ì¸

ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ í›„, ìë™ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” í™•ì¸ ì¿¼ë¦¬ ê²°ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš”:

- ëª¨ë“  í…Œì´ë¸”ì— `âœ… Public Access`ê°€ í‘œì‹œë˜ì–´ì•¼ í•©ë‹ˆë‹¤
- `access_type` ì»¬ëŸ¼ì—ì„œ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤

### 4ë‹¨ê³„: ìµëª… ì‚¬ìš©ì ì ‘ê·¼ í…ŒìŠ¤íŠ¸ (ì„ íƒì‚¬í•­)

1. SQL Editorì—ì„œ **"Run as"** ë“œë¡­ë‹¤ìš´ ì„ íƒ
2. **"anon"** ì„ íƒ (ìµëª… ì‚¬ìš©ìë¡œ ì‹¤í–‰)
3. ì•„ë˜ í…ŒìŠ¤íŠ¸ ì¿¼ë¦¬ ì‹¤í–‰:

```sql
-- getLatestReviewsì™€ ë™ì¼í•œ ì¿¼ë¦¬ êµ¬ì¡° í…ŒìŠ¤íŠ¸
SELECT 
  p.id,
  p.title,
  p.content,
  p.created_at,
  profiles:author_id(id, full_name, avatar_url),
  events:related_event_id(id, title, thumbnail_url),
  board_categories!inner(name, slug)
FROM public.posts p
WHERE board_categories.slug = 'reviews'
LIMIT 10;
```

**ì˜ˆìƒ ê²°ê³¼**: ë°ì´í„°ê°€ ì •ìƒì ìœ¼ë¡œ ë°˜í™˜ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.

## ğŸ” ë¬¸ì œ í•´ê²° í™•ì¸

### ì„±ê³µ ê¸°ì¤€

1. âœ… ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ì™„ë£Œ (ì—ëŸ¬ ì—†ìŒ)
2. âœ… í™•ì¸ ì¿¼ë¦¬ì—ì„œ ëª¨ë“  í…Œì´ë¸”ì´ `âœ… Public Access` í‘œì‹œ
3. âœ… ìµëª… ì‚¬ìš©ì í…ŒìŠ¤íŠ¸ ì¿¼ë¦¬ì—ì„œ ë°ì´í„° ë°˜í™˜
4. âœ… ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ `/about` í˜ì´ì§€ ì •ìƒ ë¡œë“œ
5. âœ… í™ˆ í˜ì´ì§€ì—ì„œ "ëª¨ì„ í›„ê¸°" ì„¹ì…˜ ì •ìƒ í‘œì‹œ

### ì—¬ì „íˆ ë¬¸ì œê°€ ë°œìƒí•˜ëŠ” ê²½ìš°

1. **RLSê°€ ë¹„í™œì„±í™”ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸**:
   ```sql
   SELECT tablename, rowsecurity 
   FROM pg_tables 
   WHERE schemaname = 'public' 
   AND tablename IN ('events', 'posts', 'profiles', 'event_registrations', 'board_categories', 'comments');
   ```
   - `rowsecurity = true`ì—¬ì•¼ í•©ë‹ˆë‹¤

2. **ì •ì±…ì´ ì‹¤ì œë¡œ ì ìš©ë˜ì—ˆëŠ”ì§€ í™•ì¸**:
   ```sql
   SELECT tablename, policyname, cmd, qual
   FROM pg_policies
   WHERE schemaname = 'public'
   AND tablename IN ('events', 'posts', 'profiles', 'event_registrations', 'board_categories', 'comments')
   AND cmd = 'SELECT';
   ```

3. **ìµëª… ì‚¬ìš©ìë¡œ ì§ì ‘ í…ŒìŠ¤íŠ¸**:
   - SQL Editorì—ì„œ "Run as" â†’ "anon" ì„ íƒ
   - ê° í…Œì´ë¸”ë³„ë¡œ SELECT ì¿¼ë¦¬ ì‹¤í–‰

## ğŸ“ ì°¸ê³ ì‚¬í•­

- ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” **ê³µê°œ ë°ì´í„°ë§Œ** ì¡°íšŒ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤
- ë¯¼ê°í•œ ì •ë³´(ë¹„ë°€ë²ˆí˜¸, ê°œì¸ì •ë³´ ë“±)ëŠ” ì´ë¯¸ ë‹¤ë¥¸ ë°©ì‹ìœ¼ë¡œ ë³´í˜¸ë˜ì–´ ìˆìŠµë‹ˆë‹¤
- `board_categories`ëŠ” `is_active = true`ì¸ ê²½ìš°ë§Œ ì¡°íšŒ ê°€ëŠ¥í•©ë‹ˆë‹¤ (ë¹„í™œì„± ì¹´í…Œê³ ë¦¬ ìˆ¨ê¹€)

## ğŸš¨ ì£¼ì˜ì‚¬í•­

- ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ì „ì— **ë°±ì—…**ì„ ê¶Œì¥í•©ë‹ˆë‹¤
- í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œëŠ” ì‹¤í–‰ ì „ì— **í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œ ë¨¼ì € ê²€ì¦**í•˜ì„¸ìš”
- ìŠ¤í¬ë¦½íŠ¸ëŠ” **ê¸°ì¡´ ì •ì±…ì„ ëª¨ë‘ ì‚­ì œ**í•˜ê³  ìƒˆë¡œ ìƒì„±í•©ë‹ˆë‹¤
</file>

<file path="scripts/001_create_tables.sql">
-- Seoul Founders Club ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ
-- ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” í”„ë¡œí•„, ê²Œì‹œê¸€, ëŒ“ê¸€, ì´ë²¤íŠ¸, ë“±ë¡ ì •ë³´ë¥¼ í¬í•¨í•©ë‹ˆë‹¤.

-- í”„ë¡œí•„ í…Œì´ë¸”ì— ì»¬ëŸ¼ ì¶”ê°€
create table if not exists public.profiles (
  id uuid primary key references auth.users(id) on delete cascade,
  email text not null,
  full_name text,
  avatar_url text,
  bio text,
  created_at timestamptz default now() not null,
  updated_at timestamptz default now() not null
);

-- ê²Œì‹œê¸€ í…Œì´ë¸”ì— category ì»¬ëŸ¼ ì¶”ê°€ (announcement ë˜ëŠ” discussion)
create table if not exists public.posts (
  id uuid primary key default gen_random_uuid(),
  title text not null,
  content text not null,
  category text not null check (category in ('announcement', 'discussion')),
  author_id uuid references public.profiles(id) on delete cascade not null,
  created_at timestamptz default now() not null,
  updated_at timestamptz default now() not null,
  likes_count int default 0 not null,
  comments_count int default 0 not null
);

-- ëŒ“ê¸€ í…Œì´ë¸”
create table if not exists public.comments (
  id uuid primary key default gen_random_uuid(),
  post_id uuid references public.posts(id) on delete cascade not null,
  author_id uuid references public.profiles(id) on delete cascade not null,
  content text not null,
  created_at timestamptz default now() not null,
  updated_at timestamptz default now() not null
);

-- ì´ë²¤íŠ¸ í…Œì´ë¸”ì— thumbnail_url, max_participants, created_by ì¶”ê°€
create table if not exists public.events (
  id uuid primary key default gen_random_uuid(),
  title text not null,
  description text not null,
  event_date timestamptz not null,
  location text not null,
  thumbnail_url text,
  max_participants int,
  created_by uuid references public.profiles(id) on delete cascade not null,
  created_at timestamptz default now() not null,
  updated_at timestamptz default now() not null
);

-- ì´ë²¤íŠ¸ ì°¸ê°€ ë“±ë¡ í…Œì´ë¸”
create table if not exists public.event_registrations (
  id uuid primary key default gen_random_uuid(),
  event_id uuid references public.events(id) on delete cascade not null,
  user_id uuid references public.profiles(id) on delete cascade not null,
  registered_at timestamptz default now() not null,
  unique(event_id, user_id)
);

-- ê²Œì‹œê¸€ ì¢‹ì•„ìš” í…Œì´ë¸”
create table if not exists public.post_likes (
  id uuid primary key default gen_random_uuid(),
  post_id uuid references public.posts(id) on delete cascade not null,
  user_id uuid references public.profiles(id) on delete cascade not null,
  created_at timestamptz default now() not null,
  unique(post_id, user_id)
);

-- Row Level Security í™œì„±í™”
alter table public.profiles enable row level security;
alter table public.posts enable row level security;
alter table public.comments enable row level security;
alter table public.events enable row level security;
alter table public.event_registrations enable row level security;
alter table public.post_likes enable row level security;

-- í”„ë¡œí•„ ì •ì±…
create policy "Public profiles are viewable by everyone"
  on public.profiles for select
  using (true);

create policy "Users can insert their own profile"
  on public.profiles for insert
  with check (auth.uid() = id);

create policy "Users can update their own profile"
  on public.profiles for update
  using (auth.uid() = id);

-- ê²Œì‹œê¸€ ì •ì±…
create policy "Posts are viewable by everyone"
  on public.posts for select
  using (true);

create policy "Authenticated users can create posts"
  on public.posts for insert
  with check (auth.uid() = author_id);

create policy "Users can update their own posts"
  on public.posts for update
  using (auth.uid() = author_id);

create policy "Users can delete their own posts"
  on public.posts for delete
  using (auth.uid() = author_id);

-- ëŒ“ê¸€ ì •ì±…
create policy "Comments are viewable by everyone"
  on public.comments for select
  using (true);

create policy "Authenticated users can create comments"
  on public.comments for insert
  with check (auth.uid() = author_id);

create policy "Users can update their own comments"
  on public.comments for update
  using (auth.uid() = author_id);

create policy "Users can delete their own comments"
  on public.comments for delete
  using (auth.uid() = author_id);

-- ì´ë²¤íŠ¸ ì •ì±…
create policy "Events are viewable by everyone"
  on public.events for select
  using (true);

create policy "Authenticated users can create events"
  on public.events for insert
  with check (auth.uid() = created_by);

create policy "Users can update their own events"
  on public.events for update
  using (auth.uid() = created_by);

create policy "Users can delete their own events"
  on public.events for delete
  using (auth.uid() = created_by);

-- ì´ë²¤íŠ¸ ë“±ë¡ ì •ì±…
create policy "Event registrations are viewable by everyone"
  on public.event_registrations for select
  using (true);

create policy "Authenticated users can register for events"
  on public.event_registrations for insert
  with check (auth.uid() = user_id);

create policy "Users can cancel their own registrations"
  on public.event_registrations for delete
  using (auth.uid() = user_id);

-- ê²Œì‹œê¸€ ì¢‹ì•„ìš” ì •ì±…
create policy "Post likes are viewable by everyone"
  on public.post_likes for select
  using (true);

create policy "Authenticated users can like posts"
  on public.post_likes for insert
  with check (auth.uid() = user_id);

create policy "Users can unlike posts"
  on public.post_likes for delete
  using (auth.uid() = user_id);
</file>

<file path="scripts/002_create_profile_trigger.sql">
-- ìƒˆ ì‚¬ìš©ì ê°€ì…ì‹œ í”„ë¡œí•„ ìë™ ìƒì„± íŠ¸ë¦¬ê±° (ê°œì„  ë²„ì „)
-- role í•„ë“œ ì¶”ê°€ ë° ë” ì™„ì „í•œ ë©”íƒ€ë°ì´í„° ì²˜ë¦¬

create or replace function public.handle_new_user()
returns trigger
language plpgsql
security definer
set search_path = public
as $$
begin
  insert into public.profiles (
    id, 
    email, 
    full_name, 
    avatar_url, 
    role
  )
  values (
    new.id,
    new.email,
    coalesce(
      new.raw_user_meta_data->>'full_name',
      new.raw_user_meta_data->>'name',
      split_part(new.email, '@', 1)
    ),
    coalesce(
      new.raw_user_meta_data->>'avatar_url',
      new.raw_user_meta_data->>'picture',
      null
    ),
    coalesce(
      new.raw_user_meta_data->>'role',
      'member'
    )
  )
  on conflict (id) do update
  set
    full_name = coalesce(excluded.full_name, profiles.full_name),
    avatar_url = coalesce(excluded.avatar_url, profiles.avatar_url),
    role = coalesce(excluded.role, profiles.role),
    email = coalesce(excluded.email, profiles.email);
  
  return new;
end;
$$;

-- íŠ¸ë¦¬ê±° ìƒì„± (ê¸°ì¡´ íŠ¸ë¦¬ê±°ê°€ ìˆìœ¼ë©´ ì‚­ì œ í›„ ìƒì„±)
drop trigger if exists on_auth_user_created on auth.users;

create trigger on_auth_user_created
  after insert on auth.users
  for each row
  execute function public.handle_new_user();
</file>

<file path="scripts/003_seed_sample_data.sql">
-- Seoul Founders Club ìƒ˜í”Œ ë°ì´í„°
-- ì°½ì—…/AI ê´€ë ¨ ì´ë²¤íŠ¸

-- ì£¼ì˜: ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” êµ¬ê¸€ ë¡œê·¸ì¸ í›„ ì‹¤í–‰í•´ì•¼ í•©ë‹ˆë‹¤.
-- ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì˜ IDê°€ ìë™ìœ¼ë¡œ í”„ë¡œí•„ í…Œì´ë¸”ì— ì¶”ê°€ë©ë‹ˆë‹¤.

-- ì•„ë˜ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ê¸° ì „ì—:
-- 1. êµ¬ê¸€ë¡œ ë¡œê·¸ì¸í•˜ì„¸ìš”
-- 2. ë¡œê·¸ì¸ í›„ ìƒì„±ëœ í”„ë¡œí•„ IDë¥¼ í™•ì¸í•˜ì„¸ìš”
-- 3. ì•„ë˜ 'ë³¸ì¸ì˜-UUID-ì…ë ¥'ì„ ì‹¤ì œ UUIDë¡œ ë³€ê²½í•˜ì„¸ìš”

-- ì‹¤ì œ ë¡œê·¸ì¸í•œ ì‚¬ìš©ì IDë¡œ ì´ë²¤íŠ¸ ìƒì„±
-- created_byë¥¼ ë³¸ì¸ì˜ í”„ë¡œí•„ IDë¡œ ë³€ê²½í•˜ì„¸ìš”
/*
INSERT INTO events (title, description, event_date, location, thumbnail_url, max_participants, created_by)
VALUES
  (
    'AI ìŠ¤íƒ€íŠ¸ì—… ì°½ì—…ì ë°‹ì—… Vol.12',
    'AI ê¸°ìˆ ì„ í™œìš©í•œ ìŠ¤íƒ€íŠ¸ì—… ì°½ì—…ìë“¤ì´ ëª¨ì—¬ ë„¤íŠ¸ì›Œí‚¹í•˜ê³  ì¸ì‚¬ì´íŠ¸ë¥¼ ê³µìœ í•˜ëŠ” ëª¨ì„ì…ë‹ˆë‹¤. ê°ìì˜ í”„ë¡œì íŠ¸ë¥¼ ì†Œê°œí•˜ê³ , AI íŠ¸ë Œë“œì— ëŒ€í•´ í† ë¡ í•©ë‹ˆë‹¤.

ì£¼ìš” ì•„ì  ë‹¤:
â€¢ AI ìµœì‹  íŠ¸ë Œë“œ ê³µìœ 
â€¢ ìŠ¤íƒ€íŠ¸ì—… í”¼ì¹­ (5ë¶„ì”©)
â€¢ ë„¤íŠ¸ì›Œí‚¹ ì‹œê°„
â€¢ Q&A ì„¸ì…˜

ì°¸ì„ ëŒ€ìƒ:
AI ê´€ë ¨ ì°½ì—…ì„ ì¤€ë¹„ ì¤‘ì´ê±°ë‚˜ ì´ë¯¸ ìš´ì˜ ì¤‘ì¸ ë¶„ë“¤ì„ í™˜ì˜í•©ë‹ˆë‹¤!',
    '2025-01-25 19:00:00+09',
    'ê°•ë‚¨ì—­ ìŠ¤íƒ€íŠ¸ì—… í—ˆë¸Œ 5ì¸µ',
    '/placeholder.svg?height=400&width=600',
    30,
    'ë³¸ì¸ì˜-UUID-ì…ë ¥'  -- ì—¬ê¸°ì— ë³¸ì¸ì˜ í”„ë¡œí•„ IDë¥¼ ì…ë ¥í•˜ì„¸ìš”
  ),
  (
    'ì´ˆê¸° ìŠ¤íƒ€íŠ¸ì—…ì„ ìœ„í•œ VC íˆ¬ì ìœ ì¹˜ ì „ëµ',
    'ë²¤ì²˜ìºí”¼íƒˆ íˆ¬ì ìœ ì¹˜ì˜ A to Zë¥¼ ë°°ìš°ëŠ” ì‹¤ì „ ì›Œí¬ìƒµì…ë‹ˆë‹¤. í˜„ì§ VCê°€ ì§ì ‘ ì•Œë ¤ì£¼ëŠ” íˆ¬ì ìœ ì¹˜ ì „ëµê³¼ í”¼ì¹­ ë…¸í•˜ìš°ë¥¼ ê³µìœ í•©ë‹ˆë‹¤.

ì›Œí¬ìƒµ ë‚´ìš©:
â€¢ VCì˜ ì˜ì‚¬ê²°ì • í”„ë¡œì„¸ìŠ¤ ì´í•´í•˜ê¸°
â€¢ íš¨ê³¼ì ì¸ í”¼ì¹˜ë± ì‘ì„±ë²•
â€¢ íˆ¬ì ê³„ì•½ì„œ í•µì‹¬ í¬ì¸íŠ¸
â€¢ 1:1 í”¼ë“œë°± ì„¸ì…˜

ì¤€ë¹„ë¬¼:
ìì‹ ì˜ í”¼ì¹˜ë±ì´ë‚˜ ì‚¬ì—…ê³„íšì„œ (ì„ íƒì‚¬í•­)',
    '2025-01-28 14:00:00+09',
    'ì—­ì‚¼ maru180 ì„¸ë¯¸ë‚˜ì‹¤',
    '/placeholder.svg?height=400&width=600',
    50,
    'ë³¸ì¸ì˜-UUID-ì…ë ¥'
  ),
  (
    'ChatGPT APIë¥¼ í™œìš©í•œ ì„œë¹„ìŠ¤ ê°œë°œ í•´ì»¤í†¤',
    '2ë°• 3ì¼ê°„ ì§„í–‰ë˜ëŠ” AI í•´ì»¤í†¤! ChatGPT APIë¥¼ í™œìš©í•˜ì—¬ í˜ì‹ ì ì¸ ì„œë¹„ìŠ¤ë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”.

í•´ì»¤í†¤ ìƒì„¸:
â€¢ ê¸°ê°„: 2025ë…„ 2ì›” 7ì¼(ê¸ˆ) ì €ë… - 2ì›” 9ì¼(ì¼) ì˜¤í›„
â€¢ íŒ€ êµ¬ì„±: 3-5ëª… (í˜„ì¥ì—ì„œë„ íŒ€ ë¹Œë”© ê°€ëŠ¥)
â€¢ ìƒê¸ˆ: 1ë“± 300ë§Œì›, 2ë“± 150ë§Œì›, 3ë“± 50ë§Œì›
â€¢ ì œê³µ: ì‹ì‚¬, ê°„ì‹, ê°œë°œ ê³µê°„

ì‹¬ì‚¬ ê¸°ì¤€:
ì°½ì˜ì„±, ê¸°ìˆ ë ¥, ì™„ì„±ë„, ì‹œì¥ì„±',
    '2025-02-07 18:00:00+09',
    'íŒêµ í…Œí¬ë…¸ë°¸ë¦¬ ì´ë…¸ë² ì´ì…˜ ì„¼í„°',
    '/placeholder.svg?height=400&width=600',
    100,
    'ë³¸ì¸ì˜-UUID-ì…ë ¥'
  ),
  (
    'ì œë¡œë² ì´ìŠ¤ ì°½ì—… ë¶€íŠ¸ìº í”„ (6ì£¼ ê³¼ì •)',
    'ì•„ì´ë””ì–´ë§Œ ìˆë‹¤ë©´ OK! ì´ˆê¸° ì°½ì—…ìë¥¼ ìœ„í•œ 6ì£¼ ì§‘ì¤‘ ë¶€íŠ¸ìº í”„ì…ë‹ˆë‹¤. ë§¤ì£¼ í† ìš”ì¼ ì˜¤í›„ì— ì§„í–‰ë˜ë©°, ë©˜í† ë§ê³¼ ì‹¤ì „ ê³¼ì œë¥¼ í†µí•´ ì°½ì—… ì—­ëŸ‰ì„ í‚¤ì›ë‹ˆë‹¤.

ì»¤ë¦¬í˜ëŸ¼:
Week 1: ë¬¸ì œ ì •ì˜ & ê³ ê° ì¸í„°ë·°
Week 2: ë¹„ì¦ˆë‹ˆìŠ¤ ëª¨ë¸ ì„¤ê³„
Week 3: MVP ê°œë°œ ì „ëµ
Week 4: ë§ˆì¼€íŒ… & ê·¸ë¡œìŠ¤í•´í‚¹
Week 5: íˆ¬ì ìœ ì¹˜ ì¤€ë¹„
Week 6: ìµœì¢… í”¼ì¹­ & ë°ëª¨ë°ì´

í˜œíƒ:
â€¢ í˜„ì—… ë©˜í†  1:1 ë§¤ì¹­
â€¢ í˜‘ì—… ê³µê°„ ë¬´ë£Œ ì œê³µ
â€¢ íˆ¬ìì ë„¤íŠ¸ì›Œí‚¹ ê¸°íšŒ',
    '2025-02-15 14:00:00+09',
    'ì„œìš¸ì°½ì—…í—ˆë¸Œ (ì„ì§€ë¡œ)',
    '/placeholder.svg?height=400&width=600',
    25,
    'ë³¸ì¸ì˜-UUID-ì…ë ¥'
  ),
  (
    'LLM íŒŒì¸íŠœë‹ ì‹¤ì „ ì›Œí¬ìƒµ',
    'ëŒ€ê·œëª¨ ì–¸ì–´ ëª¨ë¸(LLM)ì„ ë‚´ ì„œë¹„ìŠ¤ì— ë§ê²Œ íŒŒì¸íŠœë‹í•˜ëŠ” ë°©ë²•ì„ ë°°ìš°ëŠ” í•¸ì¦ˆì˜¨ ì›Œí¬ìƒµì…ë‹ˆë‹¤.

í•™ìŠµ ë‚´ìš©:
â€¢ LLM ê¸°ì´ˆ ì´ë¡ 
â€¢ íŒŒì¸íŠœë‹ vs í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§
â€¢ Hugging Face Transformers ì‹¤ìŠµ
â€¢ ìì²´ ë°ì´í„°ì…‹ìœ¼ë¡œ ëª¨ë¸ í•™ìŠµí•˜ê¸°
â€¢ ì‹¤ì „ ë°°í¬ ì „ëµ

ëŒ€ìƒ:
Python ê¸°ì´ˆ ì§€ì‹ì´ ìˆëŠ” ê°œë°œì ë˜ëŠ” AIì— ê´€ì‹¬ ìˆëŠ” ê¸°ìˆ  ì°½ì—…ì

ì¤€ë¹„ë¬¼:
ë…¸íŠ¸ë¶ (GPU ë¶ˆí•„ìš”, í´ë¼ìš°ë“œ í™˜ê²½ ì œê³µ)',
    '2025-02-20 10:00:00+09',
    'ì„ ë¦‰ì—­ AI ì—°êµ¬ì†Œ',
    '/placeholder.svg?height=400&width=600',
    40,
    'ë³¸ì¸ì˜-UUID-ì…ë ¥'
  ),
  (
    'ì„±ê³µí•œ ì°½ì—…ìë“¤ê³¼ì˜ ì €ë… ì‹ì‚¬',
    'ì—‘ì‹¯ ê²½í—˜ì´ ìˆê±°ë‚˜ Series B ì´ìƒ íˆ¬ìë¥¼ ìœ ì¹˜í•œ ì„ ë°° ì°½ì—…ìë“¤ê³¼ í•¨ê»˜í•˜ëŠ” í”„ë¼ì´ë¹— ë””ë„ˆ ëª¨ì„ì…ë‹ˆë‹¤.

ì´ˆì²­ ê²ŒìŠ¤íŠ¸:
â€¢ AI ì—ë“€í…Œí¬ ìŠ¤íƒ€íŠ¸ì—… ëŒ€í‘œ (Series C, 500ì–µ ë°¸ë¥˜)
â€¢ B2B SaaS ìŠ¤íƒ€íŠ¸ì—… ëŒ€í‘œ (M&A ì—‘ì‹¯ ê²½í—˜)
â€¢ í•€í…Œí¬ ìœ ë‹ˆì½˜ ê³µë™ì°½ì—…ì

í˜•ì‹:
ì†Œê·œëª¨ í…Œì´ë¸” ë””ìŠ¤ì»¤ì…˜ í˜•íƒœë¡œ ì§„í–‰ë˜ë©°, ììœ ë¡œìš´ ì§ˆì˜ì‘ë‹µê³¼ ë„¤íŠ¸ì›Œí‚¹ ì‹œê°„ì´ ìˆìŠµë‹ˆë‹¤.

ì°¸ê°€ë¹„:
5ë§Œì› (ì‹ì‚¬ ì œê³µ)',
    '2025-03-05 18:30:00+09',
    'ê°•ë‚¨ í”„ë¦¬ë¯¸ì—„ ë ˆìŠ¤í† ë‘',
    '/placeholder.svg?height=400&width=600',
    20,
    'ë³¸ì¸ì˜-UUID-ì…ë ¥'
  );

-- ê³µì§€ì‚¬í•­ ê²Œì‹œê¸€ ìƒ˜í”Œ ìƒì„±
INSERT INTO posts (title, content, category, author_id)
VALUES
  (
    'Seoul Founders Clubì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!',
    'ì•ˆë…•í•˜ì„¸ìš”, SFC ìš´ì˜íŒ€ì…ë‹ˆë‹¤.

ì„œìš¸ íŒŒìš´ë”ìŠ¤ í´ëŸ½ì€ ì°½ì—…ê°€ë“¤ì´ ëª¨ì—¬ ì„œë¡œì˜ ê²½í—˜ì„ ë‚˜ëˆ„ê³ , í•¨ê»˜ ì„±ì¥í•˜ëŠ” ì»¤ë®¤ë‹ˆí‹°ì…ë‹ˆë‹¤.

**ì»¤ë®¤ë‹ˆí‹° ê°€ì´ë“œë¼ì¸**

1. ì„œë¡œ ì¡´ì¤‘í•˜ê³  ë°°ë ¤í•˜ëŠ” ë¬¸í™”ë¥¼ ë§Œë“¤ì–´ì£¼ì„¸ìš”
2. ìŠ¤íŒ¸ì„± í™ë³´ ê¸€ì€ ìì œí•´ì£¼ì„¸ìš”
3. ê¶ê¸ˆí•œ ì ì€ ììœ ë¡­ê²Œ ì§ˆë¬¸í•˜ì„¸ìš”
4. ì¢‹ì€ ì •ë³´ëŠ” ì ê·¹ì ìœ¼ë¡œ ê³µìœ í•´ì£¼ì„¸ìš”

**í™œë™ ë°©ë²•**

â€¢ ê³µì§€ì‚¬í•­: ì¤‘ìš”í•œ ì•ˆë‚´ì‚¬í•­ì„ í™•ì¸í•˜ì„¸ìš”
â€¢ ììœ ê²Œì‹œíŒ: ììœ ë¡­ê²Œ ì˜ê²¬ì„ ë‚˜ëˆ„ì„¸ìš”
â€¢ ì´ë²¤íŠ¸: ë‹¤ì–‘í•œ ëª¨ì„ê³¼ í–‰ì‚¬ì— ì°¸ì—¬í•˜ì„¸ìš”

í•¨ê»˜ ì„±ì¥í•˜ëŠ” ì»¤ë®¤ë‹ˆí‹°ë¥¼ ë§Œë“¤ì–´ê°‘ì‹œë‹¤!',
    'announcement',
    'ë³¸ì¸ì˜-UUID-ì…ë ¥'
  ),
  (
    '2025ë…„ 1-2ì›” ì£¼ìš” ì´ë²¤íŠ¸ ì•ˆë‚´',
    'ìƒˆí•´ë¥¼ ë§ì•„ ë‹¤ì–‘í•œ ì´ë²¤íŠ¸ë¥¼ ì¤€ë¹„í–ˆìŠµë‹ˆë‹¤!

**1ì›” ì¼ì •**
â€¢ 1/25 (í† ) - AI ìŠ¤íƒ€íŠ¸ì—… ì°½ì—…ì ë°‹ì—…
â€¢ 1/28 (í™”) - VC íˆ¬ì ìœ ì¹˜ ì „ëµ ì›Œí¬ìƒµ

**2ì›” ì¼ì •**
â€¢ 2/7-9 - ChatGPT í•´ì»¤í†¤
â€¢ 2/15 (í† ) - ì œë¡œë² ì´ìŠ¤ ì°½ì—… ë¶€íŠ¸ìº í”„ ì‹œì‘
â€¢ 2/20 (ëª©) - LLM íŒŒì¸íŠœë‹ ì›Œí¬ìƒµ

**3ì›” ì¼ì •**
â€¢ 3/5 (ìˆ˜) - ì„±ê³µí•œ ì°½ì—…ìë“¤ê³¼ì˜ ì €ë… ì‹ì‚¬

ìì„¸í•œ ë‚´ìš©ì€ ì´ë²¤íŠ¸ í˜ì´ì§€ë¥¼ ì°¸ê³ í•´ì£¼ì„¸ìš”!',
    'announcement',
    'ë³¸ì¸ì˜-UUID-ì…ë ¥'
  );
*/

-- ìœ„ ì£¼ì„ì„ í•´ì œí•˜ê³  'ë³¸ì¸ì˜-UUID-ì…ë ¥'ì„ ì‹¤ì œ UUIDë¡œ ë³€ê²½í•œ í›„ ì‹¤í–‰í•˜ì„¸ìš”.
-- ë³¸ì¸ì˜ UUIDëŠ” êµ¬ê¸€ ë¡œê·¸ì¸ í›„ í”„ë¡œí•„ í˜ì´ì§€ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
</file>

<file path="scripts/003-add-membership-tiers.sql">
-- Add membership tier column to profiles table
ALTER TABLE profiles ADD COLUMN IF NOT EXISTS membership_tier TEXT DEFAULT 'basic' CHECK (membership_tier IN ('basic', 'plus', 'pro', 'master'));

-- Create index for membership queries
CREATE INDEX IF NOT EXISTS idx_profiles_membership_tier ON profiles(membership_tier);

-- Set jaewook@mvmt.city as master admin
UPDATE profiles 
SET role = 'master', membership_tier = 'master'
WHERE email = 'jaewook@mvmt.city';

-- Add comment for documentation
COMMENT ON COLUMN profiles.membership_tier IS 'Membership tier: basic (free), plus, pro, master';
</file>

<file path="scripts/006_add_points_and_admin.sql">
-- í¬ì¸íŠ¸ ë° ê´€ë¦¬ì ê¸°ëŠ¥ ì¶”ê°€

-- profiles í…Œì´ë¸”ì— í¬ì¸íŠ¸ ë° ê´€ë¦¬ì ê´€ë ¨ ì»¬ëŸ¼ ì¶”ê°€
ALTER TABLE profiles 
ADD COLUMN IF NOT EXISTS points INTEGER DEFAULT 0,
ADD COLUMN IF NOT EXISTS role TEXT DEFAULT 'member',
ADD COLUMN IF NOT EXISTS last_login_date DATE;

-- í¬ì¸íŠ¸ ê±°ë˜ ë‚´ì—­ í…Œì´ë¸” ìƒì„±
CREATE TABLE IF NOT EXISTS point_transactions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES profiles(id) ON DELETE CASCADE,
  amount INTEGER NOT NULL,
  type TEXT NOT NULL, -- 'daily_login', 'event_participation', 'event_completion', 'event_payment'
  description TEXT,
  related_event_id UUID REFERENCES events(id) ON DELETE SET NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- ì´ë²¤íŠ¸ ì°¸ì—¬ì ì¶”ê°€ ì •ë³´ í…Œì´ë¸” (ì»¤ìŠ¤í…€ í•„ë“œ)
CREATE TABLE IF NOT EXISTS event_registration_fields (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  event_id UUID NOT NULL REFERENCES events(id) ON DELETE CASCADE,
  field_name TEXT NOT NULL,
  field_type TEXT NOT NULL, -- 'text', 'email', 'phone', 'select', 'checkbox'
  field_options JSONB, -- select/checkbox ì˜µì…˜
  is_required BOOLEAN DEFAULT false,
  order_index INTEGER DEFAULT 0,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- ì´ë²¤íŠ¸ ì°¸ì—¬ì ì‘ë‹µ í…Œì´ë¸”
CREATE TABLE IF NOT EXISTS event_registration_responses (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  registration_id UUID NOT NULL REFERENCES event_registrations(id) ON DELETE CASCADE,
  field_id UUID NOT NULL REFERENCES event_registration_fields(id) ON DELETE CASCADE,
  response_value TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(registration_id, field_id)
);

-- ê²Œì‹œíŒ ì¹´í…Œê³ ë¦¬ í…Œì´ë¸”
CREATE TABLE IF NOT EXISTS board_categories (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name TEXT NOT NULL,
  slug TEXT NOT NULL UNIQUE,
  description TEXT,
  order_index INTEGER DEFAULT 0,
  is_active BOOLEAN DEFAULT true,
  created_by UUID REFERENCES profiles(id) ON DELETE SET NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- events í…Œì´ë¸”ì— ìƒíƒœ ë° í¬ì¸íŠ¸ ì»¬ëŸ¼ ì¶”ê°€
ALTER TABLE events
ADD COLUMN IF NOT EXISTS status TEXT DEFAULT 'upcoming', -- 'upcoming', 'completed', 'cancelled'
ADD COLUMN IF NOT EXISTS point_cost INTEGER DEFAULT 0;

-- RLS ì •ì±… ì„¤ì •
ALTER TABLE point_transactions ENABLE ROW LEVEL SECURITY;
ALTER TABLE event_registration_fields ENABLE ROW LEVEL SECURITY;
ALTER TABLE event_registration_responses ENABLE ROW LEVEL SECURITY;
ALTER TABLE board_categories ENABLE ROW LEVEL SECURITY;

-- point_transactions ì •ì±…
CREATE POLICY "Users can view their own transactions" ON point_transactions
  FOR SELECT USING (auth.uid() = user_id);

CREATE POLICY "System can insert transactions" ON point_transactions
  FOR INSERT WITH CHECK (true);

-- event_registration_fields ì •ì±…
CREATE POLICY "Anyone can view event registration fields" ON event_registration_fields
  FOR SELECT USING (true);

CREATE POLICY "Event creators can manage fields" ON event_registration_fields
  FOR ALL USING (
    EXISTS (
      SELECT 1 FROM events WHERE events.id = event_registration_fields.event_id AND events.created_by = auth.uid()
    )
  );

-- event_registration_responses ì •ì±…
CREATE POLICY "Users can view their own responses" ON event_registration_responses
  FOR SELECT USING (
    EXISTS (
      SELECT 1 FROM event_registrations WHERE event_registrations.id = event_registration_responses.registration_id AND event_registrations.user_id = auth.uid()
    )
  );

CREATE POLICY "Event creators can view all responses" ON event_registration_responses
  FOR SELECT USING (
    EXISTS (
      SELECT 1 FROM event_registrations 
      JOIN events ON events.id = event_registrations.event_id 
      WHERE event_registrations.id = event_registration_responses.registration_id 
      AND events.created_by = auth.uid()
    )
  );

CREATE POLICY "Registered users can submit responses" ON event_registration_responses
  FOR INSERT WITH CHECK (
    EXISTS (
      SELECT 1 FROM event_registrations WHERE event_registrations.id = event_registration_responses.registration_id AND event_registrations.user_id = auth.uid()
    )
  );

-- board_categories ì •ì±…
CREATE POLICY "Anyone can view active categories" ON board_categories
  FOR SELECT USING (is_active = true);

CREATE POLICY "Admins can manage categories" ON board_categories
  FOR ALL USING (
    EXISTS (
      SELECT 1 FROM profiles WHERE profiles.id = auth.uid() AND profiles.role IN ('admin', 'master')
    )
  );

-- ê¸°ë³¸ ì¹´í…Œê³ ë¦¬ ì¶”ê°€
INSERT INTO board_categories (name, slug, description, order_index)
VALUES 
  ('ê³µì§€ì‚¬í•­', 'announcements', 'ì¤‘ìš”í•œ ê³µì§€ì‚¬í•­ì„ í™•ì¸í•˜ì„¸ìš”', 1),
  ('ììœ ê²Œì‹œíŒ', 'free', 'ììœ ë¡­ê²Œ ì†Œí†µí•˜ëŠ” ê³µê°„ì…ë‹ˆë‹¤', 2)
ON CONFLICT (slug) DO NOTHING;

-- MASTER ê´€ë¦¬ì ì„¤ì • í•¨ìˆ˜
CREATE OR REPLACE FUNCTION set_master_admin()
RETURNS void AS $$
BEGIN
  UPDATE profiles 
  SET role = 'master'
  WHERE email = 'jaewook@mvmt.city';
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

-- í¬ì¸íŠ¸ ì§€ê¸‰ í•¨ìˆ˜
CREATE OR REPLACE FUNCTION award_points(
  p_user_id UUID,
  p_amount INTEGER,
  p_type TEXT,
  p_description TEXT,
  p_event_id UUID DEFAULT NULL
)
RETURNS void AS $$
BEGIN
  -- í¬ì¸íŠ¸ ì—…ë°ì´íŠ¸
  UPDATE profiles 
  SET points = points + p_amount
  WHERE id = p_user_id;
  
  -- ê±°ë˜ ë‚´ì—­ ê¸°ë¡
  INSERT INTO point_transactions (user_id, amount, type, description, related_event_id)
  VALUES (p_user_id, p_amount, p_type, p_description, p_event_id);
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

-- ì¼ì¼ ë¡œê·¸ì¸ í¬ì¸íŠ¸ ì§€ê¸‰ í•¨ìˆ˜
CREATE OR REPLACE FUNCTION check_daily_login_points()
RETURNS void AS $$
DECLARE
  current_user_id UUID := auth.uid();
  last_login DATE;
BEGIN
  IF current_user_id IS NULL THEN
    RETURN;
  END IF;
  
  SELECT last_login_date INTO last_login
  FROM profiles
  WHERE id = current_user_id;
  
  -- ì˜¤ëŠ˜ ì²« ë¡œê·¸ì¸ì´ë©´ í¬ì¸íŠ¸ ì§€ê¸‰
  IF last_login IS NULL OR last_login < CURRENT_DATE THEN
    PERFORM award_points(
      current_user_id,
      5,
      'daily_login',
      'ì¼ì¼ ë¡œê·¸ì¸ ë³´ìƒ'
    );
    
    UPDATE profiles
    SET last_login_date = CURRENT_DATE
    WHERE id = current_user_id;
  END IF;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;
</file>

<file path="scripts/007_create_sample_events.sql">
-- Seoul Founders Club ìƒ˜í”Œ ì´ë²¤íŠ¸ ìƒì„±
-- ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” í˜„ì¬ ë°ì´í„°ë² ì´ìŠ¤ì— ìˆëŠ” ì²« ë²ˆì§¸ ì‚¬ìš©ìë¥¼ ì°¾ì•„ì„œ 
-- ê·¸ ì‚¬ìš©ìì˜ ì´ë¦„ìœ¼ë¡œ ìƒ˜í”Œ ì´ë²¤íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

DO $$
DECLARE
  first_user_id uuid;
BEGIN
  -- ì²« ë²ˆì§¸ ì‚¬ìš©ì ID ì°¾ê¸°
  SELECT id INTO first_user_id FROM profiles LIMIT 1;
  
  -- ì‚¬ìš©ìê°€ ì—†ìœ¼ë©´ ì¢…ë£Œ
  IF first_user_id IS NULL THEN
    RAISE NOTICE 'í”„ë¡œí•„ì´ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € êµ¬ê¸€ ë¡œê·¸ì¸ì„ í•´ì£¼ì„¸ìš”.';
    RETURN;
  END IF;
  
  RAISE NOTICE 'ì‚¬ìš©ì ID: %', first_user_id;
  
  -- ê¸°ì¡´ ìƒ˜í”Œ ì´ë²¤íŠ¸ ì‚­ì œ (ì¤‘ë³µ ë°©ì§€)
  DELETE FROM events WHERE title LIKE '%AI ìŠ¤íƒ€íŠ¸ì—… ì°½ì—…ì ë°‹ì—…%' 
    OR title LIKE '%VC íˆ¬ì ìœ ì¹˜ ì „ëµ%'
    OR title LIKE '%ChatGPT API%'
    OR title LIKE '%ì œë¡œë² ì´ìŠ¤ ì°½ì—…%'
    OR title LIKE '%LLM íŒŒì¸íŠœë‹%'
    OR title LIKE '%ì„±ê³µí•œ ì°½ì—…ì%';
  
  -- ë‚ ì§œë¥¼ 2025ë…„ 12ì›” ~ 2026ë…„ 2ì›”ë¡œ ìˆ˜ì •í•˜ì—¬ ë¯¸ë˜ ì´ë²¤íŠ¸ë¡œ ë³€ê²½
  -- ìƒ˜í”Œ ì´ë²¤íŠ¸ ìƒì„±
  INSERT INTO events (title, description, event_date, location, thumbnail_url, max_participants, created_by)
  VALUES
    (
      'AI ìŠ¤íƒ€íŠ¸ì—… ì°½ì—…ì ë°‹ì—… Vol.12',
      'AI ê¸°ìˆ ì„ í™œìš©í•œ ìŠ¤íƒ€íŠ¸ì—… ì°½ì—…ìë“¤ì´ ëª¨ì—¬ ë„¤íŠ¸ì›Œí‚¹í•˜ê³  ì¸ì‚¬ì´íŠ¸ë¥¼ ê³µìœ í•˜ëŠ” ëª¨ì„ì…ë‹ˆë‹¤. ê°ìì˜ í”„ë¡œì íŠ¸ë¥¼ ì†Œê°œí•˜ê³ , AI íŠ¸ë Œë“œì— ëŒ€í•´ í† ë¡ í•©ë‹ˆë‹¤.

ì£¼ìš” ì•„ì  ë‹¤:
â€¢ AI ìµœì‹  íŠ¸ë Œë“œ ê³µìœ 
â€¢ ìŠ¤íƒ€íŠ¸ì—… í”¼ì¹­ (5ë¶„ì”©)
â€¢ ë„¤íŠ¸ì›Œí‚¹ ì‹œê°„
â€¢ Q&A ì„¸ì…˜

ì°¸ì„ ëŒ€ìƒ:
AI ê´€ë ¨ ì°½ì—…ì„ ì¤€ë¹„ ì¤‘ì´ê±°ë‚˜ ì´ë¯¸ ìš´ì˜ ì¤‘ì¸ ë¶„ë“¤ì„ í™˜ì˜í•©ë‹ˆë‹¤!',
      '2025-12-05 19:00:00+09',
      'ê°•ë‚¨ì—­ ìŠ¤íƒ€íŠ¸ì—… í—ˆë¸Œ 5ì¸µ',
      '/placeholder.svg?height=400&width=600',
      30,
      first_user_id
    ),
    (
      'ì´ˆê¸° ìŠ¤íƒ€íŠ¸ì—…ì„ ìœ„í•œ VC íˆ¬ì ìœ ì¹˜ ì „ëµ',
      'ë²¤ì²˜ìºí”¼íƒˆ íˆ¬ì ìœ ì¹˜ì˜ A to Zë¥¼ ë°°ìš°ëŠ” ì‹¤ì „ ì›Œí¬ìƒµì…ë‹ˆë‹¤. í˜„ì§ VCê°€ ì§ì ‘ ì•Œë ¤ì£¼ëŠ” íˆ¬ì ìœ ì¹˜ ì „ëµê³¼ í”¼ì¹­ ë…¸í•˜ìš°ë¥¼ ê³µìœ í•©ë‹ˆë‹¤.

ì›Œí¬ìƒµ ë‚´ìš©:
â€¢ VCì˜ ì˜ì‚¬ê²°ì • í”„ë¡œì„¸ìŠ¤ ì´í•´í•˜ê¸°
â€¢ íš¨ê³¼ì ì¸ í”¼ì¹˜ë± ì‘ì„±ë²•
â€¢ íˆ¬ì ê³„ì•½ì„œ í•µì‹¬ í¬ì¸íŠ¸
â€¢ 1:1 í”¼ë“œë°± ì„¸ì…˜

ì¤€ë¹„ë¬¼:
ìì‹ ì˜ í”¼ì¹˜ë±ì´ë‚˜ ì‚¬ì—…ê³„íšì„œ (ì„ íƒì‚¬í•­)',
      '2025-12-12 14:00:00+09',
      'ì—­ì‚¼ maru180 ì„¸ë¯¸ë‚˜ì‹¤',
      '/placeholder.svg?height=400&width=600',
      50,
      first_user_id
    ),
    (
      'ChatGPT APIë¥¼ í™œìš©í•œ ì„œë¹„ìŠ¤ ê°œë°œ í•´ì»¤í†¤',
      '2ë°• 3ì¼ê°„ ì§„í–‰ë˜ëŠ” AI í•´ì»¤í†¤! ChatGPT APIë¥¼ í™œìš©í•˜ì—¬ í˜ì‹ ì ì¸ ì„œë¹„ìŠ¤ë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”.

í•´ì»¤í†¤ ìƒì„¸:
â€¢ ê¸°ê°„: 2025ë…„ 12ì›” 20ì¼(ê¸ˆ) ì €ë… - 12ì›” 22ì¼(ì¼) ì˜¤í›„
â€¢ íŒ€ êµ¬ì„±: 3-5ëª… (í˜„ì¥ì—ì„œë„ íŒ€ ë¹Œë”© ê°€ëŠ¥)
â€¢ ìƒê¸ˆ: 1ë“± 300ë§Œì›, 2ë“± 150ë§Œì›, 3ë“± 50ë§Œì›
â€¢ ì œê³µ: ì‹ì‚¬, ê°„ì‹, ê°œë°œ ê³µê°„

ì‹¬ì‚¬ ê¸°ì¤€:
ì°½ì˜ì„±, ê¸°ìˆ ë ¥, ì™„ì„±ë„, ì‹œì¥ì„±',
      '2025-12-20 18:00:00+09',
      'íŒêµ í…Œí¬ë…¸ë°¸ë¦¬ ì´ë…¸ë² ì´ì…˜ ì„¼í„°',
      '/placeholder.svg?height=400&width=600',
      100,
      first_user_id
    ),
    (
      'ì œë¡œë² ì´ìŠ¤ ì°½ì—… ë¶€íŠ¸ìº í”„ (6ì£¼ ê³¼ì •)',
      'ì•„ì´ë””ì–´ë§Œ ìˆë‹¤ë©´ OK! ì´ˆê¸° ì°½ì—…ìë¥¼ ìœ„í•œ 6ì£¼ ì§‘ì¤‘ ë¶€íŠ¸ìº í”„ì…ë‹ˆë‹¤. ë§¤ì£¼ í† ìš”ì¼ ì˜¤í›„ì— ì§„í–‰ë˜ë©°, ë©˜í† ë§ê³¼ ì‹¤ì „ ê³¼ì œë¥¼ í†µí•´ ì°½ì—… ì—­ëŸ‰ì„ í‚¤ì›ë‹ˆë‹¤.

ì»¤ë¦¬í˜ëŸ¼:
Week 1: ë¬¸ì œ ì •ì˜ & ê³ ê° ì¸í„°ë·°
Week 2: ë¹„ì¦ˆë‹ˆìŠ¤ ëª¨ë¸ ì„¤ê³„
Week 3: MVP ê°œë°œ ì „ëµ
Week 4: ë§ˆì¼€íŒ… & ê·¸ë¡œìŠ¤í•´í‚¹
Week 5: íˆ¬ì ìœ ì¹˜ ì¤€ë¹„
Week 6: ìµœì¢… í”¼ì¹­ & ë°ëª¨ë°ì´

í˜œíƒ:
â€¢ í˜„ì—… ë©˜í†  1:1 ë§¤ì¹­
â€¢ í˜‘ì—… ê³µê°„ ë¬´ë£Œ ì œê³µ
â€¢ íˆ¬ìì ë„¤íŠ¸ì›Œí‚¹ ê¸°íšŒ',
      '2026-01-11 14:00:00+09',
      'ì„œìš¸ì°½ì—…í—ˆë¸Œ (ì„ì§€ë¡œ)',
      '/placeholder.svg?height=400&width=600',
      25,
      first_user_id
    ),
    (
      'LLM íŒŒì¸íŠœë‹ ì‹¤ì „ ì›Œí¬ìƒµ',
      'ëŒ€ê·œëª¨ ì–¸ì–´ ëª¨ë¸(LLM)ì„ ë‚´ ì„œë¹„ìŠ¤ì— ë§ê²Œ íŒŒì¸íŠœë‹í•˜ëŠ” ë°©ë²•ì„ ë°°ìš°ëŠ” í•¸ì¦ˆì˜¨ ì›Œí¬ìƒµì…ë‹ˆë‹¤.

í•™ìŠµ ë‚´ìš©:
â€¢ LLM ê¸°ì´ˆ ì´ë¡ 
â€¢ íŒŒì¸íŠœë‹ vs í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§
â€¢ Hugging Face Transformers ì‹¤ìŠµ
â€¢ ìì²´ ë°ì´í„°ì…‹ìœ¼ë¡œ ëª¨ë¸ í•™ìŠµí•˜ê¸°
â€¢ ì‹¤ì „ ë°°í¬ ì „ëµ

ëŒ€ìƒ:
Python ê¸°ì´ˆ ì§€ì‹ì´ ìˆëŠ” ê°œë°œì ë˜ëŠ” AIì— ê´€ì‹¬ ìˆëŠ” ê¸°ìˆ  ì°½ì—…ì

ì¤€ë¹„ë¬¼:
ë…¸íŠ¸ë¶ (GPU ë¶ˆí•„ìš”, í´ë¼ìš°ë“œ í™˜ê²½ ì œê³µ)',
      '2026-01-25 10:00:00+09',
      'ì„ ë¦‰ì—­ AI ì—°êµ¬ì†Œ',
      '/placeholder.svg?height=400&width=600',
      40,
      first_user_id
    ),
    (
      'ì„±ê³µí•œ ì°½ì—…ìë“¤ê³¼ì˜ ì €ë… ì‹ì‚¬',
      'ì—‘ì‹¯ ê²½í—˜ì´ ìˆê±°ë‚˜ Series B ì´ìƒ íˆ¬ìë¥¼ ìœ ì¹˜í•œ ì„ ë°° ì°½ì—…ìë“¤ê³¼ í•¨ê»˜í•˜ëŠ” í”„ë¼ì´ë¹— ë””ë„ˆ ëª¨ì„ì…ë‹ˆë‹¤.

ì´ˆì²­ ê²ŒìŠ¤íŠ¸:
â€¢ AI ì—ë“€í…Œí¬ ìŠ¤íƒ€íŠ¸ì—… ëŒ€í‘œ (Series C, 500ì–µ ë°¸ë¥˜)
â€¢ B2B SaaS ìŠ¤íƒ€íŠ¸ì—… ëŒ€í‘œ (M&A ì—‘ì‹¯ ê²½í—˜)
â€¢ í•€í…Œí¬ ìœ ë‹ˆì½˜ ê³µë™ì°½ì—…ì

í˜•ì‹:
ì†Œê·œëª¨ í…Œì´ë¸” ë””ìŠ¤ì»¤ì…˜ í˜•íƒœë¡œ ì§„í–‰ë˜ë©°, ììœ ë¡œìš´ ì§ˆì˜ì‘ë‹µê³¼ ë„¤íŠ¸ì›Œí‚¹ ì‹œê°„ì´ ìˆìŠµë‹ˆë‹¤.

ì°¸ê°€ë¹„:
5ë§Œì› (ì‹ì‚¬ ì œê³µ)',
      '2026-02-08 18:30:00+09',
      'ê°•ë‚¨ í”„ë¦¬ë¯¸ì—„ ë ˆìŠ¤í† ë‘',
      '/placeholder.svg?height=400&width=600',
      20,
      first_user_id
    );

  -- ê³µì§€ì‚¬í•­ ê²Œì‹œê¸€ ìƒ˜í”Œ ìƒì„± (ê¸°ì¡´ ì‚­ì œ)
  DELETE FROM posts WHERE title LIKE '%Seoul Founders Club%' OR title LIKE '%ì£¼ìš” ì´ë²¤íŠ¸ ì•ˆë‚´%';
  
  INSERT INTO posts (title, content, category, author_id)
  VALUES
    (
      'Seoul Founders Clubì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!',
      'ì•ˆë…•í•˜ì„¸ìš”, SFC ìš´ì˜íŒ€ì…ë‹ˆë‹¤.

ì„œìš¸ íŒŒìš´ë”ìŠ¤ í´ëŸ½ì€ ì°½ì—…ê°€ë“¤ì´ ëª¨ì—¬ ì„œë¡œì˜ ê²½í—˜ì„ ë‚˜ëˆ„ê³ , í•¨ê»˜ ì„±ì¥í•˜ëŠ” ì»¤ë®¤ë‹ˆí‹°ì…ë‹ˆë‹¤.

**ì»¤ë®¤ë‹ˆí‹° ê°€ì´ë“œë¼ì¸**

1. ì„œë¡œ ì¡´ì¤‘í•˜ê³  ë°°ë ¤í•˜ëŠ” ë¬¸í™”ë¥¼ ë§Œë“¤ì–´ì£¼ì„¸ìš”
2. ìŠ¤íŒ¸ì„± í™ë³´ ê¸€ì€ ìì œí•´ì£¼ì„¸ìš”
3. ê¶ê¸ˆí•œ ì ì€ ììœ ë¡­ê²Œ ì§ˆë¬¸í•˜ì„¸ìš”
4. ì¢‹ì€ ì •ë³´ëŠ” ì ê·¹ì ìœ¼ë¡œ ê³µìœ í•´ì£¼ì„¸ìš”

**í™œë™ ë°©ë²•**

â€¢ ê³µì§€ì‚¬í•­: ì¤‘ìš”í•œ ì•ˆë‚´ì‚¬í•­ì„ í™•ì¸í•˜ì„¸ìš”
â€¢ ììœ ê²Œì‹œíŒ: ììœ ë¡­ê²Œ ì˜ê²¬ì„ ë‚˜ëˆ„ì„¸ìš”
â€¢ ì´ë²¤íŠ¸: ë‹¤ì–‘í•œ ëª¨ì„ê³¼ í–‰ì‚¬ì— ì°¸ì—¬í•˜ì„¸ìš”

í•¨ê»˜ ì„±ì¥í•˜ëŠ” ì»¤ë®¤ë‹ˆí‹°ë¥¼ ë§Œë“¤ì–´ê°‘ì‹œë‹¤!',
      'announcement',
      first_user_id
    ),
    (
      '2025ë…„ 12ì›” - 2026ë…„ 2ì›” ì£¼ìš” ì´ë²¤íŠ¸ ì•ˆë‚´',
      'ìƒˆí•´ë¥¼ ë§ì•„ ë‹¤ì–‘í•œ ì´ë²¤íŠ¸ë¥¼ ì¤€ë¹„í–ˆìŠµë‹ˆë‹¤!

**12ì›” ì¼ì •**
â€¢ 12/5 (ëª©) - AI ìŠ¤íƒ€íŠ¸ì—… ì°½ì—…ì ë°‹ì—…
â€¢ 12/12 (ëª©) - VC íˆ¬ì ìœ ì¹˜ ì „ëµ ì›Œí¬ìƒµ
â€¢ 12/20-22 - ChatGPT í•´ì»¤í†¤

**2026ë…„ 1ì›” ì¼ì •**
â€¢ 1/11 (í† ) - ì œë¡œë² ì´ìŠ¤ ì°½ì—… ë¶€íŠ¸ìº í”„ ì‹œì‘
â€¢ 1/25 (í† ) - LLM íŒŒì¸íŠœë‹ ì›Œí¬ìƒµ

**2ì›” ì¼ì •**
â€¢ 2/8 (ì¼) - ì„±ê³µí•œ ì°½ì—…ìë“¤ê³¼ì˜ ì €ë… ì‹ì‚¬

ìì„¸í•œ ë‚´ìš©ì€ ì´ë²¤íŠ¸ í˜ì´ì§€ë¥¼ ì°¸ê³ í•´ì£¼ì„¸ìš”!',
      'announcement',
      first_user_id
    );
    
  RAISE NOTICE 'ìƒ˜í”Œ ì´ë²¤íŠ¸ 6ê°œì™€ ê³µì§€ì‚¬í•­ 2ê°œê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!';
END $$;
</file>

<file path="scripts/008_add_guest_registration.sql">
-- Add guest registration fields to event_registrations table
ALTER TABLE event_registrations 
ADD COLUMN IF NOT EXISTS guest_name TEXT,
ADD COLUMN IF NOT EXISTS guest_contact TEXT;

-- Update constraint to allow NULL user_id for guest registrations
ALTER TABLE event_registrations 
DROP CONSTRAINT IF EXISTS event_registrations_user_id_fkey;

ALTER TABLE event_registrations 
ADD CONSTRAINT event_registrations_user_id_fkey 
FOREIGN KEY (user_id) REFERENCES profiles(id) ON DELETE CASCADE;

-- Update RLS policies to allow guest registrations
DROP POLICY IF EXISTS "Anyone can view registrations" ON event_registrations;
DROP POLICY IF EXISTS "Users can register for events" ON event_registrations;
DROP POLICY IF EXISTS "Users can cancel their registrations" ON event_registrations;

CREATE POLICY "Anyone can view registrations" ON event_registrations
  FOR SELECT USING (true);

CREATE POLICY "Anyone can register for events" ON event_registrations
  FOR INSERT WITH CHECK (true);

CREATE POLICY "Users can cancel their registrations" ON event_registrations
  FOR DELETE USING (
    auth.uid() = user_id OR user_id IS NULL
  );

-- Add index for guest registrations
CREATE INDEX IF NOT EXISTS idx_event_registrations_guest 
ON event_registrations(event_id) 
WHERE user_id IS NULL;
</file>

<file path="scripts/009_add_community_boards.sql">
-- ì»¤ë®¤ë‹ˆí‹° ê²Œì‹œíŒ ì¶”ê°€ ìŠ¤í¬ë¦½íŠ¸

-- posts í…Œì´ë¸”ì˜ category ì²´í¬ ì œì•½ ì œê±°
ALTER TABLE posts DROP CONSTRAINT IF EXISTS posts_category_check;

-- ììœ ê²Œì‹œíŒì´ ì—†ìœ¼ë©´ ì¶”ê°€
INSERT INTO board_categories (
  id,
  slug,
  name,
  description,
  order_index,
  is_active,
  created_at,
  updated_at
) VALUES (
  gen_random_uuid(),
  'free-board',
  'ììœ ê²Œì‹œíŒ',
  'ììœ ë¡­ê²Œ ì†Œí†µí•˜ëŠ” ê²Œì‹œíŒ',
  2,
  true,
  now(),
  now()
) ON CONFLICT (slug) DO UPDATE SET
  is_active = true,
  updated_at = now();

-- ë°˜ê³¨ ê²Œì‹œíŒ ì¶”ê°€
INSERT INTO board_categories (
  id,
  slug,
  name,
  description,
  order_index,
  is_active,
  created_at,
  updated_at
) VALUES (
  gen_random_uuid(),
  'bangol',
  'ë°˜ê³¨',
  'ë°˜ê³¨ ëª¨ì„ ê²Œì‹œíŒ',
  3,
  true,
  now(),
  now()
) ON CONFLICT (slug) DO UPDATE SET
  is_active = true,
  updated_at = now();

-- í•˜ì´í† í¬ ê²Œì‹œíŒ ì¶”ê°€
INSERT INTO board_categories (
  id,
  slug,
  name,
  description,
  order_index,
  is_active,
  created_at,
  updated_at
) VALUES (
  gen_random_uuid(),
  'hightalk',
  'í•˜ì´í† í¬',
  'í•˜ì´í† í¬ ëª¨ì„ ê²Œì‹œíŒ',
  4,
  true,
  now(),
  now()
) ON CONFLICT (slug) DO UPDATE SET
  is_active = true,
  updated_at = now();

-- í…ŒìŠ¤íŠ¸ ê²Œì‹œë¬¼ ì¶”ê°€ (ì²« ë²ˆì§¸ ì‚¬ìš©ì ID ì‚¬ìš©)
DO $$
DECLARE
  first_user_id uuid;
  bangol_exists boolean;
  hightalk_exists boolean;
BEGIN
  -- ì²« ë²ˆì§¸ ì‚¬ìš©ì ID ê°€ì ¸ì˜¤ê¸°
  SELECT id INTO first_user_id FROM profiles LIMIT 1;
  
  IF first_user_id IS NOT NULL THEN
    -- ë°˜ê³¨ ê²Œì‹œíŒì— í…ŒìŠ¤íŠ¸ ê²Œì‹œë¬¼ì´ ìˆëŠ”ì§€ í™•ì¸
    SELECT EXISTS(
      SELECT 1 FROM posts WHERE category = 'bangol' AND title = 'HELLO WORLD'
    ) INTO bangol_exists;
    
    -- ë°˜ê³¨ ê²Œì‹œíŒì— í…ŒìŠ¤íŠ¸ ê²Œì‹œë¬¼ì´ ì—†ìœ¼ë©´ ì¶”ê°€
    IF NOT bangol_exists THEN
      INSERT INTO posts (
        id,
        title,
        content,
        category,
        author_id,
        created_at,
        updated_at,
        likes_count,
        comments_count
      ) VALUES (
        gen_random_uuid(),
        'HELLO WORLD',
        'ë°˜ê³¨ ê²Œì‹œíŒì˜ ì²« ë²ˆì§¸ í…ŒìŠ¤íŠ¸ ê²Œì‹œë¬¼ì…ë‹ˆë‹¤.',
        'bangol',
        first_user_id,
        now(),
        now(),
        0,
        0
      );
    END IF;
    
    -- í•˜ì´í† í¬ ê²Œì‹œíŒì— í…ŒìŠ¤íŠ¸ ê²Œì‹œë¬¼ì´ ìˆëŠ”ì§€ í™•ì¸
    SELECT EXISTS(
      SELECT 1 FROM posts WHERE category = 'hightalk' AND title = 'HELLO WORLD'
    ) INTO hightalk_exists;
    
    -- í•˜ì´í† í¬ ê²Œì‹œíŒì— í…ŒìŠ¤íŠ¸ ê²Œì‹œë¬¼ì´ ì—†ìœ¼ë©´ ì¶”ê°€
    IF NOT hightalk_exists THEN
      INSERT INTO posts (
        id,
        title,
        content,
        category,
        author_id,
        created_at,
        updated_at,
        likes_count,
        comments_count
      ) VALUES (
        gen_random_uuid(),
        'HELLO WORLD',
        'í•˜ì´í† í¬ ê²Œì‹œíŒì˜ ì²« ë²ˆì§¸ í…ŒìŠ¤íŠ¸ ê²Œì‹œë¬¼ì…ë‹ˆë‹¤.',
        'hightalk',
        first_user_id,
        now(),
        now(),
        0,
        0
      );
    END IF;
  END IF;
END $$;
</file>

<file path="scripts/010_refactor_posts_with_board_categories.sql">
-- Posts í…Œì´ë¸”ê³¼ Board Categories í…Œì´ë¸”ì„ ì˜¬ë°”ë¥´ê²Œ ì—°ê²°í•˜ëŠ” ë§ˆì´ê·¸ë ˆì´ì…˜
-- ê¸°ì¡´ ë°ì´í„°ë¥¼ ë³´ì¡´í•˜ë©´ì„œ ì•„í‚¤í…ì²˜ë¥¼ ê°œì„ í•©ë‹ˆë‹¤.

-- Step 1: board_categoriesì— ê¸°ì¡´ ì¹´í…Œê³ ë¦¬ ì¶”ê°€
INSERT INTO board_categories (name, slug, description, is_active, order_index)
VALUES
  ('ê³µì§€ì‚¬í•­', 'announcement', 'ì»¤ë®¤ë‹ˆí‹° ê³µì§€ì‚¬í•­', true, 1),
  ('ììœ ê²Œì‹œíŒ', 'free-board', 'ììœ ë¡­ê²Œ ì˜ê²¬ì„ ë‚˜ëˆ„ëŠ” ê³µê°„', true, 2)
ON CONFLICT (slug) DO UPDATE
SET is_active = true, order_index = EXCLUDED.order_index;

-- Step 2: ì»¤ë®¤ë‹ˆí‹° ì¹´í…Œê³ ë¦¬ ì¶”ê°€ (ë°˜ê³¨, í•˜ì´í† í¬)
INSERT INTO board_categories (name, slug, description, is_active, order_index)
VALUES
  ('ë°˜ê³¨', 'bangol', 'ë°˜ê³¨ ëª¨ì„ ê²Œì‹œíŒ', true, 3),
  ('í•˜ì´í† í¬', 'hightalk', 'í•˜ì´í† í¬ ëª¨ì„ ê²Œì‹œíŒ', true, 4)
ON CONFLICT (slug) DO UPDATE
SET is_active = true, order_index = EXCLUDED.order_index;

-- Step 3: posts í…Œì´ë¸”ì— board_category_id ì»¬ëŸ¼ ì¶”ê°€
ALTER TABLE posts ADD COLUMN IF NOT EXISTS board_category_id uuid REFERENCES board_categories(id);

-- Step 4: ê¸°ì¡´ postsì˜ category ê°’ì„ board_category_idë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜
UPDATE posts p
SET board_category_id = bc.id
FROM board_categories bc
WHERE p.category = 'announcement' AND bc.slug = 'announcement';

UPDATE posts p
SET board_category_id = bc.id
FROM board_categories bc
WHERE p.category = 'discussion' AND bc.slug = 'free-board';

-- Step 5: CHECK ì œì•½ ì œê±°
ALTER TABLE posts DROP CONSTRAINT IF EXISTS posts_category_check;

-- Step 6: category ì»¬ëŸ¼ì„ nullableë¡œ ë³€ê²½ (í–¥í›„ ì œê±° ì˜ˆì •)
ALTER TABLE posts ALTER COLUMN category DROP NOT NULL;

-- Step 7: board_category_idë¥¼ NOT NULLë¡œ ì„¤ì • (ê¸°ì¡´ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ í›„)
-- ëª¨ë“  postsê°€ board_category_idë¥¼ ê°€ì§€ê³  ìˆëŠ”ì§€ í™•ì¸
DO $$
BEGIN
  IF NOT EXISTS (SELECT 1 FROM posts WHERE board_category_id IS NULL) THEN
    ALTER TABLE posts ALTER COLUMN board_category_id SET NOT NULL;
  END IF;
END $$;

-- Step 8: ì¸ë±ìŠ¤ ì¶”ê°€ (ì„±ëŠ¥ ìµœì í™”)
CREATE INDEX IF NOT EXISTS idx_posts_board_category_id ON posts(board_category_id);

-- Step 9: í…ŒìŠ¤íŠ¸ ê²Œì‹œë¬¼ ì¶”ê°€
INSERT INTO posts (title, content, board_category_id, author_id)
SELECT
  'HELLO WORLD',
  'ë°˜ê³¨ ëª¨ì„ ì²« ê²Œì‹œê¸€ì…ë‹ˆë‹¤. í™˜ì˜í•©ë‹ˆë‹¤!',
  bc.id,
  (SELECT id FROM profiles ORDER BY created_at ASC LIMIT 1)
FROM board_categories bc
WHERE bc.slug = 'bangol';

INSERT INTO posts (title, content, board_category_id, author_id)
SELECT
  'HELLO WORLD',
  'í•˜ì´í† í¬ ëª¨ì„ ì²« ê²Œì‹œê¸€ì…ë‹ˆë‹¤. í™˜ì˜í•©ë‹ˆë‹¤!',
  bc.id,
  (SELECT id FROM profiles ORDER BY created_at ASC LIMIT 1)
FROM board_categories bc
WHERE bc.slug = 'hightalk';

-- Step 10: ê¸°ì¡´ ììœ ê²Œì‹œíŒ ìƒ˜í”Œ ê²Œì‹œë¬¼ ì¶”ê°€ (ì—†ëŠ” ê²½ìš°)
INSERT INTO posts (title, content, board_category_id, author_id)
SELECT
  'ììœ ê²Œì‹œíŒì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤',
  'ììœ ë¡­ê²Œ ì˜ê²¬ì„ ë‚˜ëˆ„ê³  ì†Œí†µí•˜ëŠ” ê³µê°„ì…ë‹ˆë‹¤. ì°½ì—…, ê¸°ìˆ , íˆ¬ì ë“± ë‹¤ì–‘í•œ ì£¼ì œë¡œ ì´ì•¼ê¸°ë¥¼ ë‚˜ëˆ ë³´ì„¸ìš”!',
  bc.id,
  (SELECT id FROM profiles ORDER BY created_at ASC LIMIT 1)
FROM board_categories bc
WHERE bc.slug = 'free-board'
AND NOT EXISTS (
  SELECT 1 FROM posts p2
  WHERE p2.board_category_id = bc.id
);

-- ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ í™•ì¸ ì¿¼ë¦¬
SELECT
  bc.name as category_name,
  bc.slug,
  COUNT(p.id) as post_count
FROM board_categories bc
LEFT JOIN posts p ON p.board_category_id = bc.id
WHERE bc.is_active = true
GROUP BY bc.id, bc.name, bc.slug, bc.order_index
ORDER BY bc.order_index;
</file>

<file path="scripts/011_create_projects_tables.sql">
-- Projects ê¸°ëŠ¥ì„ ìœ„í•œ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ
-- í”„ë¡œì íŠ¸, í”„ë¡œì íŠ¸ ë©¤ë²„, ê¸°ìˆ  ìŠ¤íƒ í…Œì´ë¸” ìƒì„±

-- í”„ë¡œì íŠ¸ í…Œì´ë¸”
create table if not exists public.projects (
  id uuid primary key default gen_random_uuid(),
  title text not null,
  description text not null,
  status text not null check (status in ('planning', 'in_progress', 'completed', 'on_hold')),
  category text not null check (category in ('web', 'mobile', 'ai', 'blockchain', 'hardware', 'other')),
  thumbnail_url text,
  created_by uuid references public.profiles(id) on delete cascade not null,
  created_at timestamptz default now() not null,
  updated_at timestamptz default now() not null,
  start_date date,
  end_date date,
  github_url text,
  demo_url text,
  looking_for_members boolean default false not null,
  views_count int default 0 not null
);

-- í”„ë¡œì íŠ¸ ë©¤ë²„ í…Œì´ë¸”
create table if not exists public.project_members (
  id uuid primary key default gen_random_uuid(),
  project_id uuid references public.projects(id) on delete cascade not null,
  user_id uuid references public.profiles(id) on delete cascade not null,
  role text not null, -- ì˜ˆ: 'owner', 'developer', 'designer', 'pm'
  joined_at timestamptz default now() not null,
  unique(project_id, user_id)
);

-- í”„ë¡œì íŠ¸ ê¸°ìˆ  ìŠ¤íƒ í…Œì´ë¸”
create table if not exists public.project_tech_stack (
  id uuid primary key default gen_random_uuid(),
  project_id uuid references public.projects(id) on delete cascade not null,
  tech_name text not null,
  created_at timestamptz default now() not null
);

-- Row Level Security í™œì„±í™”
alter table public.projects enable row level security;
alter table public.project_members enable row level security;
alter table public.project_tech_stack enable row level security;

-- í”„ë¡œì íŠ¸ ì •ì±…
create policy "Projects are viewable by everyone"
  on public.projects for select
  using (true);

create policy "Authenticated users can create projects"
  on public.projects for insert
  with check (auth.uid() = created_by);

create policy "Project creators can update their projects"
  on public.projects for update
  using (auth.uid() = created_by);

create policy "Project creators can delete their projects"
  on public.projects for delete
  using (auth.uid() = created_by);

-- í”„ë¡œì íŠ¸ ë©¤ë²„ ì •ì±…
create policy "Project members are viewable by everyone"
  on public.project_members for select
  using (true);

create policy "Project creators can add members"
  on public.project_members for insert
  with check (
    exists (
      select 1 from public.projects
      where id = project_id and created_by = auth.uid()
    )
  );

create policy "Project creators and members can leave"
  on public.project_members for delete
  using (
    auth.uid() = user_id or
    exists (
      select 1 from public.projects
      where id = project_id and created_by = auth.uid()
    )
  );

-- í”„ë¡œì íŠ¸ ê¸°ìˆ  ìŠ¤íƒ ì •ì±…
create policy "Tech stack is viewable by everyone"
  on public.project_tech_stack for select
  using (true);

create policy "Project creators can manage tech stack"
  on public.project_tech_stack for all
  using (
    exists (
      select 1 from public.projects
      where id = project_id and created_by = auth.uid()
    )
  );

-- ì¸ë±ìŠ¤ ìƒì„± (ì„±ëŠ¥ ìµœì í™”)
create index if not exists idx_projects_created_by on public.projects(created_by);
create index if not exists idx_projects_status on public.projects(status);
create index if not exists idx_projects_category on public.projects(category);
create index if not exists idx_project_members_project_id on public.project_members(project_id);
create index if not exists idx_project_members_user_id on public.project_members(user_id);
create index if not exists idx_project_tech_stack_project_id on public.project_tech_stack(project_id);

-- ìƒ˜í”Œ í”„ë¡œì íŠ¸ ë°ì´í„° ìƒì„±
insert into public.projects (title, description, status, category, created_by, looking_for_members, start_date)
select 
  'AI ê¸°ë°˜ ìŠ¤íƒ€íŠ¸ì—… ë§¤ì¹­ í”Œë«í¼',
  'íˆ¬ììì™€ ìŠ¤íƒ€íŠ¸ì—…ì„ AIë¡œ ë§¤ì¹­í•˜ëŠ” í”Œë«í¼ì…ë‹ˆë‹¤. ë¨¸ì‹ ëŸ¬ë‹ì„ í™œìš©í•˜ì—¬ ìµœì ì˜ ë§¤ì¹­ì„ ì œê³µí•˜ê³ , ì‹¤ì‹œê°„ í”¼ë“œë°± ì‹œìŠ¤í…œì„ í†µí•´ ì§€ì†ì ìœ¼ë¡œ ê°œì„ ë©ë‹ˆë‹¤.',
  'in_progress',
  'ai',
  p.id,
  true,
  current_date - interval '2 months'
from public.profiles p
limit 1;

insert into public.projects (title, description, status, category, created_by, looking_for_members, start_date)
select 
  'ë¸”ë¡ì²´ì¸ ê¸°ë°˜ íˆ¬ëª…í•œ ê¸°ë¶€ í”Œë«í¼',
  'ê¸°ë¶€ê¸ˆì˜ ì‚¬ìš© ë‚´ì—­ì„ ë¸”ë¡ì²´ì¸ì— ê¸°ë¡í•˜ì—¬ íˆ¬ëª…ì„±ì„ ë³´ì¥í•˜ëŠ” í”Œë«í¼ì…ë‹ˆë‹¤. ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ë¥¼ í†µí•´ ìë™í™”ëœ ê¸°ë¶€ê¸ˆ ë°°ë¶„ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.',
  'planning',
  'blockchain',
  p.id,
  true,
  null
from public.profiles p
limit 1;

insert into public.projects (title, description, status, category, created_by, looking_for_members, start_date, end_date)
select 
  'Seoul Founders Club ì»¤ë®¤ë‹ˆí‹° í”Œë«í¼',
  'ì„œìš¸ ì°½ì—…ê°€ë“¤ì„ ìœ„í•œ ë„¤íŠ¸ì›Œí‚¹ ë° í˜‘ì—… í”Œë«í¼ì…ë‹ˆë‹¤. ì´ë²¤íŠ¸, ê²Œì‹œíŒ, í”„ë¡œì íŠ¸ ê³µìœ  ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.',
  'in_progress',
  'web',
  p.id,
  false,
  current_date - interval '3 months',
  null
from public.profiles p
limit 1;

-- ìƒ˜í”Œ í”„ë¡œì íŠ¸ì˜ ê¸°ìˆ  ìŠ¤íƒ ì¶”ê°€
insert into public.project_tech_stack (project_id, tech_name)
select p.id, unnest(array['Next.js', 'TypeScript', 'Supabase', 'Tailwind CSS'])
from public.projects p
where p.title = 'Seoul Founders Club ì»¤ë®¤ë‹ˆí‹° í”Œë«í¼';

insert into public.project_tech_stack (project_id, tech_name)
select p.id, unnest(array['Python', 'TensorFlow', 'FastAPI', 'PostgreSQL'])
from public.projects p
where p.title = 'AI ê¸°ë°˜ ìŠ¤íƒ€íŠ¸ì—… ë§¤ì¹­ í”Œë«í¼';

insert into public.project_tech_stack (project_id, tech_name)
select p.id, unnest(array['Solidity', 'React', 'Web3.js', 'IPFS'])
from public.projects p
where p.title = 'ë¸”ë¡ì²´ì¸ ê¸°ë°˜ íˆ¬ëª…í•œ ê¸°ë¶€ í”Œë«í¼';

-- í”„ë¡œì íŠ¸ ìƒì„±ìë¥¼ ë©¤ë²„ë¡œ ìë™ ì¶”ê°€
insert into public.project_members (project_id, user_id, role)
select p.id, p.created_by, 'owner'
from public.projects p;
</file>

<file path="scripts/012_fix_event_thumbnails.sql">
-- ì´ë²¤íŠ¸ ì¸ë„¤ì¼ ì´ë¯¸ì§€ë¥¼ ì‹¤ì œë¡œ ì‘ë™í•˜ëŠ” URLë¡œ ì—…ë°ì´íŠ¸

UPDATE events
SET thumbnail_url = 'https://images.unsplash.com/photo-1540575467063-178a50c2df87?w=600&h=400&fit=crop'
WHERE title LIKE '%AI ìŠ¤íƒ€íŠ¸ì—… ì°½ì—…ì ë°‹ì—…%';

UPDATE events
SET thumbnail_url = 'https://images.unsplash.com/photo-1557804506-669a67965ba0?w=600&h=400&fit=crop'
WHERE title LIKE '%VC íˆ¬ì ìœ ì¹˜ ì „ëµ%';

UPDATE events
SET thumbnail_url = 'https://images.unsplash.com/photo-1522071820081-009f0129c71c?w=600&h=400&fit=crop'
WHERE title LIKE '%ChatGPT API%' OR title LIKE '%í•´ì»¤í†¤%';

UPDATE events
SET thumbnail_url = 'https://images.unsplash.com/photo-1531482615713-2afd69097998?w=600&h=400&fit=crop'
WHERE title LIKE '%ì œë¡œë² ì´ìŠ¤ ì°½ì—… ë¶€íŠ¸ìº í”„%';

UPDATE events
SET thumbnail_url = 'https://images.unsplash.com/photo-1451187580459-43490279c0fa?w=600&h=400&fit=crop'
WHERE title LIKE '%LLM íŒŒì¸íŠœë‹%';

UPDATE events
SET thumbnail_url = 'https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=600&h=400&fit=crop'
WHERE title LIKE '%ì„±ê³µí•œ ì°½ì—…ì%' OR title LIKE '%ì €ë… ì‹ì‚¬%';
</file>

<file path="scripts/013_add_sample_announcements.sql">
-- Add sample announcement posts

INSERT INTO posts (
  title,
  content,
  category,
  author_id,
  created_at
) VALUES
(
  'Seoul Founders Club ì»¤ë®¤ë‹ˆí‹° ì˜¤í”ˆ ì•ˆë‚´',
  'ì•ˆë…•í•˜ì„¸ìš”! Seoul Founders Club ì»¤ë®¤ë‹ˆí‹°ê°€ ì •ì‹ìœ¼ë¡œ ì˜¤í”ˆí•˜ì˜€ìŠµë‹ˆë‹¤. ì‚¬ì—…ê°€, íˆ¬ìì, ì¸í”Œë£¨ì–¸ì„œê°€ í•¨ê»˜ ì„±ì¥í•˜ê³  í™œë™í•˜ëŠ” ê³µê°„ìœ¼ë¡œ ë°œì „ì‹œì¼œ ë‚˜ê°€ê² ìŠµë‹ˆë‹¤. ë§ì€ ê´€ì‹¬ê³¼ ì°¸ì—¬ ë¶€íƒë“œë¦½ë‹ˆë‹¤!',
  'announcement',
  (SELECT id FROM profiles LIMIT 1),
  NOW() - INTERVAL '2 days'
),
(
  'ì»¤ë®¤ë‹ˆí‹° ì´ìš© ê·œì¹™ ë° ë§¤ë„ˆ ì•ˆë‚´',
  'SFCëŠ” ì„œë¡œì˜ ê°ìƒê³¼ ìƒê°ì„ ì¡´ì¤‘í•˜ëŠ” ê³µê°„ì…ë‹ˆë‹¤. í•¨ê»˜ ë§¤ë„ˆ ìˆê²Œ ëŒ€í™”í•˜ë©° ì¦ê±°ìš´ ì»¤ë®¤ë‹ˆí‹°ë¥¼ ë§Œë“¤ì–´ê°€ìš”. ìš•ì„¤, ë¹„ë°©, ìŠ¤íŒ¸ ê²Œì‹œë¬¼ì€ ì‚­ì œë  ìˆ˜ ìˆìœ¼ë©°, ë°˜ë³µë  ê²½ìš° ì œì¬ ì¡°ì¹˜ê°€ ì·¨í•´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
  'announcement',
  (SELECT id FROM profiles LIMIT 1),
  NOW() - INTERVAL '1 day'
);
</file>

<file path="scripts/014_create_notifications.sql">
-- Create notifications table
CREATE TABLE IF NOT EXISTS notifications (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES profiles(id) ON DELETE CASCADE,
  type TEXT NOT NULL, -- 'comment', 'event_registration', 'post_like'
  title TEXT NOT NULL,
  message TEXT NOT NULL,
  related_post_id UUID REFERENCES posts(id) ON DELETE CASCADE,
  related_event_id UUID REFERENCES events(id) ON DELETE CASCADE,
  related_comment_id UUID REFERENCES comments(id) ON DELETE CASCADE,
  actor_id UUID REFERENCES profiles(id) ON DELETE CASCADE, -- who triggered the notification
  is_read BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Create index for faster queries
CREATE INDEX IF NOT EXISTS idx_notifications_user_id ON notifications(user_id);
CREATE INDEX IF NOT EXISTS idx_notifications_created_at ON notifications(created_at DESC);
CREATE INDEX IF NOT EXISTS idx_notifications_is_read ON notifications(is_read);

-- Enable RLS
ALTER TABLE notifications ENABLE ROW LEVEL SECURITY;

-- Create policies
CREATE POLICY "Users can view their own notifications"
  ON notifications FOR SELECT
  USING (auth.uid() = user_id);

CREATE POLICY "Users can update their own notifications"
  ON notifications FOR UPDATE
  USING (auth.uid() = user_id);

CREATE POLICY "System can insert notifications"
  ON notifications FOR INSERT
  WITH CHECK (true);

-- Create function to send notification on comment
CREATE OR REPLACE FUNCTION notify_on_comment()
RETURNS TRIGGER AS $$
BEGIN
  -- Get post author
  INSERT INTO notifications (user_id, type, title, message, related_post_id, related_comment_id, actor_id)
  SELECT 
    p.author_id,
    'comment',
    'ìƒˆ ëŒ“ê¸€',
    (SELECT full_name FROM profiles WHERE id = NEW.author_id) || 'ë‹˜ì´ íšŒì›ë‹˜ì˜ ê²Œì‹œë¬¼ì— ëŒ“ê¸€ì„ ë‚¨ê²¼ìŠµë‹ˆë‹¤.',
    NEW.post_id,
    NEW.id,
    NEW.author_id
  FROM posts p
  WHERE p.id = NEW.post_id
    AND p.author_id != NEW.author_id; -- Don't notify yourself
  
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- Create trigger for comments
DROP TRIGGER IF EXISTS trigger_notify_on_comment ON comments;
CREATE TRIGGER trigger_notify_on_comment
  AFTER INSERT ON comments
  FOR EACH ROW
  EXECUTE FUNCTION notify_on_comment();

-- Create function to send notification on event registration
CREATE OR REPLACE FUNCTION notify_on_event_registration()
RETURNS TRIGGER AS $$
BEGIN
  -- Get event creator
  INSERT INTO notifications (user_id, type, title, message, related_event_id, actor_id)
  SELECT 
    e.created_by,
    'event_registration',
    'ìƒˆ ì°¸ê°€ ì‹ ì²­',
    COALESCE(
      (SELECT full_name FROM profiles WHERE id = NEW.user_id),
      NEW.guest_name
    ) || 'ë‹˜ì´ íšŒì›ë‹˜ì˜ ì´ë²¤íŠ¸ì— ì°¸ê°€ ì‹ ì²­í–ˆìŠµë‹ˆë‹¤.',
    NEW.event_id,
    NEW.user_id
  FROM events e
  WHERE e.id = NEW.event_id
    AND e.created_by != NEW.user_id; -- Don't notify yourself
  
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- Create trigger for event registrations
DROP TRIGGER IF EXISTS trigger_notify_on_event_registration ON event_registrations;
CREATE TRIGGER trigger_notify_on_event_registration
  AFTER INSERT ON event_registrations
  FOR EACH ROW
  EXECUTE FUNCTION notify_on_event_registration();
</file>

<file path="scripts/015_set_master_admin.sql">
-- ë§ˆìŠ¤í„° ê´€ë¦¬ì ê¶Œí•œ ì„¤ì •
-- jaewook@mvmt.city ê³„ì •ì„ 'master' ê¶Œí•œìœ¼ë¡œ ì„¤ì •

-- profiles í…Œì´ë¸”ì— role ì»¬ëŸ¼ì´ ì—†ìœ¼ë©´ ì¶”ê°€
ALTER TABLE profiles ADD COLUMN IF NOT EXISTS role text DEFAULT 'member' CHECK (role IN ('member', 'admin', 'master'));

-- jaewook@mvmt.city ì´ë©”ì¼ì„ ê°€ì§„ ì‚¬ìš©ìë¥¼ masterë¡œ ì„¤ì •
UPDATE profiles
SET role = 'master'
WHERE email = 'jaewook@mvmt.city';

-- ê²°ê³¼ í™•ì¸ì„ ìœ„í•œ ì¿¼ë¦¬ (ì£¼ì„ ì²˜ë¦¬)
-- SELECT id, email, full_name, role FROM profiles WHERE email = 'jaewook@mvmt.city';
</file>

<file path="scripts/016_posts_rls_policy.sql">
-- ê²Œì‹œíŒ ê´€ë¦¬ ê¶Œí•œ ì •ì±… (RLS)
-- ìˆ˜ì •: ì‘ì„±ìë§Œ ê°€ëŠ¥
-- ì‚­ì œ: ì‘ì„±ì ë˜ëŠ” ë§ˆìŠ¤í„° ê´€ë¦¬ìë§Œ ê°€ëŠ¥

-- ê¸°ì¡´ RLS ì •ì±… ì‚­ì œ (ìˆë‹¤ë©´)
DROP POLICY IF EXISTS "Users can update their own posts" ON posts;
DROP POLICY IF EXISTS "Users can delete their own posts" ON posts;
DROP POLICY IF EXISTS "Master admins can delete any posts" ON posts;

-- RLS í™œì„±í™” (ì´ë¯¸ ë˜ì–´ ìˆë‹¤ë©´ ë¬´ì‹œ)
ALTER TABLE posts ENABLE ROW LEVEL SECURITY;

-- 1. ìˆ˜ì •(Update) ì •ì±…: ì‘ì„±ìë§Œ ê°€ëŠ¥
CREATE POLICY "Users can update their own posts"
ON posts
FOR UPDATE
USING (auth.uid() = author_id)
WITH CHECK (auth.uid() = author_id);

-- 2. ì‚­ì œ(Delete) ì •ì±…: ì‘ì„±ì ë˜ëŠ” ë§ˆìŠ¤í„° ê´€ë¦¬ìë§Œ ê°€ëŠ¥
-- ì‘ì„±ìê°€ ìì‹ ì˜ ê²Œì‹œê¸€ ì‚­ì œ ê°€ëŠ¥
CREATE POLICY "Users can delete their own posts"
ON posts
FOR DELETE
USING (auth.uid() = author_id);

-- ë§ˆìŠ¤í„° ê´€ë¦¬ìê°€ ëª¨ë“  ê²Œì‹œê¸€ ì‚­ì œ ê°€ëŠ¥
CREATE POLICY "Master admins can delete any posts"
ON posts
FOR DELETE
USING (
  EXISTS (
    SELECT 1 FROM profiles
    WHERE profiles.id = auth.uid()
    AND profiles.role = 'master'
  )
);

-- ì°¸ê³ : ì½ê¸°(Select) ì •ì±…ì€ ê¸°ì¡´ ì •ì±…ì„ ìœ ì§€í•©ë‹ˆë‹¤
-- ë§Œì•½ ì½ê¸° ì •ì±…ì´ ì—†ë‹¤ë©´ ì•„ë˜ì™€ ê°™ì´ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
-- CREATE POLICY "Posts are viewable by everyone"
-- ON posts FOR SELECT
-- USING (true);
</file>

<file path="scripts/017_ensure_public_read_policies.sql">
-- ê³µê°œ ì½ê¸° ì •ì±… í™•ì¸ ë° ìˆ˜ì •
-- ë¡œê·¸ì¸ ì—†ì´ë„ ì´ë²¤íŠ¸ì™€ ê²Œì‹œê¸€ì„ ë³¼ ìˆ˜ ìˆë„ë¡ ë³´ì¥

-- 1. Posts í…Œì´ë¸” ì½ê¸° ì •ì±… í™•ì¸ ë° ì¶”ê°€
DROP POLICY IF EXISTS "Posts are viewable by everyone" ON posts;
CREATE POLICY "Posts are viewable by everyone"
ON posts
FOR SELECT
USING (true);

-- 2. Events í…Œì´ë¸” ì½ê¸° ì •ì±… í™•ì¸ ë° ì¶”ê°€
DROP POLICY IF EXISTS "Events are viewable by everyone" ON events;
CREATE POLICY "Events are viewable by everyone"
ON events
FOR SELECT
USING (true);

-- 3. Board Categories í…Œì´ë¸” ì½ê¸° ì •ì±… í™•ì¸ ë° ì¶”ê°€
DROP POLICY IF EXISTS "Anyone can view active categories" ON board_categories;
CREATE POLICY "Anyone can view active categories"
ON board_categories
FOR SELECT
USING (is_active = true);

-- 4. Profiles í…Œì´ë¸” ì½ê¸° ì •ì±… í™•ì¸ ë° ì¶”ê°€
DROP POLICY IF EXISTS "Public profiles are viewable by everyone" ON profiles;
CREATE POLICY "Public profiles are viewable by everyone"
ON profiles
FOR SELECT
USING (true);

-- 5. Event Registrations í…Œì´ë¸” ì½ê¸° ì •ì±… í™•ì¸ ë° ì¶”ê°€
DROP POLICY IF EXISTS "Event registrations are viewable by everyone" ON event_registrations;
CREATE POLICY "Event registrations are viewable by everyone"
ON event_registrations
FOR SELECT
USING (true);

-- 6. Comments í…Œì´ë¸” ì½ê¸° ì •ì±… í™•ì¸ ë° ì¶”ê°€
DROP POLICY IF EXISTS "Comments are viewable by everyone" ON comments;
CREATE POLICY "Comments are viewable by everyone"
ON comments
FOR SELECT
USING (true);

-- ì •ì±… í™•ì¸ ì¿¼ë¦¬ (ì‹¤í–‰ í›„ í™•ì¸ìš©)
-- SELECT schemaname, tablename, policyname, permissive, roles, cmd, qual 
-- FROM pg_policies 
-- WHERE schemaname = 'public' 
-- AND tablename IN ('posts', 'events', 'board_categories', 'profiles', 'event_registrations', 'comments')
-- AND cmd = 'SELECT'
-- ORDER BY tablename, policyname;
</file>

<file path="scripts/018_check_data_and_policies.sql">
-- ë°ì´í„° ì¡´ì¬ ì—¬ë¶€ ë° RLS ì •ì±… í™•ì¸ ìŠ¤í¬ë¦½íŠ¸
-- ì´ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ì—¬ ë¬¸ì œë¥¼ ì§„ë‹¨í•˜ì„¸ìš”

-- 1. ì´ë²¤íŠ¸ ë°ì´í„° í™•ì¸
SELECT 
  COUNT(*) as total_events,
  COUNT(*) FILTER (WHERE event_date >= NOW()) as upcoming_events
FROM events;

-- 2. ê²Œì‹œê¸€ ë°ì´í„° í™•ì¸
SELECT 
  COUNT(*) as total_posts,
  COUNT(*) FILTER (WHERE board_category_id IS NOT NULL) as posts_with_category
FROM posts;

-- 3. Board Categories í™•ì¸
SELECT id, name, slug, is_active 
FROM board_categories 
WHERE slug IN ('free', 'vangol', 'hightalk', 'free-board', 'bangol', 'announcement')
ORDER BY order_index;

-- 4. Posts with Categories ì¡°ì¸ í™•ì¸
SELECT 
  p.id,
  p.title,
  bc.name as category_name,
  bc.slug as category_slug,
  bc.is_active
FROM posts p
LEFT JOIN board_categories bc ON p.board_category_id = bc.id
LIMIT 10;

-- 5. RLS ì •ì±… í™•ì¸
SELECT 
  schemaname,
  tablename,
  policyname,
  permissive,
  roles,
  cmd,
  qual
FROM pg_policies 
WHERE schemaname = 'public' 
AND tablename IN ('posts', 'events', 'board_categories', 'profiles', 'event_registrations', 'comments')
AND cmd = 'SELECT'
ORDER BY tablename, policyname;

-- 6. RLS í™œì„±í™” ì—¬ë¶€ í™•ì¸
SELECT 
  tablename,
  rowsecurity as rls_enabled
FROM pg_tables 
WHERE schemaname = 'public' 
AND tablename IN ('posts', 'events', 'board_categories', 'profiles', 'event_registrations', 'comments')
ORDER BY tablename;

-- 7. Profiles í™•ì¸ (author_id ì—°ê²° í™•ì¸ìš©)
SELECT COUNT(*) as total_profiles FROM profiles;

-- 8. Event Registrations í™•ì¸
SELECT COUNT(*) as total_registrations FROM event_registrations;
</file>

<file path="scripts/019_fix_anonymous_access.sql">
-- ìµëª… ì‚¬ìš©ì ì ‘ê·¼ ë¬¸ì œ í•´ê²°
-- ê²Œì‹œê¸€ ì¡°íšŒ ì‹œ board_categoriesì™€ profiles ì¡°ì¸ ë¬¸ì œ í•´ê²°

-- 1. Postsì™€ Board Categories ì¡°ì¸ ì‹œ ìµëª… ì‚¬ìš©ìë„ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡ ë³´ì¥
-- ì´ë¯¸ "Posts are viewable by everyone" ì •ì±…ì´ ìˆì§€ë§Œ, ì¡°ì¸ëœ board_categories ì ‘ê·¼ í™•ì¸

-- 2. Profiles ì ‘ê·¼ í™•ì¸ (ì´ë¯¸ ì„¤ì •ë˜ì–´ ìˆì§€ë§Œ ì¬í™•ì¸)
DROP POLICY IF EXISTS "Public profiles are viewable by everyone" ON profiles;
CREATE POLICY "Public profiles are viewable by everyone"
ON profiles
FOR SELECT
USING (true);

-- 3. Event Registrations ì§‘ê³„ í•¨ìˆ˜ ì ‘ê·¼ í™•ì¸
-- ì§‘ê³„ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•  ë•Œë„ ê°œë³„ í–‰ì— ëŒ€í•œ SELECT ì •ì±…ì´ í•„ìš”í•¨
DROP POLICY IF EXISTS "Event registrations are viewable by everyone" ON event_registrations;
CREATE POLICY "Event registrations are viewable by everyone"
ON event_registrations
FOR SELECT
USING (true);

-- 4. Postsì˜ board_category_idê°€ NULLì¸ ê²½ìš°ë„ í™•ì¸
-- ë§Œì•½ board_category_idê°€ NULLì´ë©´ inner joinì—ì„œ ì œì™¸ë¨
-- ì´ë¥¼ í™•ì¸í•˜ê¸° ìœ„í•œ ì¿¼ë¦¬ (ì‹¤í–‰ í›„ í™•ì¸)
-- SELECT COUNT(*) as posts_without_category FROM posts WHERE board_category_id IS NULL;

-- 5. Board Categories RLS ì •ì±… ì¬í™•ì¸
DROP POLICY IF EXISTS "Anyone can view active categories" ON board_categories;
CREATE POLICY "Anyone can view active categories"
ON board_categories
FOR SELECT
USING (is_active = true);

-- 6. ëª¨ë“  ì •ì±…ì´ ì œëŒ€ë¡œ ì„¤ì •ë˜ì—ˆëŠ”ì§€ í™•ì¸
-- ì´ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•˜ì—¬ í™•ì¸
SELECT 
  schemaname,
  tablename,
  policyname,
  cmd,
  CASE 
    WHEN qual LIKE '%true%' OR qual IS NULL THEN 'Public Access'
    ELSE 'Restricted'
  END as access_type
FROM pg_policies 
WHERE schemaname = 'public' 
AND tablename IN ('posts', 'events', 'board_categories', 'profiles', 'event_registrations', 'comments')
AND cmd = 'SELECT'
ORDER BY tablename, policyname;
</file>

<file path="scripts/020_test_anonymous_queries.sql">
-- ìµëª… ì‚¬ìš©ì ê¶Œí•œìœ¼ë¡œ ì¿¼ë¦¬ í…ŒìŠ¤íŠ¸
-- ì´ ì¿¼ë¦¬ë“¤ì„ ì‹¤í–‰í•˜ì—¬ ìµëª… ì‚¬ìš©ìë¡œ ì ‘ê·¼ ê°€ëŠ¥í•œì§€ í™•ì¸

-- í˜„ì¬ ì‚¬ìš©ì í™•ì¸ (ìµëª… ì‚¬ìš©ìëŠ” NULL)
SELECT auth.uid() as current_user_id;

-- 1. ì´ë²¤íŠ¸ ì¡°íšŒ í…ŒìŠ¤íŠ¸
SELECT 
  id,
  title,
  event_date,
  location
FROM events
WHERE event_date >= NOW()
ORDER BY event_date ASC
LIMIT 5;

-- 2. ê²Œì‹œê¸€ê³¼ ì¹´í…Œê³ ë¦¬ ì¡°ì¸ í…ŒìŠ¤íŠ¸
SELECT 
  p.id,
  p.title,
  bc.name as category_name,
  bc.slug as category_slug
FROM posts p
INNER JOIN board_categories bc ON p.board_category_id = bc.id
WHERE bc.is_active = true
  AND bc.slug IN ('free', 'vangol', 'hightalk', 'free-board', 'bangol')
  AND bc.slug != 'announcement'
ORDER BY p.created_at DESC
LIMIT 5;

-- 3. í”„ë¡œí•„ ì¡°íšŒ í…ŒìŠ¤íŠ¸
SELECT 
  id,
  full_name,
  email
FROM profiles
LIMIT 5;

-- 4. ì´ë²¤íŠ¸ ë“±ë¡ ì§‘ê³„ í…ŒìŠ¤íŠ¸
SELECT 
  event_id,
  COUNT(*) as registration_count
FROM event_registrations
GROUP BY event_id
LIMIT 5;

-- 5. ì „ì²´ ì¿¼ë¦¬ í…ŒìŠ¤íŠ¸ (app/page.tsxì™€ ë™ì¼í•œ êµ¬ì¡°)
SELECT 
  p.id,
  p.title,
  p.content,
  p.created_at,
  bc.name as category_name,
  bc.slug as category_slug,
  pr.full_name as author_name
FROM posts p
INNER JOIN board_categories bc ON p.board_category_id = bc.id
LEFT JOIN profiles pr ON p.author_id = pr.id
WHERE bc.is_active = true
  AND bc.slug IN ('free', 'vangol', 'hightalk', 'free-board', 'bangol')
  AND bc.slug != 'announcement'
ORDER BY p.created_at DESC
LIMIT 10;
</file>

<file path="scripts/021_debug_queries.sql">
-- ë¬¸ì œ ì§„ë‹¨ì„ ìœ„í•œ ë””ë²„ê·¸ ì¿¼ë¦¬
-- ê° ì¿¼ë¦¬ë¥¼ í•˜ë‚˜ì”© ì‹¤í–‰í•˜ì—¬ ë¬¸ì œë¥¼ ì°¾ìœ¼ì„¸ìš”

-- ============================================
-- 1ë‹¨ê³„: ì‹¤ì œ ë°ì´í„°ê°€ ìˆëŠ”ì§€ í™•ì¸
-- ============================================

-- 1-1. ì´ë²¤íŠ¸ ì´ ê°œìˆ˜ í™•ì¸
SELECT COUNT(*) as total_events FROM events;

-- 1-2. ë¯¸ë˜ ë‚ ì§œì˜ ì´ë²¤íŠ¸ ê°œìˆ˜ í™•ì¸
SELECT COUNT(*) as upcoming_events 
FROM events 
WHERE event_date >= NOW();

-- 1-3. ëª¨ë“  ì´ë²¤íŠ¸ ëª©ë¡ (ë‚ ì§œ í¬í•¨)
SELECT id, title, event_date, location, created_by
FROM events
ORDER BY event_date DESC
LIMIT 10;

-- 1-4. ê²Œì‹œê¸€ ì´ ê°œìˆ˜ í™•ì¸
SELECT COUNT(*) as total_posts FROM posts;

-- 1-5. board_category_idê°€ ì„¤ì •ëœ ê²Œì‹œê¸€ ê°œìˆ˜
SELECT COUNT(*) as posts_with_category 
FROM posts 
WHERE board_category_id IS NOT NULL;

-- 1-6. board_category_idê°€ NULLì¸ ê²Œì‹œê¸€ ê°œìˆ˜
SELECT COUNT(*) as posts_without_category 
FROM posts 
WHERE board_category_id IS NULL;

-- ============================================
-- 2ë‹¨ê³„: ì¹´í…Œê³ ë¦¬ ì—°ê²° í™•ì¸
-- ============================================

-- 2-1. Board Categories í™•ì¸
SELECT id, name, slug, is_active, order_index
FROM board_categories
ORDER BY order_index;

-- 2-2. Postsì™€ Categories ì¡°ì¸ í™•ì¸ (ì „ì²´)
SELECT 
  p.id,
  p.title,
  p.board_category_id,
  bc.id as category_id,
  bc.name as category_name,
  bc.slug as category_slug,
  bc.is_active
FROM posts p
LEFT JOIN board_categories bc ON p.board_category_id = bc.id
LIMIT 10;

-- 2-3. Postsì™€ Categories ì¡°ì¸ (í•„í„°ë§ ì¡°ê±´ ì ìš©)
SELECT 
  p.id,
  p.title,
  bc.slug as category_slug,
  bc.is_active
FROM posts p
INNER JOIN board_categories bc ON p.board_category_id = bc.id
WHERE bc.is_active = true
  AND bc.slug IN ('free', 'vangol', 'hightalk', 'free-board', 'bangol', 'announcement')
LIMIT 10;

-- ============================================
-- 3ë‹¨ê³„: ì‹¤ì œ í™ˆí˜ì´ì§€ ì¿¼ë¦¬ì™€ ë™ì¼í•˜ê²Œ í…ŒìŠ¤íŠ¸
-- ============================================

-- 3-1. ì´ë²¤íŠ¸ ì¿¼ë¦¬ í…ŒìŠ¤íŠ¸ (í”„ë¡œí•„ ì¡°ì¸ í¬í•¨)
SELECT 
  e.id,
  e.title,
  e.event_date,
  e.location,
  pr.full_name as host_name,
  pr.avatar_url as host_avatar_url
FROM events e
LEFT JOIN profiles pr ON e.created_by = pr.id
WHERE e.event_date >= NOW()
ORDER BY e.event_date ASC
LIMIT 9;

-- 3-2. ê²Œì‹œê¸€ ì¿¼ë¦¬ í…ŒìŠ¤íŠ¸ (ì¹´í…Œê³ ë¦¬ì™€ í”„ë¡œí•„ ì¡°ì¸ í¬í•¨)
SELECT 
  p.id,
  p.title,
  p.content,
  p.created_at,
  bc.name as category_name,
  bc.slug as category_slug,
  pr.full_name as author_name
FROM posts p
INNER JOIN board_categories bc ON p.board_category_id = bc.id
LEFT JOIN profiles pr ON p.author_id = pr.id
WHERE bc.is_active = true
  AND bc.slug IN ('free', 'vangol', 'hightalk', 'free-board', 'bangol')
  AND bc.slug != 'announcement'
ORDER BY p.created_at DESC
LIMIT 50;

-- ============================================
-- 4ë‹¨ê³„: RLS ì •ì±… í™•ì¸
-- ============================================

-- 4-1. SELECT ì •ì±… í™•ì¸
SELECT 
  tablename,
  policyname,
  cmd,
  qual,
  with_check
FROM pg_policies 
WHERE schemaname = 'public' 
AND tablename IN ('posts', 'events', 'board_categories', 'profiles', 'event_registrations')
AND cmd = 'SELECT'
ORDER BY tablename, policyname;

-- 4-2. RLS í™œì„±í™” ì—¬ë¶€
SELECT 
  tablename,
  rowsecurity as rls_enabled
FROM pg_tables 
WHERE schemaname = 'public' 
AND tablename IN ('posts', 'events', 'board_categories', 'profiles', 'event_registrations');

-- ============================================
-- 5ë‹¨ê³„: ìµëª… ì‚¬ìš©ì ì ‘ê·¼ í…ŒìŠ¤íŠ¸ (ì¤‘ìš”!)
-- ============================================

-- ì´ ì¿¼ë¦¬ë“¤ì€ Supabase SQL Editorì—ì„œ ì‹¤í–‰í•˜ë©´ 
-- í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì˜ ê¶Œí•œìœ¼ë¡œ ì‹¤í–‰ë©ë‹ˆë‹¤.
-- ìµëª… ì‚¬ìš©ìë¡œ í…ŒìŠ¤íŠ¸í•˜ë ¤ë©´ ì•±ì—ì„œ ì§ì ‘ í…ŒìŠ¤íŠ¸í•´ì•¼ í•©ë‹ˆë‹¤.

-- í˜„ì¬ ì‚¬ìš©ì í™•ì¸
SELECT auth.uid() as current_user_id, auth.role() as current_role;
</file>

<file path="scripts/022_fix_inner_join_rls.sql">
-- Inner Joinê³¼ RLS ì •ì±… ë¬¸ì œ í•´ê²°
-- board_categories!inner ì¡°ì¸ ì‹œ ìµëª… ì‚¬ìš©ìê°€ ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ ë³´ì¥

-- ë¬¸ì œ: board_categories!inner ì¡°ì¸ì„ ì‚¬ìš©í•  ë•Œ, 
-- ì¡°ì¸ëœ í…Œì´ë¸”(board_categories)ì— ëŒ€í•œ RLS ì •ì±…ë„ í•„ìš”í•¨

-- 1. Board Categories RLS ì •ì±… ê°•í™”
DROP POLICY IF EXISTS "Anyone can view active categories" ON board_categories;
CREATE POLICY "Anyone can view active categories"
ON board_categories
FOR SELECT
USING (is_active = true);

-- 2. Profiles RLS ì •ì±… ê°•í™” (ì´ë¯¸ ìˆì„ ìˆ˜ ìˆì§€ë§Œ ì¬í™•ì¸)
DROP POLICY IF EXISTS "Public profiles are viewable by everyone" ON profiles;
CREATE POLICY "Public profiles are viewable by everyone"
ON profiles
FOR SELECT
USING (true);

-- 3. Postsì™€ Board Categories ì¡°ì¸ì„ ìœ„í•œ ì¶”ê°€ ì •ì±… í™•ì¸
-- Posts í…Œì´ë¸”ì˜ SELECT ì •ì±…ì´ ì´ë¯¸ "using (true)"ë¡œ ì„¤ì •ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
-- ë§Œì•½ ì—†ìœ¼ë©´ ì•„ë˜ ì •ì±… ì¶”ê°€
DROP POLICY IF EXISTS "Posts are viewable by everyone" ON posts;
CREATE POLICY "Posts are viewable by everyone"
ON posts
FOR SELECT
USING (true);

-- 4. Events í…Œì´ë¸” SELECT ì •ì±… í™•ì¸
DROP POLICY IF EXISTS "Events are viewable by everyone" ON events;
CREATE POLICY "Events are viewable by everyone"
ON events
FOR SELECT
USING (true);

-- 5. Event Registrations ì§‘ê³„ í•¨ìˆ˜ ì ‘ê·¼ ì •ì±… í™•ì¸
DROP POLICY IF EXISTS "Event registrations are viewable by everyone" ON event_registrations;
CREATE POLICY "Event registrations are viewable by everyone"
ON event_registrations
FOR SELECT
USING (true);

-- ì¤‘ìš”: Inner Join ì‹œ ë‘ í…Œì´ë¸” ëª¨ë‘ì— SELECT ì •ì±…ì´ í•„ìš”í•¨
-- Postsì™€ Board Categoriesë¥¼ inner joiní•  ë•Œ:
-- - Posts í…Œì´ë¸”: SELECT ì •ì±… í•„ìš” âœ…
-- - Board Categories í…Œì´ë¸”: SELECT ì •ì±… í•„ìš” âœ…
-- - Profiles í…Œì´ë¸”: SELECT ì •ì±… í•„ìš” (LEFT JOINì´ì§€ë§Œ) âœ…

-- ì •ì±… í™•ì¸ ì¿¼ë¦¬
SELECT 
  tablename,
  policyname,
  cmd,
  qual
FROM pg_policies 
WHERE schemaname = 'public' 
AND tablename IN ('posts', 'events', 'board_categories', 'profiles', 'event_registrations')
AND cmd = 'SELECT'
ORDER BY tablename, policyname;
</file>

<file path="scripts/023_disable_realtime.sql">
-- Realtime ê¸°ëŠ¥ ë¹„í™œì„±í™” (ì„ íƒì‚¬í•­)
-- WebSocket ì—ëŸ¬ê°€ ë°œìƒí•˜ëŠ” ê²½ìš° Realtimeì„ ë¹„í™œì„±í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤

-- Realtimeì€ ê²Œì‹œíŒì—ì„œ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•œ ê¸°ëŠ¥ì…ë‹ˆë‹¤
-- ë§Œì•½ ì‹¤ì‹œê°„ ê¸°ëŠ¥ì´ í•„ìš”í•˜ì§€ ì•Šë‹¤ë©´ ë¹„í™œì„±í™” ê°€ëŠ¥

-- ì°¸ê³ : Realtimeì€ publicationì„ í†µí•´ í™œì„±í™”ë©ë‹ˆë‹¤
-- ì•„ë˜ ì¿¼ë¦¬ë¡œ í˜„ì¬ publication ìƒíƒœ í™•ì¸:
-- SELECT * FROM pg_publication_tables;

-- Realtime ë¹„í™œì„±í™”ëŠ” Supabase Dashboardì—ì„œ:
-- Database â†’ Replication â†’ í…Œì´ë¸”ë³„ë¡œ í† ê¸€

-- ë˜ëŠ” íŠ¹ì • í…Œì´ë¸”ë§Œ Realtime ë¹„í™œì„±í™”:
-- ALTER PUBLICATION supabase_realtime REMOVE TABLE posts;
-- ALTER PUBLICATION supabase_realtime REMOVE TABLE events;

-- ì°¸ê³ : ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” ì •ë³´ ì œê³µìš©ì´ë©°, 
-- ì‹¤ì œë¡œëŠ” Supabase Dashboardì—ì„œ Realtime ì„¤ì •ì„ ë³€ê²½í•˜ëŠ” ê²ƒì´ ë” ì•ˆì „í•©ë‹ˆë‹¤.
</file>

<file path="scripts/024_final_check_rls.sql">
-- ìµœì¢… RLS ì •ì±… í™•ì¸ ë° ê°•ì œ ì ìš©
-- ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” ëª¨ë“  ê³µê°œ ì½ê¸° ì •ì±…ì„ í™•ì‹¤í•˜ê²Œ ì„¤ì •í•©ë‹ˆë‹¤

-- ëª¨ë“  ê¸°ì¡´ SELECT ì •ì±… ì‚­ì œ (ì¤‘ë³µ ë°©ì§€)
DROP POLICY IF EXISTS "Posts are viewable by everyone" ON posts;
DROP POLICY IF EXISTS "Events are viewable by everyone" ON events;
DROP POLICY IF EXISTS "Anyone can view active categories" ON board_categories;
DROP POLICY IF EXISTS "Public profiles are viewable by everyone" ON profiles;
DROP POLICY IF EXISTS "Event registrations are viewable by everyone" ON event_registrations;
DROP POLICY IF EXISTS "Comments are viewable by everyone" ON comments;

-- 1. Posts - ëª¨ë“  ì‚¬ëŒì´ ì½ê¸° ê°€ëŠ¥
CREATE POLICY "Posts are viewable by everyone"
ON posts
FOR SELECT
TO public
USING (true);

-- 2. Events - ëª¨ë“  ì‚¬ëŒì´ ì½ê¸° ê°€ëŠ¥
CREATE POLICY "Events are viewable by everyone"
ON events
FOR SELECT
TO public
USING (true);

-- 3. Board Categories - í™œì„±í™”ëœ ì¹´í…Œê³ ë¦¬ëŠ” ëª¨ë“  ì‚¬ëŒì´ ì½ê¸° ê°€ëŠ¥
CREATE POLICY "Anyone can view active categories"
ON board_categories
FOR SELECT
TO public
USING (is_active = true);

-- 4. Profiles - ëª¨ë“  ì‚¬ëŒì´ ì½ê¸° ê°€ëŠ¥
CREATE POLICY "Public profiles are viewable by everyone"
ON profiles
FOR SELECT
TO public
USING (true);

-- 5. Event Registrations - ëª¨ë“  ì‚¬ëŒì´ ì½ê¸° ê°€ëŠ¥ (ì§‘ê³„ í•¨ìˆ˜ë¥¼ ìœ„í•´ í•„ìš”)
CREATE POLICY "Event registrations are viewable by everyone"
ON event_registrations
FOR SELECT
TO public
USING (true);

-- 6. Comments - ëª¨ë“  ì‚¬ëŒì´ ì½ê¸° ê°€ëŠ¥
CREATE POLICY "Comments are viewable by everyone"
ON comments
FOR SELECT
TO public
USING (true);

-- RLS í™œì„±í™” í™•ì¸ ë° ê°•ì œ ì„¤ì •
ALTER TABLE posts ENABLE ROW LEVEL SECURITY;
ALTER TABLE events ENABLE ROW LEVEL SECURITY;
ALTER TABLE board_categories ENABLE ROW LEVEL SECURITY;
ALTER TABLE profiles ENABLE ROW LEVEL SECURITY;
ALTER TABLE event_registrations ENABLE ROW LEVEL SECURITY;
ALTER TABLE comments ENABLE ROW LEVEL SECURITY;

-- ì •ì±… í™•ì¸
SELECT 
  tablename,
  policyname,
  permissive,
  roles,
  cmd,
  qual
FROM pg_policies 
WHERE schemaname = 'public' 
AND tablename IN ('posts', 'events', 'board_categories', 'profiles', 'event_registrations', 'comments')
AND cmd = 'SELECT'
ORDER BY tablename, policyname;
</file>

<file path="scripts/025_update_event_policies.sql">
-- ì´ë²¤íŠ¸ ê´€ë¦¬ì ê¶Œí•œ ì •ì±… ì—…ë°ì´íŠ¸
-- ê´€ë¦¬ì(admin, master)ê°€ ëª¨ë“  ì´ë²¤íŠ¸ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆë„ë¡ ì •ì±… ìˆ˜ì •
-- ì´ë²¤íŠ¸ ê°œì„¤ìê°€ event_registrationsì— ê²ŒìŠ¤íŠ¸ë¥¼ ë“±ë¡í•  ìˆ˜ ìˆë„ë¡ ì •ì±… ì¶”ê°€

-- 1. ì´ë²¤íŠ¸ í…Œì´ë¸” UPDATE ì •ì±…: ê´€ë¦¬ìë„ ìˆ˜ì • ê°€ëŠ¥
DROP POLICY IF EXISTS "Admins can update any events" ON events;
CREATE POLICY "Admins can update any events" ON events
  FOR UPDATE
  USING (
    auth.uid() = created_by OR
    EXISTS (
      SELECT 1 FROM profiles 
      WHERE profiles.id = auth.uid() 
      AND profiles.role IN ('admin', 'master')
    )
  );

-- 2. ì´ë²¤íŠ¸ í…Œì´ë¸” DELETE ì •ì±…: ê´€ë¦¬ìë„ ì‚­ì œ ê°€ëŠ¥
DROP POLICY IF EXISTS "Admins can delete any events" ON events;
CREATE POLICY "Admins can delete any events" ON events
  FOR DELETE
  USING (
    auth.uid() = created_by OR
    EXISTS (
      SELECT 1 FROM profiles 
      WHERE profiles.id = auth.uid() 
      AND profiles.role IN ('admin', 'master')
    )
  );

-- 3. ì´ë²¤íŠ¸ ë“±ë¡ í…Œì´ë¸” INSERT ì •ì±…: ì´ë²¤íŠ¸ ê°œì„¤ìê°€ ê²ŒìŠ¤íŠ¸ë¥¼ ë“±ë¡í•  ìˆ˜ ìˆë„ë¡ ì¶”ê°€
-- ê¸°ì¡´ ì •ì±…ì€ ìœ ì§€í•˜ê³ , ì´ë²¤íŠ¸ ê°œì„¤ìê°€ ê²ŒìŠ¤íŠ¸ë¥¼ ë“±ë¡í•  ìˆ˜ ìˆëŠ” ì •ì±… ì¶”ê°€
DROP POLICY IF EXISTS "Event creators can add guest registrations" ON event_registrations;
CREATE POLICY "Event creators can add guest registrations" ON event_registrations
  FOR INSERT
  WITH CHECK (
    -- ê¸°ì¡´: ì¸ì¦ëœ ì‚¬ìš©ìê°€ ìì‹ ì„ ë“±ë¡
    (auth.uid() = user_id) OR
    -- ìƒˆë¡œ ì¶”ê°€: ì´ë²¤íŠ¸ ê°œì„¤ìê°€ ê²ŒìŠ¤íŠ¸(user_idê°€ null)ë¥¼ ë“±ë¡
    (
      user_id IS NULL AND
      EXISTS (
        SELECT 1 FROM events 
        WHERE events.id = event_registrations.event_id 
        AND events.created_by = auth.uid()
      )
    )
  );

-- 4. ì´ë²¤íŠ¸ ë“±ë¡ í…Œì´ë¸” DELETE ì •ì±…: ì´ë²¤íŠ¸ ê°œì„¤ìê°€ ê²ŒìŠ¤íŠ¸ ë“±ë¡ì„ ì‚­ì œí•  ìˆ˜ ìˆë„ë¡ ì¶”ê°€
DROP POLICY IF EXISTS "Event creators can delete guest registrations" ON event_registrations;
CREATE POLICY "Event creators can delete guest registrations" ON event_registrations
  FOR DELETE
  USING (
    -- ê¸°ì¡´: ì‚¬ìš©ìê°€ ìì‹ ì˜ ë“±ë¡ì„ ì·¨ì†Œ
    auth.uid() = user_id OR
    -- ìƒˆë¡œ ì¶”ê°€: ì´ë²¤íŠ¸ ê°œì„¤ìê°€ ê²ŒìŠ¤íŠ¸ ë“±ë¡ì„ ì‚­ì œ
    (
      user_id IS NULL AND
      EXISTS (
        SELECT 1 FROM events 
        WHERE events.id = event_registrations.event_id 
        AND events.created_by = auth.uid()
      )
    )
  );

-- ì •ì±… ì ìš© í™•ì¸ ì¿¼ë¦¬
-- SELECT schemaname, tablename, policyname, permissive, roles, cmd, qual
-- FROM pg_policies
-- WHERE schemaname = 'public'
-- AND tablename IN ('events', 'event_registrations')
-- AND cmd IN ('UPDATE', 'DELETE', 'INSERT')
-- ORDER BY tablename, policyname;
</file>

<file path="scripts/026_fix_rls_visibility.sql">
-- RLS ê°€ì‹œì„± ë¬¸ì œ í•´ê²° ìŠ¤í¬ë¦½íŠ¸ (ê°•í™” ë²„ì „)
-- ë¡œê·¸ì¸ ì „/í›„ ëª¨ë‘ ë°ì´í„°ê°€ ë³´ì´ë„ë¡ ë³´ì¥
-- getLatestReviews í•¨ìˆ˜ì—ì„œ ì‚¬ìš©í•˜ëŠ” ëª¨ë“  í…Œì´ë¸”ì— ëŒ€í•´ "ëˆ„êµ¬ë‚˜ ì¡°íšŒ ê°€ëŠ¥" ì •ì±…ì„ ëª…ì‹œì ìœ¼ë¡œ ì„¤ì •
-- ìµëª… ì‚¬ìš©ì(ë¹„ë¡œê·¸ì¸)ë„ ëª¨ë“  ê³µê°œ ë°ì´í„°ë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆë„ë¡ ë³´ì¥

-- ============================================
-- 1ë‹¨ê³„: RLS í™œì„±í™” í™•ì¸ ë° ê°•ì œ ì„¤ì •
-- ============================================
ALTER TABLE public.events ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.posts ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.profiles ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.event_registrations ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.board_categories ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.comments ENABLE ROW LEVEL SECURITY;

-- ============================================
-- 2ë‹¨ê³„: ê¸°ì¡´ ì •ì±… ëª¨ë‘ ì‚­ì œ (ì¤‘ë³µ ë°©ì§€)
-- ============================================

-- Events í…Œì´ë¸” ì •ì±… ì‚­ì œ
DROP POLICY IF EXISTS "Events are viewable by everyone" ON public.events;
DROP POLICY IF EXISTS "Users can view their own events" ON public.events;
DROP POLICY IF EXISTS "Authenticated users can view events" ON public.events;
DROP POLICY IF EXISTS "Enable read access for all users" ON public.events;
DROP POLICY IF EXISTS "Anyone can view active categories" ON public.events;

-- Posts í…Œì´ë¸” ì •ì±… ì‚­ì œ
DROP POLICY IF EXISTS "Posts are viewable by everyone" ON public.posts;
DROP POLICY IF EXISTS "Users can view their own posts" ON public.posts;
DROP POLICY IF EXISTS "Enable read access for all users" ON public.posts;
DROP POLICY IF EXISTS "Allow public read access" ON public.posts;

-- Profiles í…Œì´ë¸” ì •ì±… ì‚­ì œ
DROP POLICY IF EXISTS "Public profiles are viewable by everyone" ON public.profiles;
DROP POLICY IF EXISTS "Users can view own profile" ON public.profiles;
DROP POLICY IF EXISTS "Enable read access for all users" ON public.profiles;

-- Event Registrations í…Œì´ë¸” ì •ì±… ì‚­ì œ
DROP POLICY IF EXISTS "Event registrations are viewable by everyone" ON public.event_registrations;
DROP POLICY IF EXISTS "Anyone can view registrations" ON public.event_registrations;
DROP POLICY IF EXISTS "Enable read access for all users" ON public.event_registrations;

-- Board Categories í…Œì´ë¸” ì •ì±… ì‚­ì œ
DROP POLICY IF EXISTS "Anyone can view active categories" ON public.board_categories;
DROP POLICY IF EXISTS "Enable read access for all users" ON public.board_categories;

-- Comments í…Œì´ë¸” ì •ì±… ì‚­ì œ
DROP POLICY IF EXISTS "Comments are viewable by everyone" ON public.comments;
DROP POLICY IF EXISTS "Enable read access for all users" ON public.comments;

-- ============================================
-- 3ë‹¨ê³„: ìƒˆë¡œìš´ ì •ì±… ìƒì„± (í†µì¼ëœ ì´ë¦„ ì‚¬ìš©)
-- ============================================

-- 1. ì´ë²¤íŠ¸ í…Œì´ë¸”: ëˆ„êµ¬ë‚˜ ì¡°íšŒ ê°€ëŠ¥ (getLatestReviewsì—ì„œ events ì¡°ì¸ ì‹œ í•„ìš”)
CREATE POLICY "Enable read access for all users"
ON public.events FOR SELECT
TO public
USING (true);

-- 2. ê²Œì‹œê¸€ í…Œì´ë¸”: ëˆ„êµ¬ë‚˜ ì¡°íšŒ ê°€ëŠ¥ (getLatestReviewsì˜ ë©”ì¸ í…Œì´ë¸”)
CREATE POLICY "Enable read access for all users"
ON public.posts FOR SELECT
TO public
USING (true);

-- 3. í”„ë¡œí•„ í…Œì´ë¸”: ëˆ„êµ¬ë‚˜ ì¡°íšŒ ê°€ëŠ¥ (ì‘ì„±ì ì •ë³´ í‘œì‹œìš©)
CREATE POLICY "Enable read access for all users"
ON public.profiles FOR SELECT
TO public
USING (true);

-- 4. ì´ë²¤íŠ¸ ë“±ë¡ í…Œì´ë¸”: ëˆ„êµ¬ë‚˜ ì¡°íšŒ ê°€ëŠ¥ (ì°¸ê°€ì ìˆ˜ ì§‘ê³„ìš©)
CREATE POLICY "Enable read access for all users"
ON public.event_registrations FOR SELECT
TO public
USING (true);

-- 5. ê²Œì‹œíŒ ì¹´í…Œê³ ë¦¬ í…Œì´ë¸”: í™œì„±í™”ëœ ì¹´í…Œê³ ë¦¬ë§Œ ëˆ„êµ¬ë‚˜ ì¡°íšŒ ê°€ëŠ¥ (í•„í„°ë§ìš©)
CREATE POLICY "Enable read access for all users"
ON public.board_categories FOR SELECT
TO public
USING (is_active = true);

-- 6. ëŒ“ê¸€ í…Œì´ë¸”: ëˆ„êµ¬ë‚˜ ì¡°íšŒ ê°€ëŠ¥
CREATE POLICY "Enable read access for all users"
ON public.comments FOR SELECT
TO public
USING (true);

-- ============================================
-- 4ë‹¨ê³„: ì •ì±… ì ìš© í™•ì¸ ì¿¼ë¦¬
-- ============================================
-- ì•„ë˜ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•˜ì—¬ ëª¨ë“  ì •ì±…ì´ ì˜¬ë°”ë¥´ê²Œ ì„¤ì •ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”

SELECT 
  schemaname,
  tablename,
  policyname,
  permissive,
  roles,
  cmd,
  qual,
  CASE 
    WHEN qual LIKE '%true%' OR qual IS NULL THEN 'âœ… Public Access'
    ELSE 'âš ï¸ Restricted'
  END as access_type
FROM pg_policies
WHERE schemaname = 'public'
AND tablename IN ('events', 'posts', 'profiles', 'event_registrations', 'board_categories', 'comments')
AND cmd = 'SELECT'
ORDER BY tablename, policyname;

-- ============================================
-- 5ë‹¨ê³„: ìµëª… ì‚¬ìš©ì ì ‘ê·¼ í…ŒìŠ¤íŠ¸ ì¿¼ë¦¬
-- ============================================
-- ì•„ë˜ ì¿¼ë¦¬ë“¤ì„ ìµëª… ì‚¬ìš©ìë¡œ ì‹¤í–‰í•˜ì—¬ ì ‘ê·¼ ê°€ëŠ¥ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ì„¸ìš”
-- (Supabase SQL Editorì—ì„œ "Run as" â†’ "anon" ì„ íƒ í›„ ì‹¤í–‰)

-- í…ŒìŠ¤íŠ¸ 1: Posts ì¡°íšŒ
-- SELECT COUNT(*) FROM public.posts;

-- í…ŒìŠ¤íŠ¸ 2: Board Categories ì¡°íšŒ
-- SELECT COUNT(*) FROM public.board_categories WHERE is_active = true;

-- í…ŒìŠ¤íŠ¸ 3: Events ì¡°íšŒ
-- SELECT COUNT(*) FROM public.events;

-- í…ŒìŠ¤íŠ¸ 4: Profiles ì¡°íšŒ
-- SELECT COUNT(*) FROM public.profiles;

-- í…ŒìŠ¤íŠ¸ 5: getLatestReviewsì™€ ë™ì¼í•œ ì¿¼ë¦¬ êµ¬ì¡° í…ŒìŠ¤íŠ¸
-- SELECT 
--   p.id,
--   p.title,
--   p.content,
--   p.created_at,
--   profiles:author_id(id, full_name, avatar_url),
--   events:related_event_id(id, title, thumbnail_url),
--   board_categories!inner(name, slug)
-- FROM public.posts p
-- WHERE board_categories.slug = 'reviews'
-- LIMIT 10;
</file>

<file path="scripts/027_point_system_full.sql">
-- í¬ì¸íŠ¸ ì´ì½”ë…¸ë¯¸ ì‹œìŠ¤í…œ ì „ì²´ êµ¬ì¶•
-- ì ë¦½ ê·œì¹™: ë§¤ì¼ ë¡œê·¸ì¸(+1P), ê²Œì‹œê¸€ ì‘ì„±(+5P), ëŒ“ê¸€ ì‘ì„±(+2P), ì´ë²¤íŠ¸ ê°œì„¤(+50P)
-- ì‚¬ìš© ê·œì¹™: ìµœì†Œ 100P ì´ìƒë¶€í„° ì‚¬ìš© ê°€ëŠ¥, 1P ë‹¨ìœ„ ììœ ë¡­ê²Œ ì‚¬ìš©

-- ============================================
-- 1. ì¼ì¼ ë¡œê·¸ì¸ í¬ì¸íŠ¸ í•¨ìˆ˜ ìˆ˜ì • (5P -> 1P)
-- ============================================
CREATE OR REPLACE FUNCTION check_daily_login_points()
RETURNS void AS $$
DECLARE
  current_user_id UUID := auth.uid();
  last_login DATE;
BEGIN
  IF current_user_id IS NULL THEN
    RETURN;
  END IF;
  
  SELECT last_login_date INTO last_login
  FROM profiles
  WHERE id = current_user_id;
  
  -- ì˜¤ëŠ˜ ì²« ë¡œê·¸ì¸ì´ë©´ í¬ì¸íŠ¸ ì§€ê¸‰ (1P)
  IF last_login IS NULL OR last_login < CURRENT_DATE THEN
    PERFORM award_points(
      current_user_id,
      1,  -- ë§¤ì¼ ë¡œê·¸ì¸: +1P
      'daily_login',
      'ì¼ì¼ ë¡œê·¸ì¸ ë³´ìƒ'
    );
    
    UPDATE profiles
    SET last_login_date = CURRENT_DATE
    WHERE id = current_user_id;
  END IF;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

-- ============================================
-- 2. ê²Œì‹œê¸€ ì‘ì„± ì‹œ í¬ì¸íŠ¸ ì§€ê¸‰ íŠ¸ë¦¬ê±°
-- ============================================
CREATE OR REPLACE FUNCTION award_points_on_post_insert()
RETURNS TRIGGER AS $$
BEGIN
  -- ê²Œì‹œê¸€ ì‘ì„± ì‹œ +5P ì§€ê¸‰
  PERFORM award_points(
    NEW.author_id,
    5,
    'post_creation',
    'ê²Œì‹œê¸€ ì‘ì„± ë³´ìƒ',
    NULL
  );
  
  RETURN NEW;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

DROP TRIGGER IF EXISTS trigger_award_points_on_post_insert ON posts;
CREATE TRIGGER trigger_award_points_on_post_insert
  AFTER INSERT ON posts
  FOR EACH ROW
  EXECUTE FUNCTION award_points_on_post_insert();

-- ============================================
-- 3. ëŒ“ê¸€ ì‘ì„± ì‹œ í¬ì¸íŠ¸ ì§€ê¸‰ íŠ¸ë¦¬ê±°
-- ============================================
CREATE OR REPLACE FUNCTION award_points_on_comment_insert()
RETURNS TRIGGER AS $$
BEGIN
  -- ëŒ“ê¸€ ì‘ì„± ì‹œ +2P ì§€ê¸‰
  PERFORM award_points(
    NEW.author_id,
    2,
    'comment_creation',
    'ëŒ“ê¸€ ì‘ì„± ë³´ìƒ',
    NULL
  );
  
  RETURN NEW;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

DROP TRIGGER IF EXISTS trigger_award_points_on_comment_insert ON comments;
CREATE TRIGGER trigger_award_points_on_comment_insert
  AFTER INSERT ON comments
  FOR EACH ROW
  EXECUTE FUNCTION award_points_on_comment_insert();

-- ============================================
-- 4. ì´ë²¤íŠ¸ ê°œì„¤ ì‹œ í¬ì¸íŠ¸ ì§€ê¸‰ íŠ¸ë¦¬ê±°
-- ============================================
CREATE OR REPLACE FUNCTION award_points_on_event_insert()
RETURNS TRIGGER AS $$
BEGIN
  -- ì´ë²¤íŠ¸ ê°œì„¤ ì‹œ +50P ì§€ê¸‰
  PERFORM award_points(
    NEW.created_by,
    50,
    'event_creation',
    'ì´ë²¤íŠ¸ ê°œì„¤ ë³´ìƒ',
    NEW.id
  );
  
  RETURN NEW;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

DROP TRIGGER IF EXISTS trigger_award_points_on_event_insert ON events;
CREATE TRIGGER trigger_award_points_on_event_insert
  AFTER INSERT ON events
  FOR EACH ROW
  EXECUTE FUNCTION award_points_on_event_insert();

-- ============================================
-- 5. í¬ì¸íŠ¸ ì‚¬ìš© í•¨ìˆ˜ (ì´ë²¤íŠ¸ ì‹ ì²­ ì‹œ ì‚¬ìš©)
-- ============================================
CREATE OR REPLACE FUNCTION register_event_with_points(
  p_event_id UUID,
  p_user_id UUID,
  p_used_points INTEGER DEFAULT 0
)
RETURNS UUID AS $$
DECLARE
  v_user_points INTEGER;
  v_registration_id UUID;
  v_event_cost INTEGER;
BEGIN
  -- í¬ì¸íŠ¸ ì‚¬ìš© ê²€ì¦
  IF p_used_points > 0 THEN
    -- ìµœì†Œ ì‚¬ìš© í•œë„ ì²´í¬ (100P ë¯¸ë§Œ ì‚¬ìš© ì‹œë„ ì‹œ ì—ëŸ¬)
    IF p_used_points < 100 THEN
      RAISE EXCEPTION 'í¬ì¸íŠ¸ëŠ” ìµœì†Œ 100 P ì´ìƒë¶€í„° ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.';
    END IF;
    
    -- ë³´ìœ  í¬ì¸íŠ¸ ì²´í¬
    SELECT points INTO v_user_points
    FROM profiles
    WHERE id = p_user_id;
    
    IF v_user_points IS NULL OR v_user_points < p_used_points THEN
      RAISE EXCEPTION 'ë³´ìœ  í¬ì¸íŠ¸ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.';
    END IF;
    
    -- ì´ë²¤íŠ¸ í¬ì¸íŠ¸ ë¹„ìš© ì²´í¬ (ì„ íƒì‚¬í•­)
    SELECT point_cost INTO v_event_cost
    FROM events
    WHERE id = p_event_id;
    
    IF v_event_cost IS NOT NULL AND v_event_cost > 0 THEN
      -- ì´ë²¤íŠ¸ ë¹„ìš©ë³´ë‹¤ ë§ì´ ì‚¬ìš©í•  ìˆ˜ ì—†ìŒ
      IF p_used_points > v_event_cost THEN
        RAISE EXCEPTION 'ì‚¬ìš© ê°€ëŠ¥í•œ í¬ì¸íŠ¸ëŠ” ì´ë²¤íŠ¸ ë¹„ìš©(%P)ì„ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', v_event_cost;
      END IF;
    END IF;
  END IF;
  
  -- í¬ì¸íŠ¸ ì°¨ê°
  IF p_used_points > 0 THEN
    UPDATE profiles
    SET points = points - p_used_points
    WHERE id = p_user_id;
    
    -- í¬ì¸íŠ¸ ì‚¬ìš© íŠ¸ëœì­ì…˜ ê¸°ë¡
    INSERT INTO point_transactions (user_id, amount, type, description, related_event_id)
    VALUES (
      p_user_id,
      -p_used_points,  -- ìŒìˆ˜ë¡œ ê¸°ë¡ (ì‚¬ìš©)
      'event_payment',
      'ì´ë²¤íŠ¸ ì‹ ì²­ í¬ì¸íŠ¸ ì‚¬ìš©',
      p_event_id
    );
  END IF;
  
  -- ì´ë²¤íŠ¸ ë“±ë¡
  INSERT INTO event_registrations (event_id, user_id)
  VALUES (p_event_id, p_user_id)
  ON CONFLICT (event_id, user_id) DO NOTHING
  RETURNING id INTO v_registration_id;
  
  -- ë“±ë¡ ì‹¤íŒ¨ ì²´í¬ (ì´ë¯¸ ë“±ë¡ëœ ê²½ìš°)
  IF v_registration_id IS NULL THEN
    -- ì´ë¯¸ ë“±ë¡ëœ ê²½ìš° í¬ì¸íŠ¸ í™˜ë¶ˆ
    IF p_used_points > 0 THEN
      UPDATE profiles
      SET points = points + p_used_points
      WHERE id = p_user_id;
      
      -- í™˜ë¶ˆ íŠ¸ëœì­ì…˜ ê¸°ë¡
      INSERT INTO point_transactions (user_id, amount, type, description, related_event_id)
      VALUES (
        p_user_id,
        p_used_points,
        'event_refund',
        'ì´ë²¤íŠ¸ ì¤‘ë³µ ì‹ ì²­ í¬ì¸íŠ¸ í™˜ë¶ˆ',
        p_event_id
      );
    END IF;
    
    RAISE EXCEPTION 'ì´ë¯¸ ë“±ë¡ëœ ì´ë²¤íŠ¸ì…ë‹ˆë‹¤.';
  END IF;
  
  -- ì´ë²¤íŠ¸ ì°¸ì—¬ ë³´ìƒ ì§€ê¸‰ (ì£¼ì„ ì²˜ë¦¬ë¨)
  -- PERFORM award_points(
  --   p_user_id,
  --   10,
  --   'event_participation',
  --   'ì´ë²¤íŠ¸ ì°¸ì—¬ ë³´ìƒ',
  --   p_event_id
  -- );
  
  RETURN v_registration_id;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

-- ============================================
-- ì •ì±… ì—…ë°ì´íŠ¸: í¬ì¸íŠ¸ ê±°ë˜ ë‚´ì—­ ì¡°íšŒ
-- ============================================
DROP POLICY IF EXISTS "Users can view their own transactions" ON point_transactions;
CREATE POLICY "Users can view their own transactions" ON point_transactions
  FOR SELECT USING (auth.uid() = user_id);

DROP POLICY IF EXISTS "System can insert transactions" ON point_transactions;
CREATE POLICY "System can insert transactions" ON point_transactions
  FOR INSERT WITH CHECK (true);

-- ============================================
-- í…ŒìŠ¤íŠ¸ ë° í™•ì¸ ì¿¼ë¦¬ (ì£¼ì„ í•´ì œí•˜ì—¬ ì‹¤í–‰ ê°€ëŠ¥)
-- ============================================
-- í¬ì¸íŠ¸ ê±°ë˜ ë‚´ì—­ í™•ì¸
-- SELECT * FROM point_transactions 
-- WHERE user_id = auth.uid() 
-- ORDER BY created_at DESC 
-- LIMIT 10;

-- í˜„ì¬ í¬ì¸íŠ¸ í™•ì¸
-- SELECT id, full_name, points, last_login_date 
-- FROM profiles 
-- WHERE id = auth.uid();
</file>

<file path="scripts/030_badge_system.sql">
-- ë±ƒì§€ ì‹œìŠ¤í…œ í…Œì´ë¸” ìƒì„± ë° ë°ì´í„° ì‹œë”©
-- ìµœì¢… ê°œí¸ì•ˆ (ê°œì¸ìì‚°/ê¸°ì—…ë§¤ì¶œ ë¶„ë¦¬, 30ì–µ/50ì–µ í‹°ì–´ ì¶”ê°€) ë°˜ì˜

-- 1. í…Œì´ë¸” êµ¬ì¡°ëŠ” ê¸°ì¡´ê³¼ ë™ì¼í•˜ê²Œ ìœ ì§€

-- 2. RLS ì •ì±…ì€ ê¸°ì¡´ê³¼ ë™ì¼í•˜ê²Œ ìœ ì§€ (ëª¨ë‘ì—ê²Œ ì¡°íšŒ ê°€ëŠ¥, ë³¸ì¸ ë° ê´€ë¦¬ìë§Œ ìˆ˜ì • ê°€ëŠ¥)

-- 3. ë±ƒì§€ ë°ì´í„° ì´ˆê¸°í™”
DELETE FROM user_badges;
DELETE FROM badges;

INSERT INTO badges (name, icon, category, description) VALUES

-- [1] ê°œì¸ ìì‚° (Asset) - 3 tiers (5ì–µ, 10ì–µ, 50ì–µ)
('ìì‚° 5ì–µ+', 'ğŸ’°', 'personal_asset', 'ìˆœìì‚° 5ì–µ ì› ì´ìƒ ì¸ì¦'),
('ìì‚° 10ì–µ+', 'ğŸ’', 'personal_asset', 'ìˆœìì‚° 10ì–µ ì› ì´ìƒ ì¸ì¦'),
('ìì‚° 50ì–µ+', 'ğŸ’', 'personal_asset', 'ìˆœìì‚° 50ì–µ ì› ì´ìƒ ì¸ì¦'),

-- [2] ê¸°ì—… ë§¤ì¶œ (Revenue) - 3 tiers (10ì–µ, 50ì–µ, 100ì–µ)
('ë§¤ì¶œ 10ì–µ+', 'ğŸ“ˆ', 'corporate_revenue', 'ì—° ë§¤ì¶œ 10ì–µ ì› ì´ìƒ ì¸ì¦'),
('ë§¤ì¶œ 50ì–µ+', 'ğŸ“ˆ', 'corporate_revenue', 'ì—° ë§¤ì¶œ 50ì–µ ì› ì´ìƒ ì¸ì¦'),
('ë§¤ì¶œ 100ì–µ+', 'ğŸ“ˆ', 'corporate_revenue', 'ì—° ë§¤ì¶œ 100ì–µ ì› ì´ìƒ ì¸ì¦'),

-- [3] íˆ¬ì ê·œëª¨ (Investment Tier) - 6 tiers (1ì–µ ~ 100ì–µ)
('íˆ¬ì 1ì–µ+', 'ğŸ’°', 'investment', 'ëˆ„ì  íˆ¬ì ì§‘í–‰ì•¡ 1ì–µ ì› ì´ìƒ'),
('íˆ¬ì 5ì–µ+', 'ğŸ’°', 'investment', 'ëˆ„ì  íˆ¬ì ì§‘í–‰ì•¡ 5ì–µ ì› ì´ìƒ'),
('íˆ¬ì 10ì–µ+', 'ğŸ’°', 'investment', 'ëˆ„ì  íˆ¬ì ì§‘í–‰ì•¡ 10ì–µ ì› ì´ìƒ'),
('íˆ¬ì 30ì–µ+', 'ğŸ’°', 'investment', 'ëˆ„ì  íˆ¬ì ì§‘í–‰ì•¡ 30ì–µ ì› ì´ìƒ'),
('íˆ¬ì 50ì–µ+', 'ğŸ’°', 'investment', 'ëˆ„ì  íˆ¬ì ì§‘í–‰ì•¡ 50ì–µ ì› ì´ìƒ'),
('íˆ¬ì 100ì–µ+', 'ğŸ’°', 'investment', 'ëˆ„ì  íˆ¬ì ì§‘í–‰ì•¡ 100ì–µ ì› ì´ìƒ'),

-- [4] ê¸°ì—…ê°€ì¹˜ (Valuation Tier) - 6 tiers (30ì–µ ~ ìœ ë‹ˆì½˜)
('ê¸°ì—…ê°€ì¹˜ 30ì–µ+', 'ğŸ™ï¸', 'valuation', 'ìµœê·¼ íˆ¬ì ìœ ì¹˜ ê¸°ì¤€ ê¸°ì—…ê°€ì¹˜ 30ì–µ ì› ì´ìƒ'),
('ê¸°ì—…ê°€ì¹˜ 50ì–µ+', 'ğŸ™ï¸', 'valuation', 'ìµœê·¼ íˆ¬ì ìœ ì¹˜ ê¸°ì¤€ ê¸°ì—…ê°€ì¹˜ 50ì–µ ì› ì´ìƒ'),
('ê¸°ì—…ê°€ì¹˜ 100ì–µ+', 'ğŸ™ï¸', 'valuation', 'ìµœê·¼ íˆ¬ì ìœ ì¹˜ ê¸°ì¤€ ê¸°ì—…ê°€ì¹˜ 100ì–µ ì› ì´ìƒ'),
('ê¸°ì—…ê°€ì¹˜ 300ì–µ+', 'ğŸ™ï¸', 'valuation', 'ìµœê·¼ íˆ¬ì ìœ ì¹˜ ê¸°ì¤€ ê¸°ì—…ê°€ì¹˜ 300ì–µ ì› ì´ìƒ'),
('ê¸°ì—…ê°€ì¹˜ 1000ì–µ+', 'ğŸ™ï¸', 'valuation', 'ìµœê·¼ íˆ¬ì ìœ ì¹˜ ê¸°ì¤€ ê¸°ì—…ê°€ì¹˜ 1000ì–µ ì› ì´ìƒ'),
('ìœ ë‹ˆì½˜+', 'ğŸ¦„', 'valuation', 'ê¸°ì—…ê°€ì¹˜ 1ì¡° ì› ì´ìƒ (ìœ ë‹ˆì½˜)'),

-- [5] ì¸í”Œë£¨ì–¸ì„œ (Influence Tier) - 6 tiers (1ë§Œ ~ 100ë§Œ)
('íŒ”ë¡œì›Œ 1ë§Œ+', 'ğŸ“£', 'influence', 'SNS íŒ”ë¡œì›Œ 1ë§Œ ëª… ì´ìƒ'),
('íŒ”ë¡œì›Œ 5ë§Œ+', 'ğŸ”¥', 'influence', 'SNS íŒ”ë¡œì›Œ 5ë§Œ ëª… ì´ìƒ'),
('íŒ”ë¡œì›Œ 10ë§Œ+', 'â­', 'influence', 'SNS íŒ”ë¡œì›Œ 10ë§Œ ëª… ì´ìƒ'),
('íŒ”ë¡œì›Œ 20ë§Œ+', 'ğŸ‘‘', 'influence', 'SNS íŒ”ë¡œì›Œ 20ë§Œ ëª… ì´ìƒ'),
('íŒ”ë¡œì›Œ 50ë§Œ+', 'ğŸš€', 'influence', 'SNS íŒ”ë¡œì›Œ 50ë§Œ ëª… ì´ìƒ'),
('íŒ”ë¡œì›Œ 100ë§Œ+', 'ğŸŒŒ', 'influence', 'SNS íŒ”ë¡œì›Œ 100ë§Œ ëª… ì´ìƒ'),

-- [6] ì „ë¬¸ì§ (Professional License) - 9 tiers
('ë³€í˜¸ì‚¬', 'âš–ï¸', 'professional', 'ëŒ€í•œë¯¼êµ­ ë³€í˜¸ì‚¬ ìê²© ì¸ì¦'),
('ê³µì¸íšŒê³„ì‚¬', 'ğŸ“˜', 'professional', 'ëŒ€í•œë¯¼êµ­ ê³µì¸íšŒê³„ì‚¬ ìê²© ì¸ì¦'),
('ì„¸ë¬´ì‚¬', 'ğŸ§¾', 'professional', 'ëŒ€í•œë¯¼êµ­ ì„¸ë¬´ì‚¬ ìê²© ì¸ì¦'),
('ë³€ë¦¬ì‚¬', 'ğŸ’¡', 'professional', 'ëŒ€í•œë¯¼êµ­ ë³€ë¦¬ì‚¬ ìê²© ì¸ì¦'),
('ë…¸ë¬´ì‚¬', 'ğŸ¤', 'professional', 'ëŒ€í•œë¯¼êµ­ ê³µì¸ë…¸ë¬´ì‚¬ ìê²© ì¸ì¦'),
('ì˜ì‚¬', 'ğŸ©º', 'professional', 'ëŒ€í•œë¯¼êµ­ ì˜ì‚¬ ë©´í—ˆ ì¸ì¦'),
('í•œì˜ì‚¬', 'ğŸŒ¿', 'professional', 'ëŒ€í•œë¯¼êµ­ í•œì˜ì‚¬ ë©´í—ˆ ì¸ì¦'),
('ìˆ˜ì˜ì‚¬', 'ğŸ¾', 'professional', 'ëŒ€í•œë¯¼êµ­ ìˆ˜ì˜ì‚¬ ë©´í—ˆ ì¸ì¦'),
('ì•½ì‚¬', 'ğŸ’Š', 'professional', 'ëŒ€í•œë¯¼êµ­ ì•½ì‚¬ ë©´í—ˆ ì¸ì¦'),

-- [7] ì»¤ë®¤ë‹ˆí‹° (Community) - 3 tiers (ì„ ì°©ìˆœ 100ì¸ + ìš´ì˜ì§„ + í™œë™ íšŒì›)
('ì„ ì°©ìˆœ 100ì¸', 'ğŸ‘‘', 'community', 'SFC ì´ˆê¸° ê°€ì… ë©¤ë²„ (ë¡œì—´í‹°)'),
('ì»¤ë®¤ë‹ˆí‹° ë¦¬ë”', 'ğŸ›¡ï¸', 'community', 'SFC ì»¤ë®¤ë‹ˆí‹° ìš´ì˜ì§„ ë° ë¦¬ë”'),
('ìš°ìˆ˜í™œë™ íšŒì›', 'ğŸŒŸ', 'community', 'ì»¤ë®¤ë‹ˆí‹° ë‚´ í™œë™ ì§€ìˆ˜ ìƒìœ„ 1% íšŒì›');
</file>

<file path="scripts/031_add_badge_status_and_evidence.sql">
-- user_badges í…Œì´ë¸”ì— statusì™€ evidence ì»¬ëŸ¼ ì¶”ê°€
-- ë±ƒì§€ ì‹ ì²­ ë° ê²€ì¦ í”„ë¡œì„¸ìŠ¤ ì§€ì›

-- 1. status ì»¬ëŸ¼ ì¶”ê°€ (pending, approved, rejected)
ALTER TABLE user_badges 
ADD COLUMN IF NOT EXISTS status TEXT DEFAULT 'pending' CHECK (status IN ('pending', 'approved', 'rejected'));

-- 2. evidence ì»¬ëŸ¼ ì¶”ê°€ (ì¦ë¹™ ìë£Œ)
ALTER TABLE user_badges 
ADD COLUMN IF NOT EXISTS evidence TEXT;

-- 3. ê¸°ì¡´ ë°ì´í„° ì²˜ë¦¬: statusê°€ ì—†ëŠ” ê²½ìš° 'approved'ë¡œ ì„¤ì • (ê¸°ì¡´ ë±ƒì§€ëŠ” ëª¨ë‘ ìŠ¹ì¸ëœ ê²ƒìœ¼ë¡œ ê°„ì£¼)
UPDATE user_badges 
SET status = 'approved' 
WHERE status IS NULL;

-- 4. ì¸ë±ìŠ¤ ì¶”ê°€ (ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ pending ìƒíƒœ ì¡°íšŒ ìµœì í™”)
CREATE INDEX IF NOT EXISTS idx_user_badges_status ON user_badges(status);
CREATE INDEX IF NOT EXISTS idx_user_badges_user_status ON user_badges(user_id, status);
</file>

<file path="scripts/031_create_communities.sql">
-- ì†Œëª¨ì„(Communities) ì‹œìŠ¤í…œ í…Œì´ë¸” ìƒì„± ë° RLS ì •ì±…
-- ë©¤ë²„(Member) ê¸°ëŠ¥ì„ ìœ„í•œ communities ë° community_members í…Œì´ë¸”

-- 1. communities í…Œì´ë¸” ìƒì„±
CREATE TABLE IF NOT EXISTS public.communities (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  name text NOT NULL,
  description text,
  thumbnail_url text,
  created_by uuid REFERENCES public.profiles(id) ON DELETE CASCADE NOT NULL,
  created_at timestamptz DEFAULT now() NOT NULL,
  updated_at timestamptz DEFAULT now() NOT NULL,
  is_private boolean DEFAULT false NOT NULL
);

-- 2. community_members í…Œì´ë¸” ìƒì„±
CREATE TABLE IF NOT EXISTS public.community_members (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  community_id uuid REFERENCES public.communities(id) ON DELETE CASCADE NOT NULL,
  user_id uuid REFERENCES public.profiles(id) ON DELETE CASCADE NOT NULL,
  role text NOT NULL DEFAULT 'member' CHECK (role IN ('owner', 'admin', 'member')),
  joined_at timestamptz DEFAULT now() NOT NULL,
  UNIQUE(community_id, user_id)
);

-- 3. posts í…Œì´ë¸”ì— community_id ì»¬ëŸ¼ ì¶”ê°€ (ì´ë¯¸ ìˆìœ¼ë©´ ë¬´ì‹œ)
DO $$ 
BEGIN
  IF NOT EXISTS (
    SELECT 1 FROM information_schema.columns 
    WHERE table_schema = 'public' 
    AND table_name = 'posts' 
    AND column_name = 'community_id'
  ) THEN
    ALTER TABLE public.posts ADD COLUMN community_id uuid REFERENCES public.communities(id) ON DELETE SET NULL;
  END IF;
END $$;

-- 4. RLS í™œì„±í™”
ALTER TABLE public.communities ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.community_members ENABLE ROW LEVEL SECURITY;

-- 5. Communities RLS ì •ì±…
-- 5-1. ëª¨ë“  ì‚¬ìš©ìê°€ communities ì¡°íšŒ ê°€ëŠ¥ (ì†Œê°œëŠ” ì „ì²´ ê³µê°œ)
DROP POLICY IF EXISTS "Communities are viewable by everyone" ON public.communities;
CREATE POLICY "Communities are viewable by everyone"
  ON public.communities
  FOR SELECT
  USING (true);

-- 5-2. ë¡œê·¸ì¸í•œ ì‚¬ìš©ìê°€ communities ìƒì„± ê°€ëŠ¥
DROP POLICY IF EXISTS "Authenticated users can create communities" ON public.communities;
CREATE POLICY "Authenticated users can create communities"
  ON public.communities
  FOR INSERT
  WITH CHECK (auth.role() = 'authenticated');

-- 5-3. ì†Œëª¨ì„ ì†Œìœ ì ë° ê´€ë¦¬ìê°€ ìˆ˜ì • ê°€ëŠ¥
DROP POLICY IF EXISTS "Community owners and admins can update" ON public.communities;
CREATE POLICY "Community owners and admins can update"
  ON public.communities
  FOR UPDATE
  USING (
    created_by = auth.uid() OR
    EXISTS (
      SELECT 1 FROM public.community_members
      WHERE community_members.community_id = communities.id
      AND community_members.user_id = auth.uid()
      AND community_members.role IN ('owner', 'admin')
    )
  );

-- 5-4. ì†Œëª¨ì„ ì†Œìœ ìë§Œ ì‚­ì œ ê°€ëŠ¥
DROP POLICY IF EXISTS "Community owners can delete" ON public.communities;
CREATE POLICY "Community owners can delete"
  ON public.communities
  FOR DELETE
  USING (created_by = auth.uid());

-- 6. Community Members RLS ì •ì±…
-- 6-1. ëª¨ë“  ì‚¬ìš©ìê°€ community_members ì¡°íšŒ ê°€ëŠ¥ (ë©¤ë²„ ëª©ë¡ì€ ê³µê°œ)
DROP POLICY IF EXISTS "Community members are viewable by everyone" ON public.community_members;
CREATE POLICY "Community members are viewable by everyone"
  ON public.community_members
  FOR SELECT
  USING (true);

-- 6-2. ë³¸ì¸ë§Œ ê°€ì… ê°€ëŠ¥ (ê°€ì…ì€ ë³¸ì¸ë§Œ)
DROP POLICY IF EXISTS "Users can join communities" ON public.community_members;
CREATE POLICY "Users can join communities"
  ON public.community_members
  FOR INSERT
  WITH CHECK (auth.uid() = user_id);

-- 6-3. ì†Œëª¨ì„ ì†Œìœ ì ë° ê´€ë¦¬ìê°€ ë©¤ë²„ ì—­í•  ë³€ê²½ ê°€ëŠ¥
DROP POLICY IF EXISTS "Community admins can update member roles" ON public.community_members;
CREATE POLICY "Community admins can update member roles"
  ON public.community_members
  FOR UPDATE
  USING (
    EXISTS (
      SELECT 1 FROM public.community_members cm
      JOIN public.communities c ON c.id = cm.community_id
      WHERE cm.community_id = community_members.community_id
      AND cm.user_id = auth.uid()
      AND (cm.role IN ('owner', 'admin') OR c.created_by = auth.uid())
    )
  );

-- 6-4. ë³¸ì¸ì€ íƒˆí‡´ ê°€ëŠ¥, ì†Œìœ ì ë° ê´€ë¦¬ìëŠ” ë©¤ë²„ ì œê±° ê°€ëŠ¥
DROP POLICY IF EXISTS "Users can leave or be removed from communities" ON public.community_members;
CREATE POLICY "Users can leave or be removed from communities"
  ON public.community_members
  FOR DELETE
  USING (
    auth.uid() = user_id OR
    EXISTS (
      SELECT 1 FROM public.community_members cm
      JOIN public.communities c ON c.id = cm.community_id
      WHERE cm.community_id = community_members.community_id
      AND cm.user_id = auth.uid()
      AND (cm.role IN ('owner', 'admin') OR c.created_by = auth.uid())
    )
  );

-- 7. ì¸ë±ìŠ¤ ì¶”ê°€ (ì„±ëŠ¥ ìµœì í™”)
CREATE INDEX IF NOT EXISTS idx_communities_created_by ON public.communities(created_by);
CREATE INDEX IF NOT EXISTS idx_communities_created_at ON public.communities(created_at DESC);
CREATE INDEX IF NOT EXISTS idx_community_members_community_id ON public.community_members(community_id);
CREATE INDEX IF NOT EXISTS idx_community_members_user_id ON public.community_members(user_id);
CREATE INDEX IF NOT EXISTS idx_posts_community_id ON public.posts(community_id) WHERE community_id IS NOT NULL;
</file>

<file path="scripts/032_migrate_about_badges.sql">
-- About í˜ì´ì§€ì˜ í•˜ë“œì½”ë”©ëœ ë±ƒì§€ ë°ì´í„°ë¥¼ badges í…Œì´ë¸”ì— ë§ˆì´ê·¸ë ˆì´ì…˜
-- ê¸°ì¡´ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì—…ë°ì´íŠ¸, ì—†ìœ¼ë©´ ì‚½ì…

-- ê¸°ì¡´ ë±ƒì§€ ë°ì´í„°ê°€ ìˆëŠ”ì§€ í™•ì¸ í›„, ì—†ìœ¼ë©´ ì‚½ì…
-- nameìœ¼ë¡œ ì¤‘ë³µ í™•ì¸ (nameì´ uniqueì¸ ê²½ìš°)

-- [1] ê°œì¸ ìì‚° (Asset) - 3 tiers (5ì–µ, 10ì–µ, 50ì–µ)
INSERT INTO badges (name, icon, category, description)
VALUES
  ('ìì‚° 5ì–µ+', 'ğŸ’°', 'personal_asset', 'ìˆœìì‚° 5ì–µ ì› ì´ìƒ ì¸ì¦'),
  ('ìì‚° 10ì–µ+', 'ğŸ’', 'personal_asset', 'ìˆœìì‚° 10ì–µ ì› ì´ìƒ ì¸ì¦'),
  ('ìì‚° 50ì–µ+', 'ğŸ’', 'personal_asset', 'ìˆœìì‚° 50ì–µ ì› ì´ìƒ ì¸ì¦')
ON CONFLICT (name) DO UPDATE SET
  icon = EXCLUDED.icon,
  description = EXCLUDED.description;

-- [2] ê¸°ì—… ë§¤ì¶œ (Revenue) - 3 tiers (10ì–µ, 50ì–µ, 100ì–µ)
INSERT INTO badges (name, icon, category, description)
VALUES
  ('ë§¤ì¶œ 10ì–µ+', 'ğŸ“ˆ', 'corporate_revenue', 'ì—° ë§¤ì¶œ 10ì–µ ì› ì´ìƒ ì¸ì¦'),
  ('ë§¤ì¶œ 50ì–µ+', 'ğŸ“ˆ', 'corporate_revenue', 'ì—° ë§¤ì¶œ 50ì–µ ì› ì´ìƒ ì¸ì¦'),
  ('ë§¤ì¶œ 100ì–µ+', 'ğŸ“ˆ', 'corporate_revenue', 'ì—° ë§¤ì¶œ 100ì–µ ì› ì´ìƒ ì¸ì¦')
ON CONFLICT (name) DO UPDATE SET
  icon = EXCLUDED.icon,
  description = EXCLUDED.description;

-- [3] íˆ¬ì ê·œëª¨ (Investment Tier) - 6 tiers (1ì–µ ~ 100ì–µ)
INSERT INTO badges (name, icon, category, description)
VALUES
  ('íˆ¬ì 1ì–µ+', 'ğŸ’°', 'investment', 'ëˆ„ì  íˆ¬ì ì§‘í–‰ì•¡ 1ì–µ ì› ì´ìƒ'),
  ('íˆ¬ì 5ì–µ+', 'ğŸ’°', 'investment', 'ëˆ„ì  íˆ¬ì ì§‘í–‰ì•¡ 5ì–µ ì› ì´ìƒ'),
  ('íˆ¬ì 10ì–µ+', 'ğŸ’°', 'investment', 'ëˆ„ì  íˆ¬ì ì§‘í–‰ì•¡ 10ì–µ ì› ì´ìƒ'),
  ('íˆ¬ì 30ì–µ+', 'ğŸ’°', 'investment', 'ëˆ„ì  íˆ¬ì ì§‘í–‰ì•¡ 30ì–µ ì› ì´ìƒ'),
  ('íˆ¬ì 50ì–µ+', 'ğŸ’°', 'investment', 'ëˆ„ì  íˆ¬ì ì§‘í–‰ì•¡ 50ì–µ ì› ì´ìƒ'),
  ('íˆ¬ì 100ì–µ+', 'ğŸ’°', 'investment', 'ëˆ„ì  íˆ¬ì ì§‘í–‰ì•¡ 100ì–µ ì› ì´ìƒ')
ON CONFLICT (name) DO UPDATE SET
  icon = EXCLUDED.icon,
  description = EXCLUDED.description;

-- [4] ê¸°ì—…ê°€ì¹˜ (Valuation Tier) - 6 tiers (30ì–µ ~ ìœ ë‹ˆì½˜)
INSERT INTO badges (name, icon, category, description)
VALUES
  ('ê¸°ì—…ê°€ì¹˜ 30ì–µ+', 'ğŸ™ï¸', 'valuation', 'ìµœê·¼ íˆ¬ì ìœ ì¹˜ ê¸°ì¤€ ê¸°ì—…ê°€ì¹˜ 30ì–µ ì› ì´ìƒ'),
  ('ê¸°ì—…ê°€ì¹˜ 50ì–µ+', 'ğŸ™ï¸', 'valuation', 'ìµœê·¼ íˆ¬ì ìœ ì¹˜ ê¸°ì¤€ ê¸°ì—…ê°€ì¹˜ 50ì–µ ì› ì´ìƒ'),
  ('ê¸°ì—…ê°€ì¹˜ 100ì–µ+', 'ğŸ™ï¸', 'valuation', 'ìµœê·¼ íˆ¬ì ìœ ì¹˜ ê¸°ì¤€ ê¸°ì—…ê°€ì¹˜ 100ì–µ ì› ì´ìƒ'),
  ('ê¸°ì—…ê°€ì¹˜ 300ì–µ+', 'ğŸ™ï¸', 'valuation', 'ìµœê·¼ íˆ¬ì ìœ ì¹˜ ê¸°ì¤€ ê¸°ì—…ê°€ì¹˜ 300ì–µ ì› ì´ìƒ'),
  ('ê¸°ì—…ê°€ì¹˜ 1000ì–µ+', 'ğŸ™ï¸', 'valuation', 'ìµœê·¼ íˆ¬ì ìœ ì¹˜ ê¸°ì¤€ ê¸°ì—…ê°€ì¹˜ 1000ì–µ ì› ì´ìƒ'),
  ('ìœ ë‹ˆì½˜+', 'ğŸ¦„', 'valuation', 'ê¸°ì—…ê°€ì¹˜ 1ì¡° ì› ì´ìƒ (ìœ ë‹ˆì½˜)')
ON CONFLICT (name) DO UPDATE SET
  icon = EXCLUDED.icon,
  description = EXCLUDED.description;

-- [5] ì¸í”Œë£¨ì–¸ì„œ (Influence Tier) - 6 tiers (1ë§Œ ~ 100ë§Œ)
INSERT INTO badges (name, icon, category, description)
VALUES
  ('íŒ”ë¡œì›Œ 1ë§Œ+', 'ğŸ“£', 'influence', 'SNS íŒ”ë¡œì›Œ 1ë§Œ ëª… ì´ìƒ'),
  ('íŒ”ë¡œì›Œ 5ë§Œ+', 'ğŸ”¥', 'influence', 'SNS íŒ”ë¡œì›Œ 5ë§Œ ëª… ì´ìƒ'),
  ('íŒ”ë¡œì›Œ 10ë§Œ+', 'â­', 'influence', 'SNS íŒ”ë¡œì›Œ 10ë§Œ ëª… ì´ìƒ'),
  ('íŒ”ë¡œì›Œ 20ë§Œ+', 'ğŸ‘‘', 'influence', 'SNS íŒ”ë¡œì›Œ 20ë§Œ ëª… ì´ìƒ'),
  ('íŒ”ë¡œì›Œ 50ë§Œ+', 'ğŸš€', 'influence', 'SNS íŒ”ë¡œì›Œ 50ë§Œ ëª… ì´ìƒ'),
  ('íŒ”ë¡œì›Œ 100ë§Œ+', 'ğŸŒŒ', 'influence', 'SNS íŒ”ë¡œì›Œ 100ë§Œ ëª… ì´ìƒ')
ON CONFLICT (name) DO UPDATE SET
  icon = EXCLUDED.icon,
  description = EXCLUDED.description;

-- [6] ì „ë¬¸ì§ (Professional License) - 9 tiers
INSERT INTO badges (name, icon, category, description)
VALUES
  ('ë³€í˜¸ì‚¬', 'âš–ï¸', 'professional', 'ëŒ€í•œë¯¼êµ­ ë³€í˜¸ì‚¬ ìê²© ì¸ì¦'),
  ('ê³µì¸íšŒê³„ì‚¬', 'ğŸ“˜', 'professional', 'ëŒ€í•œë¯¼êµ­ ê³µì¸íšŒê³„ì‚¬ ìê²© ì¸ì¦'),
  ('ì„¸ë¬´ì‚¬', 'ğŸ§¾', 'professional', 'ëŒ€í•œë¯¼êµ­ ì„¸ë¬´ì‚¬ ìê²© ì¸ì¦'),
  ('ë³€ë¦¬ì‚¬', 'ğŸ’¡', 'professional', 'ëŒ€í•œë¯¼êµ­ ë³€ë¦¬ì‚¬ ìê²© ì¸ì¦'),
  ('ë…¸ë¬´ì‚¬', 'ğŸ¤', 'professional', 'ëŒ€í•œë¯¼êµ­ ê³µì¸ë…¸ë¬´ì‚¬ ìê²© ì¸ì¦'),
  ('ì˜ì‚¬', 'ğŸ©º', 'professional', 'ëŒ€í•œë¯¼êµ­ ì˜ì‚¬ ë©´í—ˆ ì¸ì¦'),
  ('í•œì˜ì‚¬', 'ğŸŒ¿', 'professional', 'ëŒ€í•œë¯¼êµ­ í•œì˜ì‚¬ ë©´í—ˆ ì¸ì¦'),
  ('ìˆ˜ì˜ì‚¬', 'ğŸ¾', 'professional', 'ëŒ€í•œë¯¼êµ­ ìˆ˜ì˜ì‚¬ ë©´í—ˆ ì¸ì¦'),
  ('ì•½ì‚¬', 'ğŸ’Š', 'professional', 'ëŒ€í•œë¯¼êµ­ ì•½ì‚¬ ë©´í—ˆ ì¸ì¦')
ON CONFLICT (name) DO UPDATE SET
  icon = EXCLUDED.icon,
  description = EXCLUDED.description;

-- [7] ì»¤ë®¤ë‹ˆí‹° (Community) - 3 tiers (ì„ ì°©ìˆœ 100ì¸ + ìš´ì˜ì§„ + í™œë™ íšŒì›)
INSERT INTO badges (name, icon, category, description)
VALUES
  ('ì„ ì°©ìˆœ 100ì¸', 'ğŸ‘‘', 'community', 'SFC ì´ˆê¸° ê°€ì… ë©¤ë²„ (ë¡œì—´í‹°)'),
  ('ì»¤ë®¤ë‹ˆí‹° ë¦¬ë”', 'ğŸ›¡ï¸', 'community', 'SFC ì»¤ë®¤ë‹ˆí‹° ìš´ì˜ì§„ ë° ë¦¬ë”'),
  ('ìš°ìˆ˜í™œë™ íšŒì›', 'ğŸŒŸ', 'community', 'ì»¤ë®¤ë‹ˆí‹° ë‚´ í™œë™ ì§€ìˆ˜ ìƒìœ„ 1% íšŒì›')
ON CONFLICT (name) DO UPDATE SET
  icon = EXCLUDED.icon,
  description = EXCLUDED.description;
</file>

<file path="scripts/032_update_member_profile.sql">
-- ë©¤ë²„ í”„ë¡œí•„ ë° ì»¤ë®¤ë‹ˆí‹° í…Œì´ë¸” ì—…ë°ì´íŠ¸
-- í”„ë¡œí•„ í¸ì§‘ ê¸°ëŠ¥ ë° ë©¤ë²„ í˜ì´ì§€ ê°œí¸ì„ ìœ„í•œ ìŠ¤í‚¤ë§ˆ ë³€ê²½

-- 1. profiles í…Œì´ë¸”ì— ì¶”ê°€ ì»¬ëŸ¼
ALTER TABLE public.profiles 
ADD COLUMN IF NOT EXISTS company text,
ADD COLUMN IF NOT EXISTS position text,
ADD COLUMN IF NOT EXISTS roles text[] DEFAULT '{}',
ADD COLUMN IF NOT EXISTS is_profile_public boolean DEFAULT false NOT NULL,
ADD COLUMN IF NOT EXISTS introduction text;

-- 2. communities í…Œì´ë¸”ì— ì¶”ê°€ ì»¬ëŸ¼
ALTER TABLE public.communities 
ADD COLUMN IF NOT EXISTS instagram_url text,
ADD COLUMN IF NOT EXISTS website_url text;

-- 3. ì¸ë±ìŠ¤ ì¶”ê°€ (ì„±ëŠ¥ ìµœì í™”)
CREATE INDEX IF NOT EXISTS idx_profiles_is_profile_public ON public.profiles(is_profile_public) WHERE is_profile_public = true;
CREATE INDEX IF NOT EXISTS idx_profiles_roles ON public.profiles USING GIN(roles);

-- 4. ì£¼ì„ ì¶”ê°€
COMMENT ON COLUMN public.profiles.company IS 'ì†Œì† íšŒì‚¬/ì¡°ì§';
COMMENT ON COLUMN public.profiles.position IS 'ì§ì±…';
COMMENT ON COLUMN public.profiles.roles IS 'ì—­í•  ë°°ì—´ (ì‚¬ì—…ê°€, íˆ¬ìì, ì¸í”Œë£¨ì–¸ì„œ ë“±)';
COMMENT ON COLUMN public.profiles.is_profile_public IS 'ë©¤ë²„ í˜ì´ì§€ ê³µê°œ ì—¬ë¶€';
COMMENT ON COLUMN public.profiles.introduction IS 'í•œì¤„ ìê¸°ì†Œê°œ';
COMMENT ON COLUMN public.communities.instagram_url IS 'ì¸ìŠ¤íƒ€ê·¸ë¨ URL';
COMMENT ON COLUMN public.communities.website_url IS 'ì›¹ì‚¬ì´íŠ¸ URL (ì“°ë ˆë“œ ë“± ì™¸ë¶€ ë§í¬)';
</file>

<file path="scripts/033_add_post_visibility.sql">
-- ê²Œì‹œê¸€ ê³µê°œ ì„¤ì • ê¸°ëŠ¥ ì¶”ê°€
-- í•˜ì´ë¸Œë¦¬ë“œ í”¼ë“œ ì‹œìŠ¤í…œ: ì „ì²´ ê³µê°œ vs ê·¸ë£¹ ì „ìš©

-- 1. posts í…Œì´ë¸”ì— visibility ì»¬ëŸ¼ ì¶”ê°€
ALTER TABLE public.posts 
ADD COLUMN IF NOT EXISTS visibility text DEFAULT 'public' NOT NULL;

-- 2. CHECK ì œì•½ ì¡°ê±´ ì¶”ê°€
DO $$ 
BEGIN
  -- ê¸°ì¡´ ì œì•½ ì¡°ê±´ì´ ìˆìœ¼ë©´ ì œê±°
  IF EXISTS (
    SELECT 1 FROM information_schema.constraint_column_usage 
    WHERE table_name = 'posts' 
    AND constraint_name LIKE '%visibility%'
  ) THEN
    ALTER TABLE public.posts DROP CONSTRAINT IF EXISTS posts_visibility_check;
  END IF;
  
  -- ìƒˆ ì œì•½ ì¡°ê±´ ì¶”ê°€
  ALTER TABLE public.posts 
  ADD CONSTRAINT posts_visibility_check 
  CHECK (visibility IN ('public', 'group'));
END $$;

-- 3. ê¸°ì¡´ ë°ì´í„°ëŠ” ëª¨ë‘ 'public'ìœ¼ë¡œ ì„¤ì • (ì´ë¯¸ DEFAULTë¡œ ì„¤ì •ë¨)
-- ëª…ì‹œì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ (NULLì´ ìˆì„ ê²½ìš° ëŒ€ë¹„)
UPDATE public.posts 
SET visibility = 'public' 
WHERE visibility IS NULL;

-- 4. ì¸ë±ìŠ¤ ì¶”ê°€ (ì„±ëŠ¥ ìµœì í™”)
CREATE INDEX IF NOT EXISTS idx_posts_visibility ON public.posts(visibility);

-- 5. ì£¼ì„ ì¶”ê°€
COMMENT ON COLUMN public.posts.visibility IS 'ê²Œì‹œê¸€ ê³µê°œ ì„¤ì •: public(ì „ì²´ ê³µê°œ) ë˜ëŠ” group(ê·¸ë£¹ ì „ìš©)';
</file>

<file path="scripts/033_final_badge_migration.sql">
-- ============================================
-- ë±ƒì§€ ë°ì´í„° ìµœì¢… ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸
-- ============================================
-- ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” About í˜ì´ì§€ì— í•˜ë“œì½”ë”©ë˜ì–´ ìˆë˜ ë±ƒì§€ ë°ì´í„°ë¥¼
-- Supabase badges í…Œì´ë¸”ì— ì‚½ì…/ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
--
-- ì‹¤í–‰ ë°©ë²•:
-- 1. Supabase ëŒ€ì‹œë³´ë“œ ì ‘ì†
-- 2. SQL Editor í´ë¦­
-- 3. ì´ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë¶™ì—¬ë„£ê¸°
-- 4. Run ë²„íŠ¼ í´ë¦­
-- ============================================

-- ê¸°ì¡´ ë°ì´í„°ì™€ ì¤‘ë³µë˜ì§€ ì•Šë„ë¡ ON CONFLICT ì²˜ë¦¬
-- name ì»¬ëŸ¼ì´ uniqueì¸ ê²½ìš°ë¥¼ ê°€ì •

-- [1] ê°œì¸ ìì‚° (Personal Asset) - 3 tiers
INSERT INTO badges (name, icon, category, description)
VALUES
  ('ìì‚° 5ì–µ+', 'ğŸ’°', 'personal_asset', 'ìˆœìì‚° 5ì–µ ì› ì´ìƒ ì¸ì¦'),
  ('ìì‚° 10ì–µ+', 'ğŸ’', 'personal_asset', 'ìˆœìì‚° 10ì–µ ì› ì´ìƒ ì¸ì¦'),
  ('ìì‚° 50ì–µ+', 'ğŸ’', 'personal_asset', 'ìˆœìì‚° 50ì–µ ì› ì´ìƒ ì¸ì¦')
ON CONFLICT (name) DO UPDATE SET
  icon = EXCLUDED.icon,
  category = EXCLUDED.category,
  description = EXCLUDED.description;

-- [2] ê¸°ì—… ë§¤ì¶œ (Corporate Revenue) - 3 tiers
INSERT INTO badges (name, icon, category, description)
VALUES
  ('ë§¤ì¶œ 10ì–µ+', 'ğŸ“ˆ', 'corporate_revenue', 'ì—° ë§¤ì¶œ 10ì–µ ì› ì´ìƒ ì¸ì¦'),
  ('ë§¤ì¶œ 50ì–µ+', 'ğŸ“ˆ', 'corporate_revenue', 'ì—° ë§¤ì¶œ 50ì–µ ì› ì´ìƒ ì¸ì¦'),
  ('ë§¤ì¶œ 100ì–µ+', 'ğŸ“ˆ', 'corporate_revenue', 'ì—° ë§¤ì¶œ 100ì–µ ì› ì´ìƒ ì¸ì¦')
ON CONFLICT (name) DO UPDATE SET
  icon = EXCLUDED.icon,
  category = EXCLUDED.category,
  description = EXCLUDED.description;

-- [3] íˆ¬ì ê·œëª¨ (Investment Tier) - 6 tiers
INSERT INTO badges (name, icon, category, description)
VALUES
  ('íˆ¬ì 1ì–µ+', 'ğŸ’°', 'investment', 'ëˆ„ì  íˆ¬ì ì§‘í–‰ì•¡ 1ì–µ ì› ì´ìƒ'),
  ('íˆ¬ì 5ì–µ+', 'ğŸ’°', 'investment', 'ëˆ„ì  íˆ¬ì ì§‘í–‰ì•¡ 5ì–µ ì› ì´ìƒ'),
  ('íˆ¬ì 10ì–µ+', 'ğŸ’°', 'investment', 'ëˆ„ì  íˆ¬ì ì§‘í–‰ì•¡ 10ì–µ ì› ì´ìƒ'),
  ('íˆ¬ì 30ì–µ+', 'ğŸ’°', 'investment', 'ëˆ„ì  íˆ¬ì ì§‘í–‰ì•¡ 30ì–µ ì› ì´ìƒ'),
  ('íˆ¬ì 50ì–µ+', 'ğŸ’°', 'investment', 'ëˆ„ì  íˆ¬ì ì§‘í–‰ì•¡ 50ì–µ ì› ì´ìƒ'),
  ('íˆ¬ì 100ì–µ+', 'ğŸ’°', 'investment', 'ëˆ„ì  íˆ¬ì ì§‘í–‰ì•¡ 100ì–µ ì› ì´ìƒ')
ON CONFLICT (name) DO UPDATE SET
  icon = EXCLUDED.icon,
  category = EXCLUDED.category,
  description = EXCLUDED.description;

-- [4] ê¸°ì—…ê°€ì¹˜ (Valuation Tier) - 6 tiers
INSERT INTO badges (name, icon, category, description)
VALUES
  ('ê¸°ì—…ê°€ì¹˜ 30ì–µ+', 'ğŸ™ï¸', 'valuation', 'ìµœê·¼ íˆ¬ì ìœ ì¹˜ ê¸°ì¤€ ê¸°ì—…ê°€ì¹˜ 30ì–µ ì› ì´ìƒ'),
  ('ê¸°ì—…ê°€ì¹˜ 50ì–µ+', 'ğŸ™ï¸', 'valuation', 'ìµœê·¼ íˆ¬ì ìœ ì¹˜ ê¸°ì¤€ ê¸°ì—…ê°€ì¹˜ 50ì–µ ì› ì´ìƒ'),
  ('ê¸°ì—…ê°€ì¹˜ 100ì–µ+', 'ğŸ™ï¸', 'valuation', 'ìµœê·¼ íˆ¬ì ìœ ì¹˜ ê¸°ì¤€ ê¸°ì—…ê°€ì¹˜ 100ì–µ ì› ì´ìƒ'),
  ('ê¸°ì—…ê°€ì¹˜ 300ì–µ+', 'ğŸ™ï¸', 'valuation', 'ìµœê·¼ íˆ¬ì ìœ ì¹˜ ê¸°ì¤€ ê¸°ì—…ê°€ì¹˜ 300ì–µ ì› ì´ìƒ'),
  ('ê¸°ì—…ê°€ì¹˜ 1000ì–µ+', 'ğŸ™ï¸', 'valuation', 'ìµœê·¼ íˆ¬ì ìœ ì¹˜ ê¸°ì¤€ ê¸°ì—…ê°€ì¹˜ 1000ì–µ ì› ì´ìƒ'),
  ('ìœ ë‹ˆì½˜+', 'ğŸ¦„', 'valuation', 'ê¸°ì—…ê°€ì¹˜ 1ì¡° ì› ì´ìƒ (ìœ ë‹ˆì½˜)')
ON CONFLICT (name) DO UPDATE SET
  icon = EXCLUDED.icon,
  category = EXCLUDED.category,
  description = EXCLUDED.description;

-- [5] ì¸í”Œë£¨ì–¸ì„œ (Influence Tier) - 6 tiers
INSERT INTO badges (name, icon, category, description)
VALUES
  ('íŒ”ë¡œì›Œ 1ë§Œ+', 'ğŸ“£', 'influence', 'SNS íŒ”ë¡œì›Œ 1ë§Œ ëª… ì´ìƒ'),
  ('íŒ”ë¡œì›Œ 5ë§Œ+', 'ğŸ”¥', 'influence', 'SNS íŒ”ë¡œì›Œ 5ë§Œ ëª… ì´ìƒ'),
  ('íŒ”ë¡œì›Œ 10ë§Œ+', 'â­', 'influence', 'SNS íŒ”ë¡œì›Œ 10ë§Œ ëª… ì´ìƒ'),
  ('íŒ”ë¡œì›Œ 20ë§Œ+', 'ğŸ‘‘', 'influence', 'SNS íŒ”ë¡œì›Œ 20ë§Œ ëª… ì´ìƒ'),
  ('íŒ”ë¡œì›Œ 50ë§Œ+', 'ğŸš€', 'influence', 'SNS íŒ”ë¡œì›Œ 50ë§Œ ëª… ì´ìƒ'),
  ('íŒ”ë¡œì›Œ 100ë§Œ+', 'ğŸŒŒ', 'influence', 'SNS íŒ”ë¡œì›Œ 100ë§Œ ëª… ì´ìƒ')
ON CONFLICT (name) DO UPDATE SET
  icon = EXCLUDED.icon,
  category = EXCLUDED.category,
  description = EXCLUDED.description;

-- [6] ì „ë¬¸ì§ (Professional License) - 9 tiers
INSERT INTO badges (name, icon, category, description)
VALUES
  ('ë³€í˜¸ì‚¬', 'âš–ï¸', 'professional', 'ëŒ€í•œë¯¼êµ­ ë³€í˜¸ì‚¬ ìê²© ì¸ì¦'),
  ('ê³µì¸íšŒê³„ì‚¬', 'ğŸ“˜', 'professional', 'ëŒ€í•œë¯¼êµ­ ê³µì¸íšŒê³„ì‚¬ ìê²© ì¸ì¦'),
  ('ì„¸ë¬´ì‚¬', 'ğŸ§¾', 'professional', 'ëŒ€í•œë¯¼êµ­ ì„¸ë¬´ì‚¬ ìê²© ì¸ì¦'),
  ('ë³€ë¦¬ì‚¬', 'ğŸ’¡', 'professional', 'ëŒ€í•œë¯¼êµ­ ë³€ë¦¬ì‚¬ ìê²© ì¸ì¦'),
  ('ë…¸ë¬´ì‚¬', 'ğŸ¤', 'professional', 'ëŒ€í•œë¯¼êµ­ ê³µì¸ë…¸ë¬´ì‚¬ ìê²© ì¸ì¦'),
  ('ì˜ì‚¬', 'ğŸ©º', 'professional', 'ëŒ€í•œë¯¼êµ­ ì˜ì‚¬ ë©´í—ˆ ì¸ì¦'),
  ('í•œì˜ì‚¬', 'ğŸŒ¿', 'professional', 'ëŒ€í•œë¯¼êµ­ í•œì˜ì‚¬ ë©´í—ˆ ì¸ì¦'),
  ('ìˆ˜ì˜ì‚¬', 'ğŸ¾', 'professional', 'ëŒ€í•œë¯¼êµ­ ìˆ˜ì˜ì‚¬ ë©´í—ˆ ì¸ì¦'),
  ('ì•½ì‚¬', 'ğŸ’Š', 'professional', 'ëŒ€í•œë¯¼êµ­ ì•½ì‚¬ ë©´í—ˆ ì¸ì¦')
ON CONFLICT (name) DO UPDATE SET
  icon = EXCLUDED.icon,
  category = EXCLUDED.category,
  description = EXCLUDED.description;

-- [7] ì»¤ë®¤ë‹ˆí‹° (Community) - 3 tiers
INSERT INTO badges (name, icon, category, description)
VALUES
  ('ì„ ì°©ìˆœ 100ì¸', 'ğŸ‘‘', 'community', 'SFC ì´ˆê¸° ê°€ì… ë©¤ë²„ (ë¡œì—´í‹°)'),
  ('ì»¤ë®¤ë‹ˆí‹° ë¦¬ë”', 'ğŸ›¡ï¸', 'community', 'SFC ì»¤ë®¤ë‹ˆí‹° ìš´ì˜ì§„ ë° ë¦¬ë”'),
  ('ìš°ìˆ˜í™œë™ íšŒì›', 'ğŸŒŸ', 'community', 'ì»¤ë®¤ë‹ˆí‹° ë‚´ í™œë™ ì§€ìˆ˜ ìƒìœ„ 1% íšŒì›')
ON CONFLICT (name) DO UPDATE SET
  icon = EXCLUDED.icon,
  category = EXCLUDED.category,
  description = EXCLUDED.description;

-- ============================================
-- ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ í™•ì¸ ì¿¼ë¦¬
-- ============================================
-- ì•„ë˜ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•˜ì—¬ ë°ì´í„°ê°€ ì œëŒ€ë¡œ ë“¤ì–´ê°”ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”:
-- SELECT category, COUNT(*) as count FROM badges GROUP BY category ORDER BY category;
</file>

<file path="scripts/034_add_badge_is_active.sql">
-- ë±ƒì§€ í…Œì´ë¸”ì— is_active í•„ë“œ ì¶”ê°€
-- ê´€ë¦¬ìê°€ ë±ƒì§€ì˜ ê³µê°œ/ë¹„ê³µê°œ ìƒíƒœë¥¼ ì œì–´í•  ìˆ˜ ìˆë„ë¡ í•¨
-- ì•ˆì „í•œ ë§ˆì´ê·¸ë ˆì´ì…˜: ì»¬ëŸ¼ì´ ì´ë¯¸ ìˆìœ¼ë©´ ì—ëŸ¬ ì—†ì´ ê±´ë„ˆëœ€

DO $$
BEGIN
  -- is_active ì»¬ëŸ¼ì´ ìˆëŠ”ì§€ í™•ì¸
  IF NOT EXISTS (
    SELECT 1 
    FROM information_schema.columns 
    WHERE table_schema = 'public' 
    AND table_name = 'badges' 
    AND column_name = 'is_active'
  ) THEN
    -- ì»¬ëŸ¼ ì¶”ê°€
    ALTER TABLE badges 
    ADD COLUMN is_active BOOLEAN DEFAULT true NOT NULL;
    
    RAISE NOTICE 'is_active ì»¬ëŸ¼ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.';
  ELSE
    RAISE NOTICE 'is_active ì»¬ëŸ¼ì´ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤.';
  END IF;
END $$;

-- ê¸°ì¡´ ë±ƒì§€ë“¤ì€ ëª¨ë‘ í™œì„±í™” ìƒíƒœë¡œ ì„¤ì •
UPDATE badges 
SET is_active = true 
WHERE is_active IS NULL;

-- ì¸ë±ìŠ¤ ì¶”ê°€ (í™œì„±í™”ëœ ë±ƒì§€ë§Œ ì¡°íšŒí•  ë•Œ ì„±ëŠ¥ í–¥ìƒ)
CREATE INDEX IF NOT EXISTS idx_badges_is_active 
ON badges(is_active);

-- ì½”ë©˜íŠ¸ ì¶”ê°€
COMMENT ON COLUMN badges.is_active IS 'ë±ƒì§€ì˜ ê³µê°œ/ë¹„ê³µê°œ ìƒíƒœ. trueë©´ ê³µê°œ, falseë©´ ë¹„ê³µê°œ (ê´€ë¦¬ììš©)';
</file>

<file path="scripts/034_add_end_date.sql">
-- events í…Œì´ë¸”ì— end_date ì»¬ëŸ¼ ì¶”ê°€
-- ì´ë²¤íŠ¸ ì¢…ë£Œ ë‚ ì§œ ë° ì‹œê°„ì„ ì €ì¥í•˜ê¸° ìœ„í•œ ì»¬ëŸ¼

-- 1. events í…Œì´ë¸”ì— end_date ì»¬ëŸ¼ ì¶”ê°€
ALTER TABLE public.events 
ADD COLUMN IF NOT EXISTS end_date TIMESTAMPTZ;

-- 2. ì£¼ì„ ì¶”ê°€
COMMENT ON COLUMN public.events.end_date IS 'ì´ë²¤íŠ¸ ì¢…ë£Œ ë‚ ì§œ ë° ì‹œê°„ (NULL í—ˆìš©)';
</file>

<file path="scripts/034_create_partner_services.sql">
-- íŒŒíŠ¸ë„ˆìŠ¤ ë§ˆì¼“í”Œë ˆì´ìŠ¤ í…Œì´ë¸” ìƒì„±
-- ë©¤ë²„ë“¤ì´ ìì‹ ì˜ ì„œë¹„ìŠ¤ë¥¼ í™ë³´í•˜ê³  ê±°ë˜í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥

-- partner_services í…Œì´ë¸” ìƒì„±
CREATE TABLE IF NOT EXISTS public.partner_services (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  title TEXT NOT NULL,
  description TEXT NOT NULL,
  content TEXT,
  category TEXT NOT NULL CHECK (category IN ('development', 'design', 'marketing', 'business', 'consulting', 'other')),
  price_range TEXT,
  contact_link TEXT,
  thumbnail_url TEXT,
  is_verified BOOLEAN DEFAULT false NOT NULL,
  provider_id UUID REFERENCES public.profiles(id) ON DELETE CASCADE NOT NULL,
  created_at TIMESTAMPTZ DEFAULT NOW() NOT NULL,
  updated_at TIMESTAMPTZ DEFAULT NOW() NOT NULL
);

-- ì¸ë±ìŠ¤ ìƒì„± (ì„±ëŠ¥ ìµœì í™”)
CREATE INDEX IF NOT EXISTS idx_partner_services_category ON public.partner_services(category);
CREATE INDEX IF NOT EXISTS idx_partner_services_is_verified ON public.partner_services(is_verified);
CREATE INDEX IF NOT EXISTS idx_partner_services_provider_id ON public.partner_services(provider_id);
CREATE INDEX IF NOT EXISTS idx_partner_services_created_at ON public.partner_services(created_at DESC);

-- Row Level Security í™œì„±í™”
ALTER TABLE public.partner_services ENABLE ROW LEVEL SECURITY;

-- RLS ì •ì±…: ëª¨ë“  ì‚¬ìš©ìê°€ ì¡°íšŒ ê°€ëŠ¥
CREATE POLICY "Partner services are viewable by everyone"
  ON public.partner_services FOR SELECT
  USING (true);

-- RLS ì •ì±…: ì¸ì¦ëœ ì‚¬ìš©ìë§Œ ì„œë¹„ìŠ¤ ë“±ë¡ ê°€ëŠ¥
CREATE POLICY "Authenticated users can create partner services"
  ON public.partner_services FOR INSERT
  WITH CHECK (auth.uid() = provider_id);

-- RLS ì •ì±…: ë³¸ì¸ë§Œ ìˆ˜ì • ê°€ëŠ¥
CREATE POLICY "Users can update their own partner services"
  ON public.partner_services FOR UPDATE
  USING (auth.uid() = provider_id);

-- RLS ì •ì±…: ë³¸ì¸ë§Œ ì‚­ì œ ê°€ëŠ¥
CREATE POLICY "Users can delete their own partner services"
  ON public.partner_services FOR DELETE
  USING (auth.uid() = provider_id);

-- updated_at ìë™ ì—…ë°ì´íŠ¸ íŠ¸ë¦¬ê±° í•¨ìˆ˜
CREATE OR REPLACE FUNCTION update_partner_services_updated_at()
RETURNS TRIGGER AS $$
BEGIN
  NEW.updated_at = NOW();
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- íŠ¸ë¦¬ê±° ìƒì„±
CREATE TRIGGER update_partner_services_updated_at
  BEFORE UPDATE ON public.partner_services
  FOR EACH ROW
  EXECUTE FUNCTION update_partner_services_updated_at();
</file>

<file path="scripts/035_add_test_badges.sql">
-- í…ŒìŠ¤íŠ¸ìš© ë±ƒì§€ ë”ë¯¸ ë°ì´í„° ì¶”ê°€
-- ê¸°ì¡´ ë°ì´í„°ê°€ ì—†ì„ ê²½ìš°ë¥¼ ëŒ€ë¹„í•œ í…ŒìŠ¤íŠ¸ ë°ì´í„°

-- ê¸°ì¡´ ë±ƒì§€ê°€ ì—†ëŠ” ê²½ìš°ì—ë§Œ í…ŒìŠ¤íŠ¸ ë°ì´í„° ì¶”ê°€
DO $$
DECLARE
  badge_count INTEGER;
BEGIN
  -- í˜„ì¬ ë±ƒì§€ ê°œìˆ˜ í™•ì¸
  SELECT COUNT(*) INTO badge_count FROM badges;
  
  -- ë±ƒì§€ê°€ ì—†ìœ¼ë©´ í…ŒìŠ¤íŠ¸ ë°ì´í„° ì¶”ê°€
  IF badge_count = 0 THEN
    INSERT INTO badges (name, icon, category, description, is_active) VALUES
    ('ìì‚° 10ì–µ+', 'ğŸ’', 'personal_asset', 'ìˆœìì‚° 10ì–µ ì› ì´ìƒ ì¸ì¦', true),
    ('ë§¤ì¶œ 50ì–µ+', 'ğŸ“ˆ', 'corporate_revenue', 'ì—° ë§¤ì¶œ 50ì–µ ì› ì´ìƒ ì¸ì¦', true),
    ('íˆ¬ì 10ì–µ+', 'ğŸ’°', 'investment', 'ëˆ„ì  íˆ¬ì ì§‘í–‰ì•¡ 10ì–µ ì› ì´ìƒ', true),
    ('ê¸°ì—…ê°€ì¹˜ 100ì–µ+', 'ğŸ™ï¸', 'valuation', 'ìµœê·¼ íˆ¬ì ìœ ì¹˜ ê¸°ì¤€ ê¸°ì—…ê°€ì¹˜ 100ì–µ ì› ì´ìƒ', false),
    ('ë³€í˜¸ì‚¬', 'âš–ï¸', 'professional', 'ëŒ€í•œë¯¼êµ­ ë³€í˜¸ì‚¬ ìê²© ì¸ì¦', true);
    
    RAISE NOTICE 'í…ŒìŠ¤íŠ¸ ë±ƒì§€ ë°ì´í„° 5ê°œê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.';
  ELSE
    RAISE NOTICE 'ê¸°ì¡´ ë±ƒì§€ ë°ì´í„°ê°€ ìˆìŠµë‹ˆë‹¤. (í˜„ì¬ %ê°œ)', badge_count;
  END IF;
END $$;
</file>

<file path="scripts/035_seed_partner_services.sql">
-- íŒŒíŠ¸ë„ˆìŠ¤ ë§ˆì¼“í”Œë ˆì´ìŠ¤ ì´ˆê¸° ë°ì´í„°
-- AI ê¸°ë°˜ MVP 5ì¼ ì™„ì„± ê°œë°œ ì„œë¹„ìŠ¤

-- ì£¼ì˜: provider_idëŠ” ì‹¤ì œ ì‚¬ìš©ìì˜ UUIDë¡œ ë³€ê²½í•´ì•¼ í•©ë‹ˆë‹¤.
-- ì˜ˆì‹œë¡œ '00000000-0000-0000-0000-000000000000'ì„ ì‚¬ìš©í–ˆìœ¼ë‹ˆ, ì‹¤ì œ ì‚¬ìš©ì IDë¡œ êµì²´í•˜ì„¸ìš”.

INSERT INTO public.partner_services (
  title,
  description,
  content,
  category,
  price_range,
  contact_link,
  thumbnail_url,
  is_verified,
  provider_id
) VALUES (
  'AI ê¸°ë°˜ MVP 5ì¼ ì™„ì„± ê°œë°œ ì„œë¹„ìŠ¤',
  'ê¸°íšë¶€í„° ë°°í¬ê¹Œì§€ One-Stopìœ¼ë¡œ ì œê³µí•˜ëŠ” í•©ë¦¬ì ì¸ ê°€ê²©ì˜ MVP ê°œë°œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.',
  '## ì„œë¹„ìŠ¤ ì†Œê°œ

AI ê¸°ë°˜ MVP 5ì¼ ì™„ì„± ê°œë°œ ì„œë¹„ìŠ¤ëŠ” ì°½ì—…ê°€ë“¤ì´ ë¹ ë¥´ê²Œ ì•„ì´ë””ì–´ë¥¼ ê²€ì¦í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ” ì›ìŠ¤í†± ê°œë°œ ì†”ë£¨ì…˜ì…ë‹ˆë‹¤.

### ì£¼ìš” íŠ¹ì§•

- **5ì¼ ì™„ì„±**: ê¸°íšë¶€í„° ë°°í¬ê¹Œì§€ ë‹¨ 5ì¼ ë§Œì— ì™„ì„±
- **AI ê¸°ë°˜ ê°œë°œ**: ìµœì‹  AI ë„êµ¬ë¥¼ í™œìš©í•œ íš¨ìœ¨ì ì¸ ê°œë°œ í”„ë¡œì„¸ìŠ¤
- **í•©ë¦¬ì ì¸ ê°€ê²©**: ëŒ€í–‰ì‚¬ ëŒ€ë¹„ 50% ì´ìƒ ì €ë ´í•œ ê°€ê²©
- **One-Stop ì„œë¹„ìŠ¤**: ê¸°íš, ë””ìì¸, ê°œë°œ, ë°°í¬ê¹Œì§€ ëª¨ë“  ê³¼ì •ì„ ë‹´ë‹¹

### ì œê³µ ë²”ìœ„

1. **ê¸°íš ë‹¨ê³„**
   - ì‚¬ìš©ì ìŠ¤í† ë¦¬ ì‘ì„±
   - ê¸°ëŠ¥ ëª…ì„¸ì„œ ì‘ì„±
   - ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„

2. **ë””ìì¸ ë‹¨ê³„**
   - UI/UX ë””ìì¸
   - í”„ë¡œí† íƒ€ì… ì œì‘
   - ë””ìì¸ ì‹œìŠ¤í…œ êµ¬ì¶•

3. **ê°œë°œ ë‹¨ê³„**
   - í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œ (React/Next.js)
   - ë°±ì—”ë“œ ê°œë°œ (Node.js/Supabase)
   - AI ê¸°ëŠ¥ í†µí•©

4. **ë°°í¬ ë‹¨ê³„**
   - í´ë¼ìš°ë“œ ë°°í¬
   - ë„ë©”ì¸ ì—°ê²°
   - ëª¨ë‹ˆí„°ë§ ì„¤ì •

### ê¸°ìˆ  ìŠ¤íƒ

- **Frontend**: Next.js, React, TypeScript, Tailwind CSS
- **Backend**: Supabase, Node.js
- **AI**: OpenAI API, Anthropic Claude
- **Deployment**: Vercel, AWS

### ê°€ê²© ì •ë³´

- **ê¸°ë³¸ íŒ¨í‚¤ì§€**: 100ë§Œì› (5ì¼ ì™„ì„±)
- **í”„ë¦¬ë¯¸ì—„ íŒ¨í‚¤ì§€**: 150ë§Œì› (7ì¼ ì™„ì„± + ì¶”ê°€ ê¸°ëŠ¥)
- **ì»¤ìŠ¤í…€ íŒ¨í‚¤ì§€**: ë¬¸ì˜

### ì§„í–‰ í”„ë¡œì„¸ìŠ¤

1. **1ì¼ì°¨**: ê¸°íš ë° ë””ìì¸ ì»¨ì…‰ í™•ì •
2. **2-3ì¼ì°¨**: í•µì‹¬ ê¸°ëŠ¥ ê°œë°œ
3. **4ì¼ì°¨**: AI ê¸°ëŠ¥ í†µí•© ë° í…ŒìŠ¤íŠ¸
4. **5ì¼ì°¨**: ë°°í¬ ë° ìµœì¢… ì ê²€

### ë¬¸ì˜ ë°©ë²•

ì˜¤í”ˆì¹´í†¡ ë§í¬ë¥¼ í†µí•´ ë¬¸ì˜í•´ì£¼ì‹œë©´ ë¹ ë¥´ê²Œ ë‹µë³€ë“œë¦¬ê² ìŠµë‹ˆë‹¤.',
  'development',
  '100ë§Œì›~',
  'https://open.kakao.com/o/example',
  '/placeholder.svg?height=400&width=600',
  true,
  (SELECT id FROM public.profiles LIMIT 1) -- ì²« ë²ˆì§¸ í”„ë¡œí•„ ì‚¬ìš© (ì‹¤ì œë¡œëŠ” ë³¸ì¸ì˜ UUIDë¡œ ë³€ê²½)
);
</file>

<file path="scripts/036_fix_badge_is_active_column.sql">
-- ë±ƒì§€ í…Œì´ë¸”ì— is_active ì»¬ëŸ¼ ì¶”ê°€ (ì•ˆì „í•œ ë§ˆì´ê·¸ë ˆì´ì…˜)
-- ì´ë¯¸ ì»¬ëŸ¼ì´ ìˆì–´ë„ ì—ëŸ¬ ì—†ì´ ì‹¤í–‰ë˜ë„ë¡ IF NOT EXISTS ì‚¬ìš©

-- 1. ì»¬ëŸ¼ ì¶”ê°€ (ì—†ëŠ” ê²½ìš°ì—ë§Œ)
DO $$
BEGIN
  -- is_active ì»¬ëŸ¼ì´ ìˆëŠ”ì§€ í™•ì¸
  IF NOT EXISTS (
    SELECT 1 
    FROM information_schema.columns 
    WHERE table_schema = 'public' 
    AND table_name = 'badges' 
    AND column_name = 'is_active'
  ) THEN
    -- ì»¬ëŸ¼ ì¶”ê°€
    ALTER TABLE badges 
    ADD COLUMN is_active BOOLEAN DEFAULT true NOT NULL;
    
    RAISE NOTICE 'is_active ì»¬ëŸ¼ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.';
  ELSE
    RAISE NOTICE 'is_active ì»¬ëŸ¼ì´ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤.';
  END IF;
END $$;

-- 2. ê¸°ì¡´ ë°ì´í„°ì˜ is_active ê°’ì´ NULLì¸ ê²½ìš° trueë¡œ ì„¤ì •
UPDATE badges 
SET is_active = true 
WHERE is_active IS NULL;

-- 3. ì¸ë±ìŠ¤ ì¶”ê°€ (ì—†ëŠ” ê²½ìš°ì—ë§Œ)
CREATE INDEX IF NOT EXISTS idx_badges_is_active 
ON badges(is_active);

-- 4. ì½”ë©˜íŠ¸ ì¶”ê°€
COMMENT ON COLUMN badges.is_active IS 'ë±ƒì§€ì˜ ê³µê°œ/ë¹„ê³µê°œ ìƒíƒœ. trueë©´ ê³µê°œ, falseë©´ ë¹„ê³µê°œ (ê´€ë¦¬ììš©)';

-- 5. í™•ì¸ ì¿¼ë¦¬
SELECT 
  column_name, 
  data_type, 
  column_default, 
  is_nullable
FROM information_schema.columns
WHERE table_schema = 'public' 
AND table_name = 'badges' 
AND column_name = 'is_active';
</file>

<file path="scripts/036_rename_bangol_to_vangol.sql">
-- 'bangol' ìŠ¬ëŸ¬ê·¸ë¥¼ 'vangol'ë¡œ ì¼ê´„ ë³€ê²½í•˜ëŠ” ë§ˆì´ê·¸ë ˆì´ì…˜
-- ì»¤ë®¤ë‹ˆí‹° ì¹´í…Œê³ ë¦¬ ìŠ¬ëŸ¬ê·¸ í†µì¼ ì‘ì—…

-- 1. board_categories í…Œì´ë¸”ì—ì„œ slug ì—…ë°ì´íŠ¸
UPDATE public.board_categories
SET slug = 'vangol'
WHERE slug = 'bangol';

-- 2. posts í…Œì´ë¸”ì˜ category ì»¬ëŸ¼ ì—…ë°ì´íŠ¸ (ë§Œì•½ ìˆë‹¤ë©´)
-- ì£¼ì˜: category ì»¬ëŸ¼ì´ deprecatedë˜ì—ˆì„ ìˆ˜ ìˆì§€ë§Œ, ì•ˆì „ì„ ìœ„í•´ ì—…ë°ì´íŠ¸
UPDATE public.posts
SET category = 'vangol'
WHERE category = 'bangol';

-- 3. communities í…Œì´ë¸”ì—ì„œ slugë‚˜ name í•„ë“œì— 'bangol'ì´ í¬í•¨ëœ ê²½ìš° í™•ì¸ ë° ì—…ë°ì´íŠ¸
-- (communities í…Œì´ë¸”ì— slug ì»¬ëŸ¼ì´ ìˆë‹¤ë©´)
-- UPDATE public.communities
-- SET slug = 'vangol'
-- WHERE slug = 'bangol';

-- 4. ë³€ê²½ ì‚¬í•­ í™•ì¸ ì¿¼ë¦¬ (ì‹¤í–‰ í›„ í™•ì¸ìš©)
-- SELECT slug, name, description 
-- FROM public.board_categories 
-- WHERE slug IN ('bangol', 'vangol');

-- 5. ê²Œì‹œê¸€ê³¼ì˜ ì—°ê²° í™•ì¸ (ì‹¤í–‰ í›„ í™•ì¸ìš©)
-- SELECT COUNT(*) as post_count
-- FROM public.posts p
-- INNER JOIN public.board_categories bc ON p.board_category_id = bc.id
-- WHERE bc.slug = 'vangol';
</file>

<file path="scripts/037_add_badges_rls_policy.sql">
-- badges í…Œì´ë¸” RLS ì •ì±… ì¶”ê°€
-- ê´€ë¦¬ìê°€ ë±ƒì§€ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆë„ë¡ UPDATE ì •ì±… ì„¤ì •

-- 1. RLS í™œì„±í™” (ì´ë¯¸ ë˜ì–´ ìˆì„ ìˆ˜ ìˆìŒ)
ALTER TABLE badges ENABLE ROW LEVEL SECURITY;

-- 2. ê¸°ì¡´ ì •ì±… ì‚­ì œ (ìˆë‹¤ë©´)
DROP POLICY IF EXISTS "Admins can update badges" ON badges;
DROP POLICY IF EXISTS "Anyone can view badges" ON badges;

-- 3. SELECT ì •ì±…: ëª¨ë“  ì‚¬ëŒì´ ë±ƒì§€ë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆìŒ
CREATE POLICY "Anyone can view badges"
ON badges
FOR SELECT
TO public
USING (true);

-- 4. UPDATE ì •ì±…: ê´€ë¦¬ì(admin, master)ë§Œ ë±ƒì§€ë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆìŒ
CREATE POLICY "Admins can update badges"
ON badges
FOR UPDATE
USING (
  EXISTS (
    SELECT 1 FROM profiles
    WHERE profiles.id = auth.uid()
    AND profiles.role IN ('admin', 'master')
  )
)
WITH CHECK (
  EXISTS (
    SELECT 1 FROM profiles
    WHERE profiles.id = auth.uid()
    AND profiles.role IN ('admin', 'master')
  )
);

-- 5. INSERT ì •ì±…: ê´€ë¦¬ìë§Œ ë±ƒì§€ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŒ
DROP POLICY IF EXISTS "Admins can create badges" ON badges;
CREATE POLICY "Admins can create badges"
ON badges
FOR INSERT
WITH CHECK (
  EXISTS (
    SELECT 1 FROM profiles
    WHERE profiles.id = auth.uid()
    AND profiles.role IN ('admin', 'master')
  )
);

-- 6. DELETE ì •ì±…: ê´€ë¦¬ìë§Œ ë±ƒì§€ë¥¼ ì‚­ì œí•  ìˆ˜ ìˆìŒ
DROP POLICY IF EXISTS "Admins can delete badges" ON badges;
CREATE POLICY "Admins can delete badges"
ON badges
FOR DELETE
USING (
  EXISTS (
    SELECT 1 FROM profiles
    WHERE profiles.id = auth.uid()
    AND profiles.role IN ('admin', 'master')
  )
);

-- ì •ì±… í™•ì¸
SELECT 
  schemaname,
  tablename,
  policyname,
  permissive,
  roles,
  cmd,
  qual,
  with_check
FROM pg_policies
WHERE tablename = 'badges';
</file>

<file path="scripts/037_add_event_request_category.sql">
-- ì—´ì–´ì£¼ì„¸ìš”(Event Requests) ì¹´í…Œê³ ë¦¬ ì¶”ê°€ ìŠ¤í¬ë¦½íŠ¸

-- event-requests ì¹´í…Œê³ ë¦¬ ì¶”ê°€
INSERT INTO public.board_categories (name, slug, description, order_index, is_active)
VALUES 
  ('ì—´ì–´ì£¼ì„¸ìš”', 'event-requests', 'ì—¬ëŸ¬ë¶„ì˜ ìš”ì²­ìœ¼ë¡œ ì´ë²¤íŠ¸ê°€ ì—´ë¦½ë‹ˆë‹¤. ì¢‹ì•„ìš”ë¥¼ ëˆŒëŸ¬ ìˆ˜ìš”ë¥¼ ë³´ì—¬ì£¼ì„¸ìš”!', 5, true)
ON CONFLICT (slug) 
DO UPDATE SET name = EXCLUDED.name, description = EXCLUDED.description, is_active = EXCLUDED.is_active;
</file>

<file path="scripts/038_anonymous_likes.sql">
-- ê²Œì‹œê¸€ ì¢‹ì•„ìš” ìˆ˜ ì§ì ‘ ì¦ê°€ í•¨ìˆ˜ (ë¹„íšŒì›ìš©)
-- ì´ í•¨ìˆ˜ëŠ” ë¹„ë¡œê·¸ì¸ ì‚¬ìš©ìê°€ ì¢‹ì•„ìš”ë¥¼ ëˆ„ë¥¼ ë•Œ posts.likes_countë¥¼ ì§ì ‘ ì¦ê°€ì‹œí‚µë‹ˆë‹¤.

CREATE OR REPLACE FUNCTION increment_post_likes(post_id uuid)
RETURNS void
LANGUAGE plpgsql
SECURITY DEFINER
AS $$
BEGIN
  UPDATE posts
  SET likes_count = COALESCE(likes_count, 0) + 1
  WHERE id = post_id;
END;
$$;

-- í•¨ìˆ˜ì— ëŒ€í•œ ì‹¤í–‰ ê¶Œí•œ ë¶€ì—¬ (ìµëª… ì‚¬ìš©ìë„ í˜¸ì¶œ ê°€ëŠ¥)
GRANT EXECUTE ON FUNCTION increment_post_likes(uuid) TO anon;
GRANT EXECUTE ON FUNCTION increment_post_likes(uuid) TO authenticated;
</file>

<file path="scripts/038_create_categories_table.sql">
-- categories í…Œì´ë¸” ìƒì„±
-- ì¸ì‚¬ì´íŠ¸ì™€ íŒŒíŠ¸ë„ˆìŠ¤ ì¹´í…Œê³ ë¦¬ë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•œ í…Œì´ë¸”

CREATE TABLE IF NOT EXISTS public.categories (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name TEXT NOT NULL,
  type TEXT NOT NULL CHECK (type IN ('insight', 'partner')),
  created_at TIMESTAMPTZ DEFAULT NOW() NOT NULL
);

-- ì¸ë±ìŠ¤ ìƒì„±
CREATE INDEX IF NOT EXISTS idx_categories_type ON public.categories(type);
CREATE INDEX IF NOT EXISTS idx_categories_name ON public.categories(name);

-- Row Level Security í™œì„±í™”
ALTER TABLE public.categories ENABLE ROW LEVEL SECURITY;

-- RLS ì •ì±…: ëª¨ë“  ì‚¬ìš©ìê°€ ì¡°íšŒ ê°€ëŠ¥
CREATE POLICY "Categories are viewable by everyone"
  ON public.categories FOR SELECT
  USING (true);

-- RLS ì •ì±…: ê´€ë¦¬ìë§Œ ìƒì„±/ìˆ˜ì •/ì‚­ì œ ê°€ëŠ¥ (auth.uid()ê°€ profiles í…Œì´ë¸”ì—ì„œ role='admin' ë˜ëŠ” master_adminì¸ ê²½ìš°)
-- ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ì„œë²„ ì‚¬ì´ë“œì—ì„œ ê´€ë¦¬ì ê¶Œí•œì„ ì²´í¬í•˜ë¯€ë¡œ, ì—¬ê¸°ì„œëŠ” ì¸ì¦ëœ ì‚¬ìš©ìë§Œ í—ˆìš©
CREATE POLICY "Authenticated users can manage categories"
  ON public.categories FOR ALL
  USING (auth.role() = 'authenticated')
  WITH CHECK (auth.role() = 'authenticated');

-- ì´ˆê¸° ë°ì´í„° ì‚½ì…
-- 'insight' íƒ€ì…
INSERT INTO public.categories (name, type) VALUES
  ('íŠ¸ë Œë“œ', 'insight'),
  ('ê¸°ìˆ ', 'insight'),
  ('ê²½ì˜', 'insight')
ON CONFLICT DO NOTHING;

-- 'partner' íƒ€ì…
INSERT INTO public.categories (name, type) VALUES
  ('ë²•ë¥ ', 'partner'),
  ('íšŒê³„', 'partner'),
  ('ê°œë°œ', 'partner')
ON CONFLICT DO NOTHING;
</file>

<file path="scripts/039_create_inquiries_table.sql">
-- inquiries í…Œì´ë¸” ìƒì„±
-- ê³ ê°ì„¼í„° 1:1 ë¬¸ì˜ ë° ì˜ê²¬ì„ ì €ì¥í•˜ëŠ” í…Œì´ë¸”

CREATE TABLE IF NOT EXISTS public.inquiries (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  type TEXT NOT NULL CHECK (type IN ('service', 'error', 'suggestion', 'other')),
  title TEXT NOT NULL,
  content TEXT NOT NULL,
  user_id UUID REFERENCES public.profiles(id) ON DELETE SET NULL,
  status TEXT NOT NULL DEFAULT 'pending' CHECK (status IN ('pending', 'in_progress', 'resolved', 'closed')),
  created_at TIMESTAMPTZ DEFAULT NOW() NOT NULL,
  updated_at TIMESTAMPTZ DEFAULT NOW() NOT NULL
);

-- ì¸ë±ìŠ¤ ìƒì„±
CREATE INDEX IF NOT EXISTS idx_inquiries_user_id ON public.inquiries(user_id);
CREATE INDEX IF NOT EXISTS idx_inquiries_status ON public.inquiries(status);
CREATE INDEX IF NOT EXISTS idx_inquiries_created_at ON public.inquiries(created_at DESC);

-- Row Level Security í™œì„±í™”
ALTER TABLE public.inquiries ENABLE ROW LEVEL SECURITY;

-- RLS ì •ì±…: ëª¨ë“  ì‚¬ìš©ìê°€ ìì‹ ì˜ ë¬¸ì˜ë¥¼ ì¡°íšŒ ê°€ëŠ¥
CREATE POLICY "Users can view their own inquiries"
  ON public.inquiries FOR SELECT
  USING (auth.uid() = user_id OR user_id IS NULL);

-- RLS ì •ì±…: ì¸ì¦ëœ ì‚¬ìš©ìë§Œ ë¬¸ì˜ ìƒì„± ê°€ëŠ¥ (ë¹„ë¡œê·¸ì¸ ì‚¬ìš©ìë„ ê°€ëŠ¥í•˜ë„ë¡ user_idê°€ NULLì¸ ê²½ìš° í—ˆìš©)
CREATE POLICY "Anyone can create inquiries"
  ON public.inquiries FOR INSERT
  WITH CHECK (true);

-- RLS ì •ì±…: ê´€ë¦¬ìë§Œ ìˆ˜ì •/ì‚­ì œ ê°€ëŠ¥ (ì¶”í›„ êµ¬í˜„)
-- CREATE POLICY "Admins can manage inquiries"
--   ON public.inquiries FOR ALL
--   USING (
--     EXISTS (
--       SELECT 1 FROM public.profiles 
--       WHERE profiles.id = auth.uid() 
--       AND profiles.role IN ('admin', 'master')
--     )
--   );

-- updated_at ìë™ ì—…ë°ì´íŠ¸ íŠ¸ë¦¬ê±° í•¨ìˆ˜
CREATE OR REPLACE FUNCTION update_inquiries_updated_at()
RETURNS TRIGGER AS $$
BEGIN
  NEW.updated_at = NOW();
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- íŠ¸ë¦¬ê±° ìƒì„±
CREATE TRIGGER update_inquiries_updated_at
  BEFORE UPDATE ON public.inquiries
  FOR EACH ROW
  EXECUTE FUNCTION update_inquiries_updated_at();
</file>

<file path="scripts/039_event_custom_fields.sql">
-- ì´ë²¤íŠ¸ ì»¤ìŠ¤í…€ ì‹ ì²­ì„œ í•„ë“œ ë° ì‘ë‹µ í…Œì´ë¸” ìƒì„±/ì—…ë°ì´íŠ¸

-- event_registration_fields í…Œì´ë¸”ì´ ì´ë¯¸ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸í•˜ê³  ì—…ë°ì´íŠ¸
-- ê¸°ì¡´ í…Œì´ë¸”ì´ ìˆë‹¤ë©´ ì»¬ëŸ¼ëª…ì„ ì‚¬ìš©ì ìš”ì²­ì— ë§ê²Œ ë³€ê²½
DO $$
BEGIN
  -- ê¸°ì¡´ í…Œì´ë¸”ì´ ìˆëŠ”ì§€ í™•ì¸
  IF EXISTS (SELECT FROM information_schema.tables WHERE table_name = 'event_registration_fields') THEN
    -- ê¸°ì¡´ ì»¬ëŸ¼ëª…ì„ ìƒˆë¡œìš´ ì»¬ëŸ¼ëª…ìœ¼ë¡œ ë³€ê²½ (í•„ìš”ì‹œ)
    -- field_name -> label (ë³„ì¹­ìœ¼ë¡œ ì²˜ë¦¬í•˜ê±°ë‚˜ ìƒˆ ì»¬ëŸ¼ ì¶”ê°€)
    IF NOT EXISTS (SELECT FROM information_schema.columns WHERE table_name = 'event_registration_fields' AND column_name = 'label') THEN
      ALTER TABLE event_registration_fields ADD COLUMN label TEXT;
      -- ê¸°ì¡´ field_name ê°’ì„ labelë¡œ ë³µì‚¬
      UPDATE event_registration_fields SET label = field_name;
      -- labelì„ NOT NULLë¡œ ë³€ê²½
      ALTER TABLE event_registration_fields ALTER COLUMN label SET NOT NULL;
    END IF;
    
    -- field_type -> type (ë³„ì¹­ìœ¼ë¡œ ì²˜ë¦¬í•˜ê±°ë‚˜ ìƒˆ ì»¬ëŸ¼ ì¶”ê°€)
    IF NOT EXISTS (SELECT FROM information_schema.columns WHERE table_name = 'event_registration_fields' AND column_name = 'type') THEN
      ALTER TABLE event_registration_fields ADD COLUMN type TEXT;
      -- ê¸°ì¡´ field_type ê°’ì„ typeìœ¼ë¡œ ë³µì‚¬
      UPDATE event_registration_fields SET type = field_type;
      -- typeì„ NOT NULLë¡œ ë³€ê²½
      ALTER TABLE event_registration_fields ALTER COLUMN type SET NOT NULL;
    END IF;
    
    -- field_options -> options (JSONBëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€)
    IF NOT EXISTS (SELECT FROM information_schema.columns WHERE table_name = 'event_registration_fields' AND column_name = 'options') THEN
      ALTER TABLE event_registration_fields ADD COLUMN options JSONB;
      -- ê¸°ì¡´ field_options ê°’ì„ optionsë¡œ ë³µì‚¬
      UPDATE event_registration_fields SET options = field_options;
    END IF;
    
    -- is_required -> required
    IF NOT EXISTS (SELECT FROM information_schema.columns WHERE table_name = 'event_registration_fields' AND column_name = 'required') THEN
      ALTER TABLE event_registration_fields ADD COLUMN required BOOLEAN DEFAULT false;
      -- ê¸°ì¡´ is_required ê°’ì„ requiredë¡œ ë³µì‚¬
      UPDATE event_registration_fields SET required = is_required;
    END IF;
  ELSE
    -- í…Œì´ë¸”ì´ ì—†ìœ¼ë©´ ìƒˆë¡œ ìƒì„±
    CREATE TABLE event_registration_fields (
      id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
      event_id UUID NOT NULL REFERENCES events(id) ON DELETE CASCADE,
      label TEXT NOT NULL,
      type TEXT NOT NULL CHECK (type IN ('text', 'select')),
      options JSONB, -- select íƒ€ì…ì¼ ë•Œ ì„ íƒì§€ ë°°ì—´
      required BOOLEAN DEFAULT false,
      order_index INTEGER DEFAULT 0,
      created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
    );
  END IF;
END $$;

-- event_registration_responses í…Œì´ë¸” ì—…ë°ì´íŠ¸
DO $$
BEGIN
  IF EXISTS (SELECT FROM information_schema.tables WHERE table_name = 'event_registration_responses') THEN
    -- response_value -> value
    IF NOT EXISTS (SELECT FROM information_schema.columns WHERE table_name = 'event_registration_responses' AND column_name = 'value') THEN
      ALTER TABLE event_registration_responses ADD COLUMN value TEXT;
      -- ê¸°ì¡´ response_value ê°’ì„ valueë¡œ ë³µì‚¬
      UPDATE event_registration_responses SET value = response_value;
    END IF;
  ELSE
    -- í…Œì´ë¸”ì´ ì—†ìœ¼ë©´ ìƒˆë¡œ ìƒì„±
    CREATE TABLE event_registration_responses (
      id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
      registration_id UUID NOT NULL REFERENCES event_registrations(id) ON DELETE CASCADE,
      field_id UUID NOT NULL REFERENCES event_registration_fields(id) ON DELETE CASCADE,
      value TEXT,
      created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
      UNIQUE(registration_id, field_id)
    );
  END IF;
END $$;

-- RLS ì •ì±… ì„¤ì •
ALTER TABLE event_registration_fields ENABLE ROW LEVEL SECURITY;
ALTER TABLE event_registration_responses ENABLE ROW LEVEL SECURITY;

-- ê¸°ì¡´ ì •ì±… ì‚­ì œ (ì¬ìƒì„±ì„ ìœ„í•´)
DROP POLICY IF EXISTS "Anyone can view event registration fields" ON event_registration_fields;
DROP POLICY IF EXISTS "Event creators can manage fields" ON event_registration_fields;
DROP POLICY IF EXISTS "Users can view their own responses" ON event_registration_responses;
DROP POLICY IF EXISTS "Event creators can view all responses" ON event_registration_responses;
DROP POLICY IF EXISTS "Registered users can submit responses" ON event_registration_responses;

-- event_registration_fields ì •ì±…
-- ëˆ„êµ¬ë‚˜ ì¡°íšŒ ê°€ëŠ¥
CREATE POLICY "Anyone can view event registration fields" ON event_registration_fields
  FOR SELECT USING (true);

-- í˜¸ìŠ¤íŠ¸ë§Œ ìƒì„±/ìˆ˜ì •/ì‚­ì œ ê°€ëŠ¥
CREATE POLICY "Event creators can manage fields" ON event_registration_fields
  FOR ALL USING (
    EXISTS (
      SELECT 1 FROM events 
      WHERE events.id = event_registration_fields.event_id 
      AND events.created_by = auth.uid()
    )
  );

-- event_registration_responses ì •ì±…
-- ë³¸ì¸ê³¼ í˜¸ìŠ¤íŠ¸ë§Œ ì¡°íšŒ ê°€ëŠ¥
CREATE POLICY "Users can view their own responses" ON event_registration_responses
  FOR SELECT USING (
    EXISTS (
      SELECT 1 FROM event_registrations 
      WHERE event_registrations.id = event_registration_responses.registration_id 
      AND event_registrations.user_id = auth.uid()
    )
  );

CREATE POLICY "Event creators can view all responses" ON event_registration_responses
  FOR SELECT USING (
    EXISTS (
      SELECT 1 FROM event_registrations
      JOIN events ON events.id = event_registrations.event_id
      WHERE event_registrations.id = event_registration_responses.registration_id 
      AND events.created_by = auth.uid()
    )
  );

-- ë“±ë¡ëœ ì‚¬ìš©ìëŠ” ìì‹ ì˜ ì‘ë‹µì„ ì œì¶œí•  ìˆ˜ ìˆìŒ
CREATE POLICY "Registered users can submit responses" ON event_registration_responses
  FOR INSERT WITH CHECK (
    EXISTS (
      SELECT 1 FROM event_registrations 
      WHERE event_registrations.id = event_registration_responses.registration_id 
      AND event_registrations.user_id = auth.uid()
    )
  );

-- ì¸ë±ìŠ¤ ì¶”ê°€ (ì„±ëŠ¥ ìµœì í™”)
CREATE INDEX IF NOT EXISTS idx_event_registration_fields_event_id 
ON event_registration_fields(event_id);

CREATE INDEX IF NOT EXISTS idx_event_registration_responses_registration_id 
ON event_registration_responses(registration_id);

CREATE INDEX IF NOT EXISTS idx_event_registration_responses_field_id 
ON event_registration_responses(field_id);
</file>

<file path="scripts/040_add_event_types.sql">
-- ì´ë²¤íŠ¸ íƒ€ì… ì¹´í…Œê³ ë¦¬ ì¶”ê°€ ìŠ¤í¬ë¦½íŠ¸

DO $$ 
BEGIN
  IF NOT EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name = 'events' AND column_name = 'event_type') THEN
    ALTER TABLE public.events ADD COLUMN event_type text DEFAULT 'networking' NOT NULL;
    ALTER TABLE public.events ADD CONSTRAINT events_event_type_check CHECK (event_type IN ('networking', 'class', 'activity'));
  END IF;
END $$;

-- ê¸°ì¡´ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ (ì˜ˆì‹œ)
UPDATE public.events SET event_type = 'class' WHERE title LIKE '%ì›Œí¬ìƒµ%' OR title LIKE '%ê°•ì˜%' OR title LIKE '%í•´ì»¤í†¤%' OR title LIKE '%í´ë˜ìŠ¤%' OR title LIKE '%ì„¸ë¯¸ë‚˜%';
UPDATE public.events SET event_type = 'activity' WHERE title LIKE '%ë“±ì‚°%' OR title LIKE '%ëŸ¬ë‹%' OR title LIKE '%ìš”ê°€%' OR title LIKE '%ìŠ¤í¬ì¸ %' OR title LIKE '%ì•¡í‹°ë¹„í‹°%';
-- ë‚˜ë¨¸ì§€ëŠ” networking ìœ ì§€
</file>

<file path="scripts/040_create_partner_applications_table.sql">
-- partner_applications í…Œì´ë¸” ìƒì„±
-- íŒŒíŠ¸ë„ˆìŠ¤ ì„œë¹„ìŠ¤ ì‹ ì²­ì„ ê´€ë¦¬í•˜ëŠ” í…Œì´ë¸”

CREATE TABLE IF NOT EXISTS public.partner_applications (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES public.profiles(id) ON DELETE CASCADE NOT NULL,
  partner_id UUID, -- partners í…Œì´ë¸”ì´ ìˆì„ ê²½ìš° ì°¸ì¡° (nullable)
  partner_name TEXT NOT NULL, -- ì‹ ì²­í•œ íŒŒíŠ¸ë„ˆ ì´ë¦„
  company_name TEXT,
  current_usage TEXT, -- í˜„ì¬ ì´ìš© ì—¬ë¶€
  status TEXT NOT NULL DEFAULT 'pending' CHECK (status IN ('pending', 'approved', 'rejected')),
  created_at TIMESTAMPTZ DEFAULT NOW() NOT NULL,
  updated_at TIMESTAMPTZ DEFAULT NOW() NOT NULL
);

-- ì¸ë±ìŠ¤ ìƒì„±
CREATE INDEX IF NOT EXISTS idx_partner_applications_user_id ON public.partner_applications(user_id);
CREATE INDEX IF NOT EXISTS idx_partner_applications_status ON public.partner_applications(status);
CREATE INDEX IF NOT EXISTS idx_partner_applications_created_at ON public.partner_applications(created_at DESC);

-- Row Level Security í™œì„±í™”
ALTER TABLE public.partner_applications ENABLE ROW LEVEL SECURITY;

-- RLS ì •ì±…: ì‚¬ìš©ìëŠ” ìì‹ ì˜ ì‹ ì²­ì„ ì¡°íšŒ ê°€ëŠ¥
CREATE POLICY "Users can view their own applications"
  ON public.partner_applications FOR SELECT
  USING (auth.uid() = user_id);

-- RLS ì •ì±…: ì¸ì¦ëœ ì‚¬ìš©ìëŠ” ì‹ ì²­ ìƒì„± ê°€ëŠ¥
CREATE POLICY "Authenticated users can create applications"
  ON public.partner_applications FOR INSERT
  WITH CHECK (auth.uid() = user_id);

-- RLS ì •ì±…: ê´€ë¦¬ìëŠ” ëª¨ë“  ì‹ ì²­ ì¡°íšŒ ë° ìˆ˜ì • ê°€ëŠ¥
CREATE POLICY "Admins can manage all applications"
  ON public.partner_applications FOR ALL
  USING (
    EXISTS (
      SELECT 1 FROM public.profiles 
      WHERE profiles.id = auth.uid() 
      AND profiles.role IN ('admin', 'master')
    )
  )
  WITH CHECK (
    EXISTS (
      SELECT 1 FROM public.profiles 
      WHERE profiles.id = auth.uid() 
      AND profiles.role IN ('admin', 'master')
    )
  );

-- updated_at ìë™ ì—…ë°ì´íŠ¸ íŠ¸ë¦¬ê±° í•¨ìˆ˜
CREATE OR REPLACE FUNCTION update_partner_applications_updated_at()
RETURNS TRIGGER AS $$
BEGIN
  NEW.updated_at = NOW();
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- íŠ¸ë¦¬ê±° ìƒì„±
CREATE TRIGGER update_partner_applications_updated_at
  BEFORE UPDATE ON public.partner_applications
  FOR EACH ROW
  EXECUTE FUNCTION update_partner_applications_updated_at();
</file>

<file path="scripts/041_allow_guest_registration.sql">
-- ë¹„íšŒì›(Guest) ì´ë²¤íŠ¸ ì‹ ì²­ ê¸°ëŠ¥ í™œì„±í™” ìŠ¤í¬ë¦½íŠ¸

-- 1. event_registrations í…Œì´ë¸”ì˜ user_id ì»¬ëŸ¼ì„ NULL í—ˆìš©ìœ¼ë¡œ ë³€ê²½
-- (ì´ë¯¸ 008_add_guest_registration.sqlì—ì„œ ì²˜ë¦¬ë˜ì—ˆì„ ìˆ˜ ìˆì§€ë§Œ, ì•ˆì „í•˜ê²Œ í™•ì¸)
DO $$ 
BEGIN
  -- user_id ì»¬ëŸ¼ì´ NOT NULL ì œì•½ì´ ìˆë‹¤ë©´ ì œê±°
  IF EXISTS (
    SELECT 1 
    FROM information_schema.table_constraints tc
    JOIN information_schema.constraint_column_usage ccu 
      ON tc.constraint_name = ccu.constraint_name
    WHERE tc.table_name = 'event_registrations' 
      AND tc.constraint_type = 'NOT NULL'
      AND ccu.column_name = 'user_id'
  ) THEN
    ALTER TABLE event_registrations ALTER COLUMN user_id DROP NOT NULL;
  END IF;
END $$;

-- 2. guest_name, guest_contact ì»¬ëŸ¼ ì¶”ê°€ (ì´ë¯¸ ì¡´ì¬í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ IF NOT EXISTS ì²˜ë¦¬)
ALTER TABLE event_registrations 
ADD COLUMN IF NOT EXISTS guest_name TEXT,
ADD COLUMN IF NOT EXISTS guest_contact TEXT;

-- 3. RLS ì •ì±… ìˆ˜ì •: anon roleë„ INSERT ê°€ëŠ¥í•˜ë„ë¡ í—ˆìš©
-- ê¸°ì¡´ ì •ì±… ì‚­ì œ
DROP POLICY IF EXISTS "Anyone can register for events" ON event_registrations;
DROP POLICY IF EXISTS "Users can register for events" ON event_registrations;
DROP POLICY IF EXISTS "Anonymous can register for events" ON event_registrations;

-- ìƒˆë¡œìš´ ì •ì±…: ë¡œê·¸ì¸/ë¹„ë¡œê·¸ì¸ ëª¨ë‘ INSERT ê°€ëŠ¥
CREATE POLICY "Anyone can register for events" ON event_registrations
  FOR INSERT 
  WITH CHECK (true);

-- DELETE ì •ì±…ë„ ìˆ˜ì •: ê²ŒìŠ¤íŠ¸ëŠ” ìì‹ ì˜ ë“±ë¡ì„ ì‚­ì œí•  ìˆ˜ ì—†ì§€ë§Œ, 
-- ì´ë²¤íŠ¸ ê°œì„¤ìëŠ” ëª¨ë“  ë“±ë¡ì„ ì‚­ì œí•  ìˆ˜ ìˆë„ë¡ ìœ ì§€
DROP POLICY IF EXISTS "Users can cancel their registrations" ON event_registrations;
CREATE POLICY "Users can cancel their registrations" ON event_registrations
  FOR DELETE 
  USING (
    auth.uid() = user_id 
    OR user_id IS NULL  -- ê²ŒìŠ¤íŠ¸ ë“±ë¡ì€ ì‚­ì œ ë¶ˆê°€ (ë³´ì•ˆìƒ ì´ë²¤íŠ¸ ê°œì„¤ìë§Œ ì‚­ì œ ê°€ëŠ¥)
  );

-- 4. ì¸ë±ìŠ¤ ì¶”ê°€ (ì„±ëŠ¥ ìµœì í™”)
CREATE INDEX IF NOT EXISTS idx_event_registrations_guest 
ON event_registrations(event_id) 
WHERE user_id IS NULL;

-- 5. CHECK ì œì•½ ì¡°ê±´ ì¶”ê°€: user_idì™€ guest_name ì¤‘ í•˜ë‚˜ëŠ” ë°˜ë“œì‹œ ìˆì–´ì•¼ í•¨
DO $$
BEGIN
  IF NOT EXISTS (
    SELECT 1 
    FROM information_schema.table_constraints 
    WHERE constraint_name = 'event_registrations_user_or_guest_check'
  ) THEN
    ALTER TABLE event_registrations 
    ADD CONSTRAINT event_registrations_user_or_guest_check 
    CHECK (user_id IS NOT NULL OR (guest_name IS NOT NULL AND guest_contact IS NOT NULL));
  END IF;
END $$;
</file>

<file path="scripts/042_add_review_features.sql">
-- í›„ê¸° ì‹œìŠ¤í…œ ìŠ¤í‚¤ë§ˆ í™•ì¥
-- ì‹¤í–‰ì¼: 2024

-- 1. posts í…Œì´ë¸”ì— ì´ë²¤íŠ¸ ì—°ê²° ê³ ë¦¬ ì¶”ê°€ (ì™¸ë˜í‚¤)
ALTER TABLE public.posts 
ADD COLUMN IF NOT EXISTS related_event_id uuid REFERENCES public.events(id) ON DELETE SET NULL;

-- index ì¶”ê°€ (ì¡°ì¸ ì„±ëŠ¥ í–¥ìƒ)
CREATE INDEX IF NOT EXISTS idx_posts_related_event_id ON public.posts(related_event_id);

-- 2. í›„ê¸° ì „ìš© ì¹´í…Œê³ ë¦¬ ì¶”ê°€
INSERT INTO public.board_categories (name, slug, description, order_index, is_active)
VALUES ('ëª¨ì„ í›„ê¸°', 'reviews', 'ìƒìƒí•œ ëª¨ì„ í˜„ì¥ê³¼ í›„ê¸°ë¥¼ ê³µìœ í•©ë‹ˆë‹¤.', 99, true)
ON CONFLICT (slug) DO NOTHING;
</file>

<file path="scripts/043_fix_profile_trigger_and_recover_data.sql">
-- ============================================
-- í”„ë¡œí•„ ìë™ ìƒì„± íŠ¸ë¦¬ê±° ê°œì„  ë° ë°ì´í„° ë³µêµ¬
-- ============================================

-- Step 1: ê°œì„ ëœ íŠ¸ë¦¬ê±° í•¨ìˆ˜ ìƒì„±
-- (role í•„ë“œ ì¶”ê°€, ë” ì™„ì „í•œ ë©”íƒ€ë°ì´í„° ì²˜ë¦¬)

create or replace function public.handle_new_user()
returns trigger
language plpgsql
security definer
set search_path = public
as $$
begin
  insert into public.profiles (
    id, 
    email, 
    full_name, 
    avatar_url, 
    role
  )
  values (
    new.id,
    new.email,
    coalesce(
      new.raw_user_meta_data->>'full_name',
      new.raw_user_meta_data->>'name',
      split_part(new.email, '@', 1)
    ),
    coalesce(
      new.raw_user_meta_data->>'avatar_url',
      new.raw_user_meta_data->>'picture',
      null
    ),
    coalesce(
      new.raw_user_meta_data->>'role',
      'member'
    )
  )
  on conflict (id) do update
  set
    full_name = coalesce(excluded.full_name, profiles.full_name),
    avatar_url = coalesce(excluded.avatar_url, profiles.avatar_url),
    role = coalesce(excluded.role, profiles.role),
    email = coalesce(excluded.email, profiles.email);
  
  return new;
end;
$$;

-- Step 2: íŠ¸ë¦¬ê±° ì¬ìƒì„± (ê¸°ì¡´ íŠ¸ë¦¬ê±°ê°€ ìˆìœ¼ë©´ ì‚­ì œ í›„ ìƒì„±)
drop trigger if exists on_auth_user_created on auth.users;

create trigger on_auth_user_created
  after insert on auth.users
  for each row
  execute function public.handle_new_user();

-- ============================================
-- Step 3: ê¸°ì¡´ NULL ë°ì´í„° ë³µêµ¬
-- ============================================

-- full_nameì´ NULLì¸ í”„ë¡œí•„ì„ auth.usersì˜ ë©”íƒ€ë°ì´í„°ì—ì„œ ë³µêµ¬
UPDATE public.profiles
SET
  full_name = coalesce(
    (SELECT raw_user_meta_data->>'full_name' FROM auth.users WHERE auth.users.id = profiles.id),
    (SELECT raw_user_meta_data->>'name' FROM auth.users WHERE auth.users.id = profiles.id),
    split_part((SELECT email FROM auth.users WHERE auth.users.id = profiles.id), '@', 1)
  ),
  avatar_url = coalesce(
    profiles.avatar_url, -- ê¸°ì¡´ ê°’ì´ ìˆìœ¼ë©´ ìœ ì§€
    (SELECT raw_user_meta_data->>'avatar_url' FROM auth.users WHERE auth.users.id = profiles.id),
    (SELECT raw_user_meta_data->>'picture' FROM auth.users WHERE auth.users.id = profiles.id)
  ),
  role = coalesce(
    profiles.role, -- ê¸°ì¡´ ê°’ì´ ìˆìœ¼ë©´ ìœ ì§€
    (SELECT raw_user_meta_data->>'role' FROM auth.users WHERE auth.users.id = profiles.id),
    'member' -- ê¸°ë³¸ê°’
  ),
  email = coalesce(
    profiles.email, -- ê¸°ì¡´ ê°’ì´ ìˆìœ¼ë©´ ìœ ì§€
    (SELECT email FROM auth.users WHERE auth.users.id = profiles.id)
  )
WHERE 
  profiles.id IN (SELECT id FROM auth.users)
  AND (
    profiles.full_name IS NULL 
    OR profiles.avatar_url IS NULL 
    OR profiles.role IS NULL
    OR profiles.email IS NULL
  );

-- ============================================
-- í™•ì¸ ì¿¼ë¦¬ (ì‹¤í–‰ í›„ í™•ì¸ìš©)
-- ============================================

-- NULLì´ ë‚¨ì•„ìˆëŠ”ì§€ í™•ì¸
-- SELECT 
--   id,
--   email,
--   full_name,
--   avatar_url,
--   role
-- FROM public.profiles
-- WHERE 
--   full_name IS NULL 
--   OR email IS NULL
--   OR role IS NULL;
</file>

<file path="scripts/044_add_insights_and_thumbnail.sql">
-- 1. 'ì¸ì‚¬ì´íŠ¸' ì¹´í…Œê³ ë¦¬ ì¶”ê°€
INSERT INTO board_categories (name, slug, description, order_index, is_active)
VALUES ('ì¸ì‚¬ì´íŠ¸', 'insights', 'ì°½ì—…ê³¼ ì„±ì¥ì— í•„ìš”í•œ ê¹Šì´ ìˆëŠ” ì¹¼ëŸ¼ê³¼ íŒì„ ê³µìœ í•©ë‹ˆë‹¤.', 1, true)
ON CONFLICT (slug) DO UPDATE SET 
  name = EXCLUDED.name, 
  description = EXCLUDED.description, 
  is_active = true;

-- 2. posts í…Œì´ë¸”ì— ì¸ë„¤ì¼ URL ì»¬ëŸ¼ ì¶”ê°€
ALTER TABLE posts ADD COLUMN IF NOT EXISTS thumbnail_url text;
</file>

<file path="scripts/045_fix_posts_rls.sql">
-- ëª¨ë“  ê´€ë ¨ í…Œì´ë¸”ì— ëŒ€í•´ ìµëª… ì‚¬ìš©ì ì½ê¸° ê¶Œí•œ ê°•ì œ ë¶€ì—¬
ALTER TABLE public.posts ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.board_categories ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.profiles ENABLE ROW LEVEL SECURITY;

-- ê¸°ì¡´ ì •ì±… ì‚­ì œ (ì¶©ëŒ ë°©ì§€)
DROP POLICY IF EXISTS "Public Read Posts" ON public.posts;
DROP POLICY IF EXISTS "Public Read Categories" ON public.board_categories;
DROP POLICY IF EXISTS "Public Read Profiles" ON public.profiles;

-- ìƒˆ ì •ì±… ìƒì„± (ì¡°ê±´ ì—†ëŠ” ì „ì²´ ê³µê°œ)
CREATE POLICY "Public Read Posts" ON public.posts FOR SELECT TO public USING (true);
CREATE POLICY "Public Read Categories" ON public.board_categories FOR SELECT TO public USING (true);
CREATE POLICY "Public Read Profiles" ON public.profiles FOR SELECT TO public USING (true);
</file>

<file path="scripts/046_add_social_links_to_profiles.sql">
-- í”„ë¡œí•„ í…Œì´ë¸”ì— ì†Œì…œ ë§í¬ ì»¬ëŸ¼ ì¶”ê°€
-- LinkedIn, Instagram, Threads, Website ë§í¬ë¥¼ ì €ì¥í•  ìˆ˜ ìˆë„ë¡ í•¨

-- ì†Œì…œ ë§í¬ ì»¬ëŸ¼ ì¶”ê°€
ALTER TABLE public.profiles 
ADD COLUMN IF NOT EXISTS linkedin_url TEXT,
ADD COLUMN IF NOT EXISTS instagram_url TEXT,
ADD COLUMN IF NOT EXISTS threads_url TEXT,
ADD COLUMN IF NOT EXISTS website_url TEXT;

-- ì¸ë±ìŠ¤ ì¶”ê°€ (ì„ íƒì‚¬í•­, ê²€ìƒ‰ ìµœì í™”)
CREATE INDEX IF NOT EXISTS idx_profiles_linkedin_url ON public.profiles(linkedin_url) WHERE linkedin_url IS NOT NULL;
CREATE INDEX IF NOT EXISTS idx_profiles_instagram_url ON public.profiles(instagram_url) WHERE instagram_url IS NOT NULL;

-- ì½”ë©˜íŠ¸ ì¶”ê°€ (ì»¬ëŸ¼ ì„¤ëª…)
COMMENT ON COLUMN public.profiles.linkedin_url IS 'LinkedIn í”„ë¡œí•„ URL';
COMMENT ON COLUMN public.profiles.instagram_url IS 'Instagram í”„ë¡œí•„ URL';
COMMENT ON COLUMN public.profiles.threads_url IS 'Threads í”„ë¡œí•„ URL';
COMMENT ON COLUMN public.profiles.website_url IS 'ê°œì¸ ì›¹ì‚¬ì´íŠ¸ URL';
</file>

<file path="scripts/047_add_category_id_to_posts.sql">
-- posts í…Œì´ë¸”ì— category_id ì»¬ëŸ¼ ì¶”ê°€
-- categories í…Œì´ë¸”ì˜ idë¥¼ ì°¸ì¡°í•˜ëŠ” Foreign Key ì¶”ê°€

-- Step 1: category_id ì»¬ëŸ¼ ì¶”ê°€ (nullable, ì¸ì‚¬ì´íŠ¸/íŒŒíŠ¸ë„ˆìŠ¤ ê²Œì‹œíŒì—ë§Œ í•„ìš”)
ALTER TABLE public.posts 
ADD COLUMN IF NOT EXISTS category_id UUID REFERENCES public.categories(id) ON DELETE SET NULL;

-- Step 2: ì¸ë±ìŠ¤ ì¶”ê°€ (ì„±ëŠ¥ ìµœì í™”)
CREATE INDEX IF NOT EXISTS idx_posts_category_id ON public.posts(category_id) WHERE category_id IS NOT NULL;

-- Step 3: ë³µí•© ì¸ë±ìŠ¤ (board_category_idì™€ category_id í•¨ê»˜ ì‚¬ìš©í•˜ëŠ” ì¿¼ë¦¬ ìµœì í™”)
CREATE INDEX IF NOT EXISTS idx_posts_board_category_category ON public.posts(board_category_id, category_id) 
WHERE category_id IS NOT NULL;

-- ì½”ë©˜íŠ¸ ì¶”ê°€
COMMENT ON COLUMN public.posts.category_id IS 'ì¹´í…Œê³ ë¦¬ ID (insight ë˜ëŠ” partner íƒ€ì…ì˜ categories í…Œì´ë¸” ì°¸ì¡°)';
</file>

<file path="scripts/048_create_badge_categories_table.sql">
-- ë±ƒì§€ ì¹´í…Œê³ ë¦¬ ìˆœì„œ ê´€ë¦¬ í…Œì´ë¸” ìƒì„±
-- badges í…Œì´ë¸”ì˜ category ê°’ë“¤ì„ ê´€ë¦¬í•˜ê³  ìˆœì„œë¥¼ ì €ì¥

CREATE TABLE IF NOT EXISTS public.badge_categories (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  category_value TEXT NOT NULL UNIQUE, -- badges.category ê°’ (ì˜ˆ: 'personal_asset', 'investment')
  category_label TEXT NOT NULL, -- í‘œì‹œìš© ì´ë¦„ (ì˜ˆ: 'ê°œì¸ ìì‚°', 'íˆ¬ì ê·œëª¨')
  sort_order INTEGER DEFAULT 0 NOT NULL,
  created_at TIMESTAMPTZ DEFAULT NOW() NOT NULL,
  updated_at TIMESTAMPTZ DEFAULT NOW() NOT NULL
);

-- ì¸ë±ìŠ¤ ì¶”ê°€
CREATE INDEX IF NOT EXISTS idx_badge_categories_sort_order ON public.badge_categories(sort_order);
CREATE INDEX IF NOT EXISTS idx_badge_categories_category_value ON public.badge_categories(category_value);

-- RLS í™œì„±í™”
ALTER TABLE public.badge_categories ENABLE ROW LEVEL SECURITY;

-- ì •ì±… ì„¤ì •
CREATE POLICY "Badge categories are viewable by everyone" 
  ON public.badge_categories FOR SELECT 
  USING (true);

CREATE POLICY "Authenticated users can manage badge categories" 
  ON public.badge_categories FOR ALL 
  USING (auth.role() = 'authenticated') 
  WITH CHECK (auth.role() = 'authenticated');

-- ì´ˆê¸° ë°ì´í„° ì‚½ì… (ê¸°ì¡´ ì¹´í…Œê³ ë¦¬ë“¤)
INSERT INTO public.badge_categories (category_value, category_label, sort_order) VALUES
  ('personal_asset', 'ê°œì¸ ìì‚°', 0),
  ('corporate_revenue', 'ê¸°ì—… ë§¤ì¶œ', 1),
  ('investment', 'íˆ¬ì ê·œëª¨', 2),
  ('valuation', 'ê¸°ì—…ê°€ì¹˜', 3),
  ('influence', 'ì¸í”Œë£¨ì–¸ì„œ', 4),
  ('professional', 'ì „ë¬¸ì§', 5),
  ('community', 'ì»¤ë®¤ë‹ˆí‹°', 6)
ON CONFLICT (category_value) DO UPDATE
SET category_label = EXCLUDED.category_label;

-- ì½”ë©˜íŠ¸ ì¶”ê°€
COMMENT ON TABLE public.badge_categories IS 'ë±ƒì§€ ì¹´í…Œê³ ë¦¬ ìˆœì„œ ê´€ë¦¬ í…Œì´ë¸”';
COMMENT ON COLUMN public.badge_categories.category_value IS 'badges í…Œì´ë¸”ì˜ category ê°’';
COMMENT ON COLUMN public.badge_categories.category_label IS 'í‘œì‹œìš© ì¹´í…Œê³ ë¦¬ ì´ë¦„';
COMMENT ON COLUMN public.badge_categories.sort_order IS 'ì¹´í…Œê³ ë¦¬ í‘œì‹œ ìˆœì„œ (ì‘ì„ìˆ˜ë¡ ë¨¼ì € í‘œì‹œ)';
</file>

<file path="scripts/049_create_community_moderators_table.sql">
-- ì»¤ë®¤ë‹ˆí‹° ê´€ë¦¬ì í…Œì´ë¸” ìƒì„±
-- ì»¤ë®¤ë‹ˆí‹°ë³„ë¡œ ê´€ë¦¬ì(ëª¨ë”ë ˆì´í„°)ë¥¼ ì§€ì •í•  ìˆ˜ ìˆëŠ” í…Œì´ë¸”

CREATE TABLE IF NOT EXISTS public.community_moderators (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  community_id UUID NOT NULL REFERENCES communities(id) ON DELETE CASCADE,
  user_id UUID NOT NULL REFERENCES profiles(id) ON DELETE CASCADE,
  role TEXT DEFAULT 'moderator' NOT NULL, -- 'owner', 'moderator'
  created_at TIMESTAMPTZ DEFAULT NOW() NOT NULL,
  updated_at TIMESTAMPTZ DEFAULT NOW() NOT NULL,
  UNIQUE(community_id, user_id)
);

-- ì¸ë±ìŠ¤ ì¶”ê°€
CREATE INDEX IF NOT EXISTS idx_community_moderators_community ON public.community_moderators(community_id);
CREATE INDEX IF NOT EXISTS idx_community_moderators_user ON public.community_moderators(user_id);

-- RLS í™œì„±í™”
ALTER TABLE public.community_moderators ENABLE ROW LEVEL SECURITY;

-- ì •ì±… ì„¤ì •
CREATE POLICY "Community moderators are viewable by everyone" 
  ON public.community_moderators FOR SELECT 
  USING (true);

CREATE POLICY "Only community owners can manage moderators" 
  ON public.community_moderators FOR ALL 
  USING (
    auth.uid() IN (
      SELECT user_id FROM public.community_moderators 
      WHERE community_id = community_moderators.community_id 
      AND role = 'owner'
    )
  );

-- ì½”ë©˜íŠ¸ ì¶”ê°€
COMMENT ON TABLE public.community_moderators IS 'ì»¤ë®¤ë‹ˆí‹° ê´€ë¦¬ì(ëª¨ë”ë ˆì´í„°) í…Œì´ë¸”';
COMMENT ON COLUMN public.community_moderators.role IS 'ê´€ë¦¬ì ì—­í• : owner(ì†Œìœ ì), moderator(ê´€ë¦¬ì)';
ã…‡
</file>

<file path="scripts/049_create_partner_proposals_table.sql">
-- íŒŒíŠ¸ë„ˆìŠ¤ ì œì•ˆ(ì‹ ì²­) í…Œì´ë¸” ìƒì„±
-- íŒŒíŠ¸ë„ˆì‚¬ê°€ SFCì— ì œíœ´ë¥¼ ì œì•ˆí•  ë•Œ ì‚¬ìš©í•˜ëŠ” í…Œì´ë¸”

CREATE TABLE IF NOT EXISTS public.partner_proposals (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  contact_name TEXT NOT NULL, -- ë‹´ë‹¹ì ì„±í•¨
  contact_email TEXT NOT NULL, -- ì—°ë½ì²˜ (ì´ë©”ì¼)
  company_name TEXT NOT NULL, -- íšŒì‚¬ëª…
  service_name TEXT NOT NULL, -- ì„œë¹„ìŠ¤ëª…
  website_url TEXT, -- ì›¹ì‚¬ì´íŠ¸ URL
  benefit_proposal TEXT NOT NULL, -- ì œì•ˆí•  í˜œíƒ ë‚´ìš©
  status TEXT NOT NULL DEFAULT 'pending' CHECK (status IN ('pending', 'reviewing', 'approved', 'rejected')),
  created_at TIMESTAMPTZ DEFAULT NOW() NOT NULL,
  updated_at TIMESTAMPTZ DEFAULT NOW() NOT NULL
);

-- ì¸ë±ìŠ¤ ì¶”ê°€
CREATE INDEX IF NOT EXISTS idx_partner_proposals_status ON public.partner_proposals(status);
CREATE INDEX IF NOT EXISTS idx_partner_proposals_created_at ON public.partner_proposals(created_at);

-- RLS í™œì„±í™”
ALTER TABLE public.partner_proposals ENABLE ROW LEVEL SECURITY;

-- ì •ì±… ì„¤ì •
CREATE POLICY "Anyone can create partner proposals" 
  ON public.partner_proposals FOR INSERT 
  WITH CHECK (true);

CREATE POLICY "Admins can view all partner proposals" 
  ON public.partner_proposals FOR SELECT 
  USING (
    EXISTS (
      SELECT 1 FROM profiles 
      WHERE id = auth.uid() 
      AND (role = 'admin' OR role = 'master')
    )
  );

CREATE POLICY "Admins can update partner proposals" 
  ON public.partner_proposals FOR UPDATE 
  USING (
    EXISTS (
      SELECT 1 FROM profiles 
      WHERE id = auth.uid() 
      AND (role = 'admin' OR role = 'master')
    )
  );

-- updated_at ìë™ ì—…ë°ì´íŠ¸ íŠ¸ë¦¬ê±°
CREATE OR REPLACE FUNCTION update_partner_proposals_updated_at()
RETURNS TRIGGER AS $$
BEGIN
  NEW.updated_at = NOW();
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER update_partner_proposals_updated_at
  BEFORE UPDATE ON public.partner_proposals
  FOR EACH ROW
  EXECUTE FUNCTION update_partner_proposals_updated_at();

-- ì½”ë©˜íŠ¸ ì¶”ê°€
COMMENT ON TABLE public.partner_proposals IS 'íŒŒíŠ¸ë„ˆìŠ¤ ì œì•ˆ(ì‹ ì²­) í…Œì´ë¸”';
COMMENT ON COLUMN public.partner_proposals.status IS 'ìƒíƒœ: pending(ëŒ€ê¸°), reviewing(ê²€í† ì¤‘), approved(ìŠ¹ì¸), rejected(ê±°ì ˆ)';
</file>

<file path="scripts/050_create_post_images_table.sql">
-- ê²Œì‹œê¸€ ì´ë¯¸ì§€ í…Œì´ë¸” ìƒì„±
-- ê²Œì‹œê¸€ì— ì—¬ëŸ¬ ì´ë¯¸ì§€ë¥¼ ì²¨ë¶€í•  ìˆ˜ ìˆë„ë¡ ì§€ì›

CREATE TABLE IF NOT EXISTS public.post_images (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  post_id UUID NOT NULL REFERENCES posts(id) ON DELETE CASCADE,
  image_url TEXT NOT NULL,
  sort_order INTEGER DEFAULT 0 NOT NULL,
  created_at TIMESTAMPTZ DEFAULT NOW() NOT NULL
);

-- ì¸ë±ìŠ¤ ì¶”ê°€
CREATE INDEX IF NOT EXISTS idx_post_images_post ON public.post_images(post_id);
CREATE INDEX IF NOT EXISTS idx_post_images_sort ON public.post_images(post_id, sort_order);

-- RLS í™œì„±í™”
ALTER TABLE public.post_images ENABLE ROW LEVEL SECURITY;

-- ì •ì±… ì„¤ì •
CREATE POLICY "Post images are viewable by everyone" 
  ON public.post_images FOR SELECT 
  USING (true);

CREATE POLICY "Authenticated users can manage their post images" 
  ON public.post_images FOR ALL 
  USING (
    auth.uid() IN (
      SELECT author_id FROM public.posts 
      WHERE id = post_images.post_id
    )
  );

-- ì½”ë©˜íŠ¸ ì¶”ê°€
COMMENT ON TABLE public.post_images IS 'ê²Œì‹œê¸€ ì²¨ë¶€ ì´ë¯¸ì§€ í…Œì´ë¸”';
COMMENT ON COLUMN public.post_images.sort_order IS 'ì´ë¯¸ì§€ í‘œì‹œ ìˆœì„œ (ì‘ì„ìˆ˜ë¡ ë¨¼ì € í‘œì‹œ)';
</file>

<file path="scripts/050_create_reviews_table.sql">
-- í›„ê¸°(Reviews) ì‹œìŠ¤í…œ í…Œì´ë¸” ìƒì„±
-- ì‹¤í–‰ì¼: 2024-12-06
-- ì„¤ëª…: ê°€ë²¼ìš´ íšŒê³  ì‹œìŠ¤í…œì„ ìœ„í•œ reviews í…Œì´ë¸” ë° RLS ì •ì±… ìƒì„±

-- 1. reviews í…Œì´ë¸” ìƒì„±
CREATE TABLE IF NOT EXISTS public.reviews (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id uuid REFERENCES public.profiles(id) ON DELETE CASCADE NOT NULL,
  event_id uuid REFERENCES public.events(id) ON DELETE CASCADE NOT NULL, -- í•„ìˆ˜ í•„ë“œë¡œ ë³€ê²½
  
  -- í›„ê¸° ë°ì´í„°
  rating numeric(2,1) NOT NULL CHECK (rating >= 0.5 AND rating <= 5.0 AND (rating * 10) % 5 = 0),
  keywords text[] NOT NULL DEFAULT '{}',
  one_liner text NOT NULL CHECK (char_length(one_liner) >= 20 AND char_length(one_liner) <= 100),
  detail_content text,
  images text[] DEFAULT '{}',
  
  -- ë©”íƒ€ ë°ì´í„°
  is_best boolean DEFAULT false NOT NULL,
  is_public boolean DEFAULT true NOT NULL,
  created_at timestamptz DEFAULT now() NOT NULL,
  updated_at timestamptz DEFAULT now() NOT NULL
);

-- 2. ì¸ë±ìŠ¤ ìƒì„± (ì„±ëŠ¥ ìµœì í™”)
CREATE INDEX IF NOT EXISTS idx_reviews_user_id ON public.reviews(user_id);
CREATE INDEX IF NOT EXISTS idx_reviews_event_id ON public.reviews(event_id);
CREATE INDEX IF NOT EXISTS idx_reviews_created_at ON public.reviews(created_at DESC);
CREATE INDEX IF NOT EXISTS idx_reviews_is_public ON public.reviews(is_public);
CREATE INDEX IF NOT EXISTS idx_reviews_is_best ON public.reviews(is_best) WHERE is_best = true;

-- 3. RLS í™œì„±í™”
ALTER TABLE public.reviews ENABLE ROW LEVEL SECURITY;

-- 4. RLS ì •ì±… ìƒì„±

-- ê³µê°œëœ í›„ê¸°ëŠ” ëˆ„êµ¬ë‚˜ ì¡°íšŒ ê°€ëŠ¥
CREATE POLICY "ê³µê°œ í›„ê¸°ëŠ” ëˆ„êµ¬ë‚˜ ì¡°íšŒ ê°€ëŠ¥"
  ON public.reviews FOR SELECT
  USING (is_public = true);

-- ë³¸ì¸ í›„ê¸°ëŠ” ê³µê°œ ì—¬ë¶€ì™€ ê´€ê³„ì—†ì´ ì¡°íšŒ ê°€ëŠ¥
CREATE POLICY "ë³¸ì¸ í›„ê¸°ëŠ” í•­ìƒ ì¡°íšŒ ê°€ëŠ¥"
  ON public.reviews FOR SELECT
  USING (auth.uid() = user_id);

-- ì¸ì¦ëœ ì‚¬ìš©ìëŠ” í›„ê¸° ì‘ì„± ê°€ëŠ¥
CREATE POLICY "ì¸ì¦ëœ ì‚¬ìš©ìëŠ” í›„ê¸° ì‘ì„± ê°€ëŠ¥"
  ON public.reviews FOR INSERT
  WITH CHECK (auth.uid() = user_id);

-- ë³¸ì¸ í›„ê¸°ë§Œ ìˆ˜ì • ê°€ëŠ¥
CREATE POLICY "ë³¸ì¸ í›„ê¸°ë§Œ ìˆ˜ì • ê°€ëŠ¥"
  ON public.reviews FOR UPDATE
  USING (auth.uid() = user_id)
  WITH CHECK (auth.uid() = user_id);

-- ë³¸ì¸ í›„ê¸°ë§Œ ì‚­ì œ ê°€ëŠ¥
CREATE POLICY "ë³¸ì¸ í›„ê¸°ë§Œ ì‚­ì œ ê°€ëŠ¥"
  ON public.reviews FOR DELETE
  USING (auth.uid() = user_id);

-- 5. updated_at ìë™ ì—…ë°ì´íŠ¸ íŠ¸ë¦¬ê±°
CREATE OR REPLACE FUNCTION update_reviews_updated_at()
RETURNS TRIGGER AS $$
BEGIN
  NEW.updated_at = now();
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER reviews_updated_at
  BEFORE UPDATE ON public.reviews
  FOR EACH ROW
  EXECUTE FUNCTION update_reviews_updated_at();

-- 6. ì½”ë©˜íŠ¸ ì¶”ê°€
COMMENT ON TABLE public.reviews IS 'ì´ë²¤íŠ¸ ë° í™œë™ í›„ê¸° í…Œì´ë¸”';
COMMENT ON COLUMN public.reviews.rating IS 'ë³„ì  (0.5 ~ 5.0, ë°˜ê°œ ë‹¨ìœ„)';
COMMENT ON COLUMN public.reviews.keywords IS 'ì„ íƒí•œ í‚¤ì›Œë“œ ë°°ì—´';
COMMENT ON COLUMN public.reviews.one_liner IS 'í•µì‹¬ í•œ ì¤„ í‰ (20-100ì)';
COMMENT ON COLUMN public.reviews.detail_content IS 'ìƒì„¸ í›„ê¸° (ì„ íƒ)';
COMMENT ON COLUMN public.reviews.images IS 'ì´ë¯¸ì§€ URL ë°°ì—´ (ì„ íƒ)';
COMMENT ON COLUMN public.reviews.is_best IS 'ë² ìŠ¤íŠ¸ í›„ê¸° ì—¬ë¶€';
COMMENT ON COLUMN public.reviews.is_public IS 'ê³µê°œ ì—¬ë¶€';
</file>

<file path="scripts/051_add_proof_url_to_user_badges.sql">
-- user_badges í…Œì´ë¸”ì— proof_url ì»¬ëŸ¼ ì¶”ê°€
-- íŒŒì¼ ì—…ë¡œë“œëœ ì¦ë¹™ ìë£Œì˜ URLì„ ì €ì¥

ALTER TABLE public.user_badges
ADD COLUMN IF NOT EXISTS proof_url TEXT;

-- ì½”ë©˜íŠ¸ ì¶”ê°€
COMMENT ON COLUMN public.user_badges.proof_url IS 'ì¦ë¹™ ìë£Œ íŒŒì¼ URL (Supabase Storage)';
</file>

<file path="scripts/052_add_thumbnail_url_to_partner_proposals.sql">
-- partner_proposals í…Œì´ë¸”ì— thumbnail_url ì»¬ëŸ¼ ì¶”ê°€
-- ì›¹ì‚¬ì´íŠ¸ URLì—ì„œ ìë™ìœ¼ë¡œ ì¶”ì¶œí•œ ì¸ë„¤ì¼ ì´ë¯¸ì§€ URLì„ ì €ì¥

ALTER TABLE public.partner_proposals
ADD COLUMN IF NOT EXISTS thumbnail_url TEXT;

-- ì½”ë©˜íŠ¸ ì¶”ê°€
COMMENT ON COLUMN public.partner_proposals.thumbnail_url IS 'ì›¹ì‚¬ì´íŠ¸ ì¸ë„¤ì¼ ì´ë¯¸ì§€ URL (og:image ë©”íƒ€ íƒœê·¸ì—ì„œ ì¶”ì¶œ)';
</file>

<file path="scripts/053_fix_profile_columns_and_reload.sql">
-- í”„ë¡œí•„ í…Œì´ë¸” ì»¬ëŸ¼ í™•ì¸ ë° ì¶”ê°€ (ì•ˆì „í•˜ê²Œ)
-- Schema Cache Reload

DO $$ 
BEGIN
  -- linkedin_url
  IF NOT EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name = 'profiles' AND column_name = 'linkedin_url') THEN
    ALTER TABLE public.profiles ADD COLUMN linkedin_url TEXT;
  END IF;

  -- instagram_url
  IF NOT EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name = 'profiles' AND column_name = 'instagram_url') THEN
    ALTER TABLE public.profiles ADD COLUMN instagram_url TEXT;
  END IF;

  -- threads_url
  IF NOT EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name = 'profiles' AND column_name = 'threads_url') THEN
    ALTER TABLE public.profiles ADD COLUMN threads_url TEXT;
  END IF;

  -- website_url
  IF NOT EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name = 'profiles' AND column_name = 'website_url') THEN
    ALTER TABLE public.profiles ADD COLUMN website_url TEXT;
  END IF;
END $$;

-- PostgREST ìŠ¤í‚¤ë§ˆ ìºì‹œ ë¦¬ë¡œë“œ ì•Œë¦¼
NOTIFY pgrst, 'reload schema';
</file>

<file path="scripts/054_allow_admin_delete.sql">
-- ê´€ë¦¬ì(admin)ë„ ê²Œì‹œê¸€ì„ ì‚­ì œí•  ìˆ˜ ìˆë„ë¡ RLS ì •ì±… ì—…ë°ì´íŠ¸
-- ê¸°ì¡´ì—ëŠ” ì‘ì„±ì(author)ì™€ ë§ˆìŠ¤í„°(master)ë§Œ ì‚­ì œ ê°€ëŠ¥í–ˆìŒ

-- ê¸°ì¡´ ì‚­ì œ ì •ì±… ì œê±°
DROP POLICY IF EXISTS "Master admins can delete any posts" ON public.posts;

-- ìƒˆë¡œìš´ ì‚­ì œ ì •ì±… ìƒì„± (ë§ˆìŠ¤í„° ë° ê´€ë¦¬ì í—ˆìš©)
CREATE POLICY "Admins can delete any posts"
ON public.posts
FOR DELETE
USING (
  EXISTS (
    SELECT 1 FROM public.profiles
    WHERE profiles.id = auth.uid()
    AND profiles.role IN ('master', 'admin')
  )
);
</file>

<file path="scripts/055_fix_delete_permissions_and_fkeys.sql">
-- ì‚­ì œ ì •ì±…ì„ ê°€ì¥ ê°•ë ¥í•˜ê³  ë‹¨ìˆœí•œ í˜•íƒœë¡œ ì¬ì„¤ì •
-- ê¸°ì¡´ ì‚­ì œ ê´€ë ¨ ì •ì±… ëª¨ë‘ ì œê±°
DROP POLICY IF EXISTS "Users can delete their own posts" ON public.posts;
DROP POLICY IF EXISTS "Master admins can delete any posts" ON public.posts;
DROP POLICY IF EXISTS "Admins can delete any posts" ON public.posts;

-- ìƒˆë¡œìš´ í†µí•© ì‚­ì œ ì •ì±…
-- 1. ë³¸ì¸ ê¸€ ì‚­ì œ ê°€ëŠ¥
-- 2. admin ë˜ëŠ” master ê¶Œí•œì´ ìˆëŠ” ê²½ìš° ëª¨ë“  ê¸€ ì‚­ì œ ê°€ëŠ¥
CREATE POLICY "Users and admins can delete posts"
ON public.posts
FOR DELETE
USING (
  auth.uid() = author_id OR
  EXISTS (
    SELECT 1 FROM public.profiles
    WHERE profiles.id = auth.uid()
    AND profiles.role IN ('admin', 'master')
  )
);

-- ì™¸ë˜í‚¤ ì œì•½ ì¡°ê±´ í™•ì¸ ë° ìˆ˜ì • (ëŒ“ê¸€, ì¢‹ì•„ìš” ë“±ì´ ìˆì„ ë•Œ ì‚­ì œê°€ ë§‰íˆì§€ ì•Šë„ë¡)
-- ê¸°ì¡´ ì œì•½ ì¡°ê±´ ì‚­ì œ í›„ CASCADE ì˜µì…˜ìœ¼ë¡œ ë‹¤ì‹œ ì¶”ê°€
ALTER TABLE public.comments
DROP CONSTRAINT IF EXISTS comments_post_id_fkey,
ADD CONSTRAINT comments_post_id_fkey
  FOREIGN KEY (post_id)
  REFERENCES public.posts(id)
  ON DELETE CASCADE;

ALTER TABLE public.post_likes
DROP CONSTRAINT IF EXISTS post_likes_post_id_fkey,
ADD CONSTRAINT post_likes_post_id_fkey
  FOREIGN KEY (post_id)
  REFERENCES public.posts(id)
  ON DELETE CASCADE;

-- ì•Œë¦¼ í…Œì´ë¸”ì´ë‚˜ ë‹¤ë¥¸ í…Œì´ë¸”ì´ ìˆë‹¤ë©´ ì—¬ê¸°ì„œ ì²˜ë¦¬í•´ì•¼ í•¨ (í˜„ì¬ëŠ” ìŠ¤í‚¤ë§ˆ íŒŒì¼ìƒ ì—†ìŒ)
-- ë§Œì•½ post_images ê°™ì€ ì¶”ê°€ í…Œì´ë¸”ì´ ìˆë‹¤ë©´ ì—¬ê¸°ì„œ ì²˜ë¦¬
</file>

<file path="scripts/056_fix_profile_visibility_schema.sql">
-- í”„ë¡œí•„ ê³µê°œ ì„¤ì • ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•œ ìŠ¤í‚¤ë§ˆ ë³µêµ¬ ìŠ¤í¬ë¦½íŠ¸
-- is_profile_public ì»¬ëŸ¼ì´ í™•ì‹¤íˆ ì¡´ì¬í•˜ê³ , ìºì‹œê°€ ê°±ì‹ ë˜ë„ë¡ í•¨

DO $$ 
BEGIN
  -- is_profile_public
  IF NOT EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name = 'profiles' AND column_name = 'is_profile_public') THEN
    ALTER TABLE public.profiles ADD COLUMN is_profile_public boolean DEFAULT false NOT NULL;
  END IF;

  -- company
  IF NOT EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name = 'profiles' AND column_name = 'company') THEN
    ALTER TABLE public.profiles ADD COLUMN company text;
  END IF;

  -- position
  IF NOT EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name = 'profiles' AND column_name = 'position') THEN
    ALTER TABLE public.profiles ADD COLUMN position text;
  END IF;

  -- introduction
  IF NOT EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name = 'profiles' AND column_name = 'introduction') THEN
    ALTER TABLE public.profiles ADD COLUMN introduction text;
  END IF;

  -- roles
  IF NOT EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name = 'profiles' AND column_name = 'roles') THEN
    ALTER TABLE public.profiles ADD COLUMN roles text[] DEFAULT '{}';
  END IF;
END $$;

-- ì¸ë±ìŠ¤ ì¬ìƒì„± (ì¡´ì¬í•˜ì§€ ì•Šì„ ê²½ìš°)
CREATE INDEX IF NOT EXISTS idx_profiles_is_profile_public ON public.profiles(is_profile_public) WHERE is_profile_public = true;

-- PostgREST ìŠ¤í‚¤ë§ˆ ìºì‹œ ë¦¬ë¡œë“œ ì•Œë¦¼
NOTIFY pgrst, 'reload schema';
</file>

<file path="scripts/057_fix_badge_visibility_policy.sql">
-- user_badges í…Œì´ë¸”ì˜ ì¡°íšŒ ê¶Œí•œ(RLS) ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸
-- ê³µê°œ í”„ë¡œí•„ì„ ê°€ì§„ ì‚¬ìš©ìì˜ ê³µê°œ ë±ƒì§€ëŠ” ë¡œê·¸ì¸ ì—¬ë¶€ì™€ ìƒê´€ì—†ì´ ëˆ„êµ¬ë‚˜ ë³¼ ìˆ˜ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.

BEGIN;

-- 1. user_badges í…Œì´ë¸” RLS í™œì„±í™” í™•ì¸
ALTER TABLE public.user_badges ENABLE ROW LEVEL SECURITY;

-- 2. ê¸°ì¡´ ì •ì±… ì •ë¦¬ (ì¶©ëŒ ë°©ì§€)
DROP POLICY IF EXISTS "Public badges are viewable by everyone" ON public.user_badges;
DROP POLICY IF EXISTS "Users can view own badges" ON public.user_badges;

-- 3. ìƒˆ ì •ì±…: ê³µê°œ ë±ƒì§€ ì¡°íšŒ í—ˆìš©
-- ì¡°ê±´: ë±ƒì§€ê°€ ê³µê°œ(is_visible=true) ìƒíƒœì´ê³ , ë±ƒì§€ ì†Œìœ ìì˜ í”„ë¡œí•„ë„ ê³µê°œ(is_profile_public=true) ìƒíƒœì¼ ë•Œ
CREATE POLICY "Public badges are viewable by everyone"
ON public.user_badges FOR SELECT
USING (
  is_visible = true 
  AND 
  EXISTS (
    SELECT 1 FROM profiles
    WHERE profiles.id = user_badges.user_id
    AND profiles.is_profile_public = true
  )
);

-- 4. ìƒˆ ì •ì±…: ë³¸ì¸ ë±ƒì§€ ì¡°íšŒ í—ˆìš© (ë³¸ì¸ì€ ë¹„ê³µê°œ ë±ƒì§€ë„ ë³¼ ìˆ˜ ìˆì–´ì•¼ í•¨)
CREATE POLICY "Users can view own badges"
ON public.user_badges FOR SELECT
USING (
  auth.uid() = user_id
);

-- 5. ìŠ¤í‚¤ë§ˆ ìºì‹œ ë¦¬ë¡œë“œ
NOTIFY pgrst, 'reload schema';

COMMIT;
</file>

<file path="scripts/058_fix_missing_social_columns.sql">
DO $$ 
BEGIN
  -- linkedin_url
  IF NOT EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name = 'profiles' AND column_name = 'linkedin_url') THEN
    ALTER TABLE public.profiles ADD COLUMN linkedin_url text;
  END IF;

  -- instagram_url
  IF NOT EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name = 'profiles' AND column_name = 'instagram_url') THEN
    ALTER TABLE public.profiles ADD COLUMN instagram_url text;
  END IF;

  -- threads_url
  IF NOT EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name = 'profiles' AND column_name = 'threads_url') THEN
    ALTER TABLE public.profiles ADD COLUMN threads_url text;
  END IF;

  -- website_url
  IF NOT EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name = 'profiles' AND column_name = 'website_url') THEN
    ALTER TABLE public.profiles ADD COLUMN website_url text;
  END IF;
END $$;

-- ìŠ¤í‚¤ë§ˆ ìºì‹œ ë¦¬ë¡œë“œ ì•Œë¦¼ (ì¤‘ìš”)
NOTIFY pgrst, 'reload schema';
</file>

<file path="scripts/059_fix_badge_evidence_column.sql">
DO $$ 
BEGIN
  -- status ì»¬ëŸ¼ ì¶”ê°€
  IF NOT EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name = 'user_badges' AND column_name = 'status') THEN
    ALTER TABLE public.user_badges ADD COLUMN status TEXT DEFAULT 'pending' CHECK (status IN ('pending', 'approved', 'rejected'));
  END IF;

  -- evidence ì»¬ëŸ¼ ì¶”ê°€
  IF NOT EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name = 'user_badges' AND column_name = 'evidence') THEN
    ALTER TABLE public.user_badges ADD COLUMN evidence TEXT;
  END IF;

  -- proof_url ì»¬ëŸ¼ ì¶”ê°€
  IF NOT EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name = 'user_badges' AND column_name = 'proof_url') THEN
    ALTER TABLE public.user_badges ADD COLUMN proof_url TEXT;
  END IF;
END $$;

-- ê¸°ì¡´ ë°ì´í„° ì²˜ë¦¬: statusê°€ ì—†ëŠ” ê²½ìš° 'approved'ë¡œ ì„¤ì • (ê¸°ì¡´ ë±ƒì§€ëŠ” ëª¨ë‘ ìŠ¹ì¸ëœ ê²ƒìœ¼ë¡œ ê°„ì£¼)
UPDATE public.user_badges 
SET status = 'approved' 
WHERE status IS NULL;

-- ìŠ¤í‚¤ë§ˆ ìºì‹œ ë¦¬ë¡œë“œ ì•Œë¦¼
NOTIFY pgrst, 'reload schema';
</file>

<file path="scripts/060_add_second_affiliation.sql">
DO $$ 
BEGIN
  -- company_2
  IF NOT EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name = 'profiles' AND column_name = 'company_2') THEN
    ALTER TABLE public.profiles ADD COLUMN company_2 text;
  END IF;

  -- position_2
  IF NOT EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name = 'profiles' AND column_name = 'position_2') THEN
    ALTER TABLE public.profiles ADD COLUMN position_2 text;
  END IF;
END $$;

-- ìŠ¤í‚¤ë§ˆ ìºì‹œ ë¦¬ë¡œë“œ ì•Œë¦¼
NOTIFY pgrst, 'reload schema';
</file>

<file path="scripts/060_auto_grant_community_leader_badge.sql">
-- ë°˜ê³¨ê³¼ í•˜ì´í† í¬ ì»¤ë®¤ë‹ˆí‹° ë¦¬ë”ì—ê²Œ ìë™ìœ¼ë¡œ ì»¤ë®¤ë‹ˆí‹° ë¦¬ë” ë±ƒì§€ ë°œê¸‰
-- community_members í…Œì´ë¸”ì˜ roleì´ 'owner' ë˜ëŠ” 'admin'ìœ¼ë¡œ ë³€ê²½ë  ë•Œ ìë™ìœ¼ë¡œ ë±ƒì§€ ë°œê¸‰

-- 1. ì»¤ë®¤ë‹ˆí‹° ë¦¬ë” ë±ƒì§€ ID ì°¾ê¸° (ë˜ëŠ” ìƒì„±)
DO $$
DECLARE
  community_leader_badge_id uuid;
  vangol_community_id uuid;
  hightalk_community_id uuid;
BEGIN
  -- ì»¤ë®¤ë‹ˆí‹° ë¦¬ë” ë±ƒì§€ ID ì°¾ê¸°
  SELECT id INTO community_leader_badge_id
  FROM badges
  WHERE name = 'ì»¤ë®¤ë‹ˆí‹° ë¦¬ë”'
  LIMIT 1;

  -- ë±ƒì§€ê°€ ì—†ìœ¼ë©´ ìƒì„±
  IF community_leader_badge_id IS NULL THEN
    INSERT INTO badges (name, icon, category, description)
    VALUES ('ì»¤ë®¤ë‹ˆí‹° ë¦¬ë”', 'ğŸ›¡ï¸', 'community', 'SFC ì»¤ë®¤ë‹ˆí‹° ìš´ì˜ì§„ ë° ë¦¬ë”')
    RETURNING id INTO community_leader_badge_id;
  END IF;

  -- ë°˜ê³¨ ì»¤ë®¤ë‹ˆí‹° ID ì°¾ê¸°
  SELECT id INTO vangol_community_id
  FROM communities
  WHERE name = 'ë°˜ê³¨' OR slug = 'vangol'
  LIMIT 1;

  -- í•˜ì´í† í¬ ì»¤ë®¤ë‹ˆí‹° ID ì°¾ê¸°
  SELECT id INTO hightalk_community_id
  FROM communities
  WHERE name = 'í•˜ì´í† í¬' OR slug = 'hightalk'
  LIMIT 1;

  -- ë°˜ê³¨ê³¼ í•˜ì´í† í¬ì˜ ë¦¬ë”ë“¤ì—ê²Œ ë±ƒì§€ ìë™ ë°œê¸‰
  IF vangol_community_id IS NOT NULL THEN
    INSERT INTO user_badges (user_id, badge_id, status, is_visible)
    SELECT DISTINCT cm.user_id, community_leader_badge_id, 'approved', true
    FROM community_members cm
    WHERE cm.community_id = vangol_community_id
      AND cm.role IN ('owner', 'admin')
      AND NOT EXISTS (
        SELECT 1 FROM user_badges ub
        WHERE ub.user_id = cm.user_id
          AND ub.badge_id = community_leader_badge_id
      )
    ON CONFLICT DO NOTHING;
  END IF;

  IF hightalk_community_id IS NOT NULL THEN
    INSERT INTO user_badges (user_id, badge_id, status, is_visible)
    SELECT DISTINCT cm.user_id, community_leader_badge_id, 'approved', true
    FROM community_members cm
    WHERE cm.community_id = hightalk_community_id
      AND cm.role IN ('owner', 'admin')
      AND NOT EXISTS (
        SELECT 1 FROM user_badges ub
        WHERE ub.user_id = cm.user_id
          AND ub.badge_id = community_leader_badge_id
      )
    ON CONFLICT DO NOTHING;
  END IF;

  RAISE NOTICE 'ì»¤ë®¤ë‹ˆí‹° ë¦¬ë” ë±ƒì§€ ìë™ ë°œê¸‰ ì™„ë£Œ';
END $$;

-- 2. community_members í…Œì´ë¸” ì—…ë°ì´íŠ¸ ì‹œ ìë™ìœ¼ë¡œ ë±ƒì§€ ë°œê¸‰í•˜ëŠ” íŠ¸ë¦¬ê±° í•¨ìˆ˜ ìƒì„±
CREATE OR REPLACE FUNCTION auto_grant_community_leader_badge()
RETURNS TRIGGER AS $$
DECLARE
  community_leader_badge_id uuid;
  community_name text;
BEGIN
  -- ì»¤ë®¤ë‹ˆí‹° ë¦¬ë” ë±ƒì§€ ID ì°¾ê¸°
  SELECT id INTO community_leader_badge_id
  FROM badges
  WHERE name = 'ì»¤ë®¤ë‹ˆí‹° ë¦¬ë”'
  LIMIT 1;

  -- ë±ƒì§€ê°€ ì—†ìœ¼ë©´ ì¢…ë£Œ
  IF community_leader_badge_id IS NULL THEN
    RETURN NEW;
  END IF;

  -- ì»¤ë®¤ë‹ˆí‹° ì´ë¦„ í™•ì¸ (ë°˜ê³¨ ë˜ëŠ” í•˜ì´í† í¬ë§Œ)
  SELECT c.name INTO community_name
  FROM communities c
  WHERE c.id = NEW.community_id;

  -- ë°˜ê³¨ ë˜ëŠ” í•˜ì´í† í¬ê°€ ì•„ë‹ˆë©´ ì¢…ë£Œ
  IF community_name NOT IN ('ë°˜ê³¨', 'í•˜ì´í† í¬') THEN
    RETURN NEW;
  END IF;

  -- roleì´ 'owner' ë˜ëŠ” 'admin'ì´ê³ , ê¸°ì¡´ì— ë±ƒì§€ê°€ ì—†ìœ¼ë©´ ë°œê¸‰
  IF NEW.role IN ('owner', 'admin') THEN
    INSERT INTO user_badges (user_id, badge_id, status, is_visible)
    VALUES (NEW.user_id, community_leader_badge_id, 'approved', true)
    ON CONFLICT DO NOTHING;
  END IF;

  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- 3. íŠ¸ë¦¬ê±° ìƒì„± (INSERT ì‹œ)
DROP TRIGGER IF EXISTS trigger_auto_grant_community_leader_badge_insert ON community_members;
CREATE TRIGGER trigger_auto_grant_community_leader_badge_insert
  AFTER INSERT ON community_members
  FOR EACH ROW
  WHEN (NEW.role IN ('owner', 'admin'))
  EXECUTE FUNCTION auto_grant_community_leader_badge();

-- 4. íŠ¸ë¦¬ê±° ìƒì„± (UPDATE ì‹œ)
DROP TRIGGER IF EXISTS trigger_auto_grant_community_leader_badge_update ON community_members;
CREATE TRIGGER trigger_auto_grant_community_leader_badge_update
  AFTER UPDATE ON community_members
  FOR EACH ROW
  WHEN (NEW.role IN ('owner', 'admin') AND (OLD.role IS NULL OR OLD.role NOT IN ('owner', 'admin')))
  EXECUTE FUNCTION auto_grant_community_leader_badge();
</file>

<file path="scripts/061_fix_new_year_event_date.sql">
-- ì‹ ë…„ë§ì´ ì¸ì™•ì‚° ë“±ì‚° ì´ë²¤íŠ¸ì˜ event_dateë¥¼ 1ì›” 1ì¼ë¡œ ìˆ˜ì •
-- í˜„ì¬ event_dateê°€ 2025-12-31T23:00:00.000Zë¡œ ë˜ì–´ ìˆì–´ì„œ 1ì›” 1ì¼ë¡œ ì¸ì‹ë˜ì§€ ì•ŠëŠ” ë¬¸ì œ í•´ê²°

UPDATE events
SET event_date = '2026-01-01T08:00:00.000Z'::timestamptz
WHERE title LIKE '%ì‹ ë…„ë§ì´ ì¸ì™•ì‚° ë“±ì‚°%'
  AND event_date::date = '2025-12-31'::date;

-- í™•ì¸ ì¿¼ë¦¬
SELECT 
  id,
  title,
  event_date,
  event_date::date as event_date_only,
  EXTRACT(MONTH FROM event_date) as month,
  EXTRACT(DAY FROM event_date) as day
FROM events
WHERE title LIKE '%ì‹ ë…„ë§ì´ ì¸ì™•ì‚° ë“±ì‚°%';
</file>

<file path="scripts/061_fix_post_delete_and_rls.sql">
-- ì‚­ì œ ì •ì±…ì„ ê°€ì¥ ê°•ë ¥í•˜ê³  ë‹¨ìˆœí•œ í˜•íƒœë¡œ ì¬ì„¤ì •
-- ê¸°ì¡´ ì‚­ì œ ê´€ë ¨ ì •ì±… ëª¨ë‘ ì œê±°
DROP POLICY IF EXISTS "Users can delete their own posts" ON public.posts;
DROP POLICY IF EXISTS "Master admins can delete any posts" ON public.posts;
DROP POLICY IF EXISTS "Admins can delete any posts" ON public.posts;

-- ìƒˆë¡œìš´ í†µí•© ì‚­ì œ ì •ì±…
-- 1. ë³¸ì¸ ê¸€ ì‚­ì œ ê°€ëŠ¥
-- 2. admin ë˜ëŠ” master ê¶Œí•œì´ ìˆëŠ” ê²½ìš° ëª¨ë“  ê¸€ ì‚­ì œ ê°€ëŠ¥
CREATE POLICY "Users and admins can delete posts"
ON public.posts
FOR DELETE
USING (
  auth.uid() = author_id OR
  EXISTS (
    SELECT 1 FROM public.profiles
    WHERE profiles.id = auth.uid()
    AND profiles.role IN ('admin', 'master')
  )
);

-- ì™¸ë˜í‚¤ ì œì•½ ì¡°ê±´ í™•ì¸ ë° ìˆ˜ì • (ëŒ“ê¸€, ì¢‹ì•„ìš” ë“±ì´ ìˆì„ ë•Œ ì‚­ì œê°€ ë§‰íˆì§€ ì•Šë„ë¡)
-- ê¸°ì¡´ ì œì•½ ì¡°ê±´ ì‚­ì œ í›„ CASCADE ì˜µì…˜ìœ¼ë¡œ ë‹¤ì‹œ ì¶”ê°€
ALTER TABLE public.comments
DROP CONSTRAINT IF EXISTS comments_post_id_fkey,
ADD CONSTRAINT comments_post_id_fkey
  FOREIGN KEY (post_id)
  REFERENCES public.posts(id)
  ON DELETE CASCADE;

ALTER TABLE public.post_likes
DROP CONSTRAINT IF EXISTS post_likes_post_id_fkey,
ADD CONSTRAINT post_likes_post_id_fkey
  FOREIGN KEY (post_id)
  REFERENCES public.posts(id)
  ON DELETE CASCADE;

-- ìŠ¤í‚¤ë§ˆ ìºì‹œ ë¦¬ë¡œë“œ ì•Œë¦¼
NOTIFY pgrst, 'reload schema';
</file>

<file path="scripts/062_fix_community_update_policy.sql">
-- ì»¤ë®¤ë‹ˆí‹° ì—…ë°ì´íŠ¸ ì •ì±… ìˆ˜ì • ë° ê¶Œí•œ ê°•í™”
-- ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” ì»¤ë®¤ë‹ˆí‹° ê°€ì´ë“œë¼ì¸(ì„¤ëª…) ìˆ˜ì •ì´ ì‹¤íŒ¨í•˜ëŠ” ë¬¸ì œë¥¼ í•´ê²°í•©ë‹ˆë‹¤.

BEGIN;

-- 1. ê¸°ì¡´ ì—…ë°ì´íŠ¸ ì •ì±… ì‚­ì œ
DROP POLICY IF EXISTS "Community owners and admins can update" ON public.communities;

-- 2. ë” í¬ê´„ì ì´ê³  í™•ì‹¤í•œ ì—…ë°ì´íŠ¸ ì •ì±… ìƒì„±
-- ì†Œìœ ì(created_by), ì»¤ë®¤ë‹ˆí‹° ë©¤ë²„(owner/admin ì—­í• ), ë˜ëŠ” ì „ì²´ ì‹œìŠ¤í…œ ê´€ë¦¬ì(admin/master)ê°€ ìˆ˜ì • ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •
CREATE POLICY "Community update policy"
  ON public.communities
  FOR UPDATE
  USING (
    -- 1. ì»¤ë®¤ë‹ˆí‹° ìƒì„±ì(ì†Œìœ ì)ì¸ ê²½ìš°
    created_by = auth.uid() 
    OR
    -- 2. ì»¤ë®¤ë‹ˆí‹° ë©¤ë²„ ì¤‘ owner ë˜ëŠ” admin ì—­í• ì„ ê°€ì§„ ê²½ìš°
    EXISTS (
      SELECT 1 FROM public.community_members
      WHERE community_members.community_id = communities.id
      AND community_members.user_id = auth.uid()
      AND community_members.role IN ('owner', 'admin')
    )
    OR
    -- 3. ì‹œìŠ¤í…œ ê´€ë¦¬ìì¸ ê²½ìš° (profiles í…Œì´ë¸”ì˜ role í™•ì¸)
    EXISTS (
      SELECT 1 FROM public.profiles
      WHERE profiles.id = auth.uid()
      AND profiles.role IN ('admin', 'master')
    )
  );

-- 3. ì •ì±… ë³€ê²½ ì‚¬í•­ ì ìš©ì„ ìœ„í•´ ìŠ¤í‚¤ë§ˆ ìºì‹œ ë¦¬ë¡œë“œ ì•Œë¦¼
NOTIFY pgrst, 'reload schema';

COMMIT;
</file>

<file path="scripts/062_sync_community_leader_badge.sql">
-- ëª¨ë“  ì»¤ë®¤ë‹ˆí‹° ë¦¬ë”(community_members.role = 'owner' ë˜ëŠ” 'admin')ì—ê²Œ
-- 'ì»¤ë®¤ë‹ˆí‹° ë¦¬ë”' ë±ƒì§€ë¥¼ ìë™ìœ¼ë¡œ ë¶€ì—¬/íšŒìˆ˜í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸
-- - ë¦¬ë”ê°€ ë˜ë©´ ë±ƒì§€ ìë™ ë¶€ì—¬ (approved + visible)
-- - ëª¨ë“  ì»¤ë®¤ë‹ˆí‹°ì—ì„œ ë¦¬ë” ê¶Œí•œì´ ì‚¬ë¼ì§€ë©´ ë±ƒì§€ ìë™ ì‚­ì œ

DO $$
DECLARE
  community_leader_badge_id uuid;
BEGIN
  -- 1) ì»¤ë®¤ë‹ˆí‹° ë¦¬ë” ë±ƒì§€ ID ì¡°íšŒ (ì—†ìœ¼ë©´ ìƒì„±)
  SELECT id INTO community_leader_badge_id
  FROM badges
  WHERE name = 'ì»¤ë®¤ë‹ˆí‹° ë¦¬ë”'
  LIMIT 1;

  IF community_leader_badge_id IS NULL THEN
    INSERT INTO badges (name, icon, category, description)
    VALUES ('ì»¤ë®¤ë‹ˆí‹° ë¦¬ë”', 'ğŸ›¡ï¸', 'community', 'SFC ì»¤ë®¤ë‹ˆí‹° ìš´ì˜ì§„ ë° ë¦¬ë”')
    RETURNING id INTO community_leader_badge_id;
  END IF;

  -- 2) í˜„ì¬ ë¦¬ë”( owner / admin )ì¸ ëª¨ë“  ë©¤ë²„ì—ê²Œ ë±ƒì§€ ë¶€ì—¬
  INSERT INTO user_badges (user_id, badge_id, status, is_visible)
  SELECT DISTINCT cm.user_id, community_leader_badge_id, 'approved', true
  FROM community_members cm
  WHERE cm.role IN ('owner', 'admin')
    AND NOT EXISTS (
      SELECT 1 FROM user_badges ub
      WHERE ub.user_id = cm.user_id
        AND ub.badge_id = community_leader_badge_id
    );

  -- 3) ë” ì´ìƒ ì–´ë–¤ ì»¤ë®¤ë‹ˆí‹°ì—ì„œë„ ë¦¬ë”ê°€ ì•„ë‹Œ ì‚¬ìš©ìì—ê²Œì„œ ë±ƒì§€ ì œê±°
  DELETE FROM user_badges ub
  USING badges b
  WHERE ub.badge_id = b.id
    AND b.name = 'ì»¤ë®¤ë‹ˆí‹° ë¦¬ë”'
    AND NOT EXISTS (
      SELECT 1
      FROM community_members cm
      WHERE cm.user_id = ub.user_id
        AND cm.role IN ('owner', 'admin')
    );
END $$;

-- 4) íŠ¸ë¦¬ê±° í•¨ìˆ˜: community_members ë³€ê²½ ì‹œ ë±ƒì§€ ë™ê¸°í™”
CREATE OR REPLACE FUNCTION sync_community_leader_badge()
RETURNS TRIGGER AS $$
DECLARE
  community_leader_badge_id uuid;
  target_user_id uuid;
  leader_count integer;
BEGIN
  -- ë±ƒì§€ ID ì¡°íšŒ
  SELECT id INTO community_leader_badge_id
  FROM badges
  WHERE name = 'ì»¤ë®¤ë‹ˆí‹° ë¦¬ë”'
  LIMIT 1;

  IF community_leader_badge_id IS NULL THEN
    RETURN COALESCE(NEW, OLD);
  END IF;

  -- ëŒ€ìƒ user_id ê²°ì • (INSERT/UPDATE ì‹œ NEW, DELETE ì‹œ OLD)
  IF TG_OP = 'DELETE' THEN
    target_user_id := OLD.user_id;
  ELSE
    target_user_id := NEW.user_id;
  END IF;

  -- 4-1) INSERT: ìƒˆë¡œ ë¦¬ë”ê°€ ëœ ê²½ìš° ë±ƒì§€ ë¶€ì—¬
  IF TG_OP = 'INSERT' THEN
    IF NEW.role IN ('owner', 'admin') THEN
      INSERT INTO user_badges (user_id, badge_id, status, is_visible)
      VALUES (NEW.user_id, community_leader_badge_id, 'approved', true)
      ON CONFLICT (user_id, badge_id) DO NOTHING;
    END IF;

  -- 4-2) UPDATE: role ë³€ê²½ì— ë”°ë¥¸ ì¶”ê°€/ì‚­ì œ ì²˜ë¦¬
  ELSIF TG_OP = 'UPDATE' THEN
    -- ì¼ë°˜ ë©¤ë²„ -> ë¦¬ë” ë¡œ ë³€ê²½
    IF NEW.role IN ('owner', 'admin') AND (OLD.role IS NULL OR OLD.role NOT IN ('owner', 'admin')) THEN
      INSERT INTO user_badges (user_id, badge_id, status, is_visible)
      VALUES (NEW.user_id, community_leader_badge_id, 'approved', true)
      ON CONFLICT (user_id, badge_id) DO NOTHING;
    END IF;

    -- ë¦¬ë” -> ì¼ë°˜ ë©¤ë²„ ë¡œ ë³€ê²½ëœ ê²½ìš°, ë‹¤ë¥¸ ì»¤ë®¤ë‹ˆí‹°ì—ì„œ ì—¬ì „íˆ ë¦¬ë”ì¸ì§€ í™•ì¸ í›„ í•„ìš” ì‹œ ì œê±°
    IF OLD.role IN ('owner', 'admin') AND NEW.role NOT IN ('owner', 'admin') THEN
      SELECT COUNT(*) INTO leader_count
      FROM community_members
      WHERE user_id = NEW.user_id
        AND role IN ('owner', 'admin');

      IF leader_count = 0 THEN
        DELETE FROM user_badges
        WHERE user_id = NEW.user_id
          AND badge_id = community_leader_badge_id;
      END IF;
    END IF;

  -- 4-3) DELETE: ì»¤ë®¤ë‹ˆí‹°ì—ì„œ íƒˆí‡´/ì œê±°ëœ ê²½ìš°
  ELSIF TG_OP = 'DELETE' THEN
    IF OLD.role IN ('owner', 'admin') THEN
      SELECT COUNT(*) INTO leader_count
      FROM community_members
      WHERE user_id = OLD.user_id
        AND role IN ('owner', 'admin');

      IF leader_count = 0 THEN
        DELETE FROM user_badges
        WHERE user_id = OLD.user_id
          AND badge_id = community_leader_badge_id;
      END IF;
    END IF;
  END IF;

  RETURN COALESCE(NEW, OLD);
END;
$$ LANGUAGE plpgsql;

-- 5) ê¸°ì¡´ íŠ¸ë¦¬ê±° ì œê±° ë° ìƒˆ íŠ¸ë¦¬ê±° ìƒì„±
DROP TRIGGER IF EXISTS trigger_auto_grant_community_leader_badge_insert ON community_members;
DROP TRIGGER IF EXISTS trigger_auto_grant_community_leader_badge_update ON community_members;
DROP TRIGGER IF EXISTS trigger_sync_community_leader_badge ON community_members;

CREATE TRIGGER trigger_sync_community_leader_badge
  AFTER INSERT OR UPDATE OR DELETE ON community_members
  FOR EACH ROW
  EXECUTE FUNCTION sync_community_leader_badge();
</file>

<file path="scripts/063_add_badge_rejection_reason.sql">
-- user_badges í…Œì´ë¸”ì— rejection_reason ì»¬ëŸ¼ ì¶”ê°€
-- ë±ƒì§€ ì‹ ì²­ ë°˜ë ¤ ì‹œ ì‚¬ìœ ë¥¼ ì €ì¥

ALTER TABLE user_badges
ADD COLUMN IF NOT EXISTS rejection_reason TEXT;

-- ì¸ë±ìŠ¤ ì¶”ê°€ (optional, rejection_reasonìœ¼ë¡œ ì¡°íšŒí•  ì¼ì€ ì ì§€ë§Œ ì¼ê´€ì„± ìœ ì§€)
COMMENT ON COLUMN user_badges.rejection_reason IS 'ë±ƒì§€ ì‹ ì²­ ë°˜ë ¤ ì‚¬ìœ ';
</file>

<file path="scripts/063_add_profile_tagline.sql">
-- í”„ë¡œí•„ì— 'ë‚˜ë¥¼ í‘œí˜„í•˜ëŠ” í•œë§ˆë””' ì»¬ëŸ¼ ì¶”ê°€
-- ê¸°ì¡´ introductionì€ ê¸´ ìê¸°ì†Œê°œ, taglineì€ ì§§ì€ í•œë§ˆë”” ìš©ë„

ALTER TABLE public.profiles
ADD COLUMN IF NOT EXISTS tagline text;

COMMENT ON COLUMN public.profiles.tagline IS 'ë‚˜ë¥¼ í‘œí˜„í•˜ëŠ” í•œë§ˆë”” (ì§§ì€ ì†Œê°œ ë¬¸êµ¬)';
</file>

<file path="scripts/064_add_member_type.sql">
-- ë©¤ë²„ íƒ€ì… ì»¬ëŸ¼ ì¶”ê°€ (ì‚¬ì—…ê°€, íˆ¬ìì, í¬ë¦¬ì—ì´í„°)
-- profiles í…Œì´ë¸”ì— member_type ì»¬ëŸ¼ ì¶”ê°€

ALTER TABLE public.profiles 
ADD COLUMN IF NOT EXISTS member_type text CHECK (member_type IN ('ì‚¬ì—…ê°€', 'íˆ¬ìì', 'í¬ë¦¬ì—ì´í„°') OR member_type IS NULL);

COMMENT ON COLUMN public.profiles.member_type IS 'ë©¤ë²„ íƒ€ì…: ì‚¬ì—…ê°€, íˆ¬ìì, í¬ë¦¬ì—ì´í„° ì¤‘ ì„ íƒ';
</file>

<file path="scripts/064_fix_notifications_rls.sql">
-- notifications í…Œì´ë¸” RLS ì •ì±… ìˆ˜ì •
-- ê¸°ì¡´ ì •ì±… ì‚­ì œ í›„ ì¬ìƒì„±

-- ê¸°ì¡´ ì •ì±… ì‚­ì œ
DROP POLICY IF EXISTS "Users can view their own notifications" ON notifications;
DROP POLICY IF EXISTS "Users can update their own notifications" ON notifications;
DROP POLICY IF EXISTS "System can insert notifications" ON notifications;

-- RLS í™œì„±í™” í™•ì¸
ALTER TABLE notifications ENABLE ROW LEVEL SECURITY;

-- ì¸ì¦ëœ ì‚¬ìš©ìê°€ ìì‹ ì˜ ì•Œë¦¼ì„ ë³¼ ìˆ˜ ìˆëŠ” ì •ì±…
CREATE POLICY "Users can view their own notifications"
  ON notifications FOR SELECT
  TO authenticated
  USING (auth.uid() = user_id);

-- ì¸ì¦ëœ ì‚¬ìš©ìê°€ ìì‹ ì˜ ì•Œë¦¼ì„ ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆëŠ” ì •ì±…
CREATE POLICY "Users can update their own notifications"
  ON notifications FOR UPDATE
  TO authenticated
  USING (auth.uid() = user_id);

-- ì‹œìŠ¤í…œì´ ì•Œë¦¼ì„ ì‚½ì…í•  ìˆ˜ ìˆëŠ” ì •ì±… (service role ë˜ëŠ” íŠ¸ë¦¬ê±° ìš©)
CREATE POLICY "System can insert notifications"
  ON notifications FOR INSERT
  TO authenticated
  WITH CHECK (true);

-- service_roleì„ ìœ„í•œ ì „ì²´ ì ‘ê·¼ ì •ì±… (íŠ¸ë¦¬ê±°ì—ì„œ ì‚¬ìš©)
CREATE POLICY "Service role full access"
  ON notifications
  FOR ALL
  TO service_role
  USING (true)
  WITH CHECK (true);
</file>

<file path="scripts/065_update_member_type_to_array.sql">
-- member_typeì„ ë°°ì—´ íƒ€ì…ìœ¼ë¡œ ë³€ê²½ (2ê°œê¹Œì§€ ì„ íƒ ê°€ëŠ¥)
-- ê¸°ì¡´ ë‹¨ì¼ ê°’ ì»¬ëŸ¼ì„ ë°°ì—´ë¡œ ë³€ê²½

-- 1. ê¸°ì¡´ ì œì•½ ì¡°ê±´ ì œê±° (íƒ€ì… ë³€ê²½ ì „ì— ì œê±°)
ALTER TABLE public.profiles 
DROP CONSTRAINT IF EXISTS profiles_member_type_check;

-- 2. ì»¬ëŸ¼ íƒ€ì…ì„ text[]ë¡œ ë³€ê²½ (ì´ë¯¸ ë°°ì—´ì´ë©´ ìŠ¤í‚µ)
DO $$
DECLARE
  col_udt_name text;
BEGIN
  -- ì»¬ëŸ¼ì˜ UDT íƒ€ì… í™•ì¸
  SELECT udt_name INTO col_udt_name
  FROM information_schema.columns 
  WHERE table_schema = 'public' 
  AND table_name = 'profiles' 
  AND column_name = 'member_type';
  
  -- ë°°ì—´ íƒ€ì…ì´ ì•„ë‹ˆë©´ ë³€í™˜
  IF col_udt_name IS NOT NULL AND col_udt_name != '_text' THEN
    ALTER TABLE public.profiles 
    ALTER COLUMN member_type TYPE text[] USING 
      CASE 
        WHEN member_type IS NULL THEN NULL::text[]
        WHEN member_type::text LIKE '{%' THEN string_to_array(trim(both '{}' from member_type::text), ',')
        ELSE ARRAY[member_type::text]
      END;
  END IF;
END $$;

-- 3. CHECK ì œì•½ ì¡°ê±´ ì¶”ê°€ (ì‚¬ì—…ê°€, íˆ¬ìì, í¬ë¦¬ì—ì´í„°ë§Œ í—ˆìš©, ìµœëŒ€ 2ê°œ)
ALTER TABLE public.profiles 
DROP CONSTRAINT IF EXISTS profiles_member_type_check;

ALTER TABLE public.profiles 
ADD CONSTRAINT profiles_member_type_check 
CHECK (
  member_type IS NULL 
  OR (
    array_length(member_type, 1) <= 2 
    AND (member_type <@ ARRAY['ì‚¬ì—…ê°€', 'íˆ¬ìì', 'í¬ë¦¬ì—ì´í„°']::text[])
  )
);

COMMENT ON COLUMN public.profiles.member_type IS 'ë©¤ë²„ íƒ€ì… ë°°ì—´: ì‚¬ì—…ê°€, íˆ¬ìì, í¬ë¦¬ì—ì´í„° ì¤‘ ìµœëŒ€ 2ê°œ ì„ íƒ ê°€ëŠ¥';
</file>

<file path="scripts/066_fix_member_type_constraint.sql">
-- member_type ì²´í¬ ì œì•½ ì¡°ê±´ ìˆ˜ì •
-- ë¹ˆ ë°°ì—´ê³¼ ìœ íš¨í•˜ì§€ ì•Šì€ ê°’ ì²˜ë¦¬ ê°œì„ 
-- ì£¼ì˜: ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” member_typeì´ ì´ë¯¸ text[] íƒ€ì…ì¼ ë•Œë§Œ ì‹¤í–‰í•˜ì„¸ìš”.
-- ë§Œì•½ ì•„ì§ text íƒ€ì…ì´ë¼ë©´ ë¨¼ì € scripts/065_update_member_type_to_array.sqlì„ ì‹¤í–‰í•˜ì„¸ìš”.

-- 2. ê¸°ì¡´ ì œì•½ ì¡°ê±´ ì œê±°
ALTER TABLE public.profiles 
DROP CONSTRAINT IF EXISTS profiles_member_type_check;

-- 3. ìƒˆë¡œìš´ ì œì•½ ì¡°ê±´ ì¶”ê°€ (ë” ì—„ê²©í•œ ê²€ì¦)
-- member_typeì´ ì´ë¯¸ text[] íƒ€ì…ì´ë¯€ë¡œ íƒ€ì… ìºìŠ¤íŒ… ì—†ì´ ì§ì ‘ ì‚¬ìš©
-- ì°¸ê³ : ì¤‘ë³µ ì²´í¬ëŠ” ì²´í¬ ì œì•½ ì¡°ê±´ì—ì„œ ì„œë¸Œì¿¼ë¦¬ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ 
--       ì• í”Œë¦¬ì¼€ì´ì…˜ ë ˆë²¨(lib/actions/user.ts)ì—ì„œ ì²˜ë¦¬í•©ë‹ˆë‹¤.
ALTER TABLE public.profiles 
ADD CONSTRAINT profiles_member_type_check 
CHECK (
  member_type IS NULL 
  OR (
    -- ë°°ì—´ì´ ë¹„ì–´ìˆì§€ ì•Šì•„ì•¼ í•¨
    array_length(member_type, 1) > 0
    -- ìµœëŒ€ 2ê°œê¹Œì§€ë§Œ í—ˆìš©
    AND array_length(member_type, 1) <= 2 
    -- ëª¨ë“  ìš”ì†Œê°€ í—ˆìš©ëœ ê°’ ì¤‘ í•˜ë‚˜ì—¬ì•¼ í•¨
    AND (member_type <@ ARRAY['ì‚¬ì—…ê°€', 'íˆ¬ìì', 'í¬ë¦¬ì—ì´í„°']::text[])
  )
);

COMMENT ON COLUMN public.profiles.member_type IS 'ë©¤ë²„ íƒ€ì… ë°°ì—´: ì‚¬ì—…ê°€, íˆ¬ìì, í¬ë¦¬ì—ì´í„° ì¤‘ ìµœëŒ€ 2ê°œ ì„ íƒ ê°€ëŠ¥ (ì¤‘ë³µ ë¶ˆê°€)';
</file>

<file path="scripts/067_profiles_admin_update_policy.sql">
-- ê´€ë¦¬ìê°€ ë‹¤ë¥¸ ì‚¬ìš©ìì˜ í”„ë¡œí•„(ì—­í• )ì„ ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆë„ë¡ RLS ì •ì±… ì¶”ê°€
-- ë§ˆìŠ¤í„° ê´€ë¦¬ìë§Œ ë‹¤ë¥¸ ì‚¬ìš©ìì˜ ì—­í• ì„ ë³€ê²½í•  ìˆ˜ ìˆìŒ

-- ê¸°ì¡´ ì •ì±…ì€ ìœ ì§€ (ì‚¬ìš©ìê°€ ìì‹ ì˜ í”„ë¡œí•„ì„ ì—…ë°ì´íŠ¸í•˜ëŠ” ì •ì±…)
-- ìƒˆë¡œìš´ ì •ì±… ì¶”ê°€: ë§ˆìŠ¤í„° ê´€ë¦¬ìê°€ ë‹¤ë¥¸ ì‚¬ìš©ìì˜ ì—­í• ì„ ë³€ê²½í•  ìˆ˜ ìˆìŒ

-- ê¸°ì¡´ ì •ì±…ì´ ìˆë‹¤ë©´ ì‚­ì œ (ì¤‘ë³µ ë°©ì§€)
DROP POLICY IF EXISTS "Master admins can update any profile role" ON public.profiles;

-- ìƒˆë¡œìš´ ì •ì±… ìƒì„±
CREATE POLICY "Master admins can update any profile role"
ON public.profiles
FOR UPDATE
USING (
  EXISTS (
    SELECT 1 FROM profiles
    WHERE profiles.id = auth.uid()
    AND profiles.role = 'master'
  )
)
WITH CHECK (
  EXISTS (
    SELECT 1 FROM profiles
    WHERE profiles.id = auth.uid()
    AND profiles.role = 'master'
  )
);

-- ì£¼ì„ ì¶”ê°€
COMMENT ON POLICY "Master admins can update any profile role" ON public.profiles IS 
'ë§ˆìŠ¤í„° ê´€ë¦¬ìê°€ ë‹¤ë¥¸ ì‚¬ìš©ìì˜ í”„ë¡œí•„(íŠ¹íˆ role ì»¬ëŸ¼)ì„ ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆë„ë¡ í—ˆìš©';
</file>

<file path="scripts/068_atomic_event_registration.sql">
-- ì´ë²¤íŠ¸ ë“±ë¡ Race Condition í•´ê²°ì„ ìœ„í•œ ì›ìì  ë“±ë¡ í•¨ìˆ˜
-- ì •ì› ì²´í¬ì™€ ë“±ë¡ì„ í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ì²˜ë¦¬

CREATE OR REPLACE FUNCTION register_for_event(
  p_event_id UUID,
  p_user_id UUID DEFAULT NULL,
  p_guest_name TEXT DEFAULT NULL,
  p_guest_contact TEXT DEFAULT NULL
) RETURNS TABLE(
  success BOOLEAN,
  registration_id UUID,
  message TEXT
)
LANGUAGE plpgsql
SECURITY DEFINER
AS $$
DECLARE
  v_max_participants INT;
  v_current_count INT;
  v_registration_id UUID;
  v_existing_id UUID;
BEGIN
  -- ì´ë²¤íŠ¸ í–‰ì„ ë½í•˜ê³  ì •ì› ì •ë³´ ê°€ì ¸ì˜¤ê¸°
  SELECT max_participants INTO v_max_participants
  FROM events
  WHERE id = p_event_id
  FOR UPDATE;

  -- ì´ë²¤íŠ¸ê°€ ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©´ ì—ëŸ¬
  IF NOT FOUND THEN
    RETURN QUERY SELECT false, NULL::UUID, 'ì´ë²¤íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤'::TEXT;
    RETURN;
  END IF;

  -- ì¤‘ë³µ ë“±ë¡ ì²´í¬ (ë¡œê·¸ì¸ ì‚¬ìš©ì)
  IF p_user_id IS NOT NULL THEN
    SELECT id INTO v_existing_id
    FROM event_registrations
    WHERE event_id = p_event_id AND user_id = p_user_id;

    IF FOUND THEN
      RETURN QUERY SELECT false, v_existing_id, 'ì´ë¯¸ ë“±ë¡ëœ ì´ë²¤íŠ¸ì…ë‹ˆë‹¤'::TEXT;
      RETURN;
    END IF;
  END IF;

  -- í˜„ì¬ ì°¸ê°€ì ìˆ˜ ì¡°íšŒ
  SELECT COUNT(*) INTO v_current_count
  FROM event_registrations
  WHERE event_id = p_event_id;

  -- ì •ì› ì²´í¬
  IF v_max_participants IS NOT NULL AND v_current_count >= v_max_participants THEN
    RETURN QUERY SELECT false, NULL::UUID, 'ì´ë²¤íŠ¸ ì •ì›ì´ ë§ˆê°ë˜ì—ˆìŠµë‹ˆë‹¤'::TEXT;
    RETURN;
  END IF;

  -- ë“±ë¡ ì‚½ì…
  INSERT INTO event_registrations (event_id, user_id, guest_name, guest_contact, registered_at)
  VALUES (p_event_id, p_user_id, p_guest_name, p_guest_contact, NOW())
  RETURNING id INTO v_registration_id;

  RETURN QUERY SELECT true, v_registration_id, 'ë“±ë¡ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤'::TEXT;
END;
$$;

-- í•¨ìˆ˜ ê¶Œí•œ ì„¤ì •: authenticated ë° anon ì‚¬ìš©ì ëª¨ë‘ í˜¸ì¶œ ê°€ëŠ¥
GRANT EXECUTE ON FUNCTION register_for_event(UUID, UUID, TEXT, TEXT) TO authenticated;
GRANT EXECUTE ON FUNCTION register_for_event(UUID, UUID, TEXT, TEXT) TO anon;

COMMENT ON FUNCTION register_for_event IS 'ì´ë²¤íŠ¸ ë“±ë¡ - Race Condition ë°©ì§€ë¥¼ ìœ„í•œ ì›ìì  ì²˜ë¦¬ í•¨ìˆ˜';
</file>

<file path="scripts/069_secure_event_registrations_rls.sql">
-- event_registrations RLS ì •ì±… ë³´ì•ˆ ê°•í™”
-- í˜„ì¬: ëª¨ë“  ì‚¬ìš©ìê°€ ëª¨ë“  ë“±ë¡ ì •ë³´ë¥¼ ë³¼ ìˆ˜ ìˆìŒ (ê°œì¸ì •ë³´ ë…¸ì¶œ ìœ„í—˜)
-- ë³€ê²½: ë³¸ì¸ ë“±ë¡, ì´ë²¤íŠ¸ ê°œì„¤ì, ê´€ë¦¬ìë§Œ ìƒì„¸ ì •ë³´ ì¡°íšŒ ê°€ëŠ¥

-- ê¸°ì¡´ SELECT ì •ì±… ì‚­ì œ
DROP POLICY IF EXISTS "Event registrations are viewable by everyone" ON event_registrations;

-- 1. ë“±ë¡ ìˆ˜ë§Œ ì¡°íšŒí•˜ëŠ” ê³µê°œ ì •ì±… (ì°¸ê°€ì ìˆ˜ í‘œì‹œìš©)
-- ì´ ì •ì±…ì€ count ì¿¼ë¦¬ì—ì„œ ì‚¬ìš©ë¨
CREATE POLICY "Anyone can count registrations" ON event_registrations
  FOR SELECT
  USING (true);

-- ì°¸ê³ : ìœ„ ì •ì±…ì€ ì¼ë‹¨ ê¸°ì¡´ê³¼ ë™ì¼í•˜ê²Œ ìœ ì§€
-- ì´ìœ : ì´ë²¤íŠ¸ ìƒì„¸ í˜ì´ì§€ì—ì„œ ì°¸ê°€ì ëª©ë¡(í”„ë¡œí•„ ì •ë³´ í¬í•¨)ì„ í‘œì‹œí•˜ê³  ìˆìŒ
-- ë§Œì•½ ì°¸ê°€ì ëª©ë¡ì„ ìˆ¨ê¸°ë ¤ë©´ ì•„ë˜ ì •ì±…ìœ¼ë¡œ êµì²´ í•„ìš”

-- ë” ì—„ê²©í•œ ì •ì±…ì´ í•„ìš”í•œ ê²½ìš° (ì°¸ê°€ì ëª©ë¡ ë¹„ê³µê°œ):
/*
DROP POLICY IF EXISTS "Anyone can count registrations" ON event_registrations;

CREATE POLICY "Secure event registration access" ON event_registrations
  FOR SELECT
  USING (
    -- ë³¸ì¸ì˜ ë“±ë¡ ì •ë³´
    auth.uid() = user_id
    OR
    -- ì´ë²¤íŠ¸ ê°œì„¤ì
    EXISTS (
      SELECT 1 FROM events
      WHERE events.id = event_registrations.event_id
      AND events.created_by = auth.uid()
    )
    OR
    -- ê´€ë¦¬ì
    EXISTS (
      SELECT 1 FROM profiles
      WHERE profiles.id = auth.uid()
      AND profiles.role IN ('admin', 'master')
    )
  );

-- ìµëª… ì‚¬ìš©ìë¥¼ ìœ„í•œ ë“±ë¡ ìˆ˜ ì¡°íšŒ í•¨ìˆ˜ (countë§Œ ë°˜í™˜)
CREATE OR REPLACE FUNCTION get_event_registration_count(p_event_id UUID)
RETURNS INT
LANGUAGE sql
SECURITY DEFINER
AS $$
  SELECT COUNT(*)::INT FROM event_registrations WHERE event_id = p_event_id;
$$;

GRANT EXECUTE ON FUNCTION get_event_registration_count(UUID) TO anon;
GRANT EXECUTE ON FUNCTION get_event_registration_count(UUID) TO authenticated;
*/

-- guest_contact í•„ë“œ ë³´í˜¸ë¥¼ ìœ„í•œ ë³„ë„ ì ‘ê·¼ ì œì–´ (ê¶Œì¥)
-- guest_contactì—ëŠ” ì´ë©”ì¼/ì „í™”ë²ˆí˜¸ ë“± ë¯¼ê°ì •ë³´ê°€ í¬í•¨ë  ìˆ˜ ìˆìŒ
-- Viewë¥¼ í†µí•´ ë¯¼ê°ì •ë³´ ë§ˆìŠ¤í‚¹

CREATE OR REPLACE VIEW public.event_registrations_public AS
SELECT
  id,
  event_id,
  user_id,
  guest_name,
  -- guest_contactëŠ” ë³¸ì¸/ì´ë²¤íŠ¸ ê°œì„¤ì/ê´€ë¦¬ìë§Œ ë³¼ ìˆ˜ ìˆë„ë¡ ë§ˆìŠ¤í‚¹
  CASE
    WHEN auth.uid() = user_id THEN guest_contact
    WHEN EXISTS (
      SELECT 1 FROM events
      WHERE events.id = event_registrations.event_id
      AND events.created_by = auth.uid()
    ) THEN guest_contact
    WHEN EXISTS (
      SELECT 1 FROM profiles
      WHERE profiles.id = auth.uid()
      AND profiles.role IN ('admin', 'master')
    ) THEN guest_contact
    ELSE
      CASE
        WHEN guest_contact IS NOT NULL AND guest_contact LIKE '%@%'
        THEN CONCAT(LEFT(guest_contact, 3), '***@***')
        WHEN guest_contact IS NOT NULL
        THEN CONCAT(LEFT(guest_contact, 3), '****')
        ELSE NULL
      END
  END as guest_contact,
  registered_at
FROM event_registrations;

-- Viewì— ëŒ€í•œ ê¶Œí•œ ì„¤ì •
GRANT SELECT ON public.event_registrations_public TO anon;
GRANT SELECT ON public.event_registrations_public TO authenticated;

COMMENT ON VIEW public.event_registrations_public IS
'ì´ë²¤íŠ¸ ë“±ë¡ ì •ë³´ ê³µê°œ ë·° - guest_contact í•„ë“œê°€ ë§ˆìŠ¤í‚¹ë¨';
</file>

<file path="scripts/099_rebuild_community_schema.sql">
-- ============================================
-- Phase 1: ì»¤ë®¤ë‹ˆí‹° ìŠ¤í‚¤ë§ˆ ì¬êµ¬ì¶• ë° ë°ì´í„° ì´ˆê¸°í™”
-- ëª©í‘œ: ì½”ë“œê°€ ë°ì´í„°ë¥¼ ì˜ì‹¬í•˜ì§€ ì•Šë„ë¡ DBë¥¼ ì™„ë²½í•œ ìƒíƒœë¡œ ì´ˆê¸°í™”
-- ============================================

BEGIN;

-- ============================================
-- Step A: posts í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ ì •ë¦¬
-- ============================================

-- 1. visibility ì»¬ëŸ¼ ì¶”ê°€ (ì—†ëŠ” ê²½ìš°)
DO $$ 
BEGIN
    IF NOT EXISTS (
        SELECT 1 FROM information_schema.columns 
        WHERE table_name = 'posts' AND column_name = 'visibility'
    ) THEN
        ALTER TABLE posts 
        ADD COLUMN visibility TEXT DEFAULT 'public' CHECK (visibility IN ('public', 'group'));
    END IF;
END $$;

-- 2. ê¸°ì¡´ FK ì œì•½ì¡°ê±´ ì‚­ì œ (ìˆëŠ” ê²½ìš°)
DO $$ 
BEGIN
    IF EXISTS (
        SELECT 1 FROM information_schema.table_constraints 
        WHERE constraint_name = 'posts_board_category_id_fkey'
    ) THEN
        ALTER TABLE posts DROP CONSTRAINT posts_board_category_id_fkey;
    END IF;
END $$;

-- 3. ìƒˆë¡œìš´ FK ì œì•½ì¡°ê±´ ì¶”ê°€ (CASCADE DELETE)
ALTER TABLE posts 
ADD CONSTRAINT posts_board_category_id_fkey 
FOREIGN KEY (board_category_id) 
REFERENCES board_categories(id) 
ON DELETE SET NULL;

-- ============================================
-- Step B: board_categories í…Œì´ë¸” ì´ˆê¸°í™” ë° í‘œì¤€ ë°ì´í„° ì‚½ì…
-- ============================================

-- ê¸°ì¡´ ë°ì´í„° ì‚­ì œ
DELETE FROM board_categories;

-- í‘œì¤€ ìŠ¬ëŸ¬ê·¸ 4ê°œ INSERT
INSERT INTO board_categories (id, name, slug, description, is_active, created_at, updated_at)
VALUES
    (gen_random_uuid(), 'ê³µì§€ì‚¬í•­', 'announcement', 'ì¤‘ìš”í•œ ê³µì§€ì‚¬í•­ì„ í™•ì¸í•˜ì„¸ìš”.', true, NOW(), NOW()),
    (gen_random_uuid(), 'ììœ ê²Œì‹œíŒ', 'free-board', 'ììœ ë¡­ê²Œ ì†Œí†µí•˜ëŠ” ê³µê°„ì…ë‹ˆë‹¤.', true, NOW(), NOW()),
    (gen_random_uuid(), 'ë°˜ê³¨', 'vangol', 'ë°˜ê³¨ ì»¤ë®¤ë‹ˆí‹° ê²Œì‹œíŒì…ë‹ˆë‹¤.', true, NOW(), NOW()),
    (gen_random_uuid(), 'í•˜ì´í† í¬', 'hightalk', 'í•˜ì´í† í¬ ì»¤ë®¤ë‹ˆí‹° ê²Œì‹œíŒì…ë‹ˆë‹¤.', true, NOW(), NOW())
ON CONFLICT (slug) DO UPDATE SET
    name = EXCLUDED.name,
    description = EXCLUDED.description,
    is_active = EXCLUDED.is_active,
    updated_at = NOW();

-- ============================================
-- Step C: posts í…Œì´ë¸”ì˜ ëª¨ë“  ê¸€ì„ free-boardë¡œ ê°•ì œ ì´ë™
-- ============================================

-- free-board ì¹´í…Œê³ ë¦¬ ID ê°€ì ¸ì˜¤ê¸°
DO $$
DECLARE
    free_board_id UUID;
BEGIN
    SELECT id INTO free_board_id 
    FROM board_categories 
    WHERE slug = 'free-board' 
    LIMIT 1;
    
    -- ëª¨ë“  ê²Œì‹œê¸€ì„ free-boardë¡œ ì´ë™
    UPDATE posts 
    SET board_category_id = free_board_id 
    WHERE board_category_id IS NULL OR board_category_id NOT IN (
        SELECT id FROM board_categories
    );
    
    -- board_category_idê°€ NULLì¸ ê²½ìš°ì—ë„ free-boardë¡œ ì„¤ì •
    UPDATE posts 
    SET board_category_id = free_board_id 
    WHERE board_category_id IS NULL;
END $$;

-- ============================================
-- Step D: ê° ì¹´í…Œê³ ë¦¬ë³„ í…ŒìŠ¤íŠ¸ ê²Œì‹œê¸€ ìƒì„±
-- ============================================

DO $$
DECLARE
    announcement_id UUID;
    free_board_id UUID;
    vangol_id UUID;
    hightalk_id UUID;
    test_user_id UUID;
BEGIN
    -- ì¹´í…Œê³ ë¦¬ ID ê°€ì ¸ì˜¤ê¸°
    SELECT id INTO announcement_id FROM board_categories WHERE slug = 'announcement' LIMIT 1;
    SELECT id INTO free_board_id FROM board_categories WHERE slug = 'free-board' LIMIT 1;
    SELECT id INTO vangol_id FROM board_categories WHERE slug = 'vangol' LIMIT 1;
    SELECT id INTO hightalk_id FROM board_categories WHERE slug = 'hightalk' LIMIT 1;
    
    -- í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì ID ê°€ì ¸ì˜¤ê¸° (ì—†ìœ¼ë©´ ì²« ë²ˆì§¸ ì‚¬ìš©ì)
    SELECT id INTO test_user_id FROM profiles LIMIT 1;
    
    -- í…ŒìŠ¤íŠ¸ ì‚¬ìš©ìê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ UUID ì‚¬ìš©
    IF test_user_id IS NULL THEN
        test_user_id := '00000000-0000-0000-0000-000000000000'::UUID;
    END IF;
    
    -- ê° ì¹´í…Œê³ ë¦¬ë³„ë¡œ í…ŒìŠ¤íŠ¸ ê²Œì‹œê¸€ 1ê°œì”© ìƒì„± (ì—†ëŠ” ê²½ìš°ì—ë§Œ)
    INSERT INTO posts (id, title, content, author_id, board_category_id, visibility, created_at, updated_at)
    SELECT 
        gen_random_uuid(),
        'ê³µì§€ì‚¬í•­ í…ŒìŠ¤íŠ¸ ê¸€',
        '<p>ì´ê²ƒì€ ê³µì§€ì‚¬í•­ ê²Œì‹œíŒì˜ í…ŒìŠ¤íŠ¸ ê²Œì‹œê¸€ì…ë‹ˆë‹¤.</p>',
        test_user_id,
        announcement_id,
        'public',
        NOW(),
        NOW()
    WHERE NOT EXISTS (
        SELECT 1 FROM posts WHERE board_category_id = announcement_id
    );
    
    INSERT INTO posts (id, title, content, author_id, board_category_id, visibility, created_at, updated_at)
    SELECT 
        gen_random_uuid(),
        'ììœ ê²Œì‹œíŒ í…ŒìŠ¤íŠ¸ ê¸€',
        '<p>ì´ê²ƒì€ ììœ ê²Œì‹œíŒì˜ í…ŒìŠ¤íŠ¸ ê²Œì‹œê¸€ì…ë‹ˆë‹¤.</p>',
        test_user_id,
        free_board_id,
        'public',
        NOW(),
        NOW()
    WHERE NOT EXISTS (
        SELECT 1 FROM posts WHERE board_category_id = free_board_id
    );
    
    INSERT INTO posts (id, title, content, author_id, board_category_id, visibility, created_at, updated_at)
    SELECT 
        gen_random_uuid(),
        'ë°˜ê³¨ í…ŒìŠ¤íŠ¸ ê¸€',
        '<p>ì´ê²ƒì€ ë°˜ê³¨ ì»¤ë®¤ë‹ˆí‹° ê²Œì‹œíŒì˜ í…ŒìŠ¤íŠ¸ ê²Œì‹œê¸€ì…ë‹ˆë‹¤.</p>',
        test_user_id,
        vangol_id,
        'public',
        NOW(),
        NOW()
    WHERE NOT EXISTS (
        SELECT 1 FROM posts WHERE board_category_id = vangol_id
    );
    
    INSERT INTO posts (id, title, content, author_id, board_category_id, visibility, created_at, updated_at)
    SELECT 
        gen_random_uuid(),
        'í•˜ì´í† í¬ í…ŒìŠ¤íŠ¸ ê¸€',
        '<p>ì´ê²ƒì€ í•˜ì´í† í¬ ì»¤ë®¤ë‹ˆí‹° ê²Œì‹œíŒì˜ í…ŒìŠ¤íŠ¸ ê²Œì‹œê¸€ì…ë‹ˆë‹¤.</p>',
        test_user_id,
        hightalk_id,
        'public',
        NOW(),
        NOW()
    WHERE NOT EXISTS (
        SELECT 1 FROM posts WHERE board_category_id = hightalk_id
    );
END $$;

-- ============================================
-- Step E: RLS ì •ì±… ì´ˆê¸°í™” (ê°œë°œ ë‹¨ê³„ ì ‘ê·¼ì„± í™•ë³´)
-- ============================================

-- ê¸°ì¡´ RLS ì •ì±… ì‚­ì œ
DROP POLICY IF EXISTS "posts_select_public" ON posts;
DROP POLICY IF EXISTS "board_categories_select_public" ON board_categories;
DROP POLICY IF EXISTS "profiles_select_public" ON profiles;

-- posts í…Œì´ë¸”: SELECT ê¶Œí•œì„ publicì—ê²Œ ì¡°ê±´ ì—†ì´ í—ˆìš©
CREATE POLICY "posts_select_public" ON posts
    FOR SELECT
    TO public
    USING (true);

-- board_categories í…Œì´ë¸”: SELECT ê¶Œí•œì„ publicì—ê²Œ ì¡°ê±´ ì—†ì´ í—ˆìš©
CREATE POLICY "board_categories_select_public" ON board_categories
    FOR SELECT
    TO public
    USING (true);

-- profiles í…Œì´ë¸”: SELECT ê¶Œí•œì„ publicì—ê²Œ ì¡°ê±´ ì—†ì´ í—ˆìš©
CREATE POLICY "profiles_select_public" ON profiles
    FOR SELECT
    TO public
    USING (true);

-- ============================================
-- ê²€ì¦ ì¿¼ë¦¬
-- ============================================

-- ì¹´í…Œê³ ë¦¬ í™•ì¸
SELECT 'ì¹´í…Œê³ ë¦¬ ê°œìˆ˜:' as check_type, COUNT(*) as count FROM board_categories;

-- ê° ì¹´í…Œê³ ë¦¬ë³„ ê²Œì‹œê¸€ ê°œìˆ˜ í™•ì¸
SELECT 
    bc.name as category_name,
    bc.slug,
    COUNT(p.id) as post_count
FROM board_categories bc
LEFT JOIN posts p ON p.board_category_id = bc.id
GROUP BY bc.id, bc.name, bc.slug
ORDER BY bc.slug;

COMMIT;

-- ============================================
-- ì™„ë£Œ ë©”ì‹œì§€
-- ============================================
DO $$
BEGIN
    RAISE NOTICE 'âœ… ì»¤ë®¤ë‹ˆí‹° ìŠ¤í‚¤ë§ˆ ì¬êµ¬ì¶• ì™„ë£Œ!';
    RAISE NOTICE 'ğŸ“‹ ë‹¤ìŒ ë‹¨ê³„: Phase 2 - ì¿¼ë¦¬ ë¡œì§ ì•ˆì •í™”';
END $$;
</file>

<file path="scripts/100_upgrade_to_club_system.sql">
-- SFC ì»¤ë®¤ë‹ˆí‹° ê¸°ëŠ¥ì„ "Disquiet ìŠ¤íƒ€ì¼ì˜ í´ëŸ½ ì‹œìŠ¤í…œ"ìœ¼ë¡œ ê³ ë„í™”
-- ê¸°ì¡´ board_categoriesì˜ 'ë°˜ê³¨(vangol)'ê³¼ 'í•˜ì´í† í¬(hightalk)'ë¥¼ ë…ë¦½ì ì¸ í´ëŸ½ìœ¼ë¡œ ì „í™˜

-- ============================================
-- 1. communities í…Œì´ë¸” í™•ì¥
-- ============================================

-- slug ì»¬ëŸ¼ ì¶”ê°€ (unique)
DO $$ 
BEGIN
  IF NOT EXISTS (
    SELECT 1 FROM information_schema.columns 
    WHERE table_schema = 'public' 
    AND table_name = 'communities' 
    AND column_name = 'slug'
  ) THEN
    ALTER TABLE public.communities ADD COLUMN slug text UNIQUE;
    CREATE UNIQUE INDEX IF NOT EXISTS idx_communities_slug ON public.communities(slug);
  END IF;
END $$;

-- cover_image_url ì»¬ëŸ¼ ì¶”ê°€
DO $$ 
BEGIN
  IF NOT EXISTS (
    SELECT 1 FROM information_schema.columns 
    WHERE table_schema = 'public' 
    AND table_name = 'communities' 
    AND column_name = 'cover_image_url'
  ) THEN
    ALTER TABLE public.communities ADD COLUMN cover_image_url text;
  END IF;
END $$;

-- subtitle ì»¬ëŸ¼ ì¶”ê°€ (ì§§ì€ í•œ ì¤„ ì†Œê°œ)
DO $$ 
BEGIN
  IF NOT EXISTS (
    SELECT 1 FROM information_schema.columns 
    WHERE table_schema = 'public' 
    AND table_name = 'communities' 
    AND column_name = 'subtitle'
  ) THEN
    ALTER TABLE public.communities ADD COLUMN subtitle text;
  END IF;
END $$;

-- requires_approval ì»¬ëŸ¼ ì¶”ê°€ (ê°€ì… ìŠ¹ì¸ í•„ìš” ì—¬ë¶€)
DO $$ 
BEGIN
  IF NOT EXISTS (
    SELECT 1 FROM information_schema.columns 
    WHERE table_schema = 'public' 
    AND table_name = 'communities' 
    AND column_name = 'requires_approval'
  ) THEN
    ALTER TABLE public.communities ADD COLUMN requires_approval boolean DEFAULT false NOT NULL;
  END IF;
END $$;

-- ============================================
-- 2. community_members í…Œì´ë¸” í™•ì¥
-- ============================================

-- status ì»¬ëŸ¼ ì¶”ê°€ (ë©¤ë²„ ìƒíƒœ)
DO $$ 
BEGIN
  IF NOT EXISTS (
    SELECT 1 FROM information_schema.columns 
    WHERE table_schema = 'public' 
    AND table_name = 'community_members' 
    AND column_name = 'status'
  ) THEN
    ALTER TABLE public.community_members ADD COLUMN status text DEFAULT 'active' NOT NULL;
    -- CHECK ì œì•½ ì¶”ê°€
    ALTER TABLE public.community_members ADD CONSTRAINT community_members_status_check 
      CHECK (status IN ('active', 'pending', 'rejected', 'banned'));
  END IF;
END $$;

-- answer ì»¬ëŸ¼ ì¶”ê°€ (ê°€ì… ì‹ ì²­ ì‹œ ë‹µë³€)
DO $$ 
BEGIN
  IF NOT EXISTS (
    SELECT 1 FROM information_schema.columns 
    WHERE table_schema = 'public' 
    AND table_name = 'community_members' 
    AND column_name = 'answer'
  ) THEN
    ALTER TABLE public.community_members ADD COLUMN answer text;
  END IF;
END $$;

-- ê¸°ì¡´ ë©¤ë²„ë“¤ì˜ statusë¥¼ 'active'ë¡œ ì„¤ì • (ì´ë¯¸ ê¸°ë³¸ê°’ì´ì§€ë§Œ ëª…ì‹œì ìœ¼ë¡œ)
UPDATE public.community_members 
SET status = 'active' 
WHERE status IS NULL;

-- ============================================
-- 3. Master ê´€ë¦¬ì ID ì°¾ê¸°
-- ============================================

DO $$
DECLARE
  master_user_id uuid;
  vangol_board_id uuid;
  hightalk_board_id uuid;
  vangol_community_id uuid;
  hightalk_community_id uuid;
BEGIN
  -- Master ê´€ë¦¬ì ì°¾ê¸° (roleì´ 'master'ì´ê±°ë‚˜ ì´ë©”ì¼ì´ 'jaewook@mvmt.city')
  SELECT id INTO master_user_id
  FROM public.profiles
  WHERE role = 'master' OR email = 'jaewook@mvmt.city'
  ORDER BY created_at ASC
  LIMIT 1;

  -- Masterê°€ ì—†ìœ¼ë©´ ì²« ë²ˆì§¸ ê´€ë¦¬ì ë˜ëŠ” ì²« ë²ˆì§¸ ì‚¬ìš©ì ì‚¬ìš©
  IF master_user_id IS NULL THEN
    SELECT id INTO master_user_id
    FROM public.profiles
    WHERE role = 'admin'
    ORDER BY created_at ASC
    LIMIT 1;
  END IF;

  IF master_user_id IS NULL THEN
    SELECT id INTO master_user_id
    FROM public.profiles
    ORDER BY created_at ASC
    LIMIT 1;
  END IF;

  -- ============================================
  -- 4. board_categoriesì—ì„œ 'ë°˜ê³¨(vangol)'ê³¼ 'í•˜ì´í† í¬(hightalk)' ì°¾ê¸°
  -- ============================================

  -- ë°˜ê³¨ board_category ì°¾ê¸°
  SELECT id INTO vangol_board_id
  FROM public.board_categories
  WHERE slug IN ('vangol', 'bangol')
  LIMIT 1;

  -- í•˜ì´í† í¬ board_category ì°¾ê¸°
  SELECT id INTO hightalk_board_id
  FROM public.board_categories
  WHERE slug = 'hightalk'
  LIMIT 1;

  -- ============================================
  -- 5. communitiesì— ë°˜ê³¨ í´ëŸ½ ìƒì„±/ì—…ë°ì´íŠ¸
  -- ============================================

  IF vangol_board_id IS NOT NULL THEN
    -- ê¸°ì¡´ communitiesì—ì„œ slugê°€ 'vangol'ì¸ ê²ƒ ì°¾ê¸°
    SELECT id INTO vangol_community_id
    FROM public.communities
    WHERE slug = 'vangol'
    LIMIT 1;

    IF vangol_community_id IS NULL THEN
      -- ìƒˆë¡œ ìƒì„±
      INSERT INTO public.communities (
        name,
        slug,
        description,
        subtitle,
        created_by,
        requires_approval,
        is_private
      )
      SELECT 
        bc.name,
        'vangol',
        bc.description,
        'ë°˜ê³¨ ëª¨ì„ í´ëŸ½',
        master_user_id,
        false,
        false
      FROM public.board_categories bc
      WHERE bc.id = vangol_board_id
      RETURNING id INTO vangol_community_id;
    ELSE
      -- ê¸°ì¡´ ê²ƒ ì—…ë°ì´íŠ¸
      UPDATE public.communities
      SET 
        name = COALESCE((SELECT name FROM public.board_categories WHERE id = vangol_board_id), name),
        description = COALESCE((SELECT description FROM public.board_categories WHERE id = vangol_board_id), description),
        subtitle = COALESCE(subtitle, 'ë°˜ê³¨ ëª¨ì„ í´ëŸ½')
      WHERE id = vangol_community_id;
    END IF;

    -- ============================================
    -- 6. posts í…Œì´ë¸”ì˜ ë°˜ê³¨ ê²Œì‹œê¸€ë“¤ì„ ìƒˆ communityì— ì—°ê²°
    -- ============================================
    UPDATE public.posts
    SET community_id = vangol_community_id
    WHERE board_category_id = vangol_board_id
      AND (community_id IS NULL OR community_id != vangol_community_id);

    RAISE NOTICE 'ë°˜ê³¨ í´ëŸ½ ìƒì„±/ì—…ë°ì´íŠ¸ ì™„ë£Œ: community_id = %', vangol_community_id;
  ELSE
    RAISE NOTICE 'ë°˜ê³¨ board_categoryë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
  END IF;

  -- ============================================
  -- 7. communitiesì— í•˜ì´í† í¬ í´ëŸ½ ìƒì„±/ì—…ë°ì´íŠ¸
  -- ============================================

  IF hightalk_board_id IS NOT NULL THEN
    -- ê¸°ì¡´ communitiesì—ì„œ slugê°€ 'hightalk'ì¸ ê²ƒ ì°¾ê¸°
    SELECT id INTO hightalk_community_id
    FROM public.communities
    WHERE slug = 'hightalk'
    LIMIT 1;

    IF hightalk_community_id IS NULL THEN
      -- ìƒˆë¡œ ìƒì„±
      INSERT INTO public.communities (
        name,
        slug,
        description,
        subtitle,
        created_by,
        requires_approval,
        is_private
      )
      SELECT 
        bc.name,
        'hightalk',
        bc.description,
        'í•˜ì´í† í¬ ëª¨ì„ í´ëŸ½',
        master_user_id,
        false,
        false
      FROM public.board_categories bc
      WHERE bc.id = hightalk_board_id
      RETURNING id INTO hightalk_community_id;
    ELSE
      -- ê¸°ì¡´ ê²ƒ ì—…ë°ì´íŠ¸
      UPDATE public.communities
      SET 
        name = COALESCE((SELECT name FROM public.board_categories WHERE id = hightalk_board_id), name),
        description = COALESCE((SELECT description FROM public.board_categories WHERE id = hightalk_board_id), description),
        subtitle = COALESCE(subtitle, 'í•˜ì´í† í¬ ëª¨ì„ í´ëŸ½')
      WHERE id = hightalk_community_id;
    END IF;

    -- ============================================
    -- 8. posts í…Œì´ë¸”ì˜ í•˜ì´í† í¬ ê²Œì‹œê¸€ë“¤ì„ ìƒˆ communityì— ì—°ê²°
    -- ============================================
    UPDATE public.posts
    SET community_id = hightalk_community_id
    WHERE board_category_id = hightalk_board_id
      AND (community_id IS NULL OR community_id != hightalk_community_id);

    RAISE NOTICE 'í•˜ì´í† í¬ í´ëŸ½ ìƒì„±/ì—…ë°ì´íŠ¸ ì™„ë£Œ: community_id = %', hightalk_community_id;
  ELSE
    RAISE NOTICE 'í•˜ì´í† í¬ board_categoryë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
  END IF;

  -- ============================================
  -- 9. ë§ˆì´ê·¸ë ˆì´ì…˜ ê²°ê³¼ í™•ì¸
  -- ============================================
  RAISE NOTICE '========================================';
  RAISE NOTICE 'í´ëŸ½ ì‹œìŠ¤í…œ ì—…ê·¸ë ˆì´ë“œ ì™„ë£Œ';
  RAISE NOTICE '========================================';
  RAISE NOTICE 'Master User ID: %', master_user_id;
  RAISE NOTICE 'ë°˜ê³¨ Board ID: %', vangol_board_id;
  RAISE NOTICE 'í•˜ì´í† í¬ Board ID: %', hightalk_board_id;
  RAISE NOTICE 'ë°˜ê³¨ Community ID: %', vangol_community_id;
  RAISE NOTICE 'í•˜ì´í† í¬ Community ID: %', hightalk_community_id;

END $$;

-- ============================================
-- 10. ë§ˆì´ê·¸ë ˆì´ì…˜ ê²°ê³¼ ê²€ì¦ ì¿¼ë¦¬
-- ============================================

-- ìƒì„±ëœ í´ëŸ½ í™•ì¸
SELECT 
  c.id,
  c.name,
  c.slug,
  c.subtitle,
  c.description,
  c.requires_approval,
  c.is_private,
  COUNT(DISTINCT p.id) as post_count,
  COUNT(DISTINCT cm.id) as member_count
FROM public.communities c
LEFT JOIN public.posts p ON p.community_id = c.id
LEFT JOIN public.community_members cm ON cm.community_id = c.id AND cm.status = 'active'
WHERE c.slug IN ('vangol', 'hightalk')
GROUP BY c.id, c.name, c.slug, c.subtitle, c.description, c.requires_approval, c.is_private
ORDER BY c.slug;

-- ê²Œì‹œê¸€ ì—°ê²° í™•ì¸
SELECT 
  bc.name as board_category,
  bc.slug as board_slug,
  COUNT(p.id) as posts_in_board,
  c.name as community_name,
  c.slug as community_slug,
  COUNT(p2.id) as posts_in_community
FROM public.board_categories bc
LEFT JOIN public.posts p ON p.board_category_id = bc.id
LEFT JOIN public.communities c ON c.slug = bc.slug
LEFT JOIN public.posts p2 ON p2.community_id = c.id
WHERE bc.slug IN ('vangol', 'bangol', 'hightalk')
GROUP BY bc.id, bc.name, bc.slug, c.id, c.name, c.slug
ORDER BY bc.slug;
</file>

<file path="scripts/999_seed_launch_data.sql">
-- ëŸ°ì¹­ ëŒ€ë¹„ìš© 'ë¦¬ì–¼í•œ' ë”ë¯¸ ë°ì´í„° ìƒì„± ìŠ¤í¬ë¦½íŠ¸
-- ì „ëµ: demo_user_idë¥¼ ì‚¬ìš©í•˜ì—¬ ëª¨ë“  ë”ë¯¸ ë°ì´í„°ë¥¼ ì—°ê²°
-- ëŸ°ì¹­ ì‹œ ì´ ìœ ì €ë§Œ ì‚­ì œí•˜ë©´ Cascadeë¡œ ëª¨ë“  ë”ë¯¸ ë°ì´í„°ê°€ ì‚¬ë¼ì§‘ë‹ˆë‹¤.

DO $$
DECLARE
  demo_user_id uuid;
  free_board_id uuid;
  request_board_id uuid;
  vangol_board_id uuid;
  hightalk_board_id uuid;
  announcement_board_id uuid;
  created_post_id uuid;
BEGIN
  -- ë°ëª¨ ìœ ì € ID ì„¤ì • (ê¸°ì¡´ ë§ˆìŠ¤í„° ê³„ì • ë˜ëŠ” ì²« ë²ˆì§¸ ìœ ì €)
  -- ì‹¤ì œ ëŸ°ì¹­ ì „ ì‚­ì œí•  ë•ŒëŠ” ì´ IDë¥¼ ê°€ì§„ rowë¥¼ profilesì—ì„œ ì‚­ì œí•˜ë©´ ë©ë‹ˆë‹¤.
  SELECT id INTO demo_user_id FROM profiles ORDER BY created_at LIMIT 1;
  
  -- ìœ ì €ê°€ ì—†ìœ¼ë©´ ìŠ¤í¬ë¦½íŠ¸ ì¢…ë£Œ
  IF demo_user_id IS NULL THEN
    RAISE NOTICE 'âš ï¸ ë°ëª¨ ìœ ì €ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ì‚¬ìš©ìë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”.';
    RETURN;
  END IF;

  -- ì¹´í…Œê³ ë¦¬ ID ê°€ì ¸ì˜¤ê¸°
  SELECT id INTO free_board_id FROM board_categories WHERE slug = 'free-board';
  SELECT id INTO request_board_id FROM board_categories WHERE slug = 'event-requests';
  SELECT id INTO vangol_board_id FROM board_categories WHERE slug = 'vangol';
  SELECT id INTO hightalk_board_id FROM board_categories WHERE slug = 'hightalk';
  SELECT id INTO announcement_board_id FROM board_categories WHERE slug = 'announcement';

  -- ==========================================
  -- 2. [ì—´ì–´ì£¼ì„¸ìš”] ë”ë¯¸ ë°ì´í„° (ìˆ˜ìš” íŒŒì•…ìš©)
  -- ==========================================
  INSERT INTO posts (title, content, author_id, board_category_id, visibility, likes_count, comments_count, created_at)
  VALUES
  (
    'ê°•ë‚¨ì—­ ê·¼ì²˜ ì´ˆê¸° ì°½ì—…íŒ€ ì»¤í”¼ì±— ì›í•´ìš”!',
    'ê°•ë‚¨ì—­ ê³µìœ ì˜¤í”¼ìŠ¤ ì…ì£¼í•´ ìˆëŠ”ë°, ì ì‹¬ì‹œê°„ì— ê°€ë³ê²Œ ë§Œë‚˜ì„œ ê³ ë¯¼ ë‚˜ëˆŒ ì´ˆê¸° ì°½ì—…íŒ€ ìˆë‚˜ìš”? ê°œë°œì ì±„ìš©ì´ë‚˜ ë§ˆì¼€íŒ… ì´ì•¼ê¸° ë‚˜ëˆ„ê³  ì‹¶ìŠµë‹ˆë‹¤.',
    demo_user_id,
    request_board_id,
    'public',
    12, -- ì¢‹ì•„ìš” ìˆ˜ ì¡°ì‘ (ì¸ê¸° ìˆì–´ ë³´ì´ê²Œ)
    3,
    NOW() - INTERVAL '2 hours'
  ),
  (
    'SaaS B2B ì„¸ì¼ì¦ˆ ë…¸í•˜ìš° ê³µìœ íšŒ ìš”ì²­í•©ë‹ˆë‹¤',
    'B2B ì„¸ì¼ì¦ˆ ë§¨ë•…ì— í—¤ë”© ì¤‘ì¸ë°, ì„ ë°°ë‹˜ë“¤ì˜ ë…¸í•˜ìš°ê°€ ì ˆì‹¤í•©ë‹ˆë‹¤. ì½œë“œë©”ì¼ ì‘ì„±ë²•ë¶€í„° í´ë¡œì§•ê¹Œì§€ ì‹¤ì „ íŒ ê³µìœ í•´ì£¼ì‹¤ ë¶„ ê³„ì‹ ê°€ìš”?',
    demo_user_id,
    request_board_id,
    'public',
    28,
    5,
    NOW() - INTERVAL '1 day'
  ),
  (
    'ì£¼ë§ ë¶í•œì‚° ë“±ì‚° ëª¨ì„ (ë’·í’€ì´ ë°±ìˆ™ í•„ìˆ˜)',
    'ë‚ ì”¨ ì¢‹ì€ë° ì£¼ë§ì— ë“±ì‚° ê°€ì‹¤ ë¶„? ì°½ì—… ì´ì•¼ê¸°í•˜ë©´ì„œ ë•€ í˜ë¦¬ê³  ë‚´ë ¤ì™€ì„œ ë°±ìˆ™ ë¨¹ì–´ìš”. 4ëª… ì •ë„ ì†Œê·œëª¨ë¡œ ëª¨ì§‘ í¬ë§í•©ë‹ˆë‹¤.',
    demo_user_id,
    request_board_id,
    'public',
    8,
    2,
    NOW() - INTERVAL '3 days'
  )
  ON CONFLICT DO NOTHING;

  -- ==========================================
  -- 3. [ììœ ê²Œì‹œíŒ/ì»¤ë®¤ë‹ˆí‹°] ë”ë¯¸ ë°ì´í„° (í™œì„±í™” ëŠë‚Œ)
  -- ==========================================
  INSERT INTO posts (title, content, author_id, board_category_id, visibility, likes_count, comments_count, created_at)
  VALUES
  (
    'íˆ¬ì í˜¹í•œê¸°, ë‹¤ë“¤ ì–´ë–»ê²Œ ë²„í‹°ê³  ê³„ì‹ ê°€ìš”?',
    'ìµœê·¼ VC ë¯¸íŒ… ë‹¤ë…€ì™”ëŠ”ë° ë¶„ìœ„ê¸°ê°€ ë§ì´ ì–¼ì–´ë¶™ì—ˆë„¤ìš”. ëŸ°ì›¨ì´ ê´€ë¦¬ë‘ í”¼ë³´íŒ… ê³ ë¯¼ ì¤‘ì¸ë° ë‹¤ë¥¸ ëŒ€í‘œë‹˜ë“¤ ìƒí™©ì€ ì–´ë– ì‹ ì§€ ê¶ê¸ˆí•©ë‹ˆë‹¤.',
    demo_user_id,
    free_board_id,
    'public',
    15,
    8,
    NOW() - INTERVAL '5 hours'
  ),
  (
    '[í›„ê¸°] ì§€ë‚œì£¼ ë„¤íŠ¸ì›Œí‚¹ íŒŒí‹° ë‹¤ë…€ì™”ìŠµë‹ˆë‹¤',
    'ìƒê°ë³´ë‹¤ ë‹¤ì–‘í•œ ë¶„ì•¼ì˜ ëŒ€í‘œë‹˜ë“¤ì„ ë§Œë‚  ìˆ˜ ìˆì–´ì„œ ì¢‹ì•˜ìŠµë‹ˆë‹¤. íŠ¹íˆ AI ìª½ ì¸ì‚¬ì´íŠ¸ ì–»ì€ ê²Œ í° ë„ì›€ì´ ëë„¤ìš”. ë‹¤ìŒ ëª¨ì„ë„ ê¸°ëŒ€ë©ë‹ˆë‹¤!',
    demo_user_id,
    vangol_board_id,
    'group', -- ê·¸ë£¹ ê³µê°œ ì˜ˆì‹œ
    22,
    4,
    NOW() - INTERVAL '2 days'
  ),
  (
    'í”„ë¡œë•íŠ¸-ë§ˆì¼“ í• ì°¾ëŠ” ì¤‘ì¸ë° ì¡°ì–¸ ë¶€íƒë“œë¦½ë‹ˆë‹¤',
    'MVP ëŸ°ì¹­ í›„ ì´ˆê¸° ìœ ì € ë°˜ì‘ì´ ë¯¸ë¬˜í•©ë‹ˆë‹¤. í”¼ë´‡ì„ ê³ ë ¤í•´ì•¼ í• ì§€, ì•„ë‹ˆë©´ ë§ˆì¼€íŒ…ì— ë” ì§‘ì¤‘í•´ì•¼ í• ì§€ ê³ ë¯¼ì´ì—ìš”. ë¹„ìŠ·í•œ ê²½í—˜ ìˆìœ¼ì‹  ë¶„ ê³„ì‹ ê°€ìš”?',
    demo_user_id,
    free_board_id,
    'public',
    9,
    3,
    NOW() - INTERVAL '1 day'
  ),
  (
    'B2B SaaS ì´ˆê¸° ê³ ê° í™•ë³´ ì „ëµ ê³µìœ ',
    'ì½œë“œ ì•„ì›ƒë¦¬ì¹˜ë¡œ ì²« 10ê°œ ê³ ê°ì„ í™•ë³´í•œ ê²½í—˜ì„ ê³µìœ í•©ë‹ˆë‹¤. ì´ë©”ì¼ í…œí”Œë¦¿ë¶€í„° í”¼ì¹­ ë…¸í•˜ìš°ê¹Œì§€ ì‹¤ì „ íŒì„ ì •ë¦¬í–ˆì–´ìš”.',
    demo_user_id,
    hightalk_board_id,
    'public',
    31,
    12,
    NOW() - INTERVAL '4 days'
  )
  ON CONFLICT DO NOTHING;

  -- ==========================================
  -- 4. ë”ë¯¸ ëŒ“ê¸€ ìƒì„± (í‹°í‚¤íƒ€ì¹´ ëŠë‚Œ)
  -- ==========================================
  -- ê°€ì¥ ìµœê·¼ ê²Œì‹œê¸€ì— ëŒ“ê¸€ ë‹¬ê¸°
  SELECT id INTO created_post_id 
  FROM posts 
  WHERE board_category_id = request_board_id 
  ORDER BY created_at DESC 
  LIMIT 1;

  IF created_post_id IS NOT NULL THEN
    INSERT INTO comments (post_id, author_id, content, created_at)
    VALUES
    (created_post_id, demo_user_id, 'ì €ë„ ì°¸ì—¬í•˜ê³  ì‹¶ìŠµë‹ˆë‹¤! ì§€ì—­ì´ ì–´ë””ì¸ê°€ìš”?', NOW() - INTERVAL '10 minutes'),
    (created_post_id, demo_user_id, 'ì¢‹ì€ ì˜ê²¬ ê°ì‚¬í•©ë‹ˆë‹¤. DM ë“œë¦´ê²Œìš”.', NOW() - INTERVAL '5 minutes')
    ON CONFLICT DO NOTHING;
  END IF;

  -- ììœ ê²Œì‹œíŒ ê²Œì‹œê¸€ì— ëŒ“ê¸€ ë‹¬ê¸°
  SELECT id INTO created_post_id 
  FROM posts 
  WHERE board_category_id = free_board_id 
  ORDER BY created_at DESC 
  LIMIT 1;

  IF created_post_id IS NOT NULL THEN
    INSERT INTO comments (post_id, author_id, content, created_at)
    VALUES
    (created_post_id, demo_user_id, 'ì €ë„ ë¹„ìŠ·í•œ ê³ ë¯¼ì´ ìˆì—ˆëŠ”ë°, í”¼ë´‡ ì „ì— ìœ ì € ì¸í„°ë·°ë¥¼ ë” ë§ì´ í•´ë³´ì‹œëŠ” ê±¸ ì¶”ì²œë“œë ¤ìš”.', NOW() - INTERVAL '3 hours'),
    (created_post_id, demo_user_id, 'ì¢‹ì€ ê¸€ ê°ì‚¬í•©ë‹ˆë‹¤. ì €ë„ ê°™ì€ ìƒí™©ì´ë¼ ê³µê°ì´ ê°€ë„¤ìš”.', NOW() - INTERVAL '1 hour')
    ON CONFLICT DO NOTHING;
  END IF;

  RAISE NOTICE 'âœ… ë”ë¯¸ ë°ì´í„° ì‹œë”© ì™„ë£Œ (User ID: %)', demo_user_id;
  RAISE NOTICE 'ğŸ’¡ ëŸ°ì¹­ ì „ ì‚­ì œ: DELETE FROM profiles WHERE id = ''%'';', demo_user_id;
END $$;
</file>

<file path="scripts/ALL_MIGRATIONS_README.md">
# SQL ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰ ê°€ì´ë“œ

ì´ ë¬¸ì„œëŠ” Supabaseì—ì„œ ì‹¤í–‰í•´ì•¼ í•˜ëŠ” SQL ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ì— ëŒ€í•œ ê°€ì´ë“œì…ë‹ˆë‹¤.

## ì‹¤í–‰ ìˆœì„œ

### 1. ë§ˆìŠ¤í„° ê´€ë¦¬ì ê¶Œí•œ ì„¤ì • (í•„ìˆ˜)
**íŒŒì¼:** `scripts/015_set_master_admin.sql`

ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” `jaewook@mvmt.city` ê³„ì •ì„ 'master' ê¶Œí•œìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.

```sql
-- profiles í…Œì´ë¸”ì— role ì»¬ëŸ¼ì´ ì—†ìœ¼ë©´ ì¶”ê°€
ALTER TABLE profiles ADD COLUMN IF NOT EXISTS role text DEFAULT 'member' CHECK (role IN ('member', 'admin', 'master'));

-- jaewook@mvmt.city ì´ë©”ì¼ì„ ê°€ì§„ ì‚¬ìš©ìë¥¼ masterë¡œ ì„¤ì •
UPDATE profiles
SET role = 'master'
WHERE email = 'jaewook@mvmt.city';
```

**ì‹¤í–‰ ë°©ë²•:**
1. Supabase ëŒ€ì‹œë³´ë“œ â†’ SQL Editor ì´ë™
2. `015_set_master_admin.sql` íŒŒì¼ì˜ ë‚´ìš© ë³µì‚¬
3. SQL Editorì— ë¶™ì—¬ë„£ê¸°
4. ì‹¤í–‰ ë²„íŠ¼ í´ë¦­

**í™•ì¸:**
```sql
SELECT id, email, full_name, role FROM profiles WHERE email = 'jaewook@mvmt.city';
```
ê²°ê³¼ì—ì„œ `role` ì»¬ëŸ¼ì´ 'master'ë¡œ í‘œì‹œë˜ì–´ì•¼ í•©ë‹ˆë‹¤.

---

### 2. ê²Œì‹œíŒ ê´€ë¦¬ ê¶Œí•œ ì •ì±… (í•„ìˆ˜)
**íŒŒì¼:** `scripts/016_posts_rls_policy.sql`

ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” ê²Œì‹œê¸€ ìˆ˜ì •/ì‚­ì œ ê¶Œí•œ ì •ì±…ì„ ì„¤ì •í•©ë‹ˆë‹¤.
- **ìˆ˜ì •**: ì‘ì„±ìë§Œ ê°€ëŠ¥
- **ì‚­ì œ**: ì‘ì„±ì ë˜ëŠ” ë§ˆìŠ¤í„° ê´€ë¦¬ìë§Œ ê°€ëŠ¥

**ì‹¤í–‰ ë°©ë²•:**
1. SQL Editorì—ì„œ ìƒˆ ì¿¼ë¦¬ ì°½ ì—´ê¸°
2. `016_posts_rls_policy.sql` íŒŒì¼ì˜ ë‚´ìš© ë³µì‚¬
3. ë¶™ì—¬ë„£ê¸° í›„ ì‹¤í–‰

**ì£¼ì˜:** ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” ê¸°ì¡´ ì •ì±…ì„ ì‚­ì œí•˜ê³  ìƒˆë¡œ ìƒì„±í•©ë‹ˆë‹¤.

---

### 3. ê³µê°œ ì½ê¸° ì •ì±… í™•ì¸ ë° ìˆ˜ì • (í•„ìˆ˜)
**íŒŒì¼:** `scripts/017_ensure_public_read_policies.sql`

ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” **ë¡œê·¸ì¸ ì—†ì´ë„** ì´ë²¤íŠ¸ì™€ ê²Œì‹œê¸€ì„ ë³¼ ìˆ˜ ìˆë„ë¡ ê³µê°œ ì½ê¸° ì •ì±…ì„ ì„¤ì •í•©ë‹ˆë‹¤.

**ì¤‘ìš”:** ì´ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ì§€ ì•Šìœ¼ë©´ ë¡œê·¸ì¸ ì—†ì´ ë°ì´í„°ê°€ ë³´ì´ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ì‹¤í–‰ ë°©ë²•:**
1. SQL Editorì—ì„œ ìƒˆ ì¿¼ë¦¬ ì°½ ì—´ê¸°
2. `017_ensure_public_read_policies.sql` íŒŒì¼ì˜ ë‚´ìš© ë³µì‚¬
3. ë¶™ì—¬ë„£ê¸° í›„ ì‹¤í–‰

**ì ìš©ë˜ëŠ” í…Œì´ë¸”:**
- `posts` - ê²Œì‹œê¸€
- `events` - ì´ë²¤íŠ¸
- `board_categories` - ê²Œì‹œíŒ ì¹´í…Œê³ ë¦¬
- `profiles` - í”„ë¡œí•„
- `event_registrations` - ì´ë²¤íŠ¸ ë“±ë¡
- `comments` - ëŒ“ê¸€

**ì •ì±… í™•ì¸:**
ì‹¤í–‰ í›„ ì•„ë˜ ì¿¼ë¦¬ë¡œ ì •ì±…ì´ ì œëŒ€ë¡œ ì„¤ì •ë˜ì—ˆëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```sql
SELECT schemaname, tablename, policyname, permissive, roles, cmd, qual 
FROM pg_policies 
WHERE schemaname = 'public' 
AND tablename IN ('posts', 'events', 'board_categories', 'profiles', 'event_registrations', 'comments')
AND cmd = 'SELECT'
ORDER BY tablename, policyname;
```

---

## ì „ì²´ ë§ˆì´ê·¸ë ˆì´ì…˜ í•œë²ˆì— ì‹¤í–‰ (ê¶Œì¥)

ì„¸ ê°€ì§€ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ìˆœì„œëŒ€ë¡œ ì‹¤í–‰í•˜ë ¤ë©´:

1. `015_set_master_admin.sql` ì‹¤í–‰
2. `016_posts_rls_policy.sql` ì‹¤í–‰
3. `017_ensure_public_read_policies.sql` ì‹¤í–‰

---

## ë¬¸ì œ í•´ê²°

### ì •ì±…ì´ ì´ë¯¸ ì¡´ì¬í•œë‹¤ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí•˜ëŠ” ê²½ìš°
- ìŠ¤í¬ë¦½íŠ¸ì— `DROP POLICY IF EXISTS` ë¬¸ì´ í¬í•¨ë˜ì–´ ìˆìœ¼ë¯€ë¡œ ì•ˆì „í•˜ê²Œ ì‹¤í–‰ ê°€ëŠ¥í•©ë‹ˆë‹¤.
- ê·¸ë˜ë„ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´ ê° ì •ì±…ì„ ìˆ˜ë™ìœ¼ë¡œ ì‚­ì œ í›„ ì¬ì‹¤í–‰í•˜ì„¸ìš”.

### ë§ˆìŠ¤í„° ê¶Œí•œì´ ì ìš©ë˜ì§€ ì•ŠëŠ” ê²½ìš°
1. í•´ë‹¹ ì´ë©”ì¼ë¡œ ê°€ì…í•œ ì‚¬ìš©ìê°€ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸:
   ```sql
   SELECT id, email, full_name FROM profiles WHERE email = 'jaewook@mvmt.city';
   ```
2. ì‚¬ìš©ìê°€ ì¡´ì¬í•œë‹¤ë©´ `role` ì»¬ëŸ¼ì´ ìˆëŠ”ì§€ í™•ì¸:
   ```sql
   SELECT column_name, data_type FROM information_schema.columns 
   WHERE table_name = 'profiles' AND column_name = 'role';
   ```

### ë¡œê·¸ì¸ ì—†ì´ ë°ì´í„°ê°€ ë³´ì´ì§€ ì•ŠëŠ” ê²½ìš°
1. `017_ensure_public_read_policies.sql` ì‹¤í–‰ ì—¬ë¶€ í™•ì¸
2. RLSê°€ í™œì„±í™”ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸:
   ```sql
   SELECT tablename, rowsecurity FROM pg_tables 
   WHERE schemaname = 'public' 
   AND tablename IN ('posts', 'events', 'board_categories');
   ```
3. ê³µê°œ ì½ê¸° ì •ì±…ì´ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸ (ìœ„ì˜ ì •ì±… í™•ì¸ ì¿¼ë¦¬ ì‚¬ìš©)

---

## í™•ì¸ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] `015_set_master_admin.sql` ì‹¤í–‰ ì™„ë£Œ
- [ ] `016_posts_rls_policy.sql` ì‹¤í–‰ ì™„ë£Œ
- [ ] `017_ensure_public_read_policies.sql` ì‹¤í–‰ ì™„ë£Œ
- [ ] ë§ˆìŠ¤í„° ê¶Œí•œ í™•ì¸ ì™„ë£Œ
- [ ] ë¡œê·¸ì¸ ì—†ì´ í˜ì´ì§€ ì ‘ì† í…ŒìŠ¤íŠ¸ ì™„ë£Œ
- [ ] ë¡œê·¸ì¸ ì—†ì´ ë°ì´í„° ì¡°íšŒ í…ŒìŠ¤íŠ¸ ì™„ë£Œ

---

## ì¶”ê°€ ì°¸ê³ ì‚¬í•­

- ëª¨ë“  ìŠ¤í¬ë¦½íŠ¸ëŠ” `IF EXISTS` ë˜ëŠ” `IF NOT EXISTS` ì¡°ê±´ì„ ì‚¬ìš©í•˜ì—¬ ì•ˆì „í•˜ê²Œ ì¬ì‹¤í–‰ ê°€ëŠ¥í•©ë‹ˆë‹¤.
- í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œëŠ” ë°˜ë“œì‹œ ë°±ì—… í›„ ì‹¤í–‰í•˜ì„¸ìš”.
- ê° ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ í›„ ê²°ê³¼ë¥¼ í™•ì¸í•˜ê³  ë‹¤ìŒ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”.
</file>

<file path="scripts/badge_icon_update.sql">
-- ============================================
-- ë±ƒì§€ ì•„ì´ì½˜ ë””ìì¸ ê°œì„ 
-- ============================================
-- ì‹¤í–‰ì¼: 2025-12-06
-- ëª©ì : ë±ƒì§€ ëŠë‚Œì´ ë‚˜ë„ë¡ ì•„ì´ì½˜ ë³€ê²½
-- ì‚¬ìš©ì ì„ íƒ:
--   - íˆ¬ìê·œëª¨: ë©”ë‹¬ ğŸ… (ìµœê³  í‹°ì–´ë§Œ ğŸ’)
--   - ê¸°ì—…ê°€ì¹˜: ë¡œì¼“ ğŸš€ (ìœ ë‹ˆì½˜ë§Œ ğŸ¦„)
--   - ì¸í”Œë£¨ì–¸ì„œ: 100ë§Œ+ â­, 10ë§Œ+ ğŸ’

-- [1] íˆ¬ì ê·œëª¨ (Investment Tier) - ë©”ë‹¬ ë“±ê¸‰ìœ¼ë¡œ ì„¸ë¶„í™”
UPDATE badges SET icon = 'ğŸ¥‰' WHERE name = 'íˆ¬ì 1ì–µ+';        -- ë™ë©”ë‹¬
UPDATE badges SET icon = 'ğŸ¥ˆ' WHERE name = 'íˆ¬ì 5ì–µ+';        -- ì€ë©”ë‹¬  
UPDATE badges SET icon = 'ğŸ¥ˆ' WHERE name = 'íˆ¬ì 10ì–µ+';       -- ì€ë©”ë‹¬
UPDATE badges SET icon = 'ğŸ…' WHERE name = 'íˆ¬ì 30ì–µ+';       -- ë©”ë‹¬
UPDATE badges SET icon = 'ğŸ…' WHERE name = 'íˆ¬ì 50ì–µ+';       -- ë©”ë‹¬
UPDATE badges SET icon = 'ğŸ’' WHERE name = 'íˆ¬ì 100ì–µ+';      -- ë‹¤ì´ì•„ëª¬ë“œ

-- [1-1] ì‹¬ì‚¬ì—­ ë±ƒì§€ (íˆ¬ì ì¹´í…Œê³ ë¦¬ì— ì¡´ì¬í•  ê²½ìš° ì—…ë°ì´íŠ¸)
UPDATE badges SET icon = 'ğŸ“‹' WHERE name LIKE '%ì‹¬ì‚¬ì—­%';      -- í´ë¦½ë³´ë“œ

-- [2] ê¸°ì—… ë§¤ì¶œ (Corporate Revenue / ê¸°ì—…ê°€) - íŠ¸ë¡œí”¼ ê³„ì—´
UPDATE badges SET icon = 'ğŸ†' WHERE name = 'ë§¤ì¶œ 10ì–µ+';       -- íŠ¸ë¡œí”¼
UPDATE badges SET icon = 'ğŸ†' WHERE name = 'ë§¤ì¶œ 50ì–µ+';       -- íŠ¸ë¡œí”¼
UPDATE badges SET icon = 'ğŸ¥‡' WHERE name = 'ë§¤ì¶œ 100ì–µ+';      -- ê¸ˆë©”ë‹¬/ê¸ˆíŠ¸ë¡œí”¼

-- [3] ê¸°ì—…ê°€ì¹˜ (Valuation Tier) - ë¡œì¼“ ğŸš€ (ìœ ë‹ˆì½˜ë§Œ ğŸ¦„)
UPDATE badges SET icon = 'ğŸš€' WHERE category = 'valuation' AND name != 'ìœ ë‹ˆì½˜+';

-- [4] ì¸í”Œë£¨ì–¸ì„œ (Influence Tier) - ì¤‘ë³µ ì œê±°ëœ ìƒˆë¡œìš´ ì•„ì´ì½˜
UPDATE badges SET icon = 'ğŸ“£' WHERE name = 'íŒ”ë¡œì›Œ 1ë§Œ+';      -- í™•ì„±ê¸° (ê¸°ì¡´ ìœ ì§€)
UPDATE badges SET icon = 'ğŸ”¥' WHERE name = 'íŒ”ë¡œì›Œ 5ë§Œ+';      -- ë¶ˆ (ê¸°ì¡´ ìœ ì§€)
UPDATE badges SET icon = 'ğŸ’«' WHERE name = 'íŒ”ë¡œì›Œ 10ë§Œ+';     -- ë°˜ì§ì„ (ê¸°ì¡´ ğŸ’ì—ì„œ ë³€ê²½)
UPDATE badges SET icon = 'âœ¨' WHERE name = 'íŒ”ë¡œì›Œ 20ë§Œ+';     -- ìŠ¤íŒŒí´ (ê¸°ì¡´ ğŸ‘‘ì—ì„œ ë³€ê²½)
UPDATE badges SET icon = 'â­' WHERE name = 'íŒ”ë¡œì›Œ 50ë§Œ+';     -- ë³„ (ê¸°ì¡´ ğŸš€ì—ì„œ ë³€ê²½)
UPDATE badges SET icon = 'ğŸŒŸ' WHERE name = 'íŒ”ë¡œì›Œ 100ë§Œ+';    -- ë¹›ë‚˜ëŠ” ë³„ (ê¸°ì¡´ ğŸŒŒì—ì„œ ë³€ê²½)

-- ============================================
-- ë³€ê²½ ê²°ê³¼ í™•ì¸
-- ============================================
SELECT category, name, icon, description 
FROM badges 
WHERE category IN ('investment', 'valuation', 'influence')
ORDER BY 
  CASE category
    WHEN 'investment' THEN 1
    WHEN 'valuation' THEN 2
    WHEN 'influence' THEN 3
  END,
  name;
</file>

<file path="scripts/community_upgrade.sql">
-- Phase 1: community + comments upgrade
-- ì¤‘ì²© ëŒ“ê¸€ê³¼ ê²Œì‹œê¸€-ì´ë²¤íŠ¸ ì—°ê²°ì„ ê°•í™”í•©ë‹ˆë‹¤.

-- 1) comments í…Œì´ë¸”: parent_id, depth ì¶”ê°€ ë° ì¸ë±ìŠ¤
ALTER TABLE public.comments
ADD COLUMN IF NOT EXISTS parent_id uuid REFERENCES public.comments(id) ON DELETE CASCADE,
ADD COLUMN IF NOT EXISTS depth integer DEFAULT 0;

CREATE INDEX IF NOT EXISTS idx_comments_post_id_parent_id ON public.comments(post_id, parent_id);
CREATE INDEX IF NOT EXISTS idx_comments_path_parent ON public.comments(parent_id);

-- 2) posts í…Œì´ë¸”: ì´ë²¤íŠ¸ ì—°ê³„ ë©”íƒ€ë°ì´í„°
-- related_event_idê°€ ì´ë¯¸ ìˆë‹¤ë©´ ìœ ì§€, ì—†ìœ¼ë©´ ì¶”ê°€
ALTER TABLE public.posts
ADD COLUMN IF NOT EXISTS related_event_id uuid REFERENCES public.events(id) ON DELETE SET NULL,
ADD COLUMN IF NOT EXISTS is_announcement boolean DEFAULT false,
ADD COLUMN IF NOT EXISTS is_event boolean DEFAULT false;

CREATE INDEX IF NOT EXISTS idx_posts_related_event ON public.posts(related_event_id);
</file>

<file path="scripts/fix_questions_rls.sql">
-- ì´ë²¤íŠ¸ ì‹ ì²­ ëª¨ë‹¬ì˜ ì¶”ê°€ ì§ˆë¬¸(ì»¤ìŠ¤í…€ í•„ë“œ) RLS ì •ì±… ìˆ˜ì •
-- ì¼ë°˜ ì‚¬ìš©ìê°€ ì§ˆë¬¸ ëª©ë¡ì„ ì¡°íšŒí•˜ê³  ë‹µë³€ì„ ì €ì¥í•  ìˆ˜ ìˆë„ë¡ ì •ì±… ê°•ì œ ì¬ì„¤ì •

-- ============================================
-- 1. event_registration_fields í…Œì´ë¸” RLS ì •ì±… ì¬ì„¤ì •
-- ============================================

-- ê¸°ì¡´ ì •ì±… ì‚­ì œ (í˜¹ì‹œ ì¶©ëŒì´ ìˆì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ)
DROP POLICY IF EXISTS "Anyone can view event registration fields" ON event_registration_fields;
DROP POLICY IF EXISTS "Event creators can manage fields" ON event_registration_fields;
DROP POLICY IF EXISTS "Public can view event registration fields" ON event_registration_fields;

-- ëˆ„êµ¬ë‚˜(ì¸ì¦/ë¹„ì¸ì¦ ëª¨ë‘) ì¡°íšŒ ê°€ëŠ¥í•˜ë„ë¡ ì •ì±… ê°•ì œ ì¬ìƒì„±
CREATE POLICY "Anyone can view event registration fields" ON event_registration_fields
  FOR SELECT 
  USING (true);

-- ì´ë²¤íŠ¸ ê°œì„¤ìë§Œ í•„ë“œ ìƒì„±/ìˆ˜ì •/ì‚­ì œ ê°€ëŠ¥
CREATE POLICY "Event creators can manage fields" ON event_registration_fields
  FOR ALL 
  USING (
    EXISTS (
      SELECT 1 FROM events 
      WHERE events.id = event_registration_fields.event_id 
      AND events.created_by = auth.uid()
    )
  )
  WITH CHECK (
    EXISTS (
      SELECT 1 FROM events 
      WHERE events.id = event_registration_fields.event_id 
      AND events.created_by = auth.uid()
    )
  );

-- ============================================
-- 2. event_registration_responses í…Œì´ë¸” RLS ì •ì±… ìˆ˜ì •
-- ============================================

-- ê¸°ì¡´ ì •ì±… ì‚­ì œ
DROP POLICY IF EXISTS "Users can view their own responses" ON event_registration_responses;
DROP POLICY IF EXISTS "Event creators can view all responses" ON event_registration_responses;
DROP POLICY IF EXISTS "Registered users can submit responses" ON event_registration_responses;
DROP POLICY IF EXISTS "Anyone can insert responses" ON event_registration_responses;

-- ì¡°íšŒ ì •ì±…: ë³¸ì¸ ì‘ë‹µ ë˜ëŠ” ì´ë²¤íŠ¸ ê°œì„¤ìê°€ ì¡°íšŒ ê°€ëŠ¥
CREATE POLICY "Users can view their own responses" ON event_registration_responses
  FOR SELECT 
  USING (
    -- ë³¸ì¸ ì‘ë‹µ ì¡°íšŒ (ë¡œê·¸ì¸ ì‚¬ìš©ì)
    EXISTS (
      SELECT 1 FROM event_registrations 
      WHERE event_registrations.id = event_registration_responses.registration_id 
      AND event_registrations.user_id = auth.uid()
    )
    OR
    -- ê²ŒìŠ¤íŠ¸ ì‘ë‹µ ì¡°íšŒ (ê²ŒìŠ¤íŠ¸ ë“±ë¡ì˜ ê²½ìš° user_idê°€ NULLì´ë¯€ë¡œ ì´ë²¤íŠ¸ ê°œì„¤ìë§Œ ì¡°íšŒ ê°€ëŠ¥)
    (
      EXISTS (
        SELECT 1 FROM event_registrations
        JOIN events ON events.id = event_registrations.event_id
        WHERE event_registrations.id = event_registration_responses.registration_id 
        AND event_registrations.user_id IS NULL
        AND events.created_by = auth.uid()
      )
    )
  );

-- ì´ë²¤íŠ¸ ê°œì„¤ìê°€ ëª¨ë“  ì‘ë‹µ ì¡°íšŒ ê°€ëŠ¥
CREATE POLICY "Event creators can view all responses" ON event_registration_responses
  FOR SELECT 
  USING (
    EXISTS (
      SELECT 1 FROM event_registrations
      JOIN events ON events.id = event_registrations.event_id
      WHERE event_registrations.id = event_registration_responses.registration_id 
      AND events.created_by = auth.uid()
    )
  );

-- INSERT ì •ì±…: ëˆ„êµ¬ë‚˜ ë‹µë³€ì„ ì €ì¥í•  ìˆ˜ ìˆë„ë¡ ìˆ˜ì • (ê²ŒìŠ¤íŠ¸ ë“±ë¡ í¬í•¨)
CREATE POLICY "Anyone can insert responses" ON event_registration_responses
  FOR INSERT 
  WITH CHECK (
    -- ë“±ë¡ ì •ë³´ê°€ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
    EXISTS (
      SELECT 1 FROM event_registrations 
      WHERE event_registrations.id = event_registration_responses.registration_id
    )
    AND
    -- í•„ë“œê°€ í•´ë‹¹ ì´ë²¤íŠ¸ì— ì†í•˜ëŠ”ì§€ í™•ì¸
    EXISTS (
      SELECT 1 FROM event_registration_fields
      JOIN event_registrations ON event_registrations.event_id = event_registration_fields.event_id
      WHERE event_registration_fields.id = event_registration_responses.field_id
      AND event_registrations.id = event_registration_responses.registration_id
    )
  );

-- ============================================
-- 3. í…ŒìŠ¤íŠ¸ìš© ì˜ˆì‹œ ì§ˆë¬¸ ë°ì´í„° ì¶”ê°€
-- ============================================

-- ê°€ì¥ ìµœì‹  ì´ë²¤íŠ¸ í•˜ë‚˜ì— ì˜ˆì‹œ ì§ˆë¬¸ ì¶”ê°€
DO $$
DECLARE
  latest_event_id UUID;
  question1_id UUID;
  question2_id UUID;
BEGIN
  -- ê°€ì¥ ìµœì‹  ì´ë²¤íŠ¸ ID ê°€ì ¸ì˜¤ê¸°
  SELECT id INTO latest_event_id
  FROM events
  ORDER BY created_at DESC
  LIMIT 1;

  -- ì´ë²¤íŠ¸ê°€ ì¡´ì¬í•˜ëŠ” ê²½ìš°ì—ë§Œ ì§ˆë¬¸ ì¶”ê°€
  IF latest_event_id IS NOT NULL THEN
    -- ê¸°ì¡´ ì§ˆë¬¸ì´ ìˆëŠ”ì§€ í™•ì¸ (ì¤‘ë³µ ë°©ì§€)
    IF NOT EXISTS (
      SELECT 1 FROM event_registration_fields 
      WHERE event_id = latest_event_id 
      AND field_name = 'ì°¸ê°€ ë™ê¸°'
    ) THEN
      -- ì§ˆë¬¸ 1: ì°¸ê°€ ë™ê¸° (í…ìŠ¤íŠ¸ ì…ë ¥)
      INSERT INTO event_registration_fields (
        event_id,
        field_name,
        field_type,
        field_options,
        is_required,
        order_index
      ) VALUES (
        latest_event_id,
        'ì°¸ê°€ ë™ê¸°',
        'text',
        NULL,
        false,
        1
      ) RETURNING id INTO question1_id;
    END IF;

    -- ê¸°ì¡´ ì§ˆë¬¸ì´ ìˆëŠ”ì§€ í™•ì¸ (ì¤‘ë³µ ë°©ì§€)
    IF NOT EXISTS (
      SELECT 1 FROM event_registration_fields 
      WHERE event_id = latest_event_id 
      AND field_name = 'í‹°ì…”ì¸  ì‚¬ì´ì¦ˆ'
    ) THEN
      -- ì§ˆë¬¸ 2: í‹°ì…”ì¸  ì‚¬ì´ì¦ˆ (ê°ê´€ì‹ ì„ íƒ)
      INSERT INTO event_registration_fields (
        event_id,
        field_name,
        field_type,
        field_options,
        is_required,
        order_index
      ) VALUES (
        latest_event_id,
        'í‹°ì…”ì¸  ì‚¬ì´ì¦ˆ',
        'select',
        '["XS", "S", "M", "L", "XL", "XXL"]'::jsonb,
        false,
        2
      ) RETURNING id INTO question2_id;
    END IF;

    RAISE NOTICE 'í…ŒìŠ¤íŠ¸ ì§ˆë¬¸ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ë²¤íŠ¸ ID: %', latest_event_id;
  ELSE
    RAISE NOTICE 'ë“±ë¡ëœ ì´ë²¤íŠ¸ê°€ ì—†ì–´ í…ŒìŠ¤íŠ¸ ì§ˆë¬¸ì„ ì¶”ê°€í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
  END IF;
END $$;

-- ============================================
-- 4. ì •ì±… ì ìš© í™•ì¸ ì¿¼ë¦¬ (ì°¸ê³ ìš©)
-- ============================================

-- ì •ì±…ì´ ì œëŒ€ë¡œ ì ìš©ë˜ì—ˆëŠ”ì§€ í™•ì¸
SELECT 
  schemaname,
  tablename,
  policyname,
  permissive,
  roles,
  cmd,
  qual,
  with_check
FROM pg_policies
WHERE tablename IN ('event_registration_fields', 'event_registration_responses')
ORDER BY tablename, policyname;
</file>

<file path="scripts/optimize_performance.sql">
-- ì„±ëŠ¥ ìµœì í™”: ë°ì´í„°ë² ì´ìŠ¤ ì¸ë±ìŠ¤ ì¶”ê°€
-- ìì£¼ ì¡°íšŒë˜ëŠ” ì»¬ëŸ¼ë“¤ì— ì¸ë±ìŠ¤ë¥¼ ì¶”ê°€í•˜ì—¬ ê²€ìƒ‰ ì†ë„ë¥¼ íšê¸°ì ìœ¼ë¡œ í–¥ìƒì‹œí‚µë‹ˆë‹¤.

-- ============================================
-- 1. posts í…Œì´ë¸” ì¸ë±ìŠ¤
-- ============================================

-- created_at ì¸ë±ìŠ¤ (ë‚ ì§œìˆœ ì •ë ¬ ìµœì í™”)
CREATE INDEX IF NOT EXISTS idx_posts_created_at 
ON posts(created_at DESC);

-- board_category_id ì¸ë±ìŠ¤ (ì¹´í…Œê³ ë¦¬ë³„ í•„í„°ë§ ìµœì í™”)
CREATE INDEX IF NOT EXISTS idx_posts_board_category_id 
ON posts(board_category_id)
WHERE board_category_id IS NOT NULL;

-- author_id ì¸ë±ìŠ¤ (ì‘ì„±ìë³„ ì¡°íšŒ ìµœì í™”)
CREATE INDEX IF NOT EXISTS idx_posts_author_id 
ON posts(author_id);

-- visibility ì¸ë±ìŠ¤ (ê³µê°œ/ë¹„ê³µê°œ í•„í„°ë§ ìµœì í™”)
CREATE INDEX IF NOT EXISTS idx_posts_visibility 
ON posts(visibility)
WHERE visibility IS NOT NULL;

-- ë³µí•© ì¸ë±ìŠ¤: ì¹´í…Œê³ ë¦¬ + ë‚ ì§œ (ìì£¼ í•¨ê»˜ ì‚¬ìš©ë˜ëŠ” ì¿¼ë¦¬ ìµœì í™”)
CREATE INDEX IF NOT EXISTS idx_posts_category_created_at 
ON posts(board_category_id, created_at DESC)
WHERE board_category_id IS NOT NULL;

-- ============================================
-- 2. events í…Œì´ë¸” ì¸ë±ìŠ¤
-- ============================================

-- event_date ì¸ë±ìŠ¤ (ë‚ ì§œìˆœ ì •ë ¬ ë° í•„í„°ë§ ìµœì í™”)
CREATE INDEX IF NOT EXISTS idx_events_event_date 
ON events(event_date);

-- created_by ì¸ë±ìŠ¤ (ì´ë²¤íŠ¸ ê°œì„¤ìë³„ ì¡°íšŒ ìµœì í™”)
CREATE INDEX IF NOT EXISTS idx_events_created_by 
ON events(created_by);

-- ë³µí•© ì¸ë±ìŠ¤: ë‚ ì§œ + ìƒíƒœ (ì˜ˆì •ëœ ì´ë²¤íŠ¸ ì¡°íšŒ ìµœì í™”)
CREATE INDEX IF NOT EXISTS idx_events_date_status 
ON events(event_date, status)
WHERE status = 'upcoming';

-- ============================================
-- 3. event_registrations í…Œì´ë¸” ì¸ë±ìŠ¤
-- ============================================

-- event_id ì¸ë±ìŠ¤ (ì´ë²¤íŠ¸ë³„ ë“±ë¡ì ì¡°íšŒ ìµœì í™”)
CREATE INDEX IF NOT EXISTS idx_event_registrations_event_id 
ON event_registrations(event_id);

-- user_id ì¸ë±ìŠ¤ (ì‚¬ìš©ìë³„ ë“±ë¡ ì´ë²¤íŠ¸ ì¡°íšŒ ìµœì í™”)
CREATE INDEX IF NOT EXISTS idx_event_registrations_user_id 
ON event_registrations(user_id)
WHERE user_id IS NOT NULL;

-- ë³µí•© ì¸ë±ìŠ¤: event_id + user_id (ì¤‘ë³µ ì²´í¬ ìµœì í™”)
-- UNIQUE ì œì•½ì¡°ê±´ì´ ì´ë¯¸ ìˆì§€ë§Œ, ì¡°íšŒ ì„±ëŠ¥ í–¥ìƒì„ ìœ„í•´ ì¶”ê°€
CREATE INDEX IF NOT EXISTS idx_event_registrations_event_user 
ON event_registrations(event_id, user_id)
WHERE user_id IS NOT NULL;

-- ============================================
-- 4. board_categories í…Œì´ë¸” ì¸ë±ìŠ¤
-- ============================================

-- slug ì¸ë±ìŠ¤ (ìŠ¬ëŸ¬ê·¸ë¡œ ì¹´í…Œê³ ë¦¬ ì¡°íšŒ ìµœì í™”)
-- UNIQUE ì œì•½ì¡°ê±´ì´ ì´ë¯¸ ìˆì§€ë§Œ, ëª…ì‹œì ìœ¼ë¡œ ì¸ë±ìŠ¤ ì¶”ê°€
CREATE INDEX IF NOT EXISTS idx_board_categories_slug 
ON board_categories(slug);

-- is_active + order_index ë³µí•© ì¸ë±ìŠ¤ (í™œì„± ì¹´í…Œê³ ë¦¬ ì •ë ¬ ìµœì í™”)
CREATE INDEX IF NOT EXISTS idx_board_categories_active_order 
ON board_categories(is_active, order_index)
WHERE is_active = true;

-- ============================================
-- 5. ì¶”ê°€ ì„±ëŠ¥ ìµœì í™” ì¸ë±ìŠ¤
-- ============================================

-- comments í…Œì´ë¸”: post_id ì¸ë±ìŠ¤ (ê²Œì‹œê¸€ë³„ ëŒ“ê¸€ ì¡°íšŒ ìµœì í™”)
CREATE INDEX IF NOT EXISTS idx_comments_post_id 
ON comments(post_id);

-- comments í…Œì´ë¸”: created_at ì¸ë±ìŠ¤ (ìµœì‹  ëŒ“ê¸€ ì¡°íšŒ ìµœì í™”)
CREATE INDEX IF NOT EXISTS idx_comments_created_at 
ON comments(created_at DESC);

-- post_likes í…Œì´ë¸”: post_id ì¸ë±ìŠ¤ (ê²Œì‹œê¸€ë³„ ì¢‹ì•„ìš” ì¡°íšŒ ìµœì í™”)
CREATE INDEX IF NOT EXISTS idx_post_likes_post_id 
ON post_likes(post_id);

-- post_likes í…Œì´ë¸”: user_id ì¸ë±ìŠ¤ (ì‚¬ìš©ìë³„ ì¢‹ì•„ìš” ì¡°íšŒ ìµœì í™”)
CREATE INDEX IF NOT EXISTS idx_post_likes_user_id 
ON post_likes(user_id);

-- ë³µí•© ì¸ë±ìŠ¤: post_id + user_id (ì¢‹ì•„ìš” ì¤‘ë³µ ì²´í¬ ìµœì í™”)
CREATE INDEX IF NOT EXISTS idx_post_likes_post_user 
ON post_likes(post_id, user_id);

-- ============================================
-- 6. user_badges í…Œì´ë¸” ì¸ë±ìŠ¤
-- ============================================

-- user_id ì¸ë±ìŠ¤ (ì‚¬ìš©ìë³„ ë±ƒì§€ ì¡°íšŒ ìµœì í™”)
CREATE INDEX IF NOT EXISTS idx_user_badges_user_id 
ON user_badges(user_id);

-- is_visible ì¸ë±ìŠ¤ (ë…¸ì¶œ ë±ƒì§€ í•„í„°ë§ ìµœì í™”)
CREATE INDEX IF NOT EXISTS idx_user_badges_is_visible 
ON user_badges(is_visible)
WHERE is_visible = true;

-- ë³µí•© ì¸ë±ìŠ¤: user_id + is_visible (ì‚¬ìš©ìë³„ ë…¸ì¶œ ë±ƒì§€ ì¡°íšŒ ìµœì í™”)
CREATE INDEX IF NOT EXISTS idx_user_badges_user_visible 
ON user_badges(user_id, is_visible)
WHERE is_visible = true;

-- ============================================
-- 7. ì¸ë±ìŠ¤ ìƒì„± í™•ì¸ ì¿¼ë¦¬ (ì°¸ê³ ìš©)
-- ============================================

-- ìƒì„±ëœ ì¸ë±ìŠ¤ ëª©ë¡ í™•ì¸
SELECT 
  schemaname,
  tablename,
  indexname,
  indexdef
FROM pg_indexes
WHERE schemaname = 'public'
  AND tablename IN ('posts', 'events', 'event_registrations', 'board_categories', 'comments', 'post_likes', 'user_badges')
ORDER BY tablename, indexname;
</file>

<file path="scripts/reload_schema.sql">
-- ìŠ¤í‚¤ë§ˆ ìºì‹œ ê°±ì‹ ì„ ìœ„í•œ SQL
-- PostgRESTì—ê²Œ ìŠ¤í‚¤ë§ˆë¥¼ ë‹¤ì‹œ ë¡œë“œí•˜ë„ë¡ ì•Œë¦¼
NOTIFY pgrst, 'reload schema';

-- í˜¹ì‹œ ëª¨ë¥¼ ì»¬ëŸ¼ ëˆ„ë½ ë°©ì§€ë¥¼ ìœ„í•´ ë‹¤ì‹œ í•œ ë²ˆ ì»¬ëŸ¼ ì¶”ê°€ ì‹œë„ (IF NOT EXISTS)
ALTER TABLE public.profiles 
ADD COLUMN IF NOT EXISTS linkedin_url TEXT,
ADD COLUMN IF NOT EXISTS instagram_url TEXT,
ADD COLUMN IF NOT EXISTS threads_url TEXT,
ADD COLUMN IF NOT EXISTS website_url TEXT;
</file>

<file path="scripts/test-helper.sh">
#!/bin/bash

# Seoul Founders Club - í…ŒìŠ¤íŠ¸ í—¬í¼ ìŠ¤í¬ë¦½íŠ¸

echo "========================================="
echo "Seoul Founders Club - í…ŒìŠ¤íŠ¸ í™˜ê²½ ì‹œì‘"
echo "========================================="
echo ""

# 1. ê°œë°œ ì„œë²„ ì‹œì‘
echo "âœ“ ê°œë°œ ì„œë²„ ì‹œì‘ ì¤‘..."
npm run dev &
DEV_PID=$!

# 2. ì„œë²„ê°€ ì¤€ë¹„ë  ë•Œê¹Œì§€ ëŒ€ê¸°
echo "âœ“ ì„œë²„ ì¤€ë¹„ ì¤‘..."
sleep 5

# 3. ë¸Œë¼ìš°ì €ì—ì„œ í…ŒìŠ¤íŠ¸í•  ì£¼ìš” URLë“¤
echo ""
echo "========================================="
echo "ì£¼ìš” í…ŒìŠ¤íŠ¸ URL:"
echo "========================================="
echo ""
echo "ğŸ  í™ˆí˜ì´ì§€:"
echo "   http://localhost:3000"
echo ""
echo "ğŸ‘¤ ì¸ì¦:"
echo "   http://localhost:3000/auth/login"
echo "   http://localhost:3000/auth/sign-up"
echo ""
echo "ğŸ‘¥ í”„ë¡œí•„ & ë©¤ë²„:"
echo "   http://localhost:3000/community/profile"
echo "   http://localhost:3000/member"
echo ""
echo "ğŸ’¬ ì»¤ë®¤ë‹ˆí‹°:"
echo "   http://localhost:3000/community"
echo "   http://localhost:3000/community/board/vangol"
echo "   http://localhost:3000/community/board/hightalk"
echo "   http://localhost:3000/community/board/free"
echo "   http://localhost:3000/community/board/announcements"
echo ""
echo "ğŸ“… ì´ë²¤íŠ¸:"
echo "   http://localhost:3000/events"
echo ""
echo "â„¹ï¸ ì†Œê°œ:"
echo "   http://localhost:3000/about"
echo ""
echo "ğŸ”§ ê´€ë¦¬ì:"
echo "   http://localhost:3000/admin"
echo ""
echo "========================================="
echo ""
echo "âœ“ Ctrl+Cë¥¼ ëˆŒëŸ¬ ì„œë²„ë¥¼ ì¢…ë£Œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤"
echo ""

# 4. Ctrl+C ì²˜ë¦¬
trap "echo ''; echo 'ì„œë²„ ì¢…ë£Œ ì¤‘...'; kill $DEV_PID; exit" INT

# ì„œë²„ ìœ ì§€
wait $DEV_PID
</file>

<file path="SERVICE_ROLE_KEY_SETUP.md">
# SUPABASE_SERVICE_ROLE_KEY ì„¤ì • ê°€ì´ë“œ

## ë¬¸ì œ
ë±ƒì§€ ì¹´í…Œê³ ë¦¬ ì´ë¦„ ìˆ˜ì • ì‹œ ë‹¤ìŒê³¼ ê°™ì€ ì—ëŸ¬ê°€ ë°œìƒ:
```
SUPABASE_SERVICE_ROLE_KEY is not set. Please add it to your environment variables.
```

## í•´ê²° ë°©ë²•

### 1ë‹¨ê³„: Supabaseì—ì„œ Service Role Key í™•ì¸

**âš ï¸ ì£¼ì˜: Service Role KeyëŠ” ê´€ë¦¬ì ê¶Œí•œì„ ê°€ì§„ í‚¤ì…ë‹ˆë‹¤. ì ˆëŒ€ ê³µê°œí•˜ê±°ë‚˜ í´ë¼ì´ì–¸íŠ¸ ì½”ë“œì— í¬í•¨í•˜ì§€ ë§ˆì„¸ìš”!**

1. **Supabase Dashboard ì ‘ì†**
   - https://supabase.com/dashboard
   - í”„ë¡œì íŠ¸ ì„ íƒ

2. **Settings â†’ API ì´ë™**

3. **Service Role Key ë³µì‚¬**
   - "Project API keys" ì„¹ì…˜ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤
   - **service_role** í‚¤ (anon í‚¤ê°€ ì•„ë‹™ë‹ˆë‹¤!)
   - "Reveal" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì „ì²´ í‚¤ í™•ì¸
   - ë§¤ìš° ê¸´ JWT í† í° í˜•íƒœì˜ ë¬¸ìì—´ì…ë‹ˆë‹¤
   - **âš ï¸ ì´ í‚¤ëŠ” í•œ ë²ˆë§Œ í‘œì‹œë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì•ˆì „í•˜ê²Œ ë³µì‚¬í•˜ì„¸ìš”**

### 2ë‹¨ê³„: ë¡œì»¬ í™˜ê²½ ë³€ìˆ˜ íŒŒì¼ì— ì¶”ê°€

1. **í”„ë¡œì íŠ¸ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì˜ `.env.local` íŒŒì¼ ì—´ê¸°**
   - íŒŒì¼ì´ ì—†ë‹¤ë©´ ìƒì„±í•˜ì„¸ìš”

2. **ë‹¤ìŒ ì¤„ ì¶”ê°€ (ê¸°ì¡´ ë‚´ìš© ì•„ë˜ì—)**
   ```env
   SUPABASE_SERVICE_ROLE_KEY=ì—¬ê¸°ì—_ë³µì‚¬í•œ_service_role_í‚¤_ë¶™ì—¬ë„£ê¸°
   ```

   ì˜ˆì‹œ:
   ```env
   NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
   NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key-here
   SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... (ë§¤ìš° ê¸´ ë¬¸ìì—´)
   ```

3. **íŒŒì¼ ì €ì¥**

### 3ë‹¨ê³„: ê°œë°œ ì„œë²„ ì¬ì‹œì‘

í™˜ê²½ ë³€ìˆ˜ íŒŒì¼ì„ ìˆ˜ì •í•œ í›„ì—ëŠ” ê°œë°œ ì„œë²„ë¥¼ ì¬ì‹œì‘í•´ì•¼ í•©ë‹ˆë‹¤:

```bash
# í˜„ì¬ ì‹¤í–‰ ì¤‘ì¸ ê°œë°œ ì„œë²„ ì¤‘ì§€ (Ctrl+C)
# ê·¸ ë‹¤ìŒ ë‹¤ì‹œ ì‹œì‘
npm run dev
```

### 4ë‹¨ê³„: í™•ì¸

1. ê°œë°œ ì„œë²„ê°€ ì •ìƒì ìœ¼ë¡œ ì‹œì‘ë˜ëŠ”ì§€ í™•ì¸
2. ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ ë±ƒì§€ ì¹´í…Œê³ ë¦¬ ì´ë¦„ ìˆ˜ì •ì„ ë‹¤ì‹œ ì‹œë„
3. ì—ëŸ¬ê°€ ë°œìƒí•˜ì§€ ì•Šìœ¼ë©´ ì„±ê³µ!

## ì£¼ì˜ì‚¬í•­

- âœ… **ì„œë²„ ì‚¬ì´ë“œì—ì„œë§Œ ì‚¬ìš©**: Service Role KeyëŠ” ì„œë²„ ì‚¬ì´ë“œ(Server Actions, API Routes)ì—ì„œë§Œ ì‚¬ìš©ë©ë‹ˆë‹¤
- âœ… **ë¡œì»¬ ê°œë°œìš©**: ë¡œì»¬ ê°œë°œ í™˜ê²½ì—ì„œë§Œ ì‚¬ìš©í•˜ê³ , Gitì— ì»¤ë°‹í•˜ì§€ ë§ˆì„¸ìš”
- âœ… **`.env.local` íŒŒì¼**: ì´ íŒŒì¼ì€ `.gitignore`ì— í¬í•¨ë˜ì–´ ìˆì–´ Gitì— ì»¤ë°‹ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤
- âŒ **ì ˆëŒ€ ê³µê°œí•˜ì§€ ë§ˆì„¸ìš”**: ì´ í‚¤ëŠ” RLS ì •ì±…ì„ ìš°íšŒí•˜ì—¬ ëª¨ë“  ë°ì´í„°ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
- âŒ **í´ë¼ì´ì–¸íŠ¸ ì½”ë“œì— í¬í•¨ ê¸ˆì§€**: `NEXT_PUBLIC_` ì ‘ë‘ì‚¬ê°€ ì—†ìœ¼ë¯€ë¡œ í´ë¼ì´ì–¸íŠ¸ì— ë…¸ì¶œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤

## ë°°í¬ í™˜ê²½ (Vercel) ì„¤ì •

ë¡œì»¬ì—ì„œëŠ” `.env.local` íŒŒì¼ì— ì¶”ê°€í•˜ë©´ ë˜ì§€ë§Œ, ë°°í¬ í™˜ê²½ì—ì„œëŠ” Vercel í™˜ê²½ ë³€ìˆ˜ë¡œ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤:

1. **Vercel Dashboard ì ‘ì†**
   - https://vercel.com/dashboard
   - í”„ë¡œì íŠ¸ ì„ íƒ

2. **Settings â†’ Environment Variables**

3. **ìƒˆ í™˜ê²½ ë³€ìˆ˜ ì¶”ê°€**
   - Key: `SUPABASE_SERVICE_ROLE_KEY`
   - Value: Supabaseì—ì„œ ë³µì‚¬í•œ service_role í‚¤
   - Environment: âœ… Production, âœ… Preview, âœ… Development ëª¨ë‘ ì„ íƒ (ë˜ëŠ” í•„ìš”í•œ í™˜ê²½ë§Œ)
   - Save í´ë¦­

4. **ì¬ë°°í¬**
   - í™˜ê²½ ë³€ìˆ˜ ì¶”ê°€ í›„ ìë™ìœ¼ë¡œ ì¬ë°°í¬ë˜ê±°ë‚˜
   - ìˆ˜ë™ìœ¼ë¡œ Deployments â†’ "..." â†’ "Redeploy" ì„ íƒ

## ê´€ë ¨ íŒŒì¼

- `lib/supabase/admin.ts` - Service Role Keyë¥¼ ì‚¬ìš©í•˜ëŠ” ê´€ë¦¬ì í´ë¼ì´ì–¸íŠ¸
- `lib/actions/badge-categories.ts` - ë±ƒì§€ ì¹´í…Œê³ ë¦¬ ê´€ë¦¬ ì•¡ì…˜ (ê´€ë¦¬ì ê¶Œí•œ í•„ìš”)
</file>

<file path="styles/globals.css">
@import 'tailwindcss';
@import 'tw-animate-css';

@custom-variant dark (&:is(.dark *));

:root {
  --background: oklch(1 0 0);
  --foreground: oklch(0.145 0 0);
  --card: oklch(1 0 0);
  --card-foreground: oklch(0.145 0 0);
  --popover: oklch(1 0 0);
  --popover-foreground: oklch(0.145 0 0);
  --primary: oklch(0.205 0 0);
  --primary-foreground: oklch(0.985 0 0);
  --secondary: oklch(0.97 0 0);
  --secondary-foreground: oklch(0.205 0 0);
  --muted: oklch(0.97 0 0);
  --muted-foreground: oklch(0.556 0 0);
  --accent: oklch(0.97 0 0);
  --accent-foreground: oklch(0.205 0 0);
  --destructive: oklch(0.577 0.245 27.325);
  --destructive-foreground: oklch(0.577 0.245 27.325);
  --border: oklch(0.922 0 0);
  --input: oklch(0.922 0 0);
  --ring: oklch(0.708 0 0);
  --chart-1: oklch(0.646 0.222 41.116);
  --chart-2: oklch(0.6 0.118 184.704);
  --chart-3: oklch(0.398 0.07 227.392);
  --chart-4: oklch(0.828 0.189 84.429);
  --chart-5: oklch(0.769 0.188 70.08);
  --radius: 0.625rem;
  --sidebar: oklch(0.985 0 0);
  --sidebar-foreground: oklch(0.145 0 0);
  --sidebar-primary: oklch(0.205 0 0);
  --sidebar-primary-foreground: oklch(0.985 0 0);
  --sidebar-accent: oklch(0.97 0 0);
  --sidebar-accent-foreground: oklch(0.205 0 0);
  --sidebar-border: oklch(0.922 0 0);
  --sidebar-ring: oklch(0.708 0 0);
}

.dark {
  --background: oklch(0.145 0 0);
  --foreground: oklch(0.985 0 0);
  --card: oklch(0.145 0 0);
  --card-foreground: oklch(0.985 0 0);
  --popover: oklch(0.145 0 0);
  --popover-foreground: oklch(0.985 0 0);
  --primary: oklch(0.985 0 0);
  --primary-foreground: oklch(0.205 0 0);
  --secondary: oklch(0.269 0 0);
  --secondary-foreground: oklch(0.985 0 0);
  --muted: oklch(0.269 0 0);
  --muted-foreground: oklch(0.708 0 0);
  --accent: oklch(0.269 0 0);
  --accent-foreground: oklch(0.985 0 0);
  --destructive: oklch(0.396 0.141 25.723);
  --destructive-foreground: oklch(0.637 0.237 25.331);
  --border: oklch(0.269 0 0);
  --input: oklch(0.269 0 0);
  --ring: oklch(0.439 0 0);
  --chart-1: oklch(0.488 0.243 264.376);
  --chart-2: oklch(0.696 0.17 162.48);
  --chart-3: oklch(0.769 0.188 70.08);
  --chart-4: oklch(0.627 0.265 303.9);
  --chart-5: oklch(0.645 0.246 16.439);
  --sidebar: oklch(0.205 0 0);
  --sidebar-foreground: oklch(0.985 0 0);
  --sidebar-primary: oklch(0.488 0.243 264.376);
  --sidebar-primary-foreground: oklch(0.985 0 0);
  --sidebar-accent: oklch(0.269 0 0);
  --sidebar-accent-foreground: oklch(0.985 0 0);
  --sidebar-border: oklch(0.269 0 0);
  --sidebar-ring: oklch(0.439 0 0);
}

@theme inline {
  --font-sans: 'Geist', 'Geist Fallback';
  --font-mono: 'Geist Mono', 'Geist Mono Fallback';
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --color-card: var(--card);
  --color-card-foreground: var(--card-foreground);
  --color-popover: var(--popover);
  --color-popover-foreground: var(--popover-foreground);
  --color-primary: var(--primary);
  --color-primary-foreground: var(--primary-foreground);
  --color-secondary: var(--secondary);
  --color-secondary-foreground: var(--secondary-foreground);
  --color-muted: var(--muted);
  --color-muted-foreground: var(--muted-foreground);
  --color-accent: var(--accent);
  --color-accent-foreground: var(--accent-foreground);
  --color-destructive: var(--destructive);
  --color-destructive-foreground: var(--destructive-foreground);
  --color-border: var(--border);
  --color-input: var(--input);
  --color-ring: var(--ring);
  --color-chart-1: var(--chart-1);
  --color-chart-2: var(--chart-2);
  --color-chart-3: var(--chart-3);
  --color-chart-4: var(--chart-4);
  --color-chart-5: var(--chart-5);
  --radius-sm: calc(var(--radius) - 4px);
  --radius-md: calc(var(--radius) - 2px);
  --radius-lg: var(--radius);
  --radius-xl: calc(var(--radius) + 4px);
  --color-sidebar: var(--sidebar);
  --color-sidebar-foreground: var(--sidebar-foreground);
  --color-sidebar-primary: var(--sidebar-primary);
  --color-sidebar-primary-foreground: var(--sidebar-primary-foreground);
  --color-sidebar-accent: var(--sidebar-accent);
  --color-sidebar-accent-foreground: var(--sidebar-accent-foreground);
  --color-sidebar-border: var(--sidebar-border);
  --color-sidebar-ring: var(--sidebar-ring);
}

@layer base {
  * {
    @apply border-border outline-ring/50;
  }
  body {
    @apply bg-background text-foreground;
  }
}
</file>

<file path="TEST_RESULTS.md">
# Seoul Founders Club - ìë™ í…ŒìŠ¤íŠ¸ ê²°ê³¼

**í…ŒìŠ¤íŠ¸ ì¼ì‹œ**: 2025ë…„ 12ì›” 2ì¼  
**í…ŒìŠ¤íŠ¸ í™˜ê²½**: http://localhost:3000

---

## âœ… í…ŒìŠ¤íŠ¸ ì™„ë£Œ í•­ëª©

### 1. í™ˆí˜ì´ì§€ (`/`)
**ìƒíƒœ**: âœ… ì •ìƒ

**í™•ì¸ëœ ì‚¬í•­**:
- âœ… í˜ì´ì§€ ë¡œë“œ ì„±ê³µ
- âœ… Hero ì„¹ì…˜ í‘œì‹œ ("ìƒˆë¡œìš´ ê°€ì¹˜ë¥¼ ë§Œë“œëŠ” ì‚¬ëŒë“¤ì˜ ë² ì´ìŠ¤ìº í”„")
- âœ… "3ì´ˆë§Œì— ê°€ì…í•˜ê¸°" ë²„íŠ¼ í‘œì‹œ
- âœ… ì´ë²¤íŠ¸ ì„¹ì…˜ í‘œì‹œ
  - ì „ì²´/ë„¤íŠ¸ì›Œí‚¹/í´ë˜ìŠ¤/ì•¡í‹°ë¹„í‹° íƒ­ í•„í„°
  - ì´ë²¤íŠ¸ ì¹´ë“œ (ì¸ë„¤ì¼, ì œëª©, ë‚ ì§œ, ì¥ì†Œ, ì°¸ê°€ì ìˆ˜)
- âœ… ì‚¬ì´ë“œë°” í‘œì‹œ
  - ë¡œê³ 
  - ë„¤ë¹„ê²Œì´ì…˜ ë©”ë‰´ (í™ˆ, ì†Œê°œ, ì„±ì¥, ê²Œì‹œíŒ, ì»¤ë®¤ë‹ˆí‹°, ê³ ê°ì„¼í„°)
  - ë¡œê·¸ì¸ ë²„íŠ¼
- âœ… ëª¨ë°”ì¼ í—¤ë” í‘œì‹œ (ì•Œë¦¼ ì•„ì´ì½˜, í–„ë²„ê±° ë©”ë‰´)
- âœ… í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ë°” (ëª¨ë°”ì¼)
- âœ… ìš°ì¸¡ ì‚¬ì´ë“œë°” (ê³µì§€ì‚¬í•­)

**ìŠ¤í¬ë¦°ìƒ·**: `home-page.png` ì €ì¥ë¨

---

### 2. ë©¤ë²„ ë¦¬ìŠ¤íŠ¸ (`/member`)
**ìƒíƒœ**: âœ… ì •ìƒ

**í™•ì¸ëœ ì‚¬í•­**:
- âœ… í˜ì´ì§€ ë¡œë“œ ì„±ê³µ
- âœ… ë°°ë„ˆ í‘œì‹œ ("ë©¤ë²„" / "ê°ìì˜ ì˜ì—­ì—ì„œ ì„±ê³¼ë¥¼ ì¦ëª…í•œ, ê²€ì¦ëœ ë©¤ë²„ë“¤ì„ ë§Œë‚˜ë³´ì„¸ìš”")
- âœ… ë©¤ë²„ ì¹´ë“œ í‘œì‹œ
  - í”„ë¡œí•„ ì‚¬ì§„
  - ì´ë¦„ ("AíšŒì‚¬ | ëŒ€í‘œ" / "ì •ëŒ€í‘œ")
  - ì†Œê°œê¸€ ("ë©€ì©¡ í”„ë¡œí•„ í…ŒìŠ¤íŠ¸ì¤‘. ì˜ ë‚˜ì˜µë‹ˆê¹Œ? ë‚˜ì˜ ìš°ë¹„ ì„¸ì¤„í…ŒìŠ¤íŠ¸")
  - ë±ƒì§€ ("ğŸ… ë§¤ì¶œ 10ì–µ+")
- âœ… ì´ ë©¤ë²„ ìˆ˜ í‘œì‹œ ("ì´ 1ëª…")
- âœ… ë ˆì´ì•„ì›ƒ: ë‹¨ì¼ ì»¬ëŸ¼ (í˜„ì¬ 1ëª…ë§Œ ìˆìŒ, 3ì—´ ê·¸ë¦¬ë“œëŠ” ë©¤ë²„ê°€ ë” ìˆì„ ë•Œ í™•ì¸ í•„ìš”)

**ì°¸ê³ **:
- í˜„ì¬ ê³µê°œ í”„ë¡œí•„ì´ 1ëª…ë§Œ ìˆì–´ 3ì—´ ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ ê²€ì¦ ë¶ˆê°€
- ë©¤ë²„ê°€ ì¶”ê°€ë˜ë©´ ë°ìŠ¤í¬í†±ì—ì„œ 3ì—´, íƒœë¸”ë¦¿ 2ì—´, ëª¨ë°”ì¼ 1ì—´ë¡œ í‘œì‹œë  ê²ƒ

**ìŠ¤í¬ë¦°ìƒ·**: `member-page.png` ì €ì¥ë¨

---

### 3. ì»¤ë®¤ë‹ˆí‹° í™ˆ (`/community`)
**ìƒíƒœ**: âœ… ì •ìƒ

**í™•ì¸ëœ ì‚¬í•­**:
- âœ… í˜ì´ì§€ ë¡œë“œ ì„±ê³µ
- âœ… ë°°ë„ˆ í‘œì‹œ ("ì»¤ë®¤ë‹ˆí‹°" / "ë‹¤ì–‘í•œ ì£¼ì œë¡œ ì†Œí†µí•˜ê³  í•¨ê»˜ ì„±ì¥í•˜ëŠ” ê³µê°„ì…ë‹ˆë‹¤.")
- âœ… ì»¤ë®¤ë‹ˆí‹° ì¹´ë“œ 2ê°œ í‘œì‹œ
  - **ë°˜ê³¨**: "ì„¸ìƒì˜ ì •ë‹µì— ì˜ë¬¸ì„ ë˜ì§€ëŠ” ì°½ì—…ê°€ë“¤ì˜ ëª¨ì„ì…ë‹ˆë‹¤."
  - **í•˜ì´í† í¬**: "<í´ëŸ½ í•˜ì´í† í¬> ì—´ì •ìˆëŠ” ì‚¬ì—…ê°€ë“¤ì˜ ëª¨ì„!..." (description í‘œì‹œ í™•ì¸)
- âœ… ê° ì¹´ë“œ í´ë¦­ ì‹œ í•´ë‹¹ ì»¤ë®¤ë‹ˆí‹° ê²Œì‹œíŒìœ¼ë¡œ ì´ë™ ê°€ëŠ¥
- âœ… ìµœì‹  ê¸€ ì„¹ì…˜ í‘œì‹œ
  - í”¼ë“œí˜•/ë¦¬ìŠ¤íŠ¸í˜• í† ê¸€
  - ì „ì²´/ë°˜ê³¨/í•˜ì´í† í¬ íƒ­ í•„í„°
  - ê²Œì‹œê¸€ ì¹´ë“œ (ì‘ì„±ì, ì œëª©, ì¢‹ì•„ìš”/ëŒ“ê¸€ ìˆ˜)
- âœ… ìš°ì¸¡ ì‚¬ì´ë“œë°” (ê³µì§€ì‚¬í•­)

**ì¤‘ìš”**: ì»¤ë®¤ë‹ˆí‹° ì¹´ë“œì˜ descriptionì´ `communities` í…Œì´ë¸”ì—ì„œ ì •ìƒì ìœ¼ë¡œ ë¡œë“œë˜ì–´ í‘œì‹œë¨

**ìŠ¤í¬ë¦°ìƒ·**: `community-page.png` ì €ì¥ë¨

---

### 4. ë°˜ê³¨ ê²Œì‹œíŒ (`/community/board/vangol`)
**ìƒíƒœ**: âœ… ì •ìƒ

**í™•ì¸ëœ ì‚¬í•­**:
- âœ… í˜ì´ì§€ ë¡œë“œ ì„±ê³µ
- âœ… ë°°ë„ˆ í‘œì‹œ ("ë°˜ê³¨" / "ë°˜ê³¨ ëª¨ì„ ì „ìš©")
- âœ… "ì°¸ì—¬í•˜ê¸°" ë²„íŠ¼ í‘œì‹œ (ë¹„íšŒì› ìƒíƒœ)
- âœ… ê²Œì‹œê¸€ ëª©ë¡ í‘œì‹œ
  - "ğŸ”¥ [ë°˜ê³¨] ì§€ë‚œ ëª¨ì„ ì¸ì‚¬ì´íŠ¸ ì •ë¦¬" (ì •ëŒ€í‘œ, 1ì£¼ ì „)
  - "[í›„ê¸°] ì§€ë‚œì£¼ ë„¤íŠ¸ì›Œí‚¹ íŒŒí‹° ë‹¤ë…€ì™”ìŠµë‹ˆë‹¤" (Ma ter, 1ì£¼ ì „, ì¢‹ì•„ìš” 22, ëŒ“ê¸€ 4)
- âœ… í”¼ë“œí˜•/ë¦¬ìŠ¤íŠ¸í˜• ë·° í† ê¸€
- âœ… ìš°ì¸¡ ì‚¬ì´ë“œë°” ì—†ìŒ (ìš°ì¸¡ ê³µê°„ ë¹„ì–´ìˆìŒ - ì»¤ë®¤ë‹ˆí‹° ì •ë³´ ì‚¬ì´ë“œë°” í™•ì¸ í•„ìš”)

**ì°¸ê³ **:
- ë¡œê·¸ì¸í•˜ì§€ ì•Šì•„ "ì°¸ì—¬í•˜ê¸°" ë²„íŠ¼ë§Œ í‘œì‹œë¨
- ë¦¬ë”/Master ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸ ì‹œ ë°°ë„ˆ í¸ì§‘ ë²„íŠ¼ í™•ì¸ í•„ìš”

**ìŠ¤í¬ë¦°ìƒ·**: `vangol-board.png` ì €ì¥ë¨

---

### 5. About í˜ì´ì§€ (`/about`)
**ìƒíƒœ**: âœ… ì •ìƒ (ê¹œë¹¡ì„ ì—†ìŒ!)

**í™•ì¸ëœ ì‚¬í•­**:
- âœ… í˜ì´ì§€ ë¡œë“œ ì„±ê³µ
- âœ… ê¹œë¹¡ì„ ì—†ìŒ - ì´ì „ ìˆ˜ì •ì‚¬í•­ ì ìš© í™•ì¸
- âœ… Hero ì„¹ì…˜ í‘œì‹œ (ìš°ì„  ë¡œë”©)
  - ë°°ê²½ ì´ë¯¸ì§€ ìµœì í™” (next/image ì ìš©)
  - "ìƒˆë¡œìš´ ê°€ì¹˜ë¥¼ ë§Œë“œëŠ” ì‚¬ëŒë“¤ì˜ ë² ì´ìŠ¤ìº í”„"
  - "3ì´ˆë§Œì— ê°€ì…í•˜ê¸°" ë²„íŠ¼
- âœ… "ìš°ë¦¬ëŠ” ì„œë¡œì˜ ì„±ì¥ ë™ë ¥ì…ë‹ˆë‹¤" ì„¹ì…˜
- âœ… "WHO WE ARE?" ì„¹ì…˜ (ìŠ¤í¬ë¡¤ í•„ìš”)
- âœ… "WHAT YOU GET" ì„¹ì…˜ (ìŠ¤í¬ë¡¤ í•„ìš”)
- âœ… ë±ƒì§€ ì‹œìŠ¤í…œ ì†Œê°œ
- âœ… max-width ì¼ê´€ì„± (max-w-6xl)
- âœ… ìš°ì¸¡ ì‚¬ì´ë“œë°” (ê³µì§€ì‚¬í•­)

**ì´ì „ ì´ìŠˆ í•´ê²°**: 
- âœ… í˜ì´ì§€ ì§„ì… ì‹œ ê¹œë¹¡ì„ í˜„ìƒ í•´ê²°ë¨
- âœ… `about/layout.tsx` ìƒì„±ìœ¼ë¡œ ë ˆì´ì•„ì›ƒ ì•ˆì •í™”
- âœ… Hero ë°°ê²½ ìŠ¤ì¼ˆë ˆí†¤ ìƒ‰ìƒ ì¼ì¹˜

**ìŠ¤í¬ë¦°ìƒ·**: `about-page.png` ì €ì¥ë¨

---

### 6. ì´ë²¤íŠ¸ ëª©ë¡ (`/events`)
**ìƒíƒœ**: âœ… ì •ìƒ

**í™•ì¸ëœ ì‚¬í•­**:
- âœ… í˜ì´ì§€ ë¡œë“œ ì„±ê³µ
- âœ… "ë‹¤ê°€ì˜¤ëŠ” ì´ë²¤íŠ¸" í—¤ë” í‘œì‹œ
- âœ… "ìƒˆ ì´ë²¤íŠ¸" ë²„íŠ¼ í‘œì‹œ (Admin ì „ìš©)
- âœ… ì´ë²¤íŠ¸ íƒ€ì… í•„í„° (ì „ì²´/ë„¤íŠ¸ì›Œí‚¹/í´ë˜ìŠ¤/ì•¡í‹°ë¹„í‹°)
- âœ… ì´ë²¤íŠ¸ ì¹´ë“œ 3ê°œ í‘œì‹œ
  - **AIë¡œ í•˜ë£¨ë§Œì— ë‚˜ë§Œì˜ ì„œë¹„ìŠ¤ ë§Œë“¤ê¸°** (í´ë˜ìŠ¤, 12/3, 2/15ëª…)
  - **í¬ë¦¬ìŠ¤ë§ˆìŠ¤ íŒŒí‹°** (ë„¤íŠ¸ì›Œí‚¹, 12/25, 1/20ëª…)
  - **ì‹ ë…„ë§ì´ ì¸ì™•ì‚° ë“±ì‚°** (ì•¡í‹°ë¹„í‹°, 1/1, 0/6ëª…)
- âœ… ê° ì¹´ë“œì— íƒ€ì…, í˜¸ìŠ¤íŠ¸, ë‚ ì§œ, ì¥ì†Œ, ì°¸ê°€ì ìˆ˜ í‘œì‹œ
- âœ… ê·¸ë¦¬ë“œ/ë¦¬ìŠ¤íŠ¸ ë·° ëª¨ë‘ í‘œì‹œ
- âœ… ìš°ì¸¡ ì‚¬ì´ë“œë°” (ê³µì§€ì‚¬í•­)

**ìŠ¤í¬ë¦°ìƒ·**: `events-page.png` ì €ì¥ë¨

---

## ğŸ” ì¶”ê°€ í™•ì¸ í•„ìš” í•­ëª©

### 1. ì»¤ë®¤ë‹ˆí‹° ë°°ë„ˆ í¸ì§‘ ê¸°ëŠ¥ (ìš°ì„ ìˆœìœ„: P0)
**í˜ì´ì§€**: `/community/board/vangol`, `/community/board/hightalk`
**í…ŒìŠ¤íŠ¸ í•„ìš”**: ë¦¬ë” ë˜ëŠ” Master ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸ í›„ í…ŒìŠ¤íŠ¸

**í™•ì¸ í•­ëª©**:
- [ ] ë°°ë„ˆ ìœ„ í˜¸ë²„ ì‹œ í¸ì§‘ ë²„íŠ¼(ì—°í•„ ì•„ì´ì½˜) í‘œì‹œ
- [ ] í¸ì§‘ ë²„íŠ¼ í´ë¦­ ì‹œ í¸ì§‘ ëª¨ë“œë¡œ ì „í™˜
- [ ] í…ìŠ¤íŠ¸ ì—ë””í„° í‘œì‹œ
- [ ] ì €ì¥ í›„ ë°˜ì˜ í™•ì¸
- [ ] `/community` í˜ì´ì§€ì˜ ì»¤ë®¤ë‹ˆí‹° ì¹´ë“œ ì„¤ëª…ë„ ì—…ë°ì´íŠ¸ë˜ëŠ”ì§€ í™•ì¸

**í˜„ì¬ ìƒíƒœ**: 
- ë¹„ë¡œê·¸ì¸ ìƒíƒœë¡œ í…ŒìŠ¤íŠ¸í•˜ì—¬ í¸ì§‘ ë²„íŠ¼ ë¯¸í™•ì¸
- ë¡œê·¸ì¸ í•„ìš”

---

### 2. ì»¤ë®¤ë‹ˆí‹° ìš°ì¸¡ ì‚¬ì´ë“œë°”
**í˜ì´ì§€**: `/community/board/vangol`, `/community/board/hightalk`

**í™•ì¸ í•­ëª©**:
- [ ] ì»¤ë®¤ë‹ˆí‹° ê°€ì´ë“œë¼ì¸ í‘œì‹œ
- [ ] ì»¤ë®¤ë‹ˆí‹° ë¦¬ë” ì •ë³´ í‘œì‹œ
- [ ] ì „ì²´ í´ëŸ½ ë©¤ë²„ ëª©ë¡ í‘œì‹œ (ìµœëŒ€ 10ëª…)
- [ ] Master ê³„ì •: ë©¤ë²„ í˜¸ë²„ ì‹œ ì™•ê´€ ì•„ì´ì½˜ í‘œì‹œ
- [ ] ì™•ê´€ ì•„ì´ì½˜ í´ë¦­ ì‹œ ë¦¬ë” ì§€ì • ê¸°ëŠ¥

**í˜„ì¬ ìƒíƒœ**: 
- í˜ì´ì§€ ë¡œë“œëŠ” ì„±ê³µí–ˆìœ¼ë‚˜ ìš°ì¸¡ ì‚¬ì´ë“œë°”ê°€ ë³´ì´ì§€ ì•ŠìŒ
- ì»¤ë®¤ë‹ˆí‹° ë©¤ë²„ê°€ ì—†ê±°ë‚˜ ì‚¬ì´ë“œë°” ë Œë”ë§ ì¡°ê±´ ë¯¸ì¶©ì¡± ê°€ëŠ¥ì„±

---

### 3. ì•Œë¦¼ ì‹œìŠ¤í…œ
**í…ŒìŠ¤íŠ¸ í•„ìš”**: ë¡œê·¸ì¸ í›„

**í™•ì¸ í•­ëª©**:
- [ ] PC: ì‚¬ì´ë“œë°” í•˜ë‹¨ ì´ë¦„ ìš°ì¸¡ì— ì•Œë¦¼ ì•„ì´ì½˜ í‘œì‹œ
- [ ] ëª¨ë°”ì¼: ìƒë‹¨ í—¤ë” ìš°ì¸¡ì— ì•Œë¦¼ ì•„ì´ì½˜ í‘œì‹œ
- [ ] ì½ì§€ ì•Šì€ ì•Œë¦¼ ë°°ì§€ í‘œì‹œ
- [ ] ì•Œë¦¼ í´ë¦­ ì‹œ ë“œë¡­ë‹¤ìš´/ì‹œíŠ¸ í‘œì‹œ
- [ ] PC: ì‚¬ì´ë“œë°” ìš°ì¸¡ì— í”Œë¡œíŒ… ì¹´ë“œ
- [ ] ëª¨ë°”ì¼: í•˜ë‹¨ ì‹œíŠ¸
- [ ] ì•Œë¦¼ í•­ëª© í´ë¦­ ì‹œ ê´€ë ¨ í˜ì´ì§€ ì´ë™
- [ ] "ëª¨ë‘ ì½ìŒ" ë²„íŠ¼ ì‘ë™

**í˜„ì¬ ìƒíƒœ**: 
- ë¹„ë¡œê·¸ì¸ ìƒíƒœì—ì„œëŠ” ì•Œë¦¼ ì•„ì´ì½˜ë§Œ í‘œì‹œë¨
- í´ë¦­ ì‹œ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ëŠ”ì§€ í™•ì¸ í•„ìš”

---

### 4. ë¡œê·¸ì¸/íšŒì›ê°€ì… í”Œë¡œìš°
**í˜ì´ì§€**: `/auth/login`, `/auth/sign-up`

**í™•ì¸ í•­ëª©**:
- [ ] êµ¬ê¸€ ë¡œê·¸ì¸ ë²„íŠ¼ ì‘ë™
- [ ] ë¡œê·¸ì¸ ì„±ê³µ ì‹œ ì´ì „ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
- [ ] ìµœì´ˆ ê°€ì… ì‹œ í”„ë¡œí•„ í˜ì´ì§€ë¡œ ì´ë™
- [ ] Master ê³„ì •ì—ê²Œ ì‹ ê·œ ê°€ì… ì•Œë¦¼ ë°œì†¡

**í˜„ì¬ ìƒíƒœ**: ë¯¸í…ŒìŠ¤íŠ¸

---

### 5. í”„ë¡œí•„ í˜ì´ì§€
**í˜ì´ì§€**: `/community/profile`
**í…ŒìŠ¤íŠ¸ í•„ìš”**: ë¡œê·¸ì¸ í›„

**í™•ì¸ í•­ëª©**:
- [ ] í”„ë¡œí•„ ì •ë³´ í‘œì‹œ
- [ ] í¸ì§‘ ë²„íŠ¼ ì‘ë™
- [ ] í”„ë¡œí•„ ê³µê°œ/ë¹„ê³µê°œ í† ê¸€
- [ ] ë±ƒì§€ í‘œì‹œ (ìµœëŒ€ 3ê°œ, ì„¸ë¡œ ë°°ì¹˜)
- [ ] ìš°ì¸¡ ì‚¬ì´ë“œë°” ì—†ìŒ

**í˜„ì¬ ìƒíƒœ**: ë¯¸í…ŒìŠ¤íŠ¸ (ë¡œê·¸ì¸ í•„ìš”)

---

### 6. ë©¤ë²„ ë¦¬ìŠ¤íŠ¸ ë ˆì´ì•„ì›ƒ (3ì—´ ê·¸ë¦¬ë“œ)
**í˜ì´ì§€**: `/member`

**í™•ì¸ í•­ëª©**:
- [ ] ë°ìŠ¤í¬í†± (lg ì´ìƒ): 3ì—´ ê·¸ë¦¬ë“œ
- [ ] íƒœë¸”ë¦¿ (md): 2ì—´ ê·¸ë¦¬ë“œ
- [ ] ëª¨ë°”ì¼ (sm ì´í•˜): 1ì—´ ê·¸ë¦¬ë“œ
- [ ] ì¹´ë“œ ë†’ì´ ì¼ê´€ì„±
- [ ] í˜¸ë²„ íš¨ê³¼ (ê·¸ë¦¼ì, ìƒìŠ¹ ì• ë‹ˆë©”ì´ì…˜)
- [ ] í´ë¦­ ì‹œ ë©¤ë²„ ìƒì„¸ ëª¨ë‹¬

**í˜„ì¬ ìƒíƒœ**: 
- í˜„ì¬ ê³µê°œ í”„ë¡œí•„ 1ëª…ë§Œ ìˆì–´ ê·¸ë¦¬ë“œ ê²€ì¦ ë¶ˆê°€
- ì¶”ê°€ ë©¤ë²„ í•„ìš”

---

## ğŸ“Š ì „ì²´ í‰ê°€

### âœ… ì •ìƒ ì‘ë™ í•­ëª© (6/12)
1. âœ… í™ˆí˜ì´ì§€ ë¡œë“œ ë° ë ˆì´ì•„ì›ƒ
2. âœ… ë©¤ë²„ ë¦¬ìŠ¤íŠ¸ í˜ì´ì§€ (ë ˆì´ì•„ì›ƒì€ ì¶”ê°€ í™•ì¸ í•„ìš”)
3. âœ… ì»¤ë®¤ë‹ˆí‹° í™ˆ í˜ì´ì§€ (ì¹´ë“œ description í‘œì‹œ í™•ì¸)
4. âœ… ë°˜ê³¨ ê²Œì‹œíŒ í˜ì´ì§€
5. âœ… About í˜ì´ì§€ (ê¹œë¹¡ì„ í•´ê²° í™•ì¸)
6. âœ… ì´ë²¤íŠ¸ ëª©ë¡ í˜ì´ì§€

### âš ï¸ ì¶”ê°€ í™•ì¸ í•„ìš” (6/12)
1. âš ï¸ ì»¤ë®¤ë‹ˆí‹° ë°°ë„ˆ í¸ì§‘ ê¸°ëŠ¥ (ë¡œê·¸ì¸ í•„ìš”)
2. âš ï¸ ì»¤ë®¤ë‹ˆí‹° ìš°ì¸¡ ì‚¬ì´ë“œë°” (ë©¤ë²„ ë°ì´í„° í•„ìš”)
3. âš ï¸ ì•Œë¦¼ ì‹œìŠ¤í…œ (ë¡œê·¸ì¸ í•„ìš”)
4. âš ï¸ ë¡œê·¸ì¸/íšŒì›ê°€ì… í”Œë¡œìš°
5. âš ï¸ í”„ë¡œí•„ í˜ì´ì§€ (ë¡œê·¸ì¸ í•„ìš”)
6. âš ï¸ ë©¤ë²„ ë¦¬ìŠ¤íŠ¸ 3ì—´ ê·¸ë¦¬ë“œ (ì¶”ê°€ ë©¤ë²„ í•„ìš”)

---

## ğŸ¯ ë‹¤ìŒ ë‹¨ê³„ ê¶Œì¥ì‚¬í•­

### ì¦‰ì‹œ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥
1. **ë¡œê·¸ì¸/íšŒì›ê°€ì… í”Œë¡œìš° í…ŒìŠ¤íŠ¸**
   - Google OAuth ì‘ë™ í™•ì¸
   - ë¦¬ë‹¤ì´ë ‰íŠ¸ í™•ì¸
   
2. **ë¡œê·¸ì¸ í›„ í…ŒìŠ¤íŠ¸**
   - í”„ë¡œí•„ í˜ì´ì§€ í™•ì¸
   - ì•Œë¦¼ ì‹œìŠ¤í…œ í™•ì¸
   - ì»¤ë®¤ë‹ˆí‹° ì°¸ì—¬í•˜ê¸° ë²„íŠ¼ í™•ì¸

### Master/ë¦¬ë” ê³„ì •ìœ¼ë¡œ í…ŒìŠ¤íŠ¸
3. **ì»¤ë®¤ë‹ˆí‹° ë°°ë„ˆ í¸ì§‘ ê¸°ëŠ¥ (P0 ìš°ì„ ìˆœìœ„)**
   - ë°˜ê³¨/í•˜ì´í† í¬ ê²Œì‹œíŒ ì ‘ì†
   - ë°°ë„ˆ í¸ì§‘ ë²„íŠ¼ í´ë¦­
   - ì„¤ëª… ìˆ˜ì • í›„ ì €ì¥
   - ì»¤ë®¤ë‹ˆí‹° í™ˆ ì¹´ë“œ ì—…ë°ì´íŠ¸ í™•ì¸

4. **ë¦¬ë” ì§€ì • ê¸°ëŠ¥**
   - ë°˜ê³¨/í•˜ì´í† í¬ ê²Œì‹œíŒ ìš°ì¸¡ ì‚¬ì´ë“œë°”
   - ë©¤ë²„ ëª©ë¡ì—ì„œ ì™•ê´€ ì•„ì´ì½˜ í´ë¦­
   - ë¦¬ë” ì§€ì • í™•ì¸

### ë°ì´í„° ì¶”ê°€ í›„ í…ŒìŠ¤íŠ¸
5. **ë©¤ë²„ ë¦¬ìŠ¤íŠ¸ ë ˆì´ì•„ì›ƒ**
   - ì¶”ê°€ ë©¤ë²„ í”„ë¡œí•„ ìƒì„± (ìµœì†Œ 6ê°œ)
   - 3ì—´ ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ í™•ì¸
   - ë°˜ì‘í˜• í™•ì¸ (ë¸Œë¼ìš°ì € í¬ê¸° ì¡°ì ˆ)

---

## ğŸ“¸ ìŠ¤í¬ë¦°ìƒ· ëª©ë¡
ëª¨ë“  ìŠ¤í¬ë¦°ìƒ·ì€ ë‹¤ìŒ ìœ„ì¹˜ì— ì €ì¥ë¨:
`C:\Users\USER-PC\AppData\Local\Temp\cursor\screenshots\`

1. `home-page.png` - í™ˆí˜ì´ì§€
2. `member-page.png` - ë©¤ë²„ ë¦¬ìŠ¤íŠ¸
3. `community-page.png` - ì»¤ë®¤ë‹ˆí‹° í™ˆ
4. `vangol-board.png` - ë°˜ê³¨ ê²Œì‹œíŒ
5. `about-page.png` - About í˜ì´ì§€
6. `events-page.png` - ì´ë²¤íŠ¸ ëª©ë¡

---

## ğŸ› ë°œê²¬ëœ ì´ìŠˆ

### ì—†ìŒ (í˜„ì¬ê¹Œì§€)
- ëª¨ë“  í˜ì´ì§€ê°€ ì •ìƒì ìœ¼ë¡œ ë¡œë“œë¨
- ì´ì „ì— ìˆ˜ì •í•œ ê¹œë¹¡ì„ í˜„ìƒ í•´ê²° í™•ì¸
- ì»¤ë®¤ë‹ˆí‹° ì¹´ë“œì— description ì •ìƒ í‘œì‹œ í™•ì¸

---

## ğŸ’¡ ê°œì„  ì œì•ˆ

1. **ì»¤ë®¤ë‹ˆí‹° ì‚¬ì´ë“œë°” í‘œì‹œ í™•ì¸**
   - ë°˜ê³¨/í•˜ì´í† í¬ ê²Œì‹œíŒì—ì„œ ìš°ì¸¡ ì‚¬ì´ë“œë°”ê°€ ë³´ì´ì§€ ì•ŠìŒ
   - ê°€ì´ë“œë¼ì¸, ë¦¬ë” ì •ë³´, ë©¤ë²„ ëª©ë¡ì´ í‘œì‹œë˜ì–´ì•¼ í•¨

2. **í…ŒìŠ¤íŠ¸ ë°ì´í„° ì¶”ê°€**
   - ë©¤ë²„ í”„ë¡œí•„ ì¶”ê°€ (ë ˆì´ì•„ì›ƒ í…ŒìŠ¤íŠ¸ìš©)
   - ì»¤ë®¤ë‹ˆí‹° ë©¤ë²„ ì¶”ê°€ (ì‚¬ì´ë“œë°” í…ŒìŠ¤íŠ¸ìš©)

3. **E2E í…ŒìŠ¤íŠ¸ ìë™í™” ê³ ë ¤**
   - Playwright ë“±ìœ¼ë¡œ ì£¼ìš” ì‚¬ìš©ì ì—¬ì • ìë™í™”
   - ë¡œê·¸ì¸ í”Œë¡œìš°, ê²Œì‹œê¸€ ì‘ì„±, ì´ë²¤íŠ¸ ì°¸ê°€ ë“±
</file>

<file path="TESTING_CHECKLIST.md">
# Seoul Founders Club - ì „ì²´ ì ê²€ ì²´í¬ë¦¬ìŠ¤íŠ¸

## 1. ì¸ì¦ & íšŒì›ê°€ì… í”Œë¡œìš°

### 1.1 íšŒì›ê°€ì… (ì‹ ê·œ ì‚¬ìš©ì)
- [ ] `/auth/sign-up` - êµ¬ê¸€ ë¡œê·¸ì¸ ë²„íŠ¼ ì‘ë™
- [ ] ìµœì´ˆ ë¡œê·¸ì¸ ì‹œ í”„ë¡œí•„ ìë™ ìƒì„±
- [ ] Master ê³„ì •ì—ê²Œ ì‹ ê·œ ê°€ì… ì•Œë¦¼ ì „ì†¡ í™•ì¸
- [ ] í”„ë¡œí•„ í˜ì´ì§€ë¡œ ìë™ ë¦¬ë‹¤ì´ë ‰íŠ¸

### 1.2 ë¡œê·¸ì¸ (ê¸°ì¡´ ì‚¬ìš©ì)
- [ ] `/auth/login` - êµ¬ê¸€ ë¡œê·¸ì¸ ì‘ë™
- [ ] ë¡œê·¸ì¸ í›„ ì´ì „ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
- [ ] ì„¸ì…˜ ìœ ì§€ í™•ì¸

### 1.3 ë¡œê·¸ì•„ì›ƒ
- [ ] ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ ì‘ë™
- [ ] ì„¸ì…˜ ì‚­ì œ í™•ì¸
- [ ] í™ˆìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸

---

## 2. í”„ë¡œí•„ & ë©¤ë²„ ê´€ë¦¬

### 2.1 ë‚´ í”„ë¡œí•„ (`/community/profile`)
- [ ] í”„ë¡œí•„ ì •ë³´ í‘œì‹œ (ì´ë¦„, ì†Œì†, ì—­í• , ì†Œê°œê¸€)
- [ ] í”„ë¡œí•„ í¸ì§‘ ë²„íŠ¼ ì‘ë™
- [ ] í”„ë¡œí•„ ê³µê°œ/ë¹„ê³µê°œ í† ê¸€ ì‘ë™
- [ ] ì•„ë°”íƒ€ ì´ë¯¸ì§€ ì—…ë¡œë“œ/ë³€ê²½
- [ ] ì†Œì† ì •ë³´ ìˆ˜ì • (íšŒì‚¬, ì§ì±…)
- [ ] ë‘ ë²ˆì§¸ ì†Œì† ì •ë³´ ì¶”ê°€ ê°€ëŠ¥
- [ ] ì†Œê°œê¸€ ì‘ì„±/ìˆ˜ì • (3ì¤„ê¹Œì§€ í‘œì‹œ)
- [ ] ë³´ìœ  ë±ƒì§€ í‘œì‹œ (ìµœëŒ€ 3ê°œ, ì„¸ë¡œ ë°°ì¹˜)
- [ ] ë±ƒì§€ ê³µê°œ/ë¹„ê³µê°œ ì„¤ì •
- [ ] ë¹„í™œì„±í™”ëœ ë±ƒì§€ëŠ” í‘œì‹œë˜ì§€ ì•ŠìŒ
- [ ] ìš°ì¸¡ ì‚¬ì´ë“œë°” ì—†ìŒ (ì „ì²´ ë„ˆë¹„ ì‚¬ìš©)
- [ ] ë‚´ ê²Œì‹œê¸€/ì´ë²¤íŠ¸ ëª©ë¡ í‘œì‹œ

### 2.2 ë©¤ë²„ ë¦¬ìŠ¤íŠ¸ (`/member`)
- [ ] ê³µê°œ í”„ë¡œí•„ë§Œ í‘œì‹œ
- [ ] 3ì—´ ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ (lg ì´ìƒ)
- [ ] 2ì—´ ê·¸ë¦¬ë“œ (md)
- [ ] 1ì—´ ê·¸ë¦¬ë“œ (ëª¨ë°”ì¼)
- [ ] í”„ë¡œí•„ ì‚¬ì§„, ì´ë¦„, ì†Œì†, ì†Œê°œê¸€ í‘œì‹œ
- [ ] ë±ƒì§€ í‘œì‹œ (ìµœëŒ€ 3ê°œ)
- [ ] ì¹´ë“œ í˜¸ë²„ ì‹œ ê·¸ë¦¼ì íš¨ê³¼
- [ ] ì¹´ë“œ í´ë¦­ ì‹œ ìƒì„¸ ëª¨ë‹¬ í‘œì‹œ
- [ ] ë¹„ê³µê°œ í”„ë¡œí•„ ì‚¬ìš©ìì—ê²Œ ê³µê°œ ìœ ë„ ë°°ë„ˆ í‘œì‹œ
- [ ] ë¡œë”© ìŠ¤ì¼ˆë ˆí†¤ì´ ì‹¤ì œ ë ˆì´ì•„ì›ƒê³¼ ì¼ì¹˜

### 2.3 ë©¤ë²„ ìƒì„¸ ëª¨ë‹¬
- [ ] í”„ë¡œí•„ ì‚¬ì§„, ì´ë¦„
- [ ] ì†Œì† ì •ë³´ (1ê°œ ë˜ëŠ” 2ê°œ)
- [ ] ì—­í•  ë±ƒì§€
- [ ] ë³´ìœ  ë±ƒì§€ (í™œì„±í™”ëœ ê²ƒë§Œ)
- [ ] ì†Œê°œê¸€
- [ ] ë‹«ê¸° ë²„íŠ¼ ì‘ë™
- [ ] Master ê¶Œí•œ: ë¦¬ë” ì§€ì • ë²„íŠ¼ ì—†ìŒ (ì»¤ë®¤ë‹ˆí‹°ë³„ë¡œ ì´ë™)

---

## 3. ì»¤ë®¤ë‹ˆí‹° ê¸°ëŠ¥

### 3.1 ì»¤ë®¤ë‹ˆí‹° í™ˆ (`/community`)
- [ ] ì»¤ë®¤ë‹ˆí‹° ì†Œê°œ ë°°ë„ˆ í‘œì‹œ
- [ ] Master/ë¦¬ë”: ì†Œê°œê¸€ ìˆ˜ì • ë²„íŠ¼ í‘œì‹œ (í˜¸ë²„ ì‹œ)
- [ ] ì†Œê°œê¸€ ìˆ˜ì • ê¸°ëŠ¥ ì‘ë™
- [ ] ë°˜ê³¨/í•˜ì´í† í¬ ì»¤ë®¤ë‹ˆí‹° ì¹´ë“œ í‘œì‹œ
- [ ] ì»¤ë®¤ë‹ˆí‹° ì¹´ë“œì— ì„¤ëª… í‘œì‹œ (communities.description)
- [ ] ì¹´ë“œ í´ë¦­ ì‹œ í•´ë‹¹ ì»¤ë®¤ë‹ˆí‹° ê²Œì‹œíŒìœ¼ë¡œ ì´ë™
- [ ] ìµœì‹  ê¸€ í”¼ë“œ í‘œì‹œ (ë°˜ê³¨/í•˜ì´í† í¬ ê¸€ë§Œ)
- [ ] íƒ­ í•„í„° ì‘ë™ (ì „ì²´/ë°˜ê³¨/í•˜ì´í† í¬)

### 3.2 ì»¤ë®¤ë‹ˆí‹° ê²Œì‹œíŒ (`/community/board/[slug]`)

#### 3.2.1 ë°˜ê³¨ (`/community/board/vangol`)
- [ ] ìƒë‹¨ ë°°ë„ˆì— ë°˜ê³¨ ì„¤ëª… í‘œì‹œ
- [ ] ë¦¬ë”/Master: ì„¤ëª… ìˆ˜ì • ë²„íŠ¼ í‘œì‹œ ë° ì‘ë™
- [ ] ì„¤ëª… ìˆ˜ì • ì‹œ ì»¤ë®¤ë‹ˆí‹° í™ˆ ì¹´ë“œë„ ì—…ë°ì´íŠ¸
- [ ] ë¹„íšŒì›: "ì°¸ì—¬í•˜ê¸°" ë²„íŠ¼ í‘œì‹œ
- [ ] ì°¸ì—¬í•˜ê¸° í´ë¦­ ì‹œ ë©¤ë²„ì‹­ ì¶”ê°€
- [ ] íšŒì›: "ì°¸ì—¬ ì¤‘" ë²„íŠ¼ í‘œì‹œ ë° íƒˆí‡´ ê°€ëŠ¥
- [ ] íšŒì›ë§Œ ê¸€ì“°ê¸° ë²„íŠ¼ í‘œì‹œ
- [ ] ê¸€ ëª©ë¡ í‘œì‹œ
- [ ] ìš°ì¸¡ ì‚¬ì´ë“œë°”: ì»¤ë®¤ë‹ˆí‹° ì •ë³´
  - [ ] ì»¤ë®¤ë‹ˆí‹° ê°€ì´ë“œë¼ì¸ (ë¦¬ë” ìˆ˜ì • ê°€ëŠ¥)
  - [ ] ì»¤ë®¤ë‹ˆí‹° ë¦¬ë” ì •ë³´
  - [ ] ì „ì²´ ë©¤ë²„ ëª©ë¡ (ìµœëŒ€ 10ëª…)
  - [ ] Master: ë©¤ë²„ í˜¸ë²„ ì‹œ ì™•ê´€ ì•„ì´ì½˜ â†’ ë¦¬ë” ì§€ì • ê°€ëŠ¥

#### 3.2.2 í•˜ì´í† í¬ (`/community/board/hightalk`)
- [ ] ë°˜ê³¨ê³¼ ë™ì¼í•œ ê¸°ëŠ¥ í™•ì¸

### 3.3 ììœ ê²Œì‹œíŒ (`/community/board/free`)
- [ ] ëˆ„êµ¬ë‚˜ ì ‘ê·¼ ê°€ëŠ¥
- [ ] ë¡œê·¸ì¸ ì‹œ ê¸€ì“°ê¸° ê°€ëŠ¥
- [ ] ê¸€ ëª©ë¡ í‘œì‹œ
- [ ] í‘œì¤€ ìš°ì¸¡ ì‚¬ì´ë“œë°” í‘œì‹œ

### 3.4 ê³µì§€ì‚¬í•­ (`/community/board/announcements`)
- [ ] ëˆ„êµ¬ë‚˜ ì—´ëŒ ê°€ëŠ¥
- [ ] Adminë§Œ ì‘ì„± ê°€ëŠ¥
- [ ] ê¸€ ëª©ë¡ í‘œì‹œ

---

## 4. ê²Œì‹œê¸€ ê¸°ëŠ¥

### 4.1 ê¸€ ì‘ì„±
- [ ] ì œëª© ì…ë ¥
- [ ] ë³¸ë¬¸ ì…ë ¥ (ë§ˆí¬ë‹¤ìš´ ì§€ì›)
- [ ] ì´ë¯¸ì§€ ì—…ë¡œë“œ
- [ ] ê³µê°œ ë²”ìœ„ ì„ íƒ (ì „ì²´ ê³µê°œ/ì»¤ë®¤ë‹ˆí‹° íšŒì›ë§Œ)
- [ ] ì‘ì„± ì™„ë£Œ ì‹œ í•´ë‹¹ ê²Œì‹œíŒìœ¼ë¡œ ì´ë™

### 4.2 ê¸€ ìƒì„¸ë³´ê¸°
- [ ] ì œëª©, ì‘ì„±ì, ì‘ì„±ì¼ í‘œì‹œ
- [ ] ì‘ì„±ì í”„ë¡œí•„ ì‚¬ì§„, ì´ë¦„, ë±ƒì§€
- [ ] ë³¸ë¬¸ ë Œë”ë§ (ë§ˆí¬ë‹¤ìš´)
- [ ] ì´ë¯¸ì§€ í‘œì‹œ
- [ ] ì¢‹ì•„ìš” ë²„íŠ¼ ì‘ë™
- [ ] ëŒ“ê¸€ ì‘ì„±
- [ ] ëŒ“ê¸€ ëª©ë¡ í‘œì‹œ
- [ ] ëŒ“ê¸€ ì‚­ì œ (ë³¸ì¸ë§Œ)
- [ ] ê¸€ ìˆ˜ì • ë²„íŠ¼ (ë³¸ì¸/Adminë§Œ)
- [ ] ê¸€ ì‚­ì œ ë²„íŠ¼ (ë³¸ì¸/Adminë§Œ)

### 4.3 ê¸€ ìˆ˜ì •/ì‚­ì œ
- [ ] ìˆ˜ì • í˜ì´ì§€ ì´ë™
- [ ] ê¸°ì¡´ ë‚´ìš© ë¡œë“œ
- [ ] ìˆ˜ì • ì™„ë£Œ ì‹œ ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™
- [ ] ì‚­ì œ í™•ì¸ ëª¨ë‹¬
- [ ] ì‚­ì œ ì™„ë£Œ ì‹œ ëª©ë¡ìœ¼ë¡œ ì´ë™

---

## 5. ì´ë²¤íŠ¸ ê¸°ëŠ¥

### 5.1 ì´ë²¤íŠ¸ ëª©ë¡ (`/events`)
- [ ] ì§„í–‰ ì˜ˆì • ì´ë²¤íŠ¸ ëª©ë¡
- [ ] ì¢…ë£Œëœ ì´ë²¤íŠ¸ ëª©ë¡
- [ ] ì´ë²¤íŠ¸ ì¹´ë“œ: ì¸ë„¤ì¼, ì œëª©, ë‚ ì§œ, ì¥ì†Œ, ì°¸ê°€ì ìˆ˜
- [ ] Admin: ìƒˆ ì´ë²¤íŠ¸ ë§Œë“¤ê¸° ë²„íŠ¼

### 5.2 ì´ë²¤íŠ¸ ìƒì„¸ (`/events/[id]`)
- [ ] ì´ë²¤íŠ¸ ì •ë³´ í‘œì‹œ
- [ ] ì°¸ê°€ ì‹ ì²­ ë²„íŠ¼ (ë¡œê·¸ì¸ í•„ìš”)
- [ ] ì°¸ê°€ ì‹ ì²­ í¼ (ì»¤ìŠ¤í…€ í•„ë“œ)
- [ ] ì°¸ê°€ ì‹ ì²­ ì™„ë£Œ
- [ ] ì°¸ê°€ì ëª©ë¡ í‘œì‹œ
- [ ] ìš°ì¸¡ ì‚¬ì´ë“œë°”: í˜¸ìŠ¤íŠ¸ ì •ë³´, ì°¸ê°€ì
- [ ] ì¢Œì¸¡ ì‹œì‘ì ì´ ë‹¤ë¥¸ í˜ì´ì§€ì™€ ë™ì¼
- [ ] ëª¨ë°”ì¼: í•˜ë‹¨ ê³ ì • ì•¡ì…˜ë°”

### 5.3 ì´ë²¤íŠ¸ ìƒì„±/ìˆ˜ì • (Admin)
- [ ] ì œëª©, ì„¤ëª…, ë‚ ì§œ, ì¥ì†Œ ì…ë ¥
- [ ] ì¸ë„¤ì¼ ì—…ë¡œë“œ
- [ ] ê°€ê²©, ìµœëŒ€ ì°¸ê°€ì ì„¤ì •
- [ ] ì»¤ìŠ¤í…€ í•„ë“œ ì¶”ê°€ (í…ìŠ¤íŠ¸/ì„ íƒí˜•)
- [ ] ì´ë²¤íŠ¸ íƒ€ì… ì„ íƒ
- [ ] ìƒì„± ì™„ë£Œ ì‹œ ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™
- [ ] ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼ (ìƒì„±ìë§Œ)

---

## 6. ì†Œê°œ í˜ì´ì§€ (`/about`)

### 6.1 ë ˆì´ì•„ì›ƒ
- [ ] í˜ì´ì§€ ë¡œë“œ ì‹œ ê¹œë¹¡ì„ ì—†ìŒ
- [ ] Hero ì„¹ì…˜ ì´ë¯¸ì§€ ìµœì í™” (next/image)
- [ ] "WHO WE ARE" ì„¹ì…˜
- [ ] "WHAT YOU GET" ì„¹ì…˜ (3ê°œ ì¹´ë“œ, ë™ì¼ ë†’ì´)
- [ ] ë±ƒì§€ ì‹œìŠ¤í…œ ì†Œê°œ
- [ ] ëª¨ë“  ì„¹ì…˜ì˜ max-width ì¼ê´€ì„± (max-w-6xl)
- [ ] ë¡œë”© ìŠ¤ì¼ˆë ˆí†¤ì´ ì‹¤ì œ ë ˆì´ì•„ì›ƒê³¼ ì¼ì¹˜

### 6.2 ë±ƒì§€ ì‹œìŠ¤í…œ
- [ ] í™œì„±í™”ëœ ë±ƒì§€ë§Œ í‘œì‹œ
- [ ] ì¹´í…Œê³ ë¦¬ë³„ ë¶„ë¥˜
- [ ] ë±ƒì§€ ì•„ì´ì½˜, ì´ë¦„, ì„¤ëª… í‘œì‹œ

---

## 7. ì•Œë¦¼ ì‹œìŠ¤í…œ

### 7.1 ì•Œë¦¼ ì•„ì´ì½˜
- [ ] PC: ì‚¬ì´ë“œë°” í•˜ë‹¨, ì´ë¦„ ìš°ì¸¡ì— í‘œì‹œ
- [ ] ëª¨ë°”ì¼: ìƒë‹¨ í—¤ë” ìš°ì¸¡ì— í‘œì‹œ
- [ ] ì½ì§€ ì•Šì€ ì•Œë¦¼ ê°œìˆ˜ ë±ƒì§€ í‘œì‹œ
- [ ] ë¡œê·¸ì•„ì›ƒ ìƒíƒœ: ì•„ì´ì½˜ í‘œì‹œ (í´ë¦­ ì‹œ ë¡œê·¸ì¸ìœ¼ë¡œ)

### 7.2 ì•Œë¦¼ ëª©ë¡
- [ ] PC: ì‚¬ì´ë“œë°” ìš°ì¸¡ì— í”Œë¡œíŒ… ì¹´ë“œë¡œ í‘œì‹œ
- [ ] ëª¨ë°”ì¼: í•˜ë‹¨ì—ì„œ ì˜¬ë¼ì˜¤ëŠ” ì‹œíŠ¸
- [ ] ì•Œë¦¼ ëª©ë¡ í‘œì‹œ (ìµœëŒ€ 10ê°œ)
- [ ] ì½ì§€ ì•Šì€ ì•Œë¦¼ ê°•ì¡°
- [ ] ì•Œë¦¼ í´ë¦­ ì‹œ ê´€ë ¨ í˜ì´ì§€ë¡œ ì´ë™
- [ ] "ëª¨ë‘ ì½ìŒ" ë²„íŠ¼ ì‘ë™

### 7.3 ì•Œë¦¼ ë°œì†¡
- [ ] ì‹ ê·œ íšŒì› ê°€ì… â†’ Masterì—ê²Œ ì•Œë¦¼
- [ ] ëŒ“ê¸€ ì‘ì„± â†’ ê¸€ ì‘ì„±ìì—ê²Œ ì•Œë¦¼
- [ ] ê²Œì‹œê¸€ ì¢‹ì•„ìš” â†’ ì‘ì„±ìì—ê²Œ ì•Œë¦¼
- [ ] ì´ë²¤íŠ¸ ì°¸ê°€ ì‹ ì²­ â†’ í˜¸ìŠ¤íŠ¸ì—ê²Œ ì•Œë¦¼

---

## 8. ê´€ë¦¬ì ê¸°ëŠ¥ (`/admin`)

### 8.1 ëŒ€ì‹œë³´ë“œ
- [ ] í†µê³„ í‘œì‹œ (íšŒì› ìˆ˜, ê²Œì‹œê¸€ ìˆ˜ ë“±)
- [ ] ìµœê·¼ í™œë™ í‘œì‹œ

### 8.2 íšŒì› ê´€ë¦¬
- [ ] íšŒì› ëª©ë¡ í‘œì‹œ
- [ ] íšŒì› ì—­í•  ë³€ê²½ (member/admin/master)
- [ ] ë©¤ë²„ì‹­ í‹°ì–´ ë³€ê²½
- [ ] ë±ƒì§€ ë¶€ì—¬/ìŠ¹ì¸

### 8.3 ë±ƒì§€ ê´€ë¦¬
- [ ] ë±ƒì§€ ëª©ë¡ í‘œì‹œ
- [ ] ë±ƒì§€ ìƒì„±/ìˆ˜ì •/ì‚­ì œ
- [ ] ë±ƒì§€ í™œì„±í™”/ë¹„í™œì„±í™”
- [ ] ì‚¬ìš©ìë³„ ë±ƒì§€ ê´€ë¦¬
- [ ] ë±ƒì§€ ìŠ¹ì¸/ê±°ë¶€

---

## 9. ë°˜ì‘í˜• & ëª¨ë°”ì¼

### 9.1 ë ˆì´ì•„ì›ƒ
- [ ] ì‚¬ì´ë“œë°”: lg ì´ìƒì—ì„œë§Œ í‘œì‹œ
- [ ] ëª¨ë°”ì¼ í—¤ë”: lg ë¯¸ë§Œì—ì„œ í‘œì‹œ
- [ ] í–„ë²„ê±° ë©”ë‰´ ì‘ë™
- [ ] íƒ­ ì „í™˜ ë¶€ë“œëŸ¬ì›€

### 9.2 í„°ì¹˜ ìµœì í™”
- [ ] ë²„íŠ¼ í„°ì¹˜ ì˜ì—­ ì¶©ë¶„
- [ ] ìŠ¤ì™€ì´í”„ ì œìŠ¤ì²˜ (í•´ë‹¹ë˜ëŠ” ê²½ìš°)
- [ ] í•˜ë‹¨ ê³ ì • ë²„íŠ¼ (Safe Area ê³ ë ¤)

---

## 10. ì„±ëŠ¥ & ìµœì í™”

### 10.1 ë¡œë”©
- [ ] í˜ì´ì§€ ì „í™˜ ì‹œ ë¡œë”© ìƒíƒœ í‘œì‹œ
- [ ] ìŠ¤ì¼ˆë ˆí†¤ UI í‘œì‹œ
- [ ] ì´ë¯¸ì§€ ì§€ì—° ë¡œë”©

### 10.2 ìºì‹±
- [ ] ì •ì  í˜ì´ì§€ ìºì‹±
- [ ] ì´ë¯¸ì§€ ìµœì í™” (next/image)
- [ ] revalidatePath ì ìš© í™•ì¸

---

## 11. ì˜¤ë¥˜ ì²˜ë¦¬

### 11.1 404 í˜ì´ì§€
- [ ] ì¡´ì¬í•˜ì§€ ì•ŠëŠ” í˜ì´ì§€ ì ‘ê·¼ ì‹œ í‘œì‹œ
- [ ] í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸° ë²„íŠ¼

### 11.2 ì—ëŸ¬ ë°”ìš´ë”ë¦¬
- [ ] ì˜ˆìƒì¹˜ ëª»í•œ ì˜¤ë¥˜ ìºì¹˜
- [ ] ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ
- [ ] ì¬ì‹œë„ ë²„íŠ¼

### 11.3 ê¶Œí•œ ì˜¤ë¥˜
- [ ] ê¶Œí•œ ì—†ëŠ” í˜ì´ì§€ ì ‘ê·¼ ì‹œ ë¦¬ë‹¤ì´ë ‰íŠ¸
- [ ] ì ì ˆí•œ ë©”ì‹œì§€ í‘œì‹œ

---

## 12. ì ‘ê·¼ì„± (a11y)

- [ ] í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜
- [ ] í¬ì»¤ìŠ¤ í‘œì‹œ
- [ ] alt í…ìŠ¤íŠ¸ (ì´ë¯¸ì§€)
- [ ] aria-label (ì•„ì´ì½˜ ë²„íŠ¼)
- [ ] ì ì ˆí•œ ì œëª© ê³„ì¸µ (h1 > h2 > h3)

---

## 13. ì£¼ìš” ì‚¬ìš©ì ì—¬ì • ì‹œë‚˜ë¦¬ì˜¤

### ì‹œë‚˜ë¦¬ì˜¤ 1: ì‹ ê·œ íšŒì› ê°€ì… ë° í”„ë¡œí•„ ì„¤ì •
1. [ ] ëœë”© í˜ì´ì§€ ì ‘ì† â†’ "ë¡œê·¸ì¸" í´ë¦­
2. [ ] êµ¬ê¸€ ê³„ì •ìœ¼ë¡œ íšŒì›ê°€ì…
3. [ ] Masterì—ê²Œ ê°€ì… ì•Œë¦¼ ì „ì†¡ í™•ì¸
4. [ ] í”„ë¡œí•„ í˜ì´ì§€ë¡œ ìë™ ì´ë™
5. [ ] í”„ë¡œí•„ ì •ë³´ ì…ë ¥ (ì´ë¦„, ì†Œì†, ì†Œê°œê¸€)
6. [ ] í”„ë¡œí•„ ê³µê°œ ì„¤ì •
7. [ ] ë©¤ë²„ ë¦¬ìŠ¤íŠ¸ì—ì„œ ë³¸ì¸ í”„ë¡œí•„ í™•ì¸

### ì‹œë‚˜ë¦¬ì˜¤ 2: ì»¤ë®¤ë‹ˆí‹° ê°€ì… ë° ê¸€ ì‘ì„±
1. [ ] ì»¤ë®¤ë‹ˆí‹° í™ˆ ì ‘ì†
2. [ ] ë°˜ê³¨ ì»¤ë®¤ë‹ˆí‹° ì¹´ë“œ í´ë¦­
3. [ ] "ì°¸ì—¬í•˜ê¸°" ë²„íŠ¼ í´ë¦­
4. [ ] ë©¤ë²„ì‹­ ìŠ¹ì¸ í™•ì¸
5. [ ] "ìƒˆ ê¸€ ì‘ì„±" ë²„íŠ¼ í´ë¦­
6. [ ] ê¸€ ì‘ì„± (ì œëª©, ë³¸ë¬¸, ì´ë¯¸ì§€)
7. [ ] ì‘ì„± ì™„ë£Œ í›„ ê²Œì‹œíŒì—ì„œ í™•ì¸

### ì‹œë‚˜ë¦¬ì˜¤ 3: ì´ë²¤íŠ¸ ì°¸ê°€
1. [ ] ì´ë²¤íŠ¸ ëª©ë¡ í˜ì´ì§€ ì ‘ì†
2. [ ] ê´€ì‹¬ ìˆëŠ” ì´ë²¤íŠ¸ í´ë¦­
3. [ ] ì´ë²¤íŠ¸ ìƒì„¸ ì •ë³´ í™•ì¸
4. [ ] "ì°¸ê°€ ì‹ ì²­" ë²„íŠ¼ í´ë¦­
5. [ ] ì°¸ê°€ ì‹ ì²­ í¼ ì‘ì„±
6. [ ] ì‹ ì²­ ì™„ë£Œ í™•ì¸
7. [ ] í˜¸ìŠ¤íŠ¸ì—ê²Œ ì•Œë¦¼ ì „ì†¡ í™•ì¸

### ì‹œë‚˜ë¦¬ì˜¤ 4: Masterì˜ ì»¤ë®¤ë‹ˆí‹° ê´€ë¦¬
1. [ ] Master ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸
2. [ ] ë°˜ê³¨ ì»¤ë®¤ë‹ˆí‹° ê²Œì‹œíŒ ì ‘ì†
3. [ ] ìš°ì¸¡ ì‚¬ì´ë“œë°”ì—ì„œ ë©¤ë²„ ëª©ë¡ í™•ì¸
4. [ ] ë©¤ë²„ ìœ„ë¡œ í˜¸ë²„ â†’ ì™•ê´€ ì•„ì´ì½˜ í´ë¦­
5. [ ] ë¦¬ë” ì§€ì • í™•ì¸
6. [ ] ë°°ë„ˆ í¸ì§‘ ë²„íŠ¼ í´ë¦­ (í˜¸ë²„ ì‹œ í‘œì‹œ)
7. [ ] ì»¤ë®¤ë‹ˆí‹° ì†Œê°œ ìˆ˜ì •
8. [ ] ì»¤ë®¤ë‹ˆí‹° í™ˆì—ì„œ ì—…ë°ì´íŠ¸ í™•ì¸

### ì‹œë‚˜ë¦¬ì˜¤ 5: ë¦¬ë”ì˜ ì»¤ë®¤ë‹ˆí‹° ê´€ë¦¬
1. [ ] ì»¤ë®¤ë‹ˆí‹° ë¦¬ë” ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸
2. [ ] ë‹´ë‹¹ ì»¤ë®¤ë‹ˆí‹° ê²Œì‹œíŒ ì ‘ì†
3. [ ] ë°°ë„ˆ í¸ì§‘ ë²„íŠ¼ìœ¼ë¡œ ì†Œê°œê¸€ ìˆ˜ì •
4. [ ] ìš°ì¸¡ ì‚¬ì´ë“œë°”ì—ì„œ ê°€ì´ë“œë¼ì¸ ìˆ˜ì •
5. [ ] ë¶€ì ì ˆí•œ ê²Œì‹œê¸€ ì‚­ì œ (ê¶Œí•œ í™•ì¸)

---

## 14. ì•Œë ¤ì§„ ì´ìŠˆ & ê°œì„  ì‚¬í•­

### ìˆ˜ì • ì™„ë£Œ
- [x] ë¹„í™œì„± ë±ƒì§€ê°€ ë©¤ë²„ ë¦¬ìŠ¤íŠ¸/í”„ë¡œí•„ì— í‘œì‹œë˜ì§€ ì•ŠìŒ
- [x] ë©¤ë²„ ë¦¬ìŠ¤íŠ¸ ìƒˆë¡œê³ ì¹¨ ì‹œ ê¹œë¹¡ì„ í•´ê²° (ë¡œë”© ìŠ¤ì¼ˆë ˆí†¤)
- [x] ë©¤ë²„ ì¹´ë“œ 3ì—´ ë ˆì´ì•„ì›ƒ
- [x] ì†Œê°œê¸€ 3ì¤„ í‘œì‹œ
- [x] í”„ë¡œí•„ í˜ì´ì§€ ìš°ì¸¡ ì‚¬ì´ë“œë°” ì œê±°
- [x] /about í˜ì´ì§€ ê¹œë¹¡ì„ í•´ê²°
- [x] ì´ë²¤íŠ¸ ìƒì„¸ í˜ì´ì§€ ë ˆì´ì•„ì›ƒ ì •ë ¬
- [x] ì•Œë¦¼ ì•„ì´ì½˜ ì‚¬ì´ë“œë°”ë¡œ ì´ë™
- [x] ì†Œì…œ ë§í¬ ì œê±°
- [x] ì‹ ê·œ íšŒì› ê°€ì… ì‹œ Master ì•Œë¦¼
- [x] ì»¤ë®¤ë‹ˆí‹° ë¦¬ë” ì§€ì • ê¸°ëŠ¥ (ì»¤ë®¤ë‹ˆí‹°ë³„)
- [x] ì»¤ë®¤ë‹ˆí‹° ì†Œê°œê¸€ í¸ì§‘ (ê° ê²Œì‹œíŒì—ì„œ)

### í™•ì¸ í•„ìš”
- [ ] ì»¤ë®¤ë‹ˆí‹° ë°°ë„ˆ í¸ì§‘ ë²„íŠ¼ í´ë¦­ ë°˜ì‘ (í˜„ì¬ ì´ìŠˆ)
- [ ] ì»¤ë®¤ë‹ˆí‹° ì„¤ëª…ì´ ì»¤ë®¤ë‹ˆí‹° í™ˆ ì¹´ë“œì— í‘œì‹œë˜ëŠ”ì§€ í™•ì¸

---

## ì ê²€ ë°©ë²•

### 1. ë¡œì»¬ ê°œë°œ í™˜ê²½ì—ì„œ í…ŒìŠ¤íŠ¸
```bash
npm run dev
```
- ê° í˜ì´ì§€ë¥¼ ì§ì ‘ ë°©ë¬¸í•˜ì—¬ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
- ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ ì—ëŸ¬ í™•ì¸
- Network íƒ­ì—ì„œ API ìš”ì²­ í™•ì¸

### 2. ë‹¤ì–‘í•œ ê³„ì •ìœ¼ë¡œ í…ŒìŠ¤íŠ¸
- ë¹„ë¡œê·¸ì¸ ì‚¬ìš©ì
- ì¼ë°˜ íšŒì› (member)
- ì»¤ë®¤ë‹ˆí‹° ë¦¬ë”
- Admin
- Master

### 3. ë‹¤ì–‘í•œ ë””ë°”ì´ìŠ¤/ë¸Œë¼ìš°ì €
- Desktop (Chrome, Safari, Firefox)
- Tablet
- Mobile (iOS Safari, Android Chrome)

### 4. ìë™í™” í…ŒìŠ¤íŠ¸ (ì¶”í›„)
```bash
# E2E í…ŒìŠ¤íŠ¸ (Playwright ë“±)
npm run test:e2e

# ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸ (Jest + React Testing Library)
npm run test:unit
```

---

## ìš°ì„ ìˆœìœ„

### P0 (ê¸´ê¸‰)
- [ ] ì»¤ë®¤ë‹ˆí‹° ë°°ë„ˆ í¸ì§‘ ë²„íŠ¼ ì‘ë™ í™•ì¸

### P1 (ë†’ìŒ)
- [ ] ì£¼ìš” ì‚¬ìš©ì ì—¬ì • 5ê°€ì§€ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸
- [ ] ê¶Œí•œ ì‹œìŠ¤í…œ ì „ì²´ ê²€ì¦
- [ ] ì•Œë¦¼ ì‹œìŠ¤í…œ ì‘ë™ í™•ì¸

### P2 (ì¤‘ê°„)
- [ ] ëª¨ë“  CRUD ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
- [ ] ë°˜ì‘í˜• ë ˆì´ì•„ì›ƒ í™•ì¸
- [ ] ì˜¤ë¥˜ ì²˜ë¦¬ í™•ì¸

### P3 (ë‚®ìŒ)
- [ ] ì ‘ê·¼ì„± ê°œì„ 
- [ ] ì„±ëŠ¥ ìµœì í™”
- [ ] UI/UX ì„¸ë¶€ ê°œì„ 
</file>

<file path="TROUBLESHOOTING.md">
# ë¬¸ì œ í•´ê²° ê°€ì´ë“œ: ë¡œê·¸ì¸ ì—†ì´ ë°ì´í„°ê°€ ë³´ì´ì§€ ì•ŠëŠ” ê²½ìš°

## ê°€ëŠ¥í•œ ì›ì¸ë“¤

### 1. ì‹¤ì œë¡œ ë°ì´í„°ê°€ ì—†ëŠ” ê²½ìš° â­ (ê°€ì¥ ê°€ëŠ¥ì„± ë†’ìŒ)
- ë°ì´í„°ë² ì´ìŠ¤ì— ì´ë²¤íŠ¸ë‚˜ ê²Œì‹œê¸€ì´ ì‹¤ì œë¡œ ì—†ëŠ” ê²½ìš°
- í•´ê²°: ë¡œê·¸ì¸í•´ì„œ ë°ì´í„°ë¥¼ í•˜ë‚˜ ë§Œë“¤ê³  ë‹¤ì‹œ í™•ì¸

### 2. RLS ì •ì±… ë¬¸ì œ
- ì¡°ì¸ëœ í…Œì´ë¸”(profiles, board_categories)ì— ëŒ€í•œ RLS ì •ì±…ì´ ì—†ì„ ìˆ˜ ìˆìŒ
- í•´ê²°: `scripts/019_fix_anonymous_access.sql` ì‹¤í–‰

### 3. board_category_idê°€ NULLì¸ ê²Œì‹œê¸€ë“¤
- `board_categories!inner` ì¡°ì¸ì„ ì‚¬ìš©í•˜ë©´ board_category_idê°€ NULLì¸ ê²Œì‹œê¸€ì€ ê²°ê³¼ì—ì„œ ì œì™¸ë¨
- í•´ê²°: ê²Œì‹œê¸€ì˜ board_category_idê°€ ì œëŒ€ë¡œ ì„¤ì •ë˜ì—ˆëŠ”ì§€ í™•ì¸

### 4. ì´ë²¤íŠ¸ ë‚ ì§œ í•„í„° ë¬¸ì œ
- `event_date >= NOW()` ì¡°ê±´ ë•Œë¬¸ì— ê³¼ê±° ì´ë²¤íŠ¸ëŠ” ì•ˆ ë‚˜ì˜´ (ì´ê±´ ì •ìƒ)

### 5. ì¡°ì¸ ì¿¼ë¦¬ì—ì„œ RLS ì •ì±… ì¶©ëŒ
- inner joinì„ ì‚¬ìš©í•  ë•Œ ì¡°ì¸ëœ í…Œì´ë¸”ì—ë„ ì½ê¸° ê¶Œí•œì´ í•„ìš”í•¨

## ë‹¨ê³„ë³„ ë¬¸ì œ í•´ê²°

### Step 1: ë°ì´í„° ì¡´ì¬ í™•ì¸
Supabase SQL Editorì—ì„œ ì‹¤í–‰:
```sql
-- ì´ë²¤íŠ¸ ê°œìˆ˜ í™•ì¸
SELECT COUNT(*) FROM events WHERE event_date >= NOW();

-- ê²Œì‹œê¸€ ê°œìˆ˜ í™•ì¸  
SELECT COUNT(*) FROM posts WHERE board_category_id IS NOT NULL;

-- ì¹´í…Œê³ ë¦¬ í™•ì¸
SELECT * FROM board_categories WHERE is_active = true;
```

### Step 2: RLS ì •ì±… í™•ì¸
`scripts/019_fix_anonymous_access.sql` ì‹¤í–‰ (ì´ë¯¸ ì‹¤í–‰í–ˆë‹¤ë©´ ìŠ¤í‚µ)

### Step 3: ë””ë²„ê·¸ ì¿¼ë¦¬ ì‹¤í–‰
`scripts/021_debug_queries.sql` ì‹¤í–‰í•˜ì—¬ ê° ë‹¨ê³„ë³„ë¡œ ë¬¸ì œ í™•ì¸

### Step 4: ì‹¤ì œ ë°ì´í„°ë¡œ í…ŒìŠ¤íŠ¸
1. ë¡œê·¸ì¸
2. ì´ë²¤íŠ¸ 1ê°œ ìƒì„±
3. ê²Œì‹œê¸€ 1ê°œ ìƒì„± (ì¹´í…Œê³ ë¦¬ ì§€ì • í•„ìˆ˜)
4. ë¡œê·¸ì•„ì›ƒ
5. í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨

## ì¦‰ì‹œ í™•ì¸í•  ê²ƒ

1. **ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬ í™•ì¸**
   - Network íƒ­ì—ì„œ API í˜¸ì¶œ í™•ì¸
   - Console íƒ­ì—ì„œ ì—ëŸ¬ í™•ì¸

2. **Supabase ë¡œê·¸ í™•ì¸**
   - Supabase Dashboard â†’ Logs â†’ API Logs
   - ì—ëŸ¬ê°€ ìˆëŠ”ì§€ í™•ì¸

3. **ë°ì´í„° ì§ì ‘ í™•ì¸**
   - Supabase Dashboard â†’ Table Editor
   - events í…Œì´ë¸”ê³¼ posts í…Œì´ë¸”ì— ë°ì´í„°ê°€ ìˆëŠ”ì§€ í™•ì¸

## ê°€ì¥ ë¹ ë¥¸ í•´ê²° ë°©ë²•

ë§Œì•½ ë°ì´í„°ê°€ ì—†ëŠ” ê²ƒì´ ì›ì¸ì´ë¼ë©´:

1. ë¡œê·¸ì¸
2. ì´ë²¤íŠ¸ ë§Œë“¤ê¸°
3. ê²Œì‹œê¸€ ë§Œë“¤ê¸°
4. ë¡œê·¸ì•„ì›ƒ í›„ í™•ì¸

ì´ë ‡ê²Œ í•´ë„ ì•ˆ ë‚˜ì˜¤ë©´ `scripts/021_debug_queries.sql`ë¥¼ ì‹¤í–‰í•´ì„œ ì–´ë””ì„œ ë¬¸ì œê°€ ë°œìƒí•˜ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.
</file>

<file path="tsconfig.json">
{
  "compilerOptions": {
    "lib": [
      "dom",
      "dom.iterable",
      "esnext"
    ],
    "allowJs": true,
    "target": "ES6",
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "react-jsx",
    "incremental": true,
    // ì¦ë¶„ ì»´íŒŒì¼ ìµœì í™”
    "tsBuildInfoFile": ".next/cache/tsconfig.tsbuildinfo",
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": [
        "./*"
      ]
    }
  },
  "include": [
    "next-env.d.ts",
    "**/*.ts",
    "**/*.tsx",
    ".next/types/**/*.ts",
    ".next/dev/types/**/*.ts"
  ],
  "exclude": [
    "node_modules"
  ]
}
</file>

<file path="VERCEL_ENV_CHECK.md">
# Vercel í™˜ê²½ ë³€ìˆ˜ ì„¤ì • í™•ì¸ ë° í•´ê²°

## ë¬¸ì œ ì§„ë‹¨

ë¡œì»¬ì—ì„œëŠ” ë°ì´í„°ê°€ ë³´ì´ëŠ”ë° ë°°í¬ ì‚¬ì´íŠ¸ì—ì„œëŠ” ì•ˆ ë³´ì´ëŠ” ê²½ìš°:

**ì›ì¸:** Vercelì— í™˜ê²½ ë³€ìˆ˜ê°€ ì œëŒ€ë¡œ ì„¤ì •ë˜ì§€ ì•Šì•˜ì„ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤.

## í•´ê²° ë°©ë²•

### 1. Vercel í™˜ê²½ ë³€ìˆ˜ í™•ì¸

1. **Vercel ëŒ€ì‹œë³´ë“œ ì ‘ì†**
   - https://vercel.com/dashboard
   - í”„ë¡œì íŠ¸ ì„ íƒ

2. **Settings â†’ Environment Variables ì´ë™**

3. **í•„ìš”í•œ í™˜ê²½ ë³€ìˆ˜ í™•ì¸:**
   ```
   NEXT_PUBLIC_SUPABASE_URL=your-supabase-url
   NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
   ```

4. **í™˜ê²½ ë³€ìˆ˜ê°€ ìˆëŠ”ì§€ í™•ì¸:**
   - ìˆìœ¼ë©´ â†’ ê°’ì´ ì˜¬ë°”ë¥¸ì§€ í™•ì¸
   - ì—†ìœ¼ë©´ â†’ ì¶”ê°€ í•„ìš”

### 2. í™˜ê²½ ë³€ìˆ˜ ì¶”ê°€/ìˆ˜ì •

1. **Supabase ëŒ€ì‹œë³´ë“œì—ì„œ ê°’ í™•ì¸**
   - https://supabase.com/dashboard
   - í”„ë¡œì íŠ¸ ì„ íƒ
   - Settings â†’ API ì´ë™
   - **Project URL** ë³µì‚¬ â†’ `NEXT_PUBLIC_SUPABASE_URL`
   - **anon public** í‚¤ ë³µì‚¬ â†’ `NEXT_PUBLIC_SUPABASE_ANON_KEY`

2. **Vercelì— í™˜ê²½ ë³€ìˆ˜ ì¶”ê°€**
   - Vercel â†’ Settings â†’ Environment Variables
   - Add New ë²„íŠ¼ í´ë¦­
   - Key: `NEXT_PUBLIC_SUPABASE_URL`
   - Value: Supabase Project URL ë¶™ì—¬ë„£ê¸°
   - Environment: Production, Preview, Development ëª¨ë‘ ì„ íƒ
   - Save

   - ë‹¤ì‹œ Add New ë²„íŠ¼ í´ë¦­
   - Key: `NEXT_PUBLIC_SUPABASE_ANON_KEY`
   - Value: Supabase anon key ë¶™ì—¬ë„£ê¸°
   - Environment: Production, Preview, Development ëª¨ë‘ ì„ íƒ
   - Save

### 3. ì¬ë°°í¬

í™˜ê²½ ë³€ìˆ˜ë¥¼ ì¶”ê°€/ìˆ˜ì •í•œ í›„:

1. **ìë™ ì¬ë°°í¬ í™•ì¸**
   - Vercelì´ ìë™ìœ¼ë¡œ ì¬ë°°í¬ë¥¼ ì‹œì‘í•  ìˆ˜ ìˆìŒ
   - Deployments íƒ­ì—ì„œ í™•ì¸

2. **ìˆ˜ë™ ì¬ë°°í¬ (í•„ìš”ì‹œ)**
   - Deployments íƒ­
   - ê°€ì¥ ìµœê·¼ ë°°í¬ì˜ "..." ë©”ë‰´ í´ë¦­
   - "Redeploy" ì„ íƒ
   - ë˜ëŠ” GitHubì— ìƒˆë¡œìš´ ì»¤ë°‹ í‘¸ì‹œ

### 4. í™•ì¸

ì¬ë°°í¬ ì™„ë£Œ í›„:
1. ë°°í¬ ì‚¬ì´íŠ¸ ì ‘ì† (https://sfc-ten.vercel.app/)
2. í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ (Ctrl+Shift+Rë¡œ ìºì‹œ í´ë¦¬ì–´)
3. ë¡œê·¸ì¸ ì—†ì´ ë°ì´í„°ê°€ ë³´ì´ëŠ”ì§€ í™•ì¸

## í™˜ê²½ ë³€ìˆ˜ í™•ì¸ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] `NEXT_PUBLIC_SUPABASE_URL`ì´ Vercelì— ì„¤ì •ë˜ì–´ ìˆëŠ”ê°€?
- [ ] `NEXT_PUBLIC_SUPABASE_ANON_KEY`ê°€ Vercelì— ì„¤ì •ë˜ì–´ ìˆëŠ”ê°€?
- [ ] í™˜ê²½ ë³€ìˆ˜ ê°’ì´ ë¡œì»¬ì˜ `.env.local`ê³¼ ë™ì¼í•œê°€?
- [ ] Production, Preview, Development ëª¨ë“  í™˜ê²½ì— ì„¤ì •ë˜ì–´ ìˆëŠ”ê°€?
- [ ] ì¬ë°°í¬ê°€ ì™„ë£Œë˜ì—ˆëŠ”ê°€?

## ë¡œì»¬ í™˜ê²½ ë³€ìˆ˜ í™•ì¸ (ì°¸ê³ )

ë¡œì»¬ì—ì„œ í™˜ê²½ ë³€ìˆ˜ê°€ ì–´ë–»ê²Œ ì„¤ì •ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸:

```bash
# .env.local íŒŒì¼ í™•ì¸ (Gitì— ì»¤ë°‹ë˜ì§€ ì•ŠìŒ)
cat .env.local

# ë˜ëŠ”
type .env.local  # Windows
```

ì´ ê°’ë“¤ì´ Vercelì—ë„ ë™ì¼í•˜ê²Œ ì„¤ì •ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.

## ì¶”ê°€ í™•ì¸ ì‚¬í•­

ë§Œì•½ í™˜ê²½ ë³€ìˆ˜ê°€ ì œëŒ€ë¡œ ì„¤ì •ë˜ì–´ ìˆëŠ”ë°ë„ ì•ˆ ë³´ì¸ë‹¤ë©´:

1. **ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬ í™•ì¸**
   - F12 â†’ Console íƒ­
   - Network íƒ­ì—ì„œ API ìš”ì²­ í™•ì¸
   - ì—ëŸ¬ ë©”ì‹œì§€ í™•ì¸

2. **Vercel ë¡œê·¸ í™•ì¸**
   - Vercel Dashboard â†’ Deployments
   - ìµœê·¼ ë°°í¬ í´ë¦­ â†’ Functions íƒ­
   - ì—ëŸ¬ ë¡œê·¸ í™•ì¸

3. **Supabase RLS ì •ì±… ì¬í™•ì¸**
   - scripts/017_ensure_public_read_policies.sql ì¬ì‹¤í–‰
</file>

<file path="vercel.json">
{
  "buildCommand": "npm run build",
  "installCommand": "npm install"
}
</file>

<file path="app/about/about-content.tsx">
"use client"

import { useState, useMemo } from "react"
import { Card, CardContent } from "@/components/ui/card"
import { Users, Zap, Handshake, TrendingUp, ArrowRight, Target, ChevronDown, ChevronUp, Shield, Award, Star } from "lucide-react"
import Link from "next/link"
import Image from "next/image"
import { Button } from "@/components/ui/button"

type Badge = {
  id: string
  name: string
  icon: string
  category: string
  description: string | null
}

type BadgeCategory = {
  category_value: string
  category_label: string
  sort_order: number
}

type AboutContentProps = {
  badges: Badge[]
  badgeCategories?: BadgeCategory[]
  isLoggedIn?: boolean
}

const categoryConfig = {
  personal_asset: {
    label: "ê°œì¸ ìì‚° (Asset)",
    icon: "ğŸ’°",
    bgColor: "bg-green-100/50",
    textColor: "text-green-700"
  },
  corporate_revenue: {
    label: "ê¸°ì—… ë§¤ì¶œ (Revenue)",
    icon: "ğŸ“ˆ",
    bgColor: "bg-blue-100/50",
    textColor: "text-blue-700"
  },
  investment: {
    label: "íˆ¬ì ê·œëª¨ (Investment Tier)",
    icon: "ğŸ’°",
    bgColor: "bg-amber-100/50",
    textColor: "text-amber-700"
  },
  valuation: {
    label: "ê¸°ì—…ê°€ì¹˜ (Valuation Tier)",
    icon: "ğŸ™ï¸",
    bgColor: "bg-indigo-100/50",
    textColor: "text-indigo-700"
  },
  influence: {
    label: "ì¸í”Œë£¨ì–¸ì„œ (Influence Tier)",
    icon: "ğŸ“£",
    bgColor: "bg-red-100/50",
    textColor: "text-red-700"
  },
  professional: {
    label: "ì „ë¬¸ì§ (Professional License)",
    icon: "âš–ï¸",
    bgColor: "bg-blue-100/50",
    textColor: "text-blue-700"
  },
  community: {
    label: "ì»¤ë®¤ë‹ˆí‹° (Community)",
    icon: "ğŸ›¡ï¸",
    bgColor: "bg-purple-100/50",
    textColor: "text-purple-700"
  }
} as const

export default function AboutContent({ badges, badgeCategories = [], isLoggedIn = false }: AboutContentProps) {
  const [isBadgeExpanded, setIsBadgeExpanded] = useState(false)

  // ì¹´í…Œê³ ë¦¬ë³„ë¡œ ë±ƒì§€ ê·¸ë£¹í™” (ê´€ë¦¬ì ì„¤ì • ìˆœì„œ ì ìš©)
  const badgesByCategory = useMemo(() => {
    const grouped: Record<string, Badge[]> = {}
    badges.forEach((badge) => {
      if (!grouped[badge.category]) {
        grouped[badge.category] = []
      }
      grouped[badge.category].push(badge)
    })
    return grouped
  }, [badges])

  // ê´€ë¦¬ì ì„¤ì • ìˆœì„œëŒ€ë¡œ ì¹´í…Œê³ ë¦¬ ì •ë ¬
  const sortedCategories = useMemo(() => {
    if (badgeCategories.length === 0) {
      // badge_categories ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ê¸°ì¡´ ìˆœì„œ ìœ ì§€
      return Object.keys(badgesByCategory)
    }

    // sort_order ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬ëœ ì¹´í…Œê³ ë¦¬ ëª©ë¡
    const sorted = [...badgeCategories]
      .sort((a, b) => {
        // 1ì°¨ ì •ë ¬: sort_order
        if (a.sort_order !== b.sort_order) {
          return a.sort_order - b.sort_order
        }
        // 2ì°¨ ì •ë ¬: created_at (categoryConfigì— ìˆëŠ” ìˆœì„œ)
        return 0
      })
      .map(cat => cat.category_value)
      .filter(cat => badgesByCategory[cat] && badgesByCategory[cat].length > 0) // ë±ƒì§€ê°€ ìˆëŠ” ì¹´í…Œê³ ë¦¬ë§Œ

    // badge_categoriesì— ì—†ëŠ” ì¹´í…Œê³ ë¦¬ë„ ì¶”ê°€ (ê¸°ì¡´ ë±ƒì§€ê°€ ìˆëŠ” ê²½ìš°)
    const allCategories = new Set([...sorted, ...Object.keys(badgesByCategory)])
    return Array.from(allCategories)
  }, [badgeCategories, badgesByCategory])

  return (
    <div className="w-full flex flex-col gap-6">
      {/* Hero Section */}
      <div className="relative w-full overflow-hidden rounded-2xl bg-slate-900 shadow-md mb-10">
        <div className="absolute inset-0">
          <div className="relative w-full h-full">
            <Image
              src="https://images.unsplash.com/photo-1477959858617-67f85cf4f1df?q=80&w=2613&auto=format&fit=crop"
              alt="Background"
              fill
              sizes="100vw"
              className="object-cover opacity-20"
              priority
            />
          </div>
          <div className="absolute inset-0 bg-gradient-to-r from-slate-900/95 via-slate-900/80 to-slate-900/95" />
        </div>

        <div className="relative z-10 px-4 py-8 md:py-10 flex flex-col items-center text-center w-full">
          <div className="inline-block px-3 py-0.5 mb-3 rounded-full border border-slate-600 bg-slate-800/50 text-slate-300 text-[10px] font-medium tracking-wider backdrop-blur-sm">
            SEOUL FOUNDERS CLUB
          </div>
          <h1 className="text-xl md:text-3xl lg:text-4xl font-bold text-white mb-3 leading-tight tracking-tight">
            <span className="text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-400">ìƒˆë¡œìš´ ê°€ì¹˜</span>ë¥¼ ë§Œë“œëŠ” ì‚¬ëŒë“¤ì˜ ë² ì´ìŠ¤ìº í”„
          </h1>
          <div className="text-slate-400 text-xs md:text-sm leading-relaxed w-full mb-5 text-center">
            <p>
              ì„œìš¸ì„ ê¸°ë°˜ìœ¼ë¡œ í™œë™í•˜ëŠ” <strong>ì°½ì—…ê°€, íˆ¬ìì, í¬ë¦¬ì—ì´í„°</strong>ê°€ ëª¨ì—¬
            </p>
            <p className="hidden md:block">
              ì‹ ë¢°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì—°ê²°ë˜ê³ , í•¨ê»˜ ì„±ì¥í•˜ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ì»¤ë®¤ë‹ˆí‹°ì…ë‹ˆë‹¤.
            </p>
            <p className="md:hidden">
              ì‹ ë¢°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì—°ê²°ë˜ê³ , í•¨ê»˜ ì„±ì¥í•˜ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ì»¤ë®¤ë‹ˆí‹°ì…ë‹ˆë‹¤.
            </p>
          </div>
          <Link href="/auth/login">
            <Button
              size="sm"
              className="h-10 px-6 text-sm bg-white text-slate-900 hover:bg-slate-100 hover:scale-[1.02] transition-all duration-300 rounded-full font-bold shadow-lg border-0"
            >
              3ì´ˆë§Œì— ê°€ì…í•˜ê¸°
            </Button>
          </Link>
        </div>
      </div>

      {/* WHO WE ARE */}
      <div className="py-16 px-6 bg-white rounded-xl shadow-sm">
        <div className="w-full">
          <div className="text-center mb-16">
            <h2 className="text-3xl font-bold text-slate-900 mb-4">ìš°ë¦¬ëŠ” ì„œë¡œì˜ ì„±ì¥ ë™ë ¥ì…ë‹ˆë‹¤</h2>
            <p className="text-slate-500 text-lg">ê°ìì˜ ì˜ì—­ì—ì„œ ì„±ê³¼ë¥¼ ì¦ëª…í•œ ë¦¬ë”ë“¤ì´ ëª¨ì…ë‹ˆë‹¤.</p>
          </div>
          <div className="grid md:grid-cols-3 gap-8">
            {/* ì°½ì—…ê°€ */}
            <div className="flex flex-col items-center text-center group">
              <div className="w-20 h-20 rounded-2xl bg-blue-50 flex items-center justify-center text-blue-600 mb-6 group-hover:scale-110 transition-transform duration-300">
                <Target className="h-10 w-10" />
              </div>
              <h3 className="text-xl font-bold text-slate-900 mb-2">ì°½ì—…ê°€ & ì‚¬ì—…ê°€</h3>
              <p className="text-slate-500 leading-relaxed text-sm">
                ë¬¸ì œë¥¼ í•´ê²°í•˜ê³  ì„¸ìƒì„ ë°”ê¾¸ëŠ”<br />
                ë¹„ì¦ˆë‹ˆìŠ¤ ë¹Œë” (Builder)
              </p>
            </div>
            {/* íˆ¬ìì */}
            <div className="flex flex-col items-center text-center group">
              <div className="w-20 h-20 rounded-2xl bg-green-50 flex items-center justify-center text-green-600 mb-6 group-hover:scale-110 transition-transform duration-300">
                <TrendingUp className="h-10 w-10" />
              </div>
              <h3 className="text-xl font-bold text-slate-900 mb-2">íˆ¬ìì</h3>
              <p className="text-slate-500 leading-relaxed text-sm">
                ê°€ëŠ¥ì„±ì„ ì•Œì•„ë³´ê³  ìì›ì„ ë”í•´ì£¼ëŠ”<br />
                ì„±ì¥ ì¡°ë ¥ì (Backer)
              </p>
            </div>
            {/* í¬ë¦¬ì—ì´í„° */}
            <div className="flex flex-col items-center text-center group">
              <div className="w-20 h-20 rounded-2xl bg-purple-50 flex items-center justify-center text-purple-600 mb-6 group-hover:scale-110 transition-transform duration-300">
                <Zap className="h-10 w-10" />
              </div>
              <h3 className="text-xl font-bold text-slate-900 mb-2">ì¸í”Œë£¨ì–¸ì„œ & í¬ë¦¬ì—ì´í„°</h3>
              <p className="text-slate-500 leading-relaxed text-sm">
                ìŠ¤í† ë¦¬ì™€ ì˜í–¥ë ¥ìœ¼ë¡œ ê°€ì¹˜ë¥¼ ì „íŒŒí•˜ëŠ”<br />
                ë©”ì‹ ì € (Storyteller)
              </p>
            </div>
          </div>
        </div>
      </div>

      {/* WHAT YOU GET */}
      <div className="py-20 px-6 bg-slate-50">
        <div className="w-full">
          <div className="flex flex-col md:flex-row justify-between items-end mb-12 gap-4">
            <div>
              <span className="text-blue-600 font-bold tracking-wide text-sm uppercase mb-2 block">Opportunities</span>
              <h2 className="text-3xl md:text-4xl font-bold text-slate-900">
                SFCê°€ ë“œë¦¬ëŠ”<br />3ê°€ì§€ í•µì‹¬ ê°€ì¹˜
              </h2>
            </div>
            <p className="text-slate-500 text-right leading-relaxed">
              í˜¼ìì„œëŠ” ì–»ê¸° í˜ë“  ê¸°íšŒë“¤ì„ ì—°ê²°í•©ë‹ˆë‹¤.<br />
              ê²€ì¦ëœ ë©¤ë²„ë“¤ê³¼ í•¨ê»˜ ì„±ì¥ì˜ ì†ë„ë¥¼ ë†’ì´ì„¸ìš”.
            </p>
          </div>

          <div className="grid md:grid-cols-3 gap-6">
            {/* ì¹´ë“œ 1 */}
            <Card className="bg-white border-none rounded-xl shadow-sm hover:shadow-md transition-shadow duration-300 overflow-hidden h-full">
              <CardContent className="p-8 h-full flex flex-col">
                <div className="h-12 w-12 bg-slate-900 rounded-lg flex items-center justify-center text-white mb-6">
                  <Users className="h-6 w-6" />
                </div>
                <h3 className="text-xl font-bold text-slate-900 mb-3">ê²€ì¦ëœ ë„¤íŠ¸ì›Œí¬</h3>
                <p className="text-slate-500 mb-6 flex-1 leading-relaxed">
                  ì•„ë¬´ë‚˜ ë§Œë‚˜ëŠ” ëª¨ì„ì´ ì•„ë‹™ë‹ˆë‹¤. ì¸ì¦ ë±ƒì§€ ì‹œìŠ¤í…œì„ í†µí•´ ì‹ ì›ì´ ê²€ì¦ëœ, ê²°ì´ ë§ëŠ” ì‚¬ëŒë“¤ê³¼ ê¹Šì´ ìˆê²Œ êµë¥˜í•©ë‹ˆë‹¤.
                </p>
                <ul className="space-y-2 text-sm text-slate-700 font-medium">
                  <li className="flex items-center gap-2">
                    <span className="w-1.5 h-1.5 bg-blue-500 rounded-full" />
                    C-Level í”„ë¼ì´ë¹— ë””ë„ˆ
                  </li>
                  <li className="flex items-center gap-2">
                    <span className="w-1.5 h-1.5 bg-blue-500 rounded-full" />
                    ì‚°ì—…êµ°ë³„ ì†Œëª¨ì„
                  </li>
                </ul>
              </CardContent>
            </Card>

            {/* ì¹´ë“œ 2 */}
            <Card className="bg-white border-none rounded-xl shadow-sm hover:shadow-md transition-shadow duration-300 overflow-hidden h-full">
              <CardContent className="p-8 h-full flex flex-col">
                <div className="h-12 w-12 bg-slate-900 rounded-lg flex items-center justify-center text-white mb-6">
                  <Zap className="h-6 w-6" />
                </div>
                <h3 className="text-xl font-bold text-slate-900 mb-3">ì‹¤ì „ ì¸ì‚¬ì´íŠ¸</h3>
                <p className="text-slate-500 mb-6 flex-1 leading-relaxed">
                  ì±…ì´ë‚˜ ë‰´ìŠ¤ì—ëŠ” ì—†ëŠ”, í˜„ì¥ì˜ ì§„ì§œ ì´ì•¼ê¸°ë¥¼ ê³µìœ í•©ë‹ˆë‹¤. ì„±ê³µê³¼ ì‹¤íŒ¨ì˜ ê²½í—˜ì„ í†µí•´ ì‹œí–‰ì°©ì˜¤ë¥¼ ì¤„ì…ë‹ˆë‹¤.
                </p>
                <ul className="space-y-2 text-sm text-slate-700 font-medium">
                  <li className="flex items-center gap-2">
                    <span className="w-1.5 h-1.5 bg-purple-500 rounded-full" />
                    ì „ë¬¸ê°€ ì´ˆì²­ ë…ì  ì„¸ë¯¸ë‚˜
                  </li>
                  <li className="flex items-center gap-2">
                    <span className="w-1.5 h-1.5 bg-purple-500 rounded-full" />
                    íˆ¬ì ìœ ì¹˜ & ìŠ¤ì¼€ì¼ì—… ë…¸í•˜ìš°
                  </li>
                </ul>
              </CardContent>
            </Card>

            {/* ì¹´ë“œ 3 */}
            <Card className="bg-white border-none rounded-xl shadow-sm hover:shadow-md transition-shadow duration-300 overflow-hidden h-full">
              <CardContent className="p-8 h-full flex flex-col">
                <div className="h-12 w-12 bg-slate-900 rounded-lg flex items-center justify-center text-white mb-6">
                  <Handshake className="h-6 w-6" />
                </div>
                <h3 className="text-xl font-bold text-slate-900 mb-3">ë¹„ì¦ˆë‹ˆìŠ¤ ê¸°íšŒ</h3>
                <p className="text-slate-500 mb-6 flex-1 leading-relaxed">
                  ë‹¨ìˆœí•œ ì¹œëª©ì„ ë„˜ì–´ ì‹¤ì§ˆì ì¸ ë¹„ì¦ˆë‹ˆìŠ¤ ì„±ê³¼ë¥¼ ë§Œë“­ë‹ˆë‹¤. ê³µë™ ì°½ì—…, ì±„ìš©, íˆ¬ì, ì œíœ´ê°€ ìì—°ìŠ¤ëŸ½ê²Œ ì¼ì–´ë‚©ë‹ˆë‹¤.
                </p>
                <ul className="space-y-2 text-sm text-slate-700 font-medium">
                  <li className="flex items-center gap-2">
                    <span className="w-1.5 h-1.5 bg-green-500 rounded-full" />
                    ê³µë™ ì°½ì—…ì & í•µì‹¬ ì¸ì¬ ë§¤ì¹­
                  </li>
                  <li className="flex items-center gap-2">
                    <span className="w-1.5 h-1.5 bg-green-500 rounded-full" />
                    IR í”¼ì¹­ ë° íˆ¬ì ì—°ê³„
                  </li>
                </ul>
              </CardContent>
            </Card>
          </div>
        </div>
      </div>

      {/* Badge Section */}
      <div className="py-20 px-6 bg-white rounded-xl shadow-sm">
        <div className="w-full">
          <h2 className="mb-8 text-center text-3xl font-bold text-slate-900">
            ì‹ ë¢°ë¥¼ ì¦ëª…í•˜ëŠ” ë±ƒì§€ ì‹œìŠ¤í…œ
          </h2>
          <p className="text-center text-slate-600 mb-10 text-lg whitespace-normal">
            Seoul Founders Clubì˜ ê²€ì¦ëœ ìê²©ê³¼ ì„±ê³¼ë¥¼ ì¸ì¦ë°›ì•„ ë©¤ë²„ë“¤ì˜ ì‹ ë¢°ë¥¼ ì–»ëŠ” ë±ƒì§€ì…ë‹ˆë‹¤.
          </p>

          <div className="flex justify-center gap-6 mb-8 flex-wrap">
            <div className="flex flex-col items-center gap-2">
              <div className="w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center">
                <Shield className="h-6 w-6 text-blue-600" />
              </div>
              <span className="text-sm font-medium text-slate-700">ì¸ì¦</span>
            </div>
            <div className="flex flex-col items-center gap-2">
              <div className="w-12 h-12 rounded-full bg-purple-100 flex items-center justify-center">
                <Award className="h-6 w-6 text-purple-600" />
              </div>
              <span className="text-sm font-medium text-slate-700">í™œë™</span>
            </div>
            <div className="flex flex-col items-center gap-2">
              <div className="w-12 h-12 rounded-full bg-amber-100 flex items-center justify-center">
                <Star className="h-6 w-6 text-amber-600" />
              </div>
              <span className="text-sm font-medium text-slate-700">ê¸°ì—¬</span>
            </div>
            <div className="flex flex-col items-center gap-2">
              <div className="w-12 h-12 rounded-full bg-green-100 flex items-center justify-center">
                <TrendingUp className="h-6 w-6 text-green-600" />
              </div>
              <span className="text-sm font-medium text-slate-700">ì„±ì¥</span>
            </div>
          </div>

          <div className="flex justify-center mb-6">
            <Button
              variant="outline"
              onClick={() => setIsBadgeExpanded(!isBadgeExpanded)}
              className="rounded-full w-12 h-12 p-0 bg-slate-50 hover:bg-slate-100 border-slate-200 transition-all duration-300"
              aria-label={isBadgeExpanded ? "ì ‘ê¸°" : "ë±ƒì§€ ì¢…ë¥˜ ìì„¸íˆ ë³´ê¸°"}
            >
              {isBadgeExpanded ? (
                <ChevronUp className="h-5 w-5 text-slate-700" />
              ) : (
                <ChevronDown className="h-5 w-5 text-slate-700" />
              )}
            </Button>
          </div>

          <div
            className={[
              "overflow-hidden transition-all duration-500 ease-in-out",
              isBadgeExpanded ? "max-h-[5000px] opacity-100" : "max-h-0 opacity-0",
            ].join(" ")}
          >
            {isBadgeExpanded && (
              <>
                <div className="space-y-12">
                  {sortedCategories.map((category) => {
                    const categoryBadges = badgesByCategory[category]
                    if (!categoryBadges || categoryBadges.length === 0) return null

                    const config = categoryConfig[category as keyof typeof categoryConfig] || {
                      label: category,
                      icon: "ğŸ·ï¸",
                      bgColor: "bg-slate-100/50",
                      textColor: "text-slate-700"
                    }

                    const categoryInfo = badgeCategories.find(cat => cat.category_value === category)
                    const categoryLabel = categoryInfo?.category_label || config.label

                    const shouldSortByNumber = ['corporate_revenue', 'investment', 'valuation', 'influence'].includes(category)

                    const sortedBadges = shouldSortByNumber
                      ? [...categoryBadges].sort((a, b) => {
                        if (a.name.includes('ìœ ë‹ˆì½˜')) return 1
                        if (b.name.includes('ìœ ë‹ˆì½˜')) return -1

                        const extractNumber = (name: string): number => {
                          const match = name.match(/(\d+(?:\.\d+)?)\s*(ì–µ|ë§Œ|ì¡°)?/)
                          if (!match) return 0

                          const num = parseFloat(match[1])
                          const unit = match[2]

                          if (unit === 'ì¡°') return num * 1000000000000
                          if (unit === 'ì–µ') return num * 100000000
                          if (unit === 'ë§Œ') return num * 10000
                          return num
                        }

                        return extractNumber(a.name) - extractNumber(b.name)
                      })
                      : categoryBadges

                    return (
                      <div key={category}>
                        <h3 className="mb-6 text-xl font-bold text-slate-900 border-b border-slate-200 pb-3 flex items-center gap-2">
                          <span className="text-2xl pt-1">{config.icon}</span>
                          {categoryLabel}
                        </h3>
                        <div className="grid gap-4 grid-cols-2 lg:grid-cols-3">
                          {sortedBadges.map((badge) => (
                            <Card
                              key={badge.id}
                              className={[
                                "p-3 rounded-xl shadow-sm border-none transition-shadow hover:shadow-md",
                                config.bgColor,
                                config.textColor,
                              ].join(" ")}
                            >
                              <div className="flex items-start gap-3">
                                <div className="hidden md:block flex-shrink-0 text-xl pt-1 text-slate-700">
                                  <span className="text-2xl">{badge.icon}</span>
                                </div>
                                <div className="flex-1 min-w-0">
                                  <div className="font-semibold text-slate-900 leading-tight line-clamp-1">
                                    {badge.name}
                                  </div>
                                  <div className="text-xs text-slate-700 mt-0.5 leading-snug line-clamp-1">
                                    {badge.description || "-"}
                                  </div>
                                </div>
                              </div>
                            </Card>
                          ))}
                        </div>
                      </div>
                    )
                  })}
                </div>

                <div className="mt-12 p-4 rounded-xl bg-blue-50 border border-blue-100 text-center shadow-sm">
                  <p className="text-sm text-blue-700 font-medium">
                    ëª¨ë“  ë±ƒì§€ëŠ” ê´€ë¦¬ì ê²€ì¦ì„ í†µí•´ ì¸ì¦ë˜ë©´ í”„ë¡œí•„ì— í‘œì‹œë©ë‹ˆë‹¤.
                  </p>
                </div>
              </>
            )}
          </div>
        </div>
      </div>

      {/* CTA */}
      <div className="py-24 px-6 bg-white text-center">
        <div className="w-full">
          <h2 className="text-3xl md:text-4xl font-bold text-slate-900 mb-6">
            ì¤€ë¹„ë˜ì…¨ë‚˜ìš”?
          </h2>
          <p className="text-lg text-slate-600 mb-10 leading-relaxed">
            ë‹¹ì‹ ì˜ ì„±ì¥ì„ ê°€ì†í™”í•  íŒŒíŠ¸ë„ˆë“¤ì´ ê¸°ë‹¤ë¦¬ê³  ìˆìŠµë‹ˆë‹¤.<br />
            ì§€ê¸ˆ Seoul Founders Clubì— í•©ë¥˜í•˜ì„¸ìš”.
          </p>
          <div className="flex justify-center">
            <Link href={isLoggedIn ? "/" : "/auth/login"}>
              <Button size="lg" className="h-14 px-8 rounded-full text-base bg-slate-900 hover:bg-slate-800 text-white shadow-lg hover:shadow-xl hover:-translate-y-0.5 transition-all">
                ê°€ì…í•˜ê¸° <ArrowRight className="ml-2 h-4 w-4" />
              </Button>
            </Link>
          </div>
        </div>
      </div>
    </div>
  )
}
</file>

<file path="app/admin/events/page.tsx">
import { requireAdmin } from "@/lib/auth/server"
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import { Button } from "@/components/ui/button"
import Link from "next/link"
import { Calendar, MapPin, Users, User, Settings } from "lucide-react"
import { DeleteEventButton } from "@/components/delete-event-button"
import Image from "next/image"
import { AdminBreadcrumb } from "@/components/admin/admin-breadcrumb"

export default async function AdminEventsPage() {
  const { supabase } = await requireAdmin()

  // Fetch all events
  const { data: events } = await supabase
    .from("events")
    .select(`
      id,
      title,
      thumbnail_url,
      event_date,
      location,
      max_participants,
      created_at,
      profiles:created_by (
        id,
        full_name,
        avatar_url
      )
    `)
    .order("created_at", { ascending: false })

  // Fetch registration counts for each event
  const eventsWithCounts = await Promise.all(
    (events || []).map(async (event) => {
      const { count } = await supabase
        .from("event_registrations")
        .select("*", { count: "exact", head: true })
        .eq("event_id", event.id)

      return {
        ...event,
        participantCount: count || 0,
      }
    })
  )

  return (
    <div className="min-h-screen bg-slate-50 p-4 md:p-8 pt-20 md:pt-8">
      <div className="mx-auto max-w-7xl">
        <AdminBreadcrumb items={[{ label: "ì´ë²¤íŠ¸ ê´€ë¦¬" }]} />

        <div className="mb-8">
          <h1 className="text-3xl font-bold tracking-tight text-slate-900">ì´ë²¤íŠ¸ ê´€ë¦¬</h1>
          <p className="mt-2 text-slate-600">ì „ì²´ ì´ë²¤íŠ¸ ëª©ë¡ ë° ê´€ë¦¬</p>
        </div>

        <Card className="border-slate-200">
          <CardHeader>
            <CardTitle>ì´ë²¤íŠ¸ ëª©ë¡ ({eventsWithCounts.length}ê°œ)</CardTitle>
          </CardHeader>
          <CardContent>
            {eventsWithCounts.length > 0 ? (
              <div className="space-y-4">
                {eventsWithCounts.map((event) => {
                  const eventDate = new Date(event.event_date)
                  const dateStr = eventDate.toLocaleDateString("ko-KR", {
                    year: "numeric",
                    month: "long",
                    day: "numeric",
                    hour: "2-digit",
                    minute: "2-digit",
                  })

                  const ownerName = (() => {
                    const profile: any = (event as any).profiles
                    const first = Array.isArray(profile) ? profile[0] : profile
                    return first?.full_name || "ì•Œ ìˆ˜ ì—†ìŒ"
                  })()

                  return (
                    <div
                      key={event.id}
                      className="flex flex-col gap-4 rounded-lg border border-slate-200 bg-white p-6 lg:flex-row lg:items-center"
                    >
                      {/* ì¸ë„¤ì¼ */}
                      <div className="relative h-32 w-32 flex-shrink-0 overflow-hidden rounded-xl bg-slate-100 lg:h-24 lg:w-24">
                        {event.thumbnail_url ? (
                          <Image
                            src={event.thumbnail_url}
                            alt={event.title}
                            fill
                            sizes="96px"
                            className="object-cover"
                          />
                        ) : (
                          <div className="flex h-full w-full items-center justify-center text-slate-400">
                            <Calendar className="h-8 w-8" />
                          </div>
                        )}
                      </div>

                      {/* ì´ë²¤íŠ¸ ì •ë³´ */}
                      <div className="flex-1 space-y-2">
                        <h3 className="text-lg font-bold text-slate-900">{event.title}</h3>
                        <div className="flex flex-wrap gap-4 text-sm text-slate-600">
                          <div className="flex items-center gap-1.5">
                            <Calendar className="h-4 w-4" />
                            <span>{dateStr}</span>
                          </div>
                          <div className="flex items-center gap-1.5">
                            <MapPin className="h-4 w-4" />
                            <span>{event.location}</span>
                          </div>
                          <div className="flex items-center gap-1.5">
                            <Users className="h-4 w-4" />
                            <span>
                              {event.participantCount}
                              {event.max_participants ? ` / ${event.max_participants}ëª…` : "ëª…"}
                            </span>
                          </div>
                          <div className="flex items-center gap-1.5">
                            <User className="h-4 w-4" />
                            <span>{ownerName}</span>
                          </div>
                        </div>
                      </div>

                      {/* ì•¡ì…˜ ë²„íŠ¼ */}
                      <div className="flex gap-2 lg:flex-col">
                        <Link href={`/events/${event.id}/manage`}>
                          <Button variant="outline" className="w-full border-slate-300 text-slate-700 hover:bg-slate-50">
                            <Settings className="mr-2 h-4 w-4" />
                            ê´€ë¦¬
                          </Button>
                        </Link>
                        <DeleteEventButton eventId={event.id} />
                      </div>
                    </div>
                  )
                })}
              </div>
            ) : (
              <div className="py-12 text-center text-slate-500">ë“±ë¡ëœ ì´ë²¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤</div>
            )}
          </CardContent>
        </Card>
      </div>
    </div>
  )
}
</file>

<file path="app/communities/new/page.tsx">
import { requireAuth } from "@/lib/auth/server"
import { NewCommunityForm } from "@/components/new-community-form"
import { StandardRightSidebar } from "@/components/standard-right-sidebar"
import { ThreeColumnLayout } from "@/components/layout/three-column-layout"

export default async function NewCommunityPage() {
  const { user } = await requireAuth()
  const userId = user.id

  return (
    <ThreeColumnLayout rightSidebar={<StandardRightSidebar />}>
      <NewCommunityForm userId={userId} />
    </ThreeColumnLayout>
  )
}
</file>

<file path="app/communities/page.tsx">
import { createClient } from "@/lib/supabase/server"
import { Card, CardContent } from "@/components/ui/card"
import { Button } from "@/components/ui/button"
import { Plus, Users, Calendar } from "lucide-react"
import Link from "next/link"
import Image from "next/image"

export default async function CommunitiesPage() {
  const supabase = await createClient()

  const { data: { user } } = await supabase.auth.getUser()

  // ì†Œëª¨ì„ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
  const { data: communities } = await supabase
    .from("communities")
    .select(`
      id,
      name,
      description,
      thumbnail_url,
      created_at,
      created_by,
      profiles:created_by (
        full_name
      ),
      community_members(count)
    `)
    .order("created_at", { ascending: false })

  return (
    <div className="w-full">
      {/* Header */}
        <div className="mb-8 flex items-center justify-between">
          <div>
            <h1 className="text-3xl font-bold tracking-tight text-slate-900">ì»¤ë®¤ë‹ˆí‹°</h1>
            <p className="mt-2 text-slate-600">ê´€ì‹¬ì‚¬ê°€ ê°™ì€ ë©¤ë²„ë“¤ê³¼ í•¨ê»˜í•˜ëŠ” ì»¤ë®¤ë‹ˆí‹°ë¥¼ ì°¾ì•„ë³´ì„¸ìš”</p>
          </div>
          {user ? (
            <Link href="/communities/new">
              <Button className="gap-2">
                <Plus className="h-4 w-4" />
                ì»¤ë®¤ë‹ˆí‹° ë§Œë“¤ê¸°
              </Button>
            </Link>
          ) : (
            <Link href="/auth/login">
              <Button variant="outline" className="gap-2">
                <Plus className="h-4 w-4" />
                ë¡œê·¸ì¸í•˜ê³  ë§Œë“¤ê¸°
              </Button>
            </Link>
          )}
        </div>

        {/* ì»¤ë®¤ë‹ˆí‹° ë¦¬ìŠ¤íŠ¸ */}
        {communities && communities.length > 0 ? (
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {communities.map((community: any) => (
              <Link key={community.id} href={`/communities/${community.id}`}>
                <Card className="border-slate-200 hover:shadow-md transition-shadow h-full">
                  <div className="aspect-video relative overflow-hidden rounded-t-lg bg-slate-100">
                    {community.thumbnail_url ? (
                      <Image
                        src={community.thumbnail_url}
                        alt={community.name}
                        fill
                        sizes="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw"
                        className="object-cover"
                      />
                    ) : (
                      <div className="flex h-full items-center justify-center text-slate-400">
                        <Users className="h-16 w-16" />
                      </div>
                    )}
                  </div>
                  <CardContent className="p-5">
                    <h3 className="font-semibold text-lg text-slate-900 mb-2 line-clamp-1">
                      {community.name}
                    </h3>
                    <p className="text-sm text-slate-600 line-clamp-2 mb-4">
                      {community.description || "ì„¤ëª…ì´ ì—†ìŠµë‹ˆë‹¤."}
                    </p>
                    <div className="flex items-center justify-between text-xs text-slate-500">
                      <div className="flex items-center gap-1">
                        <Users className="h-4 w-4" />
                        <span>{community.community_members?.[0]?.count || 0}ëª…</span>
                      </div>
                      <div className="flex items-center gap-1">
                        <Calendar className="h-4 w-4" />
                        <span>{new Date(community.created_at).toLocaleDateString("ko-KR")}</span>
                      </div>
                    </div>
                  </CardContent>
                </Card>
              </Link>
            ))}
          </div>
        ) : (
          <Card className="border-slate-200">
            <CardContent className="py-12 text-center">
              <Users className="mx-auto mb-4 h-12 w-12 text-slate-400" />
              <h3 className="mb-2 text-lg font-semibold text-slate-900">ì•„ì§ ì»¤ë®¤ë‹ˆí‹°ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
              <p className="mb-4 text-sm text-slate-600">ì²« ë²ˆì§¸ ì»¤ë®¤ë‹ˆí‹°ë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”</p>
              {user ? (
                <Link href="/communities/new">
                  <Button>ì»¤ë®¤ë‹ˆí‹° ë§Œë“¤ê¸°</Button>
                </Link>
              ) : (
                <Link href="/auth/login">
                  <Button variant="outline">ë¡œê·¸ì¸í•˜ê³  ë§Œë“¤ê¸°</Button>
                </Link>
              )}
            </CardContent>
          </Card>
        )}
    </div>
  )
}
</file>

<file path="app/community/layout.tsx">
import type { ReactNode } from "react"
import { DashboardLayout } from "@/components/dashboard-layout"
import { SiteHeader } from "@/components/site-header"
import { createClient } from "@/lib/supabase/server"
import { getCurrentUserProfile } from "@/lib/queries/profiles"

/**
 * Community ë£¨íŠ¸ ë ˆì´ì•„ì›ƒ
 *
 * í—¤ë”ì™€ ëŒ€ì‹œë³´ë“œ ë ˆì´ì•„ì›ƒë§Œ ì œê³µ
 * 3ì—´ ë ˆì´ì•„ì›ƒ(ì‚¬ì´ë“œë°” í¬í•¨)ì€ ê° í•˜ìœ„ ë ˆì´ì•„ì›ƒì—ì„œ êµ¬ì„±
 */
export default async function CommunityLayout({ children }: { children: ReactNode }) {
  const supabase = await createClient()
  const userProfile = await getCurrentUserProfile(supabase)
  const userRole = userProfile?.profile?.role || null

  return (
    <DashboardLayout header={<SiteHeader />} userRole={userRole}>
      {children}
    </DashboardLayout>
  )
}
</file>

<file path="app/community/posts/layout.tsx">
import type { ReactNode } from "react"
import { ThreeColumnLayout } from "@/components/layout/three-column-layout"
import { StandardRightSidebar } from "@/components/standard-right-sidebar"

export default function CommunityPostsLayout({ children }: { children: ReactNode }) {
  return (
    <ThreeColumnLayout rightSidebar={<StandardRightSidebar />}>
      {children}
    </ThreeColumnLayout>
  )
}
</file>

<file path="app/community/posts/new/page.tsx">
import { createClient } from "@/lib/supabase/server"
import { redirect } from "next/navigation"
import { NewPostForm } from "@/components/new-post-form"

export default async function NewPostPage() {
  const supabase = await createClient()

  const { data: { user } } = await supabase.auth.getUser()
  if (!user) {
    redirect("/auth/login?next=/community/posts/new")
  }

  return (
    <div className="bg-white rounded-2xl border border-slate-200 p-8 shadow-sm">
      <h1 className="text-2xl font-bold tracking-tight text-slate-900 mb-8">
        ìƒˆ ê¸€ ì‘ì„±
      </h1>
      <NewPostForm userId={user.id} />
    </div>
  )
}
</file>

<file path="app/community/posts/page.tsx">
import { createClient } from "@/lib/supabase/server"
import { Button } from "@/components/ui/button"
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import { MessageSquare, Heart, Plus } from "lucide-react"
import Link from "next/link"

export default async function PostsPage() {
  const supabase = await createClient()

  const {
    data: { user },
  } = await supabase.auth.getUser()

  // Fetch posts with author information
  const { data: posts } = await supabase
    .from("posts")
    .select(`
      *,
      profiles:author_id (
        id,
        full_name,
        avatar_url
      )
    `)
    .eq("category", "discussion")
    .order("created_at", { ascending: false })

  return (
    <div className="w-full flex flex-col gap-8">
      {/* Header */}
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-3xl font-bold tracking-tight text-slate-900">ììœ ê²Œì‹œíŒ</h1>
          <p className="mt-2 text-slate-600">ììœ ë¡­ê²Œ ì˜ê²¬ì„ ë‚˜ëˆ„ê³  ì†Œí†µí•˜ì„¸ìš”</p>
        </div>
        {user ? (
          <Link href="/community/posts/new">
            <Button className="gap-2 transition-all active:scale-[0.98] hover:shadow-lg">
              <Plus className="h-4 w-4" />
              ê¸€ì“°ê¸°
            </Button>
          </Link>
        ) : (
          <Link href="/auth/login">
            <Button className="gap-2 transition-all active:scale-[0.98] hover:shadow-lg">
              <Plus className="h-4 w-4" />
              ê¸€ ì‘ì„±í•˜ê¸°
            </Button>
          </Link>
        )}
      </div>

      {/* Posts List */}
      <div className="space-y-4">
        {posts && posts.length > 0 ? (
          posts.map((post) => (
            <Link key={post.id} href={`/community/posts/${post.id}`}>
              <Card className="border-slate-200 transition-shadow hover:shadow-md">
                <CardHeader>
                  <div className="flex items-center gap-3">
                    <div className="flex h-10 w-10 items-center justify-center rounded-full bg-slate-200 text-sm font-medium text-slate-700">
                      {post.profiles?.full_name?.[0] || "U"}
                    </div>
                    <div>
                      <p className="text-sm font-medium text-slate-900">{post.profiles?.full_name || "Anonymous"}</p>
                      <p className="text-xs text-slate-500">
                        {new Date(post.created_at).toLocaleDateString("ko-KR")}
                      </p>
                    </div>
                  </div>
                  <CardTitle className="mt-4">{post.title}</CardTitle>
                </CardHeader>
                <CardContent>
                  <p className="line-clamp-2 text-sm text-slate-600">{post.content}</p>
                  <div className="mt-4 flex items-center gap-4 text-sm text-slate-500">
                    <div className="flex items-center gap-1">
                      <Heart className="h-4 w-4" />
                      <span>{post.likes_count}</span>
                    </div>
                    <div className="flex items-center gap-1">
                      <MessageSquare className="h-4 w-4" />
                      <span>{post.comments_count}</span>
                    </div>
                  </div>
                </CardContent>
              </Card>
            </Link>
          ))
        ) : (
          <Card className="border-slate-200">
            <CardContent className="py-12 text-center">
              <MessageSquare className="mx-auto mb-4 h-12 w-12 text-slate-400" />
              <h3 className="mb-2 text-lg font-semibold text-slate-900">ì•„ì§ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤</h3>
              <p className="mb-4 text-sm text-slate-600">ì²« ë²ˆì§¸ ê²Œì‹œê¸€ì„ ì‘ì„±í•´ë³´ì„¸ìš”</p>
              {user ? (
                <Link href="/community/posts/new">
                  <Button className="transition-all active:scale-[0.98] hover:shadow-lg">ê¸€ì“°ê¸°</Button>
                </Link>
              ) : (
                <Link href="/auth/login">
                  <Button className="transition-all active:scale-[0.98] hover:shadow-lg">ê¸€ ì‘ì„±í•˜ê¸°</Button>
                </Link>
              )}
            </CardContent>
          </Card>
        )}
      </div>
    </div>
  )
}
</file>

<file path="app/community/profile/[id]/page.tsx">
import { createClient } from "@/lib/supabase/server"
import { notFound } from "next/navigation"
import { Card, CardContent } from "@/components/ui/card"
import { Mail, Calendar, FileText, CalendarDays, Ticket, Medal, MapPin } from "lucide-react"
import Image from "next/image"
import Link from "next/link"

export const revalidate = 60

type PostItem = {
  id: string
  title: string
  created_at: string
  likes_count: number
  comments_count: number
  board_categories: { name: string; slug: string } | null
}

type EventItem = {
  id: string
  title: string
  thumbnail_url: string | null
  event_date: string
  location: string | null
}

export default async function PublicProfilePage({
  params,
}: {
  params: Promise<{ id: string }>
}) {
  const { id } = await params
  const supabase = await createClient()

  // í”„ë¡œí•„ ì¡°íšŒ
  const { data: profile, error } = await supabase
    .from("profiles")
    .select("*")
    .eq("id", id)
    .single()

  if (error || !profile) {
    notFound()
  }

  // ë¹„ê³µê°œ í”„ë¡œí•„ì¸ ê²½ìš° (ë³¸ì¸ì´ ì•„ë‹ˆë©´ ì œí•œëœ ì •ë³´ë§Œ í‘œì‹œ)
  const { data: { user } } = await supabase.auth.getUser()
  const isOwnProfile = user?.id === id

  // ë±ƒì§€ ì¡°íšŒ
  const { data: badgesData } = await supabase
    .from("user_badges")
    .select(`badges:badge_id (icon, name, is_active)`)
    .eq("user_id", id)
    .eq("is_visible", true)
    .eq("status", "approved")
    .limit(10)

  const visibleBadges = (badgesData || [])
    .filter((item: any) => item.badges && item.badges.is_active !== false)
    .map((item: any) => ({
      icon: item.badges.icon,
      name: item.badges.name,
    }))

  // ê³µê°œ í”„ë¡œí•„ì´ê±°ë‚˜ ë³¸ì¸ì¸ ê²½ìš°ì—ë§Œ í™œë™ ë‚´ì—­ ì¡°íšŒ
  let userPosts: PostItem[] = []
  let createdEvents: EventItem[] = []

  if (profile.is_profile_public || isOwnProfile) {
    // ì‘ì„± ê²Œì‹œê¸€
    const { data: postsData } = await supabase
      .from("posts")
      .select(`id, title, created_at, likes_count, comments_count, board_categories (name, slug)`)
      .eq("author_id", id)
      .order("created_at", { ascending: false })
      .limit(10)

    userPosts = (postsData || []).map((post: any) => ({
      id: post.id,
      title: post.title,
      created_at: post.created_at,
      likes_count: post.likes_count || 0,
      comments_count: post.comments_count || 0,
      board_categories: Array.isArray(post.board_categories) ? post.board_categories[0] : post.board_categories,
    }))

    // ë§Œë“  ì´ë²¤íŠ¸
    const { data: eventsData } = await supabase
      .from("events")
      .select(`id, title, thumbnail_url, event_date, location`)
      .eq("created_by", id)
      .order("created_at", { ascending: false })
      .limit(10)

    createdEvents = eventsData || []
  }

  return (
    <div className="w-full">
      <div className="grid gap-6 md:grid-cols-12">
        {/* í”„ë¡œí•„ ì¹´ë“œ */}
        <div className="md:col-span-5 lg:col-span-4">
          <Card className="border-slate-200 bg-white shadow-sm overflow-hidden">
            <CardContent className="p-8 flex flex-col items-center text-center">
              {/* ì•„ë°”íƒ€ */}
              <div className="mb-6">
                <div className="h-32 w-32 rounded-full border-4 border-white shadow-lg overflow-hidden bg-slate-100">
                  {profile.avatar_url ? (
                    <Image
                      src={profile.avatar_url}
                      alt={profile.full_name || "Profile"}
                      width={256}
                      height={256}
                      className="object-cover h-full w-full"
                    />
                  ) : (
                    <Image
                      src={`https://api.dicebear.com/9.x/notionists/svg?seed=${profile.full_name || id}`}
                      alt={profile.full_name || "Profile"}
                      width={256}
                      height={256}
                      className="object-cover h-full w-full bg-slate-50"
                    />
                  )}
                </div>
              </div>

              {/* ì´ë¦„ */}
              <h1 className="text-2xl font-bold text-slate-900 mb-1">
                {profile.full_name || "ì´ë¦„ ì—†ìŒ"}
              </h1>

              {/* ì´ë©”ì¼ (ë³¸ì¸ë§Œ í‘œì‹œ) */}
              {isOwnProfile && profile.email && (
                <p className="text-slate-500 text-sm mb-2 flex items-center justify-center gap-1.5">
                  <Mail className="h-3.5 w-3.5" />
                  {profile.email}
                </p>
              )}

              {/* ì†Œì†/ì§ì±… */}
              {(profile.company || profile.position || profile.company_2 || profile.position_2) && (
                <div className="flex flex-col gap-1 items-center mb-4">
                  {(profile.company || profile.position) && (
                    <p className="text-slate-600 text-sm">
                      {profile.company}
                      {profile.company && profile.position && " Â· "}
                      {profile.position}
                    </p>
                  )}
                  {(profile.company_2 || profile.position_2) && (
                    <p className="text-slate-600 text-sm">
                      {profile.company_2}
                      {profile.company_2 && profile.position_2 && " Â· "}
                      {profile.position_2}
                    </p>
                  )}
                </div>
              )}

              {/* í•œ ì¤„ ì†Œê°œ */}
              {profile.tagline && (
                <p className="text-slate-600 text-sm mb-4 italic">"{profile.tagline}"</p>
              )}

              {/* ìê¸°ì†Œê°œ */}
              {profile.introduction && (
                <p className="text-slate-600 text-sm mb-4 text-center whitespace-pre-line">
                  {profile.introduction}
                </p>
              )}

              {/* ë±ƒì§€ */}
              {visibleBadges.length > 0 && (
                <div className="w-full mt-4 pt-4 border-t border-slate-100">
                  <div className="flex items-center gap-2 mb-3 justify-center">
                    <Medal className="h-4 w-4 text-slate-700" />
                    <span className="text-sm font-bold text-slate-900">ë±ƒì§€</span>
                  </div>
                  <div className="flex flex-wrap gap-2 justify-center">
                    {visibleBadges.map((badge: any, index: number) => (
                      <div
                        key={index}
                        className="flex items-center gap-2 rounded-lg bg-slate-50 px-3 py-2 text-sm font-medium border border-slate-200 text-slate-700"
                      >
                        <span className="text-lg">{badge.icon}</span>
                        <span>{badge.name}</span>
                      </div>
                    ))}
                  </div>
                </div>
              )}

              {/* ê°€ì…ì¼ */}
              <div className="mt-6 text-xs text-slate-400 flex items-center gap-1">
                <Calendar className="h-3 w-3" />
                <span>ê°€ì…ì¼: {new Date(profile.created_at).toLocaleDateString("ko-KR")}</span>
              </div>
            </CardContent>
          </Card>
        </div>

        {/* í™œë™ ë‚´ì—­ */}
        <div className="md:col-span-7 lg:col-span-8 space-y-6">
          {profile.is_profile_public || isOwnProfile ? (
            <>
              {/* ì‘ì„± ê²Œì‹œê¸€ */}
              <Card className="border-slate-200 bg-white shadow-sm">
                <CardContent className="p-0">
                  <div className="px-6 py-4 border-b border-slate-100">
                    <h2 className="text-lg font-bold text-slate-900 flex items-center gap-2">
                      <FileText className="h-5 w-5 text-slate-500" />
                      ì‘ì„±í•œ ê²Œì‹œê¸€
                    </h2>
                  </div>
                  {userPosts.length > 0 ? (
                    <div className="divide-y divide-slate-100">
                      {userPosts.map((post) => (
                        <Link
                          key={post.id}
                          href={`/community/board/${post.board_categories?.slug || "free"}/${post.id}`}
                          className="flex flex-col p-5 hover:bg-slate-50 transition-colors group"
                        >
                          <div className="flex items-center gap-2 mb-1.5">
                            <span className="px-2 py-0.5 rounded bg-slate-100 text-xs font-medium text-slate-600">
                              {post.board_categories?.name || "ê²Œì‹œíŒ"}
                            </span>
                            <span className="text-xs text-slate-400">
                              {new Date(post.created_at).toLocaleDateString("ko-KR")}
                            </span>
                          </div>
                          <h3 className="text-base font-medium text-slate-900 group-hover:text-indigo-600 transition-colors truncate">
                            {post.title}
                          </h3>
                          <div className="flex gap-3 mt-2 text-xs text-slate-500">
                            <span>ì¢‹ì•„ìš” {post.likes_count}</span>
                            <span>ëŒ“ê¸€ {post.comments_count}</span>
                          </div>
                        </Link>
                      ))}
                    </div>
                  ) : (
                    <div className="flex flex-col items-center justify-center py-12 text-slate-400">
                      <FileText className="h-8 w-8 mb-2 text-slate-300" />
                      <p className="text-sm">ì‘ì„±í•œ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                    </div>
                  )}
                </CardContent>
              </Card>

              {/* ë§Œë“  ì´ë²¤íŠ¸ */}
              <Card className="border-slate-200 bg-white shadow-sm">
                <CardContent className="p-0">
                  <div className="px-6 py-4 border-b border-slate-100">
                    <h2 className="text-lg font-bold text-slate-900 flex items-center gap-2">
                      <CalendarDays className="h-5 w-5 text-slate-500" />
                      ë§Œë“  ì´ë²¤íŠ¸
                    </h2>
                  </div>
                  {createdEvents.length > 0 ? (
                    <div className="divide-y divide-slate-100">
                      {createdEvents.map((event) => (
                        <Link
                          key={event.id}
                          href={`/events/${event.id}`}
                          className="flex gap-4 p-5 hover:bg-slate-50 transition-colors group"
                        >
                          <div className="h-16 w-16 shrink-0 rounded-lg bg-slate-100 overflow-hidden relative border border-slate-200">
                            {event.thumbnail_url ? (
                              <Image src={event.thumbnail_url} alt="" fill sizes="64px" className="object-cover" />
                            ) : (
                              <div className="flex h-full w-full items-center justify-center text-slate-300">
                                <Ticket className="h-6 w-6" />
                              </div>
                            )}
                          </div>
                          <div className="flex-1 min-w-0">
                            <h3 className="font-medium text-slate-900 truncate mb-1 group-hover:text-indigo-600 transition-colors">
                              {event.title}
                            </h3>
                            <div className="flex items-center gap-3 text-xs text-slate-500">
                              <span className="flex items-center gap-1">
                                <CalendarDays className="h-3 w-3" />
                                {new Date(event.event_date).toLocaleDateString("ko-KR")}
                              </span>
                              <span className="flex items-center gap-1">
                                <MapPin className="h-3 w-3" />
                                {event.location || "ì¥ì†Œ ë¯¸ì •"}
                              </span>
                            </div>
                          </div>
                        </Link>
                      ))}
                    </div>
                  ) : (
                    <div className="flex flex-col items-center justify-center py-12 text-slate-400">
                      <CalendarDays className="h-8 w-8 mb-2 text-slate-300" />
                      <p className="text-sm">ë§Œë“  ì´ë²¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                    </div>
                  )}
                </CardContent>
              </Card>
            </>
          ) : (
            <Card className="border-slate-200 bg-white shadow-sm">
              <CardContent className="p-12 text-center">
                <div className="w-16 h-16 mx-auto mb-4 rounded-full bg-slate-100 flex items-center justify-center">
                  <FileText className="h-8 w-8 text-slate-400" />
                </div>
                <h3 className="text-lg font-bold text-slate-900 mb-2">ë¹„ê³µê°œ í”„ë¡œí•„</h3>
                <p className="text-slate-500 text-sm">
                  ì´ ì‚¬ìš©ìëŠ” í”„ë¡œí•„ì„ ë¹„ê³µê°œë¡œ ì„¤ì •í–ˆìŠµë‹ˆë‹¤.
                </p>
              </CardContent>
            </Card>
          )}
        </div>
      </div>
    </div>
  )
}
</file>

<file path="app/community/profile/layout.tsx">
import type { ReactNode } from "react"
import { ThreeColumnLayout } from "@/components/layout/three-column-layout"
import { StandardRightSidebar } from "@/components/standard-right-sidebar"

export default function ProfileLayout({ children }: { children: ReactNode }) {
  return (
    <ThreeColumnLayout rightSidebar={<StandardRightSidebar />}>
      {children}
    </ThreeColumnLayout>
  )
}
</file>

<file path="app/e/[id]/page.tsx">
import { notFound } from 'next/navigation'
import type { Metadata } from 'next'
import { createClient } from "@/lib/supabase/server"
import EventDetailContent from "@/components/event-detail-content"

// ISR: 60ì´ˆë§ˆë‹¤ ì¬ê²€ì¦
export const revalidate = 60

async function findEventId(shortCode: string, supabase: any): Promise<string | null> {
  // 1. ì½”ë“œê°€ 6ìë¦¬ê°€ ì•„ë‹ˆë©´ ê·¸ëŒ€ë¡œ UUIDë¡œ ê°„ì£¼
  if (shortCode.length !== 6) return shortCode

  try {
    // 2. URL íŒŒì‹± (ì˜ˆ: 010194 -> 1ì›” 1ì¼, ì ‘ë‘ì‚¬ 94)
    const targetMonth = parseInt(shortCode.substring(0, 2), 10)
    const targetDay = parseInt(shortCode.substring(2, 4), 10)
    const idSuffix = shortCode.substring(4, 6).toLowerCase()
    const orderNumber = parseInt(idSuffix, 10) // í˜¹ì‹œ ëª¨ë¥¼ ìˆœì„œë²ˆí˜¸ ë°©ì‹ ëŒ€ë¹„

    // 3. ì—¬ëŸ¬ ì—°ë„ì—ì„œ í•´ë‹¹ ë‚ ì§œì˜ ì´ë²¤íŠ¸ë§Œ ì¡°íšŒ (DB í•„í„°ë§ìœ¼ë¡œ ìµœì í™”)
    const currentYear = new Date().getFullYear()
    const yearsToCheck = [currentYear, currentYear - 1, currentYear + 1] // ì˜¬í•´, ì‘ë…„, ë‚´ë…„

    let allDateEvents: any[] = []

    for (const year of yearsToCheck) {
      const monthStr = String(targetMonth).padStart(2, '0')
      const dayStr = String(targetDay).padStart(2, '0')
      const startDate = `${year}-${monthStr}-${dayStr}T00:00:00`
      const endDate = `${year}-${monthStr}-${dayStr}T23:59:59`

      const { data: yearEvents } = await supabase
        .from("events")
        .select("id, event_date")
        .gte("event_date", startDate)
        .lte("event_date", endDate)
        .order("created_at", { ascending: true })

      if (yearEvents && yearEvents.length > 0) {
        allDateEvents.push(...yearEvents)
      }
    }

    if (allDateEvents.length === 0) return null

    // 4. ID ì• 2ìë¦¬ê°€ ì¼ì¹˜í•˜ëŠ” ì´ë²¤íŠ¸ ì°¾ê¸°
    const matchedEvent = allDateEvents.find((event: any) => {
      const eventIdPrefix = event.id.substring(0, 2).toLowerCase()
      return eventIdPrefix === idSuffix
    })

    if (matchedEvent) {
      return matchedEvent.id
    }

    // 5. ëª» ì°¾ì•˜ë‹¤ë©´ 'ìˆœì„œë²ˆí˜¸' ë°©ì‹(êµ¬ë²„ì „ URL)ìœ¼ë¡œ í•œ ë²ˆ ë” ì°¾ê¸°
    if (allDateEvents.length >= orderNumber) {
      return allDateEvents[orderNumber - 1].id
    }

    return null

  } catch (error) {
    console.error("Error finding event:", error)
    return null
  }
}

// ë©”íƒ€ë°ì´í„° ìƒì„± (ë¯¸ë¦¬ë³´ê¸°)
export async function generateMetadata({ params }: { params: Promise<{ id: string }> }): Promise<Metadata> {
  const { id } = await params;
  const supabase = await createClient();
  const eventId = await findEventId(id, supabase);

  if (!eventId) return { title: 'ì´ë²¤íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤' };

  const { data: event } = await supabase.from("events").select("title, thumbnail_url").eq("id", eventId).single();
  return {
    title: event?.title,
    openGraph: { images: event?.thumbnail_url ? [event.thumbnail_url] : [] },
  };
}

export default async function ShortEventPage({
  params,
}: {
  params: Promise<{ id: string }>;
}) {
  const { id } = await params;
  const supabase = await createClient();

  const eventId = await findEventId(id, supabase);

  if (!eventId) {
    notFound();
  }

  return <EventDetailContent eventId={eventId} basePath="/e" />
}
</file>

<file path="app/e/new/page.tsx">
import { requireAuth } from "@/lib/auth/server"
import { NewEventForm } from "@/components/new-event-form"

export default async function NewEventPage() {
  const { user } = await requireAuth()
  const userId = user.id

  return <NewEventForm userId={userId} />
}
</file>

<file path="app/e/page.tsx">
import { createClient } from "@/lib/supabase/server"
import Link from "next/link"
import EventCard from "@/components/ui/event-card"
import { PageHeader } from "@/components/page-header"
import { EventsSection } from "@/components/home/events-section"
import { getEventShortUrlSync } from "@/lib/utils/event-url"

// ISR: 60ì´ˆë§ˆë‹¤ ì¬ê²€ì¦
export const revalidate = 60

export default async function EventsPage() {
  const supabase = await createClient()

  // ì˜¤ëŠ˜ ë‚ ì§œì˜ ì‹œì‘ ì‹œê°„ì„ ê³„ì‚° (ì‹œê°„ëŒ€ ë¬¸ì œ ë°©ì§€)
  const today = new Date();
  today.setHours(0, 0, 0, 0);
  const todayStart = today.toISOString();
  
  const [upcomingEventsResult, pastEventsResult] = await Promise.all([
    supabase
      .from("events")
      .select(`
        *,
        profiles:created_by (
          id,
          full_name,
          avatar_url,
          bio 
        ),
        event_registrations(count)
      `)
      .gte("event_date", todayStart)
      .order("event_date", { ascending: true }),
    supabase
      .from("events")
      .select(`
        *,
        profiles:created_by (
          id,
          full_name,
          avatar_url,
          bio
        ),
        event_registrations(count)
      `)
      .lt("event_date", todayStart)
      .order("event_date", { ascending: false })
      .limit(5),
  ])

  const upcomingEvents = upcomingEventsResult.data
  const pastEvents = pastEventsResult.data

  // ë°ì´í„° í¬ë§·íŒ… ë° ì§§ì€ ì½”ë“œ ê³„ì‚° (ë™ê¸°ì‹ - DB í˜¸ì¶œ ì—†ìŒ)
  const formattedUpcomingEvents = (upcomingEvents || []).map((event: any) => {
    // ë°°ì—´/ê°ì²´ ëª¨ë‘ ëŒ€ì‘
    const profile = Array.isArray(event.profiles)
      ? event.profiles[0]
      : event.profiles;

    return {
      id: event.id,
      title: event.title,
      thumbnail_url: event.thumbnail_url,
      event_date: event.event_date,
      event_time: null,
      location: event.location,
      max_participants: event.max_participants,
      current_participants: event.event_registrations?.[0]?.count || 0,
      host_name: profile?.full_name || null,
      host_avatar_url: profile?.avatar_url || null,
      host_bio: profile?.bio || null,
      event_type: event.event_type || 'networking',
      shortUrl: getEventShortUrlSync(event.id, event.event_date),
    }
  })

  return (
    <div className="w-full flex flex-col gap-10">
      <PageHeader
        title="ì´ë²¤íŠ¸"
        description="ë‹¤ì–‘í•œ ë„¤íŠ¸ì›Œí‚¹, í´ë˜ìŠ¤, ì•¡í‹°ë¹„í‹° ì´ë²¤íŠ¸ì— ì°¸ì—¬í•˜ì„¸ìš”"
        compact={true}
      />

      <EventsSection
        events={formattedUpcomingEvents}
        createLink="/e/new"
        isLoading={false}
        title="ë‹¤ê°€ì˜¤ëŠ” ì´ë²¤íŠ¸"
        showFilters={true}
      />

      {pastEvents && pastEvents.length > 0 && (
        <div className="mt-8">
          <h2 className="text-xl font-bold text-slate-900 mb-4">ì§€ë‚œ ì´ë²¤íŠ¸</h2>
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 2xl:grid-cols-3 gap-4">
            {pastEvents.map((event: any) => {
              // ë°°ì—´/ê°ì²´ ëª¨ë‘ ëŒ€ì‘
              const profile = Array.isArray(event.profiles)
                ? event.profiles[0]
                : event.profiles;
              const shortUrl = getEventShortUrlSync(event.id, event.event_date)
              return (
                <Link key={event.id} href={shortUrl}>
                  <EventCard
                    event={{
                      id: event.id,
                      title: event.title,
                      thumbnail_url: event.thumbnail_url,
                      event_date: event.event_date,
                      event_time: null,
                      location: event.location,
                      max_participants: event.max_participants,
                      current_participants: event.event_registrations?.[0]?.count || 0,
                      host_name: profile?.full_name || null,
                      host_avatar_url: profile?.avatar_url || null,
                      host_bio: profile?.bio || null,
                      event_type: event.event_type || 'networking',
                      shortUrl: shortUrl,
                    }}
                  />
                </Link>
              )
            })}
          </div>
        </div>
      )}
    </div>
  )
}
</file>

<file path="app/events/[id]/page.tsx">
import { createClient } from "@/lib/supabase/server";
import { notFound, redirect } from 'next/navigation';
import { getEventShortUrlSync } from "@/lib/utils/event-url";
import { getReviewsByEvent } from "@/lib/queries/posts";
import EventDetailContent from "@/components/event-detail-content";
import type { Metadata } from 'next';
import Link from "next/link";
import { ChevronLeft, Calendar, MapPin, Ticket, AlertCircle, Users, Edit } from "lucide-react";
import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import { Card, CardContent } from "@/components/ui/card";
import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar";
import { Separator } from "@/components/ui/separator";
import { RegisterButton } from "@/components/register-button";
import { EventShareButton } from "@/components/event-share-button";
import { DeleteEventButton } from "@/components/delete-event-button";
import { FloatingActionBar } from "@/components/floating-action-bar";
import { ReviewModal } from "@/components/reviews/review-modal";
import { ReviewCard } from "@/components/reviews/review-card";

export async function generateMetadata({
  params,
}: {
  params: Promise<{ id: string }>;
}): Promise<Metadata> {
  const { id } = await params;
  const supabase = await createClient();

  try {
    const { data: event } = await supabase
      .from("events")
      .select(`
        title,
        description,
        thumbnail_url,
        event_date,
        location
      `)
      .eq("id", id)
      .single();

    if (!event) {
      return {
        title: 'ì´ë²¤íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤',
      };
    }

    // ë‚ ì§œ í¬ë§·íŒ…
    const eventDate = new Date(event.event_date);
    const dateStr = eventDate.toLocaleDateString("ko-KR", {
      year: "numeric",
      month: "long",
      day: "numeric",
      weekday: "short",
    });

    // HTML íƒœê·¸ ì œê±° ë° í…ìŠ¤íŠ¸ ì •ë¦¬
    const plainDescription = event.description?.replace(/<[^>]*>/g, "").substring(0, 200) || event.title;

    const baseUrl = process.env.NEXT_PUBLIC_SITE_URL || "https://seoulfounders.club";

    return {
      title: event.title,
      description: `${dateStr} Â· ${event.location}\n${plainDescription}`,
      openGraph: {
        title: event.title,
        description: `${dateStr} Â· ${event.location}`,
        images: event.thumbnail_url ? [
          {
            url: event.thumbnail_url,
            width: 1200,
            height: 630,
            alt: event.title,
          }
        ] : [
          {
            url: `${baseUrl}/events/${id}/opengraph-image`,
            width: 1200,
            height: 630,
            alt: event.title,
          }
        ],
        type: 'website',
        siteName: 'Seoul Founders Club',
      },
      twitter: {
        card: 'summary_large_image',
        title: event.title,
        description: `${dateStr} Â· ${event.location}`,
        images: event.thumbnail_url ? [event.thumbnail_url] : [`${baseUrl}/events/${id}/opengraph-image`],
      },
    };
  } catch (error) {
    console.error("Error generating metadata:", error);
    return {
      title: 'Seoul Founders Club',
    };
  }
}

// ISR: 5ë¶„ë§ˆë‹¤ ì¬ê²€ì¦
export const revalidate = 300;


export default async function EventDetailPage({
  params,
}: {
  params: Promise<{ id: string }>;
}) {
  const { id } = await params;
  const supabase = await createClient();

  // UUID í˜•ì‹ì¸ ê²½ìš° (ê¸¸ì´ê°€ 36ì ì´ìƒ) ì§§ì€ ì½”ë“œë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
  if (id.length > 6) {
    const { data: eventData } = await supabase
      .from("events")
      .select("event_date")
      .eq("id", id)
      .single();

    if (eventData) {
      // ë™ê¸°ì‹ shortUrl ìƒì„± (DB í˜¸ì¶œ ì—†ìŒ - ì„±ëŠ¥ ìµœì í™”)
      const shortUrl = getEventShortUrlSync(id, eventData.event_date);
      redirect(shortUrl);
    }
    notFound();
  }

  // ì§§ì€ ì½”ë“œì¸ ê²½ìš° /e/[id]ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
  redirect(`/e/${id}`);

  // ì´ë²¤íŠ¸ ì •ë³´ ì¡°íšŒ (ì—ëŸ¬ ì²˜ë¦¬ ê°•í™”)
  let event: any;
  try {
    const { data, error } = await supabase
      .from("events")
      .select(`
        *,
        profiles:created_by (
          id,
          full_name,
          avatar_url,
          email,
          bio
        )
      `)
      .eq("id", id)
      .single();

    if (error) {
      console.error("Event fetch error:", error);
      notFound();
    }

    if (!data) {
      notFound();
    }

    event = data;
  } catch (error) {
    console.error("Unexpected error fetching event:", error);
    notFound();
  }

  const {
    data: { user },
  } = await supabase.auth.getUser()

  // ì‚¬ìš©ì ë“±ë¡ ì—¬ë¶€ ì¡°íšŒ
  let userRegistration: any = null;
  const userId: string | null = user?.id ?? null
  if (userId) {
    const { data: registrationData } = await supabase
      .from("event_registrations")
      .select("id, payment_status")
      .eq("event_id", id)
      .eq("user_id", userId)
      .single();

    userRegistration = registrationData;
  }

  // ì°¸ì„ì ìˆ˜ ì¡°íšŒ
  const { count: attendeesCount } = await supabase
    .from("event_registrations")
    .select("*", { count: "exact", head: true })
    .eq("event_id", id);

  // ì°¸ì„ì ëª©ë¡ ì¡°íšŒ
  const { data: attendeesData } = await supabase
    .from("event_registrations")
    .select(`
      id,
      user_id,
      guest_name,
      profiles:user_id (
        id,
        full_name,
        avatar_url
      )
    `)
    .eq("event_id", id);

  const attendees = attendeesData || [];

  // í›„ê¸° ëª©ë¡ ì¡°íšŒ
  const reviews = await getReviewsByEvent(supabase, id);


  const isRegistered = !!userRegistration;
  const isPastEvent = new Date(event.event_date) < new Date();
  const attendeeCountValue = attendeesCount ?? 0;
  const maxParticipants = event.max_participants ?? null;
  const isFull = maxParticipants ? attendeeCountValue >= maxParticipants : false;
  const isCreator = userId ? event.created_by === userId : false;
  const isCompleted = event.status === 'completed';

  // ë‚ ì§œ/ì‹œê°„ í¬ë§·íŒ…
  const eventDate = new Date(event.event_date);
  const dateStr = eventDate.toLocaleDateString("ko-KR", {
    year: "numeric",
    month: "long",
    day: "numeric",
    weekday: "short",
  });
  const timeStr = eventDate.toLocaleTimeString("ko-KR", {
    hour: "numeric",
    minute: "2-digit",
  });

  // [ê³µí†µ ì»´í¬ë„ŒíŠ¸] ì¹´ë“œ í—¤ë”
  const CardHeader = ({ icon: Icon, title, rightElement }: { icon: React.ComponentType<{ className?: string }>, title: string, rightElement?: React.ReactNode }) => (
    <div className="flex items-center justify-between pb-4 border-b border-slate-100 mb-6">
      <div className="flex items-center gap-2">
        <div className="p-1.5 rounded-md bg-slate-50 text-slate-500 border border-slate-100">
          <Icon className="h-4 w-4" />
        </div>
        <h3 className="text-lg font-bold text-slate-900 tracking-tight">{title}</h3>
      </div>
      {rightElement}
    </div>
  );

  return (
    <div className="w-full">

      {/* ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ */}
      <div className="mb-6 flex items-center justify-between">
        <Link href="/events" className="group flex items-center text-sm font-medium text-slate-500 hover:text-slate-900 transition-colors">
          <div className="mr-2 flex h-8 w-8 items-center justify-center rounded-full bg-white border border-slate-200 group-hover:border-slate-300 shadow-sm transition-all">
            <ChevronLeft className="h-4 w-4" />
          </div>
          ì´ë²¤íŠ¸ ëª©ë¡
        </Link>
      </div>

      <div className="flex flex-col gap-8">

        {/* [ROW 3] í›„ê¸° ì„¹ì…˜ (ìœ„ì¹˜ ì´ë™ í…ŒìŠ¤íŠ¸: ìƒë‹¨ ë°°ì¹˜) */}
        <Card className="border-blue-500 border-4 shadow-lg bg-white mb-10">
          <CardContent className="p-6 sm:p-8">
            <div className="flex flex-col gap-6">
              <div className="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
                <div>
                  <h2 className="text-2xl font-bold text-slate-900 flex items-center gap-2">
                    ì°¸ê°€ì í›„ê¸° (ìƒë‹¨ í…ŒìŠ¤íŠ¸)
                    <span className="text-lg text-slate-500 font-medium bg-slate-100 px-2 py-0.5 rounded-full">
                      {reviews ? reviews.length : 0}
                    </span>
                  </h2>
                  <p className="text-slate-500 mt-1">
                    ì´ ëª¨ì„ì— ì°¸ì—¬í•œ ë¶„ë“¤ì˜ ìƒìƒí•œ ì´ì•¼ê¸°ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.
                  </p>
                </div>

                {userId ? <ReviewModal userId={userId as string} eventId={id} /> : null} 
              </div>

              {reviews && reviews.length > 0 ? (
                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                  {reviews.map((review: any) => (
                    <ReviewCard key={review.id} review={review} className="h-full border border-slate-100 shadow-sm" />
                  ))}
                </div>
              ) : (
                <div className="flex flex-col items-center justify-center py-16 bg-slate-50 rounded-xl border border-dashed border-slate-200 text-center">
                  <div className="w-16 h-16 bg-white rounded-full flex items-center justify-center shadow-sm mb-4">
                    <span className="text-3xl">ğŸ“</span>
                  </div>
                  <h3 className="text-lg font-bold text-slate-900 mb-1">ì•„ì§ ì‘ì„±ëœ í›„ê¸°ê°€ ì—†ì–´ìš”</h3>
                  <p className="text-slate-500 max-w-sm mx-auto mb-6">
                    ì´ ëª¨ì„ì˜ ì²« ë²ˆì§¸ í›„ê¸° ì‘ì„±ìê°€ ë˜ì–´ì£¼ì„¸ìš”!
                    ì°¸ì—¬ìë“¤ì—ê²Œ í° ë„ì›€ì´ ë©ë‹ˆë‹¤.
                  </p>
                  {userId ? <ReviewModal userId={userId as string} eventId={id} /> : null}
                </div>
              )}
            </div>
          </CardContent>
        </Card>

        {/* [ROW 1] */}
        <div className="grid grid-cols-1 lg:grid-cols-12 gap-8 items-start">
          {/* Row 1 - Left (8) */}
          <div className="lg:col-span-8 bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden h-full">
            <div className="relative aspect-video w-full bg-slate-100">
              <img
                src={event.thumbnail_url || "/placeholder.svg"}
                alt={event.title}
                className="absolute inset-0 h-full w-full object-cover"
              />
              <div className="absolute top-4 left-4">
                {isCompleted ? (
                  <Badge className="bg-slate-800 text-white border-none px-3 py-1.5 text-sm font-medium">ì¢…ë£Œë¨</Badge>
                ) : isPastEvent ? (
                  <Badge variant="secondary" className="bg-slate-200 text-slate-700 border-none px-3 py-1.5 text-sm font-medium">ê¸°ê°„ ë§Œë£Œ</Badge>
                ) : isFull ? (
                  <Badge variant="destructive" className="px-3 py-1.5 text-sm font-medium">ë§ˆê°ì„ë°•</Badge>
                ) : (
                  <Badge className="bg-green-600 hover:bg-green-700 text-white border-none px-3 py-1.5 text-sm font-medium shadow-sm">
                    ëª¨ì§‘ì¤‘
                  </Badge>
                )}
              </div>
            </div>

            <div className="p-4 sm:p-8">
              <h1 className="text-2xl sm:text-3xl font-bold text-slate-900 leading-tight mb-4 sm:mb-8">
                {event.title}
              </h1>

              <div className="grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-4">
                {/* ë‚ ì§œ - ëª¨ë°”ì¼ì—ì„œ í•œ ì¤„ */}
                <div className="flex items-center gap-3 p-3 sm:p-5 rounded-xl sm:rounded-xl bg-slate-50 border border-slate-100">
                  <div className="flex h-10 w-10 sm:h-11 sm:w-11 shrink-0 items-center justify-center rounded-lg sm:rounded-xl bg-white text-slate-900 shadow-sm border border-slate-100">
                    <Calendar className="h-4 w-4 sm:h-5 sm:w-5" />
                  </div>
                  <div className="flex-1 min-w-0">
                    <p className="text-sm sm:text-base font-bold text-slate-900 truncate">{dateStr} {timeStr}</p>
                  </div>
                </div>

                {/* ì¥ì†Œ */}
                <div className="flex items-center gap-3 p-3 sm:p-5 rounded-xl sm:rounded-xl bg-slate-50 border border-slate-100">
                  <div className="flex h-10 w-10 sm:h-11 sm:w-11 shrink-0 items-center justify-center rounded-lg sm:rounded-xl bg-white text-slate-900 shadow-sm border border-slate-100">
                    <MapPin className="h-4 w-4 sm:h-5 sm:w-5" />
                  </div>
                  <div className="flex-1 min-w-0">
                    <p className="text-sm sm:text-base font-bold text-slate-900 truncate">{event.location}</p>
                  </div>
                </div>

                {/* í˜¸ìŠ¤íŠ¸ */}
                <div className="flex items-center gap-3 p-3 sm:p-5 rounded-xl sm:rounded-xl bg-slate-50 border border-slate-100">
                  <Avatar className="h-10 w-10 sm:h-11 sm:w-11 border border-slate-100 shrink-0">
                    <AvatarImage src={event.profiles?.avatar_url || undefined} />
                    <AvatarFallback className="bg-slate-900 text-white font-bold text-xs sm:text-sm">
                      {event.profiles?.full_name?.[0] || "H"}
                    </AvatarFallback>
                  </Avatar>
                  <div className="flex-1 min-w-0">
                    <p className="text-xs text-slate-500 font-medium mb-0.5">í˜¸ìŠ¤íŠ¸</p>
                    <p className="text-sm sm:text-base font-bold text-slate-900 truncate">
                      {event.profiles?.full_name || "ì•Œ ìˆ˜ ì—†ìŒ"}
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          {/* Row 1 - Right (4) */}
          <Card id="register-card" className="lg:col-span-4 border-slate-200 shadow-md bg-white h-full flex flex-col">
            <CardContent className="p-6 flex flex-col h-full">
              <CardHeader
                icon={Ticket}
                title="ì°¸ê°€ ì‹ ì²­"
                rightElement={
                  <Badge variant="outline" className="font-medium text-slate-500 border-slate-200 bg-slate-50">
                    {event.price && event.price > 0 ? `${event.price.toLocaleString()}ì›` : 'Free'}
                  </Badge>
                }
              />

              <div className="mb-8">
                <div className="flex justify-between items-end mb-2">
                  <span className="text-sm text-slate-500 font-medium">í˜„ì¬ ëª¨ì§‘ í˜„í™©</span>
                  <div className="text-right">
                    <span className="text-2xl font-bold text-slate-900">{attendeesCount || 0}</span>
                    <span className="text-slate-400 text-sm font-medium ml-1">
                      / {event.max_participants ? event.max_participants : 'âˆ'}
                    </span>
                  </div>
                </div>
                {/* ìµœëŒ€ ì¸ì›ì´ ì„¤ì •ëœ ê²½ìš°ì—ë§Œ ë°” í‘œì‹œ */}
                {event.max_participants && event.max_participants > 0 ? (
                  <div className="w-full bg-slate-100 rounded-full h-2.5 overflow-hidden">
                    <div
                      className={`h-full rounded-full transition-all duration-500 ease-out ${isFull ? 'bg-red-500' : 'bg-slate-900'}`}
                      style={{ width: `${Math.min(100, ((attendeesCount || 0) / event.max_participants) * 100)}%` }}
                    />
                  </div>
                ) : null}
              </div>

              <div className="flex flex-col flex-1">
                <div className="flex flex-col gap-2">
                  {isPastEvent ? (
                    <Button className="w-full bg-slate-100 text-slate-500 hover:bg-slate-200 border-0 h-11 text-sm font-medium" disabled>
                      <AlertCircle className="mr-2 h-4 w-4" />
                      ì´ë²¤íŠ¸ê°€ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤
                    </Button>
                  ) : isCreator ? (
                    <>
                      {/* ë²„íŠ¼ 1: ì´ë²¤íŠ¸ ìˆ˜ì • */}
                      <Link href={`/events/${id}/edit`}>
                        <Button className="w-full bg-slate-900 text-white hover:bg-slate-800 h-11 text-sm font-medium">
                          <Edit className="mr-2 h-4 w-4" />
                          ì´ë²¤íŠ¸ ìˆ˜ì •
                        </Button>
                      </Link>

                      {/* ë²„íŠ¼ 2: ì°¸ì„ì ê´€ë¦¬ */}
                      <Link href={`/events/${id}/manage`}>
                        <Button variant="outline" className="w-full bg-white border-slate-300 text-slate-700 hover:bg-slate-50 h-11 text-sm font-medium">
                          <Users className="mr-2 h-4 w-4" />
                          ì°¸ì„ì ê´€ë¦¬
                        </Button>
                      </Link>

                      {/* ë²„íŠ¼ 3: ê³µìœ í•˜ê¸° */}
                      <EventShareButton
                        title={event.title}
                        description={event.description?.replace(/<[^>]*>/g, "").substring(0, 100) || event.title}
                        variant="outline"
                        className="w-full border-slate-200 text-slate-600 hover:bg-slate-50 hover:text-slate-900 h-10 text-sm font-medium transition-all shadow-sm hover:shadow"
                      >
                        ê³µìœ í•˜ê¸°
                      </EventShareButton>
                    </>
                  ) : (
                    <>
                      <RegisterButton
                        eventId={event.id}
                        userId={user?.id}
                        isRegistered={isRegistered}
                        paymentStatus={userRegistration?.payment_status}
                        isFull={!!isFull}
                        price={event.price || 0}
                      />

                      <Separator className="my-2 bg-slate-100" />

                      <EventShareButton
                        title={event.title}
                        description={event.description?.replace(/<[^>]*>/g, "").substring(0, 100) || event.title}
                        variant="outline"
                        className="w-full border-slate-200 text-slate-600 hover:bg-slate-50 hover:text-slate-900 h-10 text-sm font-medium transition-all shadow-sm hover:shadow"
                      >
                        ê³µìœ í•˜ê¸°
                      </EventShareButton>
                    </>
                  )}
                </div>

                {/* ì´ë²¤íŠ¸ ì‚­ì œ ë²„íŠ¼ (í˜¸ìŠ¤íŠ¸ì¼ ë•Œë§Œ, ìµœí•˜ë‹¨ ë³„ë„ ë°°ì¹˜) */}
                {isCreator && !isPastEvent && (
                  <div className="mt-auto pt-4 border-t border-slate-100">
                    <DeleteEventButton
                      eventId={id}
                      variant="outline"
                      className="w-full border-red-200 text-red-600 hover:bg-red-50 hover:border-red-300 h-11 text-base font-medium"
                    />
                  </div>
                )}
              </div>
            </CardContent>
          </Card>
        </div>

        {/* [ROW 2] */}
        <div className="grid grid-cols-1 lg:grid-cols-12 gap-10 items-start">

          {/* Row 2 - Left (8) : ìƒì„¸ ë‚´ìš© */}
          <Card className="lg:col-span-8 border-slate-200 shadow-sm bg-white">
            <CardContent className="p-6 sm:p-8">
              <div
                className="prose prose-slate max-w-none prose-headings:font-bold prose-p:text-slate-600 prose-p:leading-relaxed prose-strong:text-slate-900"
                dangerouslySetInnerHTML={{ __html: event.description || "" }}
              />
            </CardContent>
          </Card>

          {/* Row 2 - Right (4) : ì°¸ì„ì ë©¤ë²„ */}
          <Card className="lg:col-span-4 border-slate-200 shadow-sm bg-white">
            <CardContent className="p-6">
              <CardHeader
                icon={Users}
                title="ì°¸ì„ì ë©¤ë²„"
                rightElement={
                  <span className="text-xs font-bold text-slate-500 bg-slate-100 px-2.5 py-1 rounded-full">
                    {attendeesCount || 0}ëª…
                  </span>
                }
              />

              {attendees && Array.isArray(attendees) && attendees.length > 0 ? (
                <div className="flex flex-wrap gap-3 max-h-[400px] overflow-y-auto">
                  {attendees.map((attendee: any, index: number) => {
                    const profile = Array.isArray(attendee.profiles)
                      ? attendee.profiles[0]
                      : attendee.profiles;
                    const name = profile?.full_name || attendee.guest_name || "ìµëª…";
                    return (
                      <div key={attendee.id || index} className="flex flex-col items-center gap-1.5 w-14 group cursor-default">
                        <Avatar className="h-12 w-12 border-2 border-white shadow-sm transition-all duration-200 group-hover:scale-105 group-hover:border-slate-200">
                          <AvatarImage src={profile?.avatar_url || undefined} />
                          <AvatarFallback className="bg-slate-100 text-slate-500 font-bold text-xs">
                            {name[0]}
                          </AvatarFallback>
                        </Avatar>
                        <span className="text-xs text-slate-600 truncate w-full text-center font-medium group-hover:text-slate-900">
                          {name}
                        </span>
                      </div>
                    );
                  })}
                </div>
              ) : (
                <div className="py-8 text-center bg-slate-50/50 rounded-xl border border-dashed border-slate-200">
                  <p className="text-slate-500 text-xs">ì•„ì§ ì°¸ì„ìê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                </div>
              )}

            </CardContent>
          </Card>
        </div>

      </div>

      {/* [Mobile Only] í•˜ë‹¨ ê³ ì • ì•¡ì…˜ ë°” (Sticky Bottom Bar) - ì°¸ê°€ì‹ ì²­ ì¹´ë“œë¥¼ ì§€ë‚˜ë©´ í‘œì‹œ */}
      <FloatingActionBar
        eventId={id}
        userId={user?.id}
        isRegistered={isRegistered}
        paymentStatus={userRegistration?.payment_status}
        isFull={!!isFull}
        price={event.price || 0}
        isPastEvent={isPastEvent}
        isCreator={!!isCreator}
        eventTitle={event.title}
        dateStr={dateStr}
        timeStr={timeStr}
        location={event.location}
      />
    </div>
  );
}
</file>

<file path="app/events/loading.tsx">
import { Skeleton } from "@/components/ui/skeleton"
import { PageHeader } from "@/components/page-header"

export default function EventsLoading() {
  return (
    <div className="w-full grid grid-cols-1 xl:grid-cols-12 gap-8">
      {/* [LEFT] ë©”ì¸ ì½˜í…ì¸  */}
      <div className="xl:col-span-9 flex flex-col gap-6">
        {/* PageHeader ìŠ¤ì¼ˆë ˆí†¤ */}
        <PageHeader 
          title="ì´ë²¤íŠ¸"
          description="í•¨ê»˜ ì„±ì¥í•˜ëŠ” ë„¤íŠ¸ì›Œí‚¹ íŒŒí‹°ì™€ ì¸ì‚¬ì´íŠ¸ ì„¸ë¯¸ë‚˜ë¥¼ ë†“ì¹˜ì§€ ë§ˆì„¸ìš”."
          compact={true}
        >
          <Skeleton className="h-10 w-32" />
        </PageHeader>

        {/* ë‹¤ê°€ì˜¤ëŠ” ì´ë²¤íŠ¸ ìŠ¤ì¼ˆë ˆí†¤ */}
        <div className="w-full">
          {/* í—¤ë” */}
          <div className="flex items-center justify-between w-full mb-6">
            <Skeleton className="h-8 w-48" />
            <Skeleton className="hidden md:block h-10 w-32" />
          </div>

          {/* í•„í„° ë²„íŠ¼ */}
          <div className="flex items-center gap-2 mb-6 overflow-x-auto scrollbar-hide pb-2">
            {[1, 2, 3, 4].map((i) => (
              <Skeleton key={i} className="h-9 w-20 rounded-full shrink-0" />
            ))}
          </div>

          {/* ëª¨ë°”ì¼ ìŠ¤ì¼ˆë ˆí†¤ */}
          <div className="md:hidden -mx-4 px-4">
            <div className="flex gap-4 overflow-hidden">
              {[1, 2].map((i) => (
                <div key={i} className="w-[85%] flex-shrink-0 aspect-[4/5] rounded-[20px] overflow-hidden">
                  <Skeleton className="w-full h-full" />
                </div>
              ))}
            </div>
          </div>

          {/* ë°ìŠ¤í¬íƒ‘ ìŠ¤ì¼ˆë ˆí†¤ */}
          <div className="hidden md:grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 xl:grid-cols-3 gap-5 lg:gap-6">
            {[1, 2, 3].map((i) => (
              <div key={i} className="w-full aspect-[4/5] rounded-[20px] overflow-hidden">
                <Skeleton className="w-full h-full" />
              </div>
            ))}
          </div>
        </div>
      </div>

      {/* [RIGHT] ìš°ì¸¡ ì‚¬ì´ë“œë°” ìŠ¤ì¼ˆë ˆí†¤ (xl ì´ìƒì—ì„œë§Œ í‘œì‹œ) */}
      <div className="hidden xl:block xl:col-span-3">
        <div className="sticky top-8 flex flex-col gap-6 h-fit">
          <Skeleton className="w-full h-64 rounded-xl" />
        </div>
      </div>
    </div>
  )
}
</file>

<file path="app/globals.css">
@import "tailwindcss";
@import "tw-animate-css";
@plugin "@tailwindcss/typography";

@custom-variant dark (&:is(.dark *));

/* Pretendard í°íŠ¸ë¥¼ Tailwind sans ê¸°ë³¸ í°íŠ¸ë¡œ ì„¤ì • */
@theme {
  --font-sans: var(--font-pretendard), ui-sans-serif, system-ui, sans-serif;
}

:root {
  /* ... (ê¸°ì¡´ CSS ë³€ìˆ˜ ìœ ì§€) ... */
  --background: oklch(1 0 0);
  --foreground: oklch(0.145 0 0);
  /* ... (ë‚˜ë¨¸ì§€ ë³€ìˆ˜ ìœ ì§€) ... */
}
/* ... (dark í…Œë§ˆ ì„¤ì • ìœ ì§€) ... */

@theme inline {
  /* ... (theme inline ìœ ì§€) ... */
}

@layer base {
  html {
    /* ìŠ¤í¬ë¡¤ë°” ê³µê°„ì„ ë¬´ì¡°ê±´ ì°¨ì§€í•˜ê²Œ í•´ì„œ í˜ì´ì§€ ì´ë™ ì‹œ ë„ˆë¹„ ë³€í™” ë°©ì§€ */
    overflow-y: scroll;
    /* ìŠ¤í¬ë¡¤ë°” ì í”„ ë°©ì§€: í•­ìƒ ìŠ¤í¬ë¡¤ë°” ê³µê°„ì„ í™•ë³´ */
    scrollbar-gutter: stable;
    /* ë ˆì´ì•„ì›ƒ ì‹œí”„íŠ¸ ë°©ì§€ë¥¼ ìœ„í•œ ì¶”ê°€ ì„¤ì • */
    width: 100%;
    height: 100%;
  }
  * {
    @apply border-slate-200;
  }
  body {
    @apply bg-slate-50 text-slate-900 antialiased;
    /* ìŠ¤í¬ë¡¤ë°” ì í”„ ë°©ì§€: í•­ìƒ ìŠ¤í¬ë¡¤ë°” ê³µê°„ì„ í™•ë³´ */
    scrollbar-gutter: stable;
    /* ë ˆì´ì•„ì›ƒ ì‹œí”„íŠ¸ ë°©ì§€ë¥¼ ìœ„í•œ ì¶”ê°€ ì„¤ì • */
    width: 100%;
    min-height: 100vh;
    /* ì´ˆê¸° ë Œë”ë§ ì‹œ ìŠ¤í¬ë¡¤ë°” ê³µê°„ í™•ë³´ */
    overflow-y: scroll;
    /* í”„ë¦¬ë¯¸ì—„ í…ìŠ¤íŠ¸ ë Œë”ë§ */
    text-rendering: optimizeLegibility;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  /* í—¤ë”© íƒ€ì´í¬ê·¸ë˜í”¼ ê°•í™” - trackingë§Œ ì ìš© (í¬ê¸°ëŠ” ê° ì»´í¬ë„ŒíŠ¸ì—ì„œ ì§€ì •) */
  h1, h2, h3, h4, h5, h6 {
    @apply tracking-tight;
  }

  /* í”„ë¦¬ë¯¸ì—„ í¬ì»¤ìŠ¤ ìŠ¤íƒ€ì¼ */
  *:focus-visible {
    @apply outline-none ring-2 ring-slate-900 ring-offset-2 ring-offset-white;
  }
}

@layer utilities {
  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }
  /* ìŠ¤í¬ë¡¤ë°” ë ˆì´ì•„ì›ƒ ì‹œí”„íŠ¸ ë°©ì§€ */
  .scrollbar-gutter-stable {
    scrollbar-gutter: stable;
  }
  /* í¬ë¡¬, ì‚¬íŒŒë¦¬, ì—£ì§€, ì˜¤í˜ë¼ */
  .no-scrollbar::-webkit-scrollbar {
    display: none !important;
    width: 0px !important;
    height: 0px !important;
    background: transparent !important;
  }
  .no-scrollbar::-webkit-scrollbar-track {
    background: transparent !important;
  }
  .no-scrollbar::-webkit-scrollbar-thumb {
    background: transparent !important;
  }
  
  /* íŒŒì´ì–´í­ìŠ¤, IE */
  .no-scrollbar {
    -ms-overflow-style: none !important;  /* IE and Edge */
    scrollbar-width: none !important;  /* Firefox */
  }
}

/* âœ… WYSIWYG ì—ë””í„°ì™€ ìƒì„¸ í˜ì´ì§€ ìŠ¤íƒ€ì¼ 100% ì¼ì¹˜ì‹œí‚¤ê¸° */
@layer base {
  .prose {
    font-size: 1.125rem; /* text-lg */
    line-height: 1.8;    /* leading-relaxed */
    color: var(--color-slate-600);
  }

  .prose p {
    margin-top: 0.75em !important;
    margin-bottom: 0.75em !important;
    line-height: 1.8 !important;
  }

  /* ë¬¸ë‹¨ì´ ë¹„ì–´ìˆì„ ë•Œ(ì¤„ë°”ê¿ˆ) ë†’ì´ ìœ ì§€ */
  .prose p:empty::before {
    content: "\00a0";
    display: inline-block;
  }

  .prose h1, .prose h2, .prose h3 {
    color: var(--color-slate-900);
    font-weight: 700;
    margin-top: 1.5em !important;
    margin-bottom: 0.5em !important;
    line-height: 1.3 !important;
  }

  .prose ul, .prose ol {
    margin-top: 0.75em !important;
    margin-bottom: 0.75em !important;
    padding-left: 1.625em !important;
  }

  .prose ul {
    list-style-type: disc !important;
  }

  .prose ol {
    list-style-type: decimal !important;
  }

  .prose li {
    margin-top: 0.25em !important;
    margin-bottom: 0.25em !important;
    padding-left: 0.375em !important;
  }

  .prose blockquote {
    font-style: italic;
    border-left-width: 4px;
    border-left-color: var(--color-slate-200);
    margin-left: 0;
    margin-right: 0;
    padding-left: 1.5em;
    color: var(--color-slate-700);
  }

  .prose img {
    max-width: 100% !important;
    height: auto !important;
    object-fit: cover;
    border-radius: 1rem;
    margin-top: 1.5em !important;
    margin-bottom: 1.5em !important;
    box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05);
  }

  /* Tiptap ì—ë””í„° ì „ìš©: í¬ì»¤ìŠ¤ ì‹œ ì•„ì›ƒë¼ì¸ ì œê±° */
  .ProseMirror:focus {
    outline: none;
  }
}

/* Google Places Autocomplete ë“œë¡­ë‹¤ìš´ ìŠ¤íƒ€ì¼ */
@layer base {
  .pac-container {
    z-index: 9999 !important;
    border-radius: 0.5rem !important;
    border: 1px solid rgb(226 232 240) !important;
    box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1) !important;
    margin-top: 0.25rem !important;
    background: white !important;
  }

  .pac-item {
    padding: 0.75rem 1rem !important;
    cursor: pointer !important;
    border-top: 1px solid rgb(241 245 249) !important;
  }

  .pac-item:first-child {
    border-top: none !important;
  }

  .pac-item:hover {
    background-color: rgb(248 250 252) !important;
  }

  .pac-item-selected {
    background-color: rgb(241 245 249) !important;
  }

  .pac-item-query {
    color: rgb(15 23 42) !important;
    font-size: 0.9375rem !important;
  }

  .pac-matched {
    font-weight: 600 !important;
    color: rgb(15 23 42) !important;
  }

  .pac-icon {
    margin-right: 0.5rem !important;
  }
}
</file>

<file path="app/layout.tsx">
import type React from "react"
import type { Metadata } from "next"
import localFont from "next/font/local"
import Script from "next/script"
import "./globals.css"
import { DailyLoginChecker } from "@/components/daily-login-checker"
import { MobileActionBar } from "@/components/mobile-action-bar"
import { Toaster } from "@/components/ui/toaster"
import { Toaster as SonnerToaster } from "@/components/ui/sonner"
import { cn } from "@/lib/utils"
import Providers from "./providers"

// Pretendard Variable í°íŠ¸ ì„¤ì •
const pretendard = localFont({
  src: "./fonts/PretendardVariable.woff2",
  display: "swap",
  variable: "--font-pretendard",
  weight: "45 920",
})

export const metadata: Metadata = {
  // ì¹´ì¹´ì˜¤í†¡/ë©”ì‹ ì € ë§í¬ ë¯¸ë¦¬ë³´ê¸°ìš© ê¸°ë³¸ ë©”íƒ€ë°ì´í„°
  // ì œëª©ì€ "Seoul Founders Club" ë§Œ ë³´ì´ë„ë¡ ì‹¬í”Œí•˜ê²Œ ì„¤ì •
  title: {
    default: "Seoul Founders Club",
    template: "%s | Seoul Founders Club",
  },
  description: "ì„œìš¸ íŒŒìš´ë”ìŠ¤ í´ëŸ½",
  keywords: ["ì„œìš¸ íŒŒìš´ë”ìŠ¤ í´ëŸ½", "ì°½ì—…ê°€ ì»¤ë®¤ë‹ˆí‹°", "ë¹„ì¦ˆë‹ˆìŠ¤ ë„¤íŠ¸ì›Œí‚¹", "ìŠ¤íƒ€íŠ¸ì—…", "íˆ¬ìì", "ì¸í”Œë£¨ì–¸ì„œ", "Seoul Founders Club"],
  authors: [{ name: "Seoul Founders Club" }],
  creator: "Seoul Founders Club",
  publisher: "Seoul Founders Club",
  formatDetection: {
    email: false,
    address: false,
    telephone: false,
  },
  metadataBase: new URL(process.env.NEXT_PUBLIC_SITE_URL || "https://seoulfounders.club"),
  alternates: {
    canonical: "/",
  },
  openGraph: {
    type: "website",
    locale: "ko_KR",
    url: "https://seoulfounders.club",
    siteName: "Seoul Founders Club",
    title: "Seoul Founders Club",
    description: "ì„œìš¸ íŒŒìš´ë”ìŠ¤ í´ëŸ½",
    images: [
      {
        // ì¹´ì¹´ì˜¤í†¡ ë“±ì—ì„œ ì‚¬ìš©í•  ëŒ€í‘œ OG ì´ë¯¸ì§€ (ì›í˜• ë¡œê³  ì¤‘ì•™ ì •ë ¬ëœ ì´ë¯¸ì§€)
        // ì¹´ì¹´ì˜¤í†¡ ê¶Œì¥ ë¹„ìœ¨: 1200x630 (1.91:1)
        // opengraph-image.tsxì—ì„œ ë™ì ìœ¼ë¡œ ìƒì„±ë¨
        url: `${process.env.NEXT_PUBLIC_SITE_URL || "https://seoulfounders.club"}/opengraph-image`,
        width: 1200,
        height: 630,
        alt: "Seoul Founders Club",
        type: "image/png",
      },
    ],
  },
  twitter: {
    card: "summary_large_image",
    title: "Seoul Founders Club",
    description: "ì„œìš¸ íŒŒìš´ë”ìŠ¤ í´ëŸ½",
    images: ["https://seoulfounders.club/images/logo-circle.png"],
  },
  robots: {
    index: true,
    follow: true,
    googleBot: {
      index: true,
      follow: true,
      "max-video-preview": -1,
      "max-image-preview": "large",
      "max-snippet": -1,
    },
  },
  verification: {
    // Google Search Console ë“±ì—ì„œ ì œê³µí•˜ëŠ” verification ì½”ë“œë¥¼ ì—¬ê¸°ì— ì¶”ê°€
    google: "GOOGLE_SITE_VERIFICATION_CODE_HERE",
  },
}

export const viewport = {
  width: "device-width",
  initialScale: 1,
  maximumScale: 5,
  userScalable: true,
}

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode
}>) {
  return (
    <html lang="ko" className={pretendard.variable} suppressHydrationWarning>
      <head>
        {/* ìŠ¤í¬ë¡¤ë°” ë ˆì´ì•„ì›ƒ ì‹œí”„íŠ¸ ë°©ì§€ - ì´ˆê¸° ë Œë”ë§ ì „ì— ì¦‰ì‹œ ì‹¤í–‰ */}
        <script
          dangerouslySetInnerHTML={{
            __html: `
(function() {
  'use strict';
  
  // ì¦‰ì‹œ ì‹¤í–‰í•˜ì—¬ ì´ˆê¸° ë Œë”ë§ ì „ì— ìŠ¤í¬ë¡¤ë°” ë„ˆë¹„ë¥¼ í™•ë³´
  function fixScrollbar() {
    try {
      // ìŠ¤í¬ë¡¤ë°” ë„ˆë¹„ ê³„ì‚° (ê°€ì¥ ì •í™•í•œ ë°©ë²•)
      var scrollbarWidth = window.innerWidth - document.documentElement.clientWidth;
      
      // ìŠ¤í¬ë¡¤ë°”ê°€ ì—†ëŠ” ê²½ìš° (ëª¨ë°”ì¼ ë“±) ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•ŠìŒ
      if (scrollbarWidth <= 0) return;
      
      var body = document.body;
      if (!body) return;
      
      // ì´ë¯¸ ì ìš©ë˜ì–´ ìˆì§€ ì•Šì€ ê²½ìš°ì—ë§Œ ì ìš©
      if (body.style.getPropertyValue('--scrollbar-fix-applied')) return;
      
      // í˜„ì¬ padding-right ê°’ ê°€ì ¸ì˜¤ê¸°
      var computedStyle = window.getComputedStyle(body);
      var currentPaddingRight = computedStyle.paddingRight;
      var currentPaddingRightValue = parseInt(currentPaddingRight, 10) || 0;
      
      // ì›ë³¸ padding-right ê°’ ì €ì¥
      body.style.setProperty('--body-padding-right-original', currentPaddingRight || '0px', 'important');
      
      // ìŠ¤í¬ë¡¤ë°” ë„ˆë¹„ë§Œí¼ padding-right ì¶”ê°€
      var newPaddingRight = currentPaddingRightValue + scrollbarWidth;
      body.style.setProperty('padding-right', newPaddingRight + 'px', 'important');
      body.style.setProperty('--scrollbar-fix-applied', 'true');
    } catch (e) {
      // ì—ëŸ¬ ë°œìƒ ì‹œ ë¬´ì‹œ (ì•ˆì „í•˜ê²Œ)
      console.warn('Scrollbar fix error:', e);
    }
  }
  
  // ì¦‰ì‹œ ì‹¤í–‰ ì‹œë„
  if (document.body) {
    fixScrollbar();
  }
  
  // DOMContentLoaded ì‹œì—ë„ ì‹¤í–‰ (bodyê°€ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ì„ ê²½ìš° ëŒ€ë¹„)
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', fixScrollbar, { once: true });
  } else {
    // ì´ë¯¸ ë¡œë“œëœ ê²½ìš° ì¦‰ì‹œ ì‹¤í–‰
    setTimeout(fixScrollbar, 0);
  }
  
  // bodyê°€ ì•„ì§ ì—†ìœ¼ë©´ MutationObserverë¡œ ëŒ€ê¸°
  if (!document.body) {
    var observer = new MutationObserver(function() {
      if (document.body) {
        fixScrollbar();
        observer.disconnect();
      }
    });
    observer.observe(document.documentElement, { childList: true });
    
    // íƒ€ì„ì•„ì›ƒìœ¼ë¡œ ì•ˆì „ì¥ì¹˜ (5ì´ˆ í›„ ì¤‘ë‹¨)
    setTimeout(function() {
      observer.disconnect();
    }, 5000);
  }
})();
            `,
          }}
        />
        {/* Google Tag Manager */}
        <Script
          id="gtm-script"
          strategy="afterInteractive"
          dangerouslySetInnerHTML={{
            __html: `(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-K8DN9RB2');`,
          }}
        />
      </head>
      <body className={cn(pretendard.className, "pb-16 lg:pb-0")} suppressHydrationWarning>
        {/* Google Tag Manager (noscript) */}
        <noscript>
          <iframe
            src="https://www.googletagmanager.com/ns.html?id=GTM-K8DN9RB2"
            height="0"
            width="0"
            style={{ display: "none", visibility: "hidden" }}
          />
        </noscript>
        {/* Providersê°€ ìµœìƒìœ„ì—ì„œ ê°ì‹¸ì•¼ í•©ë‹ˆë‹¤ */}
        <Providers>
          <DailyLoginChecker />
          {children}
          <MobileActionBar />
          <Toaster />
          <SonnerToaster />
        </Providers>
      </body>
    </html>
  )
}
</file>

<file path="app/partners/layout.tsx">
import type { ReactNode } from "react"
import { StandardLayout } from "@/components/layout/standard-layout"

export default function PartnersLayout({ children }: { children: ReactNode }) {
  return <StandardLayout>{children}</StandardLayout>
}
</file>

<file path="components/admin/badge-management-tab.tsx">
"use client"

import { useState, useEffect, useMemo } from "react"
import { Medal, Plus, Edit2, Trash2, CheckCircle2, XCircle, Eye, GripVertical, FileText, Settings } from "lucide-react"
import { Button } from "@/components/ui/button"
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from "@/components/ui/table"
import { Badge } from "@/components/ui/badge"
import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar"
import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from "@/components/ui/dialog"
import { Input } from "@/components/ui/input"
import { Textarea } from "@/components/ui/textarea"
import { Label } from "@/components/ui/label"
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select"
import Image from "next/image"
import { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from "@/components/ui/alert-dialog"
import { Switch } from "@/components/ui/switch"
import { createBadge, updateBadge, deleteBadge, updateBadgeStatus, toggleBadgeActive } from "@/lib/actions/admin"
import { updateBadgeCategoryOrder, createBadgeCategory, updateBadgeCategory, deleteBadgeCategory } from "@/lib/actions/badge-categories"
import { useRouter } from "next/navigation"
import { Loader2 } from "lucide-react"
import { cn } from "@/lib/utils"
import { useToast } from "@/hooks/use-toast"
import {
  DndContext,
  closestCenter,
  KeyboardSensor,
  PointerSensor,
  useSensor,
  useSensors,
  DragEndEvent,
} from "@dnd-kit/core"
import {
  arrayMove,
  SortableContext,
  sortableKeyboardCoordinates,
  useSortable,
  verticalListSortingStrategy,
} from "@dnd-kit/sortable"
import { CSS } from "@dnd-kit/utilities"

type BadgeType = {
  id: string
  name: string
  icon: string
  category: string
  description: string | null
  is_active?: boolean | null
}

type PendingBadgeType = {
  id: string
  status: string
  evidence: string | null
  proof_url?: string | null // proof_url ì¶”ê°€
  created_at: string
  profiles: {
    id: string
    full_name: string | null
    email: string | null
    avatar_url: string | null
  } | null
  badges: {
    id: string
    name: string
    icon: string
  } | null
}

type BadgeCategoryType = {
  category_value: string
  category_label: string
  sort_order: number
}

type BadgeManagementTabProps = {
  badges: BadgeType[]
  pendingBadges: PendingBadgeType[]
  badgeCategories?: BadgeCategoryType[]
}

const DEFAULT_BADGE_CATEGORIES = [
  { value: "personal_asset", label: "ê°œì¸ ìì‚°" },
  { value: "corporate_revenue", label: "ê¸°ì—… ë§¤ì¶œ" },
  { value: "investment", label: "íˆ¬ì ê·œëª¨" },
  { value: "valuation", label: "ê¸°ì—…ê°€ì¹˜" },
  { value: "influence", label: "ì¸í”Œë£¨ì–¸ì„œ" },
  { value: "professional", label: "ì „ë¬¸ì§" },
  { value: "community", label: "ì»¤ë®¤ë‹ˆí‹°" },
]

// ê°œë³„ ë±ƒì§€ í–‰ ì»´í¬ë„ŒíŠ¸ (ë¡œì»¬ stateë¡œ í† ê¸€ ìƒíƒœ ê´€ë¦¬)
function BadgeRow({
  badge,
  badgeCategories,
  isProcessing,
  processingAction,
  onToggleActive,
  onEdit,
  onDelete,
}: {
  badge: BadgeType
  badgeCategories: BadgeCategoryType[]
  isProcessing: boolean
  processingAction: 'create' | 'update' | 'delete' | 'approve' | 'reject' | null
  onToggleActive: (badgeId: string, currentActive: boolean) => Promise<void>
  onEdit: (badge: BadgeType) => void
  onDelete: (badgeId: string) => void
}) {
  // ê° ë±ƒì§€ í–‰ì˜ ë¡œì»¬ state (ë‚™ê´€ì  ì—…ë°ì´íŠ¸ìš©)
  const initialActive = badge.is_active !== false // nullì´ë‚˜ undefinedë„ trueë¡œ ì²˜ë¦¬
  const [isActive, setIsActive] = useState(initialActive)

  // propsì˜ badgeê°€ ë³€ê²½ë˜ë©´ ë¡œì»¬ state ë™ê¸°í™”
  useEffect(() => {
    const newActive = badge.is_active !== false
    setIsActive(newActive)
  }, [badge.is_active])

  const handleToggle = async (checked: boolean) => {
    const previousState = isActive

    console.log(`[BadgeRow] í† ê¸€ ì‹œë„: badgeId=${badge.id}, previousState=${previousState}, newState=${checked}`)

    // ë‚™ê´€ì  ì—…ë°ì´íŠ¸: UIë¥¼ ë¨¼ì € ì—…ë°ì´íŠ¸
    setIsActive(checked)

    try {
      // ì„œë²„ API í˜¸ì¶œ
      console.log(`[BadgeRow] API í˜¸ì¶œ ì‹œì‘: badgeId=${badge.id}, previousState=${previousState}, newState=${checked}`)
      await onToggleActive(badge.id, previousState)
      console.log(`[BadgeRow] í† ê¸€ ì„±ê³µ: badgeId=${badge.id}, newState=${checked}`)
    } catch (error) {
      // ì‹¤íŒ¨ ì‹œ ì´ì „ ìƒíƒœë¡œ ë¡¤ë°±
      console.error("API Error Details:", error)
      console.error("í† ê¸€ ì‹¤íŒ¨ ì›ì¸:", error)
      console.error("í† ê¸€ ì‹¤íŒ¨ ìƒì„¸:", {
        badgeId: badge.id,
        badgeName: badge.name,
        previousState,
        attemptedState: checked,
        errorMessage: error instanceof Error ? error.message : String(error),
        errorStack: error instanceof Error ? error.stack : undefined,
        errorName: error instanceof Error ? error.name : undefined,
        errorCode: (error as any)?.code,
        errorDetails: (error as any)?.details,
        errorHint: (error as any)?.hint,
      })
      console.error("[BadgeRow] ìƒíƒœ ë¡¤ë°±: previousState=", previousState)
      setIsActive(previousState)
      throw error // ìƒìœ„ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì—ëŸ¬ ì²˜ë¦¬í•˜ë„ë¡
    }
  }

  const isThisBadgeProcessing = isProcessing && processingAction === 'update'

  return (
    <TableRow
      className={cn(
        "transition-all duration-200",
        !isActive && "opacity-50 grayscale"
      )}
    >
      <TableCell>
        <div className="flex items-center justify-center w-8 h-8">
          <span className="text-2xl leading-none">{badge.icon}</span>
        </div>
      </TableCell>
      <TableCell>
        <Badge variant="outline" className="text-xs font-medium">
          {badgeCategories.find(c => c.category_value === badge.category)?.category_label || badge.category}
        </Badge>
      </TableCell>
      <TableCell>
        <div className="font-medium text-slate-900">{badge.name}</div>
      </TableCell>
      <TableCell>
        <div className="text-sm text-slate-600 max-w-md truncate">
          {badge.description || "-"}
        </div>
      </TableCell>
      <TableCell className="text-right">
        <div className="flex items-center justify-end gap-3">
          <div className="flex items-center gap-3">
            <Switch
              checked={isActive}
              onCheckedChange={handleToggle}
              disabled={isThisBadgeProcessing}
              className={cn(
                "w-11 h-6 transition-all duration-200",
                isActive
                  ? "data-[state=checked]:bg-green-600"
                  : "data-[state=unchecked]:bg-gray-300"
              )}
            />
            <span className={cn(
              "text-sm whitespace-nowrap transition-colors duration-200 font-medium",
              isActive ? "text-green-700" : "text-gray-500"
            )}>
              {isActive ? "ê³µê°œ" : "ë¹„ê³µê°œ"}
            </span>
          </div>
          <Button
            onClick={() => onEdit(badge)}
            disabled={isThisBadgeProcessing}
            size="sm"
            variant="outline"
            className="gap-1.5 h-8"
          >
            <Edit2 className="h-3.5 w-3.5" />
            ìˆ˜ì •
          </Button>
          <Button
            onClick={() => onDelete(badge.id)}
            disabled={isThisBadgeProcessing}
            size="sm"
            variant="ghost"
            className={cn(
              "gap-1.5 h-8 text-red-600 hover:text-red-700 hover:bg-red-50 border border-red-200",
              "transition-colors duration-200"
            )}
          >
            <Trash2 className="h-3.5 w-3.5" />
            ì‚­ì œ
          </Button>
        </div>
      </TableCell>
    </TableRow>
  )
}

// í…ŒìŠ¤íŠ¸ìš© ë”ë¯¸ ë°ì´í„° (ê°œë°œ í™˜ê²½ì—ì„œë§Œ ì‚¬ìš©)
const DUMMY_BADGES: BadgeType[] = [
  { id: '1', name: 'ìì‚° 10ì–µ+', icon: 'ğŸ’', category: 'personal_asset', description: 'ìˆœìì‚° 10ì–µ ì› ì´ìƒ ì¸ì¦', is_active: true },
  { id: '2', name: 'ë§¤ì¶œ 50ì–µ+', icon: 'ğŸ“ˆ', category: 'corporate_revenue', description: 'ì—° ë§¤ì¶œ 50ì–µ ì› ì´ìƒ ì¸ì¦', is_active: true },
  { id: '3', name: 'íˆ¬ì 10ì–µ+', icon: 'ğŸ’°', category: 'investment', description: 'ëˆ„ì  íˆ¬ì ì§‘í–‰ì•¡ 10ì–µ ì› ì´ìƒ', is_active: true },
  { id: '4', name: 'ê¸°ì—…ê°€ì¹˜ 100ì–µ+', icon: 'ğŸ™ï¸', category: 'valuation', description: 'ìµœê·¼ íˆ¬ì ìœ ì¹˜ ê¸°ì¤€ ê¸°ì—…ê°€ì¹˜ 100ì–µ ì› ì´ìƒ', is_active: false },
  { id: '5', name: 'ë³€í˜¸ì‚¬', icon: 'âš–ï¸', category: 'professional', description: 'ëŒ€í•œë¯¼êµ­ ë³€í˜¸ì‚¬ ìê²© ì¸ì¦', is_active: true },
]

// ì¹´í…Œê³ ë¦¬ ì„¹ì…˜ ì»´í¬ë„ŒíŠ¸ (ë“œë˜ê·¸ ê°€ëŠ¥)
function CategorySection({
  categoryValue,
  categoryLabel,
  badges,
  badgeCategories,
  isProcessing,
  processingAction,
  onToggleActive,
  onEdit,
  onDelete,
  onEditCategory,
  onDeleteCategory,
}: {
  categoryValue: string
  categoryLabel: string
  badges: BadgeType[]
  badgeCategories: BadgeCategoryType[] // ê¸°ë³¸ ì¹´í…Œê³ ë¦¬ íƒ€ì…
  isProcessing: boolean
  processingAction: 'create' | 'update' | 'delete' | 'approve' | 'reject' | null
  onToggleActive: (badgeId: string, currentActive: boolean) => Promise<void>
  onEdit: (badge: BadgeType) => void
  onDelete: (badgeId: string) => void
  onEditCategory: (category: BadgeCategoryType) => void
  onDeleteCategory: (categoryValue: string) => void
}) {
  const {
    attributes,
    listeners,
    setNodeRef,
    transform,
    transition,
    isDragging,
  } = useSortable({ id: categoryValue })

  const style = {
    transform: CSS.Transform.toString(transform),
    transition,
    opacity: isDragging ? 0.5 : 1,
  }

  return (
    <div ref={setNodeRef} style={style} className="mb-6">
      {/* ì¹´í…Œê³ ë¦¬ í—¤ë” */}
      <div className="bg-gray-100 p-3 rounded-lg mb-3 flex items-center justify-between group">
        <div className="flex items-center gap-3 cursor-move">
          <div
            {...attributes}
            {...listeners}
            className="flex items-center justify-center text-gray-400 hover:text-gray-600 transition-colors"
          >
            <GripVertical className="h-5 w-5" />
          </div>
          <h3 className="text-lg font-semibold text-slate-900">
            {categoryLabel}
          </h3>
          <Badge variant="outline" className="text-xs">
            {badges.length}ê°œ
          </Badge>
        </div>

        <div className="flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
          <Button
            variant="ghost"
            size="icon"
            className="h-8 w-8 text-slate-500 hover:text-slate-700"
            onClick={() => onEditCategory({ category_value: categoryValue, category_label: categoryLabel, sort_order: 0 })}
          >
            <Edit2 className="h-4 w-4" />
          </Button>
          <Button
            variant="ghost"
            size="icon"
            className="h-8 w-8 text-slate-500 hover:text-red-600"
            onClick={() => onDeleteCategory(categoryValue)}
          >
            <Trash2 className="h-4 w-4" />
          </Button>
        </div>
      </div>

      {/* ë±ƒì§€ ë¦¬ìŠ¤íŠ¸ (ë“¤ì—¬ì“°ê¸°) */}
      {badges.length > 0 ? (
        <div className="ml-4 border border-slate-200 rounded-lg overflow-hidden">
          <Table>
            <TableHeader>
              <TableRow>
                <TableHead className="w-16">ì¸ë„¤ì¼</TableHead>
                <TableHead className="w-32">ì¹´í…Œê³ ë¦¬</TableHead>
                <TableHead className="w-48">ì´ë¦„</TableHead>
                <TableHead>ì„¤ëª…</TableHead>
                <TableHead className="text-right w-64">ê´€ë¦¬</TableHead>
              </TableRow>
            </TableHeader>
            <TableBody>
              {badges.map((badge) => (
                <BadgeRow
                  key={badge.id}
                  badge={badge}
                  badgeCategories={badgeCategories}
                  isProcessing={isProcessing}
                  processingAction={processingAction}
                  onToggleActive={onToggleActive}
                  onEdit={onEdit}
                  onDelete={onDelete}
                />
              ))}
            </TableBody>
          </Table>
        </div>
      ) : (
        <div className="ml-4 border border-slate-200 rounded-lg p-8 text-center text-slate-500">
          ì´ ì¹´í…Œê³ ë¦¬ì— ë±ƒì§€ê°€ ì—†ìŠµë‹ˆë‹¤
        </div>
      )}
    </div>
  )
}

export function BadgeManagementTab({ badges, pendingBadges, badgeCategories: badgeCategoriesProp = [] }: BadgeManagementTabProps) {
  const router = useRouter()
  const { toast } = useToast()
  // badgesê°€ ë¹„ì–´ìˆìœ¼ë©´ ë”ë¯¸ ë°ì´í„° ì‚¬ìš© (ê°œë°œ í™˜ê²½)
  const initialBadges = badges && badges.length > 0 ? badges : (process.env.NODE_ENV === 'development' ? DUMMY_BADGES : [])
  const [localBadges, setLocalBadges] = useState<BadgeType[]>(initialBadges)
  const defaultBadgeCategories: BadgeCategoryType[] = DEFAULT_BADGE_CATEGORIES.map((cat, index) => ({
    category_value: cat.value,
    category_label: cat.label,
    sort_order: index,
  }))
  const initialBadgeCategories = badgeCategoriesProp.length > 0 ? badgeCategoriesProp : defaultBadgeCategories
  const [localBadgeCategories, setLocalBadgeCategories] = useState<BadgeCategoryType[]>(initialBadgeCategories)
  const [showCreateDialog, setShowCreateDialog] = useState(false)
  const [showEditDialog, setShowEditDialog] = useState(false)
  const [showEvidenceDialog, setShowEvidenceDialog] = useState(false)
  const [showDeleteDialog, setShowDeleteDialog] = useState(false)
  const [deletingBadgeId, setDeletingBadgeId] = useState<string | null>(null)
  const [editingBadge, setEditingBadge] = useState<BadgeType | null>(null)
  const [viewingEvidence, setViewingEvidence] = useState<{ text: string, url?: string | null }>({ text: "", url: null })
  const [isProcessing, setIsProcessing] = useState(false)
  const [processingAction, setProcessingAction] = useState<'create' | 'update' | 'delete' | 'approve' | 'reject' | null>(null)

  // ì¹´í…Œê³ ë¦¬ ê´€ë ¨ state
  const [showCategoryCreateDialog, setShowCategoryCreateDialog] = useState(false)
  const [showCategoryEditDialog, setShowCategoryEditDialog] = useState(false)
  const [showCategoryDeleteDialog, setShowCategoryDeleteDialog] = useState(false)
  const [editingCategory, setEditingCategory] = useState<BadgeCategoryType | null>(null)
  const [deletingCategoryValue, setDeletingCategoryValue] = useState<string | null>(null)
  const [categoryFormData, setCategoryFormData] = useState({ label: "", value: "" })

  const [formData, setFormData] = useState({
    name: "",
    icon: "",
    category: "",
    description: "",
  })

  // ë°˜ë ¤ ë‹¤ì´ì–¼ë¡œê·¸ ê´€ë ¨ state
  const [showRejectDialog, setShowRejectDialog] = useState(false)
  const [rejectingBadgeId, setRejectingBadgeId] = useState<string | null>(null)
  const [rejectionMessage, setRejectionMessage] = useState("")

  // ë“œë˜ê·¸ì•¤ë“œë¡­ ì„¼ì„œ ì„¤ì •
  const sensors = useSensors(
    useSensor(PointerSensor),
    useSensor(KeyboardSensor, {
      coordinateGetter: sortableKeyboardCoordinates,
    })
  )

  // badges propì´ ë³€ê²½ë˜ë©´ ë¡œì»¬ state ì—…ë°ì´íŠ¸
  useEffect(() => {
    if (badges && badges.length > 0) {
      setLocalBadges(badges)
    } else if (process.env.NODE_ENV === 'development') {
      // ê°œë°œ í™˜ê²½ì—ì„œë§Œ ë”ë¯¸ ë°ì´í„° ì‚¬ìš©
      setLocalBadges(DUMMY_BADGES)
    } else {
      setLocalBadges([])
    }
  }, [badges])

  // badgeCategories propì´ ë³€ê²½ë˜ë©´ ë¡œì»¬ state ì—…ë°ì´íŠ¸
  useEffect(() => {
    if (badgeCategoriesProp && badgeCategoriesProp.length > 0) {
      setLocalBadgeCategories(badgeCategoriesProp)
    } else {
      // DBì— ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ ì¹´í…Œê³ ë¦¬ ëª©ë¡ ì‚¬ìš©
      const defaultCategories: BadgeCategoryType[] = DEFAULT_BADGE_CATEGORIES.map((cat, index) => ({
        category_value: cat.value,
        category_label: cat.label,
        sort_order: index,
      }))
      setLocalBadgeCategories(defaultCategories)
    }
  }, [badgeCategoriesProp])

  // ì¹´í…Œê³ ë¦¬ë³„ë¡œ ë±ƒì§€ ê·¸ë£¹í™”
  const badgesByCategory = useMemo(() => {
    const grouped: Record<string, BadgeType[]> = {}

    // ë¨¼ì € ëª¨ë“  ì¹´í…Œê³ ë¦¬ì— ëŒ€í•´ ë¹ˆ ë°°ì—´ ì´ˆê¸°í™”
    localBadgeCategories.forEach((cat) => {
      grouped[cat.category_value] = []
    })

    // ë±ƒì§€ë¥¼ ì¹´í…Œê³ ë¦¬ë³„ë¡œ ë¶„ë¥˜
    localBadges.forEach((badge) => {
      // ì¹´í…Œê³ ë¦¬ê°€ ì—†ì„ ê²½ìš° 'ë¯¸ë¶„ë¥˜' ë“±ìœ¼ë¡œ ì²˜ë¦¬í•˜ê±°ë‚˜ skip
      if (!grouped[badge.category] && !localBadgeCategories.find(c => c.category_value === badge.category)) {
        // ë§Œì•½ ì¹´í…Œê³ ë¦¬ ëª©ë¡ì— ì—†ëŠ” ì¹´í…Œê³ ë¦¬ë¥¼ ê°€ì§„ ë±ƒì§€ê°€ ìˆë‹¤ë©´, ì„ì‹œë¡œ ì¶”ê°€í•˜ì§€ ì•ŠìŒ
        // í˜¹ì€ 'ê¸°íƒ€' ì¹´í…Œê³ ë¦¬ë¥¼ ë§Œë“¤ì–´ì„œ ë„£ì„ ìˆ˜ë„ ìˆìŒ
        // ì—¬ê¸°ì„œëŠ” ì¼ë‹¨ skip
        return
      }

      if (!grouped[badge.category]) {
        grouped[badge.category] = []
      }
      grouped[badge.category].push(badge)
    })

    return grouped
  }, [localBadges, localBadgeCategories])

  // ì¹´í…Œê³ ë¦¬ ìˆœì„œì— ë”°ë¼ ì •ë ¬ëœ ì¹´í…Œê³ ë¦¬ ëª©ë¡
  const sortedCategories = useMemo(() => {
    return [...localBadgeCategories].sort((a, b) => a.sort_order - b.sort_order)
  }, [localBadgeCategories])

  // ë“œë˜ê·¸ì•¤ë“œë¡­ í•¸ë“¤ëŸ¬
  const handleDragEnd = async (event: DragEndEvent) => {
    const { active, over } = event

    if (!over || active.id === over.id) {
      return
    }

    const oldIndex = sortedCategories.findIndex((cat) => cat.category_value === active.id)
    const newIndex = sortedCategories.findIndex((cat) => cat.category_value === over.id)

    if (oldIndex === -1 || newIndex === -1) {
      return
    }

    // ë‚™ê´€ì  ì—…ë°ì´íŠ¸: í™”ë©´ì„ ì¦‰ì‹œ ì—…ë°ì´íŠ¸
    const newCategories = arrayMove(sortedCategories, oldIndex, newIndex)
    const updatedCategories = newCategories.map((cat, index) => ({
      ...cat,
      sort_order: index,
    }))
    setLocalBadgeCategories(updatedCategories)

    // ë°±ê·¸ë¼ìš´ë“œì—ì„œ DB ì—…ë°ì´íŠ¸
    try {
      await updateBadgeCategoryOrder(
        updatedCategories.map((cat) => ({
          category_value: cat.category_value,
          sort_order: cat.sort_order,
        }))
      )
      toast({
        title: "ìˆœì„œ ë³€ê²½ ì™„ë£Œ",
        description: "ì¹´í…Œê³ ë¦¬ ìˆœì„œê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.",
      })
      router.refresh()
    } catch (error) {
      console.error("Failed to update category order:", error)
      // ì‹¤íŒ¨ ì‹œ ì´ì „ ìƒíƒœë¡œ ë¡¤ë°±
      setLocalBadgeCategories(badgeCategoriesProp)
      toast({
        variant: "destructive",
        title: "ìˆœì„œ ë³€ê²½ ì‹¤íŒ¨",
        description: error instanceof Error ? error.message : "ì¹´í…Œê³ ë¦¬ ìˆœì„œ ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",
      })
    }
  }

  const handleCreate = async () => {
    if (!formData.name || !formData.icon || !formData.category) {
      alert("ì´ë¦„, ì•„ì´ì½˜, ì¹´í…Œê³ ë¦¬ëŠ” í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤.")
      return
    }

    setIsProcessing(true)
    setProcessingAction('create')
    try {
      await createBadge(
        formData.name,
        formData.icon,
        formData.category,
        formData.description || null
      )

      // ë‚™ê´€ì  ì—…ë°ì´íŠ¸: ë¡œì»¬ stateì— ì¦‰ì‹œ ì¶”ê°€í•˜ì—¬ í™”ë©´ì— ë°”ë¡œ í‘œì‹œ
      const newBadge: BadgeType = {
        id: crypto.randomUUID(), // ì„ì‹œ ID (ì„œë²„ì—ì„œ ì‹¤ì œ IDê°€ ì˜¤ë©´ êµì²´ë¨)
        name: formData.name,
        icon: formData.icon,
        category: formData.category,
        description: formData.description || null,
        is_active: true, // ìƒˆë¡œ ìƒì„±ëœ ë±ƒì§€ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ í™œì„±í™”
      }

      setLocalBadges((prev) => [...prev, newBadge])

      // ì„±ê³µ í† ìŠ¤íŠ¸ ë©”ì‹œì§€
      toast({
        title: "ë±ƒì§€ ìƒì„± ì™„ë£Œ",
        description: `${formData.name} ë±ƒì§€ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.`,
      })

      setShowCreateDialog(false)
      setFormData({ name: "", icon: "", category: "", description: "" })
      router.refresh()
    } catch (error) {
      console.error("Failed to create badge:", error)
      toast({
        variant: "destructive",
        title: "ë±ƒì§€ ìƒì„± ì‹¤íŒ¨",
        description: error instanceof Error ? error.message : "ë±ƒì§€ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",
      })
    } finally {
      setIsProcessing(false)
      setProcessingAction(null)
    }
  }

  const handleEdit = (badge: BadgeType) => {
    setEditingBadge(badge)
    setFormData({
      name: badge.name,
      icon: badge.icon,
      category: badge.category,
      description: badge.description || "",
    })
    setShowEditDialog(true)
  }

  const handleUpdate = async () => {
    if (!editingBadge || !formData.name || !formData.icon || !formData.category) {
      alert("ì´ë¦„, ì•„ì´ì½˜, ì¹´í…Œê³ ë¦¬ëŠ” í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤.")
      return
    }

    setIsProcessing(true)
    setProcessingAction('update')
    try {
      await updateBadge(
        editingBadge.id,
        formData.name,
        formData.icon,
        formData.category,
        formData.description || null
      )
      setShowEditDialog(false)
      setEditingBadge(null)
      setFormData({ name: "", icon: "", category: "", description: "" })
      router.refresh()
    } catch (error) {
      console.error("Failed to update badge:", error)
      alert("ë±ƒì§€ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")
    } finally {
      setIsProcessing(false)
      setProcessingAction(null)
    }
  }

  const handleDeleteClick = (badgeId: string) => {
    setDeletingBadgeId(badgeId)
    setShowDeleteDialog(true)
  }

  const handleDeleteConfirm = async () => {
    if (!deletingBadgeId) return

    setIsProcessing(true)
    setProcessingAction('delete')
    try {
      await deleteBadge(deletingBadgeId)

      // ë¡œì»¬ stateì—ì„œ ì¦‰ì‹œ ì œê±°
      setLocalBadges((prev) => prev.filter((badge) => badge.id !== deletingBadgeId))

      // ì„±ê³µ í† ìŠ¤íŠ¸ ë©”ì‹œì§€
      toast({
        title: "ì‚­ì œ ì™„ë£Œ",
        description: "ë±ƒì§€ê°€ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.",
      })

      setShowDeleteDialog(false)
      setDeletingBadgeId(null)
      router.refresh()
    } catch (error) {
      console.error("Failed to delete badge:", error)
      toast({
        variant: "destructive",
        title: "ì‚­ì œ ì‹¤íŒ¨",
        description: error instanceof Error ? error.message : "ë±ƒì§€ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",
      })
    } finally {
      setIsProcessing(false)
      setProcessingAction(null)
    }
  }

  const handleToggleActive = async (badgeId: string, currentActive: boolean) => {
    const newActiveState = !currentActive

    console.log(`[handleToggleActive] ì‹œì‘: badgeId=${badgeId}, currentActive=${currentActive}, newActiveState=${newActiveState}`)

    setIsProcessing(true)
    setProcessingAction('update')

    try {
      // ì„œë²„ API í˜¸ì¶œ
      console.log(`[handleToggleActive] toggleBadgeActive í˜¸ì¶œ: badgeId=${badgeId}, newActiveState=${newActiveState}`)
      await toggleBadgeActive(badgeId, newActiveState)
      console.log(`[handleToggleActive] toggleBadgeActive ì„±ê³µ: badgeId=${badgeId}`)

      // ì„±ê³µ ì‹œ ë¡œì»¬ state ì—…ë°ì´íŠ¸ (BadgeRowì˜ ë¡œì»¬ stateì™€ ë™ê¸°í™”)
      setLocalBadges((prev) =>
        prev.map((badge) =>
          badge.id === badgeId ? { ...badge, is_active: newActiveState } : badge
        )
      )

      // ì„±ê³µ ì‹œ í† ìŠ¤íŠ¸ ë©”ì‹œì§€
      toast({
        title: newActiveState ? "ë±ƒì§€ ê³µê°œ ì²˜ë¦¬" : "ë±ƒì§€ ë¹„ê³µê°œ ì²˜ë¦¬",
        description: newActiveState
          ? "ë±ƒì§€ê°€ ê³µê°œë¡œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤."
          : "ë±ƒì§€ê°€ ë¹„ê³µê°œë¡œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.",
      })
    } catch (error) {
      console.error("[handleToggleActive] API Error Details:", error)
      console.error("[handleToggleActive] Failed to toggle badge active:", {
        badgeId,
        currentActive,
        newActiveState,
        error: error instanceof Error ? error.message : String(error),
        errorCode: (error as any)?.code,
        errorDetails: (error as any)?.details,
        errorStack: error instanceof Error ? error.stack : undefined,
      })

      toast({
        variant: "destructive",
        title: "ìƒíƒœ ë³€ê²½ ì‹¤íŒ¨",
        description: error instanceof Error ? error.message : "ë±ƒì§€ ìƒíƒœ ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",
      })
      // ì—ëŸ¬ëŠ” BadgeRow ì»´í¬ë„ŒíŠ¸ì—ì„œ ë¡¤ë°± ì²˜ë¦¬ë¨
      throw error
    } finally {
      setIsProcessing(false)
      setProcessingAction(null)
    }
  }

  const handleApprove = async (userBadgeId: string) => {
    if (!confirm("ì´ ë±ƒì§€ ì‹ ì²­ì„ ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return

    setIsProcessing(true)
    setProcessingAction('approve')
    try {
      await updateBadgeStatus(userBadgeId, 'approved')
      toast({
        title: "ìŠ¹ì¸ ì™„ë£Œ",
        description: "ë±ƒì§€ ì‹ ì²­ì´ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤. ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼ì´ ì „ì†¡ë©ë‹ˆë‹¤.",
      })
      router.refresh()
    } catch (error) {
      console.error("Failed to approve badge:", error)
      toast({
        variant: "destructive",
        title: "ìŠ¹ì¸ ì‹¤íŒ¨",
        description: error instanceof Error ? error.message : "ìŠ¹ì¸ ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",
      })
    } finally {
      setIsProcessing(false)
      setProcessingAction(null)
    }
  }

  const handleRejectClick = (userBadgeId: string) => {
    setRejectingBadgeId(userBadgeId)
    setRejectionMessage("")
    setShowRejectDialog(true)
  }

  const handleRejectConfirm = async () => {
    if (!rejectingBadgeId) return

    setIsProcessing(true)
    setProcessingAction('reject')
    try {
      await updateBadgeStatus(rejectingBadgeId, 'rejected', rejectionMessage || undefined)
      toast({
        title: "ë°˜ë ¤ ì™„ë£Œ",
        description: "ë±ƒì§€ ì‹ ì²­ì´ ë°˜ë ¤ë˜ì—ˆìŠµë‹ˆë‹¤.",
      })
      setShowRejectDialog(false)
      setRejectingBadgeId(null)
      setRejectionMessage("")
      router.refresh()
    } catch (error) {
      console.error("Failed to reject badge:", error)
      toast({
        variant: "destructive",
        title: "ë°˜ë ¤ ì‹¤íŒ¨",
        description: error instanceof Error ? error.message : "ë°˜ë ¤ ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",
      })
    } finally {
      setIsProcessing(false)
      setProcessingAction(null)
    }
  }

  // ì¹´í…Œê³ ë¦¬ ê´€ë ¨ í•¸ë“¤ëŸ¬
  const handleCreateCategory = async () => {
    if (!categoryFormData.label) {
      alert("ì¹´í…Œê³ ë¦¬ ì´ë¦„ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.")
      return
    }

    // valueê°€ ì—†ìœ¼ë©´ labelì„ ê¸°ë°˜ìœ¼ë¡œ ìë™ ìƒì„± (ì˜ë¬¸/ìˆ«ìë§Œ ë‚¨ê¸°ê³  ì†Œë¬¸ì ë³€í™˜ ë“±)
    // ì—¬ê¸°ì„œëŠ” ê°„ë‹¨í•˜ê²Œ ëœë¤ UUIDì˜ ì¼ë¶€ë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜, í•œê¸€ì´ë©´ ê·¸ëƒ¥ labelì„ ê·¸ëŒ€ë¡œ ì“°ë˜ prefix ì¶”ê°€ ë“±
    // í•˜ì§€ë§Œ category_valueëŠ” DBì—ì„œ uniqueì—¬ì•¼ í•¨.
    // ì‚¬ìš©ìê°€ valueë¥¼ ì…ë ¥í•˜ì§€ ì•Šì•˜ë‹¤ë©´ labelì„ ì‚¬ìš©í•˜ë˜, í•œê¸€ ë“± íŠ¹ìˆ˜ë¬¸ì ì²˜ë¦¬ê°€ í•„ìš”í•  ìˆ˜ ìˆìŒ.
    // DBì—ì„œ category_valueëŠ” text íƒ€ì…ì´ë¯€ë¡œ í•œê¸€ë„ ê°€ëŠ¥í•  ìˆ˜ ìˆìœ¼ë‚˜, ë³´í†µì€ ì˜ë¬¸ codeë¥¼ ì„ í˜¸í•¨.
    // ì¼ë‹¨ valueê°€ ìˆìœ¼ë©´ ì“°ê³ , ì—†ìœ¼ë©´ labelì„ ì‚¬ìš© (ì‚¬ìš©ìê°€ ì…ë ¥í•˜ê²Œ ìœ ë„í•˜ëŠ”ê²Œ ì¢‹ìŒ)
    if (!categoryFormData.value) {
      alert("ì¹´í…Œê³ ë¦¬ ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš” (ì˜ˆ: personal_asset)")
      return
    }

    setIsProcessing(true)
    try {
      await createBadgeCategory(categoryFormData.label, categoryFormData.value)
      setShowCategoryCreateDialog(false)
      setCategoryFormData({ label: "", value: "" })
      router.refresh()
      toast({
        title: "ì¹´í…Œê³ ë¦¬ ìƒì„± ì™„ë£Œ",
        description: "ìƒˆë¡œìš´ ì¹´í…Œê³ ë¦¬ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.",
      })
    } catch (error) {
      console.error("Failed to create category:", error)
      toast({
        variant: "destructive",
        title: "ì¹´í…Œê³ ë¦¬ ìƒì„± ì‹¤íŒ¨",
        description: error instanceof Error ? error.message : "ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",
      })
    } finally {
      setIsProcessing(false)
    }
  }

  const handleUpdateCategory = async () => {
    if (!editingCategory || !categoryFormData.label) return

    setIsProcessing(true)
    try {
      await updateBadgeCategory(editingCategory.category_value, categoryFormData.label)
      setShowCategoryEditDialog(false)
      setEditingCategory(null)
      setCategoryFormData({ label: "", value: "" })
      router.refresh()
      toast({
        title: "ì¹´í…Œê³ ë¦¬ ìˆ˜ì • ì™„ë£Œ",
        description: "ì¹´í…Œê³ ë¦¬ ì´ë¦„ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.",
      })
    } catch (error) {
      console.error("Failed to update category:", error)
      toast({
        variant: "destructive",
        title: "ì¹´í…Œê³ ë¦¬ ìˆ˜ì • ì‹¤íŒ¨",
        description: error instanceof Error ? error.message : "ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",
      })
    } finally {
      setIsProcessing(false)
    }
  }

  const handleDeleteCategory = async () => {
    if (!deletingCategoryValue) return

    setIsProcessing(true)
    try {
      await deleteBadgeCategory(deletingCategoryValue)
      setShowCategoryDeleteDialog(false)
      setDeletingCategoryValue(null)
      router.refresh()
      toast({
        title: "ì¹´í…Œê³ ë¦¬ ì‚­ì œ ì™„ë£Œ",
        description: "ì¹´í…Œê³ ë¦¬ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.",
      })
    } catch (error) {
      console.error("Failed to delete category:", error)
      toast({
        variant: "destructive",
        title: "ì¹´í…Œê³ ë¦¬ ì‚­ì œ ì‹¤íŒ¨",
        description: error instanceof Error ? error.message : "ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",
      })
    } finally {
      setIsProcessing(false)
    }
  }

  return (
    <div className="space-y-8">
      {/* ìƒë‹¨: ë±ƒì§€ ì‹ ì²­ í˜„í™© */}
      <div>
        <h2 className="text-xl font-bold text-slate-900 mb-6">ë±ƒì§€ ì‹ ì²­ í˜„í™©</h2>
        {pendingBadges.length > 0 ? (
          <div>
            <h3 className="text-lg font-semibold text-slate-900 mb-4">ëŒ€ê¸° ì¤‘ì¸ ë±ƒì§€ ì‹ ì²­ ({pendingBadges.length}ê±´)</h3>
            <div className="border border-slate-200 rounded-lg overflow-hidden">
              <Table>
                <TableHeader>
                  <TableRow>
                    <TableHead>ì‹ ì²­ì</TableHead>
                    <TableHead>ì‹ ì²­ ë±ƒì§€</TableHead>
                    <TableHead>ì¦ë¹™ ìë£Œ</TableHead>
                    <TableHead>ì‹ ì²­ì¼</TableHead>
                    <TableHead className="text-right">ê´€ë¦¬</TableHead>
                  </TableRow>
                </TableHeader>
                <TableBody>
                  {pendingBadges.map((badgeRequest) => {
                    const user = badgeRequest.profiles
                    const badge = badgeRequest.badges
                    const evidence = badgeRequest.evidence || "ì¦ë¹™ ìë£Œ ì—†ìŒ"
                    const proofUrl = badgeRequest.proof_url
                    const hasEvidence = !!badgeRequest.evidence || !!proofUrl

                    return (
                      <TableRow key={badgeRequest.id}>
                        <TableCell>
                          <div className="flex items-center gap-3">
                            <Avatar className="h-10 w-10">
                              <AvatarImage src={user?.avatar_url || undefined} />
                              <AvatarFallback className="bg-blue-600 text-white">
                                {user?.full_name?.[0] || user?.email?.[0] || "U"}
                              </AvatarFallback>
                            </Avatar>
                            <div>
                              <div className="font-medium text-slate-900">
                                {user?.full_name || "ì´ë¦„ ì—†ìŒ"}
                              </div>
                              <div className="text-sm text-slate-500">{user?.email}</div>
                            </div>
                          </div>
                        </TableCell>
                        <TableCell>
                          {badge ? (
                            <div className="flex items-center gap-2">
                              <span className="text-lg">{badge.icon}</span>
                              <span className="font-medium text-slate-900">{badge.name}</span>
                            </div>
                          ) : (
                            <span className="text-slate-400">ë±ƒì§€ ì •ë³´ ì—†ìŒ</span>
                          )}
                        </TableCell>
                        <TableCell>
                          <div className="max-w-md">
                            {hasEvidence ? (
                              <Button
                                variant="outline"
                                size="sm"
                                onClick={() => {
                                  setViewingEvidence({
                                    text: badgeRequest.evidence || "",
                                    url: proofUrl
                                  })
                                  setShowEvidenceDialog(true)
                                }}
                                className="h-8 text-xs gap-1.5"
                              >
                                <Eye className="h-3 w-3" />
                                ì¦ë¹™ ìë£Œ í™•ì¸
                                {proofUrl && <span className="text-[10px] bg-blue-50 text-blue-600 px-1 rounded">íŒŒì¼</span>}
                              </Button>
                            ) : (
                              <span className="text-sm text-slate-400">ì—†ìŒ</span>
                            )}
                          </div>
                        </TableCell>
                        <TableCell>
                          <div className="text-sm text-slate-600">
                            {new Date(badgeRequest.created_at).toLocaleDateString('ko-KR', {
                              year: 'numeric',
                              month: 'long',
                              day: 'numeric',
                            })}
                          </div>
                        </TableCell>
                        <TableCell className="text-right">
                          <div className="flex items-center justify-end gap-2">
                            <Button
                              onClick={async () => {
                                await handleApprove(badgeRequest.id)
                              }}
                              disabled={isProcessing}
                              size="sm"
                              className="bg-green-600 hover:bg-green-700 text-white"
                            >
                              {isProcessing && processingAction === 'approve' ? (
                                <>
                                  <Loader2 className="h-3 w-3 mr-1 animate-spin" />
                                  ì²˜ë¦¬ ì¤‘...
                                </>
                              ) : (
                                <>
                                  <CheckCircle2 className="h-3 w-3 mr-1" />
                                  ìŠ¹ì¸
                                </>
                              )}
                            </Button>
                            <Button
                              onClick={() => handleRejectClick(badgeRequest.id)}
                              disabled={isProcessing}
                              size="sm"
                              variant="destructive"
                            >
                              <XCircle className="h-3 w-3 mr-1" />
                              ë°˜ë ¤
                            </Button>
                          </div>
                        </TableCell>
                      </TableRow>
                    )
                  })}
                </TableBody>
              </Table>
            </div>
          </div>
        ) : (
          <div className="border border-slate-200 rounded-lg p-12 text-center">
            <p className="text-slate-500">ëŒ€ê¸° ì¤‘ì¸ ë±ƒì§€ ì‹ ì²­ì´ ì—†ìŠµë‹ˆë‹¤.</p>
          </div>
        )}
      </div>

      {/* í•˜ë‹¨: ë±ƒì§€ ì¢…ë¥˜ ê´€ë¦¬ */}
      <div className="border-t border-slate-200 pt-8">
        <div className="flex items-center justify-between mb-6">
          <h2 className="text-xl font-bold text-slate-900">ë±ƒì§€ ì¢…ë¥˜ ê´€ë¦¬</h2>
          <div className="flex gap-2">
            <Button
              onClick={() => {
                setCategoryFormData({ label: "", value: "" })
                setShowCategoryCreateDialog(true)
              }}
              variant="outline"
              className="gap-2"
            >
              <Plus className="h-4 w-4" />
              ì¹´í…Œê³ ë¦¬ ì¶”ê°€
            </Button>
            <Button
              onClick={() => {
                setFormData({ name: "", icon: "", category: "", description: "" })
                setShowCreateDialog(true)
              }}
              className="gap-2"
            >
              <Plus className="h-4 w-4" />
              ë±ƒì§€ ìƒì„±
            </Button>
          </div>
        </div>
        <div>
          <h3 className="text-lg font-semibold text-slate-900 mb-4">ì „ì²´ ë±ƒì§€ ëª©ë¡ ({localBadges.length}ê°œ)</h3>

          {localBadges.length > 0 ? (
            <DndContext
              sensors={sensors}
              collisionDetection={closestCenter}
              onDragEnd={handleDragEnd}
            >
              <SortableContext
                items={sortedCategories.map((cat) => cat.category_value)}
                strategy={verticalListSortingStrategy}
              >
                <div className="space-y-0">
                  {sortedCategories.map((category, index) => {
                    const categoryBadges = badgesByCategory[category.category_value] || []
                    // ì¹´í…Œê³ ë¦¬ê°€ ë¹„ì–´ìˆì–´ë„ ë³´ì—¬ì£¼ëŠ”ê²Œ ê´€ë¦¬ìƒ ì¢‹ì„ ìˆ˜ ìˆìŒ (ì¹´í…Œê³ ë¦¬ ì‚­ì œë¥¼ ìœ„í•´)
                    // í•˜ì§€ë§Œ ê¸°ì¡´ ë¡œì§ì€ ë±ƒì§€ ì—†ìœ¼ë©´ ì•ˆë³´ì˜€ìŒ.
                    // ì‚¬ìš©ìê°€ ì¹´í…Œê³ ë¦¬ ê´€ë¦¬ë¥¼ ì›í•˜ë¯€ë¡œ ë¹ˆ ì¹´í…Œê³ ë¦¬ë„ ë³´ì—¬ì£¼ëŠ”ê²Œ ë§ìŒ.
                    // ë‹¨, DBì—ì„œ ê°€ì ¸ì˜¨ ì¹´í…Œê³ ë¦¬ë§Œ.

                    return (
                      <CategorySection
                        key={`${category.category_value}-${index}`}
                        categoryValue={category.category_value}
                        categoryLabel={category.category_label}
                        badges={categoryBadges}
                        badgeCategories={localBadgeCategories}
                        isProcessing={isProcessing}
                        processingAction={processingAction}
                        onToggleActive={handleToggleActive}
                        onEdit={handleEdit}
                        onDelete={handleDeleteClick}
                        onEditCategory={(cat) => {
                          setEditingCategory(cat)
                          setCategoryFormData({ label: cat.category_label, value: cat.category_value })
                          setShowCategoryEditDialog(true)
                        }}
                        onDeleteCategory={(val) => {
                          setDeletingCategoryValue(val)
                          setShowCategoryDeleteDialog(true)
                        }}
                      />
                    )
                  })}
                </div>
              </SortableContext>
            </DndContext>
          ) : (
            <div className="border border-slate-200 rounded-lg p-12 text-center">
              <p className="text-slate-500">ë“±ë¡ëœ ë±ƒì§€ê°€ ì—†ìŠµë‹ˆë‹¤</p>
            </div>
          )}
        </div>
      </div>

      {/* ë±ƒì§€ ìƒì„± Dialog */}
      <Dialog open={showCreateDialog} onOpenChange={setShowCreateDialog}>
        <DialogContent className="sm:max-w-lg bg-white rounded-xl">
          <DialogHeader>
            <DialogTitle className="text-lg font-bold">ë±ƒì§€ ìƒì„±</DialogTitle>
            <DialogDescription className="text-sm text-slate-500">
              ìƒˆë¡œìš´ ë±ƒì§€ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
            </DialogDescription>
          </DialogHeader>
          <div className="mt-6 space-y-4">
            <div>
              <Label htmlFor="badge_name" className="mb-2 block text-slate-700">
                ì´ë¦„ <span className="text-red-500">*</span>
              </Label>
              <Input
                id="badge_name"
                value={formData.name}
                onChange={(e) => setFormData({ ...formData, name: e.target.value })}
                placeholder="ì˜ˆ: ìì‚° 10ì–µ+"
                className="bg-white border-slate-200"
              />
            </div>
            <div>
              <Label htmlFor="badge_icon" className="mb-2 block text-slate-700">
                ì•„ì´ì½˜ <span className="text-red-500">*</span>
              </Label>
              <Input
                id="badge_icon"
                value={formData.icon}
                onChange={(e) => setFormData({ ...formData, icon: e.target.value })}
                placeholder="ì˜ˆ: ğŸ’"
                className="bg-white border-slate-200"
              />
            </div>
            <div>
              <Label htmlFor="badge_category" className="mb-2 block text-slate-700">
                ì¹´í…Œê³ ë¦¬ <span className="text-red-500">*</span>
              </Label>
              <Select value={formData.category} onValueChange={(value) => setFormData({ ...formData, category: value })}>
                <SelectTrigger className="bg-white border-slate-200">
                  <SelectValue placeholder="ì¹´í…Œê³ ë¦¬ ì„ íƒ" />
                </SelectTrigger>
                <SelectContent className="z-[9999]">
                  {localBadgeCategories.map((cat) => (
                    <SelectItem key={cat.category_value} value={cat.category_value}>
                      {cat.category_label}
                    </SelectItem>
                  ))}
                </SelectContent>
              </Select>
            </div>
            <div>
              <Label htmlFor="badge_description" className="mb-2 block text-slate-700">
                ì„¤ëª…
              </Label>
              <Textarea
                id="badge_description"
                value={formData.description}
                onChange={(e) => setFormData({ ...formData, description: e.target.value })}
                placeholder="ë±ƒì§€ì— ëŒ€í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"
                rows={3}
                className="bg-white border-slate-200 resize-none"
              />
            </div>
            <div className="flex justify-end gap-2 pt-2">
              <Button
                variant="outline"
                onClick={() => setShowCreateDialog(false)}
                className="h-11 px-6"
              >
                ì·¨ì†Œ
              </Button>
              <Button
                onClick={handleCreate}
                disabled={isProcessing || !formData.name || !formData.icon || !formData.category}
                className={cn(
                  "h-11 px-8 font-bold transition-all",
                  "bg-slate-900 hover:bg-slate-800 text-white shadow-md hover:shadow-lg",
                  isProcessing && "opacity-70 cursor-not-allowed"
                )}
              >
                {isProcessing && processingAction === 'create' ? (
                  <>
                    <Loader2 className="h-4 w-4 mr-2 animate-spin" />
                    ìƒì„± ì¤‘...
                  </>
                ) : (
                  "ìƒì„±í•˜ê¸°"
                )}
              </Button>
            </div>
          </div>
        </DialogContent>
      </Dialog>

      {/* ë±ƒì§€ ìˆ˜ì • Dialog */}
      <Dialog open={showEditDialog} onOpenChange={setShowEditDialog}>
        <DialogContent className="sm:max-w-lg bg-white rounded-xl">
          <DialogHeader>
            <DialogTitle className="text-lg font-bold">ë±ƒì§€ ìˆ˜ì •</DialogTitle>
            <DialogDescription className="text-sm text-slate-500">
              ë±ƒì§€ ì •ë³´ë¥¼ ìˆ˜ì •í•©ë‹ˆë‹¤
            </DialogDescription>
          </DialogHeader>
          <div className="mt-6 space-y-4">
            <div>
              <Label htmlFor="edit_badge_name" className="mb-2 block text-slate-700">
                ì´ë¦„ <span className="text-red-500">*</span>
              </Label>
              <Input
                id="edit_badge_name"
                value={formData.name}
                onChange={(e) => setFormData({ ...formData, name: e.target.value })}
                placeholder="ì˜ˆ: ìì‚° 10ì–µ+"
                className="bg-white border-slate-200"
              />
            </div>
            <div>
              <Label htmlFor="edit_badge_icon" className="mb-2 block text-slate-700">
                ì•„ì´ì½˜ <span className="text-red-500">*</span>
              </Label>
              <Input
                id="edit_badge_icon"
                value={formData.icon}
                onChange={(e) => setFormData({ ...formData, icon: e.target.value })}
                placeholder="ì˜ˆ: ğŸ’"
                className="bg-white border-slate-200"
              />
            </div>
            <div>
              <Label htmlFor="edit_badge_category" className="mb-2 block text-slate-700">
                ì¹´í…Œê³ ë¦¬ <span className="text-red-500">*</span>
              </Label>
              <Select value={formData.category} onValueChange={(value) => setFormData({ ...formData, category: value })}>
                <SelectTrigger className="bg-white border-slate-200">
                  <SelectValue placeholder="ì¹´í…Œê³ ë¦¬ ì„ íƒ" />
                </SelectTrigger>
                <SelectContent className="z-[9999]">
                  {localBadgeCategories.map((cat) => (
                    <SelectItem key={cat.category_value} value={cat.category_value}>
                      {cat.category_label}
                    </SelectItem>
                  ))}
                </SelectContent>
              </Select>
            </div>
            <div>
              <Label htmlFor="edit_badge_description" className="mb-2 block text-slate-700">
                ì„¤ëª…
              </Label>
              <Textarea
                id="edit_badge_description"
                value={formData.description}
                onChange={(e) => setFormData({ ...formData, description: e.target.value })}
                placeholder="ë±ƒì§€ì— ëŒ€í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"
                rows={3}
                className="bg-white border-slate-200 resize-none"
              />
            </div>
            <div className="flex justify-end gap-2 pt-2">
              <Button
                variant="outline"
                onClick={() => {
                  setShowEditDialog(false)
                  setEditingBadge(null)
                }}
                className="h-11 px-6"
              >
                ì·¨ì†Œ
              </Button>
              <Button
                onClick={handleUpdate}
                disabled={isProcessing || !formData.name || !formData.icon || !formData.category}
                className={cn(
                  "h-11 px-8 font-bold transition-all",
                  "bg-slate-900 hover:bg-slate-800 text-white shadow-md hover:shadow-lg",
                  isProcessing && "opacity-70 cursor-not-allowed"
                )}
              >
                {isProcessing && processingAction === 'update' ? (
                  <>
                    <Loader2 className="h-4 w-4 mr-2 animate-spin" />
                    ìˆ˜ì • ì¤‘...
                  </>
                ) : (
                  "ìˆ˜ì •í•˜ê¸°"
                )}
              </Button>
            </div>
          </div>
        </DialogContent>
      </Dialog>

      {/* ì¹´í…Œê³ ë¦¬ ìƒì„± Dialog */}
      <Dialog open={showCategoryCreateDialog} onOpenChange={setShowCategoryCreateDialog}>
        <DialogContent className="sm:max-w-md bg-white rounded-xl">
          <DialogHeader>
            <DialogTitle className="text-lg font-bold">ì¹´í…Œê³ ë¦¬ ì¶”ê°€</DialogTitle>
            <DialogDescription className="text-sm text-slate-500">
              ìƒˆë¡œìš´ ë±ƒì§€ ì¹´í…Œê³ ë¦¬ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
            </DialogDescription>
          </DialogHeader>
          <div className="mt-4 space-y-4">
            <div>
              <Label htmlFor="category_label" className="mb-2 block text-slate-700">
                ì¹´í…Œê³ ë¦¬ ì´ë¦„ <span className="text-red-500">*</span>
              </Label>
              <Input
                id="category_label"
                value={categoryFormData.label}
                onChange={(e) => setCategoryFormData({ ...categoryFormData, label: e.target.value })}
                placeholder="ì˜ˆ: ì»¤ë®¤ë‹ˆí‹° í™œë™"
                className="bg-white border-slate-200"
              />
            </div>
            <div>
              <Label htmlFor="category_value" className="mb-2 block text-slate-700">
                ì¹´í…Œê³ ë¦¬ ì½”ë“œ (ID) <span className="text-red-500">*</span>
              </Label>
              <Input
                id="category_value"
                value={categoryFormData.value}
                onChange={(e) => setCategoryFormData({ ...categoryFormData, value: e.target.value })}
                placeholder="ì˜ˆ: community_activity (ì˜ë¬¸ ì†Œë¬¸ì)"
                className="bg-white border-slate-200"
              />
              <p className="text-xs text-slate-500 mt-1">ì˜ë¬¸ ì†Œë¬¸ìì™€ ì–¸ë”ë°”(_)ë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
            </div>
            <div className="flex justify-end gap-2 pt-2">
              <Button
                variant="outline"
                onClick={() => setShowCategoryCreateDialog(false)}
              >
                ì·¨ì†Œ
              </Button>
              <Button
                onClick={handleCreateCategory}
                disabled={isProcessing || !categoryFormData.label || !categoryFormData.value}
                className="bg-slate-900 text-white"
              >
                {isProcessing ? <Loader2 className="h-4 w-4 animate-spin" /> : "ìƒì„±"}
              </Button>
            </div>
          </div>
        </DialogContent>
      </Dialog>

      {/* ì¹´í…Œê³ ë¦¬ ìˆ˜ì • Dialog */}
      <Dialog open={showCategoryEditDialog} onOpenChange={setShowCategoryEditDialog}>
        <DialogContent className="sm:max-w-md bg-white rounded-xl">
          <DialogHeader>
            <DialogTitle className="text-lg font-bold">ì¹´í…Œê³ ë¦¬ ìˆ˜ì •</DialogTitle>
            <DialogDescription className="text-sm text-slate-500">
              ì¹´í…Œê³ ë¦¬ ì´ë¦„ì„ ìˆ˜ì •í•©ë‹ˆë‹¤ (ì½”ë“œëŠ” ìˆ˜ì • ë¶ˆê°€)
            </DialogDescription>
          </DialogHeader>
          <div className="mt-4 space-y-4">
            <div>
              <Label htmlFor="edit_category_label" className="mb-2 block text-slate-700">
                ì¹´í…Œê³ ë¦¬ ì´ë¦„ <span className="text-red-500">*</span>
              </Label>
              <Input
                id="edit_category_label"
                value={categoryFormData.label}
                onChange={(e) => setCategoryFormData({ ...categoryFormData, label: e.target.value })}
                placeholder="ì˜ˆ: ì»¤ë®¤ë‹ˆí‹° í™œë™"
                className="bg-white border-slate-200"
              />
            </div>
            <div>
              <Label className="mb-2 block text-slate-700">
                ì¹´í…Œê³ ë¦¬ ì½”ë“œ (ID)
              </Label>
              <Input
                value={editingCategory?.category_value || ""}
                disabled
                className="bg-slate-100 border-slate-200 text-slate-500"
              />
            </div>
            <div className="flex justify-end gap-2 pt-2">
              <Button
                variant="outline"
                onClick={() => setShowCategoryEditDialog(false)}
              >
                ì·¨ì†Œ
              </Button>
              <Button
                onClick={handleUpdateCategory}
                disabled={isProcessing || !categoryFormData.label}
                className="bg-slate-900 text-white"
              >
                {isProcessing ? <Loader2 className="h-4 w-4 animate-spin" /> : "ìˆ˜ì •"}
              </Button>
            </div>
          </div>
        </DialogContent>
      </Dialog>

      {/* ì¹´í…Œê³ ë¦¬ ì‚­ì œ í™•ì¸ Dialog */}
      <AlertDialog open={showCategoryDeleteDialog} onOpenChange={setShowCategoryDeleteDialog}>
        <AlertDialogContent className="bg-white z-[100]">
          <AlertDialogHeader>
            <AlertDialogTitle>ì¹´í…Œê³ ë¦¬ ì‚­ì œ í™•ì¸</AlertDialogTitle>
            <AlertDialogDescription>
              ì •ë§ ì´ ì¹´í…Œê³ ë¦¬ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì¹´í…Œê³ ë¦¬ì— ì†í•œ ë±ƒì§€ê°€ ì—†ì–´ì•¼ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            </AlertDialogDescription>
          </AlertDialogHeader>
          <AlertDialogFooter>
            <AlertDialogCancel
              onClick={() => {
                setShowCategoryDeleteDialog(false)
                setDeletingCategoryValue(null)
              }}
              disabled={isProcessing}
            >
              ì·¨ì†Œ
            </AlertDialogCancel>
            <AlertDialogAction
              onClick={handleDeleteCategory}
              disabled={isProcessing}
              className="bg-red-600 hover:bg-red-700 text-white"
            >
              {isProcessing ? (
                <>
                  <Loader2 className="h-4 w-4 mr-2 animate-spin" />
                  ì‚­ì œ ì¤‘...
                </>
              ) : (
                "ì‚­ì œ"
              )}
            </AlertDialogAction>
          </AlertDialogFooter>
        </AlertDialogContent>
      </AlertDialog>

      {/* ì¦ë¹™ ìë£Œ ë³´ê¸° Dialog */}
      <Dialog open={showEvidenceDialog} onOpenChange={setShowEvidenceDialog}>
        <DialogContent className="sm:max-w-lg bg-white rounded-xl">
          <DialogHeader>
            <DialogTitle className="text-lg font-bold">ì¦ë¹™ ìë£Œ í™•ì¸</DialogTitle>
            <DialogDescription className="text-sm text-slate-500">
              ì‚¬ìš©ìê°€ ì œì¶œí•œ ì¦ë¹™ ìë£Œì…ë‹ˆë‹¤
            </DialogDescription>
          </DialogHeader>
          <div className="mt-4 space-y-4">
            {viewingEvidence.text && (
              <div>
                <h4 className="text-sm font-semibold text-slate-900 mb-2">ì„¤ëª…</h4>
                <div className="p-4 bg-slate-50 rounded-lg border border-slate-200">
                  <p className="text-sm text-slate-700 whitespace-pre-wrap break-words">
                    {viewingEvidence.text}
                  </p>
                </div>
              </div>
            )}

            {viewingEvidence.url && (
              <div>
                <h4 className="text-sm font-semibold text-slate-900 mb-2">ì²¨ë¶€ íŒŒì¼</h4>
                {viewingEvidence.url.match(/\.(jpg|jpeg|png|gif|webp)$/i) ? (
                  <a
                    href={viewingEvidence.url}
                    target="_blank"
                    rel="noopener noreferrer"
                    className="block relative w-full h-64 rounded-lg overflow-hidden border border-slate-200 cursor-pointer hover:opacity-90 transition-opacity group"
                  >
                    <Image
                      src={viewingEvidence.url}
                      alt="ì¦ë¹™ ì´ë¯¸ì§€"
                      fill
                      sizes="(max-width: 768px) 100vw, 50vw"
                      className="object-contain"
                    />
                    <div className="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors flex items-center justify-center">
                      <span className="opacity-0 group-hover:opacity-100 bg-black/70 text-white text-xs px-3 py-1.5 rounded-full transition-opacity">
                        í´ë¦­í•˜ì—¬ ì›ë³¸ ë³´ê¸°
                      </span>
                    </div>
                  </a>
                ) : (
                  <Button asChild variant="outline" className="w-full justify-start">
                    <a href={viewingEvidence.url} target="_blank" rel="noopener noreferrer">
                      <FileText className="h-4 w-4 mr-2" />
                      íŒŒì¼ ë‹¤ìš´ë¡œë“œ / ë³´ê¸°
                    </a>
                  </Button>
                )}
              </div>
            )}

            {!viewingEvidence.text && !viewingEvidence.url && (
              <div className="p-8 text-center text-slate-500 bg-slate-50 rounded-lg border border-dashed border-slate-300">
                ì œì¶œëœ ì¦ë¹™ ìë£Œê°€ ì—†ìŠµë‹ˆë‹¤.
              </div>
            )}
          </div>
          <div className="flex justify-end pt-4">
            <Button onClick={() => setShowEvidenceDialog(false)}>
              ë‹«ê¸°
            </Button>
          </div>
        </DialogContent>
      </Dialog>

      {/* ë±ƒì§€ ì‚­ì œ í™•ì¸ Dialog */}
      <AlertDialog open={showDeleteDialog} onOpenChange={setShowDeleteDialog}>
        <AlertDialogContent className="bg-white z-[100]">
          <AlertDialogHeader>
            <AlertDialogTitle>ë±ƒì§€ ì‚­ì œ í™•ì¸</AlertDialogTitle>
            <AlertDialogDescription>
              ì´ ë±ƒì§€ë¥¼ ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ë±ƒì§€ë¥¼ ì‚¬ìš© ì¤‘ì¸ ì‚¬ìš©ìë“¤ì—ê²Œë„ ì˜í–¥ì„ ë¯¸ì¹©ë‹ˆë‹¤. ì´ ì‘ì—…ì€ ì·¨ì†Œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
            </AlertDialogDescription>
          </AlertDialogHeader>
          <AlertDialogFooter>
            <AlertDialogCancel
              onClick={() => {
                setShowDeleteDialog(false)
                setDeletingBadgeId(null)
              }}
              disabled={isProcessing}
            >
              ì·¨ì†Œ
            </AlertDialogCancel>
            <AlertDialogAction
              onClick={handleDeleteConfirm}
              disabled={isProcessing}
              className="bg-red-600 hover:bg-red-700 text-white"
            >
              {isProcessing ? (
                <>
                  <Loader2 className="h-4 w-4 mr-2 animate-spin" />
                  ì‚­ì œ ì¤‘...
                </>
              ) : (
                "ì‚­ì œ"
              )}
            </AlertDialogAction>
          </AlertDialogFooter>
        </AlertDialogContent>
      </AlertDialog>

      {/* ë±ƒì§€ ë°˜ë ¤ ë‹¤ì´ì–¼ë¡œê·¸ */}
      <Dialog open={showRejectDialog} onOpenChange={setShowRejectDialog}>
        <DialogContent className="sm:max-w-md bg-white rounded-xl">
          <DialogHeader>
            <DialogTitle className="text-lg font-bold text-red-600">ë±ƒì§€ ì‹ ì²­ ë°˜ë ¤</DialogTitle>
            <DialogDescription className="text-sm text-slate-500">
              ë°˜ë ¤ ì‚¬ìœ ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”. ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼ìœ¼ë¡œ ì „ë‹¬ë©ë‹ˆë‹¤.
            </DialogDescription>
          </DialogHeader>
          <div className="mt-4 space-y-4">
            <div>
              <Label htmlFor="rejection_message" className="mb-2 block text-slate-700">
                ë°˜ë ¤ ì‚¬ìœ  <span className="text-slate-400 text-xs">(ì„ íƒ)</span>
              </Label>
              <Textarea
                id="rejection_message"
                value={rejectionMessage}
                onChange={(e) => setRejectionMessage(e.target.value)}
                placeholder="ì˜ˆ: ì¦ë¹™ ìë£Œê°€ ë¶ˆëª…í™•í•©ë‹ˆë‹¤. ìì‚° ì¦ëª…ì„ ìœ„í•œ ê¸ˆìœµê¸°ê´€ ë°œê¸‰ ì„œë¥˜ë¥¼ ì²¨ë¶€í•´ì£¼ì„¸ìš”."
                rows={4}
                className="bg-white border-slate-200 resize-none"
              />
              <p className="text-xs text-slate-500 mt-1">
                ë°˜ë ¤ ì‚¬ìœ ë¥¼ ì…ë ¥í•˜ì§€ ì•Šìœ¼ë©´ ê¸°ë³¸ ë©”ì‹œì§€ë¡œ ì•Œë¦¼ì´ ì „ì†¡ë©ë‹ˆë‹¤.
              </p>
            </div>
            <div className="flex justify-end gap-2 pt-2">
              <Button
                variant="outline"
                onClick={() => {
                  setShowRejectDialog(false)
                  setRejectingBadgeId(null)
                  setRejectionMessage("")
                }}
                disabled={isProcessing}
              >
                ì·¨ì†Œ
              </Button>
              <Button
                onClick={handleRejectConfirm}
                disabled={isProcessing}
                className="bg-red-600 hover:bg-red-700 text-white"
              >
                {isProcessing && processingAction === 'reject' ? (
                  <>
                    <Loader2 className="h-4 w-4 mr-2 animate-spin" />
                    ì²˜ë¦¬ ì¤‘...
                  </>
                ) : (
                  "ë°˜ë ¤í•˜ê¸°"
                )}
              </Button>
            </div>
          </div>
        </DialogContent>
      </Dialog>
    </div>
  )
}
</file>

<file path="components/community-banner.tsx">
"use client"

import { ReactNode } from "react"
import { PageHeader } from "@/components/page-header"

interface CommunityBannerProps {
  title: string
  description?: string
  actions?: ReactNode
}

export function CommunityBanner({
  title,
  description,
  actions
}: CommunityBannerProps) {
  return (
    <PageHeader
      title={title}
      description={description}
      className="w-full mb-0"
      compact={true}
    >
      {actions}
    </PageHeader>
  )
}
</file>

<file path="components/complete-event-button.tsx">
"use client";

import { useState } from "react";
import { useRouter } from 'next/navigation';
import { Button } from "@/components/ui/button";
import { createClient } from "@/lib/supabase/client";
import { CheckCircle, Loader2 } from 'lucide-react';

export function CompleteEventButton({
  eventId,
  userId,
}: {
  eventId: string;
  userId: string;
}) {
  const [isLoading, setIsLoading] = useState(false);
  const router = useRouter();

  const handleComplete = async () => {
    const supabase = createClient();
    setIsLoading(true);

    try {
      const { error: updateError } = await supabase
        .from("events")
        .update({ status: 'completed' })
        .eq("id", eventId);

      if (updateError) throw updateError;

      router.refresh();
    } catch (error) {
      console.error("Failed to complete event:", error);
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <Button
      onClick={handleComplete}
      disabled={isLoading}
      variant="outline"
      size="sm"
    >
      {isLoading ? (
        <Loader2 className="mr-2 h-4 w-4 animate-spin" />
      ) : (
        <CheckCircle className="mr-2 h-4 w-4" />
      )}
      ì´ë²¤íŠ¸ ì¢…ë£Œí•˜ê¸°
    </Button>
  );
}
</file>

<file path="components/delete-event-button.tsx">
"use client"

import { useState } from "react"
import { useRouter } from "next/navigation"
import { Button } from "@/components/ui/button"
import { Trash2 } from "lucide-react"
import {
  AlertDialog,
  AlertDialogAction,
  AlertDialogCancel,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogTitle,
} from "@/components/ui/alert-dialog"
import { deleteEvent } from "@/lib/actions/events"

type DeleteEventButtonProps = {
  eventId: string
  className?: string
  variant?: "default" | "destructive" | "outline" | "secondary" | "ghost" | "link"
  size?: "default" | "sm" | "lg" | "icon"
  label?: string
}

export function DeleteEventButton({ eventId, className, variant = "outline", size = "sm", label = "ì´ë²¤íŠ¸ ì‚­ì œ" }: DeleteEventButtonProps) {
  const [showDeleteDialog, setShowDeleteDialog] = useState(false)
  const [isDeleting, setIsDeleting] = useState(false)
  const router = useRouter()

  const handleDelete = async () => {
    setIsDeleting(true)
    try {
      await deleteEvent(eventId)
      // ì‚­ì œ ì„±ê³µ í›„ ëª©ë¡ í˜ì´ì§€ë¡œ ì´ë™ (replaceë¡œ íˆìŠ¤í† ë¦¬ì—ì„œ í˜„ì¬ í˜ì´ì§€ ì œê±°)
      // replaceë¥¼ ì‚¬ìš©í•˜ë©´ ë’¤ë¡œê°€ê¸° ì‹œ ì‚­ì œëœ ì´ë²¤íŠ¸ í˜ì´ì§€ë¡œ ëŒì•„ê°€ì§€ ì•ŠìŒ
      router.replace("/e")
    } catch (error) {
      console.error("Failed to delete event:", error)
      alert("ì´ë²¤íŠ¸ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")
      setIsDeleting(false)
      setShowDeleteDialog(false)
    }
  }

  return (
    <>
      <Button
        variant={variant}
        size={size}
        className={className || "bg-white border-red-300 text-red-600 hover:bg-red-50"}
        onClick={() => setShowDeleteDialog(true)}
      >
        <Trash2 className="mr-2 h-3.5 w-3.5" />
        {label}
      </Button>

      <AlertDialog open={showDeleteDialog} onOpenChange={setShowDeleteDialog}>
        <AlertDialogContent className="bg-white max-w-md">
          <AlertDialogHeader>
            <AlertDialogTitle>ì´ë²¤íŠ¸ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</AlertDialogTitle>
            <AlertDialogDescription>
              ì´ ì‘ì—…ì€ ì·¨ì†Œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì´ë²¤íŠ¸ì™€ ëª¨ë“  ì°¸ê°€ ì‹ ì²­ ì •ë³´ê°€ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤.
            </AlertDialogDescription>
          </AlertDialogHeader>
          <AlertDialogFooter 
            style={{ display: 'flex', flexDirection: 'row', gap: '0.5rem', justifyContent: 'flex-end' }}
            className="!flex !flex-row gap-2 sm:justify-end"
          >
            <AlertDialogCancel variant="outline">ì·¨ì†Œ</AlertDialogCancel>
            <AlertDialogAction 
              onClick={handleDelete} 
              disabled={isDeleting} 
              variant="destructive" 
              className="bg-red-600 hover:bg-red-700 text-white"
            >
              {isDeleting ? "ì‚­ì œ ì¤‘..." : "ì‚­ì œ"}
            </AlertDialogAction>
          </AlertDialogFooter>
        </AlertDialogContent>
      </AlertDialog>
    </>
  )
}
</file>

<file path="components/event-post-card.tsx">
"use client"

import Link from "next/link"
import { Calendar, MapPin, Users, Share2 } from "lucide-react"
import { Card, CardContent } from "@/components/ui/card"
import { Badge } from "@/components/ui/badge"
import { Button } from "@/components/ui/button"
import { cn } from "@/lib/utils"

export type EventCardData = {
  id: string
  title: string
  event_date: string
  location?: string | null
  thumbnail_url?: string | null
  current_participants?: number | null
  max_participants?: number | null
  event_type?: string | null
}

type EventPostCardProps = {
  event: EventCardData
  href?: string
  className?: string
}

export function EventPostCard({ event, href = `/events/${event.id}`, className }: EventPostCardProps) {
  const dateLabel = new Date(event.event_date).toLocaleString("ko-KR", {
    month: "short",
    day: "numeric",
    hour: "2-digit",
    minute: "2-digit",
  })

  const capacity = event.max_participants ? `${event.current_participants || 0} / ${event.max_participants}` : `${event.current_participants || 0}ëª…`

  return (
    <Card className={cn("border-0 bg-white shadow-md shadow-slate-900/5 ring-1 ring-slate-900/[0.04] hover:shadow-xl hover:shadow-slate-900/10 hover:ring-slate-900/[0.08] transition-all duration-300", className)}>
      <div className="w-full aspect-[16/10] bg-gradient-to-br from-slate-50 to-slate-100 overflow-hidden rounded-t-xl">
        {event.thumbnail_url ? (
          <img
            src={event.thumbnail_url}
            alt={event.title}
            className="w-full h-full object-cover"
            loading="lazy"
          />
        ) : (
          <div className="w-full h-full flex items-center justify-center text-slate-400 text-sm">ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤</div>
        )}
      </div>
      <CardContent className="p-5 space-y-4">
        <div className="flex items-center gap-2">
          <Badge variant="outline" className="border-slate-200 text-slate-700 bg-slate-50 text-[11px]">
            {event.event_type || "ì´ë²¤íŠ¸"}
          </Badge>
          <span className="text-xs text-slate-500">{dateLabel}</span>
        </div>
        <Link href={href} className="block group">
          <h3 className="text-base sm:text-lg font-bold text-slate-900 group-hover:text-slate-700 transition-colors line-clamp-2">
            {event.title}
          </h3>
        </Link>
        <div className="flex flex-wrap gap-3 text-sm text-slate-600">
          {event.location && (
            <span className="inline-flex items-center gap-1">
              <MapPin className="h-4 w-4 text-slate-400" />
              {event.location}
            </span>
          )}
          <span className="inline-flex items-center gap-1">
            <Users className="h-4 w-4 text-slate-400" />
            {capacity}
          </span>
        </div>
        <div className="flex items-center gap-2">
          <Button variant="default" size="sm" asChild>
            <Link href={href}>ì°¸ì—¬í•˜ê¸°</Link>
          </Button>
          <Button
            variant="ghost"
            size="sm"
            className="gap-1.5 px-2 text-slate-500 hover:text-slate-700"
            onClick={(e) => {
              e.preventDefault()
              e.stopPropagation()
              if (typeof navigator !== "undefined") {
                navigator.clipboard.writeText(`${window.location.origin}${href}`).catch(() => {})
              }
            }}
          >
            <Share2 className="h-4 w-4" />
            <span className="text-xs">ê³µìœ </span>
          </Button>
        </div>
      </CardContent>
    </Card>
  )
}
</file>

<file path="components/floating-action-bar.tsx">
"use client";

import { useEffect, useState } from "react";
import { Button } from "@/components/ui/button";
import { RegisterButton } from "@/components/register-button";
import { EventShareButton } from "@/components/event-share-button";
import Link from "next/link";

interface FloatingActionBarProps {
  eventId: string;
  userId?: string;
  isRegistered: boolean;
  paymentStatus?: string;
  isFull: boolean;
  price: number;
  isPastEvent: boolean;
  isCreator: boolean;
  eventTitle: string;
  dateStr: string;
  timeStr: string;
  location: string;
  registrationStatus?: "confirmed" | "waitlist";
  waitlistPosition?: number | null;
}

export function FloatingActionBar({
  eventId,
  userId,
  isRegistered,
  paymentStatus,
  isFull,
  price,
  isPastEvent,
  isCreator,
  eventTitle,
  dateStr,
  timeStr,
  location,
  registrationStatus,
  waitlistPosition,
}: FloatingActionBarProps) {
  const [isVisible, setIsVisible] = useState(false);

  useEffect(() => {
    const registerCard = document.getElementById("register-card");
    if (!registerCard) return;

    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          // ì¹´ë“œê°€ í™”ë©´ì—ì„œ ë²—ì–´ë‚˜ë©´ í”Œë¡œíŒ… ë°” í‘œì‹œ
          setIsVisible(!entry.isIntersecting);
        });
      },
      { threshold: 0.1 }
    );

    observer.observe(registerCard);

    return () => observer.disconnect();
  }, []);

  return (
    <div
      className={`fixed bottom-0 left-0 right-0 z-[90] bg-white/95 backdrop-blur-md border-t border-slate-200 p-3 pb-[calc(0.75rem+env(safe-area-inset-bottom))] lg:hidden shadow-lg transition-transform duration-300 ${
        isVisible ? "translate-y-0" : "translate-y-full"
      }`}
    >
      <div className="flex items-center gap-2 max-w-md mx-auto">
        {/* ê³µìœ  ë²„íŠ¼ (ì•„ì´ì½˜ë§Œ) */}
        <div className="shrink-0">
          <EventShareButton
            title={eventTitle}
            description={`ì¼ì‹œ: ${dateStr} ${timeStr}\nì¥ì†Œ: ${location || "ì¥ì†Œ ë¯¸ì •"}`}
            variant="outline"
            size="icon"
            className="h-10 w-10"
          />
        </div>

        {/* ì‹ ì²­ ë²„íŠ¼ (ê½‰ ì°¨ê²Œ) */}
        <div className="flex-1">
          {isPastEvent ? (
            <Button className="w-full bg-slate-100 text-slate-400 h-10 text-sm" disabled>
              ì¢…ë£Œë¨
            </Button>
          ) : isCreator ? (
            <Link href={`/e/${eventId}/manage`} className="block w-full">
              <Button className="w-full bg-slate-900 text-white hover:bg-slate-800 h-10 text-sm font-semibold">
                ê´€ë¦¬í•˜ê¸°
              </Button>
            </Link>
          ) : (
            <RegisterButton
              eventId={eventId}
              userId={userId}
              isRegistered={isRegistered}
              paymentStatus={paymentStatus}
              isFull={isFull}
              price={price}
              registrationStatus={registrationStatus}
              waitlistPosition={waitlistPosition}
            />
          )}
        </div>
      </div>
    </div>
  );
}
</file>

<file path="components/google-map-embed.tsx">
/**
 * components/google-map-embed.tsx
 * êµ¬ê¸€ ë§µ ì„ë² ë“œ ì»´í¬ë„ŒíŠ¸ (ì£¼ì†Œë¥¼ ë°›ì•„ ì§€ë„ë¥¼ í‘œì‹œ)
 */
"use client";

interface GoogleMapEmbedProps {
  location: string;
  apiKey: string;
}

export function GoogleMapEmbed({ location, apiKey }: GoogleMapEmbedProps) {
  if (!location) return null;

  // ì£¼ì†Œë¥¼ URL ì¸ì½”ë”©
  const encodedLocation = encodeURIComponent(location);

  // Google Maps Embed API URL
  const mapSrc = `https://www.google.com/maps/embed/v1/place?key=${apiKey}&q=${encodedLocation}&language=ko`;

  return (
    <div className="w-full h-full min-h-[300px] rounded-2xl overflow-hidden border border-slate-200 shadow-sm bg-slate-50">
      <iframe
        width="100%"
        height="100%"
        style={{ border: 0, minHeight: "300px" }}
        loading="lazy"
        allowFullScreen
        referrerPolicy="no-referrer-when-downgrade"
        src={mapSrc}
        title="Google Map"
      />
    </div>
  );
}
</file>

<file path="components/home/events-section.tsx">
"use client"

import { useRef, useState, useMemo, useEffect } from "react"
import EventCard, { EventCardEvent } from "@/components/ui/event-card"
import { Plus } from "lucide-react"
import { Swiper, SwiperSlide } from "swiper/react"
import { Navigation } from "swiper/modules"
import type { Swiper as SwiperType } from "swiper"
import { Skeleton } from "@/components/ui/skeleton"
import { cn } from "@/lib/utils"
import Link from "next/link"
import { useRouter } from "next/navigation"

import {
  Empty,
  EmptyContent,
  EmptyDescription,
  EmptyHeader,
  EmptyTitle,
} from "@/components/ui/empty"

import "swiper/css"
import "swiper/css/navigation"

type EventsSectionProps = {
  events: EventCardEvent[]
  onCreateEvent?: () => void
  createLink?: string
  isLoading?: boolean
  title?: string
  hideTitle?: boolean
  showFilters?: boolean
}

export function EventsSection({
  events,
  onCreateEvent,
  createLink,
  isLoading = false,
  title = "ì´ë²¤íŠ¸",
  hideTitle = false,
  showFilters = true,
}: EventsSectionProps) {
  const swiperRef = useRef<SwiperType | null>(null)
  const router = useRouter()
  const [filter, setFilter] = useState<"all" | "networking" | "class" | "activity">("all")
  const [isSwiping, setIsSwiping] = useState(false)
  const hasEvents = events && events.length > 0

  // í•„í„°ë§ëœ ì´ë²¤íŠ¸
  const filteredEvents = useMemo(() => {
    if (!showFilters) return events
    if (filter === "all") return events
    return events.filter(event => event.event_type === filter)
  }, [events, filter, showFilters])

  return (
    <div className="w-full">
      {/* í—¤ë” */}
      {!hideTitle && (
        <div className="flex items-center justify-between w-full mb-6 gap-3">
          <h2 className="text-xl md:text-2xl lg:text-3xl font-bold text-slate-900 flex-1 min-w-0">{title}</h2>
          {createLink ? (
            <Link href={createLink} className="inline-flex items-center gap-1.5 md:gap-2 px-3 md:px-4 py-1.5 md:py-2 rounded-full bg-white border border-gray-200 hover:bg-gray-50 hover:border-gray-300 transition-all text-gray-900 text-xs md:text-sm font-semibold shadow-sm whitespace-nowrap shrink-0">
              <Plus className="w-3.5 h-3.5 md:w-4 md:h-4" />
              ìƒˆ ì´ë²¤íŠ¸
            </Link>
          ) : onCreateEvent ? (
            <button
              onClick={onCreateEvent}
              className="inline-flex items-center gap-1.5 md:gap-2 px-3 md:px-4 py-1.5 md:py-2 rounded-full bg-white border border-gray-200 hover:bg-gray-50 hover:border-gray-300 transition-all text-gray-900 text-xs md:text-sm font-semibold shadow-sm whitespace-nowrap shrink-0"
            >
              <Plus className="w-3.5 h-3.5 md:w-4 md:h-4" />
              ìƒˆ ì´ë²¤íŠ¸
            </button>
          ) : null}
        </div>
      )}

      {/* í•„í„° UI */}
      {hasEvents && showFilters && (
        <div className="flex items-center gap-2 mb-6 overflow-x-auto scrollbar-hide pb-2">
          {[
            { value: "all", label: "ì „ì²´" },
            { value: "networking", label: "ë„¤íŠ¸ì›Œí‚¹" },
            { value: "class", label: "í´ë˜ìŠ¤" },
            { value: "activity", label: "ì•¡í‹°ë¹„í‹°" },
          ].map((option) => (
            <button
              key={option.value}
              onClick={() => setFilter(option.value as typeof filter)}
              className={cn(
                "px-4 py-2 rounded-full text-sm font-semibold transition-all whitespace-nowrap",
                filter === option.value
                  ? "bg-slate-900 text-white shadow-sm"
                  : "bg-white text-slate-500 border border-slate-200 hover:bg-slate-50 hover:text-slate-700"
              )}
            >
              {option.label}
            </button>
          ))}
        </div>
      )}

      {/* 1. ë¡œë”© ì¤‘ì¼ ë•Œ: ìŠ¤ì¼ˆë ˆí†¤ UI í‘œì‹œ */}
      {isLoading ? (
        <>
          {/* ëª¨ë°”ì¼ ìŠ¤ì¼ˆë ˆí†¤ */}
          <div className="md:hidden -mx-4 px-4">
            <div className="flex gap-4 overflow-hidden">
              {[1, 2].map((i) => (
                <div key={i} className="w-[85%] flex-shrink-0 aspect-[4/5] rounded-[20px] overflow-hidden">
                  <Skeleton className="w-full h-full" />
                </div>
              ))}
            </div>
          </div>
          {/* ë°ìŠ¤í¬íƒ‘ ìŠ¤ì¼ˆë ˆí†¤ */}
        <div className="hidden md:grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 2xl:grid-cols-3 gap-5 lg:gap-6">
          {[1, 2, 3].map((i) => (
            <div key={i} className="w-full aspect-[4/5] rounded-[20px] overflow-hidden">
              <Skeleton className="w-full h-full" />
            </div>
          ))}
        </div>
        </>
      ) : !hasEvents ? (
        /* 2. ë¡œë”© ëë‚¬ëŠ”ë° ë°ì´í„° ì—†ì„ ë•Œ: Empty UI í‘œì‹œ */
        <div className="bg-white border border-gray-200 rounded-3xl shadow-sm p-10">
          <Empty>
            <EmptyHeader>
              <EmptyTitle>ì•„ì§ ì˜ˆì •ëœ ì´ë²¤íŠ¸ê°€ ì—†ì–´ìš”</EmptyTitle>
              <EmptyDescription>
                ì²« ë²ˆì§¸ ì´ë²¤íŠ¸ë¥¼ ë§Œë“¤ì–´ ì»¤ë®¤ë‹ˆí‹°ë¥¼ ì‹œì‘í•´ë³´ì„¸ìš”.
              </EmptyDescription>
            </EmptyHeader>
            {onCreateEvent && (
              <EmptyContent>
                <button
                  onClick={onCreateEvent}
                  className="px-5 py-2 rounded-xl bg-slate-900 hover:bg-slate-800 text-white transition font-medium"
                >
                  ì´ë²¤íŠ¸ ë§Œë“¤ê¸°
                </button>
              </EmptyContent>
            )}
          </Empty>
        </div>
      ) : (
        /* 3. ë°ì´í„° ìˆì„ ë•Œ: ì‹¤ì œ ì¹´ë“œ í‘œì‹œ */
        <>
          {/* ëª¨ë°”ì¼ ë ˆì´ì•„ì›ƒ */}
          <div className="md:hidden">
            {/* ì²˜ìŒ 5ê°œ: í° ì¹´ë“œí˜• Swiper */}
            {filteredEvents.length > 0 && (
              <div className="-mx-4 px-4">
                <Swiper
                  modules={[Navigation]}
                  onSwiper={(swiper) => (swiperRef.current = swiper)}
                  spaceBetween={16}
                  slidesPerView={1.2}
                  centeredSlides={false}
                  className="!pb-4"
                  allowTouchMove={true}
                  touchEventsTarget="container"
                >
                  {filteredEvents.slice(0, 5).map((event) => {
                    const eventHref = event.shortUrl || `/e/${event.id.substring(0, 6)}`
                    return (
                      <SwiperSlide key={event.id}>
                        <div 
                          className="block h-full cursor-pointer"
                          onClick={(e) => {
                            // ìŠ¤ì™€ì´í”„ ì¤‘ì´ ì•„ë‹ ë•Œë§Œ ë§í¬ ì´ë™
                            if (!isSwiping) {
                              router.push(eventHref)
                            }
                          }}
                          onTouchStart={() => setIsSwiping(false)}
                          onTouchMove={() => setIsSwiping(true)}
                          onTouchEnd={() => {
                            setTimeout(() => setIsSwiping(false), 100)
                          }}
                        >
                          <EventCard event={event} />
                        </div>
                      </SwiperSlide>
                    )
                  })}
                </Swiper>
              </div>
            )}

            {/* 6ê°œë¶€í„°: ì»´íŒ©íŠ¸í•œ ë¦¬ìŠ¤íŠ¸ ë ˆì´ì•„ì›ƒ */}
            {filteredEvents.length > 5 && (
              <div className="mt-6 space-y-3">
                {filteredEvents.slice(5).map((event) => (
                  <MobileEventListItem key={event.id} event={event} />
                ))}
              </div>
            )}
          </div>

          {/* ë°ìŠ¤í¬íƒ‘ Grid */}
          <div className="hidden md:grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 2xl:grid-cols-3 gap-5 lg:gap-6">
            {filteredEvents.map((event) => (
              <div key={event.id} className="w-full">
                <EventCard
                  event={event}
                  href={event.shortUrl || `/e/${event.id.substring(0, 6)}`}
                  className="w-full h-full"
                />
              </div>
            ))}
          </div>

        </>
      )}
    </div>
  )
}

// Hydration ì—ëŸ¬ ë°©ì§€ë¥¼ ìœ„í•œ ëª¨ë°”ì¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤íŠ¸ ì•„ì´í…œ ì»´í¬ë„ŒíŠ¸
function MobileEventListItem({ event }: { event: EventCardEvent }) {
  const [dateInfo, setDateInfo] = useState({ dateStr: '', timeStr: '' })

  useEffect(() => {
    const dateObj = new Date(event.event_date)
    setDateInfo({
      dateStr: `${dateObj.getMonth() + 1}ì›” ${dateObj.getDate()}ì¼`,
      timeStr: dateObj.toLocaleTimeString('ko-KR', { hour: 'numeric', minute: '2-digit', hour12: true })
    })
  }, [event.event_date])

  const { dateStr, timeStr } = dateInfo
  const current = event.current_participants || 0
  const max = event.max_participants || 0

  return (
    <Link
      href={event.shortUrl || `/e/${event.id.substring(0, 6)}`}
      className="flex gap-3 bg-white rounded-xl border border-slate-200 p-3 hover:shadow-md transition-all active:scale-[0.98]"
    >
      {/* ì™¼ìª½: ì¸ë„¤ì¼ */}
      <div className="relative w-20 h-20 flex-shrink-0 rounded-lg overflow-hidden bg-slate-900">
        {event.thumbnail_url ? (
          <img
            src={event.thumbnail_url}
            alt={event.title}
            className="w-full h-full object-cover"
          />
        ) : (
          <div className="w-full h-full bg-gradient-to-br from-slate-700 to-slate-900" />
        )}
        {/* ì¹´í…Œê³ ë¦¬ ë±ƒì§€ */}
        {event.event_type && (
          <div className="absolute top-1 left-1 px-1.5 py-0.5 rounded text-[10px] font-medium text-white bg-black/60 backdrop-blur-sm">
            {event.event_type === 'networking' && 'ë„¤íŠ¸ì›Œí‚¹'}
            {event.event_type === 'class' && 'í´ë˜ìŠ¤'}
            {event.event_type === 'activity' && 'ì•¡í‹°ë¹„í‹°'}
          </div>
        )}
      </div>

      {/* ì˜¤ë¥¸ìª½: ì •ë³´ */}
      <div className="flex-1 min-w-0 flex flex-col justify-between">
        <div>
          <h3 className="font-bold text-sm text-slate-900 line-clamp-2 leading-snug mb-1">
            {event.title}
          </h3>
          <p className="text-xs text-slate-500">
            {dateStr} {timeStr}
          </p>
        </div>
        <div className="flex items-center justify-between mt-1">
          <p className="text-xs text-slate-600 truncate">
            ğŸ“ {event.location}
          </p>
          <span className="text-xs font-medium text-slate-700 bg-slate-100 px-2 py-0.5 rounded-full shrink-0 ml-2">
            {current} / {max}
          </span>
        </div>
      </div>
    </Link>
  )
}
</file>

<file path="components/home/featured-events.tsx">
"use client"

import { EventPostCard } from "@/components/event-post-card"
import type { EventForDisplay } from "@/lib/queries/events"
import { cn } from "@/lib/utils"

type FeaturedEventsProps = {
  events: EventForDisplay[]
}

export function FeaturedEvents({ events }: FeaturedEventsProps) {
  return (
    <section id="events-section" className="rounded-xl bg-slate-50 border border-slate-100 px-4 py-6 sm:px-6 sm:py-8 space-y-4">
      <div className="flex items-center justify-between">
        <h2 className="text-lg sm:text-xl font-bold text-slate-900">ğŸ”¥ ë‹¤ê°€ì˜¤ëŠ” ì´ë²¤íŠ¸</h2>
        <a
          href="/events"
          className="text-sm font-medium text-indigo-600 hover:text-indigo-700"
        >
          ì „ì²´ ë³´ê¸°
        </a>
      </div>

      {events.length === 0 ? (
        <div className="text-sm text-slate-500">ë“±ë¡ëœ ì´ë²¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤. ê³§ ì—…ë°ì´íŠ¸ë  ì˜ˆì •ì´ì—ìš”.</div>
      ) : (
        <div
          className={cn(
            "flex gap-4 overflow-x-auto pb-2",
            "sm:grid sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 sm:gap-5 sm:overflow-visible"
          )}
        >
          {events.map((event) => (
            <div
              key={event.id}
              className="min-w-[260px] sm:min-w-0"
            >
              <EventPostCard event={event} />
            </div>
          ))}
        </div>
      )}
    </section>
  )
}
</file>

<file path="components/home/hero-section.tsx">
"use client"

import { Button } from "@/components/ui/button"
import { Sparkles, Check, Users, Zap, Target } from "lucide-react"
import Link from "next/link"
import Image from "next/image"
import { cn } from "@/lib/utils" // cn import ì¶”ê°€ (í˜¹ì‹œ ëª°ë¼ ì¶”ê°€í•©ë‹ˆë‹¤)

interface HeroSectionProps {
  user: any
  profile?: any
  loginHref?: string
  onLogin?: () => void
}

export function HeroSection({ user, profile, loginHref = "/auth/login", onLogin }: HeroSectionProps) {
  // 1. ë¡œê·¸ì¸í•œ ìœ ì €
  if (user) {
    // displayName ë³€ìˆ˜ ìƒì„±: profile.full_name ìš°ì„ , ì—†ìœ¼ë©´ user.user_metadata.full_name, ì—†ìœ¼ë©´ "ë©¤ë²„"
    const displayName = profile?.full_name || user.user_metadata?.full_name || "ë©¤ë²„"
    
    return (
      <div className="mb-6 rounded-2xl bg-slate-900 text-white px-6 py-6 shadow-lg overflow-hidden relative min-h-[140px] flex flex-col justify-center">
        <div className="absolute top-0 right-0 -mt-10 -mr-10 w-64 h-64 bg-white/5 rounded-full blur-3xl" />
        
        <div className="relative z-10 flex flex-col md:flex-row md:items-center justify-between gap-6">
          <div>
            <h1 className="text-xl md:text-2xl font-bold mb-1 leading-tight">
              ë°˜ê°‘ìŠµë‹ˆë‹¤, {displayName}ë‹˜! ğŸ‘‹
            </h1>
            <p className="text-slate-300 text-sm">
              ì˜¤ëŠ˜ë„ ìƒˆë¡œìš´ ê¸°íšŒì™€ ì—°ê²°ë  ì¤€ë¹„ê°€ ë˜ì…¨ë‚˜ìš”?
            </p>
          </div>
          <div className="flex items-center gap-4 shrink-0">
            {/* í¬ì¸íŠ¸ í‘œì‹œ (ìˆ¨ê¹€ ì²˜ë¦¬) */}
            {/* <div className="hidden md:flex flex-col items-end mr-2">
              <span className="text-[10px] text-slate-400 font-medium mb-0.5">ë‚´ í¬ì¸íŠ¸</span>
              <span className="text-lg font-bold text-yellow-400 leading-none">
                {profile?.points?.toLocaleString() ?? 0} P
              </span>
            </div>
            */}
            <Button onClick={() => document.getElementById('events-section')?.scrollIntoView({ behavior: 'smooth' })} className="bg-white text-slate-900 hover:bg-slate-100 font-semibold border-none h-10 text-sm">
              ì´ë²¤íŠ¸ ì°¸ì—¬
            </Button>
            <Link href="/community/profile">
              <Button variant="outline" className="border-white/20 bg-white/5 text-white hover:bg-white/10 h-10 text-sm">
                ë‚´ í”„ë¡œí•„
              </Button>
            </Link>
          </div>
        </div>
      </div>
    )
  }

  // 2. ë¹„ë¡œê·¸ì¸ ìœ ì €
  return (
    <div className="mb-10 relative w-full overflow-hidden rounded-2xl bg-slate-900 shadow-md">
      {/* ë°°ê²½ ì´ë¯¸ì§€ ë° ì˜¤ë²„ë ˆì´ */}
      <div className="absolute inset-0">
        <Image
          src="https://images.unsplash.com/photo-1477959858617-67f85cf4f1df?q=80&w=2613&auto=format&fit=crop"
          alt="Seoul Founders Club"
          fill
          sizes="100vw"
          className="object-cover opacity-20"
          priority
        />
        <div className="absolute inset-0 bg-gradient-to-r from-slate-900/95 via-slate-900/80 to-slate-900/95" /> 
      </div>

      {/* ì»¨í…ì¸  ì˜ì—­ */}
      <div className="relative z-10 px-4 py-8 md:py-10 flex flex-col items-center text-center max-w-5xl mx-auto">
        
        {/* ìƒë‹¨ ë±ƒì§€ */}
        <div className="inline-block px-3 py-0.5 mb-3 rounded-full border border-slate-600 bg-slate-800/50 text-slate-300 text-[10px] font-medium tracking-wider backdrop-blur-sm">
          SEOUL FOUNDERS CLUB
        </div>
        
        {/* ë©”ì¸ ì¹´í”¼ */}
        <h1 className="text-lg md:text-3xl lg:text-4xl font-bold text-white mb-3 leading-tight tracking-tight whitespace-nowrap">
          <span className="text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-400">ìƒˆë¡œìš´ ê°€ì¹˜</span>ë¥¼ ë§Œë“œëŠ” ì‚¬ëŒë“¤ì˜ ë² ì´ìŠ¤ìº í”„
        </h1>
        
        {/* ì„œë¸Œ ì¹´í”¼ */}
        <div className="text-slate-400 text-xs md:text-sm leading-relaxed max-w-2xl mx-auto mb-5">
          <p>
            ì„œìš¸ì„ ê¸°ë°˜ìœ¼ë¡œ í™œë™í•˜ëŠ” <strong>ì°½ì—…ê°€, íˆ¬ìì, í¬ë¦¬ì—ì´í„°</strong>ê°€ ëª¨ì—¬
          </p>
          <p className="hidden md:block">
            ì‹ ë¢°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì—°ê²°ë˜ê³ , í•¨ê»˜ ì„±ì¥í•˜ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ì»¤ë®¤ë‹ˆí‹°ì…ë‹ˆë‹¤.
          </p>
          <p className="md:hidden">
            ì‹ ë¢°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì—°ê²°ë˜ê³ , í•¨ê»˜ ì„±ì¥í•˜ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ì»¤ë®¤ë‹ˆí‹°ì…ë‹ˆë‹¤.
          </p>
        </div>
        
        {/* CTA Button */}
        <div className="flex flex-col sm:flex-row items-center justify-center w-full">
          {onLogin ? (
            <Button
              size="sm"
              className="h-10 px-6 text-sm bg-white text-slate-900 hover:bg-slate-100 hover:scale-[1.02] transition-all duration-300 rounded-full font-bold shadow-lg"
              onClick={onLogin}
            >
              3ì´ˆë§Œì— ê°€ì…í•˜ê¸°
            </Button>
          ) : (
            <Link href={loginHref}>
              <Button
                size="sm"
                className="h-10 px-6 text-sm bg-white text-slate-900 hover:bg-slate-100 hover:scale-[1.02] transition-all duration-300 rounded-full font-bold shadow-lg"
              >
                3ì´ˆë§Œì— ê°€ì…í•˜ê¸°
              </Button>
            </Link>
          )}
        </div>

      </div>
    </div>
  )
}
</file>

<file path="components/mobile-action-bar.tsx">
"use client"

import { useState, useEffect } from "react"
import { usePathname, useRouter } from "next/navigation"
import { Home, Calendar, Plus, Users, User } from "lucide-react"
import { createClient } from "@/lib/supabase/client"
import { cn } from "@/lib/utils"
import { Avatar, AvatarImage, AvatarFallback } from "@/components/ui/avatar"
import type { ReactNode } from "react"

type NavButtonProps = {
  icon: ReactNode
  label: string
  isActive?: boolean
  onClick: () => void
}

function NavButton({ icon, label, isActive, onClick }: NavButtonProps) {
  return (
    <button
      type="button"
      onClick={onClick}
      className={cn(
        "flex flex-col items-center justify-center transition-colors active:bg-gray-50 pt-1",
        isActive ? "text-slate-900 font-bold" : "text-gray-400"
      )}
    >
      {icon}
      <span>{label}</span>
    </button>
  )
}

export function MobileActionBar() {
  const pathname = usePathname()
  const router = useRouter()
  const [mounted, setMounted] = useState(false)
  const [user, setUser] = useState<any>(null)
  const [profile, setProfile] = useState<{ avatar_url?: string; full_name?: string } | null>(null)

  // Hydration ì•ˆì „ì„ ìœ„í•´ ë§ˆìš´íŠ¸ í™•ì¸
  useEffect(() => {
    setMounted(true)
  }, [])

  useEffect(() => {
    // í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œì—ì„œë§Œ Supabase í´ë¼ì´ì–¸íŠ¸ ìƒì„±
    let supabase: ReturnType<typeof createClient>
    try {
      supabase = createClient()
    } catch {
      // í™˜ê²½ ë³€ìˆ˜ê°€ ì—†ìœ¼ë©´ ì¡°ìš©íˆ ì¢…ë£Œ
      return
    }

    const loadUserAndProfile = async () => {
      const {
        data: { user },
      } = await supabase.auth.getUser()
      setUser(user)

      if (user) {
        const { data: profileData } = await supabase
          .from("profiles")
          .select("avatar_url, full_name")
          .eq("id", user.id)
          .single()
        setProfile(profileData)
      }
    }

    loadUserAndProfile()

    const {
      data: { subscription },
    } = supabase.auth.onAuthStateChange(async (event, session) => {
      setUser(session?.user ?? null)
      if (session?.user) {
        const { data: profileData } = await supabase
          .from("profiles")
          .select("avatar_url, full_name")
          .eq("id", session.user.id)
          .single()
        setProfile(profileData)
      } else {
        setProfile(null)
      }
    })

    return () => subscription.unsubscribe()
  }, [])

  // í˜„ì¬ ê²½ë¡œì— ë”°ë¼ í™œì„± íƒ­ ê²°ì •
  const getActiveTab = () => {
    if (pathname === "/") return "home"
    if (pathname.startsWith("/e")) return "events"
    if (pathname.startsWith("/community/profile")) return "profile"
    if (pathname.startsWith("/communities") || pathname.startsWith("/community")) return "community"
    return null
  }

  const activeTab = getActiveTab()

  const handleHome = () => {
    router.push("/")
  }

  const handleEvents = () => {
    router.push("/e")
  }

  const handleCreate = async () => {
    if (!user) {
      router.push("/auth/login")
      return
    }
    router.push("/e/new")
  }

  const handleCommunity = () => {
    router.push("/community")
  }

  const handleProfile = async () => {
    if (!user) {
      router.push("/auth/login")
      return
    }
    router.push("/community/profile")
  }

  return (
    <nav className="fixed bottom-0 left-0 right-0 z-[100] bg-white/95 backdrop-blur-lg border-t border-slate-200/50 lg:hidden pb-[env(safe-area-inset-bottom)] shadow-[0_-4px_20px_rgba(0,0,0,0.08)]">
      <div className="grid h-16 grid-cols-5 divide-x-0 text-[10px] font-medium text-gray-500">
        <NavButton
          icon={<Home className={cn("size-6 mb-1", activeTab === "home" ? "text-slate-900" : "text-gray-400")} />}
          label="í™ˆ"
          isActive={activeTab === "home"}
          onClick={handleHome}
        />
        <NavButton
          icon={<Calendar className={cn("size-6 mb-1", activeTab === "events" ? "text-slate-900" : "text-gray-400")} />}
          label="ì´ë²¤íŠ¸"
          isActive={activeTab === "events"}
          onClick={handleEvents}
        />
        <button
          type="button"
          onClick={handleCreate}
          className="flex flex-col items-center justify-center pt-0.5"
        >
          <div className="flex items-center justify-center size-12 bg-gradient-to-br from-slate-800 to-slate-950 rounded-full shadow-lg shadow-slate-900/30 text-white transform active:scale-90 transition-all duration-150 ring-4 ring-white">
            <Plus className="size-6" />
          </div>
          <span className="text-[10px] text-slate-900 font-semibold">ë§Œë“¤ê¸°</span>
        </button>
        <NavButton
          icon={<Users className={cn("size-6 mb-1", activeTab === "community" ? "text-slate-900" : "text-gray-400")} />}
          label="ì»¤ë®¤ë‹ˆí‹°"
          isActive={activeTab === "community"}
          onClick={handleCommunity}
        />
        {/* í”„ë¡œí•„/ë¡œê·¸ì¸ ë²„íŠ¼ - ë¡œê·¸ì¸ ìƒíƒœì— ë”°ë¼ ë¶„ê¸° */}
        {/* Hydration ì•ˆì „: ë§ˆìš´íŠ¸ ì „ì—ëŠ” í•­ìƒ ë¡œê·¸ì¸ ë²„íŠ¼ í‘œì‹œ */}
        {mounted && user ? (
          <button
            type="button"
            onClick={handleProfile}
            className="flex flex-col items-center justify-center transition-colors active:bg-gray-50 pt-1"
          >
            <Avatar className={cn(
              "size-7 ring-2 ring-offset-1",
              activeTab === "profile" ? "ring-slate-900" : "ring-transparent"
            )}>
              <AvatarImage src={profile?.avatar_url || undefined} alt={profile?.full_name || "í”„ë¡œí•„"} />
              <AvatarFallback className="text-xs bg-slate-200 text-slate-600">
                {profile?.full_name?.charAt(0) || user?.email?.charAt(0)?.toUpperCase() || "U"}
              </AvatarFallback>
            </Avatar>
          </button>
        ) : (
          <NavButton
            icon={<User className="size-6 mb-1 text-gray-400" />}
            label="ë¡œê·¸ì¸"
            isActive={false}
            onClick={handleProfile}
          />
        )}
      </div>
    </nav>
  )
}
</file>

<file path="components/page-header.tsx">
import { cn } from "@/lib/utils"
import { Skeleton } from "@/components/ui/skeleton"

interface PageHeaderProps {
  title: string
  description?: string
  children?: React.ReactNode
  className?: string
  compact?: boolean
}

interface PageHeaderSkeletonProps {
  compact?: boolean
  className?: string
  hasAction?: boolean
}

/**
 * PageHeaderì˜ ìŠ¤ì¼ˆë ˆí†¤ ë²„ì „ - loading.tsxì—ì„œ ì‚¬ìš©
 * ì‹¤ì œ PageHeaderì™€ ë™ì¼í•œ ë†’ì´/ë ˆì´ì•„ì›ƒì„ ìœ ì§€í•˜ì—¬ ë ˆì´ì•„ì›ƒ ì‹œí”„íŠ¸ ë°©ì§€
 */
export function PageHeaderSkeleton({ compact = false, className, hasAction = false }: PageHeaderSkeletonProps) {
  return (
    <div
      className={cn(
        "relative rounded-xl overflow-hidden bg-gradient-to-r from-slate-900 to-slate-800 shadow-sm flex flex-col justify-center",
        compact ? "h-[130px]" : "h-[180px]",
        className
      )}
    >
      <div className={cn(
        "relative z-10 container mx-auto",
        compact ? "px-8 py-6" : "px-6 md:px-10 py-8"
      )}>
        <div className={cn(
          "flex flex-col md:flex-row md:items-center justify-between",
          compact ? "gap-2" : "gap-6"
        )}>
          <div className="flex-1 min-w-0">
            <Skeleton className={cn(
              "bg-slate-700/50 mb-2",
              compact ? "h-7 w-48" : "h-9 w-64"
            )} />
            <Skeleton className="h-5 w-80 max-w-full bg-slate-700/50" />
          </div>
          {hasAction && (
            <div className="flex-shrink-0">
              <Skeleton className="h-10 w-32 bg-slate-700/50" />
            </div>
          )}
        </div>
      </div>
    </div>
  )
}

export function PageHeader({ title, description, children, className, compact = false }: PageHeaderProps) {
  return (
    <div
      className={cn(
        "relative rounded-xl overflow-hidden bg-gradient-to-r from-slate-900 to-slate-800 text-white mb-6 shadow-sm",
        compact ? "h-[130px]" : "h-[180px]",
        className
      )}
    >
      {/* ë°°ê²½ íŒ¨í„´ ì´ë¯¸ì§€ (íˆ¬ëª…ë„ ì¡°ì ˆ) */}
      <div className="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1477959858617-67f85cf4f1df?q=80&w=2613&auto=format&fit=crop')] bg-cover bg-center opacity-10 mix-blend-overlay pointer-events-none" />

      <div className={cn(
        "relative z-10 h-full flex flex-col justify-between",
        compact ? "px-6 py-5" : "px-6 md:px-10 py-8"
      )}>
        {/* ìƒë‹¨: íƒ€ì´í‹€ ë° ì„¤ëª… */}
        <div className="flex-1 min-w-0">
          <h1 className={cn(
            "font-bold tracking-tight text-white",
            compact ? "text-xl md:text-2xl mb-2" : "text-2xl md:text-3xl mb-2"
          )}>
            {title}
          </h1>
          {description && (
            <p className={cn(
              "text-slate-300 max-w-3xl leading-relaxed font-light",
              compact ? "text-sm md:text-base line-clamp-2" : "text-sm md:text-base line-clamp-3"
            )}>
              {description}
            </p>
          )}
        </div>

        {/* í•˜ë‹¨ ìš°ì¸¡: ì•¡ì…˜ ë²„íŠ¼ ì˜ì—­ */}
        {children && (
          <div className="flex justify-end items-center gap-3">
            {children}
          </div>
        )}
      </div>
    </div>
  )
}
</file>

<file path="components/rich-text-editor.tsx">
"use client"

import type React from "react"

import { useEditor, EditorContent } from "@tiptap/react"
import StarterKit from "@tiptap/starter-kit"
import Image from "@tiptap/extension-image"
import { Button } from "@/components/ui/button"
import { Bold, Italic, List, ListOrdered, ImageIcon, Loader2, Heading1, Heading2, Quote, Code, Minus } from "lucide-react"
import { useRef, useState, useEffect } from "react"

interface RichTextEditorProps {
  content: string
  onChange: (content: string) => void
}

export function RichTextEditor({ content, onChange }: RichTextEditorProps) {
  const fileInputRef = useRef<HTMLInputElement>(null)
  const [isUploading, setIsUploading] = useState(false)

  const editor = useEditor({
    extensions: [
      StarterKit,
      Image.configure({
        HTMLAttributes: {
          class: "rounded-2xl max-w-full h-auto object-cover mx-auto my-6 shadow-sm",
        },
      }),
    ],
    content,
    onUpdate: ({ editor }) => {
      onChange(editor.getHTML())
    },
    editorProps: {
      attributes: {
        // globals.cssì˜ .prose ê·œì¹™ì„ ë”°ë¥´ë„ë¡ ê°„ì†Œí™”
        class: "prose max-w-none focus:outline-none min-h-[400px] px-8 py-8",
      },
    },
    immediatelyRender: false,
  })

  // ì™¸ë¶€ì—ì„œ contentê°€ ë³€ê²½ë˜ë©´(ì˜ˆ: DB ë¡œë”© ì™„ë£Œ ì‹œ) ì—ë””í„°ì— ë°˜ì˜
  useEffect(() => {
    if (editor && content && editor.getHTML() !== content) {
      // ë¬´í•œ ë£¨í”„ ë°©ì§€ë¥¼ ìœ„í•´ ë‚´ìš©ì´ ë‹¤ë¥¼ ë•Œë§Œ ì—…ë°ì´íŠ¸
      editor.commands.setContent(content)
    }
  }, [content, editor])

  const handleImageUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0]
    if (!file || !editor) return

    setIsUploading(true)

    try {
      const formData = new FormData()
      formData.append("file", file)

      const response = await fetch("/api/upload", {
        method: "POST",
        body: formData,
      })

      if (!response.ok) {
        let errorMessage = `ì—…ë¡œë“œ ì‹¤íŒ¨ (ìƒíƒœ ì½”ë“œ: ${response.status})`
        try {
          const errorData = await response.json()
          errorMessage = errorData.error || errorMessage
        } catch {
          const errorText = await response.text()
          errorMessage = errorText || errorMessage
        }
        throw new Error(errorMessage)
      }

      const data = await response.json()
      editor.chain().focus().setImage({ src: data.url }).run()
    } catch (error) {
      console.error("ì´ë¯¸ì§€ ì—…ë¡œë“œ ì—ëŸ¬:", error)
      const errorMessage = error instanceof Error ? error.message : "ì´ë¯¸ì§€ ì—…ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."
      alert(`ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨: ${errorMessage}`)
    } finally {
      setIsUploading(false)
    }
  }

  if (!editor) {
    return null
  }

  return (
    <div className="rounded-2xl border border-slate-200 bg-white overflow-hidden focus-within:border-slate-300 focus-within:ring-4 focus-within:ring-slate-100 transition-all duration-200 shadow-sm">
      <div className="flex items-center gap-1 border-b border-slate-100 bg-slate-50/50 px-3 py-2 flex-wrap">
        {/* ì œëª© 1 */}
        <Button
          type="button"
          size="sm"
          variant="ghost"
          onClick={() => editor.chain().focus().toggleHeading({ level: 1 }).run()}
          className={`h-8 w-8 p-0 ${editor.isActive("heading", { level: 1 }) ? "bg-slate-200 text-slate-900" : "text-slate-500"}`}
          title="ì œëª© 1"
        >
          <Heading1 className="h-4 w-4" />
        </Button>
        {/* ì œëª© 2 */}
        <Button
          type="button"
          size="sm"
          variant="ghost"
          onClick={() => editor.chain().focus().toggleHeading({ level: 2 }).run()}
          className={`h-8 w-8 p-0 ${editor.isActive("heading", { level: 2 }) ? "bg-slate-200 text-slate-900" : "text-slate-500"}`}
          title="ì œëª© 2"
        >
          <Heading2 className="h-4 w-4" />
        </Button>
        
        <div className="w-px h-4 bg-slate-200 mx-1" />

        <Button
          type="button"
          size="sm"
          variant="ghost"
          onClick={(e) => {
            e.preventDefault()
            editor.chain().focus().toggleBold().run()
          }}
          className={`h-8 w-8 p-0 ${editor.isActive("bold") ? "bg-slate-200 text-slate-900" : "text-slate-500"}`}
          title="êµµê²Œ"
        >
          <Bold className="h-4 w-4" />
        </Button>
        <Button
          type="button"
          size="sm"
          variant="ghost"
          onClick={(e) => {
            e.preventDefault()
            editor.chain().focus().toggleItalic().run()
          }}
          className={`h-8 w-8 p-0 ${editor.isActive("italic") ? "bg-slate-200 text-slate-900" : "text-slate-500"}`}
          title="ê¸°ìš¸ì„"
        >
          <Italic className="h-4 w-4" />
        </Button>
        
        <div className="w-px h-4 bg-slate-200 mx-1" />

        <Button
          type="button"
          size="sm"
          variant="ghost"
          onClick={(e) => {
            e.preventDefault()
            editor.chain().focus().toggleBulletList().run()
          }}
          className={`h-8 w-8 p-0 ${editor.isActive("bulletList") ? "bg-slate-200 text-slate-900" : "text-slate-500"}`}
          title="ê¸€ë¨¸ë¦¬ ê¸°í˜¸"
        >
          <List className="h-4 w-4" />
        </Button>
        <Button
          type="button"
          size="sm"
          variant="ghost"
          onClick={(e) => {
            e.preventDefault()
            editor.chain().focus().toggleOrderedList().run()
          }}
          className={`h-8 w-8 p-0 ${editor.isActive("orderedList") ? "bg-slate-200 text-slate-900" : "text-slate-500"}`}
          title="ë²ˆí˜¸ ë§¤ê¸°ê¸°"
        >
          <ListOrdered className="h-4 w-4" />
        </Button>

        <div className="w-px h-4 bg-slate-200 mx-1" />

        {/* ì¸ìš©êµ¬ */}
        <Button
          type="button"
          size="sm"
          variant="ghost"
          onClick={() => editor.chain().focus().toggleBlockquote().run()}
          className={`h-8 w-8 p-0 ${editor.isActive("blockquote") ? "bg-slate-200 text-slate-900" : "text-slate-500"}`}
          title="ì¸ìš©êµ¬"
        >
          <Quote className="h-4 w-4" />
        </Button>

        {/* ì½”ë“œë¸”ëŸ­ */}
        <Button
          type="button"
          size="sm"
          variant="ghost"
          onClick={() => editor.chain().focus().toggleCodeBlock().run()}
          className={`h-8 w-8 p-0 ${editor.isActive("codeBlock") ? "bg-slate-200 text-slate-900" : "text-slate-500"}`}
          title="ì½”ë“œ ë¸”ëŸ­"
        >
          <Code className="h-4 w-4" />
        </Button>

        {/* êµ¬ë¶„ì„  */}
        <Button
          type="button"
          size="sm"
          variant="ghost"
          onClick={() => editor.chain().focus().setHorizontalRule().run()}
          className="h-8 w-8 p-0 text-slate-500 hover:text-slate-900"
          title="êµ¬ë¶„ì„ "
        >
          <Minus className="h-4 w-4" />
        </Button>

        <div className="w-px h-4 bg-slate-200 mx-1" />

        <Button
          type="button"
          size="sm"
          variant="ghost"
          onClick={(e) => {
            e.preventDefault()
            fileInputRef.current?.click()
          }}
          disabled={isUploading}
          className="h-8 w-8 p-0 text-slate-500 hover:text-slate-900"
          title="ì´ë¯¸ì§€ ì—…ë¡œë“œ"
        >
          {isUploading ? <Loader2 className="h-4 w-4 animate-spin" /> : <ImageIcon className="h-4 w-4" />}
        </Button>
        <input ref={fileInputRef} type="file" accept="image/*" onChange={handleImageUpload} className="hidden" />
      </div>
      <EditorContent editor={editor} />
    </div>
  )
}
</file>

<file path="components/site-header.tsx">
import Link from "next/link"
import Image from "next/image"
import { getCachedUserProfile } from "@/lib/queries/cached"
import { SiteHeaderClient } from "./site-header-client"

interface SiteHeaderProps {
    user?: any
    profile?: any
}

export async function SiteHeader({ user, profile }: SiteHeaderProps = {}) {
    // propsê°€ ì—†ì„ ë•Œë§Œ ì¡°íšŒ (ìºì‹œëœ í•¨ìˆ˜ ì‚¬ìš©ìœ¼ë¡œ ì¤‘ë³µ í˜¸ì¶œ ë°©ì§€)
    if (user === undefined && profile === undefined) {
        const userProfile = await getCachedUserProfile()
        user = userProfile?.user || null
        profile = userProfile?.profile || null
    }

    return (
        <header className="fixed inset-x-0 top-0 z-50 h-16 w-full border-b border-slate-200/50 bg-white/80 backdrop-blur-xl supports-[backdrop-filter]:bg-white/75 shadow-sm shadow-slate-900/5">
            <div className="flex h-16 w-full items-center px-4 lg:px-[27px]">
                {/* Left: Logo - ì‚¬ì´ë“œë°” ë„ˆë¹„(240px)ì— ë§ì¶° ì¤‘ì•™ ì •ë ¬ */}
                <div className="w-[240px] flex items-center justify-center flex-shrink-0">
                    <Link href="/" className="flex items-center hover:opacity-85 transition-opacity">
                        <Image
                            src="/images/logo-text.png"
                            alt="Seoul Founders Club"
                            width={580}
                            height={51}
                            className="h-6 w-auto max-w-44 object-contain"
                            priority
                        />
                    </Link>
                </div>

                {/* Client Side Content (Search, Actions, Profile) */}
                <SiteHeaderClient user={user} profile={profile} initialNotifications={[]} />
            </div>
        </header>
    )
}
</file>

<file path="components/standard-right-sidebar.tsx">
import { getCachedAnnouncements } from "@/lib/queries/cached"
import { Separator } from "@/components/ui/separator"
import { Bell, ChevronRight } from "lucide-react"
import Link from "next/link"

export async function StandardRightSidebar() {
  const announcements = await getCachedAnnouncements()

  return (
    <div className="flex flex-col gap-8 h-full">
      {/* ê³µì§€ì‚¬í•­ ìœ„ì ¯ */}
      <div className="flex flex-col">
        <div className="flex items-center justify-between mb-2 px-1">
          <div className="flex items-center gap-2">
            <Bell className="h-4 w-4 text-slate-500" />
            <h3 className="text-xs font-bold uppercase tracking-wide text-slate-500">ê³µì§€ì‚¬í•­</h3>
          </div>
          <Link href="/community/board/announcements" className="text-xs text-slate-400 hover:text-slate-600 flex items-center gap-1">
            ë”ë³´ê¸°
            <ChevronRight className="h-3 w-3" />
          </Link>
        </div>
        {announcements.length > 0 ? (
          <div className="flex flex-col">
            {announcements.map((announcement, idx) => (
              <div key={announcement.id}>
                <Link
                  href={`/community/board/announcements/${announcement.id}`}
                  className="block py-2 px-1 text-sm text-slate-700 hover:text-slate-900 hover:underline truncate"
                >
                  {announcement.title}
                </Link>
                {idx !== announcements.length - 1 && <Separator className="my-1 bg-slate-100" />}
              </div>
            ))}
          </div>
        ) : (
          <p className="text-sm text-slate-500 px-1">ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤</p>
        )}
      </div>

    </div>
  )
}
</file>

<file path="components/ui/clickable-avatar.tsx">
"use client"

import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar"
import { ProfilePopover } from "@/components/ui/profile-popover"
import { cn } from "@/lib/utils"

interface ClickableAvatarProps {
  profile: {
    id: string
    full_name: string | null
    avatar_url: string | null
    bio?: string | null
    company?: string | null
    position?: string | null
    tagline?: string | null
  } | null
  badges?: { icon: string; name: string }[]
  size?: "xs" | "sm" | "md" | "lg" | "xl"
  showName?: boolean
  className?: string
  nameClassName?: string
}

const sizeClasses = {
  xs: "h-6 w-6",
  sm: "h-8 w-8",
  md: "h-10 w-10",
  lg: "h-12 w-12",
  xl: "h-14 w-14",
}

const fallbackTextSizes = {
  xs: "text-[10px]",
  sm: "text-xs",
  md: "text-sm",
  lg: "text-base",
  xl: "text-lg",
}

export function ClickableAvatar({
  profile,
  badges,
  size = "md",
  showName = false,
  className,
  nameClassName,
}: ClickableAvatarProps) {
  // profileì´ ì—†ìœ¼ë©´ ì •ì  ì•„ë°”íƒ€ë§Œ í‘œì‹œ
  if (!profile?.id) {
    return (
      <div className={cn("flex items-center gap-2", className)}>
        <Avatar className={cn(sizeClasses[size], "border border-slate-100")}>
          <AvatarFallback className={cn("bg-slate-100 text-slate-500 font-semibold", fallbackTextSizes[size])}>
            {profile?.full_name?.[0] || "U"}
          </AvatarFallback>
        </Avatar>
        {showName && (
          <span className={cn("font-semibold text-slate-900 text-sm", nameClassName)}>
            {profile?.full_name || "ìµëª…"}
          </span>
        )}
      </div>
    )
  }

  return (
    <ProfilePopover profile={profile} badges={badges}>
      <button
        className={cn("flex items-center gap-2 cursor-pointer hover:opacity-80 transition-opacity", className)}
        type="button"
      >
        <Avatar className={cn(sizeClasses[size], "border border-slate-100")}>
          <AvatarImage src={profile.avatar_url || undefined} />
          <AvatarFallback className={cn("bg-slate-100 text-slate-500 font-semibold", fallbackTextSizes[size])}>
            {profile.full_name?.[0] || "U"}
          </AvatarFallback>
        </Avatar>
        {showName && (
          <span className={cn("font-semibold text-slate-900 text-sm hover:underline", nameClassName)}>
            {profile.full_name || "ìµëª…"}
          </span>
        )}
      </button>
    </ProfilePopover>
  )
}
</file>

<file path="components/ui/post-card.tsx">
"use client"

import { MessageSquare, Share2, Tag, Check } from "lucide-react"
import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar"
import { cn } from "@/lib/utils"
import { useRouter } from "next/navigation"
import { useEffect, useMemo, useState } from "react"
import { useToast } from "@/hooks/use-toast"

type PostCardProps = {
  postId: string
  href: string
  community: { name: string; href?: string; iconUrl?: string | null }
  author: { name: string; href?: string; avatarUrl?: string | null }
  createdAt: string
  title: string
  content?: string | null
  contentRaw?: string | null
  thumbnailUrl?: string | null
  commentsCount?: number
  onShare?: () => void
  hideCategory?: boolean
}

export function PostCard({
  postId,
  href,
  community,
  author,
  createdAt,
  title,
  content,
  contentRaw,
  thumbnailUrl,
  commentsCount = 0,
  onShare,
  hideCategory = false,
}: PostCardProps) {
  const router = useRouter()
  const { toast } = useToast()
  const [copied, setCopied] = useState(false)
  const [timeLabel, setTimeLabel] = useState<string>("")

  // Hydration ì—ëŸ¬ ë°©ì§€: í´ë¼ì´ì–¸íŠ¸ ë§ˆìš´íŠ¸ í›„ì—ë§Œ ì‹œê°„ ê³„ì‚°
  useEffect(() => {
    setTimeLabel(formatRelativeTime(createdAt))
  }, [createdAt])
  const derivedThumb = thumbnailUrl || extractFirstImage(contentRaw || content)
  const previewHtml = useMemo(
    () => sanitizePreview(contentRaw || content || "", Boolean(derivedThumb)),
    [content, contentRaw, derivedThumb]
  )

  // ê³µìœ  ë²„íŠ¼ í•¸ë“¤ëŸ¬
  const handleShare = async (e: React.MouseEvent) => {
    e.preventDefault()
    e.stopPropagation()

    const shareUrl = window.location.origin + href
    const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent)

    // ëª¨ë°”ì¼: Web Share API ì‚¬ìš©
    if (isMobile && navigator.share) {
      try {
        await navigator.share({
          title: title,
          url: shareUrl,
        })
        toast({ description: "ê³µìœ ë˜ì—ˆìŠµë‹ˆë‹¤!", duration: 2000 })
        return
      } catch (error: any) {
        if (error.name === 'AbortError') return
      }
    }

    // PC: í´ë¦½ë³´ë“œ ë³µì‚¬
    try {
      await navigator.clipboard.writeText(shareUrl)
      setCopied(true)
      toast({ description: "ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!", duration: 2000 })
      setTimeout(() => setCopied(false), 2000)
    } catch {
      toast({
        title: "ë³µì‚¬ ì‹¤íŒ¨",
        description: "ë§í¬ë¥¼ ë³µì‚¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",
        variant: "destructive",
      })
    }
  }

  return (
    <div
      role="link"
      tabIndex={0}
      onClick={() => {
        window.scrollTo(0, 0)
        router.push(href)
      }}
      onKeyDown={(e) => {
        if (e.key === "Enter" || e.key === " ") {
          e.preventDefault()
          window.scrollTo(0, 0)
          router.push(href)
        }
      }}
      className={cn(
        "bg-white border border-slate-200 rounded-lg hover:border-slate-300 transition-colors mb-4",
        "cursor-pointer overflow-hidden shadow-sm hover:shadow-md"
      )}
    >
      {/* Header */}
      <div className="p-3 pb-1 flex items-center gap-2 text-xs text-slate-500">
        <Avatar className="h-6 w-6">
          <AvatarImage src={author.avatarUrl || undefined} />
          <AvatarFallback className="text-[10px]">
            {author.name?.charAt(0) || "Â·"}
          </AvatarFallback>
        </Avatar>
        <span className="font-bold text-slate-900 text-sm">{author.name}</span>
        <span className="text-slate-400">â€¢</span>
        <span className="text-slate-400">{timeLabel}</span>
        {!hideCategory && (
          <>
            <span className="text-slate-400">â€¢</span>
            <span className="inline-flex items-center gap-1 text-[11px] text-slate-500 bg-slate-100 px-2 py-1 rounded-full">
              <Tag className="h-3 w-3" />
              {community.name}
            </span>
          </>
        )}
      </div>

      {/* Title */}
      <div className="px-3 py-1">
        <h3 className="text-lg font-bold text-slate-900 leading-snug">
          {title}
        </h3>
      </div>

      {/* Content Preview + Image */}
      <div className="px-3 pb-2">
        {(contentRaw || content) && (
          <div
            className="prose prose-slate max-w-none text-sm leading-relaxed line-clamp-4"
            dangerouslySetInnerHTML={{ __html: previewHtml }}
          />
        )}
        {derivedThumb && (
          <div className="mt-3 w-full h-[300px] rounded-md bg-slate-100 overflow-hidden">
            <img
              src={derivedThumb}
              alt={title}
              className="w-full h-full object-cover"
              loading="lazy"
            />
          </div>
        )}
      </div>

      {/* Footer */}
      <div className="px-3 py-2 bg-slate-50/50 border-t border-slate-100 flex items-center gap-1 text-xs text-slate-600">
        {/* ëŒ“ê¸€ ë²„íŠ¼ - í´ë¦­ ì‹œ ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™ */}
        <button
          type="button"
          className="flex items-center gap-1 px-2 py-1 rounded-full hover:bg-slate-200 transition-colors"
          onClick={(e) => {
            e.preventDefault()
            e.stopPropagation()
            window.scrollTo(0, 0)
            router.push(href)
          }}
        >
          <MessageSquare className="h-4 w-4" />
          <span>{commentsCount}</span>
        </button>

        {/* ê³µìœ  ë²„íŠ¼ */}
        <button
          type="button"
          className="flex items-center gap-1 px-2 py-1 rounded-full hover:bg-slate-200 transition-colors"
          onClick={handleShare}
        >
          {copied ? <Check className="h-4 w-4" /> : <Share2 className="h-4 w-4" />}
          <span>{copied ? "ë³µì‚¬ë¨" : "ê³µìœ "}</span>
        </button>
      </div>
    </div>
  )
}

function formatRelativeTime(dateStr: string) {
  const date = new Date(dateStr)
  const diff = Date.now() - date.getTime()
  const sec = Math.floor(diff / 1000)
  if (sec < 60) return `${sec}ì´ˆ ì „`
  const min = Math.floor(sec / 60)
  if (min < 60) return `${min}ë¶„ ì „`
  const hr = Math.floor(min / 60)
  if (hr < 24) return `${hr}ì‹œê°„ ì „`
  const day = Math.floor(hr / 24)
  if (day < 30) return `${day}ì¼ ì „`
  const mo = Math.floor(day / 30)
  if (mo < 12) return `${mo}ê°œì›” ì „`
  const yr = Math.floor(mo / 12)
  return `${yr}ë…„ ì „`
}

function extractFirstImage(content?: string | null): string | null {
  if (!content) return null
  const match = content.match(/<img[^>]+src=["']([^"']+)["']/i)
  return match ? match[1] : null
}

// ë§¤ìš° ì œí•œì ìœ¼ë¡œ ìŠ¤í¬ë¦½íŠ¸/ì¸ë¼ì¸ í•¸ë“¤ëŸ¬ë¥¼ ì œê±°í•œ ë’¤ ë¯¸ë¦¬ë³´ê¸°ë¡œ ì‚¬ìš©
function sanitizePreview(html: string, stripImages = false): string {
  if (!html) return ""
  let safe = html
  // ìŠ¤í¬ë¦½íŠ¸ íƒœê·¸ ì œê±°
  safe = safe.replace(/<script[\s\S]*?>[\s\S]*?<\/script>/gi, "")
  // ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬(on...) ì†ì„± ì œê±°
  safe = safe.replace(/\son\w+="[^"]*"/gi, "")
  safe = safe.replace(/\son\w+='[^']*'/gi, "")
  // ìŠ¤íƒ€ì¼ íƒœê·¸ ì œê±°(ì›ì¹˜ ì•ŠëŠ” CSS ì£¼ì… ë°©ì§€)
  safe = safe.replace(/<style[\s\S]*?>[\s\S]*?<\/style>/gi, "")
  if (stripImages) {
    safe = safe.replace(/<img[^>]*>/gi, "")
  }
  return safe
}
</file>

<file path="lib/actions/comments.ts">
"use server"

import { createClient } from "@/lib/supabase/server"

export type CommentNode = {
  id: string
  post_id: string
  author_id: string
  content: string
  created_at: string
  updated_at?: string | null
  parent_id?: string | null
  depth?: number
  profiles?: {
    id: string
    full_name: string | null
    avatar_url: string | null
  } | null
  children?: CommentNode[]
}

type CreateCommentInput = {
  postId: string
  content: string
  parentId?: string | null
}

export async function createComment({ postId, content, parentId = null }: CreateCommentInput) {
  const supabase = await createClient()

  const {
    data: { user },
  } = await supabase.auth.getUser()

  if (!user) {
    throw new Error("Unauthorized")
  }

  const depth = parentId ? 1 : 0

  const { data, error } = await supabase
    .from("comments")
    .insert({
      post_id: postId,
      author_id: user.id,
      content: content.trim(),
      parent_id: parentId,
      depth,
    })
    .select(
      `
      *,
      profiles:author_id (
        id,
        full_name,
        avatar_url
      )
    `
    )
    .single()

  if (error) {
    throw new Error(error.message)
  }

  return data as CommentNode
}

export async function deleteComment(commentId: string): Promise<void> {
  const supabase = await createClient()

  const {
    data: { user },
  } = await supabase.auth.getUser()

  if (!user) {
    throw new Error("Unauthorized")
  }

  // ë³¸ì¸ ëŒ“ê¸€ì¸ì§€ í™•ì¸
  const { data: comment } = await supabase
    .from("comments")
    .select("author_id")
    .eq("id", commentId)
    .single()

  if (!comment || comment.author_id !== user.id) {
    throw new Error("ì‚­ì œ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.")
  }

  // ëŒ€ëŒ“ê¸€ë„ í•¨ê»˜ ì‚­ì œ
  const { error: childError } = await supabase
    .from("comments")
    .delete()
    .eq("parent_id", commentId)

  if (childError) {
    throw new Error(childError.message)
  }

  const { error } = await supabase
    .from("comments")
    .delete()
    .eq("id", commentId)

  if (error) {
    throw new Error(error.message)
  }
}

export async function getComments(postId: string): Promise<CommentNode[]> {
  const supabase = await createClient()

  const { data, error } = await supabase
    .from("comments")
    .select(
      `
      *,
      profiles:author_id (
        id,
        full_name,
        avatar_url
      )
    `
    )
    .eq("post_id", postId)
    .order("created_at", { ascending: true })

  if (error) {
    throw new Error(error.message)
  }

  const { buildCommentTree } = await import("@/lib/utils/comments-tree")
  return buildCommentTree((data || []) as CommentNode[])
}
</file>

<file path="lib/actions/event-registrations.ts">
"use server"

import { createClient } from "@/lib/supabase/server"
import { revalidatePath } from "next/cache"

/**
 * ê²ŒìŠ¤íŠ¸ ì´ë²¤íŠ¸ ì‹ ì²­ (ì„œë²„ ì•¡ì…˜)
 * ì•ˆë“œë¡œì´ë“œì—ì„œ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì´ ì™„ë£Œë˜ì§€ ì•ŠëŠ” ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ì„œë²„ ì•¡ì…˜ ì‚¬ìš©
 */
export async function registerGuestForEvent(
  eventId: string,
  guestName: string,
  guestContact: string,
  paymentStatus: "pending" | null = null,
  customFieldResponses?: Record<string, string>,
  asWaitlist: boolean = false
) {
  const supabase = await createClient()

  // ì´ë²¤íŠ¸ ì •ë³´ ë° í˜„ì¬ ë“±ë¡ ìˆ˜ í™•ì¸ (confirmed ìƒíƒœë§Œ)
  const [eventResult, confirmedCountResult, waitlistCountResult] = await Promise.all([
    supabase.from("events").select("max_participants, status, event_date, end_date").eq("id", eventId).single(),
    supabase.from("event_registrations").select("id", { count: "exact", head: true }).eq("event_id", eventId).eq("status", "confirmed"),
    supabase.from("event_registrations").select("id", { count: "exact", head: true }).eq("event_id", eventId).eq("status", "waitlist"),
  ])

  if (eventResult.error || !eventResult.data) {
    throw new Error("ì´ë²¤íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
  }

  const event = eventResult.data
  const confirmedCount = confirmedCountResult.count || 0
  const waitlistCount = waitlistCountResult.count || 0

  // ì¢…ë£Œëœ ì´ë²¤íŠ¸ ì²´í¬
  const now = new Date()
  const eventEndDate = event.end_date
    ? new Date(event.end_date)
    : new Date(new Date(event.event_date).getTime() + 3 * 60 * 60 * 1000)

  if (event.status === "completed" || eventEndDate < now) {
    throw new Error("ì¢…ë£Œëœ ì´ë²¤íŠ¸ì…ë‹ˆë‹¤.")
  }

  // ì •ì› ì´ˆê³¼ ì—¬ë¶€ í™•ì¸
  const isFull = event.max_participants && confirmedCount >= event.max_participants

  // ì •ì›ì´ ì°¼ëŠ”ë° ëŒ€ê¸°ì ì‹ ì²­ì´ ì•„ë‹ˆë©´ ì—ëŸ¬
  if (isFull && !asWaitlist) {
    throw new Error("ì •ì›ì´ ë§ˆê°ë˜ì—ˆìŠµë‹ˆë‹¤. ëŒ€ê¸°ìë¡œ ì‹ ì²­í•´ì£¼ì„¸ìš”.")
  }

  // ë“±ë¡ ìƒíƒœ ê²°ì •
  const registrationStatus = isFull ? "waitlist" : "confirmed"
  const waitlistPosition = isFull ? waitlistCount + 1 : null

  // ê²ŒìŠ¤íŠ¸ ë“±ë¡ (user_idëŠ” null)
  const { data: regData, error } = await supabase
    .from("event_registrations")
    .insert({
      event_id: eventId,
      user_id: null,
      guest_name: guestName.trim(),
      guest_contact: guestContact.trim(),
      payment_status: paymentStatus,
      status: registrationStatus,
      waitlist_position: waitlistPosition,
    })
    .select("id, status, waitlist_position")
    .single()

  if (error) {
    console.error("[registerGuestForEvent] Error:", error)
    throw new Error(error.message || "ì´ë²¤íŠ¸ ì‹ ì²­ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")
  }

  if (!regData?.id) {
    throw new Error("ë“±ë¡ ë°ì´í„°ë¥¼ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.")
  }

  const registrationId = regData.id

  // ì»¤ìŠ¤í…€ í•„ë“œ ì‘ë‹µ ì €ì¥
  if (customFieldResponses && Object.keys(customFieldResponses).length > 0) {
    const responsesToInsert = Object.entries(customFieldResponses)
      .filter(([_, value]) => value && value.trim() !== "")
      .map(([fieldId, value]) => ({
        registration_id: registrationId,
        field_id: fieldId,
        response_value: value.trim(),
      }))

    if (responsesToInsert.length > 0) {
      const { error: responseError } = await supabase
        .from("event_registration_responses")
        .upsert(responsesToInsert, { onConflict: "registration_id, field_id" })

      if (responseError) {
        console.warn("[registerGuestForEvent] Failed to save custom field responses:", responseError)
        // ì»¤ìŠ¤í…€ í•„ë“œ ì €ì¥ ì‹¤íŒ¨í•´ë„ ì‹ ì²­ì€ ì™„ë£Œëœ ê²ƒìœ¼ë¡œ ì²˜ë¦¬
      }
    }
  }

  revalidatePath("/e")
  revalidatePath("/events")
  revalidatePath("/")

  return {
    success: true,
    registrationId,
    status: regData.status as "confirmed" | "waitlist",
    waitlistPosition: regData.waitlist_position as number | null,
  }
}

/**
 * ë¡œê·¸ì¸ ì‚¬ìš©ì ì´ë²¤íŠ¸ ì‹ ì²­ (ì„œë²„ ì•¡ì…˜)
 */
export async function registerUserForEvent(
  eventId: string,
  userId: string,
  guestName?: string | null,
  guestContact?: string | null,
  paymentStatus: "pending" | null = null,
  customFieldResponses?: Record<string, string>,
  asWaitlist: boolean = false
) {
  const supabase = await createClient()

  // í˜„ì¬ ì‚¬ìš©ì í™•ì¸
  const {
    data: { user },
  } = await supabase.auth.getUser()

  if (!user || user.id !== userId) {
    throw new Error("Unauthorized")
  }

  // ì´ë²¤íŠ¸ ì •ë³´ ë° í˜„ì¬ ë“±ë¡ ìˆ˜ í™•ì¸
  const [eventResult, confirmedCountResult, waitlistCountResult, existingRegResult] = await Promise.all([
    supabase.from("events").select("max_participants, status, event_date, end_date").eq("id", eventId).single(),
    supabase.from("event_registrations").select("id", { count: "exact", head: true }).eq("event_id", eventId).eq("status", "confirmed"),
    supabase.from("event_registrations").select("id", { count: "exact", head: true }).eq("event_id", eventId).eq("status", "waitlist"),
    supabase.from("event_registrations").select("id, status").eq("event_id", eventId).eq("user_id", userId).maybeSingle(),
  ])

  if (eventResult.error || !eventResult.data) {
    throw new Error("ì´ë²¤íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
  }

  const event = eventResult.data
  const confirmedCount = confirmedCountResult.count || 0
  const waitlistCount = waitlistCountResult.count || 0
  const existingReg = existingRegResult.data

  // ì¢…ë£Œëœ ì´ë²¤íŠ¸ ì²´í¬
  const now = new Date()
  const eventEndDate = event.end_date
    ? new Date(event.end_date)
    : new Date(new Date(event.event_date).getTime() + 3 * 60 * 60 * 1000)

  if (event.status === "completed" || eventEndDate < now) {
    throw new Error("ì¢…ë£Œëœ ì´ë²¤íŠ¸ì…ë‹ˆë‹¤.")
  }

  // ì´ë¯¸ ë“±ë¡ëœ ê²½ìš° (ì •ë³´ ì—…ë°ì´íŠ¸ë§Œ)
  if (existingReg) {
    const { data: regData, error } = await supabase
      .from("event_registrations")
      .update({
        guest_name: guestName?.trim() || null,
        guest_contact: guestContact?.trim() || null,
      })
      .eq("id", existingReg.id)
      .select("id, status, waitlist_position")
      .single()

    if (error) {
      throw new Error(error.message || "ì •ë³´ ì—…ë°ì´íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")
    }

    revalidatePath("/e")
    revalidatePath("/events")
    revalidatePath("/")

    return {
      success: true,
      registrationId: regData.id,
      status: regData.status as "confirmed" | "waitlist",
      waitlistPosition: regData.waitlist_position as number | null,
    }
  }

  // ì •ì› ì´ˆê³¼ ì—¬ë¶€ í™•ì¸
  const isFull = event.max_participants && confirmedCount >= event.max_participants

  // ì •ì›ì´ ì°¼ëŠ”ë° ëŒ€ê¸°ì ì‹ ì²­ì´ ì•„ë‹ˆë©´ ì—ëŸ¬
  if (isFull && !asWaitlist) {
    throw new Error("ì •ì›ì´ ë§ˆê°ë˜ì—ˆìŠµë‹ˆë‹¤. ëŒ€ê¸°ìë¡œ ì‹ ì²­í•´ì£¼ì„¸ìš”.")
  }

  // ë“±ë¡ ìƒíƒœ ê²°ì •
  const registrationStatus = isFull ? "waitlist" : "confirmed"
  const waitlistPosition = isFull ? waitlistCount + 1 : null

  // ì‚¬ìš©ì ë“±ë¡
  const { data: regData, error } = await supabase
    .from("event_registrations")
    .insert({
      event_id: eventId,
      user_id: userId,
      guest_name: guestName?.trim() || null,
      guest_contact: guestContact?.trim() || null,
      payment_status: paymentStatus,
      status: registrationStatus,
      waitlist_position: waitlistPosition,
    })
    .select("id, status, waitlist_position")
    .single()

  if (error) {
    console.error("[registerUserForEvent] Error:", error)
    throw new Error(error.message || "ì´ë²¤íŠ¸ ì‹ ì²­ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")
  }

  if (!regData?.id) {
    throw new Error("ë“±ë¡ ë°ì´í„°ë¥¼ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.")
  }

  const registrationId = regData.id

  // ì»¤ìŠ¤í…€ í•„ë“œ ì‘ë‹µ ì €ì¥
  if (customFieldResponses && Object.keys(customFieldResponses).length > 0) {
    const responsesToInsert = Object.entries(customFieldResponses)
      .filter(([_, value]) => value && value.trim() !== "")
      .map(([fieldId, value]) => ({
        registration_id: registrationId,
        field_id: fieldId,
        response_value: value.trim(),
      }))

    if (responsesToInsert.length > 0) {
      const { error: responseError } = await supabase
        .from("event_registration_responses")
        .upsert(responsesToInsert, { onConflict: "registration_id, field_id" })

      if (responseError) {
        console.warn("[registerUserForEvent] Failed to save custom field responses:", responseError)
        // ì»¤ìŠ¤í…€ í•„ë“œ ì €ì¥ ì‹¤íŒ¨í•´ë„ ì‹ ì²­ì€ ì™„ë£Œëœ ê²ƒìœ¼ë¡œ ì²˜ë¦¬
      }
    }
  }

  revalidatePath("/e")
  revalidatePath("/events")
  revalidatePath("/")

  return {
    success: true,
    registrationId,
    status: regData.status as "confirmed" | "waitlist",
    waitlistPosition: regData.waitlist_position as number | null,
  }
}

/**
 * ëŒ€ê¸°ì ì°¸ê°€ í™•ì • (ì„œë²„ ì•¡ì…˜)
 * ì•Œë¦¼ì„ ë°›ì€ ëŒ€ê¸°ìê°€ ì°¸ê°€ë¥¼ í™•ì •í•  ë•Œ í˜¸ì¶œ
 */
export async function confirmWaitlistRegistration(
  eventId: string,
  userId: string
) {
  const supabase = await createClient()

  // í˜„ì¬ ì‚¬ìš©ì í™•ì¸
  const {
    data: { user },
  } = await supabase.auth.getUser()

  if (!user || user.id !== userId) {
    throw new Error("Unauthorized")
  }

  // í˜„ì¬ ë“±ë¡ ì •ë³´ í™•ì¸
  const { data: registration, error: regError } = await supabase
    .from("event_registrations")
    .select("id, status, waitlist_notified_at")
    .eq("event_id", eventId)
    .eq("user_id", userId)
    .single()

  if (regError || !registration) {
    throw new Error("ë“±ë¡ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
  }

  if (registration.status !== "waitlist") {
    throw new Error("ì´ë¯¸ ì°¸ê°€ê°€ í™•ì •ë˜ì—ˆìŠµë‹ˆë‹¤.")
  }

  if (!registration.waitlist_notified_at) {
    throw new Error("ì•„ì§ ì°¸ê°€ ê°€ëŠ¥ ì•Œë¦¼ì„ ë°›ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")
  }

  // ì´ë²¤íŠ¸ ì •ì› í™•ì¸
  const [eventResult, confirmedCountResult] = await Promise.all([
    supabase.from("events").select("max_participants").eq("id", eventId).single(),
    supabase.from("event_registrations").select("id", { count: "exact", head: true }).eq("event_id", eventId).eq("status", "confirmed"),
  ])

  if (eventResult.error || !eventResult.data) {
    throw new Error("ì´ë²¤íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
  }

  const event = eventResult.data
  const confirmedCount = confirmedCountResult.count || 0

  // ì •ì›ì´ ë‹¤ì‹œ ì°¼ëŠ”ì§€ í™•ì¸
  if (event.max_participants && confirmedCount >= event.max_participants) {
    throw new Error("ì£„ì†¡í•©ë‹ˆë‹¤. ë‹¤ë¥¸ ëŒ€ê¸°ìê°€ ë¨¼ì € í™•ì •í•˜ì—¬ ìë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤.")
  }

  // ìƒíƒœë¥¼ confirmedë¡œ ë³€ê²½
  const { error: updateError } = await supabase
    .from("event_registrations")
    .update({
      status: "confirmed",
      waitlist_position: null,
    })
    .eq("id", registration.id)

  if (updateError) {
    throw new Error("ì°¸ê°€ í™•ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")
  }

  revalidatePath("/e")
  revalidatePath("/events")
  revalidatePath("/")

  return { success: true }
}

/**
 * ì°¸ê°€ ì·¨ì†Œ ë° ëŒ€ê¸°ì ìŠ¹ê²© (ì„œë²„ ì•¡ì…˜)
 */
export async function cancelRegistration(
  eventId: string,
  userId: string
) {
  const supabase = await createClient()

  // í˜„ì¬ ì‚¬ìš©ì í™•ì¸
  const {
    data: { user },
  } = await supabase.auth.getUser()

  if (!user || user.id !== userId) {
    throw new Error("Unauthorized")
  }

  // í˜„ì¬ ë“±ë¡ ì •ë³´ í™•ì¸
  const { data: registration, error: regError } = await supabase
    .from("event_registrations")
    .select("id, status")
    .eq("event_id", eventId)
    .eq("user_id", userId)
    .single()

  if (regError || !registration) {
    throw new Error("ë“±ë¡ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
  }

  const wasConfirmed = registration.status === "confirmed"

  // ë“±ë¡ ì‚­ì œ
  const { error: deleteError } = await supabase
    .from("event_registrations")
    .delete()
    .eq("id", registration.id)

  if (deleteError) {
    throw new Error("ì·¨ì†Œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")
  }

  // í™•ì •ìê°€ ì·¨ì†Œí•œ ê²½ìš°, ë‹¤ìŒ ëŒ€ê¸°ìì—ê²Œ ì•Œë¦¼ (DB íŠ¸ë¦¬ê±°ê°€ ì²˜ë¦¬)
  // ì¶”ê°€ì ìœ¼ë¡œ ì•±ì—ì„œ ì§ì ‘ ì²˜ë¦¬í•  ìˆ˜ë„ ìˆìŒ

  revalidatePath("/e")
  revalidatePath("/events")
  revalidatePath("/")

  return { success: true, wasConfirmed }
}
</file>

<file path="lib/actions/events.ts">
"use server"

import { createClient } from "@/lib/supabase/server"
import { revalidatePath } from "next/cache"
import { isAdmin } from "@/lib/utils"
import type { EventInsertData, EventUpdateData } from "@/lib/types/events"

/**
 * ì´ë²¤íŠ¸ ìƒì„± (ë³´ì•ˆ ê°•í™”: ì„¸ì…˜ ê¸°ë°˜)
 * í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë³´ë‚¸ created_byëŠ” ë¬´ì‹œí•˜ê³ , ë¬´ì¡°ê±´ í˜„ì¬ ë¡œê·¸ì¸í•œ ì„¸ì…˜ì˜ IDë§Œ ì‚¬ìš©
 */
export async function createEvent(data: {
  title: string
  description: string
  event_date: string
  end_date?: string | null
  location?: string | null
  price?: number | null
  max_participants?: number | null
  thumbnail_url?: string | null
  event_type?: 'networking' | 'class' | 'activity' | null
  customFields?: Array<{
    id: string
    label: string
    type: 'text' | 'select'
    options: string[]
    required: boolean
  }>
  // â˜… ë³´ì•ˆ: created_byëŠ” ë¬´ì‹œë¨ (í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë³´ë‚´ë„ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ)
}) {
  const supabase = await createClient()

  // â˜… ë³´ì•ˆ: ë¬´ì¡°ê±´ í˜„ì¬ ë¡œê·¸ì¸í•œ ì„¸ì…˜ì˜ IDë§Œ ì‚¬ìš©
  const {
    data: { user },
  } = await supabase.auth.getUser()

  if (!user) {
    throw new Error("Unauthorized")
  }

  // â˜… ë³´ì•ˆ: í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë³´ë‚¸ created_byëŠ” ë¬´ì‹œí•˜ê³ , ì„¸ì…˜ì˜ user.idë§Œ ì‚¬ìš©
  const insertData: EventInsertData = {
    title: data.title.trim(),
    description: data.description.trim(),
    event_date: data.event_date,
    location: data.location || null,
    price: data.price && data.price > 0 ? data.price : null,
    max_participants: data.max_participants || null,
    thumbnail_url: data.thumbnail_url || null,
    event_type: data.event_type || 'networking',
    created_by: user.id, // â˜… ë¬´ì¡°ê±´ ì„¸ì…˜ì˜ user.idë§Œ ì‚¬ìš©
  }

  // end_dateê°€ ìˆìœ¼ë©´ ì¶”ê°€
  if (data.end_date) {
    insertData.end_date = data.end_date
  }

  const { data: event, error } = await supabase.from("events").insert(insertData).select("id").single()

  if (error) {
    throw new Error(error.message)
  }

  // ì»¤ìŠ¤í…€ í•„ë“œ ì €ì¥
  if (data.customFields && data.customFields.length > 0 && event) {
    const fieldsToInsert = data.customFields
      .filter(field => field.label.trim() !== '') // ë¹ˆ ì§ˆë¬¸ ì œì™¸
      .map((field, index) => ({
        event_id: event.id,
        field_name: field.label.trim(),
        field_type: field.type,
        field_options: field.type === 'select' && field.options.length > 0 
          ? field.options.filter(opt => opt.trim() !== '') // ë¹ˆ ì˜µì…˜ ì œì™¸
          : null,
        is_required: field.required,
        order_index: index,
      }))

    if (fieldsToInsert.length > 0) {
      const { error: fieldsError } = await supabase
        .from("event_registration_fields")
        .insert(fieldsToInsert)

      if (fieldsError) {
        console.error("Failed to insert custom fields:", fieldsError)
        // í•„ë“œ ì €ì¥ ì‹¤íŒ¨í•´ë„ ì´ë²¤íŠ¸ëŠ” ìƒì„±ë˜ì—ˆìœ¼ë¯€ë¡œ ê²½ê³ ë§Œ
      }
    }
  }

  revalidatePath("/e")
  revalidatePath("/")
  return { success: true, eventId: event.id }
}

export async function deleteEvent(eventId: string) {
  const supabase = await createClient()

  const {
    data: { user },
  } = await supabase.auth.getUser()

  if (!user) {
    throw new Error("Unauthorized")
  }

  // Verify event exists and get creator info
  const { data: event } = await supabase
    .from("events")
    .select("id, created_by")
    .eq("id", eventId)
    .single()

  if (!event) {
    throw new Error("Event not found")
  }

  // Check if current user is the creator
  const isCreator = event.created_by === user.id

  // Check if current user is admin or master
  const { data: profile } = await supabase
    .from("profiles")
    .select("role, email")
    .eq("id", user.id)
    .single()

  const isAdminUser = profile && isAdmin(profile.role, profile.email)

  // Only creator or admin can delete
  if (!isCreator && !isAdminUser) {
    throw new Error("Unauthorized: Only event creators or admins can delete events")
  }

  // Delete event (registrations will be cascade deleted by DB)
  const { error } = await supabase.from("events").delete().eq("id", eventId)

  if (error) {
    throw new Error(error.message)
  }

  revalidatePath("/admin/events")
  revalidatePath("/e")
  revalidatePath("/")
  return { success: true }
}

export async function updateEvent(eventId: string, data: {
  title: string
  description: string
  event_date: string
  end_date?: string | null
  location?: string | null
  price?: number | null
  max_participants?: number | null
  thumbnail_url?: string | null
  event_type?: 'networking' | 'class' | 'activity' | null
  customFields?: Array<{
    id: string
    label: string
    type: 'text' | 'select'
    options: string[]
    required: boolean
  }>
}) {
  const supabase = await createClient()

  const {
    data: { user },
  } = await supabase.auth.getUser()

  if (!user) {
    throw new Error("Unauthorized")
  }

  // Verify event exists and user is the creator
  const { data: event } = await supabase
    .from("events")
    .select("id, created_by")
    .eq("id", eventId)
    .single()

  if (!event) {
    throw new Error("Event not found")
  }

  // Only creator can update
  if (event.created_by !== user.id) {
    throw new Error("Unauthorized: Only event creators can update events")
  }

  const updateData: EventUpdateData = {
    title: data.title.trim(),
    description: data.description.trim(),
    event_date: data.event_date,
    location: data.location || null,
    price: data.price && data.price > 0 ? data.price : null,
    max_participants: data.max_participants || null,
    thumbnail_url: data.thumbnail_url || null,
    event_type: data.event_type || 'networking',
    updated_at: new Date().toISOString(),
  }

  // end_dateê°€ ìˆìœ¼ë©´ ì¶”ê°€
  if (data.end_date) {
    updateData.end_date = data.end_date
  } else {
    updateData.end_date = null
  }

  const { error } = await supabase
    .from("events")
    .update(updateData)
    .eq("id", eventId)

  if (error) {
    throw new Error(error.message)
  }

  // ì»¤ìŠ¤í…€ í•„ë“œ ì—…ë°ì´íŠ¸: ê¸°ì¡´ ì§ˆë¬¸ ì‚­ì œ í›„ ìƒˆë¡œ ë“±ë¡
  console.log('[updateEvent] customFields received:', data.customFields?.length || 0, 'fields');
  if (data.customFields !== undefined) {
    // ê¸°ì¡´ ì§ˆë¬¸ ëª¨ë‘ ì‚­ì œ
    console.log('[updateEvent] Deleting existing fields for event:', eventId);
    const { error: deleteError } = await supabase
      .from("event_registration_fields")
      .delete()
      .eq("event_id", eventId)

    if (deleteError) {
      console.error("Failed to delete existing custom fields:", deleteError)
      throw new Error(`ê¸°ì¡´ ì§ˆë¬¸ ì‚­ì œ ì‹¤íŒ¨: ${deleteError.message}`)
    }

    // ìƒˆë¡œìš´ ì§ˆë¬¸ë“¤ ë“±ë¡
    if (data.customFields && data.customFields.length > 0) {
      const fieldsToInsert = data.customFields
        .filter(field => field.label.trim() !== '') // ë¹ˆ ì§ˆë¬¸ ì œì™¸
        .map((field, index) => ({
          event_id: eventId,
          field_name: field.label.trim(),
          field_type: field.type,
          field_options: field.type === 'select' && field.options.length > 0 
            ? field.options.filter(opt => opt.trim() !== '') // ë¹ˆ ì˜µì…˜ ì œì™¸
            : null,
          is_required: field.required,
          order_index: index,
        }))

      console.log('[updateEvent] Inserting', fieldsToInsert.length, 'new fields');
      if (fieldsToInsert.length > 0) {
        const { error: fieldsError } = await supabase
          .from("event_registration_fields")
          .insert(fieldsToInsert)

        if (fieldsError) {
          console.error("Failed to insert custom fields:", fieldsError)
          throw new Error(`ì§ˆë¬¸ ì €ì¥ ì‹¤íŒ¨: ${fieldsError.message}`)
        }
      }
    }
  }

  revalidatePath(`/e/${eventId}`)
  revalidatePath("/e")
  revalidatePath("/")
  return { success: true }
}

export async function addGuestParticipant(eventId: string, guestName: string, guestContact?: string) {
  const supabase = await createClient()

  const {
    data: { user },
  } = await supabase.auth.getUser()

  if (!user) {
    throw new Error("Unauthorized")
  }

  // Verify event exists and user is the creator
  const { data: event } = await supabase
    .from("events")
    .select("created_by, max_participants")
    .eq("id", eventId)
    .single()

  if (!event) {
    throw new Error("Event not found")
  }

  if (event.created_by !== user.id) {
    throw new Error("Unauthorized: Only event creators can add guest participants")
  }

  // Validate guest name
  if (!guestName || !guestName.trim()) {
    throw new Error("Guest name is required")
  }

  // Check if event is full
  if (event.max_participants) {
    const { count } = await supabase
      .from("event_registrations")
      .select("*", { count: "exact", head: true })
      .eq("event_id", eventId)

    if (count && count >= event.max_participants) {
      throw new Error("Event is full")
    }
  }

  // Insert guest registration
  const { error } = await supabase.from("event_registrations").insert({
    event_id: eventId,
    user_id: null, // Guest registration
    guest_name: guestName.trim(),
    guest_contact: guestContact?.trim() || null,
  })

  if (error) {
    throw new Error(error.message)
  }

  revalidatePath(`/e/${eventId}/manage`)
  revalidatePath(`/e/${eventId}`)
  return { success: true }
}
</file>

<file path="lib/actions/feed.ts">
"use server"

import { createClient } from "@/lib/supabase/server"
import type { PostForDisplay } from "@/lib/types/posts"

type SortOption = "latest" | "popular"

export async function fetchFeedPosts(page: number = 1, sort: SortOption = "latest"): Promise<PostForDisplay[]> {
  const supabase = await createClient()
  const PAGE_SIZE = 10
  const from = (page - 1) * PAGE_SIZE
  const to = from + PAGE_SIZE - 1

  let query = supabase
    .from("posts")
    .select(
      `
        id,
        title,
        content,
        created_at,
        likes_count,
        comments_count,
        thumbnail_url,
        board_categories!inner(name, slug),
        profiles:author_id(id, full_name, avatar_url),
        communities(name, is_private)
      `
    )
    .neq("board_categories.slug", "announcement")
    .range(from, to)

  if (sort === "popular") {
    query = query.order("likes_count", { ascending: false }).order("created_at", { ascending: false })
  } else {
    query = query.order("created_at", { ascending: false })
  }

  const { data, error } = await query

  if (error || !data) {
    console.error("fetchFeedPosts error:", error)
    return []
  }

  // ë¹„ê³µê°œ ì»¤ë®¤ë‹ˆí‹° ê¸€ í•„í„°ë§
  const filteredData = data.filter((post: any) => {
    // ì»¤ë®¤ë‹ˆí‹°ê°€ ì—†ëŠ” ê¸€ (ì¼ë°˜ ê²Œì‹œíŒ)ì€ í•­ìƒ í‘œì‹œ
    if (!post.communities) return true
    // ì»¤ë®¤ë‹ˆí‹°ê°€ ìˆëŠ” ê²½ìš°, ê³µê°œ ì»¤ë®¤ë‹ˆí‹°ë§Œ í‘œì‹œ
    const community = Array.isArray(post.communities) ? post.communities[0] : post.communities
    return !community?.is_private
  })

  return filteredData.map((post: any) => {
    const boardCategory = Array.isArray(post.board_categories) ? post.board_categories[0] : post.board_categories
    const profile = Array.isArray(post.profiles) ? post.profiles[0] : post.profiles
    return {
      id: post.id,
      title: post.title,
      content: post.content,
      created_at: post.created_at,
      likes_count: post.likes_count,
      comments_count: post.comments_count,
      thumbnail_url: post.thumbnail_url,
      board_categories: boardCategory
        ? {
            name: boardCategory.name,
            slug: boardCategory.slug,
          }
        : null,
      profiles: profile
        ? {
            id: profile.id,
            full_name: profile.full_name,
            avatar_url: profile.avatar_url,
          }
        : null,
      communities: post.communities
        ? {
            name: Array.isArray(post.communities) ? post.communities[0]?.name : post.communities.name,
          }
        : null,
    } satisfies PostForDisplay
  })
}
</file>

<file path="lib/queries/events.ts">
import { SupabaseClient } from "@supabase/supabase-js"

export type EventForDisplay = {
  id: string
  title: string
  thumbnail_url?: string | null
  event_date: string
  event_time?: string | null
  location?: string | null
  max_participants?: number | null
  current_participants: number
  event_type?: 'networking' | 'class' | 'activity' | null
  // í˜¸ìŠ¤íŠ¸ ì •ë³´
  host_name?: string | null
  host_avatar_url?: string | null
}

/**
 * ë‹¤ê°€ì˜¤ëŠ” ì´ë²¤íŠ¸ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
 */
export async function getUpcomingEvents(
  supabase: SupabaseClient,
  limit: number = 9
): Promise<EventForDisplay[]> {
  // ì˜¤ëŠ˜ ë‚ ì§œì˜ ì‹œì‘ ì‹œê°„ì„ ê³„ì‚° (ì‹œê°„ëŒ€ ë¬¸ì œ ë°©ì§€)
  const today = new Date();
  today.setHours(0, 0, 0, 0);
  const todayStart = today.toISOString();
  
  const { data, error } = await supabase
    .from("events")
    .select(`
      id,
      title,
      thumbnail_url,
      event_date,
      location,
      max_participants,
      event_type,
      event_registrations (count),
      profiles:created_by (
        full_name,
        avatar_url
      )
    `)
    .gte("event_date", todayStart)
    .order("event_date", { ascending: true })
    .limit(limit)

  if (error) {
    if (process.env.NODE_ENV === "development") {
      console.error("Error fetching events:", (error as any)?.message || error)
    }
    return []
  }

  return (data || []).map((event: any) => {
    // ë°°ì—´/ê°ì²´ ëª¨ë‘ ëŒ€ì‘
    const profile = Array.isArray(event.profiles)
      ? event.profiles[0]
      : event.profiles;

    return {
      id: event.id,
      title: event.title,
      thumbnail_url: event.thumbnail_url,
      event_date: event.event_date,
      // event_time ì»¬ëŸ¼ì´ ì—†ëŠ” ìŠ¤í‚¤ë§ˆ ëŒ€ì‘ (nullë¡œ ì±„ì›Œì„œ íƒ€ì… ì¶©ì¡±)
      event_time: null,
      location: event.location,
      max_participants: event.max_participants,
      current_participants: event.event_registrations?.[0]?.count || 0,
      event_type: event.event_type || 'networking',
      // í˜¸ìŠ¤íŠ¸ ì •ë³´ ë§¤í•‘
      host_name: profile?.full_name || null,
      host_avatar_url: profile?.avatar_url || null,
    }
  })
}
</file>

<file path="lib/queries/posts.ts">
import { SupabaseClient } from "@supabase/supabase-js"
import type { PostForDisplay, ReviewForDisplay } from "@/lib/types/posts"

// íƒ€ì… ì¬export (í•˜ìœ„ í˜¸í™˜ì„± ìœ ì§€)
export type { PostForDisplay, ReviewForDisplay }

// Supabase ì¿¼ë¦¬ ê²°ê³¼ íƒ€ì…
type PostFromDB = {
  id: string
  title: string
  content: string | null
  created_at: string
  visibility: string | null
  likes_count: number | null
  comments_count: number | null
  thumbnail_url: string | null
  profiles: {
    id: string
    full_name: string | null
    avatar_url: string | null
  } | null
  board_categories: {
    name: string | null
    slug: string | null
  } | null
}

type ReviewFromDB = {
  id: string
  title: string
  content: string | null
  created_at: string
  likes_count: number | null
  comments_count: number | null
  profiles: {
    id: string
    full_name: string | null
    avatar_url: string | null
  } | null
  events: {
    id: string
    title: string | null
    thumbnail_url: string | null
  } | null
}


/**
 * ìµœì‹  ê²Œì‹œê¸€ ëª©ë¡ ê°€ì ¸ì˜¤ê¸° (Inner Join í•„í„°ë§ ë°©ì‹)
 * @param supabase Supabase í´ë¼ì´ì–¸íŠ¸
 * @param limit ê°€ì ¸ì˜¬ ê²Œì‹œê¸€ ìˆ˜ (ê¸°ë³¸ê°’: 50)
 * @param categorySlug íŠ¹ì • ì¹´í…Œê³ ë¦¬ ìŠ¬ëŸ¬ê·¸ (ì˜ˆ: 'vangol', 'hightalk'). ì—†ê±°ë‚˜ 'all'ì´ë©´ ê³µì§€ì‚¬í•­/ììœ ê²Œì‹œíŒ ì œì™¸í•œ ëª¨ë“  ê¸€
 */
export async function getLatestPosts(
  supabase: SupabaseClient,
  limit: number = 50,
  categorySlug?: string | null
): Promise<PostForDisplay[]> {
  try {
    // â˜… ìŠ¬ëŸ¬ê·¸ ì •ê·œí™” (DBì™€ URLì˜ ë¶ˆì¼ì¹˜ í•´ê²°) - ë°©ì–´ì  í”„ë¡œê·¸ë˜ë°
    if (categorySlug === 'free') {
      categorySlug = 'free-board';
    }
    if (categorySlug === 'announcements') {
      categorySlug = 'announcement';
    }

    // 1. ê¸°ë³¸ ì¿¼ë¦¬ ì‘ì„± (Select + Join)
    // Left Joinì„ ì‚¬ìš©í•˜ì—¬ RLS ì •ì±… ì¶©ëŒ ë°©ì§€
    // profiles ì¡°ì¸ ì‹œ id í•„ë“œë¥¼ ë°˜ë“œì‹œ í¬í•¨í•˜ì—¬ N+1 ë¬¸ì œ ì˜ˆë°©
    let query = supabase
      .from("posts")
      .select(`
        id, title, thumbnail_url, created_at, visibility, likes_count, comments_count,
        profiles:author_id(id, full_name, avatar_url),
        board_categories(name, slug)
      `); // content í•„ë“œ ì œê±°í•˜ì—¬ ì¿¼ë¦¬ ê²½ëŸ‰í™” (ë¦¬ìŠ¤íŠ¸ì—ì„œëŠ” ë³¸ë¬¸ ì „ì²´ê°€ í•„ìš” ì—†ìŒ)

    // 2. í•„í„°ë§ ì¡°ê±´ ì ìš©
    if (!categorySlug || categorySlug === 'all') {
      // [í†µí•© í”¼ë“œ] ê³µì§€ì‚¬í•­, ììœ ê²Œì‹œíŒ, 'ì—´ì–´ì£¼ì„¸ìš”', í›„ê¸° ì œì™¸í•˜ê³  ë‚˜ë¨¸ì§€ëŠ” ëª¨ë‘ ê°€ì ¸ì˜´
      // ì¹´í…Œê³ ë¦¬ê°€ ìˆëŠ” ê²ƒë§Œ í•„í„°ë§ (null ì œì™¸)
      query = query.not('board_categories', 'is', null);
      query = query.neq('board_categories.slug', 'announcement')
        .neq('board_categories.slug', 'free-board')
        .neq('board_categories.slug', 'event-requests')
        .neq('board_categories.slug', 'reviews');
      query = query.order("created_at", { ascending: false });
    } else if (categorySlug === 'event-requests') {
      // [Event Requests] likes_count ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
      query = query.eq('board_categories.slug', categorySlug);
      query = query.order("likes_count", { ascending: false });
    } else {
      // [ê°œë³„ ê²Œì‹œíŒ] í•´ë‹¹ ìŠ¬ëŸ¬ê·¸ì™€ ì •í™•íˆ ì¼ì¹˜í•˜ëŠ” ê¸€ë§Œ
      query = query.eq('board_categories.slug', categorySlug);
      query = query.order("created_at", { ascending: false });
    }

    query = query.limit(limit);

    // 3. ì¿¼ë¦¬ ì‹¤í–‰
    const { data: posts, error } = await query;

    if (error) {
      console.error("ğŸš¨ [getLatestPosts] Query Error:", JSON.stringify(error, null, 2));
      console.error("ğŸš¨ [getLatestPosts] Error Details:", {
        message: error.message,
        details: error.details,
        hint: error.hint,
        code: error.code
      });
      return [];
    }

    if (!posts || posts.length === 0) {
      return [];
    }

    // 4. ë°ì´í„° ë³€í™˜ (Type Mapping)
    // âœ… ìˆ˜ì •: post_likes í…Œì´ë¸”ì„ ë³„ë„ ì¡°íšŒí•˜ì§€ ì•Šê³ , DBì˜ likes_countë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©
    // (ìµëª… ì¢‹ì•„ìš”ëŠ” posts.likes_countì—ë§Œ ë°˜ì˜ë˜ë¯€ë¡œ, ë³„ë„ ì¹´ìš´íŠ¸í•˜ë©´ 0ì´ ë¨)
    return (posts || []).map((post: any): PostForDisplay => ({
      id: post.id,
      title: post.title,
      content: null,
      created_at: post.created_at,
      visibility: (post.visibility as "public" | "group") || 'public',
      likes_count: post.likes_count || 0,
      comments_count: post.comments_count || 0,
      thumbnail_url: post.thumbnail_url,
      profiles: post.profiles ? {
        id: post.profiles.id,
        full_name: post.profiles.full_name,
        avatar_url: post.profiles.avatar_url
      } : null,
      board_categories: post.board_categories
        ? { name: post.board_categories.name, slug: post.board_categories.slug }
        : null,
      communities: null
    }));

  } catch (error) {
    console.error("ğŸš¨ [getLatestPosts] Unexpected Error:", JSON.stringify(error, null, 2));
    if (error instanceof Error) {
      console.error("ğŸš¨ [getLatestPosts] Error Stack:", error.stack);
    }
    return [];
  }
}

/**
 * ìµœì‹  í›„ê¸° ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
 * @param supabase Supabase í´ë¼ì´ì–¸íŠ¸
 * @param limit ê°€ì ¸ì˜¬ í›„ê¸° ìˆ˜ (ê¸°ë³¸ê°’: 10)
 */
export async function getLatestReviews(
  supabase: SupabaseClient,
  limit: number = 10
): Promise<ReviewForDisplay[]> {
  try {
    // 1. Reviews ì¡°íšŒ (ê´€ê³„ ì¡°ì¸ ì—†ì´ ìˆœìˆ˜ ë°ì´í„°ë§Œ)
    const { data: reviews, error } = await supabase
      .from("reviews")
      .select("*")
      .eq("is_public", true)
      .order("is_best", { ascending: false })
      .order("created_at", { ascending: false })
      .limit(limit);

    if (error) {
      console.error("ğŸš¨ [getLatestReviews] Query Error:", error);
      return [];
    }

    if (!reviews || reviews.length === 0) {
      return [];
    }

    // 2. User IDs ë° Event IDs ìˆ˜ì§‘
    const userIds = Array.from(new Set(reviews.map((r: any) => r.user_id).filter(Boolean)));
    const eventIds = Array.from(new Set(reviews.map((r: any) => r.event_id).filter(Boolean)));

    // 3. Profiles ì¡°íšŒ
    let profileMap = new Map();
    if (userIds.length > 0) {
      const { data: profiles } = await supabase
        .from("profiles")
        .select("id, full_name, avatar_url, role, company, position")
        .in("id", userIds);

      if (profiles) {
        profiles.forEach((p: any) => profileMap.set(p.id, p));
      }
    }

    // 4. Events ì¡°íšŒ
    let eventMap = new Map();
    if (eventIds.length > 0) {
      const { data: events } = await supabase
        .from("events")
        .select("id, title, event_date, thumbnail_url")
        .in("id", eventIds);

      if (events) {
        events.forEach((e: any) => eventMap.set(e.id, e));
      }
    }

    // 5. ë°ì´í„° ë³‘í•© (Mapping)
    const result = reviews.map((review: any): ReviewForDisplay | null => {
      const event = eventMap.get(review.event_id);

      // ì´ë²¤íŠ¸ ì •ë³´ê°€ ì—†ìœ¼ë©´ ì œì™¸ (í•„ìˆ˜ í•„ë“œ)
      if (!event) return null;

      const profile = profileMap.get(review.user_id);

      return {
        id: review.id,
        user_id: review.user_id,
        event_id: review.event_id,
        rating: review.rating,
        keywords: review.keywords || [],
        one_liner: review.one_liner,
        detail_content: review.detail_content,
        images: review.images || [],
        is_best: review.is_best,
        is_public: review.is_public,
        created_at: review.created_at,
        updated_at: review.updated_at,
        title: review.one_liner,
        likes_count: 0,
        comments_count: 0,
        profiles: profile ? {
          id: profile.id,
          full_name: profile.full_name,
          avatar_url: profile.avatar_url,
          role: profile.role,
          company: profile.company,
          position: profile.position
        } : null,
        events: {
          id: event.id,
          title: event.title,
          event_date: event.event_date,
          thumbnail_url: event.thumbnail_url
        }
      };
    }).filter((item): item is ReviewForDisplay => item !== null);

    return result;

  } catch (error) {
    console.error("ğŸš¨ [getLatestReviews] Unexpected Error:", error);
    return [];
  }
}

/**
 * íŠ¹ì • ì´ë²¤íŠ¸ì˜ í›„ê¸° ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
 * @param supabase Supabase í´ë¼ì´ì–¸íŠ¸
 * @param eventId ì´ë²¤íŠ¸ ID
 */
export async function getReviewsByEvent(
  supabase: SupabaseClient,
  eventId: string
): Promise<ReviewForDisplay[]> {
  try {
    // 1. Reviews ì¡°íšŒ (ì¡°ì¸ ì—†ìŒ)
    const { data: reviews, error } = await supabase
      .from("reviews")
      .select("*")
      .eq("event_id", eventId)
      .eq("is_public", true)
      .order("is_best", { ascending: false })
      .order("created_at", { ascending: false });

    if (error) {
      console.error("ğŸš¨ [getReviewsByEvent] Query Error:", error);
      return [];
    }

    if (!reviews || reviews.length === 0) {
      return [];
    }

    // 2. User IDs ìˆ˜ì§‘ ë° Profiles ì¡°íšŒ
    const userIds = Array.from(new Set(reviews.map((r: any) => r.user_id).filter(Boolean)));

    let profileMap = new Map();
    if (userIds.length > 0) {
      const { data: profiles } = await supabase
        .from("profiles")
        .select("id, full_name, avatar_url, role, company, position")
        .in("id", userIds);

      if (profiles) {
        profiles.forEach((p: any) => profileMap.set(p.id, p));
      }
    }

    // 3. Event ì •ë³´ ì¡°íšŒ (ë‹¨ì¼ ì´ë²¤íŠ¸ì´ë¯€ë¡œ í•œ ë²ˆë§Œ ì¡°íšŒ)
    const { data: event } = await supabase
      .from("events")
      .select("id, title, event_date, thumbnail_url")
      .eq("id", eventId)
      .single();

    if (!event) {
      console.error("ğŸš¨ [getReviewsByEvent] Event not found:", eventId);
      return [];
    }

    // 4. ë°ì´í„° ë³‘í•©
    return reviews.map((review: any): ReviewForDisplay | null => {
      const profile = profileMap.get(review.user_id);

      return {
        id: review.id,
        user_id: review.user_id,
        event_id: review.event_id,
        rating: review.rating,
        keywords: review.keywords || [],
        one_liner: review.one_liner,
        detail_content: review.detail_content,
        images: review.images || [],
        is_best: review.is_best,
        is_public: review.is_public,
        created_at: review.created_at,
        updated_at: review.updated_at,
        // PostForDisplay ì¸í„°í˜ì´ìŠ¤ í˜¸í™˜ìš©
        title: review.one_liner,
        likes_count: 0,
        comments_count: 0,
        profiles: profile ? {
          id: profile.id,
          full_name: profile.full_name,
          avatar_url: profile.avatar_url,
          role: profile.role,
          company: profile.company,
          position: profile.position
        } : null,
        events: {
          id: event.id,
          title: event.title,
          event_date: event.event_date,
          thumbnail_url: event.thumbnail_url
        }
      };
    }).filter((item): item is ReviewForDisplay => item !== null);

  } catch (error) {
    console.error("ğŸš¨ [getReviewsByEvent] Unexpected Error:", error);
    return [];
  }
}
</file>

<file path="next.config.mjs">
/** @type {import('next').NextConfig} */
const isDev = process.env.NODE_ENV === 'development'

const nextConfig = {
  // ê°œë°œì—ì„œëŠ” ì¤‘ë³µ ë Œë” ê²½ê³ ë¥¼ í”¼í•˜ê³ , í”„ë¡œë•ì…˜ì—ì„œëŠ” ì•ˆì „í•˜ê²Œ Strict Mode í™œì„±í™”
  reactStrictMode: !isDev,
  typescript: {
    // í”„ë¡œë•ì…˜ ì˜¤ë¥˜ë¥¼ ì‚¼í‚¤ì§€ ì•Šë„ë¡ ë¹Œë“œ ì—ëŸ¬ë¥¼ ë¬´ì‹œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
    ignoreBuildErrors: false,
    tsconfigPath: './tsconfig.json',
  },
  images: {
    // Next ì´ë¯¸ì§€ ìµœì í™”ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
    unoptimized: false,
    remotePatterns: [
      { protocol: 'https', hostname: 'api.dicebear.com' },
      { protocol: 'https', hostname: 'images.unsplash.com' },
      { protocol: 'https', hostname: 'c6a6mkohft8ir4os.public.blob.vercel-storage.com' },
      { protocol: 'https', hostname: 'lh3.googleusercontent.com' },
    ],
    qualities: [75, 100],
  },
  serverExternalPackages: ['@supabase/supabase-js'],
  transpilePackages: ['lucide-react'],
  experimental: {
    optimizeCss: false,
    // ê°œë°œ í™˜ê²½ì—ì„œ ì»´íŒŒì¼ ì†ë„ ê°œì„ 
    optimizePackageImports: ['lucide-react', '@radix-ui/react-icons'],
  },
  // Turbopack ì„¤ì • (Next.js 16ì—ì„œ ê¸°ë³¸ í™œì„±í™”)
  turbopack: {},
  // ê°œë°œ í™˜ê²½ ìµœì í™” (webpack ì‚¬ìš© ì‹œ)
  ...(isDev && {
    // ê°œë°œ í™˜ê²½ì—ì„œë§Œ ì ìš©ë˜ëŠ” ì„¤ì •
    webpack: (config, { dev, isServer }) => {
      if (dev && !isServer) {
        // í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ ë¹Œë“œ ìµœì í™” - ê°œë°œ í™˜ê²½ì—ì„œ ì»´íŒŒì¼ ì†ë„ í–¥ìƒ
        config.optimization = {
          ...config.optimization,
          removeAvailableModules: false,
          removeEmptyChunks: false,
          splitChunks: false,
        }
        // íŒŒì¼ ê°ì‹œ ìµœì í™”
        config.watchOptions = {
          ...config.watchOptions,
          ignored: [
            '**/node_modules/**',
            '**/.next/**',
            '**/.git/**',
            '**/scripts/**',
            '**/*.md',
            '**/repomix-output.xml',
          ],
        }
      }
      return config
    },
  }),
}

export default nextConfig
</file>

<file path="scripts/070_add_waitlist_status.sql">
-- ëŒ€ê¸°ì(waitlist) ê¸°ëŠ¥ ì¶”ê°€
-- event_registrations í…Œì´ë¸”ì— status ì»¬ëŸ¼ ì¶”ê°€

-- 1. status ì»¬ëŸ¼ ì¶”ê°€ (confirmed: í™•ì •, waitlist: ëŒ€ê¸°)
ALTER TABLE public.event_registrations
ADD COLUMN IF NOT EXISTS status TEXT DEFAULT 'confirmed' CHECK (status IN ('confirmed', 'waitlist'));

-- 2. ëŒ€ê¸° ìˆœë²ˆ ì»¬ëŸ¼ ì¶”ê°€ (ëŒ€ê¸°ìì¼ ë•Œë§Œ ì‚¬ìš©)
ALTER TABLE public.event_registrations
ADD COLUMN IF NOT EXISTS waitlist_position INTEGER;

-- 3. ëŒ€ê¸°ì ìŠ¹ê²© ì•Œë¦¼ ì „ì†¡ ì—¬ë¶€
ALTER TABLE public.event_registrations
ADD COLUMN IF NOT EXISTS waitlist_notified_at TIMESTAMPTZ;

-- 4. ê¸°ì¡´ ë“±ë¡ì€ ëª¨ë‘ confirmedë¡œ ì„¤ì •
UPDATE public.event_registrations SET status = 'confirmed' WHERE status IS NULL;

-- 5. ì¸ë±ìŠ¤ ì¶”ê°€ (ëŒ€ê¸°ì ì¡°íšŒ ìµœì í™”)
CREATE INDEX IF NOT EXISTS idx_event_registrations_status ON public.event_registrations(event_id, status);
CREATE INDEX IF NOT EXISTS idx_event_registrations_waitlist ON public.event_registrations(event_id, waitlist_position) WHERE status = 'waitlist';

-- 6. ëŒ€ê¸°ì ìŠ¹ê²© ì•Œë¦¼ í•¨ìˆ˜
CREATE OR REPLACE FUNCTION notify_waitlist_promotion()
RETURNS TRIGGER AS $$
DECLARE
  next_waitlist_id UUID;
  next_user_id UUID;
  event_title TEXT;
  event_max INT;
  current_confirmed INT;
BEGIN
  -- ì‚­ì œëœ ë“±ë¡ì´ confirmed ìƒíƒœì˜€ëŠ”ì§€ í™•ì¸
  IF OLD.status != 'confirmed' THEN
    RETURN OLD;
  END IF;

  -- ì´ë²¤íŠ¸ ì •ë³´ ì¡°íšŒ
  SELECT title, max_participants INTO event_title, event_max
  FROM events WHERE id = OLD.event_id;

  -- í˜„ì¬ í™•ì • ì¸ì› ìˆ˜ í™•ì¸
  SELECT COUNT(*) INTO current_confirmed
  FROM event_registrations
  WHERE event_id = OLD.event_id AND status = 'confirmed';

  -- ì •ì›ì´ ì—†ê±°ë‚˜ ì•„ì§ ê½‰ ì°¨ ìˆìœ¼ë©´ ìŠ¹ê²© ë¶ˆí•„ìš”
  IF event_max IS NULL OR current_confirmed >= event_max THEN
    RETURN OLD;
  END IF;

  -- ë‹¤ìŒ ëŒ€ê¸°ì ì°¾ê¸° (ê°€ì¥ ë‚®ì€ waitlist_position)
  SELECT id, user_id INTO next_waitlist_id, next_user_id
  FROM event_registrations
  WHERE event_id = OLD.event_id
    AND status = 'waitlist'
    AND waitlist_notified_at IS NULL
  ORDER BY waitlist_position ASC, registered_at ASC
  LIMIT 1;

  -- ëŒ€ê¸°ìê°€ ìˆìœ¼ë©´ ì•Œë¦¼ ìƒì„±
  IF next_waitlist_id IS NOT NULL AND next_user_id IS NOT NULL THEN
    -- ì•Œë¦¼ ìƒì„±
    INSERT INTO notifications (user_id, type, title, message, related_event_id)
    VALUES (
      next_user_id,
      'waitlist_promotion',
      'ì°¸ê°€ ê°€ëŠ¥ ì•Œë¦¼',
      'ëŒ€ê¸° ì¤‘ì´ë˜ "' || event_title || '" ì´ë²¤íŠ¸ì— ìë¦¬ê°€ ìƒê²¼ìŠµë‹ˆë‹¤! ì§€ê¸ˆ ì°¸ê°€ë¥¼ í™•ì •í•´ì£¼ì„¸ìš”.',
      OLD.event_id
    );

    -- ì•Œë¦¼ ì „ì†¡ ì‹œê°„ ê¸°ë¡
    UPDATE event_registrations
    SET waitlist_notified_at = NOW()
    WHERE id = next_waitlist_id;
  END IF;

  RETURN OLD;
END;
$$ LANGUAGE plpgsql;

-- 7. íŠ¸ë¦¬ê±° ìƒì„± (ë“±ë¡ ì‚­ì œ ì‹œ)
DROP TRIGGER IF EXISTS trigger_notify_waitlist_on_cancel ON event_registrations;
CREATE TRIGGER trigger_notify_waitlist_on_cancel
  AFTER DELETE ON event_registrations
  FOR EACH ROW
  EXECUTE FUNCTION notify_waitlist_promotion();

-- 8. ëŒ€ê¸°ì ìŠ¹ê²© í•¨ìˆ˜ (ìˆ˜ë™ ë˜ëŠ” ìë™ ìŠ¹ê²©ìš©)
CREATE OR REPLACE FUNCTION promote_from_waitlist(p_event_id UUID)
RETURNS INTEGER AS $$
DECLARE
  event_max INT;
  current_confirmed INT;
  slots_available INT;
  promoted_count INT := 0;
  waitlist_record RECORD;
BEGIN
  -- ì´ë²¤íŠ¸ ìµœëŒ€ ì¸ì› ì¡°íšŒ
  SELECT max_participants INTO event_max FROM events WHERE id = p_event_id;

  -- ì •ì› ì œí•œì´ ì—†ìœ¼ë©´ ì¢…ë£Œ
  IF event_max IS NULL THEN
    RETURN 0;
  END IF;

  -- í˜„ì¬ í™•ì • ì¸ì› ìˆ˜
  SELECT COUNT(*) INTO current_confirmed
  FROM event_registrations
  WHERE event_id = p_event_id AND status = 'confirmed';

  -- ë¹ˆ ìë¦¬ ìˆ˜
  slots_available := event_max - current_confirmed;

  -- ë¹ˆ ìë¦¬ê°€ ì—†ìœ¼ë©´ ì¢…ë£Œ
  IF slots_available <= 0 THEN
    RETURN 0;
  END IF;

  -- ëŒ€ê¸°ì ìˆœì„œëŒ€ë¡œ ìŠ¹ê²©
  FOR waitlist_record IN
    SELECT id, user_id
    FROM event_registrations
    WHERE event_id = p_event_id
      AND status = 'waitlist'
    ORDER BY waitlist_position ASC, registered_at ASC
    LIMIT slots_available
  LOOP
    -- ìƒíƒœë¥¼ confirmedë¡œ ë³€ê²½
    UPDATE event_registrations
    SET status = 'confirmed', waitlist_position = NULL
    WHERE id = waitlist_record.id;

    -- ì•Œë¦¼ ìƒì„± (ë¡œê·¸ì¸ ì‚¬ìš©ìë§Œ)
    IF waitlist_record.user_id IS NOT NULL THEN
      INSERT INTO notifications (user_id, type, title, message, related_event_id)
      VALUES (
        waitlist_record.user_id,
        'waitlist_confirmed',
        'ì°¸ê°€ í™•ì •',
        'ëŒ€ê¸° ì¤‘ì´ë˜ ì´ë²¤íŠ¸ì— ì°¸ê°€ê°€ í™•ì •ë˜ì—ˆìŠµë‹ˆë‹¤!',
        p_event_id
      );
    END IF;

    promoted_count := promoted_count + 1;
  END LOOP;

  RETURN promoted_count;
END;
$$ LANGUAGE plpgsql;
</file>

<file path="scripts/070_community_reddit_overhaul.sql">
-- ============================================
-- ì»¤ë®¤ë‹ˆí‹° Reddit ìŠ¤íƒ€ì¼ ëŒ€ê°œí¸ ë§ˆì´ê·¸ë ˆì´ì…˜
-- SFC í”„ë¡œì íŠ¸ìš© (ê¸°ì¡´ communities, community_members í…Œì´ë¸” í™•ì¥)
-- ============================================
--
-- ì‚¬ì „ ì¡°ê±´:
-- - 031_create_communities.sqlì´ ì´ë¯¸ ì‹¤í–‰ë˜ì–´ ìˆì–´ì•¼ í•¨
-- - communities, community_members í…Œì´ë¸”ì´ ì¡´ì¬í•´ì•¼ í•¨
--
-- ë³€ê²½ ì‚¬í•­:
-- 1. communities í…Œì´ë¸”ì— rules, join_type, slug ì»¬ëŸ¼ ì¶”ê°€
-- 2. community_join_requests í…Œì´ë¸” ìƒì„± (ìŠ¹ì¸ì œ ê°€ì…)
-- 3. ì¸ë±ìŠ¤ ì¶”ê°€
-- 4. vangol, hightalk ë³´ë“œë¥¼ ì»¤ë®¤ë‹ˆí‹°ë¡œ ì—°ë™

-- ============================================
-- 1. communities í…Œì´ë¸” í™•ì¥
-- ============================================

-- 1.1 rules ì»¬ëŸ¼ ì¶”ê°€ (ì»¤ë®¤ë‹ˆí‹° ì´ìš©ìˆ˜ì¹™)
ALTER TABLE public.communities
ADD COLUMN IF NOT EXISTS rules TEXT;

-- 1.2 join_type ì»¬ëŸ¼ ì¶”ê°€ (ê°€ì… ë°©ì‹: free, approval, invite)
DO $$
BEGIN
  IF NOT EXISTS (
    SELECT 1 FROM information_schema.columns
    WHERE table_schema = 'public'
    AND table_name = 'communities'
    AND column_name = 'join_type'
  ) THEN
    ALTER TABLE public.communities
    ADD COLUMN join_type TEXT DEFAULT 'free'
    CHECK (join_type IN ('free', 'approval', 'invite'));
  END IF;
END $$;

-- 1.3 slug ì»¬ëŸ¼ ì¶”ê°€ (URLìš©)
ALTER TABLE public.communities
ADD COLUMN IF NOT EXISTS slug TEXT UNIQUE;

-- ê¸°ì¡´ ì»¤ë®¤ë‹ˆí‹°ì— slug ìƒì„± (name ê¸°ë°˜, íŠ¹ìˆ˜ë¬¸ì ì œê±°)
UPDATE public.communities
SET slug = LOWER(REGEXP_REPLACE(REPLACE(name, ' ', '-'), '[^a-z0-9ê°€-í£-]', '', 'g'))
WHERE slug IS NULL;

-- ============================================
-- 2. community_join_requests í…Œì´ë¸” ìƒì„± (ìŠ¹ì¸ì œ ê°€ì…)
-- ============================================

CREATE TABLE IF NOT EXISTS public.community_join_requests (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  community_id UUID REFERENCES public.communities(id) ON DELETE CASCADE NOT NULL,
  user_id UUID REFERENCES public.profiles(id) ON DELETE CASCADE NOT NULL,
  status TEXT DEFAULT 'pending' CHECK (status IN ('pending', 'approved', 'rejected')),
  message TEXT,  -- ê°€ì… ì‹ ì²­ ë©”ì‹œì§€
  created_at TIMESTAMPTZ DEFAULT NOW() NOT NULL,
  reviewed_at TIMESTAMPTZ,
  reviewed_by UUID REFERENCES public.profiles(id),
  rejection_reason TEXT,  -- ê±°ì ˆ ì‚¬ìœ 
  UNIQUE(community_id, user_id)
);

-- RLS í™œì„±í™”
ALTER TABLE public.community_join_requests ENABLE ROW LEVEL SECURITY;

-- 2.1 ë³¸ì¸ì˜ ê°€ì… ì‹ ì²­ ë˜ëŠ” ìš´ì˜ìê°€ ì¡°íšŒ ê°€ëŠ¥
DROP POLICY IF EXISTS "Users can view own join requests" ON public.community_join_requests;
CREATE POLICY "Users can view own join requests"
  ON public.community_join_requests
  FOR SELECT
  USING (
    auth.uid() = user_id OR
    EXISTS (
      SELECT 1 FROM public.communities c
      WHERE c.id = community_join_requests.community_id
      AND (
        c.created_by = auth.uid() OR
        EXISTS (
          SELECT 1 FROM public.community_members cm
          WHERE cm.community_id = c.id
          AND cm.user_id = auth.uid()
          AND cm.role IN ('owner', 'admin')
        )
      )
    )
  );

-- 2.2 ë¡œê·¸ì¸í•œ ì‚¬ìš©ìê°€ ê°€ì… ì‹ ì²­ ê°€ëŠ¥
DROP POLICY IF EXISTS "Authenticated users can create join requests" ON public.community_join_requests;
CREATE POLICY "Authenticated users can create join requests"
  ON public.community_join_requests
  FOR INSERT
  WITH CHECK (auth.uid() = user_id);

-- 2.3 ì»¤ë®¤ë‹ˆí‹° ìš´ì˜ìë§Œ ê°€ì… ì‹ ì²­ ìƒíƒœ ë³€ê²½ ê°€ëŠ¥
DROP POLICY IF EXISTS "Community admins can update join requests" ON public.community_join_requests;
CREATE POLICY "Community admins can update join requests"
  ON public.community_join_requests
  FOR UPDATE
  USING (
    EXISTS (
      SELECT 1 FROM public.communities c
      WHERE c.id = community_join_requests.community_id
      AND (
        c.created_by = auth.uid() OR
        EXISTS (
          SELECT 1 FROM public.community_members cm
          WHERE cm.community_id = c.id
          AND cm.user_id = auth.uid()
          AND cm.role IN ('owner', 'admin')
        )
      )
    )
  );

-- 2.4 ë³¸ì¸ì´ ê°€ì… ì‹ ì²­ ì·¨ì†Œ ê°€ëŠ¥
DROP POLICY IF EXISTS "Users can delete own pending requests" ON public.community_join_requests;
CREATE POLICY "Users can delete own pending requests"
  ON public.community_join_requests
  FOR DELETE
  USING (auth.uid() = user_id AND status = 'pending');

-- ============================================
-- 3. ì¸ë±ìŠ¤ ì¶”ê°€
-- ============================================

CREATE INDEX IF NOT EXISTS idx_community_join_requests_community_id
  ON public.community_join_requests(community_id);
CREATE INDEX IF NOT EXISTS idx_community_join_requests_user_id
  ON public.community_join_requests(user_id);
CREATE INDEX IF NOT EXISTS idx_community_join_requests_status
  ON public.community_join_requests(status);
CREATE INDEX IF NOT EXISTS idx_communities_slug
  ON public.communities(slug);
CREATE INDEX IF NOT EXISTS idx_communities_is_private
  ON public.communities(is_private);

-- ============================================
-- 4. ê¸°ì¡´ board_categoriesì˜ vangol, hightalkë¥¼ communitiesì™€ ì—°ë™
-- ============================================

DO $$
DECLARE
  master_id UUID;
BEGIN
  -- master ì—­í• ì˜ í”„ë¡œí•„ ID ê°€ì ¸ì˜¤ê¸°
  SELECT id INTO master_id FROM public.profiles WHERE role = 'master' LIMIT 1;

  -- masterê°€ ì—†ìœ¼ë©´ ìŠ¤í‚µ
  IF master_id IS NULL THEN
    RAISE NOTICE 'No master user found, skipping community creation';
    RETURN;
  END IF;

  -- vangol ì»¤ë®¤ë‹ˆí‹°ê°€ ì—†ìœ¼ë©´ ìƒì„±
  IF NOT EXISTS (SELECT 1 FROM public.communities WHERE slug = 'vangol') THEN
    INSERT INTO public.communities (name, description, slug, is_private, join_type, created_by)
    SELECT
      bc.name,
      bc.description,
      bc.slug,
      false,
      'free',
      master_id
    FROM public.board_categories bc
    WHERE bc.slug = 'vangol';

    RAISE NOTICE 'Created vangol community';
  END IF;

  -- hightalk ì»¤ë®¤ë‹ˆí‹°ê°€ ì—†ìœ¼ë©´ ìƒì„±
  IF NOT EXISTS (SELECT 1 FROM public.communities WHERE slug = 'hightalk') THEN
    INSERT INTO public.communities (name, description, slug, is_private, join_type, created_by)
    SELECT
      bc.name,
      bc.description,
      bc.slug,
      false,
      'free',
      master_id
    FROM public.board_categories bc
    WHERE bc.slug = 'hightalk';

    RAISE NOTICE 'Created hightalk community';
  END IF;

  -- í•´ë‹¹ ë³´ë“œì˜ postsì— community_id ë§¤í•‘ (ì•„ì§ ë§¤í•‘ ì•ˆëœ ê²ƒë§Œ)
  UPDATE public.posts p
  SET community_id = c.id
  FROM public.communities c, public.board_categories bc
  WHERE p.board_category_id = bc.id
    AND bc.slug IN ('vangol', 'hightalk')
    AND c.slug = bc.slug
    AND p.community_id IS NULL;

  RAISE NOTICE 'Posts migration completed';
END $$;

-- ============================================
-- 5. ì½”ë©˜íŠ¸ ì¶”ê°€ (ë¬¸ì„œí™”)
-- ============================================

COMMENT ON TABLE public.community_join_requests IS 'ì»¤ë®¤ë‹ˆí‹° ê°€ì… ì‹ ì²­ í…Œì´ë¸” (ìŠ¹ì¸ì œ ê°€ì… ì§€ì›)';
COMMENT ON COLUMN public.communities.rules IS 'ì»¤ë®¤ë‹ˆí‹° ì´ìš©ìˆ˜ì¹™';
COMMENT ON COLUMN public.communities.join_type IS 'ê°€ì… ë°©ì‹: free(ììœ ê°€ì…), approval(ìŠ¹ì¸ì œ), invite(ì´ˆëŒ€ì œ)';
COMMENT ON COLUMN public.communities.slug IS 'URLìš© ìŠ¬ëŸ¬ê·¸';

-- ============================================
-- ì™„ë£Œ!
-- ============================================
</file>

<file path="scripts/071_disable_event_requests.sql">
-- event-requests ê²Œì‹œíŒ ë¹„í™œì„±í™”
UPDATE public.board_categories
SET is_active = false
WHERE slug = 'event-requests';
</file>

<file path="scripts/073_set_communities_public.sql">
-- ============================================
-- ë°˜ê³¨, í•˜ì´í† í¬ ì»¤ë®¤ë‹ˆí‹° ê³µê°œ ì„¤ì •
-- ============================================

-- vangol, hightalk ì»¤ë®¤ë‹ˆí‹°ë¥¼ ê³µê°œë¡œ ë³€ê²½
UPDATE public.communities
SET is_private = false
WHERE slug IN ('vangol', 'hightalk');

-- í™•ì¸
SELECT id, name, slug, is_private
FROM public.communities
WHERE slug IN ('vangol', 'hightalk');
</file>

<file path="scripts/074_fix_community_delete_rls.sql">
-- ì»¤ë®¤ë‹ˆí‹° ì‚­ì œ RLS ì •ì±… ìˆ˜ì •
-- ë¬¸ì œ: master ì—­í• ì´ ì»¤ë®¤ë‹ˆí‹°ë¥¼ ì‚­ì œí•  ìˆ˜ ì—†ìŒ
-- í•´ê²°: master ì—­í• ë„ ì‚­ì œ ê°€ëŠ¥í•˜ë„ë¡ ì •ì±… ìˆ˜ì •

-- 1. communities í…Œì´ë¸”ì˜ DELETE ì •ì±… ìˆ˜ì •
-- ê¸°ì¡´: ì†Œìœ ì(created_by)ë§Œ ì‚­ì œ ê°€ëŠ¥
-- ìˆ˜ì •: ì†Œìœ ì + master ì—­í• ë„ ì‚­ì œ ê°€ëŠ¥
DROP POLICY IF EXISTS "Community owners can delete" ON public.communities;
CREATE POLICY "Community owners and masters can delete"
  ON public.communities
  FOR DELETE
  USING (
    created_by = auth.uid()
    OR EXISTS (
      SELECT 1 FROM public.profiles
      WHERE profiles.id = auth.uid()
      AND profiles.role = 'master'
    )
    OR EXISTS (
      SELECT 1 FROM public.community_members
      WHERE community_members.community_id = communities.id
      AND community_members.user_id = auth.uid()
      AND community_members.role = 'owner'
    )
  );

-- 2. community_members í…Œì´ë¸”ì˜ DELETE ì •ì±… ìˆ˜ì •
-- master ì—­í• ë„ ë©¤ë²„ ì‚­ì œ ê°€ëŠ¥í•˜ë„ë¡ ì¶”ê°€
DROP POLICY IF EXISTS "Users can leave or be removed from communities" ON public.community_members;
CREATE POLICY "Users can leave or be removed from communities"
  ON public.community_members
  FOR DELETE
  USING (
    auth.uid() = user_id
    OR EXISTS (
      SELECT 1 FROM public.profiles
      WHERE profiles.id = auth.uid()
      AND profiles.role = 'master'
    )
    OR EXISTS (
      SELECT 1 FROM public.community_members cm
      JOIN public.communities c ON c.id = cm.community_id
      WHERE cm.community_id = community_members.community_id
      AND cm.user_id = auth.uid()
      AND (cm.role IN ('owner', 'admin') OR c.created_by = auth.uid())
    )
  );

-- 3. board_categories í…Œì´ë¸”ì˜ DELETE ì •ì±… í™•ì¸/ì¶”ê°€
-- master ë° adminì´ ì‚­ì œ ê°€ëŠ¥í•˜ë„ë¡
DROP POLICY IF EXISTS "Admins can delete board categories" ON public.board_categories;
CREATE POLICY "Admins can delete board categories"
  ON public.board_categories
  FOR DELETE
  USING (
    EXISTS (
      SELECT 1 FROM public.profiles
      WHERE profiles.id = auth.uid()
      AND profiles.role IN ('master', 'admin')
    )
  );

-- 4. posts í…Œì´ë¸”ì˜ DELETE ì •ì±…ì— master ì¶”ê°€ í™•ì¸
-- (ì´ë¯¸ ìˆì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì¡°ê±´ë¶€)
DO $$
BEGIN
  -- posts DELETE ì •ì±…ì´ masterë¥¼ í¬í•¨í•˜ëŠ”ì§€ í™•ì¸í•˜ê³  ì—†ìœ¼ë©´ ì¶”ê°€
  IF NOT EXISTS (
    SELECT 1 FROM pg_policies
    WHERE tablename = 'posts'
    AND policyname LIKE '%master%delete%'
  ) THEN
    -- ê¸°ì¡´ ì •ì±…ì„ ìœ ì§€í•˜ë©´ì„œ master ê¶Œí•œ í™•ì¸ì„ ìœ„í•œ ë¡œê·¸ë§Œ ë‚¨ê¹€
    RAISE NOTICE 'posts í…Œì´ë¸”ì˜ DELETE ì •ì±…ì— master ê¶Œí•œì´ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.';
  END IF;
END $$;
</file>

<file path="scripts/075_add_community_banner.sql">
-- ì»¤ë®¤ë‹ˆí‹° ë°°ë„ˆ ì´ë¯¸ì§€ URL ì»¬ëŸ¼ ì¶”ê°€
-- Reddit ìŠ¤íƒ€ì¼ ìƒë‹¨ ë°°ë„ˆë¥¼ ìœ„í•œ ìŠ¤í‚¤ë§ˆ ë³€ê²½

-- 1. banner_url ì»¬ëŸ¼ ì¶”ê°€
ALTER TABLE public.communities
ADD COLUMN IF NOT EXISTS banner_url TEXT;

-- 2. ì»¬ëŸ¼ ì„¤ëª… ì¶”ê°€
COMMENT ON COLUMN public.communities.banner_url IS 'Unsplash ë˜ëŠ” ì»¤ìŠ¤í…€ ë°°ë„ˆ ì´ë¯¸ì§€ URL (ê¶Œì¥ í¬ê¸°: 1200x300px)';

-- 3. ê¸°ì¡´ ì»¤ë®¤ë‹ˆí‹°ì— ê¸°ë³¸ ë°°ë„ˆ ì´ë¯¸ì§€ ì„¤ì • (ì„ íƒì‚¬í•­)
-- ê° ì»¤ë®¤ë‹ˆí‹° í…Œë§ˆì— ë§ëŠ” Unsplash ì´ë¯¸ì§€ë¥¼ ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì •í•  ìˆ˜ ìˆìŒ
-- UPDATE public.communities SET banner_url = 'https://images.unsplash.com/...' WHERE banner_url IS NULL;
</file>

<file path="supabase/.temp/cli-latest">
v2.67.1
</file>

<file path="supabase/.temp/gotrue-version">
v2.184.1
</file>

<file path="supabase/.temp/pooler-url">
postgresql://postgres.yzmapsgsxgjxxtaqhelu@aws-1-ap-northeast-2.pooler.supabase.com:5432/postgres
</file>

<file path="supabase/.temp/postgres-version">
17.6.1.044
</file>

<file path="supabase/.temp/project-ref">
yzmapsgsxgjxxtaqhelu
</file>

<file path="supabase/.temp/rest-version">
v13.0.5
</file>

<file path="supabase/.temp/storage-migration">
buckets-objects-grants-postgres
</file>

<file path="supabase/.temp/storage-version">
v1.33.0
</file>

<file path="app/community/profile/page.tsx">
"use client"

import dynamic from "next/dynamic"
import { Loader2 } from "lucide-react"
import { useEffect, useState } from "react"

// SSR ì™„ì „ ë¹„í™œì„±í™” - hydration ì—ëŸ¬ ë°©ì§€
const ProfileContent = dynamic(() => import("./ProfileContent"), {
  ssr: false,
  loading: () => (
    <div className="flex min-h-[calc(100vh-4rem)] items-center justify-center bg-slate-50">
      <Loader2 className="h-8 w-8 text-indigo-600 animate-spin" />
    </div>
  ),
})

export default function ProfilePage() {
  const [mounted, setMounted] = useState(false)

  useEffect(() => {
    setMounted(true)
  }, [])

  if (!mounted) {
    return (
      <div className="flex min-h-[calc(100vh-4rem)] items-center justify-center bg-slate-50">
        <Loader2 className="h-8 w-8 text-indigo-600 animate-spin" />
      </div>
    )
  }

  return <ProfileContent />
}
</file>

<file path="app/e/[id]/edit/page.tsx">
import { createClient } from "@/lib/supabase/server"
import { redirect, notFound } from "next/navigation"
import { requireAuth } from "@/lib/auth/server"
import { NewEventForm } from "@/components/new-event-form"

export default async function EditEventPage({
  params,
}: {
  params: Promise<{ id: string }>
}) {
  const { id } = await params
  const { user, supabase } = await requireAuth()

  // ì´ë²¤íŠ¸ ì •ë³´ ì¡°íšŒ
  const { data: event, error } = await supabase
    .from("events")
    .select("id, title, description, event_date, end_date, location, price, max_participants, thumbnail_url, event_type, created_by")
    .eq("id", id)
    .single()

  if (error || !event) {
    notFound()
  }

  // ì‘ì„±ì í™•ì¸ (ë³¸ì¸ì´ ì•„ë‹ˆë©´ í™ˆìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸)
  if (event.created_by !== user.id) {
    redirect("/")
  }

  // ì°¸ê°€ì ì§ˆë¬¸(ì»¤ìŠ¤í…€ í•„ë“œ) ì¡°íšŒ
  const { data: customFieldsData } = await supabase
    .from("event_registration_fields")
    .select("id, field_name, field_type, field_options, is_required, order_index")
    .eq("event_id", id)
    .order("order_index", { ascending: true })

  // ì§ˆë¬¸ ë°ì´í„°ë¥¼ í¼ í¬ë§·ìœ¼ë¡œ ë³€í™˜
  const customFields = (customFieldsData || []).map((field) => {
    let options: string[] = []
    if (field.field_options) {
      if (Array.isArray(field.field_options)) {
        options = field.field_options
      } else if (typeof field.field_options === 'string') {
        try {
          options = JSON.parse(field.field_options)
        } catch (e) {
          console.error('Failed to parse field_options:', e)
        }
      }
    }

    return {
      id: field.id,
      label: field.field_name,
      type: field.field_type as 'text' | 'select',
      options: options,
      required: field.is_required || false,
    }
  })

  // ì´ˆê¸° ë°ì´í„° ì¤€ë¹„
  const initialData = {
    id: event.id,
    title: event.title,
    description: event.description || "",
    event_date: event.event_date,
    end_date: event.end_date,
    location: event.location,
    price: event.price,
    max_participants: event.max_participants,
    thumbnail_url: event.thumbnail_url,
    event_type: event.event_type,
    customFields: customFields,
  }

  return <NewEventForm userId={user.id} initialData={initialData} />
}
</file>

<file path="app/page.tsx">
import type { Metadata } from "next"
import { Suspense } from "react"
import { DashboardLayout } from "@/components/dashboard-layout"
import { StandardRightSidebar } from "@/components/standard-right-sidebar"
import { SiteHeader } from "@/components/site-header"
import { ThreeColumnLayout } from "@/components/layout/three-column-layout"
import { MobileHeader } from "@/components/mobile-header"
import { HeroSectionContainer } from "@/components/home/hero-section-container"
import { EventsSectionContainer } from "@/components/home/events-section-container"
import { FeedSectionContainer } from "@/components/home/feed-section-container"
import { EventsSkeleton, FeedSkeleton } from "@/components/skeletons"
import { getCachedUserProfile } from "@/lib/queries/cached"

// ISR: 60ì´ˆë§ˆë‹¤ ë°±ê·¸ë¼ìš´ë“œ ì¬ìƒì„± (Cold Start í•´ê²°)
export const revalidate = 60

export const metadata: Metadata = {
  title: "Seoul Founders Club",
  description: "ì„œìš¸ íŒŒìš´ë”ìŠ¤ í´ëŸ½",
  openGraph: {
    title: "Seoul Founders Club",
    description: "ì„œìš¸ íŒŒìš´ë”ìŠ¤ í´ëŸ½",
    url: "https://seoulfounders.club",
    siteName: "Seoul Founders Club",
    images: [
      {
        url: "https://seoulfounders.club/images/logo-circle.png",
        width: 1200,
        height: 630,
        alt: "Seoul Founders Club",
      },
    ],
    locale: "ko_KR",
    type: "website",
  },
  twitter: {
    card: "summary_large_image",
    title: "Seoul Founders Club",
    description: "ì„œìš¸ íŒŒìš´ë”ìŠ¤ í´ëŸ½",
    images: ["https://seoulfounders.club/images/logo-circle.png"],
  },
}

export default async function HomePage() {
  const userProfile = await getCachedUserProfile()
  const userRole = userProfile?.profile?.role ?? null

  return (
    <DashboardLayout
      header={<SiteHeader />}
      userRole={userRole}
      mobileHeader={<MobileHeader userRole={userRole} />}
    >
      <ThreeColumnLayout rightSidebar={<StandardRightSidebar />}>
        <div className="flex flex-col gap-10 w-full">
          <HeroSectionContainer />

          <Suspense fallback={<EventsSkeleton />}>
            <EventsSectionContainer />
          </Suspense>

          <div className="h-px bg-slate-200" />

          <Suspense fallback={<FeedSkeleton />}>
            <FeedSectionContainer />
          </Suspense>
        </div>
      </ThreeColumnLayout>
    </DashboardLayout>
  )
}
</file>

<file path="components/community/community-mobile-bar.tsx">
"use client"

import { useState } from "react"
import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar"
import { Button } from "@/components/ui/button"
import { Badge } from "@/components/ui/badge"
import {
  Users,
  ChevronDown,
  Shield,
  BookOpen,
  Lock,
  UserPlus,
  UserMinus,
  Clock,
} from "lucide-react"
import { cn } from "@/lib/utils"
import { toast } from "@/hooks/use-toast"
import { joinCommunity, leaveCommunity } from "@/lib/actions/community"
import { createClient } from "@/lib/supabase/client"

/**
 * CommunityMobileBar - ëª¨ë°”ì¼ ì»¤ë®¤ë‹ˆí‹° ì •ë³´ ë°”
 *
 * xl ë¯¸ë§Œ í™”ë©´ì—ì„œ ì‚¬ì´ë“œë°” ëŒ€ì‹  ìƒë‹¨ì— í‘œì‹œë˜ëŠ” ì ‘ì´ì‹ ë°”
 * - ì ‘íŒ ìƒíƒœ: ì»¤ë®¤ë‹ˆí‹° ì´ë¦„ + ë©¤ë²„ ìˆ˜ + í™•ì¥ ë²„íŠ¼
 * - í¼ì¹œ ìƒíƒœ: ì†Œê°œê¸€, ê·œì¹™, ìš´ì˜ì, ê°€ì… ë²„íŠ¼
 */

interface CommunityMobileBarProps {
  community: {
    id: string
    name: string
    description: string | null
    rules: string | null
    thumbnail_url: string | null
    is_private: boolean
    join_type: "free" | "approval" | "invite"
    member_count: number
    moderators: Array<{
      id: string
      full_name: string | null
      avatar_url: string | null
      role: string
    }>
  }
  membershipStatus: "none" | "member" | "pending" | "admin" | "owner"
  currentUserId: string | null
  onMembershipChange?: () => void
}

export function CommunityMobileBar({
  community,
  membershipStatus: initialStatus,
  currentUserId,
  onMembershipChange,
}: CommunityMobileBarProps) {
  const [expanded, setExpanded] = useState(false)
  const [membershipStatus, setMembershipStatus] = useState(initialStatus)
  const [isJoining, setIsJoining] = useState(false)
  const supabase = createClient()

  async function handleJoin() {
    if (!currentUserId) {
      toast({ description: "ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.", variant: "destructive" })
      return
    }

    setIsJoining(true)
    try {
      if (community.join_type === "approval") {
        // ìŠ¹ì¸ì œ: ê°€ì… ì‹ ì²­
        const { error } = await supabase
          .from("community_join_requests")
          .insert({
            community_id: community.id,
            user_id: currentUserId,
          })

        if (error) throw error

        setMembershipStatus("pending")
        toast({ description: "ê°€ì… ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤." })
      } else {
        // ììœ  ê°€ì…
        const result = await joinCommunity(community.id)
        if (result.error) throw new Error(result.error)

        setMembershipStatus("member")
        toast({ description: "ì»¤ë®¤ë‹ˆí‹°ì— ê°€ì…ë˜ì—ˆìŠµë‹ˆë‹¤!" })
      }
      onMembershipChange?.()
    } catch (error: any) {
      toast({
        title: "ê°€ì… ì‹¤íŒ¨",
        description: error.message || "ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.",
        variant: "destructive",
      })
    } finally {
      setIsJoining(false)
    }
  }

  async function handleLeave() {
    setIsJoining(true)
    try {
      const result = await leaveCommunity(community.id)
      if (result.error) throw new Error(result.error)

      setMembershipStatus("none")
      toast({ description: "ì»¤ë®¤ë‹ˆí‹°ì—ì„œ íƒˆí‡´í–ˆìŠµë‹ˆë‹¤." })
      onMembershipChange?.()
    } catch (error: any) {
      toast({
        title: "íƒˆí‡´ ì‹¤íŒ¨",
        description: error.message || "ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.",
        variant: "destructive",
      })
    } finally {
      setIsJoining(false)
    }
  }

  return (
    <div className="lg:hidden sticky top-14 z-30 bg-white border-b border-slate-200 shadow-sm">
      {/* ì ‘íŒ ìƒíƒœ - í•­ìƒ í‘œì‹œ */}
      <button
        onClick={() => setExpanded(!expanded)}
        className="w-full flex items-center justify-between p-3 hover:bg-slate-50 transition-colors"
      >
        <div className="flex items-center gap-3">
          {community.thumbnail_url ? (
            <Avatar className="h-8 w-8">
              <AvatarImage src={community.thumbnail_url} />
              <AvatarFallback className="text-xs">
                {community.name.charAt(0)}
              </AvatarFallback>
            </Avatar>
          ) : (
            <div className="h-8 w-8 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-white font-bold text-sm">
              {community.name.charAt(0)}
            </div>
          )}
          <div className="text-left">
            <div className="flex items-center gap-2">
              <span className="font-bold text-sm text-slate-900">
                {community.name}
              </span>
              {community.is_private && (
                <Lock className="h-3 w-3 text-slate-400" />
              )}
            </div>
            <div className="flex items-center gap-1 text-xs text-slate-500">
              <Users className="h-3 w-3" />
              <span>{community.member_count} members</span>
            </div>
          </div>
        </div>
        <ChevronDown
          className={cn(
            "h-5 w-5 text-slate-400 transition-transform duration-200",
            expanded && "rotate-180"
          )}
        />
      </button>

      {/* í¼ì¹œ ìƒíƒœ */}
      <div
        className={cn(
          "overflow-hidden transition-all duration-300 ease-in-out",
          expanded ? "max-h-[500px] opacity-100" : "max-h-0 opacity-0"
        )}
      >
        <div className="px-4 pb-4 space-y-4 border-t border-slate-100 bg-slate-50">
          {/* ì†Œê°œê¸€ */}
          {community.description && (
            <div className="pt-3">
              <p className="text-sm text-slate-600 leading-relaxed">
                {community.description}
              </p>
            </div>
          )}

          {/* ì´ìš©ìˆ˜ì¹™ */}
          {community.rules && (
            <div>
              <div className="flex items-center gap-2 text-xs font-medium text-slate-500 mb-2">
                <BookOpen className="h-3 w-3" />
                <span>ì´ìš©ìˆ˜ì¹™</span>
              </div>
              <div className="text-xs text-slate-600 bg-white rounded-lg p-3 whitespace-pre-wrap max-h-32 overflow-y-auto">
                {community.rules}
              </div>
            </div>
          )}

          {/* ìš´ì˜ì */}
          {community.moderators.length > 0 && (
            <div>
              <div className="flex items-center gap-2 text-xs font-medium text-slate-500 mb-2">
                <Shield className="h-3 w-3" />
                <span>ìš´ì˜ì</span>
              </div>
              <div className="flex gap-2 flex-wrap">
                {community.moderators.map((mod) => (
                  <div
                    key={mod.id}
                    className="flex items-center gap-1.5 bg-white rounded-full px-2 py-1"
                  >
                    <Avatar className="h-5 w-5">
                      <AvatarImage src={mod.avatar_url || undefined} />
                      <AvatarFallback className="text-[10px]">
                        {mod.full_name?.charAt(0) || "?"}
                      </AvatarFallback>
                    </Avatar>
                    <span className="text-xs text-slate-700">
                      {mod.full_name || "ìµëª…"}
                    </span>
                    {mod.role === "owner" && (
                      <Badge variant="secondary" className="text-[8px] px-1 py-0">
                        ë¦¬ë”
                      </Badge>
                    )}
                  </div>
                ))}
              </div>
            </div>
          )}

          {/* ê°€ì… ë²„íŠ¼ */}
          {currentUserId && membershipStatus !== "owner" && membershipStatus !== "admin" && (
            <div className="pt-2">
              {membershipStatus === "none" && (
                <Button
                  size="sm"
                  className="w-full"
                  onClick={handleJoin}
                  disabled={isJoining}
                >
                  <UserPlus className="h-4 w-4 mr-2" />
                  {community.join_type === "approval" ? "ê°€ì… ì‹ ì²­" : "ê°€ì…í•˜ê¸°"}
                </Button>
              )}
              {membershipStatus === "pending" && (
                <Button size="sm" className="w-full" variant="secondary" disabled>
                  <Clock className="h-4 w-4 mr-2" />
                  ìŠ¹ì¸ ëŒ€ê¸°ì¤‘
                </Button>
              )}
              {membershipStatus === "member" && (
                <Button
                  size="sm"
                  className="w-full"
                  variant="outline"
                  onClick={handleLeave}
                  disabled={isJoining}
                >
                  <UserMinus className="h-4 w-4 mr-2" />
                  íƒˆí‡´í•˜ê¸°
                </Button>
              )}
            </div>
          )}
        </div>
      </div>
    </div>
  )
}
</file>

<file path="components/home/feed-section.tsx">
"use client"

import { useEffect, useMemo, useRef, useState } from "react"
import { useInfiniteQuery } from "@tanstack/react-query"
import { Tabs, TabsList, TabsTrigger } from "@/components/ui/tabs"
import { FeedPostCard } from "@/components/ui/feed-post-card"
import { fetchFeedPosts } from "@/lib/actions/feed"
import type { PostForDisplay } from "@/lib/types/posts"

type SortOption = "latest" | "popular"

type FeedSectionProps = {
  initialPosts: PostForDisplay[]
}

export function FeedSection({ initialPosts }: FeedSectionProps) {
  const PAGE_SIZE = 10
  const [sort, setSort] = useState<SortOption>("latest")
  const loadMoreRef = useRef<HTMLDivElement | null>(null)

  const initialData = useMemo(() => {
    return {
      pages: [initialPosts],
      pageParams: [1],
    }
  }, [initialPosts])

  const {
    data,
    fetchNextPage,
    hasNextPage,
    isFetchingNextPage,
    isLoading,
    refetch,
  } = useInfiniteQuery<PostForDisplay[]>({
    queryKey: ["feed", sort],
    queryFn: async ({ pageParam = 1 }) => fetchFeedPosts(pageParam as number, sort),
    getNextPageParam: (lastPage, pages) => (lastPage.length < PAGE_SIZE ? undefined : pages.length + 1),
    initialData,
    initialPageParam: 1,
    refetchOnWindowFocus: false,
  })

  useEffect(() => {
    const node = loadMoreRef.current
    if (!node) return
    const observer = new IntersectionObserver(
      (entries) => {
        if (entries[0].isIntersecting && hasNextPage && !isFetchingNextPage) {
          fetchNextPage()
        }
      },
      { rootMargin: "200px" }
    )
    observer.observe(node)
    return () => observer.disconnect()
  }, [fetchNextPage, hasNextPage, isFetchingNextPage])

  const posts = data?.pages.flat() ?? []

  return (
    <section className="space-y-4 w-full">
      <Tabs value={sort} onValueChange={(v) => setSort(v as SortOption)} className="w-full">
        <TabsList>
          <TabsTrigger value="latest">ìµœì‹ </TabsTrigger>
          <TabsTrigger value="popular">ì¸ê¸°</TabsTrigger>
        </TabsList>
      </Tabs>

      <div className="border border-slate-200 rounded-lg bg-white overflow-hidden">
        <div className="flex flex-col">
          {isLoading && posts.length === 0 ? (
            [...Array(3)].map((_, i) => (
              <div key={i} className="h-24 border-b border-slate-200 last:border-b-0" />
            ))
          ) : (
            posts.map((post, index) => (
              <FeedPostCard
                key={post.id}
                postId={post.id}
                href={`/community/board/${post.board_categories?.slug ?? "community"}/${post.id}`}
                source={{
                  name: post.board_categories?.name ?? "ì»¤ë®¤ë‹ˆí‹°",
                  href: `/community/board/${post.board_categories?.slug ?? "community"}`,
                }}
                createdAt={post.created_at}
                title={post.title}
                content={post.content ?? undefined}
                contentRaw={(post as any).content ?? undefined}
                thumbnailUrl={post.thumbnail_url ?? undefined}
                commentsCount={post.comments_count ?? 0}
                isLast={index === posts.length - 1}
              />
            ))
          )}
        </div>
      </div>

      <div ref={loadMoreRef} className="h-10" aria-hidden />
      {isFetchingNextPage && <div className="text-xs text-slate-500">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>}
    </section>
  )
}
</file>

<file path="components/home/home-page-client.tsx">
"use client"

import { useEffect, useMemo, useState, useRef, useCallback, ReactNode, Suspense } from "react"
import { useRouter } from "next/navigation"
import { X } from "lucide-react"

import { DashboardLayout } from "@/components/dashboard-layout"
import { NewEventForm } from "@/components/new-event-form"
import { createClient } from "@/lib/supabase/client"
import { Button } from "@/components/ui/button"
import { Sheet, SheetClose, SheetContent, SheetHeader, SheetTitle } from "@/components/ui/sheet"
import { HeroSection } from "@/components/home/hero-section"
import { EventsSection } from "@/components/home/events-section"
import { PostsSection } from "@/components/home/posts-section"
import { ReviewsSection } from "@/components/home/reviews-section"
import { StandardRightSidebar } from "@/components/standard-right-sidebar"
import { EventCardEvent } from "@/components/ui/event-card"
import { getLatestPosts, getLatestReviews } from "@/lib/queries/posts"
import { getCurrentUserProfile } from "@/lib/queries/profiles"
import { getBadgesForUsers } from "@/lib/queries/badges"
import type { PostForDisplay, ReviewForDisplay, BoardCategory } from "@/lib/types/posts"
import type { User, Profile } from "@/lib/types/profile"
import type { VisibleBadge } from "@/lib/types/badges"

type Post = PostForDisplay & {
  visible_badges?: VisibleBadge[]
}

type HomePageClientProps = {
  children?: ReactNode
  sidebarProfile?: ReactNode
  initialEvents?: EventCardEvent[]
  initialPosts?: Post[]
  initialReviews?: ReviewForDisplay[]
  initialBoardCategories?: BoardCategory[]
  initialUser?: User | null
  initialProfile?: Profile | null
}

export function HomePageClient({
  children,
  sidebarProfile,
  initialEvents = [],
  initialPosts = [],
  initialReviews = [],
  initialBoardCategories = [],
  initialUser = null,
  initialProfile = null,
}: HomePageClientProps) {
  const [selectedBoard, setSelectedBoard] = useState<string>("all")
  const [events, setEvents] = useState<EventCardEvent[]>(initialEvents)
  const [posts, setPosts] = useState<Post[]>(initialPosts)
  const [reviews, setReviews] = useState<ReviewForDisplay[]>(initialReviews)
  const [boardCategories, setBoardCategories] = useState<BoardCategory[]>(initialBoardCategories)
  const [user, setUser] = useState<User | null>(initialUser || null)
  const [profile, setProfile] = useState<Profile | null>(initialProfile || null)
  const userRef = useRef<User | null>(initialUser || null)

  const [showCreateSheet, setShowCreateSheet] = useState(false)
  const [isLoading, setIsLoading] = useState(false)

  const supabase = useMemo(() => createClient(), [])
  const router = useRouter()

  // fetchDataë¥¼ useCallbackìœ¼ë¡œ ê°ì‹¸ì„œ ì¬ì‚¬ìš© ê°€ëŠ¥í•˜ê²Œ í•¨
  const fetchData = useCallback(async () => {
    try {
      setIsLoading(true)
      const { data: { user } } = await supabase.auth.getUser()
      setUser(user)
      userRef.current = user

      // userê°€ ì¡´ì¬í•  ê²½ìš°, profiles í…Œì´ë¸”ì—ì„œ ìµœì‹  í”„ë¡œí•„ ì •ë³´ë¥¼ ê°€ì ¸ì˜´
      const userProfile = await getCurrentUserProfile(supabase)
      if (userProfile) {
        setUser(userProfile.user)
        setProfile(userProfile.profile)
        userRef.current = userProfile.user
      } else {
        setUser(null)
        setProfile(null)
        userRef.current = null
      }

      // ê° ì¿¼ë¦¬ë¥¼ ë…ë¦½ì ìœ¼ë¡œ ì²˜ë¦¬
      let categoriesData: BoardCategory[] = []
      let eventsData: EventCardEvent[] = []
      let postsData: Post[] = []
      let reviewsData: ReviewForDisplay[] = []

      // 1. ì¹´í…Œê³ ë¦¬
      try {
        const { data, error } = await supabase
          .from("board_categories")
          .select("id, name, slug")
          .in("slug", ["free", "vangol", "hightalk", "free-board"])
          .eq("is_active", true)
          .order("order_index", { ascending: true })

        if (!error && data) {
          categoriesData = data.map((cat) => {
            if (cat.slug === "free-board") return { ...cat, slug: "free" }
            return cat
          }) as BoardCategory[]
        }
      } catch (error) {
        console.error('ì¹´í…Œê³ ë¦¬ ë¡œë“œ ì˜¤ë¥˜:', error)
        categoriesData = []
      }

      // 2. ì´ë²¤íŠ¸
      try {
        const { data, error } = await supabase
          .from("events")
          .select(`
            *,
            profiles:created_by (
              id,
              full_name,
              avatar_url,
              bio
            ),
            event_registrations(count)
          `)
          .gte("event_date", new Date().toISOString())
          .order("event_date", { ascending: true })
          .limit(9)

        if (!error && data) {
          eventsData = data.map((event) => ({
            id: event.id,
            title: event.title,
            thumbnail_url: event.thumbnail_url,
            event_date: event.event_date,
            event_time: null,
            location: event.location,
            max_participants: event.max_participants,
            current_participants: event.event_registrations?.[0]?.count || 0,
            host_name: event.profiles?.full_name || "ì•Œ ìˆ˜ ì—†ìŒ",
            host_avatar_url: event.profiles?.avatar_url || null,
            host_bio: event.profiles?.bio || null,
            event_type: event.event_type || 'networking',
          }))
        } else {
          eventsData = []
        }
      } catch (error) {
        console.error('ì´ë²¤íŠ¸ ë¡œë“œ ì˜¤ë¥˜:', error)
        eventsData = []
      }

      // 3. ê²Œì‹œê¸€
      try {
        const { data, error } = await supabase
          .from("posts")
          .select(`
            id, 
            title, 
            content, 
            created_at, 
            author_id,
            profiles:author_id(
              id,
              full_name
            ), 
            board_categories!inner(name, slug)
          `)
          .in("board_categories.slug", ["free", "vangol", "hightalk", "free-board"])
          .neq("board_categories.slug", "announcement")
          .order("created_at", { ascending: false })
          .limit(50)

        if (!error && data) {
          // ë±ƒì§€ ê°€ì ¸ì˜¤ê¸° (ì¬ì‚¬ìš© í•¨ìˆ˜ ì‚¬ìš©)
          const authorIds = [...new Set(data.map((post) => post.author_id).filter(Boolean) as string[])]
          const badgesMap = await getBadgesForUsers(supabase, authorIds)

          postsData = data.map((post) => {
            // ë°°ì—´ì´ë©´ ì²« ë²ˆì§¸ ìš”ì†Œë¥¼, ì•„ë‹ˆë©´ ê·¸ëŒ€ë¡œ ì‚¬ìš©
            const categoryData = Array.isArray(post.board_categories) ? post.board_categories[0] : post.board_categories
            const profileData = Array.isArray(post.profiles) ? post.profiles[0] : post.profiles

            let slug = categoryData?.slug
            if (slug === "free-board") slug = "free"
            const visibleBadges = post.author_id ? (badgesMap.get(post.author_id) || []) : []
            return {
              id: post.id,
              title: post.title,
              content: post.content,
              created_at: post.created_at,
              visibility: 'public' as const,
              likes_count: 0,
              comments_count: 0,
              profiles: profileData ? {
                id: profileData.id,
                full_name: profileData.full_name,
              } : null,
              board_categories: categoryData ? {
                name: categoryData.name,
                slug: slug || categoryData.slug,
              } : null,
              communities: null,
              visible_badges: visibleBadges,
            } as Post
          })
        } else {
          postsData = []
        }
      } catch (error) {
        console.error('ê²Œì‹œê¸€ ë¡œë“œ ì˜¤ë¥˜:', error)
        postsData = []
      }

      // 4. í›„ê¸° (Reviews)
      try {
        const reviewsResult = await getLatestReviews(supabase, 10)
        reviewsData = reviewsResult || []
      } catch (error) {
        console.error('í›„ê¸° ë¡œë“œ ì˜¤ë¥˜:', error)
        reviewsData = []
      }

      // ì¹´í…Œê³ ë¦¬ ì²˜ë¦¬
      setBoardCategories(categoriesData)

      // ì´ë²¤íŠ¸ ì²˜ë¦¬
      setEvents(eventsData)

      // ê²Œì‹œê¸€ ì²˜ë¦¬ (ì´ë¯¸ ë±ƒì§€ê°€ í¬í•¨ëœ ìƒíƒœ)
      setPosts(postsData)

      // í›„ê¸° ì²˜ë¦¬
      setReviews(reviewsData)

    } catch (error) {
      console.error('ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error)
    } finally {
      setIsLoading(false)
    }
  }, [supabase])

  useEffect(() => {
    // ì¸ì¦ ìƒíƒœ ë³€ê²½ ê°ì§€
    const { data: { subscription } } = supabase.auth.onAuthStateChange(async (event, session) => {
      const previousUser = userRef.current
      const currentUser = session?.user ?? null
      userRef.current = currentUser
      setUser(currentUser)

      if (event === 'SIGNED_OUT' || (!currentUser && previousUser)) {
        setUser(null)
        userRef.current = null
        return
      }

      if (event === 'SIGNED_IN' && !previousUser && currentUser) {
        fetchData()
      }
    })

    return () => subscription.unsubscribe()
  }, [supabase, fetchData])

  const handleCreateEvent = () => {
    if (!user) {
      router.push("/auth/login")
      return
    }
    setShowCreateSheet(true)
  }

  const handleLogin = () => {
    router.push("/auth/login")
  }

  return (
    <DashboardLayout
      sidebarProfile={
        sidebarProfile ? (
          <Suspense fallback={<div className="px-4 pb-4 min-h-[140px] flex flex-col justify-center"><div className="h-10 w-full bg-slate-100 rounded-full animate-pulse" /></div>}>
            {sidebarProfile}
          </Suspense>
        ) : undefined
      }
    >
      <div className="w-full grid grid-cols-1 xl:grid-cols-12 gap-8">
        {/* [LEFT] ë©”ì¸ ì½˜í…ì¸  ì˜ì—­ */}
        <div className="xl:col-span-9 flex flex-col gap-6">
          <HeroSection user={user} profile={profile} onLogin={handleLogin} />
          {children && <div>{children}</div>}
          <div id="events-section">
            <EventsSection events={events} onCreateEvent={handleCreateEvent} isLoading={isLoading} />
          </div>
          <div className="mt-12">
            <ReviewsSection reviews={reviews} isLoading={isLoading} />
          </div>
          <div className="mt-12">
            <PostsSection
              posts={posts}
              boardCategories={boardCategories}
              selectedBoard={selectedBoard}
              onBoardChange={setSelectedBoard}
              isLoading={isLoading}
            />
          </div>
        </div>

        {/* [RIGHT] ìš°ì¸¡ ì‚¬ì´ë“œë°” ì˜ì—­ (xl ì´ìƒì—ì„œë§Œ í‘œì‹œ) */}
        <div className="hidden xl:block xl:col-span-3">
          <div className="sticky top-8 flex flex-col gap-6 h-fit">
            <StandardRightSidebar />
          </div>
        </div>
      </div>

      <Sheet open={showCreateSheet} onOpenChange={setShowCreateSheet}>
        <SheetContent side="bottom" className="h-[95vh] p-0 rounded-t-2xl overflow-hidden" hideClose>
          <div className="flex h-full flex-col">
            <SheetHeader className="flex flex-row items-center justify-between border-b px-6 py-4 bg-white z-10">
              <SheetTitle className="text-xl font-bold">ìƒˆ ì´ë²¤íŠ¸</SheetTitle>
              <SheetClose asChild>
                <Button variant="ghost" size="icon" className="rounded-full hover:bg-slate-100">
                  <X className="size-5" />
                </Button>
              </SheetClose>
            </SheetHeader>
            <div className="flex-1 overflow-y-auto bg-slate-50">
              <div className="max-w-5xl mx-auto p-6 md:p-8">
                <NewEventForm
                  userId={user?.id || ""}
                  onSuccess={() => {
                    setShowCreateSheet(false)
                    window.location.reload()
                  }}
                />
              </div>
            </div>
          </div>
        </SheetContent>
      </Sheet>
    </DashboardLayout>
  )
}
</file>

<file path="components/new-event-form.tsx">
"use client"

import { useState, useRef, useEffect } from "react"
import { useRouter } from "next/navigation"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { Label } from "@/components/ui/label"
import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from "@/components/ui/dialog"
import { createClient } from "@/lib/supabase/client"
import { Loader2, ImageIcon, Upload, Search, X, MapPin, Calendar, Users, Clock, Ticket, Plus, Trash2, GripVertical, Target, CheckCircle, AlertTriangle } from "lucide-react"
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select"
import { Checkbox } from "@/components/ui/checkbox"
import { RadioGroup, RadioGroupItem } from "@/components/ui/radio-group"
import { Card, CardContent } from "@/components/ui/card"
import { searchUnsplashImages } from "@/app/actions/unsplash"
import { RichTextEditor } from "@/components/rich-text-editor" // ì—ë””í„° import
import { createEvent, updateEvent } from "@/lib/actions/events" // â˜… ë³´ì•ˆ: ì„œë²„ ì•¡ì…˜ ì‚¬ìš©
import { CompleteEventButton } from "@/components/complete-event-button"
import { DeleteEventButton } from "@/components/delete-event-button"
import { cn } from "@/lib/utils"
import type { UnsplashImage } from "@/lib/types/unsplash"
import { useToast } from "@/hooks/use-toast"
import { useLoadScript, Autocomplete } from "@react-google-maps/api"
import {
  DndContext,
  closestCenter,
  KeyboardSensor,
  PointerSensor,
  useSensor,
  useSensors,
  DragEndEvent,
} from "@dnd-kit/core"
import {
  arrayMove,
  SortableContext,
  sortableKeyboardCoordinates,
  useSortable,
  verticalListSortingStrategy,
} from "@dnd-kit/sortable"
import { CSS } from "@dnd-kit/utilities"

// Google Maps libraries ì„¤ì • (ì»´í¬ë„ŒíŠ¸ ì™¸ë¶€ì— ì •ì  ì„ ì–¸)
const libraries: ("places")[] = ["places"]

// SortableItem ì»´í¬ë„ŒíŠ¸
type CustomField = {
  id: string
  label: string
  type: 'text' | 'select'
  options: string[]
  required: boolean
}

type SortableItemProps = {
  field: CustomField
  index: number
  customFields: CustomField[]
  setCustomFields: (fields: CustomField[]) => void
}

function SortableItem({ field, index, customFields, setCustomFields }: SortableItemProps) {
  const {
    attributes,
    listeners,
    setNodeRef,
    transform,
    transition,
    isDragging,
  } = useSortable({ id: field.id })

  const style = {
    transform: CSS.Transform.toString(transform),
    transition,
    opacity: isDragging ? 0.5 : 1,
  }

  return (
    <div ref={setNodeRef} style={style}>
      <Card className={`border-slate-200 bg-white ${isDragging ? 'shadow-lg' : ''}`}>
        <CardContent className="p-4 space-y-4">
          <div className="flex items-start justify-between gap-4">
            <div className="flex-1 space-y-4">
              {/* ì§ˆë¬¸ ì œëª© */}
              <div>
                <div className="flex items-center gap-2 mb-2">
                  <button
                    type="button"
                    {...attributes}
                    {...listeners}
                    className="cursor-grab active:cursor-grabbing text-slate-400 hover:text-slate-600 transition-colors p-1 -ml-1"
                    aria-label="ë“œë˜ê·¸í•˜ì—¬ ìˆœì„œ ë³€ê²½"
                  >
                    <GripVertical className="h-5 w-5" />
                  </button>
                  <Label className="text-sm font-semibold text-slate-700">
                    ì§ˆë¬¸ ì œëª©
                  </Label>
                </div>
                <Input
                  placeholder="ì˜ˆ: ì°¸ê°€ ë™ê¸°, í‹°ì…”ì¸  ì‚¬ì´ì¦ˆ ë“±"
                  value={field.label}
                  onChange={(e) => {
                    const updated = [...customFields]
                    updated[index].label = e.target.value
                    setCustomFields(updated)
                  }}
                  className="bg-slate-50"
                />
              </div>

              {/* ë‹µë³€ íƒ€ì… ì„ íƒ */}
              <div>
                <Label className="text-sm font-semibold text-slate-700 mb-2 block">
                  ë‹µë³€ íƒ€ì…
                </Label>
                <Select
                  value={field.type}
                  onValueChange={(value: 'text' | 'select') => {
                    const updated = [...customFields]
                    updated[index].type = value
                    if (value === 'text') {
                      updated[index].options = []
                    } else if (value === 'select' && updated[index].options.length === 0) {
                      updated[index].options = ['']
                    }
                    setCustomFields(updated)
                  }}
                >
                  <SelectTrigger className="bg-slate-50">
                    <SelectValue />
                  </SelectTrigger>
                  <SelectContent className="z-[100]">
                    <SelectItem value="text">ì£¼ê´€ì‹ í…ìŠ¤íŠ¸</SelectItem>
                    <SelectItem value="select">ê°ê´€ì‹ ì„ íƒ</SelectItem>
                  </SelectContent>
                </Select>
              </div>

              {/* ê°ê´€ì‹ ì˜µì…˜ ì¶”ê°€/ì‚­ì œ */}
              {field.type === 'select' && (
                <div>
                  <Label className="text-sm font-semibold text-slate-700 mb-2 block">
                    ì„ íƒì§€
                  </Label>
                  <div className="space-y-2">
                    {field.options.map((option, optIndex) => (
                      <div key={optIndex} className="flex items-center gap-2">
                        <Input
                          placeholder={`ì„ íƒì§€ ${optIndex + 1}`}
                          value={option}
                          onChange={(e) => {
                            const updated = [...customFields]
                            updated[index].options[optIndex] = e.target.value
                            setCustomFields(updated)
                          }}
                          className="bg-slate-50"
                        />
                        <Button
                          type="button"
                          variant="ghost"
                          size="sm"
                          onClick={() => {
                            const updated = [...customFields]
                            updated[index].options = updated[index].options.filter((_, i) => i !== optIndex)
                            setCustomFields(updated)
                          }}
                          className="text-red-600 hover:text-red-700"
                        >
                          <X className="h-4 w-4" />
                        </Button>
                      </div>
                    ))}
                    <Button
                      type="button"
                      variant="outline"
                      size="sm"
                      onClick={() => {
                        const updated = [...customFields]
                        updated[index].options.push('')
                        setCustomFields(updated)
                      }}
                      className="gap-2"
                    >
                      <Plus className="h-4 w-4" />
                      ì„ íƒì§€ ì¶”ê°€
                    </Button>
                  </div>
                </div>
              )}

              {/* í•„ìˆ˜ í•­ëª© ì²´í¬ë°•ìŠ¤ */}
              <div className="flex items-center gap-2">
                <Checkbox
                  id={`required-${field.id}`}
                  checked={field.required}
                  onCheckedChange={(checked) => {
                    const updated = [...customFields]
                    updated[index].required = checked === true
                    setCustomFields(updated)
                  }}
                />
                <Label
                  htmlFor={`required-${field.id}`}
                  className="text-sm text-slate-700 cursor-pointer"
                >
                  í•„ìˆ˜ í•­ëª©
                </Label>
              </div>
            </div>

            {/* ì‚­ì œ ë²„íŠ¼ */}
            <Button
              type="button"
              variant="ghost"
              size="sm"
              onClick={() => {
                setCustomFields(customFields.filter((_, i) => i !== index))
              }}
              className="text-red-600 hover:text-red-700"
            >
              <Trash2 className="h-4 w-4" />
            </Button>
          </div>
        </CardContent>
      </Card>
    </div>
  )
}

type InitialData = {
  id: string
  title: string
  description: string
  event_date: string
  end_date?: string | null
  location?: string | null
  price?: number | null
  max_participants?: number | null
  thumbnail_url?: string | null
  event_type?: 'networking' | 'class' | 'activity' | null
  customFields?: CustomField[]
}

// ë‚ ì§œ/ì‹œê°„ íŒŒì‹± í—¬í¼ í•¨ìˆ˜
const parseDateTime = (dateString?: string | null) => {
  if (!dateString) return { date: "", time: "" }
  const dateObj = new Date(dateString)
  const year = dateObj.getFullYear()
  const month = String(dateObj.getMonth() + 1).padStart(2, "0")
  const day = String(dateObj.getDate()).padStart(2, "0")
  const hours = String(dateObj.getHours()).padStart(2, "0")
  const minutes = String(dateObj.getMinutes()).padStart(2, "0")
  return {
    date: `${year}-${month}-${day}`,
    time: `${hours}:${minutes}`,
  }
}

// ì´ˆê¸°ê°’ ê³„ì‚° í•¨ìˆ˜
const getInitialValues = (initialData?: InitialData) => {
  if (!initialData) {
    // ìƒì„± ëª¨ë“œ: ê¸°ë³¸ê°’ ì„¤ì •
    const now = new Date()
    const year = now.getFullYear()
    const month = String(now.getMonth() + 1).padStart(2, "0")
    const day = String(now.getDate()).padStart(2, "0")
    
    return {
      title: "",
      description: "",
      eventType: "networking" as const,
      startDate: `${year}-${month}-${day}`,
      startTime: "19:00",
      endDate: `${year}-${month}-${day}`,
      endTime: "21:00",
      location: "",
      price: "",
      maxParticipants: "",
      thumbnailUrl: "",
      customFields: [],
      isEndDateManuallyChanged: false,
    }
  }

  // ìˆ˜ì • ëª¨ë“œ: initialDataì—ì„œ ê°’ ì¶”ì¶œ
  const startDateTime = parseDateTime(initialData.event_date)
  const endDateTime = initialData.end_date ? parseDateTime(initialData.end_date) : startDateTime

  return {
    title: initialData.title || "",
    description: initialData.description || "",
    eventType: (initialData.event_type || "networking") as "networking" | "class" | "activity",
    startDate: startDateTime.date,
    startTime: startDateTime.time,
    endDate: endDateTime.date,
    endTime: endDateTime.time,
    location: initialData.location || "",
    price: initialData.price && initialData.price > 0 ? String(initialData.price) : "",
    maxParticipants: initialData.max_participants && initialData.max_participants > 0 ? String(initialData.max_participants) : "",
    thumbnailUrl: initialData.thumbnail_url || "",
    customFields: initialData.customFields || [],
    isEndDateManuallyChanged: !!initialData.end_date,
  }
}

export function NewEventForm({ 
  userId, 
  onSuccess,
  initialData 
}: { 
  userId?: string
  onSuccess?: () => void
  initialData?: InitialData
}) {
  const initialValues = getInitialValues(initialData)
  
  const [title, setTitle] = useState(initialValues.title)
  const [description, setDescription] = useState(initialValues.description) // Editor content (HTML)
  const [eventType, setEventType] = useState<"networking" | "class" | "activity">(initialValues.eventType)
  const [startDate, setStartDate] = useState(initialValues.startDate)
  const [startTime, setStartTime] = useState(initialValues.startTime)
  const [endDate, setEndDate] = useState(initialValues.endDate)
  const [endTime, setEndTime] = useState(initialValues.endTime)
  const [location, setLocation] = useState(initialValues.location)
  const [price, setPrice] = useState(initialValues.price)
  const [maxParticipants, setMaxParticipants] = useState(initialValues.maxParticipants)
  const [thumbnailUrl, setThumbnailUrl] = useState(initialValues.thumbnailUrl)
  const [isLoading, setIsLoading] = useState(false)
  const [error, setError] = useState<string | null>(null)
  const [isUploading, setIsUploading] = useState(false)
  const [unsplashQuery, setUnsplashQuery] = useState("")
  const [unsplashResults, setUnsplashResults] = useState<UnsplashImage[]>([])
  const { toast } = useToast()
  const [isSearching, setIsSearching] = useState(false)
  const [isDialogOpen, setIsDialogOpen] = useState(false)
  const [currentUserId, setCurrentUserId] = useState<string | null>(userId || null)
  const [isEndDateManuallyChanged, setIsEndDateManuallyChanged] = useState(initialValues.isEndDateManuallyChanged)
  const [scriptLoadError, setScriptLoadError] = useState(false)
  
  // ì»¤ìŠ¤í…€ í•„ë“œ ìƒíƒœ
  const [customFields, setCustomFields] = useState<CustomField[]>(initialValues.customFields)
  
  // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì„¼ì„œ ì„¤ì •
  const sensors = useSensors(
    useSensor(PointerSensor),
    useSensor(KeyboardSensor, {
      coordinateGetter: sortableKeyboardCoordinates,
    })
  )
  
  // ë“œë˜ê·¸ ì¢…ë£Œ í•¸ë“¤ëŸ¬
  const handleDragEnd = (event: DragEndEvent) => {
    const { active, over } = event
    
    if (over && active.id !== over.id) {
      setCustomFields((items) => {
        const oldIndex = items.findIndex((item) => item.id === active.id)
        const newIndex = items.findIndex((item) => item.id === over.id)
        
        return arrayMove(items, oldIndex, newIndex)
      })
    }
  }
  
  const fileInputRef = useRef<HTMLInputElement>(null)
  const autocompleteRef = useRef<google.maps.places.Autocomplete | null>(null)
  const router = useRouter()

  // Google Maps API í‚¤ í™•ì¸
  const googleMapsApiKey = process.env.NEXT_PUBLIC_GOOGLE_MAPS_API_KEY || ""
  const hasApiKey = googleMapsApiKey.length > 0

  // Google Maps ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ (API í‚¤ê°€ ìˆì„ ë•Œë§Œ)
  const { isLoaded, loadError } = useLoadScript({
    googleMapsApiKey: hasApiKey ? googleMapsApiKey : "",
    libraries: hasApiKey ? libraries : [],
    ...(hasApiKey ? {} : { preventGoogleFontsLoading: true }),
  })

  // ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì‹¤íŒ¨ ì‹œ fallback í™œì„±í™”
  useEffect(() => {
    if (loadError || !hasApiKey) {
      setScriptLoadError(true)
    }
  }, [loadError, hasApiKey])

  // ì‹œê°„ ì˜µì…˜ ìƒì„±
  const generateTimeOptions = () => {
    const options = []
    for (let hour = 0; hour < 24; hour++) {
      for (const minute of [0, 30]) {
        const timeValue = `${String(hour).padStart(2, "0")}:${String(minute).padStart(2, "0")}`
        const displayHour = hour === 0 ? 12 : hour > 12 ? hour - 12 : hour
        const period = hour < 12 ? "ì˜¤ì „" : "ì˜¤í›„"
        options.push({
          value: timeValue,
          label: `${period} ${displayHour}:${String(minute).padStart(2, "0")}`,
        })
      }
    }
    return options
  }
  const timeOptions = generateTimeOptions()

  // userId ì„¤ì • (initialDataì™€ ë¬´ê´€í•˜ê²Œ ì‹¤í–‰)
  useEffect(() => {
    if (!userId) {
      const fetchUser = async () => {
        const supabase = createClient()
        const { data: { user } } = await supabase.auth.getUser()
        if (user) setCurrentUserId(user.id)
      }
      fetchUser()
    }
  }, [userId])

  // startDate ë³€ê²½ ì‹œ endDate ìë™ ì„¤ì • (ì‚¬ìš©ìê°€ ìˆ˜ë™ìœ¼ë¡œ ìˆ˜ì •í•œ ê²½ìš° ì œì™¸)
  useEffect(() => {
    if (!isEndDateManuallyChanged && startDate) {
      setEndDate(startDate)
    } else if (startDate && endDate) {
      // startDateê°€ endDateë³´ë‹¤ ëŠ¦ìœ¼ë©´ endDateë¥¼ startDateë¡œ ì—…ë°ì´íŠ¸
      const start = new Date(startDate)
      const end = new Date(endDate)
      if (start > end) {
        setEndDate(startDate)
      }
    }
  }, [startDate, endDate, isEndDateManuallyChanged])

  const handleFileUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0]
    if (!file) return
    setIsUploading(true)
    try {
      const formData = new FormData()
      formData.append("file", file)
      const response = await fetch("/api/upload", { method: "POST", body: formData })
      if (!response.ok) throw new Error("ì—…ë¡œë“œ ì‹¤íŒ¨")
      const data = await response.json()
      setThumbnailUrl(data.url)
    } catch (error) {
      console.error("ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨:", error)
      toast({
        variant: "destructive",
        title: "ì—…ë¡œë“œ ì‹¤íŒ¨",
        description: "ì´ë¯¸ì§€ ì—…ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.",
      })
    } finally {
      setIsUploading(false)
    }
  }

  const handleUnsplashSearch = async () => {
    if (!unsplashQuery.trim()) return
    
    // ê²€ìƒ‰ ì‹œì‘ ì‹œ Dialog ìë™ ì—´ê¸°
    setIsDialogOpen(true)
    setIsSearching(true)
    setUnsplashResults([]) // ì´ì „ ê²°ê³¼ ì´ˆê¸°í™”
    
    try {
      const result = await searchUnsplashImages(unsplashQuery)
      if (result.success) {
        setUnsplashResults(result.results || [])
        if (!result.results || result.results.length === 0) {
          // ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ì„ ë•ŒëŠ” ì¡°ìš©íˆ ì²˜ë¦¬ (ì‚¬ìš©ìê°€ ì§ì ‘ í™•ì¸)
        }
      } else {
        // ì—ëŸ¬ ë°œìƒ ì‹œ í”¼ë“œë°±
        toast({
          variant: "destructive",
          title: "ê²€ìƒ‰ ì‹¤íŒ¨",
          description: result.error || "ì´ë¯¸ì§€ ê²€ìƒ‰ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",
        })
      }
    } catch (error) {
      console.error("Unsplash search error:", error)
      toast({
        variant: "destructive",
        title: "ì˜¤ë¥˜ ë°œìƒ",
        description: "ì´ë¯¸ì§€ ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",
      })
    } finally {
      setIsSearching(false)
    }
  }


  const handleImageSelect = (imageUrl: string) => {
    setThumbnailUrl(imageUrl)
    setIsDialogOpen(false)
    setUnsplashQuery("")
    setUnsplashResults([])
  }

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    if (!title) {
      toast({
        variant: "destructive",
        title: "ì…ë ¥ í•„ìš”",
        description: "ì´ë²¤íŠ¸ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.",
      })
      return
    }

    setIsLoading(true)
    setError(null)

    try {
      const startDateTime = new Date(`${startDate}T${startTime}`)
      const endDateTime = endDate && endTime ? new Date(`${endDate}T${endTime}`) : null

      const maxParticipantsValue = maxParticipants ? parseInt(maxParticipants) : null
      if (maxParticipantsValue !== null && isNaN(maxParticipantsValue)) {
        throw new Error("ìµœëŒ€ ì¸ì›ì€ ìœ íš¨í•œ ìˆ«ìì—¬ì•¼ í•©ë‹ˆë‹¤.")
      }

      // â˜… ë³´ì•ˆ: ì„œë²„ ì•¡ì…˜ ì‚¬ìš© (created_byëŠ” ì„œë²„ì—ì„œ ì„¸ì…˜ ê¸°ë°˜ìœ¼ë¡œ ìë™ ì„¤ì •ë¨)
      const priceValue = price ? parseInt(price) : 0

      const eventData = {
        title,
        description, // Rich Text Content
        event_date: startDateTime.toISOString(),
        end_date: endDateTime ? endDateTime.toISOString() : null,
        location: location || null,
        price: priceValue > 0 ? priceValue : null,
        max_participants: maxParticipantsValue,
        thumbnail_url: thumbnailUrl || null,
        event_type: eventType,
        // ìˆ˜ì • ëª¨ë“œì—ì„œëŠ” í•­ìƒ customFieldsë¥¼ ì „ë‹¬ (ë¹ˆ ë°°ì—´ì´ì–´ë„ ê¸°ì¡´ ì§ˆë¬¸ ì‚­ì œë¥¼ ìœ„í•´)
        // ìƒì„± ëª¨ë“œì—ì„œëŠ” ì§ˆë¬¸ì´ ìˆì„ ë•Œë§Œ ì „ë‹¬
        customFields: initialData ? customFields : (customFields.length > 0 ? customFields : undefined),
      }

      let result
      if (initialData) {
        // ìˆ˜ì • ëª¨ë“œ
        result = await updateEvent(initialData.id, eventData)
        if (!result.success) {
          throw new Error("ì´ë²¤íŠ¸ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")
        }
        if (onSuccess) onSuccess()
        else router.push(`/e/${initialData.id}`)
      } else {
        // ìƒì„± ëª¨ë“œ
        result = await createEvent(eventData)
        if (!result.success) {
          throw new Error("ì´ë²¤íŠ¸ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")
        }
        if (onSuccess) onSuccess()
        else router.push("/e")
      }
      router.refresh()
    } catch (error) {
      const errorMessage = error instanceof Error ? error.message : (initialData ? "ì´ë²¤íŠ¸ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤." : "ì´ë²¤íŠ¸ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")
      setError(errorMessage)
      toast({
        variant: "destructive",
        title: initialData ? "ìˆ˜ì • ì‹¤íŒ¨" : "ìƒì„± ì‹¤íŒ¨",
        description: errorMessage,
      })
    } finally {
      setIsLoading(false)
    }
  }

  return (
    <form onSubmit={handleSubmit} className="space-y-6 sm:space-y-8">
      {/* 1. ì œëª© ì…ë ¥ - ìµœìƒë‹¨ (ì „ì²´ ë„ˆë¹„, Luma ìŠ¤íƒ€ì¼) */}
      <div className="space-y-3">
        <input
          type="text"
          placeholder="ì´ë²¤íŠ¸ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”"
          value={title}
          onChange={(e) => setTitle(e.target.value)}
          className="w-full text-3xl sm:text-4xl font-bold text-slate-900 placeholder:text-slate-300 border-none bg-transparent focus:outline-none focus:ring-0 px-0 py-1"
          required
        />
        <div className="h-px bg-slate-200 w-full" />
      </div>

      {/* 2. ì´ë¯¸ì§€(ì¢Œ) + ìƒì„¸ì •ë³´(ìš°) ê·¸ë¦¬ë“œ */}
      <div className="grid grid-cols-1 lg:grid-cols-12 gap-6 lg:gap-8 items-start">

        {/* [Left] Image Upload Section (5 cols) - 1:1 ë¹„ìœ¨ */}
        <div className="lg:col-span-5 space-y-4">
          <div
            className="group relative aspect-square w-full cursor-pointer overflow-hidden rounded-3xl border-2 border-dashed border-slate-200 bg-slate-50 hover:bg-slate-100 hover:border-slate-300 transition-all"
            onClick={() => fileInputRef.current?.click()}
          >
            {thumbnailUrl ? (
              <>
                <img src={thumbnailUrl} alt="Thumbnail" className="h-full w-full object-cover" />
                <div className="absolute inset-0 flex items-center justify-center bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity">
                  <Upload className="h-8 w-8 text-white" />
                </div>
              </>
            ) : (
              <div className="flex h-full flex-col items-center justify-center text-slate-400 gap-3">
                {isUploading ? (
                  <Loader2 className="h-10 w-10 animate-spin" />
                ) : (
                  <>
                    <ImageIcon className="h-12 w-12" />
                    <span className="text-sm font-medium">í´ë¦­í•˜ì—¬ ì´ë¯¸ì§€ ì—…ë¡œë“œ</span>
                    <span className="text-xs text-slate-400">ë˜ëŠ” ì•„ë˜ì—ì„œ Unsplash ê²€ìƒ‰</span>
                  </>
                )}
              </div>
            )}
            <input ref={fileInputRef} type="file" accept="image/*" onChange={handleFileUpload} className="hidden" />
          </div>

          {/* Unsplash Search */}
          <div className="flex gap-2">
            <div className="relative flex-1">
              <Search className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400" />
              <Input
                placeholder="Unsplash ê²€ìƒ‰ (ì˜ˆ: meeting)"
                value={unsplashQuery}
                onChange={(e) => setUnsplashQuery(e.target.value)}
                onKeyDown={(e) => {
                  if (e.key === "Enter") {
                    e.preventDefault()
                    handleUnsplashSearch()
                  }
                }}
                className="pl-9 h-10"
              />
            </div>
            <Button
              type="button"
              variant="outline"
              size="sm"
              disabled={!unsplashQuery.trim()}
              onClick={handleUnsplashSearch}
              className="h-10 px-4"
            >
              ê²€ìƒ‰
            </Button>
          </div>

          {/* Unsplash Dialog */}
          <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>
            <DialogContent className="max-w-4xl max-h-[80vh] overflow-y-auto">
              <DialogHeader>
                <DialogTitle>ì´ë¯¸ì§€ ê²€ìƒ‰</DialogTitle>
              </DialogHeader>
              <div className="space-y-4 mt-4">
                <div className="flex gap-2">
                  <div className="relative flex-1">
                    <Search className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400" />
                    <Input
                      placeholder="ê²€ìƒ‰ì–´ ì…ë ¥"
                      value={unsplashQuery}
                      onChange={(e) => setUnsplashQuery(e.target.value)}
                      onKeyDown={(e) => {
                        if (e.key === "Enter") {
                          e.preventDefault()
                          handleUnsplashSearch()
                        }
                      }}
                      className="pl-9"
                    />
                  </div>
                  <Button
                    type="button"
                    onClick={handleUnsplashSearch}
                    disabled={isSearching || !unsplashQuery.trim()}
                  >
                    {isSearching ? <Loader2 className="h-4 w-4 animate-spin" /> : "ê²€ìƒ‰"}
                  </Button>
                </div>

                {isSearching && (
                  <div className="flex items-center justify-center py-12">
                    <Loader2 className="h-8 w-8 animate-spin text-slate-400" />
                  </div>
                )}

                {!isSearching && unsplashResults.length > 0 && (
                  <div className="grid grid-cols-3 gap-3">
                    {unsplashResults.map((img) => (
                      <div
                        key={img.id}
                        className="aspect-square relative cursor-pointer rounded-lg overflow-hidden border border-slate-200 hover:border-slate-400 hover:shadow-md transition-all group"
                        onClick={() => handleImageSelect(img.urls.regular)}
                      >
                        <img
                          src={img.urls.small}
                          alt={img.alt_description || "Unsplash"}
                          className="w-full h-full object-cover group-hover:scale-105 transition-transform"
                        />
                      </div>
                    ))}
                  </div>
                )}

                {!isSearching && unsplashQuery && unsplashResults.length === 0 && (
                  <div className="text-center py-12 text-slate-500">
                    <p className="text-sm">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</p>
                  </div>
                )}
              </div>
            </DialogContent>
          </Dialog>
        </div>

        {/* [Right] Event Info Section (7 cols) - ì¹´ë“œ í˜•íƒœ */}
        <div className="lg:col-span-7">
          <div className="bg-white p-5 sm:p-6 rounded-3xl border border-slate-200 shadow-sm space-y-5">
            {/* ì‹œì‘/ì¢…ë£Œ ì‹œê°„ */}
            <div className="grid grid-cols-[40px_1fr] gap-4 items-start">
              <div className="p-2 bg-slate-100 rounded-lg text-slate-500 justify-self-center">
                <Calendar className="h-5 w-5" />
              </div>
              <div className="space-y-3">
                <div className="flex flex-wrap items-center gap-2">
                  <span className="text-sm font-semibold text-slate-700 w-10">ì‹œì‘</span>
                  <input
                    type="date"
                    value={startDate}
                    onChange={(e) => setStartDate(e.target.value)}
                    className="bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 text-sm font-medium focus:outline-none focus:ring-2 focus:ring-slate-200"
                  />
                  <select
                    value={startTime}
                    onChange={(e) => setStartTime(e.target.value)}
                    className="bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 text-sm font-medium focus:outline-none focus:ring-2 focus:ring-slate-200"
                  >
                    {timeOptions.map((t) => (
                      <option key={t.value} value={t.value}>{t.label}</option>
                    ))}
                  </select>
                </div>
                <div className="flex flex-wrap items-center gap-2">
                  <span className="text-sm font-semibold text-slate-400 w-10">ì¢…ë£Œ</span>
                  <input
                    type="date"
                    value={endDate}
                    onChange={(e) => {
                      setEndDate(e.target.value)
                      setIsEndDateManuallyChanged(true)
                    }}
                    className="bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 text-sm font-medium text-slate-600 focus:outline-none focus:ring-2 focus:ring-slate-200"
                  />
                  <select
                    value={endTime}
                    onChange={(e) => setEndTime(e.target.value)}
                    className="bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 text-sm font-medium text-slate-600 focus:outline-none focus:ring-2 focus:ring-slate-200"
                  >
                    {timeOptions.map((t) => (
                      <option key={t.value} value={t.value}>{t.label}</option>
                    ))}
                  </select>
                </div>
              </div>
            </div>

            {/* ì¥ì†Œ */}
            <div className="grid grid-cols-[40px_1fr] gap-4 items-center">
              <div className="p-2 bg-slate-100 rounded-lg text-slate-500 justify-self-center">
                <MapPin className="h-5 w-5" />
              </div>
              <div>
                {hasApiKey && isLoaded && !scriptLoadError ? (
                  <Autocomplete
                    onLoad={(autocomplete) => {
                      autocompleteRef.current = autocomplete
                    }}
                    onPlaceChanged={() => {
                      if (autocompleteRef.current) {
                        const place = autocompleteRef.current.getPlace()
                        // ì¥ì†Œëª…(name)ì´ ìˆìœ¼ë©´ ìš°ì„  ì‚¬ìš©, ì—†ìœ¼ë©´ ì£¼ì†Œ ì‚¬ìš©
                        const locationName = place.name || place.formatted_address || ""
                        setLocation(locationName)
                      }
                    }}
                    options={{
                      types: ["establishment", "geocode"],
                      componentRestrictions: { country: "kr" },
                      fields: ["address_components", "geometry", "icon", "name", "formatted_address"],
                    }}
                  >
                    <Input
                      placeholder="ì¥ì†Œ ì…ë ¥ (ì˜ˆ: ê°•ë‚¨ì—­ ìŠ¤íƒ€ë²…ìŠ¤, Zoom ë§í¬)"
                      value={location}
                      onChange={(e) => setLocation(e.target.value)}
                      className="border-slate-200 bg-slate-50 h-10 focus-visible:ring-slate-200"
                    />
                  </Autocomplete>
                ) : (
                  <Input
                    placeholder="ì¥ì†Œ ì…ë ¥ (ì˜ˆ: ê°•ë‚¨ì—­ ìŠ¤íƒ€ë²…ìŠ¤, Zoom ë§í¬)"
                    value={location}
                    onChange={(e) => setLocation(e.target.value)}
                    className="border-slate-200 bg-slate-50 h-10 focus-visible:ring-slate-200"
                  />
                )}
              </div>
            </div>

            {/* ê°€ê²© */}
            <div className="grid grid-cols-[40px_1fr] gap-4 items-center">
              <div className="p-2 bg-slate-100 rounded-lg text-slate-500 justify-self-center">
                <Ticket className="h-5 w-5" />
              </div>
              <Input
                type="number"
                placeholder="ê°€ê²© (ë¬´ë£Œë©´ ë¹„ì›Œë‘ê¸°)"
                value={price}
                onChange={(e) => setPrice(e.target.value)}
                className="border-slate-200 bg-slate-50 h-10 focus-visible:ring-slate-200"
                min="0"
              />
            </div>

            {/* ì¸ì› */}
            <div className="grid grid-cols-[40px_1fr] gap-4 items-center">
              <div className="p-2 bg-slate-100 rounded-lg text-slate-500 justify-self-center">
                <Users className="h-5 w-5" />
              </div>
              <Input
                type="number"
                placeholder="ìµœëŒ€ ì¸ì› (ì„ íƒ)"
                value={maxParticipants}
                onChange={(e) => setMaxParticipants(e.target.value)}
                className="border-slate-200 bg-slate-50 h-10 focus-visible:ring-slate-200"
              />
            </div>

            {/* ì´ë²¤íŠ¸ ìœ í˜• */}
            <div className="grid grid-cols-[40px_1fr] gap-4 items-start">
              <div className="p-2 bg-slate-100 rounded-lg text-slate-500 justify-self-center">
                <Target className="h-5 w-5" />
              </div>
              <div>
                <span className="text-sm font-semibold text-slate-700 block mb-3">ì´ë²¤íŠ¸ ìœ í˜•</span>
                <RadioGroup
                  value={eventType}
                  onValueChange={(value) => setEventType(value as "networking" | "class" | "activity")}
                  className="grid grid-cols-3 gap-2"
                >
                  {[
                    { value: "networking", label: "ë„¤íŠ¸ì›Œí‚¹", desc: "ëª¨ì„, íŒŒí‹°" },
                    { value: "class", label: "í´ë˜ìŠ¤", desc: "ê°•ì˜, ì„¸ë¯¸ë‚˜" },
                    { value: "activity", label: "ì•¡í‹°ë¹„í‹°", desc: "ìš´ë™, ì•¼ì™¸" },
                  ].map((type) => (
                    <label
                      key={type.value}
                      htmlFor={type.value}
                      className={cn(
                        "flex flex-col items-center p-3 border rounded-xl cursor-pointer transition-all text-center",
                        eventType === type.value
                          ? "border-slate-900 bg-slate-900 text-white"
                          : "border-slate-200 hover:border-slate-300 hover:bg-slate-50"
                      )}
                    >
                      <RadioGroupItem value={type.value} id={type.value} className="sr-only" />
                      <span className="font-medium text-sm">{type.label}</span>
                      <span className={cn("text-xs mt-0.5", eventType === type.value ? "text-slate-300" : "text-slate-500")}>
                        {type.desc}
                      </span>
                    </label>
                  ))}
                </RadioGroup>
              </div>
            </div>
          </div>
        </div>
      </div>

      {/* ìƒì„¸ ë‚´ìš© ì—ë””í„° */}
      <div className="space-y-3">
        <Label className="text-lg font-semibold text-slate-900">ìƒì„¸ ë‚´ìš©</Label>
        <div className="bg-white border-0 rounded-xl overflow-hidden">
          <RichTextEditor content={description} onChange={setDescription} />
        </div>
      </div>

      {/* ì°¸ê°€ì ì§ˆë¬¸ ì„¹ì…˜ */}
      <div className="bg-white border border-slate-200 rounded-xl shadow-sm p-5 sm:p-6 space-y-4">
        <div className="flex items-center justify-between">
          <div>
            <Label className="text-lg font-semibold text-slate-900">ì°¸ê°€ì ì§ˆë¬¸</Label>
            <p className="text-sm text-slate-500 mt-0.5">ì°¸ê°€ ì‹ ì²­ ì‹œ ë°›ì„ ì§ˆë¬¸ì„ ì¶”ê°€í•˜ì„¸ìš”</p>
          </div>
          <Button
            type="button"
            variant="outline"
            size="sm"
            onClick={() => {
              setCustomFields([
                ...customFields,
                {
                  id: `field-${Date.now()}`,
                  label: "",
                  type: "text",
                  options: [],
                  required: false,
                },
              ])
            }}
            className="gap-2"
          >
            <Plus className="h-4 w-4" />
            ì¶”ê°€
          </Button>
        </div>

        {customFields.length > 0 && (
          <DndContext
            sensors={sensors}
            collisionDetection={closestCenter}
            onDragEnd={handleDragEnd}
          >
            <SortableContext
              items={customFields.map((field) => field.id)}
              strategy={verticalListSortingStrategy}
            >
              <div className="space-y-3">
                {customFields.map((field, index) => (
                  <SortableItem
                    key={field.id}
                    field={field}
                    index={index}
                    customFields={customFields}
                    setCustomFields={setCustomFields}
                  />
                ))}
              </div>
            </SortableContext>
          </DndContext>
        )}

        {customFields.length === 0 && (
          <div className="text-center py-8 text-slate-400">
            <p className="text-sm">ì•„ì§ ì¶”ê°€ëœ ì§ˆë¬¸ì´ ì—†ìŠµë‹ˆë‹¤</p>
          </div>
        )}
      </div>

      {/* ìˆ˜ì • ëª¨ë“œ: ì´ë²¤íŠ¸ ê´€ë¦¬ ì„¹ì…˜ */}
      {initialData && currentUserId && (
        <div className="mt-10 pt-10 border-t border-slate-200">
          <h3 className="text-lg font-bold text-slate-900 mb-4">ì´ë²¤íŠ¸ ê´€ë¦¬</h3>
          <div className="flex flex-col gap-4">
            {/* ì´ë²¤íŠ¸ ì¢…ë£Œ */}
            <div className="flex items-center justify-between p-4 bg-slate-50 rounded-xl border border-slate-200">
              <div className="flex-1">
                <div className="flex items-center gap-2">
                  <CheckCircle className="h-5 w-5 text-slate-600" />
                  <span className="font-semibold text-slate-700">ì´ë²¤íŠ¸ ì¢…ë£Œ</span>
                </div>
                <p className="text-sm text-slate-500 mt-1 ml-7">ë” ì´ìƒ ì°¸ê°€ ì‹ ì²­ì„ ë°›ì§€ ì•Šê³  ì´ë²¤íŠ¸ë¥¼ ì¢…ë£Œí•©ë‹ˆë‹¤.</p>
              </div>
              <CompleteEventButton eventId={initialData.id} userId={currentUserId} />
            </div>

            {/* ì´ë²¤íŠ¸ ì‚­ì œ */}
            <div className="flex items-center justify-between p-4 bg-red-50 rounded-xl border border-red-100">
              <div className="flex-1">
                <div className="flex items-center gap-2">
                  <AlertTriangle className="h-5 w-5 text-red-600" />
                  <span className="font-semibold text-red-700">ì´ë²¤íŠ¸ ì‚­ì œ</span>
                </div>
                <p className="text-sm text-red-500 mt-1 ml-7">ì´ë²¤íŠ¸ë¥¼ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œí•©ë‹ˆë‹¤. (ë³µêµ¬ ë¶ˆê°€)</p>
              </div>
              <DeleteEventButton
                eventId={initialData.id}
                variant="destructive"
                className="bg-red-600 text-white hover:bg-red-700"
              />
            </div>
          </div>
        </div>
      )}

      {/* ì—ëŸ¬ ë©”ì‹œì§€ */}
      {error && (
        <div className="p-4 bg-red-50 text-red-600 rounded-xl text-sm font-medium border border-red-100">
          {error}
        </div>
      )}

      {/* ì œì¶œ ë²„íŠ¼ */}
      <div className="sticky bottom-0 z-20 bg-gradient-to-t from-slate-50 via-slate-50 to-transparent pt-4 pb-6 -mx-4 px-4 sm:-mx-6 sm:px-6">
        <Button
          type="submit"
          size="lg"
          className="w-full sm:w-auto sm:min-w-[200px] sm:ml-auto sm:flex bg-slate-900 hover:bg-slate-800 text-white rounded-xl text-base font-semibold shadow-lg hover:shadow-xl transition-all h-12"
          disabled={isLoading}
        >
          {isLoading ? (
            <>
              <Loader2 className="mr-2 h-5 w-5 animate-spin" />
              ì²˜ë¦¬ ì¤‘...
            </>
          ) : initialData ? (
            "ì´ë²¤íŠ¸ ìˆ˜ì •í•˜ê¸°"
          ) : (
            "ì´ë²¤íŠ¸ ê°œì„¤í•˜ê¸°"
          )}
        </Button>
      </div>
    </form>
  )
}
</file>

<file path="components/register-button.tsx">
"use client";

import { useState, useEffect } from "react";
import { useRouter } from "next/navigation";
import { Button } from "@/components/ui/button";
import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from "@/components/ui/dialog";
import { createClient } from "@/lib/supabase/client";
import { CheckCircle, Loader2, LogIn, Clock, Users } from "lucide-react";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { useToast } from "@/hooks/use-toast";
import { registerGuestForEvent, registerUserForEvent, cancelRegistration } from "@/lib/actions/event-registrations";

type CustomField = {
  id: string;
  field_name: string;
  field_type: "text" | "select";
  field_options: string[] | null;
  is_required: boolean;
};

export function RegisterButton({
  eventId,
  userId,
  isRegistered: initialRegistered,
  isFull,
  registrationStatus: initialStatus,
  waitlistPosition: initialWaitlistPosition,
}: {
  eventId: string;
  userId?: string;
  isRegistered: boolean;
  isFull: boolean;
  price?: number | null;
  paymentStatus?: string;
  registrationStatus?: "confirmed" | "waitlist";
  waitlistPosition?: number | null;
}) {
  const [isRegistered, setIsRegistered] = useState(initialRegistered);
  const [registrationStatus, setRegistrationStatus] = useState(initialStatus);
  const [waitlistPosition, setWaitlistPosition] = useState(initialWaitlistPosition);
  const [isLoading, setIsLoading] = useState(false);
  const router = useRouter();
  const { toast } = useToast();

  // ëª¨ë‹¬ ìƒíƒœ
  const [isDialogOpen, setIsDialogOpen] = useState(false);
  const [showCancelDialog, setShowCancelDialog] = useState(false);
  const [isLoadingFields, setIsLoadingFields] = useState(false);
  const [isWaitlistMode, setIsWaitlistMode] = useState(false);

  // ì‚¬ìš©ì ì •ë³´
  const [userProfile, setUserProfile] = useState<{ full_name?: string; email?: string } | null>(null);
  const [guestName, setGuestName] = useState("");
  const [guestContact, setGuestContact] = useState("");

  // ì»¤ìŠ¤í…€ í•„ë“œ
  const [customFields, setCustomFields] = useState<CustomField[]>([]);
  const [fieldResponses, setFieldResponses] = useState<Record<string, string>>({});

  // ì‚¬ìš©ì í”„ë¡œí•„ ë¡œë“œ
  useEffect(() => {
    if (userId) {
      const supabase = createClient();
      supabase.from("profiles").select("full_name, email").eq("id", userId).single().then(({ data }) => {
        if (data) {
          setUserProfile({ full_name: data.full_name || undefined, email: data.email || undefined });
          if (data.full_name) setGuestName(data.full_name);
        }
      });
    }
  }, [userId]);

  // ì»¤ìŠ¤í…€ í•„ë“œ ë¡œë“œ
  const loadCustomFields = async () => {
    const supabase = createClient();
    setIsLoadingFields(true);

    // íƒ€ì„ì•„ì›ƒ ì„¤ì • (10ì´ˆ)
    const timeoutId = setTimeout(() => {
      console.warn("[RegisterButton] Custom fields loading timeout");
      setIsLoadingFields(false);
    }, 10000);

    try {
      const { data, error } = await supabase
        .from("event_registration_fields")
        .select("id, field_name, field_type, field_options, is_required, order_index")
        .eq("event_id", eventId)
        .order("order_index", { ascending: true });

      clearTimeout(timeoutId);

      if (error) {
        console.error("[RegisterButton] Failed to load custom fields - Error:", error);
        return [];
      }

      return (data as any) || [];
    } catch (error) {
      clearTimeout(timeoutId);
      console.error("[RegisterButton] Error loading custom fields:", error);
      return [];
    } finally {
      clearTimeout(timeoutId);
      setIsLoadingFields(false);
    }
  };

  // ë²„íŠ¼ í´ë¦­ í•¸ë“¤ëŸ¬ (í•­ìƒ ëª¨ë‹¬ ì—´ê¸°)
  const handleOpenDialog = async (waitlistMode: boolean = false) => {
    setIsWaitlistMode(waitlistMode);
    setIsDialogOpen(true);
    setCustomFields([]);
    setFieldResponses({});

    if (userId) {
      const supabase = createClient();
      const timeoutId = setTimeout(() => {
        console.warn("[RegisterButton] User profile loading timeout");
      }, 5000);

      try {
        const { data: profile } = await supabase
          .from("profiles")
          .select("full_name, email")
          .eq("id", userId)
          .single();

        clearTimeout(timeoutId);

        if (profile) {
          setUserProfile(profile);
          setGuestName(profile.full_name || "");
          setGuestContact(profile.email || "");
        }
      } catch (error) {
        clearTimeout(timeoutId);
        console.error("[RegisterButton] Failed to load user profile:", error);
      }
    }

    loadCustomFields().then((fields) => {
      setCustomFields(fields);
      setFieldResponses({});
    }).catch((error) => {
      console.error("[RegisterButton] Failed to load custom fields in handleOpenDialog:", error);
      setCustomFields([]);
      setFieldResponses({});
    });
  };

  // ë¡œê·¸ì¸ ì‚¬ìš©ì ì‹ ì²­
  const handleUserRegister = async () => {
    if (!userId) return;

    if (!guestName.trim() || !guestContact.trim()) {
      toast({ variant: "destructive", title: "ì…ë ¥ í•„ìš”", description: "ì´ë¦„ê³¼ ì—°ë½ì²˜ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”" });
      return;
    }

    // ì»¤ìŠ¤í…€ í•„ë“œ í•„ìˆ˜ í•­ëª© ê²€ì¦
    for (const field of customFields) {
      if (field.is_required && (!fieldResponses[field.id] || fieldResponses[field.id].trim() === '')) {
        toast({
          variant: "destructive",
          title: "í•„ìˆ˜ í•­ëª©",
          description: `"${field.field_name}"ì€(ëŠ”) í•„ìˆ˜ í•­ëª©ì…ë‹ˆë‹¤.`,
        });
        return;
      }
    }

    setIsLoading(true);

    try {
      const result = await registerUserForEvent(
        eventId,
        userId,
        guestName.trim() || null,
        guestContact.trim() || null,
        null,
        fieldResponses,
        isWaitlistMode
      );

      setIsRegistered(true);
      setRegistrationStatus(result.status);
      setWaitlistPosition(result.waitlistPosition);
      setIsDialogOpen(false);
      router.refresh();

      if (result.status === "waitlist") {
        toast({
          title: "ëŒ€ê¸°ì ë“±ë¡ ì™„ë£Œ",
          description: `ëŒ€ê¸° ${result.waitlistPosition}ë²ˆì§¸ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤. ìë¦¬ê°€ ë‚˜ë©´ ì•Œë¦¼ì„ ë³´ë‚´ë“œë¦½ë‹ˆë‹¤.`,
        });
      } else {
        toast({
          title: "ì‹ ì²­ ì™„ë£Œ",
          description: "ì´ë²¤íŠ¸ ì°¸ê°€ ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.",
        });
      }

    } catch (error: any) {
      console.error("[RegisterButton] Registration Error:", error);
      const errorMessage = error?.message || error?.toString() || "ì‹ ì²­ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.";

      toast({
        variant: "destructive",
        title: "ì‹ ì²­ ì‹¤íŒ¨",
        description: errorMessage,
        duration: 5000,
      });
    } finally {
      setIsLoading(false);
    }
  };

  // ê²ŒìŠ¤íŠ¸ ì‹ ì²­
  const handleGuestRegister = async () => {
    if (!guestName.trim() || !guestContact.trim()) {
      toast({ variant: "destructive", title: "ì…ë ¥ í•„ìš”", description: "ì´ë¦„ê³¼ ì—°ë½ì²˜ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”" });
      return;
    }

    // ì»¤ìŠ¤í…€ í•„ë“œ í•„ìˆ˜ í•­ëª© ê²€ì¦
    for (const field of customFields) {
      if (field.is_required && (!fieldResponses[field.id] || fieldResponses[field.id].trim() === '')) {
        toast({
          variant: "destructive",
          title: "í•„ìˆ˜ í•­ëª©",
          description: `"${field.field_name}"ì€(ëŠ”) í•„ìˆ˜ í•­ëª©ì…ë‹ˆë‹¤.`,
        });
        return;
      }
    }

    setIsLoading(true);

    try {
      const result = await registerGuestForEvent(
        eventId,
        guestName.trim(),
        guestContact.trim(),
        null,
        fieldResponses,
        isWaitlistMode
      );

      setIsRegistered(true);
      setRegistrationStatus(result.status);
      setWaitlistPosition(result.waitlistPosition);
      setIsDialogOpen(false);
      router.refresh();

      if (result.status === "waitlist") {
        toast({
          title: "ëŒ€ê¸°ì ë“±ë¡ ì™„ë£Œ",
          description: `ëŒ€ê¸° ${result.waitlistPosition}ë²ˆì§¸ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤. ìë¦¬ê°€ ë‚˜ë©´ ì•Œë¦¼ì„ ë³´ë‚´ë“œë¦½ë‹ˆë‹¤.`,
        });
      } else {
        toast({
          title: "ì‹ ì²­ ì™„ë£Œ",
          description: "ì´ë²¤íŠ¸ ì°¸ê°€ ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.",
        });
      }

    } catch (error: any) {
      console.error("[RegisterButton] Guest Registration Error:", error);
      const errorMessage = error?.message || error?.toString() || "ì°¸ê°€ ì‹ ì²­ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.";

      toast({
        variant: "destructive",
        title: "ì‹ ì²­ ì‹¤íŒ¨",
        description: errorMessage,
        duration: 5000,
      });
    } finally {
      setIsLoading(false);
    }
  };

  // ì·¨ì†Œ
  const handleCancel = async () => {
    if (!userId) return;
    setIsLoading(true);
    try {
      await cancelRegistration(eventId, userId);
      setIsRegistered(false);
      setRegistrationStatus(undefined);
      setWaitlistPosition(undefined);
      router.refresh();
      toast({
        title: "ì·¨ì†Œ ì™„ë£Œ",
        description: "ì°¸ê°€ ì‹ ì²­ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.",
      });
    } catch (error: any) {
      console.error(error);
      toast({
        variant: "destructive",
        title: "ì·¨ì†Œ ì‹¤íŒ¨",
        description: error?.message || "ì·¨ì†Œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.",
      });
    } finally {
      setIsLoading(false);
    }
  };

  // ------------------------------------------------------------
  // ë Œë”ë§
  // ------------------------------------------------------------

  // 1. ëŒ€ê¸°ì ìƒíƒœ
  if (initialRegistered && initialStatus === "waitlist") {
    return (
      <>
        <button
          type="button"
          onClick={() => {
            if (userId) {
              setShowCancelDialog(true);
            }
          }}
          disabled={!userId}
          className={`w-full flex items-center justify-center gap-2 rounded-xl bg-amber-50 p-4 border border-amber-200 text-amber-700 transition-colors ${
            userId ? 'hover:bg-amber-100 cursor-pointer' : 'cursor-default'
          }`}
        >
          <Clock className="h-5 w-5 text-amber-600" />
          <span className="font-semibold text-sm">
            ëŒ€ê¸° {initialWaitlistPosition}ë²ˆì§¸ - ìë¦¬ê°€ ë‚˜ë©´ ì•Œë¦¼ì„ ë³´ë‚´ë“œë¦½ë‹ˆë‹¤
          </span>
        </button>

        {/* ì·¨ì†Œ í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ */}
        <Dialog open={showCancelDialog} onOpenChange={setShowCancelDialog}>
          <DialogContent className="max-w-sm">
            <DialogHeader>
              <DialogTitle>ëŒ€ê¸° ì·¨ì†Œ</DialogTitle>
              <DialogDescription>
                ëŒ€ê¸°ì ëª…ë‹¨ì—ì„œ ì œì™¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?
              </DialogDescription>
            </DialogHeader>
            <div className="flex flex-col gap-3 pt-4">
              <button
                type="button"
                onClick={async () => {
                  await handleCancel();
                  setShowCancelDialog(false);
                }}
                disabled={isLoading}
                className="w-full h-11 rounded-lg bg-red-500 hover:bg-red-600 text-white font-semibold text-sm transition-colors disabled:opacity-50"
              >
                {isLoading ? (
                  <span className="flex items-center justify-center gap-2">
                    <Loader2 className="h-4 w-4 animate-spin" />
                    ì·¨ì†Œ ì¤‘...
                  </span>
                ) : (
                  "ëŒ€ê¸° ì·¨ì†Œí•˜ê¸°"
                )}
              </button>
              <button
                type="button"
                onClick={() => setShowCancelDialog(false)}
                className="w-full h-11 rounded-lg border border-slate-200 bg-white hover:bg-slate-50 text-slate-700 font-semibold text-sm transition-colors"
              >
                ëŒì•„ê°€ê¸°
              </button>
            </div>
          </DialogContent>
        </Dialog>
      </>
    );
  }

  // 2. ì°¸ê°€ í™•ì • ìƒíƒœ
  if (initialRegistered) {
    return (
      <>
        <button
          type="button"
          onClick={() => {
            if (userId) {
              setShowCancelDialog(true);
            }
          }}
          disabled={!userId}
          className={`w-full flex items-center justify-center gap-2 rounded-xl bg-slate-50 p-4 border border-slate-200 text-slate-700 transition-colors ${
            userId ? 'hover:bg-slate-100 cursor-pointer' : 'cursor-default'
          }`}
        >
          <CheckCircle className="h-5 w-5 text-green-600" />
          <span className="font-semibold text-sm">ì°¸ê°€ ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤</span>
        </button>

        {/* ì·¨ì†Œ í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ */}
        <Dialog open={showCancelDialog} onOpenChange={setShowCancelDialog}>
          <DialogContent className="max-w-sm">
            <DialogHeader>
              <DialogTitle>ì°¸ê°€ ì·¨ì†Œ</DialogTitle>
              <DialogDescription>
                ì •ë§ ì°¸ê°€ë¥¼ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?
              </DialogDescription>
            </DialogHeader>
            <div className="flex flex-col gap-3 pt-4">
              <button
                type="button"
                onClick={async () => {
                  await handleCancel();
                  setShowCancelDialog(false);
                }}
                disabled={isLoading}
                className="w-full h-11 rounded-lg bg-red-500 hover:bg-red-600 text-white font-semibold text-sm transition-colors disabled:opacity-50"
              >
                {isLoading ? (
                  <span className="flex items-center justify-center gap-2">
                    <Loader2 className="h-4 w-4 animate-spin" />
                    ì·¨ì†Œ ì¤‘...
                  </span>
                ) : (
                  "ì°¸ê°€ ì·¨ì†Œí•˜ê¸°"
                )}
              </button>
              <button
                type="button"
                onClick={() => setShowCancelDialog(false)}
                className="w-full h-11 rounded-lg border border-slate-200 bg-white hover:bg-slate-50 text-slate-700 font-semibold text-sm transition-colors"
              >
                ëŒì•„ê°€ê¸°
              </button>
            </div>
          </DialogContent>
        </Dialog>
      </>
    );
  }

  // 3. ë§ˆê° ìƒíƒœ (ëŒ€ê¸°ì ì‹ ì²­ ê°€ëŠ¥)
  if (isFull) {
    return (
      <>
        <div className="space-y-3">
          <div className="rounded-lg bg-slate-100 p-3 text-center text-slate-500 text-sm font-medium flex items-center justify-center gap-2">
            <Users className="h-4 w-4" />
            ëª¨ì§‘ì´ ë§ˆê°ë˜ì—ˆìŠµë‹ˆë‹¤
          </div>
          <Button
            onClick={() => handleOpenDialog(true)}
            disabled={isLoading}
            variant="outline"
            className="w-full border-amber-300 bg-amber-50 hover:bg-amber-100 text-amber-700 font-bold text-sm h-11"
          >
            {isLoading ? <Loader2 className="mr-2 h-4 w-4 animate-spin" /> : (
              <>
                <Clock className="mr-2 h-4 w-4" />
                ëŒ€ê¸°ìë¡œ ì‹ ì²­í•˜ê¸°
              </>
            )}
          </Button>
        </div>

        {/* ëŒ€ê¸°ì ì‹ ì²­ ëª¨ë‹¬ */}
        <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>
          <DialogContent className="max-w-2xl max-h-[90vh] md:max-h-[85vh] overflow-y-auto overscroll-contain">
            <DialogHeader>
              <DialogTitle>ëŒ€ê¸°ì ì‹ ì²­ì„œ</DialogTitle>
              <DialogDescription>
                í˜„ì¬ ì •ì›ì´ ë§ˆê°ë˜ì–´ ëŒ€ê¸°ìë¡œ ë“±ë¡ë©ë‹ˆë‹¤. ìë¦¬ê°€ ë‚˜ë©´ ì•Œë¦¼ì„ ë³´ë‚´ë“œë¦½ë‹ˆë‹¤.
              </DialogDescription>
            </DialogHeader>

            {isLoadingFields ? (
              <div className="flex flex-col items-center justify-center py-12">
                <Loader2 className="h-8 w-8 animate-spin text-slate-400 mb-2" />
                <p className="text-sm text-slate-500">ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
              </div>
            ) : (
              <div className="space-y-6 mt-4 pb-4">
                {/* ë¹„ë¡œê·¸ì¸ ì‚¬ìš©ì ë¡œê·¸ì¸ ìœ ë„ */}
                {!userId && (
                  <div className="rounded-lg bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 p-4">
                    <Button
                      variant="outline"
                      className="w-full border-blue-300 bg-white hover:bg-blue-50 text-blue-700 font-semibold h-11"
                      onClick={() => {
                        setIsDialogOpen(false);
                        router.push("/auth/login");
                      }}
                    >
                      <LogIn className="mr-2 h-4 w-4" />
                      ë¡œê·¸ì¸í•˜ê³  ì‹ ì²­í•˜ê¸° (ì¶”ì²œ)
                    </Button>
                    <p className="text-xs text-blue-600 mt-2 text-center">
                      ë¡œê·¸ì¸í•˜ë©´ ìë¦¬ê°€ ë‚¬ì„ ë•Œ ì•Œë¦¼ì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    </p>
                  </div>
                )}

                {/* ì…ë ¥ í¼ */}
                <div className="space-y-4">
                  <div>
                    <Label htmlFor="guestName">ì´ë¦„ <span className="text-red-500">*</span></Label>
                    <Input
                      id="guestName"
                      value={guestName}
                      onChange={(e) => setGuestName(e.target.value)}
                      onFocus={(e) => {
                        setTimeout(() => {
                          e.target.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }, 300);
                      }}
                      placeholder="ì„±í•¨ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"
                      className="mt-1.5 h-11 bg-slate-50"
                    />
                  </div>
                  <div>
                    <Label htmlFor="guestContact">ì—°ë½ì²˜ <span className="text-red-500">*</span></Label>
                    <Input
                      id="guestContact"
                      value={guestContact}
                      onChange={(e) => setGuestContact(e.target.value)}
                      onFocus={(e) => {
                        setTimeout(() => {
                          e.target.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }, 300);
                      }}
                      placeholder="010-0000-0000"
                      className="mt-1.5 h-11 bg-slate-50"
                    />
                  </div>
                </div>

                {/* ì»¤ìŠ¤í…€ í•„ë“œ */}
                {customFields.length > 0 && (
                  <div className="space-y-4 pt-4 border-t border-slate-200">
                    <h3 className="text-sm font-semibold text-slate-900">ì¶”ê°€ ì§ˆë¬¸</h3>
                    {customFields.map((field) => (
                      <div key={field.id} className="space-y-2">
                        <Label className="text-sm font-semibold text-slate-700">
                          {field.field_name}
                          {field.is_required && <span className="text-red-500 ml-1">*</span>}
                        </Label>

                        {field.field_type === 'text' ? (
                          <Input
                            placeholder="ë‹µë³€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"
                            value={fieldResponses[field.id] || ''}
                            onChange={(e) => {
                              setFieldResponses({
                                ...fieldResponses,
                                [field.id]: e.target.value,
                              });
                            }}
                            onFocus={(e) => {
                              setTimeout(() => {
                                e.target.scrollIntoView({ behavior: 'smooth', block: 'center' });
                              }, 300);
                            }}
                            className="bg-slate-50 focus:bg-white"
                            required={field.is_required}
                          />
                        ) : (
                          <Select
                            value={fieldResponses[field.id] || ''}
                            onValueChange={(value) => {
                              setFieldResponses({
                                ...fieldResponses,
                                [field.id]: value,
                              });
                            }}
                            required={field.is_required}
                          >
                            <SelectTrigger className="bg-slate-50 focus:bg-white">
                              <SelectValue placeholder="ì„ íƒí•´ì£¼ì„¸ìš”" />
                            </SelectTrigger>
                            <SelectContent className="z-[9999] bg-white">
                              {(() => {
                                let options: string[] = [];
                                if (field.field_options) {
                                  if (Array.isArray(field.field_options)) {
                                    options = field.field_options;
                                  } else if (typeof field.field_options === 'string') {
                                    try {
                                      options = JSON.parse(field.field_options);
                                    } catch (e) {
                                      console.error('Failed to parse field_options:', e);
                                    }
                                  }
                                }
                                return options.map((option, index) => (
                                  <SelectItem key={index} value={option}>
                                    {option}
                                  </SelectItem>
                                ));
                              })()}
                            </SelectContent>
                          </Select>
                        )}
                      </div>
                    ))}
                  </div>
                )}

                {/* í•˜ë‹¨ ì•¡ì…˜ ë²„íŠ¼ */}
                <div className="flex flex-col gap-3 pt-6 border-t mt-6 pb-2">
                  <Button
                    onClick={() => userId ? handleUserRegister() : handleGuestRegister()}
                    disabled={isLoading || (!guestName.trim() || !guestContact.trim())}
                    className="w-full bg-amber-600 hover:bg-amber-700 text-white font-bold h-12"
                  >
                    {isLoading ? <Loader2 className="mr-2 h-4 w-4 animate-spin" /> : "ëŒ€ê¸°ìë¡œ ë“±ë¡í•˜ê¸°"}
                  </Button>

                  <div className="text-center mt-2">
                    <button
                      onClick={() => setIsDialogOpen(false)}
                      className="text-xs text-slate-400 hover:text-slate-600 underline underline-offset-4"
                    >
                      ì·¨ì†Œí•˜ê³  ë‹«ê¸°
                    </button>
                  </div>
                </div>
              </div>
            )}
          </DialogContent>
        </Dialog>
      </>
    );
  }

  // 4. ê¸°ë³¸ ìƒíƒœ (ë²„íŠ¼)
  return (
    <>
      <div className="space-y-3">
        <Button
          onClick={() => handleOpenDialog(false)}
          disabled={isLoading}
          className="w-full bg-slate-900 hover:bg-slate-800 text-white font-bold text-base h-12 shadow-md hover:shadow-lg transition-all hover:-translate-y-0.5"
        >
          {isLoading ? <Loader2 className="mr-2 h-5 w-5 animate-spin" /> : "ì°¸ê°€ ì‹ ì²­í•˜ê¸°"}
        </Button>
      </div>

      {/* ì‹ ì²­ ì •ë³´ ì…ë ¥ ëª¨ë‹¬ */}
      <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>
        <DialogContent className="max-w-2xl max-h-[90vh] md:max-h-[85vh] overflow-y-auto overscroll-contain">
          <DialogHeader>
            <DialogTitle>ì°¸ê°€ ì‹ ì²­ì„œ</DialogTitle>
            <DialogDescription>ì´ë²¤íŠ¸ ì°¸ê°€ ì‹ ì²­ì„ ìœ„í•´ ì•„ë˜ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</DialogDescription>
          </DialogHeader>

          {isLoadingFields ? (
            <div className="flex flex-col items-center justify-center py-12">
              <Loader2 className="h-8 w-8 animate-spin text-slate-400 mb-2" />
              <p className="text-sm text-slate-500">ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            </div>
          ) : (
            <div className="space-y-6 mt-4 pb-4">
              {/* ë¹„ë¡œê·¸ì¸ ì‚¬ìš©ì ë¡œê·¸ì¸ ìœ ë„ */}
              {!userId && (
                <div className="rounded-lg bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 p-4">
                  <Button
                    variant="outline"
                    className="w-full border-blue-300 bg-white hover:bg-blue-50 text-blue-700 font-semibold h-11"
                    onClick={() => {
                      setIsDialogOpen(false);
                      router.push("/auth/login");
                    }}
                  >
                    <LogIn className="mr-2 h-4 w-4" />
                    ë¡œê·¸ì¸í•˜ê³  ì‹ ì²­í•˜ê¸° (ì¶”ì²œ)
                  </Button>
                </div>
              )}

              {/* ì…ë ¥ í¼ */}
              <div className="space-y-4">
                <div>
                  <Label htmlFor="guestName">ì´ë¦„ <span className="text-red-500">*</span></Label>
                  <Input
                    id="guestName"
                    value={guestName}
                    onChange={(e) => setGuestName(e.target.value)}
                    onFocus={(e) => {
                      setTimeout(() => {
                        e.target.scrollIntoView({ behavior: 'smooth', block: 'center' });
                      }, 300);
                    }}
                    placeholder="ì„±í•¨ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"
                    className="mt-1.5 h-11 bg-slate-50"
                  />
                </div>
                <div>
                  <Label htmlFor="guestContact">ì—°ë½ì²˜ <span className="text-red-500">*</span></Label>
                  <Input
                    id="guestContact"
                    value={guestContact}
                    onChange={(e) => setGuestContact(e.target.value)}
                    onFocus={(e) => {
                      setTimeout(() => {
                        e.target.scrollIntoView({ behavior: 'smooth', block: 'center' });
                      }, 300);
                    }}
                    placeholder="010-0000-0000"
                    className="mt-1.5 h-11 bg-slate-50"
                  />
                </div>
              </div>

              {/* ì»¤ìŠ¤í…€ í•„ë“œ */}
              {customFields.length > 0 && (
                <div className="space-y-4 pt-4 border-t border-slate-200">
                  <h3 className="text-sm font-semibold text-slate-900">ì¶”ê°€ ì§ˆë¬¸</h3>
                  {customFields.map((field) => (
                    <div key={field.id} className="space-y-2">
                      <Label className="text-sm font-semibold text-slate-700">
                        {field.field_name}
                        {field.is_required && <span className="text-red-500 ml-1">*</span>}
                      </Label>

                      {field.field_type === 'text' ? (
                        <Input
                          placeholder="ë‹µë³€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"
                          value={fieldResponses[field.id] || ''}
                          onChange={(e) => {
                            setFieldResponses({
                              ...fieldResponses,
                              [field.id]: e.target.value,
                            });
                          }}
                          onFocus={(e) => {
                            setTimeout(() => {
                              e.target.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            }, 300);
                          }}
                          className="bg-slate-50 focus:bg-white"
                          required={field.is_required}
                        />
                      ) : (
                        <Select
                          value={fieldResponses[field.id] || ''}
                          onValueChange={(value) => {
                            setFieldResponses({
                              ...fieldResponses,
                              [field.id]: value,
                            });
                          }}
                          required={field.is_required}
                        >
                          <SelectTrigger className="bg-slate-50 focus:bg-white">
                            <SelectValue placeholder="ì„ íƒí•´ì£¼ì„¸ìš”" />
                          </SelectTrigger>
                          <SelectContent className="z-[9999] bg-white">
                            {(() => {
                              let options: string[] = [];
                              if (field.field_options) {
                                if (Array.isArray(field.field_options)) {
                                  options = field.field_options;
                                } else if (typeof field.field_options === 'string') {
                                  try {
                                    options = JSON.parse(field.field_options);
                                  } catch (e) {
                                    console.error('Failed to parse field_options:', e);
                                  }
                                }
                              }
                              return options.map((option, index) => (
                                <SelectItem key={index} value={option}>
                                  {option}
                                </SelectItem>
                              ));
                            })()}
                          </SelectContent>
                        </Select>
                      )}
                    </div>
                  ))}
                </div>
              )}

              {/* í•˜ë‹¨ ì•¡ì…˜ ë²„íŠ¼ */}
              <div className="flex flex-col gap-3 pt-6 border-t mt-6 pb-2">
                <Button
                  onClick={() => userId ? handleUserRegister() : handleGuestRegister()}
                  disabled={isLoading || (!guestName.trim() || !guestContact.trim())}
                  className="w-full bg-slate-900 hover:bg-slate-800 text-white font-bold h-12"
                >
                  {isLoading ? <Loader2 className="mr-2 h-4 w-4 animate-spin" /> : "ì‹ ì²­ ì™„ë£Œ"}
                </Button>

                <div className="text-center mt-2">
                  <button
                    onClick={() => setIsDialogOpen(false)}
                    className="text-xs text-slate-400 hover:text-slate-600 underline underline-offset-4"
                  >
                    ì·¨ì†Œí•˜ê³  ë‹«ê¸°
                  </button>
                </div>
              </div>
            </div>
          )}
        </DialogContent>
      </Dialog>
    </>
  );
}
</file>

<file path="components/site-header-client.tsx">
"use client"

import Link from "next/link"
import { useRouter } from "next/navigation"
import { useState, useEffect } from "react"
import {
    Bell,
    Plus,
    Settings,
    LogOut,
    User,
    PenSquare,
    Calendar,
    Users,
    Search
} from "lucide-react"
import { Button } from "@/components/ui/button"
import {
    DropdownMenu,
    DropdownMenuContent,
    DropdownMenuItem,
    DropdownMenuLabel,
    DropdownMenuSeparator,
    DropdownMenuTrigger
} from "@/components/ui/dropdown-menu"
import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar"
import { NotificationsDropdown } from "@/components/notifications-dropdown"
import { createClient, resetClient } from "@/lib/supabase/client"
import { Input } from "@/components/ui/input"

interface SiteHeaderClientProps {
    user: any
    profile: any
    initialNotifications?: any[]
}

export function SiteHeaderClient({ user, profile, initialNotifications = [] }: SiteHeaderClientProps) {
    const router = useRouter()
    const supabase = createClient()
    const [activeCreateItem, setActiveCreateItem] = useState<"post" | "event" | "community" | null>(null)
    const [activeProfileItem, setActiveProfileItem] = useState<"profile" | "settings" | "logout" | null>(null)

    const handleSignOut = () => {
        // 1. ì¿ í‚¤ ì‚­ì œ
        document.cookie.split(";").forEach((c) => {
            document.cookie = c
                .replace(/^ +/, "")
                .replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/")
        })

        // 2. localStorage í´ë¦¬ì–´
        localStorage.clear()

        // 3. Supabase í´ë¼ì´ì–¸íŠ¸ ì¸ìŠ¤í„´ìŠ¤ ì´ˆê¸°í™” (ì‹±ê¸€í†¤ ë¦¬ì…‹)
        resetClient()

        // 4. ë¦¬ë””ë ‰ì…˜
        window.location.href = "/"
    }

    return (
        <div className="flex flex-1 items-center justify-end gap-4">

            {/* Right: Actions */}
            <div className="flex items-center gap-2">
                {user ? (
                    <>
                        {/* ë§Œë“¤ê¸° ë²„íŠ¼ (Dropdown) */}
                        <DropdownMenu>
                            <DropdownMenuTrigger asChild>
                                <Button variant="ghost" size="sm" className="hidden md:flex gap-1.5 h-9 rounded-full px-3 hover:bg-slate-100">
                                    <Plus className="h-5 w-5" />
                                    <span className="font-medium">ë§Œë“¤ê¸°</span>
                                </Button>
                            </DropdownMenuTrigger>
                            <DropdownMenuContent
                                align="end"
                                sideOffset={10}
                                className="z-[70] w-52 bg-white shadow-lg border border-slate-200"
                                onMouseLeave={() => setActiveCreateItem(null)}
                            >
                                <DropdownMenuItem
                                    onClick={() => router.push("/community/new")}
                                    onMouseEnter={() => setActiveCreateItem("post")}
                                    className={activeCreateItem === "post" ? "bg-slate-100 text-slate-900 font-semibold" : "text-slate-600"}
                                >
                                    <PenSquare className={`mr-2 h-4 w-4 ${activeCreateItem === "post" ? "text-slate-900" : "text-slate-500"}`} />
                                    <span>ìƒˆ ê¸€ ì“°ê¸°</span>
                                </DropdownMenuItem>
                                <DropdownMenuItem
                                    onClick={() => router.push("/e/new")}
                                    onMouseEnter={() => setActiveCreateItem("event")}
                                    className={activeCreateItem === "event" ? "bg-slate-100 text-slate-900 font-semibold" : "text-slate-600"}
                                >
                                    <Calendar className={`mr-2 h-4 w-4 ${activeCreateItem === "event" ? "text-slate-900" : "text-slate-500"}`} />
                                    <span>ìƒˆ ì´ë²¤íŠ¸</span>
                                </DropdownMenuItem>
                                <DropdownMenuItem
                                    onClick={() => router.push("/communities/new")}
                                    onMouseEnter={() => setActiveCreateItem("community")}
                                    className={activeCreateItem === "community" ? "bg-slate-100 text-slate-900 font-semibold" : "text-slate-600"}
                                >
                                    <Users className={`mr-2 h-4 w-4 ${activeCreateItem === "community" ? "text-slate-900" : "text-slate-500"}`} />
                                    <span>ìƒˆ ì»¤ë®¤ë‹ˆí‹°</span>
                                </DropdownMenuItem>
                            </DropdownMenuContent>
                        </DropdownMenu>

                        {/* ëª¨ë°”ì¼ìš© ë§Œë“¤ê¸° ì•„ì´ì½˜ */}
                        <DropdownMenu>
                            <DropdownMenuTrigger asChild>
                                <Button variant="ghost" size="icon" className="md:hidden h-9 w-9 rounded-full">
                                    <Plus className="h-6 w-6" />
                                </Button>
                            </DropdownMenuTrigger>
                            <DropdownMenuContent
                                align="end"
                                sideOffset={10}
                                className="z-[70] bg-white shadow-lg border border-slate-200"
                            >
                                <DropdownMenuItem onClick={() => router.push("/community/new")}>
                                    ìƒˆ ê¸€ ì“°ê¸°
                                </DropdownMenuItem>
                                <DropdownMenuItem onClick={() => router.push("/e/new")}>
                                    ìƒˆ ì´ë²¤íŠ¸
                                </DropdownMenuItem>
                                <DropdownMenuItem onClick={() => router.push("/communities/new")}>
                                    ìƒˆ ì»¤ë®¤ë‹ˆí‹°
                                </DropdownMenuItem>
                            </DropdownMenuContent>
                        </DropdownMenu>

                        {/* ì•Œë¦¼ */}
                        <NotificationsDropdown
                            triggerClassName="h-9 w-9 rounded-full"
                            align="end"
                            initialUser={user}
                            initialNotifications={initialNotifications}
                        />

                        {/* í”„ë¡œí•„ ë“œë¡­ë‹¤ìš´ */}
                        <DropdownMenu>
                            <DropdownMenuTrigger asChild>
                                <Button variant="ghost" className="relative h-9 w-9 rounded-full p-0 ml-1 border border-slate-200 overflow-hidden">
                                    <Avatar className="h-9 w-9">
                                        <AvatarImage src={profile?.avatar_url || ""} alt={profile?.full_name || ""} />
                                        <AvatarFallback className="bg-slate-100 text-slate-600 font-medium">
                                            {profile?.full_name?.[0] || user.email?.[0]?.toUpperCase()}
                                        </AvatarFallback>
                                    </Avatar>
                                </Button>
                            </DropdownMenuTrigger>
                            <DropdownMenuContent
                                className="w-56 z-[70] bg-white shadow-lg border border-slate-200"
                                align="end"
                                sideOffset={10}
                                forceMount
                                onMouseLeave={() => setActiveProfileItem(null)}
                            >
                                <DropdownMenuLabel className="font-normal">
                                    <div className="flex flex-col space-y-1">
                                        <p className="text-sm font-medium leading-none">{profile?.full_name || "ì‚¬ìš©ì"}</p>
                                        <p className="text-xs leading-none text-muted-foreground">
                                            {user.email}
                                        </p>
                                    </div>
                                </DropdownMenuLabel>
                                <DropdownMenuSeparator />
                                <DropdownMenuItem
                                    onClick={() => router.push("/community/profile")}
                                    onMouseEnter={() => setActiveProfileItem("profile")}
                                    className={activeProfileItem === "profile" ? "bg-slate-100 text-slate-900 font-semibold" : "text-slate-600"}
                                >
                                    <User className={`mr-2 h-4 w-4 ${activeProfileItem === "profile" ? "text-slate-900" : "text-slate-500"}`} />
                                    <span>ë‚´ í”„ë¡œí•„</span>
                                </DropdownMenuItem>
                                <DropdownMenuItem
                                    onClick={() => router.push("/settings")}
                                    onMouseEnter={() => setActiveProfileItem("settings")}
                                    className={activeProfileItem === "settings" ? "bg-slate-100 text-slate-900 font-semibold" : "text-slate-600"}
                                >
                                    <Settings className={`mr-2 h-4 w-4 ${activeProfileItem === "settings" ? "text-slate-900" : "text-slate-500"}`} />
                                    <span>ì„¤ì •</span>
                                </DropdownMenuItem>
                                <DropdownMenuSeparator />
                                <DropdownMenuItem
                                    className={`text-red-600 ${activeProfileItem === "logout" ? "bg-red-50 font-semibold" : ""}`}
                                    onClick={handleSignOut}
                                    onMouseEnter={() => setActiveProfileItem("logout")}
                                >
                                    <LogOut className={`mr-2 h-4 w-4 ${activeProfileItem === "logout" ? "text-red-600" : "text-slate-500"}`} />
                                    <span>ë¡œê·¸ì•„ì›ƒ</span>
                                </DropdownMenuItem>
                            </DropdownMenuContent>
                        </DropdownMenu>
                    </>
                ) : (
                    <div className="flex items-center gap-2">
                        <Link href="/auth/login">
                            <Button
                                variant="ghost"
                                className="rounded-full hover:bg-slate-100 hover:text-slate-900"
                            >
                                ë¡œê·¸ì¸
                            </Button>
                        </Link>
                        <Link href="/auth/login">
                            <Button className="rounded-full hover:bg-slate-100 hover:text-slate-900 transition-colors">
                                ê°€ì…í•˜ê¸°
                            </Button>
                        </Link>
                    </div>
                )}
            </div>
        </div>
    )
}
</file>

<file path="components/threaded-comments.tsx">
"use client"

import { useState } from "react"
import { Button } from "@/components/ui/button"
import { Textarea } from "@/components/ui/textarea"
import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar"
import { CommentNode, createComment, deleteComment } from "@/lib/actions/comments"
import { cn } from "@/lib/utils"
import { Trash2 } from "lucide-react"
import { ProfilePopover } from "@/components/ui/profile-popover"

type ThreadedCommentsProps = {
  postId: string
  userId?: string
  comments: CommentNode[]
}

export function ThreadedComments({ postId, userId, comments }: ThreadedCommentsProps) {
  const [tree, setTree] = useState<CommentNode[]>(comments)

  const handleAdd = async (content: string, parentId: string | null) => {
    if (!content.trim()) return
    const optimistic: CommentNode = {
      id: `temp-${Math.random().toString(36).slice(2)}`,
      post_id: postId,
      author_id: userId || "",
      content,
      created_at: new Date().toISOString(),
      parent_id: parentId,
      depth: parentId ? 1 : 0,
      profiles: undefined,
      children: [],
    }
    setTree((prev) => insertIntoTree(prev, optimistic))
    try {
      const saved = await createComment({ postId, content, parentId })
      setTree((prev) => replaceTemp(prev, optimistic.id, saved))
    } catch (e) {
      // ì‹¤íŒ¨ ì‹œ ë¡¤ë°±
      setTree((prev) => removeNode(prev, optimistic.id))
      console.error(e)
    }
  }

  const handleDelete = async (commentId: string) => {
    if (!confirm("ëŒ“ê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return
    setTree((prev) => removeNode(prev, commentId))
    try {
      await deleteComment(commentId)
    } catch (e) {
      console.error(e)
      // ì‹¤íŒ¨ ì‹œ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
      window.location.reload()
    }
  }

  return (
    <div className="space-y-4">
      <CommentForm postId={postId} userId={userId} onSubmit={(c) => handleAdd(c, null)} />
      <div className="space-y-4">
        {tree.map((comment) => (
          <CommentItem key={comment.id} comment={comment} depth={0} onReply={(c) => handleAdd(c, comment.id)} userId={userId} onDelete={handleDelete} />
        ))}
      </div>
    </div>
  )
}

function CommentItem({ comment, depth, onReply, userId, onDelete }: { comment: CommentNode; depth: number; onReply: (content: string) => void; userId?: string; onDelete: (commentId: string) => void }) {
  const [showReply, setShowReply] = useState(false)
  const isAuthor = userId && comment.author_id === userId

  const avatarContent = (
    <Avatar className="h-8 w-8">
      <AvatarImage src={comment.profiles?.avatar_url || undefined} />
      <AvatarFallback className="bg-slate-100 text-slate-500 text-xs font-semibold">
        {comment.profiles?.full_name?.[0] || "U"}
      </AvatarFallback>
    </Avatar>
  )

  return (
    <div className={cn("space-y-2", depth > 0 && "border-l border-slate-200 pl-4")}>
      <div className="flex items-start gap-3">
        {comment.profiles?.id ? (
          <ProfilePopover profile={comment.profiles}>
            <button type="button" className="cursor-pointer hover:opacity-80 transition-opacity">
              {avatarContent}
            </button>
          </ProfilePopover>
        ) : (
          avatarContent
        )}
        <div className="flex-1 min-w-0">
          <div className="flex items-center gap-2 text-xs text-slate-500">
            {comment.profiles?.id ? (
              <ProfilePopover profile={comment.profiles}>
                <button type="button" className="font-semibold text-slate-900 text-sm hover:underline cursor-pointer">
                  {comment.profiles?.full_name || "ìµëª…"}
                </button>
              </ProfilePopover>
            ) : (
              <span className="font-semibold text-slate-900 text-sm">{comment.profiles?.full_name || "ìµëª…"}</span>
            )}
            <span>{new Date(comment.created_at).toLocaleString("ko-KR", { month: "short", day: "numeric", hour: "2-digit", minute: "2-digit" })}</span>
          </div>
          <p className="mt-1 text-sm text-slate-700 whitespace-pre-wrap">{comment.content}</p>
          <div className="mt-2 flex items-center gap-1">
            <Button
              variant="ghost"
              size="sm"
              className="h-auto px-2 py-1 text-xs text-slate-500 hover:text-slate-700"
              onClick={() => setShowReply((v) => !v)}
            >
              ë‹µê¸€ ë‹¬ê¸°
            </Button>
            {isAuthor && (
              <Button
                variant="ghost"
                size="sm"
                className="h-auto px-2 py-1 text-xs text-slate-400 hover:text-red-500"
                onClick={() => onDelete(comment.id)}
              >
                <Trash2 className="h-3 w-3 mr-1" />
                ì‚­ì œ
              </Button>
            )}
          </div>
          {showReply && (
            <div className="mt-2">
              <CommentForm
                postId={comment.post_id}
                userId={userId}
                onSubmit={(c) => {
                  onReply(c)
                  setShowReply(false)
                }}
              />
            </div>
          )}
          {comment.children && comment.children.length > 0 && (
            <div className="mt-3 space-y-3">
              {comment.children.map((child) => (
                <CommentItem key={child.id} comment={child} depth={depth + 1} onReply={(c) => onReply(c)} userId={userId} onDelete={onDelete} />
              ))}
            </div>
          )}
        </div>
      </div>
    </div>
  )
}

function CommentForm({ postId, userId, onSubmit }: { postId: string; userId?: string; onSubmit: (content: string) => void }) {
  const [value, setValue] = useState("")
  const [isSubmitting, setSubmitting] = useState(false)

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    if (!value.trim()) return
    setSubmitting(true)
    try {
      await onSubmit(value.trim())
      setValue("")
    } finally {
      setSubmitting(false)
    }
  }

  if (!userId) {
    return <p className="text-sm text-slate-500">ëŒ“ê¸€ì„ ì‘ì„±í•˜ë ¤ë©´ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>
  }

  return (
    <form onSubmit={handleSubmit} className="space-y-2">
      <Textarea
        value={value}
        onChange={(e) => setValue(e.target.value)}
        placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”"
        rows={2}
        className="text-sm"
      />
      <div className="flex justify-end">
        <Button type="submit" size="sm" disabled={isSubmitting || !value.trim()}>
          {isSubmitting ? "ë“±ë¡ ì¤‘..." : "ëŒ“ê¸€ ë“±ë¡"}
        </Button>
      </div>
    </form>
  )
}

// Helpers
function insertIntoTree(tree: CommentNode[], node: CommentNode): CommentNode[] {
  if (!node.parent_id) {
    return [...tree, { ...node, children: [] }]
  }
  return tree.map((item) => {
    if (item.id === node.parent_id) {
      return { ...item, children: [...(item.children || []), { ...node, children: [] }] }
    }
    if (item.children && item.children.length > 0) {
      return { ...item, children: insertIntoTree(item.children, node) }
    }
    return item
  })
}

function replaceTemp(tree: CommentNode[], tempId: string, saved: CommentNode): CommentNode[] {
  return tree.map((item) => {
    if (item.id === tempId) return { ...saved, children: item.children || [] }
    if (item.children && item.children.length > 0) {
      return { ...item, children: replaceTemp(item.children, tempId, saved) }
    }
    return item
  })
}

function removeNode(tree: CommentNode[], nodeId: string): CommentNode[] {
  return tree
    .filter((item) => item.id !== nodeId)
    .map((item) => (item.children ? { ...item, children: removeNode(item.children, nodeId) } : item))
}
</file>

<file path="components/ui/profile-popover.tsx">
"use client"

import { Popover, PopoverContent, PopoverTrigger } from "@/components/ui/popover"
import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar"
import { Button } from "@/components/ui/button"
import { UserBadges } from "@/components/user-badges"
import Link from "next/link"

interface ProfilePopoverProps {
  children: React.ReactNode
  profile: {
    id: string
    full_name: string | null
    avatar_url: string | null
    bio?: string | null
    company?: string | null
    position?: string | null
    tagline?: string | null
  }
  badges?: { icon: string; name: string }[]
}

export function ProfilePopover({ children, profile, badges }: ProfilePopoverProps) {
  // profileì´ ì—†ê±°ë‚˜ idê°€ ì—†ìœ¼ë©´ childrenë§Œ ë°˜í™˜
  if (!profile?.id) {
    return <>{children}</>
  }

  return (
    <Popover>
      <PopoverTrigger asChild>{children}</PopoverTrigger>
      <PopoverContent className="w-72 p-0 bg-white border-slate-200 shadow-lg" align="start" sideOffset={8}>
        {/* í—¤ë” ë°°ê²½ */}
        <div className="h-14 bg-gradient-to-r from-slate-100 to-slate-50 rounded-t-lg" />

        {/* í”„ë¡œí•„ ì •ë³´ */}
        <div className="px-4 pb-4">
          {/* ì•„ë°”íƒ€ (ë°°ê²½ ìœ„ë¡œ ì˜¬ë¼ê°) */}
          <Avatar className="h-14 w-14 -mt-7 border-4 border-white shadow-sm">
            <AvatarImage src={profile.avatar_url || undefined} />
            <AvatarFallback className="bg-slate-100 text-slate-600 text-lg font-bold">
              {profile.full_name?.[0] || "U"}
            </AvatarFallback>
          </Avatar>

          {/* ì´ë¦„ + ë°°ì§€ */}
          <div className="mt-2">
            <div className="flex items-center gap-2">
              <h4 className="font-bold text-slate-900">{profile.full_name || "ìµëª…"}</h4>
              {badges && badges.length > 0 && <UserBadges badges={badges} />}
            </div>

            {/* ì§ì±… */}
            {(profile.company || profile.position) && (
              <p className="text-sm text-slate-500 mt-0.5">
                {[profile.position, profile.company].filter(Boolean).join(" @ ")}
              </p>
            )}
          </div>

          {/* í•œ ì¤„ ì†Œê°œ */}
          {profile.tagline && (
            <p className="text-sm text-slate-600 mt-2 line-clamp-2 italic">"{profile.tagline}"</p>
          )}

          {/* í”„ë¡œí•„ ë³´ê¸° ë²„íŠ¼ */}
          <Button asChild variant="outline" className="w-full mt-3" size="sm">
            <Link href={`/community/profile/${profile.id}`}>í”„ë¡œí•„ ë³´ê¸°</Link>
          </Button>
        </div>
      </PopoverContent>
    </Popover>
  )
}
</file>

<file path="lib/utils/unsplash.ts">
/**
 * Unsplash ë°°ë„ˆ ì´ë¯¸ì§€ í—¬í¼
 * ì»¤ë®¤ë‹ˆí‹° ì„¤ëª…ì— ê¸°ë°˜í•˜ì—¬ ì ì ˆí•œ ë°°ë„ˆ ì´ë¯¸ì§€ë¥¼ ì œì•ˆ
 */

// í‚¤ì›Œë“œ â†’ Unsplash ê²€ìƒ‰ì–´ ë§¤í•‘
const UNSPLASH_KEYWORDS: Record<string, string> = {
  // ê¸°ìˆ /ê°œë°œ
  'ê¸°ìˆ ': 'technology,coding',
  'ê°œë°œ': 'programming,code',
  'ì½”ë”©': 'coding,developer',
  'AI': 'artificial-intelligence,technology',
  'ìŠ¤íƒ€íŠ¸ì—…': 'startup,office',

  // ë¹„ì¦ˆë‹ˆìŠ¤
  'ë¹„ì¦ˆë‹ˆìŠ¤': 'business,office',
  'ì‚¬ì—…': 'business,entrepreneur',
  'ì°½ì—…': 'startup,entrepreneurship',
  'íˆ¬ì': 'finance,investment',
  'ë§ˆì¼€íŒ…': 'marketing,digital',

  // ë¼ì´í”„ìŠ¤íƒ€ì¼
  'ìŒì•…': 'music,concert',
  'ìš´ë™': 'fitness,sports',
  'ì—¬í–‰': 'travel,adventure',
  'ìŒì‹': 'food,culinary',
  'ë…ì„œ': 'books,library',
  'ê²Œì„': 'gaming,esports',
  'ì˜í™”': 'cinema,film',
  'ì‚¬ì§„': 'photography,camera',

  // ì»¤ë®¤ë‹ˆí‹°/ì†Œì…œ
  'ë„¤íŠ¸ì›Œí‚¹': 'networking,meetup',
  'ëª¨ì„': 'community,gathering',
  'í† ë¡ ': 'discussion,debate',

  // ê¸°ë³¸ê°’
  'default': 'community,collaboration,teamwork'
}

// Unsplash ì´ë¯¸ì§€ ID ëª©ë¡ (API í˜¸ì¶œ ëŒ€ì‹  ì •ì  ì´ë¯¸ì§€ ì‚¬ìš©)
const UNSPLASH_IMAGES: Record<string, string[]> = {
  'technology': [
    'photo-1518770660439-4636190af475', // circuit board
    'photo-1550751827-4bd374c3f58b', // laptop
    'photo-1531297484001-80022131f5a1', // tech workspace
  ],
  'business': [
    'photo-1507003211169-0a1dd7228f2d', // office
    'photo-1522071820081-009f0129c71c', // team meeting
    'photo-1542744173-8e7e53415bb0', // conference
  ],
  'startup': [
    'photo-1559136555-9303baea8ebd', // startup office
    'photo-1497215842964-222b430dc094', // modern workspace
    'photo-1552664730-d307ca884978', // team collaboration
  ],
  'community': [
    'photo-1529156069898-49953e39b3ac', // group of people
    'photo-1517486808906-6ca8b3f04846', // community gathering
    'photo-1491438590914-bc09fcaaf77a', // people connecting
  ],
  'music': [
    'photo-1511671782779-c97d3d27a1d4', // concert
    'photo-1514320291840-2e0a9bf2a9ae', // music performance
  ],
  'fitness': [
    'photo-1534438327276-14e5300c3a48', // gym
    'photo-1571019614242-c5c5dee9f50b', // workout
  ],
  'food': [
    'photo-1504674900247-0877df9cc836', // food
    'photo-1493770348161-369560ae357d', // cooking
  ],
  'travel': [
    'photo-1469854523086-cc02fe5d8800', // travel
    'photo-1476514525535-07fb3b4ae5f1', // adventure
  ],
  'default': [
    'photo-1521737711867-e3b97375f902', // team collaboration
    'photo-1522071820081-009f0129c71c', // meeting
    'photo-1517245386807-bb43f82c33c4', // workspace
  ]
}

/**
 * ì„¤ëª…ì—ì„œ í‚¤ì›Œë“œë¥¼ ì¶”ì¶œí•˜ì—¬ ì¹´í…Œê³ ë¦¬ ë°˜í™˜
 */
function extractCategory(description: string): string {
  if (!description) return 'default'

  const lowerDesc = description.toLowerCase()

  for (const [keyword, _] of Object.entries(UNSPLASH_KEYWORDS)) {
    if (keyword !== 'default' && lowerDesc.includes(keyword.toLowerCase())) {
      // í‚¤ì›Œë“œì— í•´ë‹¹í•˜ëŠ” ì¹´í…Œê³ ë¦¬ ë°˜í™˜
      if (['ê¸°ìˆ ', 'ê°œë°œ', 'ì½”ë”©', 'AI'].some(k => lowerDesc.includes(k.toLowerCase()))) {
        return 'technology'
      }
      if (['ë¹„ì¦ˆë‹ˆìŠ¤', 'ì‚¬ì—…', 'íˆ¬ì', 'ë§ˆì¼€íŒ…'].some(k => lowerDesc.includes(k.toLowerCase()))) {
        return 'business'
      }
      if (['ì°½ì—…', 'ìŠ¤íƒ€íŠ¸ì—…'].some(k => lowerDesc.includes(k.toLowerCase()))) {
        return 'startup'
      }
      if (['ë„¤íŠ¸ì›Œí‚¹', 'ëª¨ì„', 'í† ë¡ '].some(k => lowerDesc.includes(k.toLowerCase()))) {
        return 'community'
      }
      if (lowerDesc.includes('ìŒì•…')) return 'music'
      if (lowerDesc.includes('ìš´ë™') || lowerDesc.includes('í”¼íŠ¸ë‹ˆìŠ¤')) return 'fitness'
      if (lowerDesc.includes('ìŒì‹') || lowerDesc.includes('ìš”ë¦¬')) return 'food'
      if (lowerDesc.includes('ì—¬í–‰')) return 'travel'
    }
  }

  return 'default'
}

/**
 * ì»¤ë®¤ë‹ˆí‹° ì„¤ëª… ê¸°ë°˜ ê¸°ë³¸ ë°°ë„ˆ URL ìƒì„±
 * @param description ì»¤ë®¤ë‹ˆí‹° ì„¤ëª…
 * @param seed ëœë¤ ì‹œë“œ (ì»¤ë®¤ë‹ˆí‹° ID ë“±)
 * @returns Unsplash ì´ë¯¸ì§€ URL
 */
export function getDefaultBannerUrl(description?: string | null, seed?: string): string {
  const category = extractCategory(description || '')
  const images = UNSPLASH_IMAGES[category] || UNSPLASH_IMAGES['default']

  // seedê°€ ìˆìœ¼ë©´ ì¼ê´€ëœ ì´ë¯¸ì§€ ì„ íƒ, ì—†ìœ¼ë©´ ì²« ë²ˆì§¸ ì´ë¯¸ì§€
  let index = 0
  if (seed) {
    // ê°„ë‹¨í•œ í•´ì‹œ í•¨ìˆ˜ë¡œ ì¼ê´€ëœ ì¸ë±ìŠ¤ ìƒì„±
    let hash = 0
    for (let i = 0; i < seed.length; i++) {
      hash = ((hash << 5) - hash) + seed.charCodeAt(i)
      hash = hash & hash
    }
    index = Math.abs(hash) % images.length
  }

  const imageId = images[index]
  return `https://images.unsplash.com/${imageId}?w=1200&h=300&fit=crop&crop=center`
}

/**
 * ì¹´í…Œê³ ë¦¬ë³„ ì¶”ì²œ ë°°ë„ˆ URL ëª©ë¡ ë°˜í™˜
 * ì„¤ì • ëª¨ë‹¬ì—ì„œ ì„ íƒì§€ë¡œ ë³´ì—¬ì¤„ ë•Œ ì‚¬ìš©
 */
export function getSuggestedBannerUrls(description?: string | null): string[] {
  const category = extractCategory(description || '')
  const images = UNSPLASH_IMAGES[category] || UNSPLASH_IMAGES['default']

  return images.map(imageId =>
    `https://images.unsplash.com/${imageId}?w=1200&h=300&fit=crop&crop=center`
  )
}

/**
 * Unsplash URLì´ ìœ íš¨í•œì§€ í™•ì¸
 */
export function isValidUnsplashUrl(url: string): boolean {
  if (!url) return false
  return url.startsWith('https://images.unsplash.com/') ||
         url.startsWith('https://source.unsplash.com/')
}

// ì•„ì´ì½˜ìš© ì´ë¯¸ì§€ (ì •ì‚¬ê°í˜•)
const UNSPLASH_ICON_IMAGES: Record<string, string[]> = {
  'technology': [
    'photo-1518770660439-4636190af475',
    'photo-1550751827-4bd374c3f58b',
    'photo-1531297484001-80022131f5a1',
    'photo-1485827404703-89b55fcc595e', // robot
    'photo-1526374965328-7f61d4dc18c5', // matrix code
  ],
  'business': [
    'photo-1507003211169-0a1dd7228f2d',
    'photo-1522071820081-009f0129c71c',
    'photo-1486406146926-c627a92ad1ab', // building
    'photo-1454165804606-c3d57bc86b40', // desk
  ],
  'startup': [
    'photo-1559136555-9303baea8ebd',
    'photo-1497215842964-222b430dc094',
    'photo-1553484771-371a605b060b', // lightbulb
  ],
  'community': [
    'photo-1529156069898-49953e39b3ac',
    'photo-1517486808906-6ca8b3f04846',
    'photo-1491438590914-bc09fcaaf77a',
    'photo-1582213782179-e0d53f98f2ca', // hands together
  ],
  'default': [
    'photo-1521737711867-e3b97375f902',
    'photo-1522071820081-009f0129c71c',
    'photo-1517245386807-bb43f82c33c4',
    'photo-1552664730-d307ca884978',
  ]
}

/**
 * ì¹´í…Œê³ ë¦¬ë³„ ì¶”ì²œ ì•„ì´ì½˜ URL ëª©ë¡ ë°˜í™˜
 */
export function getSuggestedIconUrls(description?: string | null): string[] {
  const category = extractCategory(description || '')
  const images = UNSPLASH_ICON_IMAGES[category] || UNSPLASH_ICON_IMAGES['default']

  return images.map(imageId =>
    `https://images.unsplash.com/${imageId}?w=200&h=200&fit=crop&crop=center`
  )
}

/**
 * ê²€ìƒ‰ì–´ë¡œ Unsplash ì´ë¯¸ì§€ ê²€ìƒ‰ (ì •ì  ë§¤í•‘ ê¸°ë°˜)
 * @param query ê²€ìƒ‰ì–´
 * @param type 'banner' | 'icon'
 * @returns ì´ë¯¸ì§€ URL ë°°ì—´
 */
export function searchUnsplashImages(query: string, type: 'banner' | 'icon' = 'banner'): string[] {
  const lowerQuery = query.toLowerCase()
  const results: string[] = []

  // ëª¨ë“  ì¹´í…Œê³ ë¦¬ì—ì„œ ê²€ìƒ‰ì–´ì™€ ê´€ë ¨ëœ ì´ë¯¸ì§€ ì°¾ê¸°
  const imageMap = type === 'icon' ? UNSPLASH_ICON_IMAGES : UNSPLASH_IMAGES
  const size = type === 'icon' ? 'w=200&h=200' : 'w=1200&h=300'

  // í‚¤ì›Œë“œ ë§¤í•‘ í™•ì¸
  for (const [keyword, searchTerms] of Object.entries(UNSPLASH_KEYWORDS)) {
    if (keyword.toLowerCase().includes(lowerQuery) ||
        lowerQuery.includes(keyword.toLowerCase()) ||
        searchTerms.toLowerCase().includes(lowerQuery)) {
      // í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì˜ ì´ë¯¸ì§€ ì¶”ê°€
      let category = 'default'
      if (['ê¸°ìˆ ', 'ê°œë°œ', 'ì½”ë”©', 'ai', 'tech', 'code', 'programming'].some(k =>
        keyword.toLowerCase().includes(k) || lowerQuery.includes(k))) {
        category = 'technology'
      } else if (['ë¹„ì¦ˆë‹ˆìŠ¤', 'ì‚¬ì—…', 'íˆ¬ì', 'ë§ˆì¼€íŒ…', 'business', 'marketing'].some(k =>
        keyword.toLowerCase().includes(k) || lowerQuery.includes(k))) {
        category = 'business'
      } else if (['ì°½ì—…', 'ìŠ¤íƒ€íŠ¸ì—…', 'startup'].some(k =>
        keyword.toLowerCase().includes(k) || lowerQuery.includes(k))) {
        category = 'startup'
      } else if (['ë„¤íŠ¸ì›Œí‚¹', 'ëª¨ì„', 'í† ë¡ ', 'community', 'team'].some(k =>
        keyword.toLowerCase().includes(k) || lowerQuery.includes(k))) {
        category = 'community'
      }

      const images = imageMap[category] || imageMap['default']
      images.forEach(imageId => {
        const url = `https://images.unsplash.com/${imageId}?${size}&fit=crop&crop=center`
        if (!results.includes(url)) {
          results.push(url)
        }
      })
    }
  }

  // ê²°ê³¼ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ ì´ë¯¸ì§€ ë°˜í™˜
  if (results.length === 0) {
    const defaultImages = imageMap['default']
    defaultImages.forEach(imageId => {
      results.push(`https://images.unsplash.com/${imageId}?${size}&fit=crop&crop=center`)
    })
  }

  return results.slice(0, 6) // ìµœëŒ€ 6ê°œ
}

/**
 * ëª¨ë“  ì¹´í…Œê³ ë¦¬ì˜ ì´ë¯¸ì§€ ë°˜í™˜ (ê²€ìƒ‰ì–´ ì—†ì„ ë•Œ)
 */
export function getAllUnsplashImages(type: 'banner' | 'icon' = 'banner'): string[] {
  const imageMap = type === 'icon' ? UNSPLASH_ICON_IMAGES : UNSPLASH_IMAGES
  const size = type === 'icon' ? 'w=200&h=200' : 'w=1200&h=300'
  const results: string[] = []

  for (const images of Object.values(imageMap)) {
    images.forEach(imageId => {
      const url = `https://images.unsplash.com/${imageId}?${size}&fit=crop&crop=center`
      if (!results.includes(url)) {
        results.push(url)
      }
    })
  }

  return results.slice(0, 9) // ìµœëŒ€ 9ê°œ
}
</file>

<file path="middleware.ts">
import { type NextRequest, NextResponse } from "next/server";
import { createServerClient } from "@supabase/ssr";

export async function middleware(request: NextRequest) {
  const pathname = request.nextUrl.pathname;

  // auth ì½œë°±ì€ ê·¸ëŒ€ë¡œ í†µê³¼
  if (pathname.startsWith("/auth/callback")) {
    return NextResponse.next();
  }

  // í™˜ê²½ ë³€ìˆ˜ ê²€ì¦
  const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;
  const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;

  if (!supabaseUrl || !supabaseAnonKey) {
    // í™˜ê²½ ë³€ìˆ˜ ì—†ìœ¼ë©´ ê·¸ëƒ¥ í†µê³¼
    return NextResponse.next();
  }

  let response = NextResponse.next({
    request: {
      headers: request.headers,
    },
  });

  const supabase = createServerClient(
    supabaseUrl,
    supabaseAnonKey,
    {
      cookies: {
        getAll() {
          return request.cookies.getAll();
        },
        setAll(cookiesToSet) {
          cookiesToSet.forEach(({ name, value, options }) => {
            request.cookies.set(name, value);
            response.cookies.set(name, value, options);
          });
        },
      },
    }
  );

  // getSession()ìœ¼ë¡œ ì¿ í‚¤ ê°±ì‹  (DB í˜¸ì¶œ ì—†ìŒ, ë¡œì»¬ JWT ê²€ì¦ë§Œ)
  const { data: { session } } = await supabase.auth.getSession();

  // admin ë¼ìš°íŠ¸ë§Œ getUser()ë¡œ ì‹¤ì œ DB ê²€ì¦ (ì—­í•  í™•ì¸ í•„ìš”)
  let user = session?.user ?? null;
  if (pathname.startsWith("/admin")) {
    const { data } = await supabase.auth.getUser();
    user = data.user;
  }

  // ê´€ë¦¬ì í˜ì´ì§€ ì ‘ê·¼ ì œì–´
  if (pathname.startsWith("/admin")) {
    if (!user) {
      return NextResponse.redirect(new URL("/auth/login", request.url));
    }

    // ê´€ë¦¬ì ì—­í•  ê²€ì¦
    const { data: profile } = await supabase
      .from("profiles")
      .select("role")
      .eq("id", user.id)
      .single();

    const isAdmin = profile?.role === "admin" || profile?.role === "master";
    if (!isAdmin) {
      // ê´€ë¦¬ìê°€ ì•„ë‹ˆë©´ í™ˆìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
      return NextResponse.redirect(new URL("/", request.url));
    }
  }

  return response;
}

export const config = {
  matcher: [
    "/((?!_next/static|_next/image|favicon.ico|.*\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)",
  ],
};
</file>

<file path="app/community/page.tsx">
import Link from "next/link"
import { createClient } from "@/lib/supabase/server"
import { Button } from "@/components/ui/button"
import { Plus } from "lucide-react"
import { CommunityGrid } from "@/components/community/community-grid"
import { ThreeColumnLayout } from "@/components/layout/three-column-layout"
import { StandardRightSidebar } from "@/components/standard-right-sidebar"

export default async function CommunityDashboardPage() {
  const supabase = await createClient()

  // í˜„ì¬ ì‚¬ìš©ì í™•ì¸
  const { data: { user } } = await supabase.auth.getUser()

  // ëª¨ë“  ì»¤ë®¤ë‹ˆí‹° ê°€ì ¸ì˜¤ê¸° (ê³µê°œ ì»¤ë®¤ë‹ˆí‹° + ë¹„ê³µê°œì´ì§€ë§Œ ê°€ì…í•œ ì»¤ë®¤ë‹ˆí‹°)
  const { data: allCommunities } = await supabase
    .from("communities")
    .select("id, name, description, is_private, created_at")
    .order("created_at", { ascending: false })

  // board_categoriesì—ì„œ slug ë§¤í•‘ ê°€ì ¸ì˜¤ê¸°
  const communityNames = (allCommunities || []).map((c) => c.name)
  const { data: boardCategories } = await supabase
    .from("board_categories")
    .select("name, slug")
    .in("name", communityNames)

  // ì‚¬ìš©ìì˜ ë©¤ë²„ì‹­ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
  let userMemberships: any[] = []
  if (user && allCommunities && allCommunities.length > 0) {
    const communityIds = allCommunities.map((c) => c.id)
    const { data: memberships } = await supabase
      .from("community_members")
      .select("community_id, role")
      .eq("user_id", user.id)
      .in("community_id", communityIds)
    userMemberships = memberships || []
  }

  // ì»¤ë®¤ë‹ˆí‹° ë°ì´í„° ë³‘í•© (ê³µê°œ ì»¤ë®¤ë‹ˆí‹° ë˜ëŠ” ê°€ì…í•œ ë¹„ê³µê°œ ì»¤ë®¤ë‹ˆí‹°ë§Œ í‘œì‹œ)
  const mergedCommunities = (allCommunities || [])
    .filter((community) => {
      // ê³µê°œ ì»¤ë®¤ë‹ˆí‹°ëŠ” í•­ìƒ í‘œì‹œ
      if (!community.is_private) return true
      // ë¹„ê³µê°œ ì»¤ë®¤ë‹ˆí‹°ëŠ” ê°€ì…í•œ ê²½ìš°ì—ë§Œ í‘œì‹œ
      return userMemberships.some((m) => m.community_id === community.id)
    })
    .map((community) => {
      const category = boardCategories?.find((c) => c.name === community.name)
      const membership = userMemberships.find((m) => m.community_id === community.id)
      return {
        id: community.id,
        name: community.name,
        description: community.description,
        slug: category?.slug || community.name.toLowerCase().replace(/\s+/g, '-'),
        communityId: community.id,
        isMember: !!membership,
        role: membership?.role || null,
      }
    })

  return (
    <ThreeColumnLayout rightSidebar={<StandardRightSidebar />}>
      <div className="w-full flex flex-col gap-6">
        <div className="flex items-center justify-between pb-2 border-b border-slate-100">
          <h1 className="text-2xl font-bold text-slate-900">ì»¤ë®¤ë‹ˆí‹° ë¦¬ìŠ¤íŠ¸</h1>
          <Link href="/communities/new">
            <Button size="sm" className="gap-1.5 shadow-sm active:scale-95 transition-all">
              <Plus className="h-4 w-4" />
              ìƒˆ ì»¤ë®¤ë‹ˆí‹° ë§Œë“¤ê¸°
            </Button>
          </Link>
        </div>

        <CommunityGrid communities={mergedCommunities} />
      </div>
    </ThreeColumnLayout>
  )
}
</file>

<file path="app/partners/[id]/page.tsx">
import { createClient } from "@/lib/supabase/server"
import { Card, CardContent } from "@/components/ui/card"
import { Badge } from "@/components/ui/badge"
import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar"
import { Button } from "@/components/ui/button"
import { CheckCircle2, ExternalLink } from "lucide-react"
import Image from "next/image"
import Link from "next/link"
import { notFound } from "next/navigation"
import { cn } from "@/lib/utils"

// ì¹´í…Œê³ ë¦¬ ìƒ‰ìƒ ë§¤í•‘ (ê¸°ë³¸ ìƒ‰ìƒ, ì¹´í…Œê³ ë¦¬ ì´ë¦„ì— ë”°ë¼ ë™ì ìœ¼ë¡œ í• ë‹¹)
const getCategoryColor = (categoryName: string, categories: Array<{ name: string }>): string => {
  const colors = [
    "bg-blue-100 text-blue-700",
    "bg-purple-100 text-purple-700",
    "bg-pink-100 text-pink-700",
    "bg-green-100 text-green-700",
    "bg-amber-100 text-amber-700",
    "bg-indigo-100 text-indigo-700",
    "bg-teal-100 text-teal-700",
    "bg-orange-100 text-orange-700",
  ]
  const index = categories.findIndex(cat => cat.name === categoryName)
  return index >= 0 ? colors[index % colors.length] : "bg-slate-100 text-slate-700"
}

// ë”ë¯¸ ë°ì´í„° ì •ì˜
const dummyPartners: Record<string, any> = {
  "dummy-1": {
    id: "dummy-1",
    title: "AWS í´ë¼ìš°ë“œ ì„œë¹„ìŠ¤",
    description: "ì—”í„°í”„ë¼ì´ì¦ˆê¸‰ í´ë¼ìš°ë“œ ì¸í”„ë¼ì™€ AI ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤.",
    content: `
      <h3>ì„œë¹„ìŠ¤ ì†Œê°œ</h3>
      <p>AWSëŠ” ì„¸ê³„ ìµœëŒ€ì˜ í´ë¼ìš°ë“œ ì»´í“¨íŒ… í”Œë«í¼ìœ¼ë¡œ, ìŠ¤íƒ€íŠ¸ì—…ë¶€í„° ëŒ€ê¸°ì—…ê¹Œì§€ ë‹¤ì–‘í•œ ê·œëª¨ì˜ ê¸°ì—…ì— ìµœì í™”ëœ í´ë¼ìš°ë“œ ì†”ë£¨ì…˜ì„ ì œê³µí•©ë‹ˆë‹¤.</p>
      <h3>ì£¼ìš” í˜œíƒ</h3>
      <ul>
        <li>ì²« ë‹¬ í¬ë ˆë”§ $1,000 ì œê³µ</li>
        <li>ì „ë‹´ ê¸°ìˆ  ì§€ì›</li>
        <li>ìŠ¤íƒ€íŠ¸ì—… ì „ìš© í”„ë¡œê·¸ë¨ ì°¸ì—¬ ê¸°íšŒ</li>
      </ul>
    `,
    category: "ê°œë°œ",
    price_range: "ì‚¬ìš©ëŸ‰ ê¸°ë°˜",
    thumbnail_url: null,
    is_verified: true,
    contact_link: "https://aws.amazon.com",
    created_at: new Date().toISOString(),
    profiles: { id: null, full_name: "AWS", avatar_url: null, bio: "Amazon Web Services" },
    benefit: "ì²« ë‹¬ ë¬´ë£Œ"
  },
  "dummy-2": {
    id: "dummy-2",
    title: "ë…¸ì…˜ ì›Œí¬ìŠ¤í˜ì´ìŠ¤",
    description: "íŒ€ í˜‘ì—…ê³¼ ë¬¸ì„œ ê´€ë¦¬ë¥¼ ìœ„í•œ ì˜¬ì¸ì› ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì†”ë£¨ì…˜ì…ë‹ˆë‹¤.",
    content: `
      <h3>ì„œë¹„ìŠ¤ ì†Œê°œ</h3>
      <p>ë…¸ì…˜ì€ ë¬¸ì„œ, ìœ„í‚¤, í”„ë¡œì íŠ¸ ê´€ë¦¬ë¥¼ í•˜ë‚˜ë¡œ í†µí•©í•œ í˜‘ì—… ë„êµ¬ì…ë‹ˆë‹¤. íŒ€ì˜ ëª¨ë“  ì§€ì‹ì„ í•œ ê³³ì—ì„œ ê´€ë¦¬í•˜ì„¸ìš”.</p>
      <h3>ì£¼ìš” í˜œíƒ</h3>
      <ul>
        <li>ì—°ê°„ í”Œëœ 20% í• ì¸</li>
        <li>ë¬´ì œí•œ ê²ŒìŠ¤íŠ¸ ì´ˆëŒ€</li>
        <li>í”„ë¦¬ë¯¸ì—„ í…œí”Œë¦¿ ì œê³µ</li>
      </ul>
    `,
    category: "ê°œë°œ",
    price_range: "ì›” $8ë¶€í„°",
    thumbnail_url: null,
    is_verified: true,
    contact_link: "https://notion.so",
    created_at: new Date().toISOString(),
    profiles: { id: null, full_name: "Notion", avatar_url: null, bio: "All-in-one workspace" },
    benefit: "ì—°ê°„ í”Œëœ 20% í• ì¸"
  },
  "dummy-3": {
    id: "dummy-3",
    title: "ì„¸ë¬´ë²•ì¸ ì „ë¬¸ ìƒë‹´",
    description: "ìŠ¤íƒ€íŠ¸ì—…ê³¼ ì¤‘ì†Œê¸°ì—…ì„ ìœ„í•œ ì„¸ë¬´ ìë¬¸ ë° ì‹ ê³  ëŒ€í–‰ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.",
    content: `
      <h3>ì„œë¹„ìŠ¤ ì†Œê°œ</h3>
      <p>ìŠ¤íƒ€íŠ¸ì—… ì „ë¬¸ ì„¸ë¬´ì‚¬ê°€ ì—¬ëŸ¬ë¶„ì˜ ì‚¬ì—…ì„ ì§€ì›í•©ë‹ˆë‹¤. ë²•ì¸ ì„¤ë¦½ë¶€í„° ì„¸ë¬´ ì‹ ê³ ê¹Œì§€ ì›ìŠ¤í†± ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤.</p>
      <h3>ì£¼ìš” í˜œíƒ</h3>
      <ul>
        <li>ì´ˆê¸° ìƒë‹´ ë¬´ë£Œ</li>
        <li>ì›” ê¸°ì¥ë£Œ 20% í• ì¸</li>
        <li>ê¸´ê¸‰ ì„¸ë¬´ ìƒë‹´ ìš°ì„  ë°°ì •</li>
      </ul>
    `,
    category: "íšŒê³„",
    price_range: "ì›” 20ë§Œì›ë¶€í„°",
    thumbnail_url: null,
    is_verified: false,
    contact_link: null,
    created_at: new Date().toISOString(),
    profiles: { id: null, full_name: "ì„¸ë¬´ë²•ì¸", avatar_url: null, bio: "ìŠ¤íƒ€íŠ¸ì—… ì „ë¬¸ ì„¸ë¬´ ì„œë¹„ìŠ¤" },
    benefit: "ì´ˆê¸° ìƒë‹´ ë¬´ë£Œ"
  },
  "dummy-4": {
    id: "dummy-4",
    title: "ë²•ë¬´ë²•ì¸ ë²•ë¥  ìë¬¸",
    description: "ê¸°ì—…ë²•ë¬´, ê³„ì•½ ê²€í† , ì§€ì ì¬ì‚°ê¶Œ ë“± ì „ë¬¸ ë²•ë¥  ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤.",
    content: `
      <h3>ì„œë¹„ìŠ¤ ì†Œê°œ</h3>
      <p>ìŠ¤íƒ€íŠ¸ì—…ê³¼ ì¤‘ì†Œê¸°ì—…ì„ ìœ„í•œ ë§ì¶¤í˜• ë²•ë¥  ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤. ê³„ì•½ì„œ ê²€í† ë¶€í„° íˆ¬ì ìœ ì¹˜ê¹Œì§€ í•¨ê»˜í•©ë‹ˆë‹¤.</p>
      <h3>ì£¼ìš” í˜œíƒ</h3>
      <ul>
        <li>ì²« ìƒë‹´ 50% í• ì¸</li>
        <li>ê³„ì•½ì„œ ê²€í†  ìš°ì„  ì²˜ë¦¬</li>
        <li>ì •ê¸° ë²•ë¥  ìë¬¸ íŒ¨í‚¤ì§€ í• ì¸</li>
      </ul>
    `,
    category: "ë²•ë¥ ",
    price_range: "ìƒë‹´ í›„ ê²°ì •",
    thumbnail_url: null,
    is_verified: false,
    contact_link: null,
    created_at: new Date().toISOString(),
    profiles: { id: null, full_name: "ë²•ë¬´ë²•ì¸", avatar_url: null, bio: "ê¸°ì—… ì „ë¬¸ ë²•ë¥  ì„œë¹„ìŠ¤" },
    benefit: "ì²« ìƒë‹´ 50% í• ì¸"
  }
}

export default async function PartnerServiceDetailPage({
  params,
}: {
  params: Promise<{ id: string }>
}) {
  const { id } = await params
  const supabase = await createClient()

  // ë”ë¯¸ ë°ì´í„° ì²´í¬
  const isDummy = id.startsWith("dummy-")

  // íŒŒíŠ¸ë„ˆ ì¹´í…Œê³ ë¦¬ ê°€ì ¸ì˜¤ê¸°
  const { data: partnerCategories } = await supabase
    .from("categories")
    .select("id, name, type")
    .eq("type", "partner")
    .order("created_at", { ascending: true })

  // ì¹´í…Œê³ ë¦¬ ì´ë¦„ ë§¤í•‘ ìƒì„±
  const categoryLabels: Record<string, string> = {}
  if (partnerCategories) {
    partnerCategories.forEach(cat => {
      categoryLabels[cat.name] = cat.name
    })
  }

  let service: any = null

  if (isDummy) {
    // ë”ë¯¸ ë°ì´í„° ì‚¬ìš©
    service = dummyPartners[id]
  } else {
    // ì‹¤ì œ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì¡°íšŒ
    const { data } = await supabase
      .from("partner_services")
      .select(`
        *,
        profiles:provider_id (
          id,
          full_name,
          avatar_url,
          bio
        )
      `)
      .eq("id", id)
      .single()
    service = data
  }

  if (!service) {
    notFound()
  }

  return (
    <div className="w-full flex flex-col gap-8">
        {/* ì¸ë„¤ì¼ ì´ë¯¸ì§€ */}
        <div className="relative aspect-video w-full rounded-xl overflow-hidden">
          {service.thumbnail_url ? (
            <Image
              src={service.thumbnail_url}
              alt={service.title}
              fill
              sizes="(max-width: 768px) 100vw, 66vw"
              className="object-cover"
            />
          ) : (
            <div className="absolute inset-0 bg-gradient-to-br from-slate-200 to-slate-300" />
          )}
          <div className="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent" />
          <div className="absolute bottom-6 left-6 right-6">
            <div className="flex items-center gap-3 mb-3">
              {service.is_verified && (
                <Badge className="bg-blue-600 text-white border-none shadow-md">
                  <CheckCircle2 className="h-3 w-3 mr-1" />
                  SFC ì¸ì¦
                </Badge>
              )}
              <Badge className={cn(
                "border-none shadow-sm",
                getCategoryColor(service.category, partnerCategories || [])
              )}>
                {categoryLabels[service.category] || service.category || "ê¸°íƒ€"}
              </Badge>
            </div>
            <h1 className="text-3xl md:text-4xl font-bold text-white mb-2">
              {service.title}
            </h1>
            <p className="text-lg text-white/90">
              {service.description}
            </p>
          </div>
        </div>

        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
          {/* ë©”ì¸ ì½˜í…ì¸  */}
          <div className="lg:col-span-2 space-y-6">
            {/* ì œê³µì ì •ë³´ */}
            <Card>
              <CardContent className="p-6">
                <div className="flex items-center gap-4">
                  <Avatar className="h-16 w-16">
                    <AvatarImage src={service.profiles?.avatar_url || undefined} />
                    <AvatarFallback className="bg-blue-100 text-blue-600 text-xl font-bold">
                      {service.profiles?.full_name?.[0] || "U"}
                    </AvatarFallback>
                  </Avatar>
                  <div className="flex-1">
                    <h3 className="text-lg font-bold text-slate-900 mb-1">
                      {service.profiles?.full_name || "ì œê³µì"}
                    </h3>
                    {service.profiles?.bio && (
                      <p className="text-sm text-slate-600">
                        {service.profiles.bio}
                      </p>
                    )}
                  </div>
                  {service.profiles?.id && (
                    <Link href={`/member/${service.profiles.id}`}>
                      <Button variant="outline" size="sm">
                        í”„ë¡œí•„ ë³´ê¸°
                      </Button>
                    </Link>
                  )}
                </div>
              </CardContent>
            </Card>

            {/* ì„œë¹„ìŠ¤ ìƒì„¸ ì„¤ëª… */}
            {service.content && (
              <Card>
                <CardContent className="p-6">
                  <h2 className="text-xl font-bold text-slate-900 mb-4">
                    ì„œë¹„ìŠ¤ ìƒì„¸
                  </h2>
                  <div
                    className="prose prose-slate max-w-none"
                    dangerouslySetInnerHTML={{ __html: service.content }}
                  />
                </CardContent>
              </Card>
            )}
          </div>

          {/* ì‚¬ì´ë“œë°” */}
          <div className="space-y-6">
            {/* ì œíœ´ í˜œíƒ */}
            {service.benefit && (
              <Card className="bg-gradient-to-br from-blue-50 to-indigo-50 border-blue-200">
                <CardContent className="p-6">
                  <h3 className="text-lg font-bold text-blue-900 mb-3">
                    ğŸ ì œíœ´ í˜œíƒ
                  </h3>
                  <div className="text-xl font-bold text-blue-700">
                    {service.benefit}
                  </div>
                </CardContent>
              </Card>
            )}

            {/* ê°€ê²© ì •ë³´ */}
            <Card>
              <CardContent className="p-6">
                <h3 className="text-lg font-bold text-slate-900 mb-4">
                  ê°€ê²© ì •ë³´
                </h3>
                {service.price_range ? (
                  <div className="text-2xl font-bold text-slate-900">
                    {service.price_range}
                  </div>
                ) : (
                  <div className="text-lg text-slate-500">
                    ë¬¸ì˜ í•„ìš”
                  </div>
                )}
              </CardContent>
            </Card>

            {/* ì„œë¹„ìŠ¤ ì •ë³´ */}
            <Card>
              <CardContent className="p-6">
                <h3 className="text-lg font-bold text-slate-900 mb-4">
                  ì„œë¹„ìŠ¤ ì •ë³´
                </h3>
                <div className="space-y-3">
                  <div>
                    <div className="text-xs text-slate-500 mb-1">ì¹´í…Œê³ ë¦¬</div>
                    <Badge className={cn(
                      "border-none",
                      getCategoryColor(service.category, partnerCategories || [])
                    )}>
                      {categoryLabels[service.category] || service.category || "ê¸°íƒ€"}
                    </Badge>
                  </div>
                  <div>
                    <div className="text-xs text-slate-500 mb-1">ë“±ë¡ì¼</div>
                    <div className="text-sm text-slate-900">
                      {new Date(service.created_at).toLocaleDateString('ko-KR', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                      })}
                    </div>
                  </div>
                </div>
              </CardContent>
            </Card>
        </div>
      </div>

      {/* Sticky ë¬¸ì˜í•˜ê¸° ë°” */}
      {service.contact_link && (
        <div className="fixed bottom-0 left-0 right-0 lg:left-72 bg-white border-t border-slate-200 shadow-lg z-50 p-4">
          <div className="max-w-7xl mx-auto flex items-center justify-between">
            <div>
              <div className="text-sm text-slate-500">ì´ ì„œë¹„ìŠ¤ì— ê´€ì‹¬ì´ ìˆìœ¼ì‹ ê°€ìš”?</div>
              <div className="text-lg font-bold text-slate-900">{service.title}</div>
            </div>
            <Button
              size="lg"
              className="bg-slate-900 hover:bg-slate-800 text-white"
              asChild
            >
              <a href={service.contact_link} target="_blank" rel="noopener noreferrer">
                ë¬¸ì˜í•˜ê¸°
                <ExternalLink className="h-4 w-4 ml-2" />
              </a>
            </Button>
          </div>
        </div>
      )}
    </div>
  )
}
</file>

<file path="app/partners/page.tsx">
import { createClient } from "@/lib/supabase/server"
import { Card } from "@/components/ui/card"
import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar"
import { Button } from "@/components/ui/button"
import { Briefcase, Gift } from "lucide-react"
import Link from "next/link"
import Image from "next/image"
import { cn } from "@/lib/utils"
import { PartnerProposalButtonClient } from "@/components/partner-proposal-button-client"
import { PageHeader } from "@/components/page-header"

// ì¹´í…Œê³ ë¦¬ ìƒ‰ìƒ ë§¤í•‘ (ê¸°ë³¸ ìƒ‰ìƒ, ì¹´í…Œê³ ë¦¬ ì´ë¦„ì— ë”°ë¼ ë™ì ìœ¼ë¡œ í• ë‹¹)
const getCategoryColor = (categoryName: string, index: number): string => {
  const colors = [
    "bg-blue-100 text-blue-700",
    "bg-purple-100 text-purple-700",
    "bg-pink-100 text-pink-700",
    "bg-green-100 text-green-700",
    "bg-amber-100 text-amber-700",
    "bg-indigo-100 text-indigo-700",
    "bg-teal-100 text-teal-700",
    "bg-orange-100 text-orange-700",
  ]
  return colors[index % colors.length] || "bg-slate-100 text-slate-700"
}

export default async function PartnersPage() {
  const supabase = await createClient()

  // íŒŒíŠ¸ë„ˆ ì¹´í…Œê³ ë¦¬ ê°€ì ¸ì˜¤ê¸°
  const { data: partnerCategories } = await supabase
    .from("categories")
    .select("id, name, type")
    .eq("type", "partner")
    .order("created_at", { ascending: true })

  // ì¹´í…Œê³ ë¦¬ ì´ë¦„ ë§¤í•‘ ìƒì„± (categories í…Œì´ë¸”ì—ì„œ ê°€ì ¸ì˜¨ ë°ì´í„° ì‚¬ìš©)
  const categoryLabels: Record<string, string> = {}
  const categoryColorMap: Record<string, string> = {}
  if (partnerCategories) {
    partnerCategories.forEach((cat, index) => {
      categoryLabels[cat.name] = cat.name
      // ì¹´í…Œê³ ë¦¬ ì´ë¦„ì„ í‚¤ë¡œ ì‚¬ìš©í•˜ì—¬ ìƒ‰ìƒ ë§¤í•‘
      categoryColorMap[cat.name] = getCategoryColor(cat.name, index)
    })
  }

  // íŒŒíŠ¸ë„ˆ ì„œë¹„ìŠ¤ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (ì¸ì¦ëœ í•­ëª©ì„ ë¨¼ì €, ê·¸ ë‹¤ìŒ ìµœì‹ ìˆœ)
  const { data: services } = await supabase
    .from("partner_services")
    .select(`
      *,
      profiles:provider_id (
        id,
        full_name,
        avatar_url
      )
    `)
    .order("is_verified", { ascending: false })
    .order("created_at", { ascending: false })

  // ì¸ì¦ëœ ì„œë¹„ìŠ¤ì™€ ì¼ë°˜ ì„œë¹„ìŠ¤ ë¶„ë¦¬
  const verifiedServices = services?.filter(s => s.is_verified) || []
  const regularServices = services?.filter(s => !s.is_verified) || []
  const allServices = [...verifiedServices, ...regularServices]

  // ë”ë¯¸ ë°ì´í„° (ì‹¤ì œ ë°ì´í„°ê°€ ì—†ì„ ë•Œ í‘œì‹œ)
  const dummyPartners = [
    {
      id: "dummy-1",
      title: "AWS í´ë¼ìš°ë“œ ì„œë¹„ìŠ¤",
      description: "ì—”í„°í”„ë¼ì´ì¦ˆê¸‰ í´ë¼ìš°ë“œ ì¸í”„ë¼ì™€ AI ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤.",
      category: "ê°œë°œ",
      thumbnail_url: null,
      is_verified: true,
      profiles: { full_name: "AWS", avatar_url: null },
      benefit: "ì œíœ´ í˜œíƒ: ì²« ë‹¬ ë¬´ë£Œ"
    },
    {
      id: "dummy-2",
      title: "ë…¸ì…˜ ì›Œí¬ìŠ¤í˜ì´ìŠ¤",
      description: "íŒ€ í˜‘ì—…ê³¼ ë¬¸ì„œ ê´€ë¦¬ë¥¼ ìœ„í•œ ì˜¬ì¸ì› ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì†”ë£¨ì…˜ì…ë‹ˆë‹¤.",
      category: "ê°œë°œ",
      thumbnail_url: null,
      is_verified: true,
      profiles: { full_name: "Notion", avatar_url: null },
      benefit: "ì œíœ´ í˜œíƒ: ì—°ê°„ í”Œëœ 20% í• ì¸"
    },
    {
      id: "dummy-3",
      title: "ì„¸ë¬´ë²•ì¸ ì „ë¬¸ ìƒë‹´",
      description: "ìŠ¤íƒ€íŠ¸ì—…ê³¼ ì¤‘ì†Œê¸°ì—…ì„ ìœ„í•œ ì„¸ë¬´ ìë¬¸ ë° ì‹ ê³  ëŒ€í–‰ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.",
      category: "íšŒê³„",
      thumbnail_url: null,
      is_verified: false,
      profiles: { full_name: "ì„¸ë¬´ë²•ì¸", avatar_url: null },
      benefit: "ì œíœ´ í˜œíƒ: ì´ˆê¸° ìƒë‹´ ë¬´ë£Œ"
    },
    {
      id: "dummy-4",
      title: "ë²•ë¬´ë²•ì¸ ë²•ë¥  ìë¬¸",
      description: "ê¸°ì—…ë²•ë¬´, ê³„ì•½ ê²€í† , ì§€ì ì¬ì‚°ê¶Œ ë“± ì „ë¬¸ ë²•ë¥  ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤.",
      category: "ë²•ë¥ ",
      thumbnail_url: null,
      is_verified: false,
      profiles: { full_name: "ë²•ë¬´ë²•ì¸", avatar_url: null },
      benefit: "ì œíœ´ í˜œíƒ: ì²« ìƒë‹´ 50% í• ì¸"
    },
  ]

  // ì‹¤ì œ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ë”ë¯¸ ë°ì´í„° í‘œì‹œ
  const displayServices = allServices.length > 0 ? allServices : dummyPartners

  return (
    <div className="w-full flex flex-col gap-10">
      <PageHeader
        title="íŒŒíŠ¸ë„ˆìŠ¤"
        description="ë©¤ë²„ë“¤ì„ ìœ„í•œ íŠ¹ë³„í•œ í˜œíƒì„ ë§Œë‚˜ë³´ì„¸ìš”."
        className="w-full"
        compact={true}
      />

      <div className="flex justify-between items-center mt-4">
        <h2 className="text-xl font-bold text-slate-900">ì œíœ´ ì—…ì²´ ëª©ë¡</h2>
        <PartnerProposalButtonClient />
      </div>

      <div className="flex flex-wrap gap-2">
        <Button variant="outline" className="rounded-full" asChild>
          <Link href="/partners">ì „ì²´</Link>
        </Button>
        {partnerCategories && partnerCategories.map((cat) => (
          <Button
            key={cat.id}
            variant="outline"
            className="rounded-full"
            asChild
          >
            <Link href={`/partners?category=${cat.name}`}>{cat.name}</Link>
          </Button>
        ))}
      </div>

      <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
        {displayServices.map((service) => {
          const serviceCategory = service.category || "ê¸°íƒ€"

          const cardElement = (
            <Card
              className={cn(
                "flex flex-col h-full overflow-hidden transition-all duration-300",
                "rounded-2xl border-0 shadow-sm hover:shadow-xl hover:-translate-y-2",
                "bg-white p-0 cursor-pointer",
                service.is_verified && "bg-gradient-to-br from-blue-50/30 to-indigo-50/30"
              )}
            >
              {/* ìƒë‹¨: ì¸ë„¤ì¼ ì´ë¯¸ì§€ (Full Bleed) */}
              <div className="relative aspect-video w-full overflow-hidden rounded-t-2xl">
                {service.thumbnail_url ? (
                  <Image
                    src={service.thumbnail_url}
                    alt={service.title}
                    fill
                    sizes="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw"
                    className="object-cover"
                  />
                ) : (
                  <div className="absolute inset-0 bg-gradient-to-br from-slate-200 to-slate-300 flex items-center justify-center">
                    <Briefcase className="h-12 w-12 text-slate-400" />
                  </div>
                )}
                {/* ì¹´í…Œê³ ë¦¬ ë±ƒì§€ (ì™¼ìª½ ìƒë‹¨ ì˜¤ë²„ë ˆì´ - ê¸€ë˜ìŠ¤ëª¨í”¼ì¦˜) */}
                <div className="absolute top-3 left-3 z-20">
                  <span className="bg-black/50 backdrop-blur-md text-white border-none rounded-full px-3 py-1 text-xs font-medium">
                    {categoryLabels[serviceCategory] || serviceCategory}
                  </span>
                </div>
              </div>

              {/* í•˜ë‹¨: ì½˜í…ì¸  ì˜ì—­ (íŒ¨ë”© ì¶”ê°€) */}
              <div className="flex flex-col flex-grow p-6">
                {/* ì¤‘ë‹¨: ë¡œê³  + ì´ë¦„ */}
                <div className="flex items-center gap-3">
                  <Avatar className="h-12 w-12 flex-shrink-0 border-2 border-slate-100">
                    <AvatarImage src={service.profiles?.avatar_url || undefined} />
                    <AvatarFallback className="bg-blue-100 text-blue-600 font-semibold text-base">
                      {service.profiles?.full_name?.[0] || service.title?.[0] || "P"}
                    </AvatarFallback>
                  </Avatar>
                  <div className="flex-1 min-w-0">
                    <h3 className="text-lg font-bold text-slate-900 truncate mb-1">
                      {service.title}
                    </h3>
                    <p className="text-sm text-slate-500 truncate">
                      {service.profiles?.full_name || "íŒŒíŠ¸ë„ˆ"}
                    </p>
                  </div>
                </div>

                {/* í•˜ë‹¨: í•œ ì¤„ ì†Œê°œ + ì œíœ´ í˜œíƒ */}
                <div className="space-y-3">
                  <p className="text-sm text-slate-600 line-clamp-2 leading-relaxed">
                    {service.description}
                  </p>
                  {service.benefit && (
                    <div className="bg-blue-50 text-blue-600 px-4 py-3.5 rounded-xl">
                      <div className="flex items-center gap-2.5">
                        <div className="flex-shrink-0">
                          <Gift className="h-5 w-5 text-blue-600" />
                        </div>
                        <div className="flex-1 min-w-0">
                          <p className="text-xs font-semibold mb-0.5 uppercase tracking-wide">
                            ì œíœ´ í˜œíƒ
                          </p>
                          <p className="text-base font-bold leading-tight">
                            {service.benefit.replace("ì œíœ´ í˜œíƒ: ", "")}
                          </p>
                        </div>
                      </div>
                    </div>
                  )}
                </div>
              </div>
            </Card>
          )

          return (
            <Link
              key={service.id}
              href={`/partners/${service.id}`}
              className="block h-full"
            >
              {cardElement}
            </Link>
          )
        })}
      </div>
    </div>
  )
}
</file>

<file path="components/community/community-header.tsx">
"use client"

import Image from "next/image"
import { Button } from "@/components/ui/button"
import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar"
import { UserCheck, UserPlus, Plus, Clock } from "lucide-react"
import { getDefaultBannerUrl } from "@/lib/utils/unsplash"

interface CommunityHeaderProps {
  community: {
    id: string
    name: string
    banner_url?: string | null
    thumbnail_url?: string | null
    description?: string | null
  }
  isMember: boolean
  membershipStatus?: "none" | "member" | "pending" | "owner" | "admin"
  canWrite: boolean
  isLoading?: boolean
  onJoin: () => void
  onLeave: () => void
  onNewPost: () => void
}

export function CommunityHeader({
  community,
  isMember,
  membershipStatus = "none",
  canWrite,
  isLoading,
  onJoin,
  onLeave,
  onNewPost
}: CommunityHeaderProps) {
  // ë°°ë„ˆ ì´ë¯¸ì§€ URL ê²°ì •
  const bannerUrl = community.banner_url || getDefaultBannerUrl(community.description, community.id)

  // ë©¤ë²„ì‹­ ë²„íŠ¼ ë Œë”ë§
  const renderMembershipButton = () => {
    if (isLoading) {
      return (
        <Button variant="outline" disabled>
          <Clock className="h-4 w-4 mr-1.5 animate-spin" />
          ì²˜ë¦¬ ì¤‘...
        </Button>
      )
    }

    if (membershipStatus === "pending") {
      return (
        <Button variant="outline" disabled>
          <Clock className="h-4 w-4 mr-1.5" />
          ìŠ¹ì¸ ëŒ€ê¸°ì¤‘
        </Button>
      )
    }

    if (isMember) {
      return (
        <Button variant="outline" onClick={onLeave}>
          <UserCheck className="h-4 w-4 mr-1.5" />
          ì°¸ì—¬ ì¤‘
        </Button>
      )
    }

    return (
      <Button onClick={onJoin}>
        <UserPlus className="h-4 w-4 mr-1.5" />
        ì°¸ì—¬í•˜ê¸°
      </Button>
    )
  }

  return (
    <div className="mb-4">
      {/* ë°°ë„ˆ ì´ë¯¸ì§€ */}
      <div className="relative h-28 md:h-36 rounded-t-xl overflow-hidden bg-slate-200">
        <Image
          src={bannerUrl}
          alt={`${community.name} ë°°ë„ˆ`}
          fill
          className="object-cover"
          priority
        />
        {/* ë°°ë„ˆ í•˜ë‹¨ ê·¸ë˜ë””ì–¸íŠ¸ (í…ìŠ¤íŠ¸ ê°€ë…ì„±) */}
        <div className="absolute inset-0 bg-gradient-to-t from-black/20 to-transparent" />
      </div>

      {/* ì»¤ë®¤ë‹ˆí‹° ì •ë³´ ë°” */}
      <div className="flex items-center justify-between px-4 py-4 md:py-5 bg-white border border-t-0 border-slate-200 rounded-b-xl">
        <div className="flex items-center gap-3">
          {/* ì•„ì´ì½˜ (ë°°ë„ˆ ìœ„ë¡œ ì‚´ì§ ì˜¬ë¼ê°) */}
          <div className="-mt-10 relative z-10">
            <Avatar className="h-16 w-16 border-4 border-white shadow-md">
              {community.thumbnail_url ? (
                <AvatarImage src={community.thumbnail_url} alt={community.name} />
              ) : (
                <AvatarFallback className="text-xl font-bold bg-gradient-to-br from-slate-100 to-slate-200 text-slate-600">
                  {community.name.slice(0, 1)}
                </AvatarFallback>
              )}
            </Avatar>
          </div>
          {/* ì´ë¦„ */}
          <h1 className="text-xl font-bold text-slate-900">{community.name}</h1>
        </div>

        {/* ì•¡ì…˜ ë²„íŠ¼ */}
        <div className="flex items-center gap-2">
          {renderMembershipButton()}
          {canWrite && (
            <Button onClick={onNewPost}>
              <Plus className="h-4 w-4 mr-1.5" />
              ìƒˆ ê¸€ ì‘ì„±
            </Button>
          )}
        </div>
      </div>
    </div>
  )
}
</file>

<file path="components/home/hero-section-static.tsx">
"use client"

import { useEffect, useState } from "react"
import { createClient } from "@/lib/supabase/client"
import { HeroSection } from "./hero-section"

export function HeroSectionStatic() {
    const [user, setUser] = useState<any>(null)
    const [profile, setProfile] = useState<any>(null)
    const [isLoading, setIsLoading] = useState(true)

    useEffect(() => {
        const supabase = createClient()

        async function checkAuth() {
            try {
                // 1. ë¡œì»¬ ì„¸ì…˜ í™•ì¸
                let { data: { session } } = await supabase.auth.getSession()

                // 2. Fallback: ì¿ í‚¤ëŠ” ìˆëŠ”ë° ì„¸ì…˜ì´ ì•ˆ ì¡íˆë©´ getUser()ë¡œ ê°•ì œ ê²€ì¦
                if (!session?.user && typeof document !== 'undefined' && document.cookie.includes('sb-')) {
                    const { data: { user }, error } = await supabase.auth.getUser()
                    if (user && !error) {
                        const sessionResult = await supabase.auth.getSession()
                        session = sessionResult.data.session
                    }
                }

                if (!session?.user) {
                    setUser(null)
                    setProfile(null)
                    return
                }

                setUser(session.user)

                const { data: profileData } = await supabase
                    .from("profiles")
                    .select("id, full_name, avatar_url, role, points")
                    .eq("id", session.user.id)
                    .single()

                setProfile(profileData)
            } catch (error) {
                console.error("[HeroSection] Auth check failed:", error)
            } finally {
                setIsLoading(false)
            }
        }

        checkAuth()

        const { data: { subscription } } = supabase.auth.onAuthStateChange((event, session) => {
            if (event === 'SIGNED_IN' && session?.user) {
                setUser(session.user)
                supabase
                    .from("profiles")
                    .select("id, full_name, avatar_url, role, points")
                    .eq("id", session.user.id)
                    .single()
                    .then(({ data }) => setProfile(data))
            } else if (event === 'SIGNED_OUT') {
                setUser(null)
                setProfile(null)
            }
        })

        return () => subscription.unsubscribe()
    }, [])

    if (isLoading) {
        return <HeroSection user={null} profile={null} loginHref="/auth/login" />
    }

    return <HeroSection user={user} profile={profile} loginHref="/auth/login" />
}
</file>

<file path=".claude/settings.local.json">
{
  "permissions": {
    "allow": [
      "Bash(rm:*)",
      "Bash(rmdir:*)",
      "Bash(npm run build:*)",
      "Bash(tasklist:*)",
      "Bash(findstr:*)",
      "Bash(netstat:*)",
      "Bash(git add:*)",
      "Bash(git commit:*)",
      "Bash(git push:*)",
      "Bash(npx supabase db query:*)",
      "Bash(git checkout:*)",
      "Bash(cat:*)",
      "Bash(git config:*)",
      "Bash(git remote:*)",
      "Bash(curl:*)",
      "Bash(git diff:*)",
      "Bash(npx tsc:*)",
      "Bash(npm run dev:*)",
      "Bash(taskkill:*)",
      "Bash(git reset:*)",
      "Bash(timeout:*)",
      "Bash(find:*)",
      "Bash(grep:*)",
      "Bash(git -C c:/Users/USER-PC/sfc status:*)",
      "Bash(git -C c:/Users/USER-PC/sfc add app/layout.tsx app/page.tsx middleware.ts)",
      "Bash(git -C c:/Users/USER-PC/sfc commit -m \"$\\(cat <<''EOF''\nperf: optimize page load performance\n\n- Change GTM script strategy from beforeInteractive to afterInteractive\n- Replace HeroSectionStatic with HeroSectionContainer \\(server-side auth\\)\n- Optimize middleware to use getSession\\(\\) instead of getUser\\(\\) for public routes\n- Pass userRole from server to DashboardLayout for immediate admin menu display\n\nğŸ¤– Generated with [Claude Code]\\(https://claude.com/claude-code\\)\n\nCo-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(git -C c:/Users/USER-PC/sfc push)",
      "Bash(npx supabase secrets unset:*)",
      "Bash(npx supabase:*)"
    ],
    "deny": [],
    "ask": []
  }
}
</file>

<file path="app/e/[id]/manage/page.tsx">
import { createClient } from "@/lib/supabase/server";
import { notFound, redirect } from 'next/navigation';
import { Card, CardContent } from "@/components/ui/card";
import Link from "next/link";
import { ChevronLeft, Users, UserPlus } from 'lucide-react';
import { AddGuestForm } from "@/components/add-guest-form";
import { ExportCSVButton } from "@/components/export-csv-button";
import { Badge } from "@/components/ui/badge";
import { isMasterAdmin } from "@/lib/utils";
import { getEventShortUrl } from "@/lib/utils/event-url";
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from "@/components/ui/table";

export default async function ManageEventPage({
  params,
}: {
  params: Promise<{ id: string }>;
}) {
  const { id } = await params;
  const supabase = await createClient();

  // ì§§ì€ ì½”ë“œì¸ ê²½ìš° UUIDë¡œ ë³€í™˜
  let eventId = id;
  if (id.length === 6) {
    // URL íŒŒì‹± (ì˜ˆ: 010194 -> 1ì›” 1ì¼, ì ‘ë‘ì‚¬ 94)
    const targetMonth = parseInt(id.substring(0, 2), 10);
    const targetDay = parseInt(id.substring(2, 4), 10);
    const idSuffix = id.substring(4, 6).toLowerCase();
    const orderNumber = parseInt(idSuffix, 10); // ìˆœì„œë²ˆí˜¸ ë°©ì‹ ëŒ€ë¹„

    // ì—¬ëŸ¬ ì—°ë„ì—ì„œ í•´ë‹¹ ë‚ ì§œì˜ ì´ë²¤íŠ¸ë§Œ ì¡°íšŒ
    const currentYear = new Date().getFullYear();
    const yearsToCheck = [currentYear, currentYear - 1, currentYear + 1];
    let allDateEvents: any[] = [];

    for (const year of yearsToCheck) {
      const monthStr = String(targetMonth).padStart(2, '0');
      const dayStr = String(targetDay).padStart(2, '0');
      const startDate = `${year}-${monthStr}-${dayStr}T00:00:00`;
      const endDate = `${year}-${monthStr}-${dayStr}T23:59:59`;

      const { data: yearEvents } = await supabase
        .from("events")
        .select("id, event_date")
        .gte("event_date", startDate)
        .lte("event_date", endDate)
        .order("created_at", { ascending: true });

      if (yearEvents && yearEvents.length > 0) {
        allDateEvents.push(...yearEvents);
      }
    }

    if (allDateEvents.length === 0) {
      notFound();
    }

    // ID ì• 2ìë¦¬ê°€ ì¼ì¹˜í•˜ëŠ” ì´ë²¤íŠ¸ ì°¾ê¸° (ìš°ì„ )
    const matchedEvent = allDateEvents.find((event: any) => {
      const eventIdPrefix = event.id.substring(0, 2).toLowerCase();
      return eventIdPrefix === idSuffix;
    });

    if (matchedEvent) {
      eventId = matchedEvent.id;
    } else if (allDateEvents.length >= orderNumber) {
      // ëª» ì°¾ì•˜ë‹¤ë©´ 'ìˆœì„œë²ˆí˜¸' ë°©ì‹(êµ¬ë²„ì „ URL)ìœ¼ë¡œ í•œ ë²ˆ ë” ì°¾ê¸°
      eventId = allDateEvents[orderNumber - 1].id;
    } else {
      notFound();
    }
  }

  const { data: { user } } = await supabase.auth.getUser();
  if (!user) {
    redirect('/auth/login');
  }

  const { data: event } = await supabase
    .from("events")
    .select("*")
    .eq("id", eventId)
    .single();

  if (!event) {
    notFound();
  }

  const { data: profile } = await supabase
    .from("profiles")
    .select("role, email")
    .eq("id", user.id)
    .single();

  const isCreator = event.created_by === user.id;
  const isMaster = profile ? isMasterAdmin(profile.role, profile.email) : false;

  if (!isCreator && !isMaster) {
    redirect('/e');
  }

  const { data: registrations, error: regError } = await supabase
    .from("event_registrations")
    .select(`
      *,
      profiles:user_id (
        id,
        full_name,
        avatar_url,
        email
      )
    `)
    .eq("event_id", eventId)
    .order("registered_at", { ascending: false });


  const customFields: any[] = [];
  const responseMap: Record<string, Record<string, string>> = {};

  const shortUrl = await getEventShortUrl(event.id, event.event_date, supabase);

  const currentCount = registrations?.length || 0;
  const maxCount = event.max_participants;


  return (
    <div className="w-full">
      {/* ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ */}
      <div className="mb-6 flex items-center justify-between">
        <Link href={shortUrl} className="group flex items-center text-sm font-medium text-slate-500 hover:text-slate-900 transition-colors">
          <div className="mr-2 flex h-8 w-8 items-center justify-center rounded-full bg-white border border-slate-200 group-hover:border-slate-300 shadow-sm transition-all">
            <ChevronLeft className="h-4 w-4" />
          </div>
          ì´ë²¤íŠ¸ë¡œ ëŒì•„ê°€ê¸°
        </Link>
      </div>

      {/* í—¤ë” ì„¹ì…˜ */}
      <div className="mb-6">
        <div className="flex items-center justify-between">
          <div className="flex items-center gap-3">
            <div className="flex items-center justify-center w-10 h-10 rounded-xl bg-slate-900 text-white">
              <Users className="w-5 h-5" />
            </div>
            <div>
              <h1 className="text-2xl font-bold text-slate-900">ì°¸ì„ì ê´€ë¦¬</h1>
              <p className="text-sm text-slate-500">{event.title}</p>
            </div>
          </div>
          <div className="flex items-center gap-3">
            <span className="text-sm font-semibold text-slate-700 bg-slate-100 px-3 py-1.5 rounded-lg border border-slate-200">
              {currentCount}ëª… {maxCount && `/ ${maxCount}ëª…`}
            </span>
            {registrations && registrations.length > 0 && (
              <ExportCSVButton
                registrations={registrations || []}
                customFields={customFields}
                responseMap={responseMap}
                eventTitle={event.title}
              />
            )}
          </div>
        </div>
      </div>

      {/* ì°¸ê°€ì í…Œì´ë¸” */}
      <Card className="border-slate-200 shadow-sm bg-white overflow-hidden rounded-xl mb-8">
        <CardContent className="p-0">
          {registrations && registrations.length > 0 ? (
            <div className="overflow-x-auto">
              <Table>
                <TableHeader>
                  <TableRow className="bg-slate-50 hover:bg-slate-50">
                    <TableHead className="w-12 text-center font-semibold text-slate-600">#</TableHead>
                    <TableHead className="font-semibold text-slate-600">ì´ë¦„</TableHead>
                    <TableHead className="font-semibold text-slate-600">ì´ë©”ì¼</TableHead>
                    <TableHead className="font-semibold text-slate-600">ì—°ë½ì²˜</TableHead>
                    <TableHead className="font-semibold text-slate-600">ë“±ë¡ì¼</TableHead>
                    <TableHead className="font-semibold text-slate-600">ìœ í˜•</TableHead>
                    {event.price && event.price > 0 && (
                      <TableHead className="font-semibold text-slate-600">ê²°ì œ</TableHead>
                    )}
                  </TableRow>
                </TableHeader>
                <TableBody>
                  {registrations.map((reg: any, index: number) => {
                    const profile = Array.isArray(reg.profiles) ? reg.profiles[0] : reg.profiles;
                    const name = profile?.full_name || reg.guest_name || "ìµëª…";
                    const email = profile?.email || reg.guest_contact || "-";
                    const phone = reg.guest_contact && !reg.guest_contact.includes('@') ? reg.guest_contact : "-";
                    const isGuest = !reg.user_id;

                    return (
                      <TableRow key={reg.id} className="hover:bg-slate-50/50">
                        <TableCell className="text-center text-slate-500 font-medium">
                          {index + 1}
                        </TableCell>
                        <TableCell className="font-medium text-slate-900">
                          {name}
                        </TableCell>
                        <TableCell className="text-slate-600">
                          {email}
                        </TableCell>
                        <TableCell className="text-slate-600">
                          {phone}
                        </TableCell>
                        <TableCell className="text-slate-500 text-sm">
                          {new Date(reg.registered_at).toLocaleDateString("ko-KR", {
                            month: "short",
                            day: "numeric",
                            hour: "2-digit",
                            minute: "2-digit",
                          })}
                        </TableCell>
                        <TableCell>
                          {isGuest ? (
                            <Badge variant="outline" className="text-xs px-1.5 py-0 h-5 border-amber-200 text-amber-600 bg-amber-50">
                              ê²ŒìŠ¤íŠ¸
                            </Badge>
                          ) : (
                            <Badge variant="outline" className="text-xs px-1.5 py-0 h-5 border-slate-200 text-slate-600 bg-slate-50">
                              íšŒì›
                            </Badge>
                          )}
                        </TableCell>
                        {event.price && event.price > 0 && (
                          <TableCell>
                            <Badge
                              variant={reg.payment_status === 'paid' ? 'default' : 'secondary'}
                              className={`text-xs ${
                                reg.payment_status === 'paid'
                                  ? 'bg-green-100 text-green-700 border-green-200'
                                  : 'bg-slate-100 text-slate-600'
                              }`}
                            >
                              {reg.payment_status === 'paid' ? 'ê²°ì œì™„ë£Œ' : 'ë¯¸ê²°ì œ'}
                            </Badge>
                          </TableCell>
                        )}
                      </TableRow>
                    );
                  })}
                </TableBody>
              </Table>
            </div>
          ) : (
            <div className="flex flex-col items-center justify-center py-16 text-center">
              <div className="w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mb-4">
                <Users className="w-8 h-8 text-slate-400" />
              </div>
              <h3 className="text-lg font-bold text-slate-900 mb-1">ì•„ì§ ì°¸ê°€ìê°€ ì—†ìŠµë‹ˆë‹¤</h3>
              <p className="text-slate-500 text-sm">ì´ë²¤íŠ¸ë¥¼ ê³µìœ í•˜ì—¬ ì°¸ê°€ìë¥¼ ëª¨ì§‘í•´ë³´ì„¸ìš”!</p>
            </div>
          )}
        </CardContent>
      </Card>

      {/* ê²ŒìŠ¤íŠ¸ ì¶”ê°€ */}
      <div className="max-w-xl">
        <h2 className="text-lg font-bold text-slate-900 mb-4 flex items-center gap-2">
          <UserPlus className="w-5 h-5 text-slate-500" />
          ê²ŒìŠ¤íŠ¸ ì¶”ê°€
        </h2>
        <Card className="border-slate-200 shadow-sm bg-white overflow-hidden rounded-xl">
          <CardContent className="p-6">
            <p className="text-sm text-slate-500 mb-4">
              ê³„ì •ì´ ì—†ëŠ” ì°¸ê°€ìë¥¼ ì§ì ‘ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            </p>
            <AddGuestForm eventId={eventId} />
          </CardContent>
        </Card>
      </div>
    </div>
  );
}
</file>

<file path="components/new-community-form.tsx">
"use client"

import { useState, useRef } from "react"
import { useRouter } from "next/navigation"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { Label } from "@/components/ui/label"
import { Textarea } from "@/components/ui/textarea"
import { Loader2, ImageIcon, Upload, Search, Globe, Lock } from "lucide-react"
import { searchUnsplashImages } from "@/app/actions/unsplash"
import { createCommunity } from "@/lib/actions/community"

export function NewCommunityForm({ userId, onSuccess }: { userId?: string; onSuccess?: () => void }) {
  const [name, setName] = useState("")
  const [description, setDescription] = useState("")
  const [thumbnailUrl, setThumbnailUrl] = useState("")
  const [isLoading, setIsLoading] = useState(false)
  const [error, setError] = useState<string | null>(null)
  const [isUploading, setIsUploading] = useState(false)
  const [unsplashQuery, setUnsplashQuery] = useState("")
  const [unsplashResults, setUnsplashResults] = useState<any[]>([])
  const [isSearching, setIsSearching] = useState(false)
  const [isPrivate, setIsPrivate] = useState(false)

  const fileInputRef = useRef<HTMLInputElement>(null)
  const router = useRouter()

  const handleFileUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0]
    if (!file) return
    setIsUploading(true)
    try {
      const formData = new FormData()
      formData.append("file", file)
      const response = await fetch("/api/upload", { method: "POST", body: formData })
      if (!response.ok) throw new Error("ì—…ë¡œë“œ ì‹¤íŒ¨")
      const data = await response.json()
      setThumbnailUrl(data.url)
    } catch (error) {
      alert("ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨")
    } finally {
      setIsUploading(false)
    }
  }

  const handleUnsplashSearch = async (e: React.FormEvent) => {
    e.preventDefault()
    if (!unsplashQuery.trim()) return
    setIsSearching(true)
    try {
      const result = await searchUnsplashImages(unsplashQuery)
      if (result.success) setUnsplashResults(result.results || [])
    } catch (error) {
      console.error(error)
    } finally {
      setIsSearching(false)
    }
  }

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    if (!name.trim()) return alert("ì†Œëª¨ì„ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.")

    setIsLoading(true)
    setError(null)

    try {
      // Server Actionìœ¼ë¡œ ì»¤ë®¤ë‹ˆí‹° ìƒì„±
      const result = await createCommunity({
        name: name.trim(),
        description: description.trim() || undefined,
        thumbnail_url: thumbnailUrl || undefined,
        is_private: isPrivate,
      })

      if (result.error) {
        throw new Error(result.error)
      }

      if (onSuccess) {
        onSuccess()
      } else if (result.data) {
        // ì„œë²„ì—ì„œ ìƒì„±ëœ slug ì‚¬ìš©
        router.push(`/community/board/${encodeURIComponent(result.data.slug)}`)
      }
      router.refresh()
    } catch (error: any) {
      setError(error.message || "ì†Œëª¨ì„ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")
    } finally {
      setIsLoading(false)
    }
  }

  return (
    <form onSubmit={handleSubmit} className="space-y-6 sm:space-y-8">
      {/* 1. ì œëª© ì…ë ¥ - ìµœìƒë‹¨ (ì „ì²´ ë„ˆë¹„, Luma ìŠ¤íƒ€ì¼) */}
      <div className="space-y-3">
        <input
          type="text"
          placeholder="ì»¤ë®¤ë‹ˆí‹° ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”"
          value={name}
          onChange={(e) => setName(e.target.value)}
          className="w-full text-3xl sm:text-4xl font-bold text-slate-900 placeholder:text-slate-300 border-none bg-transparent focus:outline-none focus:ring-0 px-0 py-1"
          required
        />
        <div className="h-px bg-slate-200 w-full" />
      </div>

      {/* 2. ì´ë¯¸ì§€(ì¢Œ) + ìƒì„¸ì •ë³´(ìš°) ê·¸ë¦¬ë“œ */}
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 lg:gap-8 items-stretch">

        {/* [Left] Image Upload Section */}
        <div className="flex flex-col gap-4">
          <div
            className="group relative aspect-square w-full cursor-pointer overflow-hidden rounded-2xl border-2 border-dashed border-slate-300 bg-slate-50 hover:bg-slate-100 hover:border-slate-400 transition-all"
            onClick={() => fileInputRef.current?.click()}
          >
            {thumbnailUrl ? (
              <>
                <img src={thumbnailUrl} alt="Thumbnail" className="h-full w-full object-cover" />
                <div className="absolute inset-0 flex items-center justify-center bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity">
                  <Upload className="h-8 w-8 text-white" />
                </div>
              </>
            ) : (
              <div className="flex h-full flex-col items-center justify-center text-slate-400 gap-3">
                {isUploading ? (
                  <Loader2 className="h-10 w-10 animate-spin" />
                ) : (
                  <>
                    <ImageIcon className="h-12 w-12" />
                    <span className="text-sm font-medium">í´ë¦­í•˜ì—¬ ì´ë¯¸ì§€ ì—…ë¡œë“œ</span>
                    <span className="text-xs text-slate-400">ë˜ëŠ” ì•„ë˜ì—ì„œ Unsplash ê²€ìƒ‰</span>
                  </>
                )}
              </div>
            )}
            <input ref={fileInputRef} type="file" accept="image/*" onChange={handleFileUpload} className="hidden" />
          </div>

          {/* Unsplash Search */}
          <div className="flex gap-2">
            <div className="relative flex-1">
              <Search className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400" />
              <Input
                placeholder="Unsplash ê²€ìƒ‰ (ì˜ˆ: community)"
                value={unsplashQuery}
                onChange={(e) => setUnsplashQuery(e.target.value)}
                onKeyDown={(e) => e.key === "Enter" && handleUnsplashSearch(e)}
                className="pl-9 h-10"
              />
            </div>
            <Button
              type="button"
              variant="outline"
              size="sm"
              disabled={!unsplashQuery.trim()}
              onClick={handleUnsplashSearch}
              className="h-10 px-4"
            >
              {isSearching ? <Loader2 className="h-4 w-4 animate-spin" /> : "ê²€ìƒ‰"}
            </Button>
          </div>

          {unsplashResults.length > 0 && (
            <div className="grid grid-cols-4 gap-2 p-3 bg-white border border-slate-200 rounded-xl max-h-[180px] overflow-y-auto">
              {unsplashResults.map((img) => (
                <div
                  key={img.id}
                  className="aspect-square relative cursor-pointer rounded-lg overflow-hidden border border-slate-200 hover:border-slate-400 hover:shadow-md transition-all group"
                  onClick={() => setThumbnailUrl(img.urls.regular)}
                >
                  <img src={img.urls.small} alt="Unsplash" className="w-full h-full object-cover group-hover:scale-105 transition-transform" />
                </div>
              ))}
            </div>
          )}
        </div>

        {/* [Right] Community Info Section - ì¹´ë“œ í˜•íƒœ */}
        <div className="flex flex-col">
          <div className="bg-white p-5 sm:p-6 rounded-2xl border border-slate-200 shadow-sm space-y-5 flex-1 flex flex-col">
            {/* Description */}
            <div className="flex-1 flex flex-col">
              <Label htmlFor="description" className="text-sm font-semibold text-slate-700 mb-2 block">
                í•œì¤„ ì†Œê°œ
              </Label>
              <Textarea
                id="description"
                placeholder="ì»¤ë®¤ë‹ˆí‹°ì— ëŒ€í•œ ê°„ë‹¨í•œ ì†Œê°œë¥¼ ì…ë ¥í•˜ì„¸ìš”. ì–´ë–¤ ì‚¬ëŒë“¤ì´ ëª¨ì´ëŠ” ê³³ì¸ì§€, ì–´ë–¤ í™œë™ì„ í•˜ëŠ”ì§€ ì•Œë ¤ì£¼ì„¸ìš”."
                value={description}
                onChange={(e) => setDescription(e.target.value)}
                className="flex-1 min-h-[120px] resize-none border-slate-200 bg-slate-50 focus-visible:ring-slate-200"
              />
              <p className="text-xs text-slate-400 mt-2">
                ë§¤ë ¥ì ì¸ ì†Œê°œê¸€ì€ ë” ë§ì€ ë©¤ë²„ë¥¼ ëª¨ìë‹ˆë‹¤.
              </p>
            </div>

            {/* ê³µê°œ/ë¹„ê³µê°œ ì„¤ì • */}
            <div>
              <Label className="text-sm font-semibold text-slate-700 mb-3 block">
                ê³µê°œ ì„¤ì •
              </Label>
              <div className="grid grid-cols-2 gap-3">
                <button
                  type="button"
                  onClick={() => setIsPrivate(false)}
                  className={`flex flex-col items-center gap-2 p-4 rounded-xl border-2 transition-all ${
                    !isPrivate
                      ? "border-blue-500 bg-blue-50 text-blue-700"
                      : "border-slate-200 bg-white text-slate-600 hover:border-slate-300"
                  }`}
                >
                  <Globe className="h-6 w-6" />
                  <span className="font-medium text-sm">ê³µê°œ</span>
                  <span className="text-xs text-center leading-tight opacity-70">
                    ëˆ„êµ¬ë‚˜ ì°¾ê³  ê°€ì…í•  ìˆ˜ ìˆì–´ìš”
                  </span>
                </button>
                <button
                  type="button"
                  onClick={() => setIsPrivate(true)}
                  className={`flex flex-col items-center gap-2 p-4 rounded-xl border-2 transition-all ${
                    isPrivate
                      ? "border-blue-500 bg-blue-50 text-blue-700"
                      : "border-slate-200 bg-white text-slate-600 hover:border-slate-300"
                  }`}
                >
                  <Lock className="h-6 w-6" />
                  <span className="font-medium text-sm">ë¹„ê³µê°œ</span>
                  <span className="text-xs text-center leading-tight opacity-70">
                    ì´ˆëŒ€ë°›ì€ ì‚¬ëŒë§Œ ê°€ì…í•  ìˆ˜ ìˆì–´ìš”
                  </span>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      {/* ì—ëŸ¬ ë©”ì‹œì§€ */}
      {error && (
        <div className="p-4 bg-red-50 text-red-600 rounded-xl text-sm font-medium border border-red-100">
          {error}
        </div>
      )}

      {/* ì œì¶œ ë²„íŠ¼ */}
      <div className="sticky bottom-0 z-20 bg-gradient-to-t from-slate-50 via-slate-50 to-transparent pt-4 pb-6 -mx-4 px-4 sm:-mx-6 sm:px-6">
        <Button
          type="submit"
          size="lg"
          className="w-full sm:w-auto sm:min-w-[200px] sm:ml-auto sm:flex bg-slate-900 hover:bg-slate-800 text-white rounded-xl text-base font-semibold shadow-lg hover:shadow-xl transition-all h-12"
          disabled={isLoading}
        >
          {isLoading ? (
            <>
              <Loader2 className="mr-2 h-5 w-5 animate-spin" />
              ì²˜ë¦¬ ì¤‘...
            </>
          ) : (
            "ì»¤ë®¤ë‹ˆí‹° ë§Œë“¤ê¸°"
          )}
        </Button>
      </div>
    </form>
  )
}
</file>

<file path="components/ui/event-card.tsx">
"use client"

import Image from "next/image"
import Link from "next/link"
import { useEffect, useState } from "react"
import { cn } from "@/lib/utils"
import { MapPin, User, Calendar } from "lucide-react"

export type EventCardEvent = {
  id: string
  title: string
  thumbnail_url?: string | null
  event_date: string
  event_time?: string | null
  location?: string | null
  current_participants?: number | null
  max_participants?: number | null
  host_name?: string | null
  host_avatar_url?: string | null
  host_bio?: string | null
  event_type?: 'networking' | 'class' | 'activity' | null
  shortUrl?: string
}

type Props = {
  event: EventCardEvent
  href?: string
  className?: string
  layout?: "card" | "poster"
}

export default function EventCard({ event, href, className, layout = "card" }: Props) {
  const [dateInfo, setDateInfo] = useState({ dateStr: '', weekdayStr: '', timeStr: '' })

  useEffect(() => {
    const dateObj = new Date(event.event_date)
    setDateInfo({
      dateStr: `${dateObj.getMonth() + 1}ì›” ${dateObj.getDate()}ì¼`,
      weekdayStr: dateObj.toLocaleDateString('ko-KR', { weekday: 'short' }),
      timeStr: dateObj.toLocaleTimeString('ko-KR', { hour: 'numeric', minute: '2-digit', hour12: true })
    })
  }, [event.event_date])

  const { dateStr, weekdayStr, timeStr } = dateInfo
  const current = event.current_participants || 0
  const max = event.max_participants || 0
  const isFull = max > 0 && current >= max

  const content = (
    <div
      className={cn(
        "group relative w-full overflow-hidden rounded-xl bg-white border border-slate-200 shadow-sm transition-all duration-300 hover:shadow-xl hover:-translate-y-1",
        className
      )}
    >
      {/* ì¸ë„¤ì¼ ì´ë¯¸ì§€ (1:1 ì •ì‚¬ê°í˜• ë¹„ìœ¨) */}
      <div className="relative w-full aspect-square overflow-hidden bg-slate-100">
        {event.thumbnail_url ? (
          <Image
            src={event.thumbnail_url}
            alt={event.title}
            fill
            sizes="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw"
            className="object-cover h-full w-full transition-transform duration-500 group-hover:scale-105"
          />
        ) : (
          <div className="absolute inset-0 bg-gradient-to-br from-slate-100 via-slate-200 to-slate-300 flex items-center justify-center">
            <Calendar className="w-16 h-16 text-slate-400" />
          </div>
        )}

        {/* ì¹´í…Œê³ ë¦¬ ë°°ì§€ */}
        {event.event_type && (
          <div className="absolute top-4 left-4 z-10">
            <span className="inline-block px-3 py-1.5 rounded-full text-xs font-bold text-white bg-black/60 backdrop-blur-md shadow-sm">
              {event.event_type === 'networking' && 'ë„¤íŠ¸ì›Œí‚¹'}
              {event.event_type === 'class' && 'í´ë˜ìŠ¤'}
              {event.event_type === 'activity' && 'ì•¡í‹°ë¹„í‹°'}
            </span>
          </div>
        )}

        {/* ì¸ì› ë°°ì§€ */}
        <div className="absolute top-4 right-4 z-10">
          <span className={cn(
            "inline-block px-3 py-1.5 rounded-full text-xs font-bold text-white backdrop-blur-md shadow-sm",
            isFull ? "bg-red-500/90" : "bg-black/60"
          )}>
            {current}/{max || 'âˆ'}
          </span>
        </div>
      </div>

      {/* í•˜ë‹¨ ì½˜í…ì¸  ì˜ì—­ */}
      <div className="p-5 flex flex-col">
        {/* í˜¸ìŠ¤íŠ¸ ì •ë³´ (ê°•ì¡°) */}
        <div className="flex items-center gap-2.5 mb-3">
          <div className="relative h-6 w-6 flex-shrink-0 rounded-full border border-slate-100 bg-slate-50 overflow-hidden">
            {event.host_avatar_url ? (
              <Image
                src={event.host_avatar_url}
                alt={event.host_name || "Host"}
                fill
                sizes="24px"
                className="object-cover"
                unoptimized
              />
            ) : (
              <div className="flex h-full w-full items-center justify-center text-slate-400">
                <User className="w-3.5 h-3.5" />
              </div>
            )}
          </div>
          <span className="font-semibold text-sm text-slate-700 truncate">{event.host_name || "í˜¸ìŠ¤íŠ¸"}</span>
        </div>

        {/* ì œëª© */}
        <h3 className="text-lg md:text-xl font-bold text-slate-900 leading-snug mb-3 line-clamp-2 min-h-[3.5rem]">
          {event.title}
        </h3>

        {/* ì£¼ìš” ì •ë³´ */}
        <div className="space-y-1.5 mb-1">
          <div className="flex items-center gap-2.5 text-slate-600">
            <Calendar className="w-4 h-4 text-slate-400 shrink-0" />
            <span className="text-sm font-medium">{dateStr} ({weekdayStr}) Â· {timeStr}</span>
          </div>
          <div className="flex items-center gap-2.5 text-slate-600">
            <MapPin className="w-4 h-4 text-slate-400 shrink-0" />
            <span className="text-sm font-medium truncate">{event.location || "ì¥ì†Œ ë¯¸ì •"}</span>
          </div>
        </div>
      </div>
    </div>
  )

  if (!href) return content

  return (
    <Link href={href} className="block h-full">
      {content}
    </Link>
  )
}
</file>

<file path="lib/supabase/client.ts">
import { createBrowserClient } from "@supabase/ssr";
import type { SupabaseClient } from "@supabase/supabase-js";

// ì‹±ê¸€í†¤ ì¸ìŠ¤í„´ìŠ¤
let supabaseInstance: SupabaseClient | null = null;

export function createClient() {
  const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;
  const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;

  if (!supabaseUrl || !supabaseAnonKey) {
    throw new Error("Supabase í™˜ê²½ ë³€ìˆ˜ ë¯¸ì„¤ì •");
  }

  // ë¸Œë¼ìš°ì € í™˜ê²½ì—ì„œëŠ” ì‹±ê¸€í†¤ ì¸ìŠ¤í„´ìŠ¤ ì¬ì‚¬ìš©
  if (typeof window !== 'undefined') {
    if (!supabaseInstance) {
      supabaseInstance = createBrowserClient(supabaseUrl, supabaseAnonKey);
    }
    return supabaseInstance;
  }

  // ì„œë²„ í™˜ê²½ì—ì„œëŠ” ë§¤ë²ˆ ìƒˆë¡œ ìƒì„±
  return createBrowserClient(supabaseUrl, supabaseAnonKey);
}

// ë¡œê·¸ì•„ì›ƒ ì‹œ ì¸ìŠ¤í„´ìŠ¤ ì´ˆê¸°í™”ìš©
export function resetClient() {
  supabaseInstance = null;
}
</file>

<file path="app/community/board/[slug]/[id]/page.tsx">
import { createClient } from "@/lib/supabase/server"
import { notFound } from "next/navigation"
import { Card, CardContent } from "@/components/ui/card"
import { MessageSquare, ChevronLeft } from "lucide-react"
import { ThreadedComments } from "@/components/threaded-comments"
import { PostActions } from "@/components/post-actions"
import { EventShareButton } from "@/components/event-share-button"
import Link from "next/link"
import { isMasterAdmin, isAdmin } from "@/lib/utils"
import { getComments } from "@/lib/actions/comments"
import { ClickableAvatar } from "@/components/ui/clickable-avatar"

// ISR ìºì‹±: 60ì´ˆë§ˆë‹¤ ì¬ê²€ì¦
export const revalidate = 60

// ê³µê°œ ê²Œì‹œíŒ slug ëª©ë¡
const PUBLIC_BOARDS = ["free", "vangol", "hightalk", "insights", "reviews"]

export default async function BoardPostDetailPage({
  params,
}: {
  params: Promise<{ slug: string; id: string }>
}) {
  const { slug, id } = await params
  const supabase = await createClient()

  let dbSlug = slug
  if (slug === "free") dbSlug = "free-board"
  if (slug === "announcements") dbSlug = "announcement"

  // Phase 1: ìœ ì € + ê²Œì‹œë¬¼ ë³‘ë ¬ ì¡°íšŒ
  const [userResult, postResult] = await Promise.all([
    supabase.auth.getUser(),
    supabase
      .from("posts")
      .select(`
        *,
        profiles:author_id (id, full_name, avatar_url, role, email),
        board_categories:board_category_id (name, slug)
      `)
      .eq("id", id)
      .single(),
  ])

  const {
    data: { user },
  } = userResult
  const { data: post } = postResult

  if (!post) notFound()

  // Phase 2: ëŒ“ê¸€, ìœ ì € ê¶Œí•œ ë³‘ë ¬ ì¡°íšŒ
  const [commentsResult, profileResult] = await Promise.all([
    getComments(id),
    user
      ? supabase
          .from("profiles")
          .select("role, email")
          .eq("id", user.id)
          .single()
      : Promise.resolve({ data: null }),
  ])

  // ê¶Œí•œ í™•ì¸
  const currentUserProfile = profileResult?.data
  const isMaster = user ? isMasterAdmin(currentUserProfile?.role, currentUserProfile?.email) : false
  const isUserAdmin = user ? isAdmin(currentUserProfile?.role, currentUserProfile?.email) : false

  const isAuthor = Boolean(user && post.author_id === user.id)
  const boardName = post.board_categories?.name || (slug === "announcements" ? "ê³µì§€ì‚¬í•­" : "ê²Œì‹œíŒ")

  const comments = commentsResult || []
  const actualCommentsCount = countTree(comments)

  return (
    <div className="w-full">
      <Card className="border border-slate-200 rounded-xl shadow-sm bg-white overflow-hidden">
        <CardContent className="px-6 md:px-8 pt-2.5 pb-6 md:pb-8">
          {/* í—¤ë” - ë’¤ë¡œê°€ê¸° + ì•¡ì…˜ ë²„íŠ¼ */}
          <div className="flex items-center justify-between mb-6">
            <Link
              href={`/community/board/${slug}`}
              className="group flex items-center text-sm font-medium text-slate-500 hover:text-slate-900 transition-colors"
            >
              <ChevronLeft className="h-4 w-4 mr-1" />
              {boardName} ëª©ë¡
            </Link>
            {(isAuthor || isUserAdmin) && (
              <PostActions
                postId={post.id}
                isAuthor={isAuthor}
                isAdmin={isUserAdmin}
                isMaster={isMaster}
                slug={slug}
                redirectUrl={`/community/board/${slug}`}
              />
            )}
          </div>
          {/* ê²Œì‹œíŒ íƒœê·¸ (ììœ ê²Œì‹œíŒ, ë°˜ê³¨, í•˜ì´í† í¬ ì œì™¸) */}
          {dbSlug !== "free-board" && dbSlug !== "vangol" && dbSlug !== "hightalk" && (
            <div className="mb-4">
              <span className="bg-slate-100 text-slate-600 rounded-md px-2.5 py-1 text-xs font-bold">
                {boardName}
              </span>
            </div>
          )}

          {/* ì‘ì„±ì ì •ë³´ */}
          <div className="mb-5 flex items-center gap-3">
            <ClickableAvatar profile={post.profiles} size="md" />
            <div>
              <span className="font-semibold text-slate-900 text-sm">
                {post.profiles?.full_name || "ìµëª…"}
              </span>
              <span className="text-xs text-slate-500 block">
                {new Date(post.created_at).toLocaleDateString("ko-KR", {
                  year: "numeric",
                  month: "long",
                  day: "numeric",
                  hour: "2-digit",
                  minute: "2-digit",
                })}
              </span>
            </div>
          </div>

          {/* ì œëª© */}
          <h1 className="text-2xl md:text-3xl font-bold text-slate-900 mb-8 leading-snug">{post.title}</h1>

          {/* ë³¸ë¬¸ */}
          <div
            className="prose prose-slate max-w-none text-slate-800 leading-relaxed mb-10 min-h-[200px]"
            dangerouslySetInnerHTML={{ __html: post.content || "" }}
          />

          {/* í•˜ë‹¨ ì•¡ì…˜ */}
          <div className="flex items-center justify-between pt-6 border-t border-slate-100">
            <div className="flex items-center gap-4">
              <div className="flex items-center gap-1.5 text-slate-500 text-sm">
                <MessageSquare className="h-4 w-4" />
                <span>{actualCommentsCount}</span>
              </div>
            </div>
            <EventShareButton title={post.title} variant="ghost" size="sm" className="text-slate-500">
              ê³µìœ 
            </EventShareButton>
          </div>

          {/* ëŒ“ê¸€ ì„¹ì…˜ */}
          <div className="mt-8 pt-8 border-t border-slate-100">
            <h3 className="text-lg font-bold text-slate-900 mb-6">ëŒ“ê¸€</h3>
            <ThreadedComments postId={post.id} userId={user?.id} comments={comments} />
          </div>
        </CardContent>
      </Card>
    </div>
  )
}

function countTree(nodes: any[]): number {
  return nodes.reduce((acc, n) => acc + 1 + (n.children ? countTree(n.children) : 0), 0)
}
</file>

<file path="app/community/board/[slug]/board-page-client.tsx">
"use client"

import { useSearchParams, useRouter } from "next/navigation"
import { useState } from "react"
import { Button } from "@/components/ui/button"
import { FeedPostCard } from "@/components/ui/feed-post-card"
import { Plus, UserPlus, UserCheck } from 'lucide-react'
import { usePosts } from "@/lib/hooks/usePosts"
import { Skeleton } from "@/components/ui/skeleton"
import { Dialog, DialogContent, DialogHeader, DialogTitle } from "@/components/ui/dialog"
import { NewPostForm } from "@/components/new-post-form"
import { CommunityBanner } from "@/components/community-banner"
import { CommunityMobileBar } from "@/components/community/community-mobile-bar"
import { CommunityHeader } from "@/components/community/community-header"
import { joinCommunity, leaveCommunity } from "@/lib/actions/community"
import { useToast } from "@/hooks/use-toast"

interface CommunityDataForMobile {
  id: string
  name: string
  description: string | null
  rules: string | null
  thumbnail_url: string | null
  banner_url?: string | null
  is_private: boolean
  join_type: "free" | "approval" | "invite"
  member_count: number
  moderators: Array<{
    id: string
    full_name: string | null
    avatar_url: string | null
    role: string
  }>
}

interface BoardPageClientProps {
  slug: string
  dbSlug: string
  category: {
    id: string
    name: string
    description?: string | null
  }
  isUserAdmin: boolean
  user: any
  communityId: string | null
  isMember: boolean
  membershipStatus: "none" | "member" | "pending" | "admin" | "owner"
  initialPosts?: any[]
  initialPostsCount?: number
  communityData?: CommunityDataForMobile | null
  isSystemBoard?: boolean
}

export function BoardPageClient({
  slug,
  dbSlug,
  category,
  isUserAdmin,
  user,
  communityId,
  isMember: initialIsMember,
  membershipStatus: initialMembershipStatus,
  initialPosts = [],
  initialPostsCount = 0,
  communityData,
  isSystemBoard: isSystemBoardProp,
}: BoardPageClientProps) {
  const searchParams = useSearchParams()
  const router = useRouter()
  const { toast } = useToast()
  const currentPage = Number(searchParams.get("page")) || 1
  const [isWriteModalOpen, setIsWriteModalOpen] = useState(false)
  const [isMember, setIsMember] = useState(initialIsMember)
  const [membershipStatus, setMembershipStatus] = useState(initialMembershipStatus)
  const [isJoining, setIsJoining] = useState(false)


  // ì„œë²„ì—ì„œ ì „ë‹¬ë°›ì€ ì´ˆê¸° ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ê±°ë‚˜ í˜ì´ì§€ ë³€ê²½ ì‹œ í´ë¼ì´ì–¸íŠ¸ì—ì„œ fetch
  const { data, isLoading, isError } = usePosts(dbSlug, currentPage)

  // 1í˜ì´ì§€ì´ê³  ì„œë²„ ì´ˆê¸° ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì‚¬ìš©, ê·¸ ì™¸ì—ëŠ” í´ë¼ì´ì–¸íŠ¸ ë°ì´í„° ì‚¬ìš©
  const posts = (currentPage === 1 && initialPosts.length > 0 && !data)
    ? initialPosts
    : (data?.posts || initialPosts)
  const totalPosts = (currentPage === 1 && initialPostsCount > 0 && !data)
    ? initialPostsCount
    : (data?.count || initialPostsCount)

  // ì‹œìŠ¤í…œ ê²Œì‹œíŒ ëª©ë¡ (ê¸°ì¡´ ì‚¬ì´ë“œë°” ì‚¬ìš©)
  const systemBoards = ['announcement', 'announcements', 'free', 'free-board', 'event-requests', 'insights', 'reviews']
  const isSystemBoard = isSystemBoardProp ?? systemBoards.includes(dbSlug)

  // ì»¤ë®¤ë‹ˆí‹° ê°€ì… í•¸ë“¤ëŸ¬
  const handleJoin = async () => {
    if (!user) {
      toast({
        variant: "destructive",
        title: "ë¡œê·¸ì¸ í•„ìš”",
        description: "ì»¤ë®¤ë‹ˆí‹°ì— ì°¸ì—¬í•˜ë ¤ë©´ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.",
      })
      router.push("/auth/login")
      return
    }

    if (!communityId) {
      toast({
        variant: "destructive",
        title: "ì˜¤ë¥˜",
        description: "ì»¤ë®¤ë‹ˆí‹° ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",
      })
      return
    }

    setIsJoining(true)
    try {
      await joinCommunity(communityId)
      setIsMember(true)
      setMembershipStatus("member")
      toast({
        title: "ì°¸ì—¬ ì™„ë£Œ",
        description: "ì»¤ë®¤ë‹ˆí‹°ì— ì°¸ì—¬í–ˆìŠµë‹ˆë‹¤.",
      })
      router.refresh()
    } catch (error) {
      console.error("ì»¤ë®¤ë‹ˆí‹° ê°€ì… ì˜¤ë¥˜:", error)
      toast({
        variant: "destructive",
        title: "ì°¸ì—¬ ì‹¤íŒ¨",
        description: error instanceof Error ? error.message : "ì»¤ë®¤ë‹ˆí‹° ì°¸ì—¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",
      })
    } finally {
      setIsJoining(false)
    }
  }

  // ì»¤ë®¤ë‹ˆí‹° íƒˆí‡´ í•¸ë“¤ëŸ¬
  const handleLeave = async () => {
    if (!communityId) return

    if (!confirm("ì •ë§ ì´ ì»¤ë®¤ë‹ˆí‹°ì—ì„œ íƒˆí‡´í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
      return
    }

    setIsJoining(true)
    try {
      await leaveCommunity(communityId)
      setIsMember(false)
      setMembershipStatus("none")
      toast({
        title: "íƒˆí‡´ ì™„ë£Œ",
        description: "ì»¤ë®¤ë‹ˆí‹°ì—ì„œ íƒˆí‡´í–ˆìŠµë‹ˆë‹¤.",
      })
      router.refresh()
    } catch (error) {
      console.error("ì»¤ë®¤ë‹ˆí‹° íƒˆí‡´ ì˜¤ë¥˜:", error)
      toast({
        variant: "destructive",
        title: "íƒˆí‡´ ì‹¤íŒ¨",
        description: error instanceof Error ? error.message : "ì»¤ë®¤ë‹ˆí‹° íƒˆí‡´ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",
      })
    } finally {
      setIsJoining(false)
    }
  }

  // ê³µì§€ì‚¬í•­ ì—¬ë¶€ í™•ì¸
  const isAnnouncement = dbSlug === 'announcement' || slug === 'announcements'

  // ê²Œì‹œê¸€ ë°ì´í„°ì— isMember ì¶”ê°€ (PostsSection í˜•ì‹ì— ë§ì¶¤)
  const postsWithMembership = posts.map((post: any) => ({
    ...post,
    isMember: true, // ê°œë³„ ê²Œì‹œíŒì—ì„œëŠ” í•­ìƒ true (ë‚˜ì¤‘ì— ë©¤ë²„ì‹­ ì²´í¬ ì¶”ê°€ ê°€ëŠ¥)
  }))

  if (isError) {
    return (
      <div className="w-full flex flex-col gap-6">
        <div className="text-center py-16">
          <h2 className="text-xl font-semibold text-slate-900 mb-2">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤</h2>
          <p className="text-slate-500 mb-4">ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</p>
          <Button onClick={() => router.refresh()}>ë‹¤ì‹œ ì‹œë„</Button>
        </div>
      </div>
    )
  }

  // ì¸ì‚¬ì´íŠ¸ ê²Œì‹œíŒì˜ ê²½ìš° description ì˜¤ë²„ë¼ì´ë“œ
  const displayDescription = slug === "insights"
    ? "ì„±ì¥ì— í•„ìš”í•œ ì¸ì‚¬ì´íŠ¸ ìˆëŠ” ì¹¼ëŸ¼ê³¼ íŒì„ ê³µìœ í•©ë‹ˆë‹¤"
    : (category.description || undefined)

  // ë²„íŠ¼ í…ìŠ¤íŠ¸ ë° ê¸°ëŠ¥ ê²°ì •
  const getButtonConfig = () => {
    if (slug === "insights") {
      return { text: "ìƒˆ ì¸ì‚¬ì´íŠ¸", onClick: () => setIsWriteModalOpen(true) }
    } else if (isAnnouncement) {
      return { text: "ìƒˆ ê³µì§€ì‚¬í•­", onClick: () => setIsWriteModalOpen(true), showOnlyIfAdmin: true }
    } else if (slug === "free" || dbSlug === "free-board") {
      return { text: "ìƒˆ ê¸€ ì‘ì„±", onClick: () => setIsWriteModalOpen(true) }
    } else {
      return { text: "ìƒˆ ê¸€ ì‘ì„±", onClick: () => setIsWriteModalOpen(true) }
    }
  }

  const buttonConfig = getButtonConfig()
  const shouldShowButton = !buttonConfig.showOnlyIfAdmin || (buttonConfig.showOnlyIfAdmin && isUserAdmin)

  // ë°°ë„ˆ íƒ€ì´í‹€ ë° ì„¤ëª… ê²°ì •
  const getBannerConfig = () => {
    if (slug === "insights") {
      return { title: "ì¸ì‚¬ì´íŠ¸", description: "ë¹„ì¦ˆë‹ˆìŠ¤ ì¸ì‚¬ì´íŠ¸ë¥¼ ê³µìœ í•©ë‹ˆë‹¤." }
    } else if (isAnnouncement) {
      return { title: "ê³µì§€ì‚¬í•­", description: "SFCì˜ ìƒˆë¡œìš´ ì†Œì‹ì„ ì•Œë ¤ë“œë¦½ë‹ˆë‹¤." }
    } else if (slug === "free" || dbSlug === "free-board") {
      return { title: "ììœ ê²Œì‹œíŒ", description: "ììœ ë¡­ê²Œ ì´ì•¼ê¸°ë¥¼ ë‚˜ëˆ„ì„¸ìš”." }
    } else {
      return { title: category.name, description: category.description || undefined }
    }
  }

  // ì„¹ì…˜ íƒ€ì´í‹€ ê²°ì •
  const getSectionTitle = () => {
    if (slug === "insights") {
      return "ì „ì²´ ì¸ì‚¬ì´íŠ¸"
    } else if (isAnnouncement) {
      return "ê³µì§€ì‚¬í•­"
    } else if (slug === "free" || dbSlug === "free-board") {
      return "ììœ ê²Œì‹œíŒ"
    } else {
      return category.name
    }
  }

  const bannerConfig = getBannerConfig()

  // ë©¤ë²„ì‹­ ë³€ê²½ í•¸ë“¤ëŸ¬ (ëª¨ë°”ì¼ ë°”ìš©)
  const handleMembershipChange = () => {
    router.refresh()
  }

  return (
    <div className="w-full flex flex-col gap-8">
      {/* ì»¤ë®¤ë‹ˆí‹° ëª¨ë°”ì¼ ë°” (ì‹œìŠ¤í…œ ê²Œì‹œíŒì´ ì•„ë‹ ë•Œë§Œ í‘œì‹œ) */}
      {!isSystemBoard && communityData && (
        <CommunityMobileBar
          community={communityData}
          membershipStatus={membershipStatus}
          currentUserId={user?.id || null}
          onMembershipChange={handleMembershipChange}
        />
      )}

      <div className="flex flex-col gap-6">
        {/* ì‹œìŠ¤í…œ ê²Œì‹œíŒ: ê¸°ì¡´ CommunityBanner ì‚¬ìš© */}
        {isSystemBoard ? (
          <CommunityBanner
            title={bannerConfig.title}
            description={bannerConfig.description}
            actions={
              <div className="flex items-center gap-2">
                {shouldShowButton && (
                  <Button
                    onClick={buttonConfig.onClick}
                    className="bg-white/90 border border-white/20 shadow-sm hover:bg-white text-gray-900 rounded-full px-4 h-9 inline-flex items-center gap-2 text-sm font-semibold"
                  >
                    <Plus className="w-4 h-4" />
                    {buttonConfig.text}
                  </Button>
                )}
              </div>
            }
          />
        ) : (
          /* ì»¤ë®¤ë‹ˆí‹°: Reddit ìŠ¤íƒ€ì¼ CommunityHeader ì‚¬ìš© */
          communityData && (
            <CommunityHeader
              community={{
                id: communityData.id,
                name: communityData.name,
                banner_url: communityData.banner_url,
                thumbnail_url: communityData.thumbnail_url,
                description: communityData.description,
              }}
              isMember={isMember}
              membershipStatus={membershipStatus}
              canWrite={isMember || isUserAdmin}
              isLoading={isJoining}
              onJoin={handleJoin}
              onLeave={handleLeave}
              onNewPost={() => setIsWriteModalOpen(true)}
            />
          )
        )}

        <Dialog open={isWriteModalOpen} onOpenChange={setIsWriteModalOpen}>
          <DialogContent className="sm:max-w-3xl max-h-[90vh] overflow-y-auto">
            <DialogHeader>
              <DialogTitle>
                {slug === "insights"
                  ? "ì¸ì‚¬ì´íŠ¸ ì‘ì„±"
                  : isAnnouncement
                    ? "ê³µì§€ì‚¬í•­ ì‘ì„±"
                    : "ê¸€ ì‘ì„±"}
              </DialogTitle>
            </DialogHeader>
            <div className="mt-4">
              <NewPostForm
                slug={slug}
                boardCategoryId={category.id}
                onSuccess={() => setIsWriteModalOpen(false)}
              />
            </div>
          </DialogContent>
        </Dialog>

        <div className="flex flex-col bg-white rounded-xl border border-slate-200 overflow-hidden">
          {/* ì„œë²„ì—ì„œ ì´ˆê¸° ë°ì´í„°ê°€ ìˆìœ¼ë©´ ë¡œë”© ìƒíƒœ ê±´ë„ˆë›°ê¸° */}
          {/* ë‹¨, ì„œë²„ì—ì„œ ì´ë¯¸ ë¹ˆ ë°°ì—´ì„ ì „ë‹¬ë°›ì€ ê²½ìš°(initialPosts.length === 0ì´ê³  page 1)ì—ëŠ” ìŠ¤ì¼ˆë ˆí†¤ í‘œì‹œ ì•ˆí•¨ */}
          {(isLoading && posts.length === 0 && !(currentPage === 1 && initialPosts.length === 0)) ? (
            [1, 2, 3, 4, 5].map((i) => (
              <div key={i} className="w-full bg-white py-3 px-4 border-b border-slate-200 last:border-b-0">
                <Skeleton className="h-4 w-1/4 mb-2" />
                <Skeleton className="h-5 w-3/4 mb-2" />
                <Skeleton className="h-3 w-full mb-1" />
                <Skeleton className="h-3 w-2/3" />
              </div>
            ))
          ) : posts.length === 0 ? (
            <div className="text-center py-16 text-slate-500">
              ì•„ì§ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤. ì²« ë²ˆì§¸ ê¸€ì„ ì‘ì„±í•´ë³´ì„¸ìš”!
            </div>
          ) : (
            postsWithMembership.map((post, index) => {
              const postHref = `/community/board/${post.board_categories?.slug ?? "community"}/${post.id}`

              // Reddit ìŠ¤íƒ€ì¼ FeedPostCard ì‚¬ìš© (í”¼ë“œ/ë¦¬ìŠ¤íŠ¸ ë·° ëª¨ë‘)
              // ì»¤ë®¤ë‹ˆí‹° í˜ì´ì§€ì—ì„œëŠ” ì‘ì„±ì ì •ë³´ í‘œì‹œ
              return (
                <FeedPostCard
                  key={post.id}
                  postId={post.id}
                  href={postHref}
                  source={{
                    name: post.board_categories?.name ?? "ì»¤ë®¤ë‹ˆí‹°",
                    href: `/community/board/${post.board_categories?.slug ?? "community"}`,
                  }}
                  createdAt={post.created_at}
                  title={post.title}
                  content={post.content ?? undefined}
                  contentRaw={(post as any).content ?? undefined}
                  thumbnailUrl={post.thumbnail_url ?? undefined}
                  commentsCount={post.comments_count ?? 0}
                  isLast={index === postsWithMembership.length - 1}
                  showAuthor={!isSystemBoard}
                  author={post.profiles ? {
                    name: post.profiles.full_name,
                    avatarUrl: post.profiles.avatar_url,
                  } : null}
                />
              )
            })
          )}
        </div>

        {isAnnouncement && (
          <div className="text-sm text-slate-500">
            ê³µì§€ì‚¬í•­ì€ ê´€ë¦¬ìê°€ ì‘ì„±í•œ ê¸€ë§Œ í‘œì‹œë©ë‹ˆë‹¤.
          </div>
        )}
      </div>
    </div>
  )
}
</file>

<file path="components/layout/three-column-layout.tsx">
import type { ReactNode } from "react"
import { cn } from "@/lib/utils"

interface ThreeColumnLayoutProps {
  children: ReactNode
  rightSidebar?: ReactNode
  header?: ReactNode  // ì „ì²´ ë„ˆë¹„ í—¤ë” (ë°°ë„ˆ ë“±)
  className?: string
}

/**
 * Reddit ìŠ¤íƒ€ì¼ ë ˆì´ì•„ì›ƒ
 * - ìµœëŒ€ í­: 1280px
 * - ì‚¬ì´ë“œë°”: ê³ ì • 312px
 * - ë©”ì¸: ë‚˜ë¨¸ì§€ ê³µê°„
 * - header: ì „ì²´ ë„ˆë¹„ë¡œ í‘œì‹œë˜ëŠ” ìƒë‹¨ ì˜ì—­ (ì»¤ë®¤ë‹ˆí‹° ë°°ë„ˆ ë“±)
 */
export function ThreeColumnLayout({ children, rightSidebar, header, className }: ThreeColumnLayoutProps) {
  return (
    <div className={cn("w-full max-w-[1280px] mx-auto px-4 sm:px-6 lg:px-8 py-6", className)}>
      {/* ì „ì²´ ë„ˆë¹„ í—¤ë” (ë°°ë„ˆ) */}
      {header && (
        <div className="mb-6">
          {header}
        </div>
      )}

      {/* ë©”ì¸ + ì‚¬ì´ë“œë°” */}
      <div className="flex gap-6 items-start">
        <main className="min-w-0 flex-1">
          {children}
        </main>

        {rightSidebar && (
          <aside className="hidden xl:block w-[312px] flex-shrink-0">
            <div className="sticky top-24 flex flex-col gap-3">
              {rightSidebar}
            </div>
          </aside>
        )}
      </div>
    </div>
  )
}
</file>

<file path="components/site-header-static.tsx">
"use client"

import Link from "next/link"
import Image from "next/image"
import { useEffect, useState } from "react"
import { createClient } from "@/lib/supabase/client"
import { SiteHeaderClient } from "./site-header-client"

export function SiteHeaderStatic() {
    const [user, setUser] = useState<any>(null)
    const [profile, setProfile] = useState<any>(null)
    const [isLoaded, setIsLoaded] = useState(false)

    useEffect(() => {
        const supabase = createClient()

        async function checkAuth() {
            try {
                // 1. ë¹ ë¥¸ í™•ì¸: ë¡œì»¬ ì„¸ì…˜ ë¨¼ì € ì‹œë„
                let { data: { session } } = await supabase.auth.getSession()

                // 2. Fallback: ì„¸ì…˜ì´ ì—†ì§€ë§Œ ì¿ í‚¤ëŠ” ìˆëŠ” ê²½ìš° (ìƒˆë¡œê³ ì¹¨/ë¦¬ë‹¤ì´ë ‰íŠ¸ ì§í›„)
                // getUser()ë¥¼ í˜¸ì¶œí•˜ì—¬ ì„œë²„ì—ì„œ ê°•ì œë¡œ ì„¸ì…˜ì„ ë³µêµ¬
                if (!session?.user && typeof document !== 'undefined' && document.cookie.includes('sb-')) {
                    const { data: { user }, error } = await supabase.auth.getUser()
                    if (user && !error) {
                        // ìœ ì €ê°€ í™•ì¸ë˜ë©´ ì„¸ì…˜ ê°ì²´ë„ ë‹¤ì‹œ ê°€ì ¸ì˜´
                        const sessionResult = await supabase.auth.getSession()
                        session = sessionResult.data.session
                    }
                }

                if (!session?.user) {
                    setUser(null)
                    setProfile(null)
                    return
                }

                setUser(session.user)

                const { data: profileData } = await supabase
                    .from("profiles")
                    .select("id, full_name, avatar_url, role, points")
                    .eq("id", session.user.id)
                    .single()

                setProfile(profileData)
            } catch (error) {
                console.error("[SiteHeader] Auth check failed:", error)
            } finally {
                setIsLoaded(true)
            }
        }

        checkAuth()

        const { data: { subscription } } = supabase.auth.onAuthStateChange((event, session) => {
            if (event === 'SIGNED_IN' && session?.user) {
                setUser(session.user)
                supabase
                    .from("profiles")
                    .select("id, full_name, avatar_url, role, points")
                    .eq("id", session.user.id)
                    .single()
                    .then(({ data }) => setProfile(data))
            } else if (event === 'SIGNED_OUT') {
                setUser(null)
                setProfile(null)
            }
        })

        return () => subscription.unsubscribe()
    }, [])

    return (
        <header className="fixed inset-x-0 top-0 z-50 h-16 w-full border-b border-slate-200/50 bg-white/80 backdrop-blur-xl supports-[backdrop-filter]:bg-white/75 shadow-sm shadow-slate-900/5">
            <div className="flex h-16 w-full items-center px-4 lg:px-[27px]">
                <div className="ml-1 mr-4 flex items-center">
                    <Link href="/" className="flex items-center hover:opacity-85 transition-opacity">
                        <Image
                            src="/images/logo-text.png"
                            alt="Seoul Founders Club"
                            width={580}
                            height={51}
                            className="h-8 w-auto max-w-56 object-contain"
                            priority
                        />
                    </Link>
                </div>

                <SiteHeaderClient
                    user={isLoaded ? user : null}
                    profile={isLoaded ? profile : null}
                    initialNotifications={[]}
                />
            </div>
        </header>
    )
}
</file>

<file path="components/ui/feed-post-card.tsx">
"use client"

import { MessageSquare, Share2, Tag, Check } from "lucide-react"
import { cn } from "@/lib/utils"
import { useRouter } from "next/navigation"
import { useEffect, useMemo, useState } from "react"
import { useToast } from "@/hooks/use-toast"
import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar"

/**
 * FeedPostCard - Reddit ìŠ¤íƒ€ì¼ í”¼ë“œ ì¹´ë“œ
 *
 * ë©”ì¸ í”¼ë“œì—ì„œ ì‚¬ìš©í•˜ëŠ” ìµëª… ìŠ¤íƒ€ì¼ í¬ìŠ¤íŠ¸ ì¹´ë“œ
 * - ì‘ì„±ì ì•„ë°”íƒ€/ì´ë¦„ ìˆ¨ê¹€
 * - ì¶œì²˜ íƒœê·¸(ê²Œì‹œíŒ/ì»¤ë®¤ë‹ˆí‹°ëª…)ë§Œ í‘œì‹œ
 * - ìƒì„¸ í˜ì´ì§€ì—ì„œ ì‘ì„±ì ì •ë³´ í™•ì¸ ê°€ëŠ¥
 *
 * showAuthor=trueì¼ ê²½ìš° ì‘ì„±ì ì •ë³´ í‘œì‹œ (ì»¤ë®¤ë‹ˆí‹° ì„¸ë¶€ í˜ì´ì§€ìš©)
 */

type FeedPostCardProps = {
  postId: string
  href: string
  source: { name: string; href?: string }  // ì¶œì²˜ (ê²Œì‹œíŒ ë˜ëŠ” ì»¤ë®¤ë‹ˆí‹°)
  createdAt: string
  title: string
  content?: string | null
  contentRaw?: string | null
  thumbnailUrl?: string | null
  commentsCount?: number
  isLast?: boolean  // ë§ˆì§€ë§‰ ì•„ì´í…œ ì—¬ë¶€ (í•˜ë‹¨ border ì œê±°ìš©)
  showAuthor?: boolean  // ì‘ì„±ì ì •ë³´ í‘œì‹œ ì—¬ë¶€
  author?: {
    name: string | null
    avatarUrl: string | null
  } | null
}

export function FeedPostCard({
  postId,
  href,
  source,
  createdAt,
  title,
  content,
  contentRaw,
  thumbnailUrl,
  commentsCount = 0,
  isLast = false,
  showAuthor = false,
  author,
}: FeedPostCardProps) {
  const router = useRouter()
  const { toast } = useToast()
  const [copied, setCopied] = useState(false)
  const [timeLabel, setTimeLabel] = useState<string>("")

  // Hydration ì—ëŸ¬ ë°©ì§€: í´ë¼ì´ì–¸íŠ¸ ë§ˆìš´íŠ¸ í›„ì—ë§Œ ì‹œê°„ ê³„ì‚°
  useEffect(() => {
    setTimeLabel(formatRelativeTime(createdAt))
  }, [createdAt])

  const derivedThumb = thumbnailUrl || extractFirstImage(contentRaw || content)
  const previewHtml = useMemo(
    () => sanitizePreview(contentRaw || content || "", Boolean(derivedThumb)),
    [content, contentRaw, derivedThumb]
  )

  // ê³µìœ  ë²„íŠ¼ í•¸ë“¤ëŸ¬
  const handleShare = async (e: React.MouseEvent) => {
    e.preventDefault()
    e.stopPropagation()

    const shareUrl = window.location.origin + href
    const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent)

    // ëª¨ë°”ì¼: Web Share API ì‚¬ìš©
    if (isMobile && navigator.share) {
      try {
        await navigator.share({
          title: title,
          url: shareUrl,
        })
        toast({ description: "ê³µìœ ë˜ì—ˆìŠµë‹ˆë‹¤!", duration: 2000 })
        return
      } catch (error: any) {
        if (error.name === 'AbortError') return
      }
    }

    // PC: í´ë¦½ë³´ë“œ ë³µì‚¬
    try {
      await navigator.clipboard.writeText(shareUrl)
      setCopied(true)
      toast({ description: "ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!", duration: 2000 })
      setTimeout(() => setCopied(false), 2000)
    } catch {
      toast({
        title: "ë³µì‚¬ ì‹¤íŒ¨",
        description: "ë§í¬ë¥¼ ë³µì‚¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",
        variant: "destructive",
      })
    }
  }

  return (
    <article
      role="link"
      tabIndex={0}
      onClick={() => router.push(href)}
      onKeyDown={(e) => {
        if (e.key === "Enter" || e.key === " ") {
          e.preventDefault()
          router.push(href)
        }
      }}
      className={cn(
        "bg-white hover:bg-slate-50/50 transition-colors py-3 px-4",
        "cursor-pointer",
        !isLast && "border-b border-slate-200"
      )}
    >
      {/* Header - ì¶œì²˜ íƒœê·¸ì™€ ì‹œê°„ í‘œì‹œ (Reddit ìŠ¤íƒ€ì¼) */}
      <div className="pb-1 flex items-center justify-between text-xs text-slate-500">
        <div className="flex items-center gap-2">
          {/* ì‘ì„±ì ì •ë³´ (showAuthorê°€ trueì¼ ë•Œë§Œ í‘œì‹œ) */}
          {showAuthor && author && (
            <>
              <Avatar className="h-6 w-6">
                <AvatarImage src={author.avatarUrl || undefined} />
                <AvatarFallback className="text-[10px] bg-slate-100">
                  {author.name?.charAt(0) || "?"}
                </AvatarFallback>
              </Avatar>
              <span className="font-medium text-slate-700">
                {author.name || "ìµëª…"}
              </span>
              <span className="text-slate-400">â€¢</span>
            </>
          )}
          <span
            className="inline-flex items-center gap-1.5 text-xs font-medium text-slate-600 bg-slate-100 px-2.5 py-1 rounded-full hover:bg-slate-200 transition-colors"
            onClick={(e) => {
              if (source.href) {
                e.preventDefault()
                e.stopPropagation()
                router.push(source.href)
              }
            }}
          >
            <Tag className="h-3 w-3" />
            {source.name}
          </span>
        </div>
        <span className="text-slate-400 shrink-0">{timeLabel}</span>
      </div>

      {/* Title */}
      <div className="py-1">
        <h3 className="text-lg font-bold text-slate-900 leading-snug">
          {title}
        </h3>
      </div>

      {/* Content Preview + Image */}
      <div className="pb-2">
        {(contentRaw || content) && (
          <div
            className="prose prose-slate max-w-none text-sm leading-relaxed line-clamp-4"
            dangerouslySetInnerHTML={{ __html: previewHtml }}
          />
        )}
        {derivedThumb && (
          <div className="mt-3 w-full h-[280px] rounded bg-slate-100 overflow-hidden">
            <img
              src={derivedThumb}
              alt={title}
              className="w-full h-full object-cover"
              loading="lazy"
            />
          </div>
        )}
      </div>

      {/* Footer */}
      <div className="pt-2 flex items-center gap-1 text-xs text-slate-500">
        {/* ëŒ“ê¸€ ë²„íŠ¼ */}
        <button
          type="button"
          className="flex items-center gap-1 px-2 py-1 rounded-full hover:bg-slate-200 transition-colors"
          onClick={(e) => {
            e.preventDefault()
            e.stopPropagation()
            router.push(href)
          }}
        >
          <MessageSquare className="h-4 w-4" />
          <span>{commentsCount}</span>
        </button>

        {/* ê³µìœ  ë²„íŠ¼ */}
        <button
          type="button"
          className="flex items-center gap-1 px-2 py-1 rounded-full hover:bg-slate-200 transition-colors"
          onClick={handleShare}
        >
          {copied ? <Check className="h-4 w-4" /> : <Share2 className="h-4 w-4" />}
          <span>{copied ? "ë³µì‚¬ë¨" : "ê³µìœ "}</span>
        </button>
      </div>
    </article>
  )
}

function formatRelativeTime(dateStr: string) {
  const date = new Date(dateStr)
  const diff = Date.now() - date.getTime()
  const sec = Math.floor(diff / 1000)
  if (sec < 60) return `${sec}ì´ˆ ì „`
  const min = Math.floor(sec / 60)
  if (min < 60) return `${min}ë¶„ ì „`
  const hr = Math.floor(min / 60)
  if (hr < 24) return `${hr}ì‹œê°„ ì „`
  const day = Math.floor(hr / 24)
  if (day < 30) return `${day}ì¼ ì „`
  const mo = Math.floor(day / 30)
  if (mo < 12) return `${mo}ê°œì›” ì „`
  const yr = Math.floor(mo / 12)
  return `${yr}ë…„ ì „`
}

function extractFirstImage(content?: string | null): string | null {
  if (!content) return null
  const match = content.match(/<img[^>]+src=["']([^"']+)["']/i)
  return match ? match[1] : null
}

function sanitizePreview(html: string, stripImages = false): string {
  if (!html) return ""
  let safe = html
  safe = safe.replace(/<script[\s\S]*?>[\s\S]*?<\/script>/gi, "")
  safe = safe.replace(/\son\w+="[^"]*"/gi, "")
  safe = safe.replace(/\son\w+='[^']*'/gi, "")
  safe = safe.replace(/<style[\s\S]*?>[\s\S]*?<\/style>/gi, "")
  if (stripImages) {
    safe = safe.replace(/<img[^>]*>/gi, "")
  }
  return safe
}
</file>

<file path="app/auth/callback/route.ts">
import { type NextRequest, NextResponse } from "next/server";
import { createServerClient } from "@supabase/ssr";

export async function GET(request: NextRequest) {
  const requestUrl = new URL(request.url);
  const code = requestUrl.searchParams.get("code");
  const next = requestUrl.searchParams.get("next") ?? "/";

  // 1. ë°°í¬ í™˜ê²½(í”„ë¡œë•ì…˜)ì´ë©´ ë¬´ì¡°ê±´ https://seoulfounders.club ì‚¬ìš©
  const isDevelopment = process.env.NODE_ENV === "development";
  const origin = isDevelopment ? requestUrl.origin : "https://seoulfounders.club";

  // 2. ë¦¬ë‹¤ì´ë ‰íŠ¸ ì‘ë‹µ ê°ì²´ ë¯¸ë¦¬ ìƒì„±
  const response = NextResponse.redirect(`${origin}${next}`);

  if (code) {
    const supabase = createServerClient(
      process.env.NEXT_PUBLIC_SUPABASE_URL!,
      process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
      {
        cookies: {
          getAll() {
            return request.cookies.getAll();
          },
          setAll(cookiesToSet) {
            cookiesToSet.forEach(({ name, value, options }) => {
              // âœ… í•µì‹¬: response ê°ì²´ì— ì¿ í‚¤ ì„¤ì • + options ê·¸ëŒ€ë¡œ ì „ë‹¬
              // Supabaseê°€ httpOnly/Secure ë“±ì„ ìë™ ê´€ë¦¬í•˜ë¯€ë¡œ ë®ì–´ì“°ì§€ ì•ŠìŒ
              response.cookies.set(name, value, options);
            });
          },
        },
      }
    );

    const { data, error } = await supabase.auth.exchangeCodeForSession(code);

    if (!error) {

      // [ì‹ ê·œ ê°€ì… ì•Œë¦¼ ë¡œì§]
      try {
        const user = data.user;
        if (user) {
          const adminSupabase = createServerClient(
            process.env.NEXT_PUBLIC_SUPABASE_URL!,
            process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
            { cookies: { getAll: () => [], setAll: () => {} } }
          );

          const { data: profile } = await adminSupabase
            .from("profiles")
            .select("last_login_date, full_name, email")
            .eq("id", user.id)
            .single();

          if (profile && !profile.last_login_date) {
            const { data: masters } = await adminSupabase
              .from("profiles")
              .select("id")
              .eq("role", "master");

            if (masters && masters.length > 0) {
              const userName = profile.full_name || profile.email?.split('@')[0] || "ì•Œ ìˆ˜ ì—†ìŒ";
              const notifications = masters.map(master => ({
                user_id: master.id,
                type: "new_member",
                title: "ìƒˆë¡œìš´ ë©¤ë²„ ê°€ì…",
                message: `ìƒˆë¡œìš´ ë©¤ë²„ '${userName}'ë‹˜ì´ ê°€ì…í–ˆìŠµë‹ˆë‹¤.`,
                related_post_id: null,
                related_event_id: null,
                actor_id: user.id,
                is_read: false
              }));
              await adminSupabase.from("notifications").insert(notifications);
            }
          }

          await adminSupabase
            .from("profiles")
            .update({ last_login_date: new Date().toISOString() })
            .eq("id", user.id);
        }
      } catch (err) {
        console.error("[auth/callback] Notification error:", err);
      }

      // 3. ì¿ í‚¤ê°€ ë‹´ê¸´ response ë°˜í™˜
      return response;
    }
  }

  return NextResponse.redirect(`${origin}/auth/login?error=auth_code_error`);
}
</file>

<file path="app/community/board/[slug]/page.tsx">
import { createClient } from "@/lib/supabase/server";
import { notFound } from 'next/navigation';
import { isAdmin } from "@/lib/utils";
import { BoardPageClient } from "./board-page-client";

// ISR: 30ì´ˆë§ˆë‹¤ ì¬ê²€ì¦ (ê²Œì‹œíŒì€ ë¹„êµì  ì§§ì€ ìºì‹œ)
export const revalidate = 30;

// ì „ì²´ ê³µê°œ ê²Œì‹œíŒ slug ëª©ë¡ (ì°¸ê³ ìš©, ë©”íƒ€ë°ì´í„° ìƒì„±ì—ì„  ì•ˆ ì“°ì§€ë§Œ ë¡œì§ì—” í•„ìš”í•  ìˆ˜ ìˆìŒ)
const PUBLIC_BOARDS = ["free", "vangol", "hightalk"];

export default async function BoardPage({
  params,
}: {
  params: Promise<{ slug: string }>;
}) {
  const { slug } = await params;
  const supabase = await createClient();

  // â˜… URL ìŠ¬ëŸ¬ê·¸ -> DB ìŠ¬ëŸ¬ê·¸ ë³€í™˜ (ê°•ì œ ì ìš©)
  let dbSlug = slug;

  // â˜… URLì´ 'free'ë©´ DBì˜ 'free-board'ë¥¼ ì°¾ì•„ë¼!
  if (slug === 'free') {
    dbSlug = 'free-board';
  }

  // ê³µì§€ì‚¬í•­ë„ ë§ˆì°¬ê°€ì§€
  if (slug === 'announcements') {
    dbSlug = 'announcement';
  }

  // ë””ë²„ê¹…ìš© ë¡œê·¸: ê°œë°œ í™˜ê²½ì—ì„œë§Œ ì¶œë ¥
  if (process.env.NODE_ENV === 'development') {
    console.log('Current Slug:', slug, 'Mapped DB Slug:', dbSlug);
  }

  // insights slug ë§¤í•‘
  if (slug === 'insights') {
    dbSlug = 'insights';
  }

  // ì„¸ì…˜ ë¨¼ì € í™•ì¸ (ë¹„ë¡œê·¸ì¸ ìµœì í™” - getUser ë„¤íŠ¸ì›Œí¬ í˜¸ì¶œ ë°©ì§€)
  // ì°¸ê³ : validSlugs í•˜ë“œì½”ë”© ì œê±° - DBì—ì„œ ì§ì ‘ í™•ì¸
  const [categoryResult, sessionResult] = await Promise.all([
    supabase
      .from("board_categories")
      .select("id, name, description, slug, is_active")
      .eq("slug", dbSlug) // â˜… dbSlug ì‚¬ìš© (ë§¤í•‘ëœ ì‹¤ì œ DB ìŠ¬ëŸ¬ê·¸)
      .eq("is_active", true)
      .single(),
    supabase.auth.getSession(),
  ]);

  let category = categoryResult.data;
  const session = sessionResult.data.session;

  // board_categoriesì— ì—†ìœ¼ë©´ communities í…Œì´ë¸”ì—ì„œ ì°¾ê¸°
  if (!category) {
    // communities í…Œì´ë¸”ì—ì„œ name ê¸°ë°˜ slug ë§¤ì¹­
    // nameì„ slugë¡œ ë³€í™˜: "Weekly Vibe" -> "weekly-vibe"
    const { data: communities } = await supabase
      .from("communities")
      .select("id, name, description")
      .limit(50); // ìµœëŒ€ 50ê°œë§Œ ì¡°íšŒ (ì„±ëŠ¥ ìµœì í™”)

    const matchedCommunity = communities?.find((c) => {
      const generatedSlug = c.name.trim().toLowerCase().replace(/\s+/g, '-');
      return generatedSlug === dbSlug || generatedSlug === slug;
    });

    if (matchedCommunity) {
      // ê°€ìƒ ì¹´í…Œê³ ë¦¬ ìƒì„±
      category = {
        id: matchedCommunity.id,
        name: matchedCommunity.name,
        description: matchedCommunity.description,
        slug: matchedCommunity.name.trim().toLowerCase().replace(/\s+/g, '-'),
        is_active: true,
      }
    }
  }

  if (!category) {
    notFound();
  }

  // ê´€ë¦¬ì ì—¬ë¶€ í™•ì¸ (ì„¸ì…˜ì´ ìˆì„ ë•Œë§Œ getUser í˜¸ì¶œ)
  let user = null;
  let isUserAdmin = false;
  let userProfile: any = null;

  if (session) {
    const { data: { user: authUser } } = await supabase.auth.getUser();
    user = authUser;

    if (user) {
      const { data: profile } = await supabase
        .from("profiles")
        .select("role, email")
        .eq("id", user.id)
        .single();
      userProfile = profile;
      isUserAdmin = isAdmin(profile?.role, profile?.email);
    }
  }

  // ì»¤ë®¤ë‹ˆí‹° ID ë° ë©¤ë²„ì‹­ í™•ì¸ (ì‹œìŠ¤í…œ ê²Œì‹œíŒ ì œì™¸)
  const systemBoards = ['announcement', 'free-board', 'event-requests', 'insights'];
  const isSystemBoard = systemBoards.includes(dbSlug);

  // board_categoriesì—ì„œ ê°€ì ¸ì˜¨ ì¹´í…Œê³ ë¦¬ì¸ì§€ í™•ì¸ (categoryResult.dataê°€ ìˆìœ¼ë©´ ì‹¤ì œ DB ì¹´í…Œê³ ë¦¬)
  const isRealBoardCategory = !!categoryResult.data;

  // ì„œë²„ ì‚¬ì´ë“œì—ì„œ ì´ˆê¸° posts ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (RLS ë¬¸ì œ ë°©ì§€)
  let postsResult;

  if (isRealBoardCategory) {
    // board_categoriesì— ìˆëŠ” ê²½ìš° - ëŒ“ê¸€ ìˆ˜ë¥¼ JOINìœ¼ë¡œ ê°€ì ¸ì˜´
    postsResult = await supabase
      .from("posts")
      .select(`
        *,
        profiles:author_id(full_name, avatar_url),
        board_categories!inner(name, slug),
        post_images(id, image_url, sort_order),
        comments(count)
      `, { count: "exact" })
      .eq("board_categories.slug", dbSlug)
      .order("created_at", { ascending: false })
      .range(0, 14);
  } else {
    // communitiesì—ì„œ ê°€ì ¸ì˜¨ ê²½ìš° board_category_idë¡œ ì¡°íšŒ
    // ë¨¼ì € í•´ë‹¹ ì»¤ë®¤ë‹ˆí‹°ì˜ board_categoryê°€ ìˆëŠ”ì§€ í™•ì¸
    const { data: boardCat } = await supabase
      .from("board_categories")
      .select("id")
      .eq("name", category.name)
      .single();

    if (boardCat) {
      postsResult = await supabase
        .from("posts")
        .select(`
          *,
          profiles:author_id(full_name, avatar_url),
          board_categories(name, slug),
          post_images(id, image_url, sort_order),
          comments(count)
        `, { count: "exact" })
        .eq("board_category_id", boardCat.id)
        .order("created_at", { ascending: false })
        .range(0, 14);
    } else {
      // board_categoryê°€ ì—†ìœ¼ë©´ ë¹ˆ ê²°ê³¼
      postsResult = { data: [], count: 0, error: null };
    }
  }

  // ë””ë²„ê¹… ë¡œê·¸ (ê°œë°œ í™˜ê²½ì—ì„œë§Œ ì¶œë ¥)
  if (process.env.NODE_ENV === 'development') {
    if (postsResult.error) {
      console.error('[BoardPage] Posts query error:', postsResult.error);
    }
    console.log('[BoardPage] dbSlug:', dbSlug, 'posts count:', postsResult.data?.length || 0);
  }

  const initialPosts = postsResult.data || [];
  const initialPostsCount = postsResult.count || 0;

  // ëŒ“ê¸€ ìˆ˜ëŠ” posts ì¿¼ë¦¬ì—ì„œ JOINìœ¼ë¡œ ê°€ì ¸ì˜´ (ë³„ë„ ì¿¼ë¦¬ ë¶ˆí•„ìš”)
  // comments(count) ê²°ê³¼ë¥¼ comments_countë¡œ ë³€í™˜
  const postsWithCounts = initialPosts.map((post: any) => ({
    ...post,
    likes_count: post.likes_count || 0,
    comments_count: post.comments?.[0]?.count || 0,
  }));

  let communityId: string | null = null;
  let isMember = false;
  let communityData: any = null;
  let membershipStatus: "none" | "member" | "pending" | "admin" | "owner" = "none";

  if (!isSystemBoard) {
    // communities í…Œì´ë¸”ì—ì„œ ì»¤ë®¤ë‹ˆí‹° ì •ë³´ ê°€ì ¸ì˜¤ê¸° (ëª¨ë°”ì¼ ë°”ìš© í™•ì¥)
    const { data: community } = await supabase
      .from("communities")
      .select(`
        id,
        name,
        description,
        rules,
        thumbnail_url,
        banner_url,
        is_private,
        join_type,
        created_by
      `)
      .eq("name", category.name)
      .single();

    communityId = community?.id || null;

    // communities í…Œì´ë¸”ì˜ descriptionì´ ìˆìœ¼ë©´ ê·¸ê²ƒì„ ì‚¬ìš©
    if (community?.description) {
      category.description = community.description;
    }

    if (communityId) {
      // ë©¤ë²„ ìˆ˜, ìš´ì˜ì, ë©¤ë²„ì‹­ì„ ë³‘ë ¬ë¡œ ì¡°íšŒ
      const [memberCountResult, moderatorsResult, membershipResult, joinRequestResult] = await Promise.all([
        // ë©¤ë²„ ìˆ˜ ì¡°íšŒ
        supabase
          .from("community_members")
          .select("*", { count: "exact", head: true })
          .eq("community_id", communityId),
        // ìš´ì˜ì ëª©ë¡ ì¡°íšŒ
        supabase
          .from("community_members")
          .select(`
            role,
            profiles:user_id (
              id,
              full_name,
              avatar_url
            )
          `)
          .eq("community_id", communityId)
          .in("role", ["owner", "admin"]),
        // ë©¤ë²„ì‹­ í™•ì¸ (userê°€ ìˆì„ ë•Œë§Œ)
        user
          ? supabase
              .from("community_members")
              .select("id, role")
              .eq("community_id", communityId)
              .eq("user_id", user.id)
              .maybeSingle()
          : Promise.resolve({ data: null }),
        // ê°€ì… ì‹ ì²­ ìƒíƒœ í™•ì¸ (userê°€ ìˆì„ ë•Œë§Œ)
        user
          ? supabase
              .from("community_join_requests")
              .select("status")
              .eq("community_id", communityId)
              .eq("user_id", user.id)
              .eq("status", "pending")
              .maybeSingle()
          : Promise.resolve({ data: null }),
      ]);

      const memberCount = memberCountResult.count;

      // ìš´ì˜ì ëª©ë¡ ë§¤í•‘
      let moderators = (moderatorsResult.data || []).map((m: any) => ({
        ...m.profiles,
        role: m.role,
      }));

      // ì»¤ë®¤ë‹ˆí‹° ìƒì„±ì(created_by)ê°€ moderatorsì— ì—†ìœ¼ë©´ ë¦¬ë”ë¡œ ì¶”ê°€
      if (community?.created_by) {
        const creatorInModerators = moderators.some((m: any) => m.id === community.created_by);
        if (!creatorInModerators) {
          // ìƒì„±ì í”„ë¡œí•„ ì¡°íšŒ
          const { data: creatorProfile } = await supabase
            .from("profiles")
            .select("id, full_name, avatar_url")
            .eq("id", community.created_by)
            .single();

          if (creatorProfile) {
            // ìƒì„±ìë¥¼ ë¦¬ë”ë¡œ ë§¨ ì•ì— ì¶”ê°€
            moderators = [{ ...creatorProfile, role: "owner" }, ...moderators];
          }
        }
      }

      communityData = {
        id: communityId,
        name: community?.name || category.name,
        description: community?.description || null,
        rules: community?.rules || null,
        thumbnail_url: community?.thumbnail_url || null,
        banner_url: community?.banner_url || null,
        is_private: community?.is_private || false,
        join_type: community?.join_type || "free",
        member_count: memberCount || 0,
        moderators,
      };

      // ë©¤ë²„ì‹­ ìƒíƒœ ê²°ì •
      if (user) {
        const membership = membershipResult.data;
        if (membership) {
          isMember = true;
          if (membership.role === "owner" || community?.created_by === user.id) {
            membershipStatus = "owner";
          } else if (membership.role === "admin") {
            membershipStatus = "admin";
          } else {
            membershipStatus = "member";
          }
        } else if (joinRequestResult.data) {
          membershipStatus = "pending";
        }
      }
    }
  }

  return (
    <BoardPageClient
      slug={slug}
      dbSlug={dbSlug}
      category={category}
      isUserAdmin={isUserAdmin}
      user={user}
      communityId={communityId}
      isMember={isMember}
      membershipStatus={membershipStatus}
      initialPosts={postsWithCounts}
      initialPostsCount={initialPostsCount}
      communityData={communityData}
      isSystemBoard={isSystemBoard}
    />
  );
}
</file>

<file path="components/community/community-grid.tsx">
"use client"

import Link from "next/link"
import { Card, CardContent } from "@/components/ui/card"
import { Button } from "@/components/ui/button"
import { Check, Crown, Shield } from "lucide-react"

interface Community {
    id: string
    name: string
    description: string | null
    slug: string
    communityId?: string
    isMember?: boolean
    role?: string | null
}

interface CommunityGridProps {
    communities: Community[]
}

export function CommunityGrid({ communities }: CommunityGridProps) {
    const getMembershipBadge = (community: Community) => {
        if (!community.isMember) {
            return (
                <span className="inline-flex items-center px-2 py-0.5 text-[11px] font-medium text-slate-500 bg-slate-100 rounded">
                    ê°€ì…í•˜ê¸°
                </span>
            )
        }

        if (community.role === "owner") {
            return (
                <span className="inline-flex items-center gap-1 px-2 py-0.5 text-[11px] font-medium text-amber-700 bg-amber-50 rounded">
                    <Crown className="h-3 w-3" />
                    ë¦¬ë”
                </span>
            )
        }

        if (community.role === "admin") {
            return (
                <span className="inline-flex items-center gap-1 px-2 py-0.5 text-[11px] font-medium text-slate-600 bg-slate-100 rounded">
                    <Shield className="h-3 w-3" />
                    ìš´ì˜ì§„
                </span>
            )
        }

        return (
            <span className="inline-flex items-center gap-1 px-2 py-0.5 text-[11px] font-medium text-green-700 bg-green-50 rounded">
                <Check className="h-3 w-3" />
                ì°¸ì—¬ì¤‘
            </span>
        )
    }

    return (
        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3">
            {communities.map((community) => (
                <Link key={community.id} href={`/community/board/${community.slug}`} className="group block">
                    <div className="flex gap-3 p-4 rounded-xl border border-slate-200 bg-white hover:border-slate-300 hover:shadow-sm transition-all h-full min-h-[120px]">
                        {/* ì•„ì´ì½˜ */}
                        <div className="shrink-0">
                            <div className="w-11 h-11 rounded-lg bg-gradient-to-br from-slate-100 to-slate-200 flex items-center justify-center group-hover:from-slate-200 group-hover:to-slate-300 transition-colors">
                                <span className="text-base font-bold text-slate-600">
                                    {community.name.slice(0, 1)}
                                </span>
                            </div>
                        </div>

                        {/* ì½˜í…ì¸  */}
                        <div className="flex-1 min-w-0 flex flex-col">
                            <div className="flex items-center justify-between gap-2 mb-1">
                                <h3 className="text-sm font-semibold text-slate-900 truncate">
                                    {community.name}
                                </h3>
                                <div className="shrink-0">
                                    {getMembershipBadge(community)}
                                </div>
                            </div>
                            <p className="text-xs text-slate-500 line-clamp-3 leading-relaxed flex-1">
                                {community.description || "í•¨ê»˜ ì†Œí†µí•˜ê³  ì„±ì¥í•˜ëŠ” ì»¤ë®¤ë‹ˆí‹°"}
                            </p>
                        </div>
                    </div>
                </Link>
            ))}
        </div>
    )
}
</file>

<file path="components/community/community-settings-modal.tsx">
"use client"

import { useState, useMemo } from "react"
import { useRouter } from "next/navigation"
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
} from "@/components/ui/dialog"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { Textarea } from "@/components/ui/textarea"
import { Label } from "@/components/ui/label"
import { Switch } from "@/components/ui/switch"
import { Loader2, Trash2, AlertTriangle, ImageIcon, Search, X } from "lucide-react"
import { searchUnsplashImages, getAllUnsplashImages } from "@/lib/utils/unsplash"
import Image from "next/image"
import { toast } from "@/hooks/use-toast"
import { updateCommunitySettings, deleteCommunity } from "@/lib/actions/community"
import {
  AlertDialog,
  AlertDialogAction,
  AlertDialogCancel,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogTitle,
  AlertDialogTrigger,
} from "@/components/ui/alert-dialog"

interface CommunitySettingsModalProps {
  open: boolean
  onOpenChange: (open: boolean) => void
  community: {
    id: string
    name: string
    description: string | null
    is_private: boolean
    rules: string | null
    thumbnail_url: string | null
    banner_url: string | null
  }
  isOwner?: boolean // ë¦¬ë”(owner)ì¸ì§€ ì—¬ë¶€ - ì´ë¦„ ìˆ˜ì •, ì‚­ì œ ê¶Œí•œ
  onSuccess?: () => void
}

export function CommunitySettingsModal({
  open,
  onOpenChange,
  community,
  isOwner = false,
  onSuccess,
}: CommunitySettingsModalProps) {
  const router = useRouter()
  const [isLoading, setIsLoading] = useState(false)
  const [isDeleting, setIsDeleting] = useState(false)
  const [deleteConfirmName, setDeleteConfirmName] = useState("")
  const [formData, setFormData] = useState({
    name: community.name,
    description: community.description || "",
    is_private: community.is_private,
    rules: community.rules || "",
    thumbnail_url: community.thumbnail_url || "",
    banner_url: community.banner_url || "",
  })

  // Unsplash ê²€ìƒ‰ì–´ ìƒíƒœ
  const [bannerSearch, setBannerSearch] = useState("")
  const [iconSearch, setIconSearch] = useState("")

  // ê²€ìƒ‰ ê²°ê³¼ (ë©”ëª¨ì´ì œì´ì…˜)
  const bannerImages = useMemo(() => {
    if (bannerSearch.trim()) {
      return searchUnsplashImages(bannerSearch, 'banner')
    }
    return getAllUnsplashImages('banner')
  }, [bannerSearch])

  const iconImages = useMemo(() => {
    if (iconSearch.trim()) {
      return searchUnsplashImages(iconSearch, 'icon')
    }
    return getAllUnsplashImages('icon')
  }, [iconSearch])

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()

    if (!formData.name.trim()) {
      toast({
        title: "ì˜¤ë¥˜",
        description: "ì»¤ë®¤ë‹ˆí‹° ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.",
        variant: "destructive",
      })
      return
    }

    setIsLoading(true)
    try {
      const result = await updateCommunitySettings(community.id, {
        name: formData.name.trim(),
        description: formData.description.trim() || undefined,
        is_private: formData.is_private,
        rules: formData.rules.trim() || undefined,
        thumbnail_url: formData.thumbnail_url.trim() || undefined,
        banner_url: formData.banner_url.trim() || undefined,
      })

      if (result.error) {
        throw new Error(result.error)
      }

      toast({
        title: "ì„¤ì • ì €ì¥ ì™„ë£Œ",
        description: "ì»¤ë®¤ë‹ˆí‹° ì„¤ì •ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.",
      })

      onOpenChange(false)
      onSuccess?.()
      router.refresh()
    } catch (error: any) {
      toast({
        title: "ì„¤ì • ì €ì¥ ì‹¤íŒ¨",
        description: error.message || "ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.",
        variant: "destructive",
      })
    } finally {
      setIsLoading(false)
    }
  }

  const handleDelete = async () => {
    if (deleteConfirmName !== community.name) {
      toast({
        title: "ì‚­ì œ ì‹¤íŒ¨",
        description: "ì»¤ë®¤ë‹ˆí‹° ì´ë¦„ì´ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.",
        variant: "destructive",
      })
      return
    }

    setIsDeleting(true)
    try {
      const result = await deleteCommunity(community.id)

      if (result.error) {
        throw new Error(result.error)
      }

      toast({
        title: "ì‚­ì œ ì™„ë£Œ",
        description: "ì»¤ë®¤ë‹ˆí‹°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.",
      })

      onOpenChange(false)
      router.push("/community")
    } catch (error: any) {
      toast({
        title: "ì‚­ì œ ì‹¤íŒ¨",
        description: error.message || "ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.",
        variant: "destructive",
      })
    } finally {
      setIsDeleting(false)
      setDeleteConfirmName("")
    }
  }

  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      <DialogContent className="sm:max-w-lg">
        <DialogHeader>
          <DialogTitle>ì»¤ë®¤ë‹ˆí‹° ì„¤ì •</DialogTitle>
        </DialogHeader>

        <form onSubmit={handleSubmit} className="space-y-6">
          {/* ì»¤ë®¤ë‹ˆí‹° ì´ë¦„ - ë¦¬ë”ë§Œ ìˆ˜ì • ê°€ëŠ¥ */}
          <div className="space-y-2">
            <Label htmlFor="name">ì»¤ë®¤ë‹ˆí‹° ì´ë¦„</Label>
            <Input
              id="name"
              value={formData.name}
              onChange={(e) => setFormData({ ...formData, name: e.target.value })}
              placeholder="ì»¤ë®¤ë‹ˆí‹° ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”"
              disabled={isLoading || !isOwner}
            />
            {!isOwner && (
              <p className="text-xs text-slate-500">
                ì»¤ë®¤ë‹ˆí‹° ì´ë¦„ì€ ë¦¬ë”ë§Œ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
              </p>
            )}
          </div>

          {/* ì†Œê°œê¸€ */}
          <div className="space-y-2">
            <Label htmlFor="description">ì†Œê°œê¸€</Label>
            <Textarea
              id="description"
              value={formData.description}
              onChange={(e) => setFormData({ ...formData, description: e.target.value })}
              placeholder="ì»¤ë®¤ë‹ˆí‹° ì†Œê°œê¸€ì„ ì…ë ¥í•˜ì„¸ìš”"
              rows={3}
              disabled={isLoading}
            />
          </div>

          {/* ë°°ë„ˆ ì´ë¯¸ì§€ */}
          <div className="space-y-3">
            <Label>ë°°ë„ˆ ì´ë¯¸ì§€</Label>
            {/* í˜„ì¬ ë°°ë„ˆ ë¯¸ë¦¬ë³´ê¸° */}
            {formData.banner_url && (
              <div className="relative h-24 rounded-lg overflow-hidden bg-slate-100">
                <Image
                  src={formData.banner_url}
                  alt="ë°°ë„ˆ ë¯¸ë¦¬ë³´ê¸°"
                  fill
                  className="object-cover"
                />
                <button
                  type="button"
                  onClick={() => setFormData({ ...formData, banner_url: "" })}
                  className="absolute top-2 right-2 p-1 bg-black/50 hover:bg-black/70 rounded-full transition-colors"
                >
                  <X className="h-3 w-3 text-white" />
                </button>
              </div>
            )}
            {/* ê²€ìƒ‰ ì…ë ¥ */}
            <div className="relative">
              <Search className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400" />
              <Input
                value={bannerSearch}
                onChange={(e) => setBannerSearch(e.target.value)}
                placeholder="ë°°ë„ˆ ì´ë¯¸ì§€ ê²€ìƒ‰ (ì˜ˆ: tech, business, community)"
                className="pl-9"
                disabled={isLoading}
              />
            </div>
            {/* ì´ë¯¸ì§€ ì„ íƒ ê·¸ë¦¬ë“œ */}
            <div className="space-y-2">
              <p className="text-xs text-slate-500 flex items-center gap-1">
                <ImageIcon className="h-3 w-3" />
                {bannerSearch ? `"${bannerSearch}" ê²€ìƒ‰ ê²°ê³¼` : "ì¶”ì²œ ë°°ë„ˆ"} (í´ë¦­í•˜ì—¬ ì„ íƒ)
              </p>
              <div className="grid grid-cols-3 gap-2">
                {bannerImages.map((url, idx) => (
                  <button
                    key={idx}
                    type="button"
                    onClick={() => setFormData({ ...formData, banner_url: url })}
                    className={`relative h-14 rounded-md overflow-hidden border-2 transition-all ${
                      formData.banner_url === url
                        ? "border-blue-500 ring-2 ring-blue-200"
                        : "border-slate-200 hover:border-slate-300"
                    }`}
                  >
                    <Image
                      src={url}
                      alt={`ë°°ë„ˆ ${idx + 1}`}
                      fill
                      className="object-cover"
                    />
                  </button>
                ))}
              </div>
            </div>
          </div>

          {/* ì»¤ë®¤ë‹ˆí‹° ì•„ì´ì½˜ */}
          <div className="space-y-3">
            <Label>ì»¤ë®¤ë‹ˆí‹° ì•„ì´ì½˜</Label>
            {/* í˜„ì¬ ì•„ì´ì½˜ ë¯¸ë¦¬ë³´ê¸° */}
            {formData.thumbnail_url && (
              <div className="relative w-16 h-16 rounded-lg overflow-hidden bg-slate-100">
                <Image
                  src={formData.thumbnail_url}
                  alt="ì•„ì´ì½˜ ë¯¸ë¦¬ë³´ê¸°"
                  fill
                  className="object-cover"
                />
                <button
                  type="button"
                  onClick={() => setFormData({ ...formData, thumbnail_url: "" })}
                  className="absolute top-1 right-1 p-0.5 bg-black/50 hover:bg-black/70 rounded-full transition-colors"
                >
                  <X className="h-2.5 w-2.5 text-white" />
                </button>
              </div>
            )}
            {/* ê²€ìƒ‰ ì…ë ¥ */}
            <div className="relative">
              <Search className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400" />
              <Input
                value={iconSearch}
                onChange={(e) => setIconSearch(e.target.value)}
                placeholder="ì•„ì´ì½˜ ì´ë¯¸ì§€ ê²€ìƒ‰ (ì˜ˆ: tech, startup)"
                className="pl-9"
                disabled={isLoading}
              />
            </div>
            {/* ì´ë¯¸ì§€ ì„ íƒ ê·¸ë¦¬ë“œ */}
            <div className="space-y-2">
              <p className="text-xs text-slate-500 flex items-center gap-1">
                <ImageIcon className="h-3 w-3" />
                {iconSearch ? `"${iconSearch}" ê²€ìƒ‰ ê²°ê³¼` : "ì¶”ì²œ ì•„ì´ì½˜"} (í´ë¦­í•˜ì—¬ ì„ íƒ)
              </p>
              <div className="grid grid-cols-6 gap-2">
                {iconImages.map((url, idx) => (
                  <button
                    key={idx}
                    type="button"
                    onClick={() => setFormData({ ...formData, thumbnail_url: url })}
                    className={`relative aspect-square rounded-md overflow-hidden border-2 transition-all ${
                      formData.thumbnail_url === url
                        ? "border-blue-500 ring-2 ring-blue-200"
                        : "border-slate-200 hover:border-slate-300"
                    }`}
                  >
                    <Image
                      src={url}
                      alt={`ì•„ì´ì½˜ ${idx + 1}`}
                      fill
                      className="object-cover"
                    />
                  </button>
                ))}
              </div>
            </div>
          </div>

          {/* ê³µê°œ/ë¹„ê³µê°œ ì„¤ì • */}
          <div className="space-y-3">
            <Label>ê³µê°œ ì„¤ì •</Label>
            <div className="flex items-center gap-3 p-3 bg-slate-50 rounded-lg">
              <span className={`text-sm font-medium ${!formData.is_private ? "text-blue-600" : "text-slate-400"}`}>
                ê³µê°œ
              </span>
              <Switch
                id="is_private"
                checked={formData.is_private}
                onCheckedChange={(checked) => setFormData({ ...formData, is_private: checked })}
                disabled={isLoading}
                className="data-[state=checked]:bg-slate-600 data-[state=unchecked]:bg-blue-500"
              />
              <span className={`text-sm font-medium ${formData.is_private ? "text-slate-700" : "text-slate-400"}`}>
                ë¹„ê³µê°œ
              </span>
            </div>
            <p className="text-xs text-slate-500">
              {formData.is_private
                ? "ë©¤ë²„ë§Œ ê¸€ì„ ë³¼ ìˆ˜ ìˆê³ , ë©”ì¸ í”¼ë“œì— ê¸€ì´ ë…¸ì¶œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤"
                : "ëˆ„êµ¬ë‚˜ ê¸€ì„ ë³¼ ìˆ˜ ìˆê³ , ë©”ì¸ í”¼ë“œì— ê¸€ì´ ë…¸ì¶œë©ë‹ˆë‹¤"}
            </p>
          </div>

          {/* ì´ìš©ìˆ˜ì¹™ */}
          <div className="space-y-2">
            <Label htmlFor="rules">ì´ìš©ìˆ˜ì¹™</Label>
            <Textarea
              id="rules"
              value={formData.rules}
              onChange={(e) => setFormData({ ...formData, rules: e.target.value })}
              placeholder="ì»¤ë®¤ë‹ˆí‹° ì´ìš©ìˆ˜ì¹™ì„ ì…ë ¥í•˜ì„¸ìš” (ì„ íƒì‚¬í•­)"
              rows={4}
              disabled={isLoading}
            />
            <p className="text-xs text-slate-500">
              ì¤„ë°”ê¿ˆì„ ì‚¬ìš©í•˜ì—¬ ì—¬ëŸ¬ ê·œì¹™ì„ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
            </p>
          </div>

          {/* ë²„íŠ¼ */}
          <div className="flex justify-end gap-3 pt-4">
            <Button
              type="button"
              variant="outline"
              onClick={() => onOpenChange(false)}
              disabled={isLoading}
            >
              ì·¨ì†Œ
            </Button>
            <Button type="submit" disabled={isLoading}>
              {isLoading && <Loader2 className="mr-2 h-4 w-4 animate-spin" />}
              ì €ì¥
            </Button>
          </div>

          {/* ìœ„í—˜ ì˜ì—­ - ì»¤ë®¤ë‹ˆí‹° ì‚­ì œ (ë¦¬ë”ë§Œ ê°€ëŠ¥) */}
          {isOwner && (
          <div className="mt-6 pt-6 border-t border-red-100">
            <div className="flex items-start gap-3 p-4 bg-red-50 rounded-lg">
              <AlertTriangle className="h-5 w-5 text-red-500 mt-0.5 shrink-0" />
              <div className="flex-1">
                <h4 className="text-sm font-semibold text-red-700 mb-1">ìœ„í—˜ ì˜ì—­</h4>
                <p className="text-xs text-red-600 mb-3">
                  ì»¤ë®¤ë‹ˆí‹°ë¥¼ ì‚­ì œí•˜ë©´ ëª¨ë“  ê²Œì‹œê¸€, ë©¤ë²„ ì •ë³´ê°€ í•¨ê»˜ ì‚­ì œë˜ë©° ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
                </p>
                <AlertDialog>
                  <AlertDialogTrigger asChild>
                    <Button
                      type="button"
                      variant="destructive"
                      size="sm"
                      className="gap-1.5"
                      disabled={isLoading || isDeleting}
                    >
                      <Trash2 className="h-4 w-4" />
                      ì»¤ë®¤ë‹ˆí‹° ì‚­ì œ
                    </Button>
                  </AlertDialogTrigger>
                  <AlertDialogContent className="bg-white">
                    <AlertDialogHeader>
                      <AlertDialogTitle className="flex items-center gap-2 text-red-600">
                        <AlertTriangle className="h-5 w-5" />
                        ì»¤ë®¤ë‹ˆí‹° ì‚­ì œ
                      </AlertDialogTitle>
                      <AlertDialogDescription asChild>
                        <div className="text-left space-y-3">
                          <p className="text-slate-600">
                            <strong className="text-slate-900">{community.name}</strong> ì»¤ë®¤ë‹ˆí‹°ë¥¼ ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?
                          </p>
                          <p className="text-red-600 font-medium">
                            ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ëª¨ë“  ê²Œì‹œê¸€ê³¼ ë©¤ë²„ ì •ë³´ê°€ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤.
                          </p>
                          <div className="pt-2">
                            <Label htmlFor="delete-confirm" className="text-xs text-slate-500">
                              ì‚­ì œë¥¼ í™•ì¸í•˜ë ¤ë©´ ì»¤ë®¤ë‹ˆí‹° ì´ë¦„ì„ ì •í™•íˆ ì…ë ¥í•˜ì„¸ìš”
                            </Label>
                            <Input
                              id="delete-confirm"
                              value={deleteConfirmName}
                              onChange={(e) => setDeleteConfirmName(e.target.value)}
                              placeholder={community.name}
                              className="mt-1.5 bg-white"
                            />
                          </div>
                        </div>
                      </AlertDialogDescription>
                    </AlertDialogHeader>
                    <AlertDialogFooter>
                      <AlertDialogCancel onClick={() => setDeleteConfirmName("")}>
                        ì·¨ì†Œ
                      </AlertDialogCancel>
                      <AlertDialogAction
                        onClick={handleDelete}
                        disabled={isDeleting || deleteConfirmName !== community.name}
                        className="bg-red-600 hover:bg-red-700 focus:ring-red-600"
                      >
                        {isDeleting && <Loader2 className="mr-2 h-4 w-4 animate-spin" />}
                        ì‚­ì œ
                      </AlertDialogAction>
                    </AlertDialogFooter>
                  </AlertDialogContent>
                </AlertDialog>
              </div>
            </div>
          </div>
          )}
        </form>
      </DialogContent>
    </Dialog>
  )
}
</file>

<file path="components/event-detail-hero.tsx">
"use client"

import { useRef, useState, useEffect } from "react"
import { Card, CardContent } from "@/components/ui/card"
import { Calendar, MapPin, Users, Wallet, ExternalLink, Edit, AlertCircle } from 'lucide-react'
import { Badge } from "@/components/ui/badge"
import { Button } from "@/components/ui/button"
import { EventShareButton } from "@/components/event-share-button"
import { RegisterButton } from "@/components/register-button"
import { ProfilePopover } from "@/components/ui/profile-popover"
import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar"
import Link from "next/link"

type HostProfile = {
  id: string
  full_name: string | null
  avatar_url: string | null
  bio?: string | null
  company?: string | null
  position?: string | null
  tagline?: string | null
}

type Props = {
  event: any
  hostName: string
  hostAvatar?: string
  hostProfile?: HostProfile | null
  dateStr: string
  timeStr: string
  currentCount: number
  maxCount: number | null
  isFull: boolean
  isPastEvent: boolean
  isCompleted: boolean
  isCreator: boolean
  isRegistered: boolean
  userRegistration: any
  eventId: string
  basePath: string
  userId?: string
  registrationStatus?: "confirmed" | "waitlist"
  waitlistPosition?: number | null
}

function InfoRow({ icon: Icon, value, href }: { icon: any, value: string, href?: string }) {
  const content = (
    <div className={`flex items-center gap-2.5 py-2.5 px-3 rounded-lg bg-slate-50/50 ${href ? 'hover:bg-slate-100 cursor-pointer group transition-colors' : ''}`}>
      <Icon className="w-4 h-4 text-slate-400 shrink-0" />
      <span className="text-sm font-medium text-slate-700 truncate flex-1">{value}</span>
      {href && <ExternalLink className="w-3.5 h-3.5 text-slate-300 group-hover:text-slate-500 shrink-0" />}
    </div>
  )
  if (href) return <a href={href} target="_blank" rel="noopener noreferrer" className="block">{content}</a>
  return content
}

export function EventDetailHero(props: Props) {
  const {
    event, hostName, hostAvatar, hostProfile, dateStr, timeStr,
    currentCount, maxCount, isFull, isPastEvent, isCompleted,
    isCreator, isRegistered, userRegistration, eventId, basePath, userId,
    registrationStatus, waitlistPosition
  } = props

  const imageContainerRef = useRef<HTMLDivElement>(null)
  const [imageHeight, setImageHeight] = useState<number | null>(null)

  // ì´ë¯¸ì§€ ì»¨í…Œì´ë„ˆ ë†’ì´ë¥¼ ì¸¡ì •í•˜ì—¬ ì¹´ë“œì— ì ìš© (ë°ìŠ¤í¬íƒ‘ì—ì„œë§Œ)
  useEffect(() => {
    const updateHeight = () => {
      const isDesktop = window.innerWidth >= 1024
      if (imageContainerRef.current && isDesktop) {
        // ì´ë¯¸ì§€ ì»¨í…Œì´ë„ˆì˜ ì‹¤ì œ ë†’ì´ ì¸¡ì •
        setImageHeight(imageContainerRef.current.offsetHeight)
      } else {
        setImageHeight(null)
      }
    }

    // ì´ˆê¸° ì‹¤í–‰ + ì´ë¯¸ì§€ ë¡œë“œ í›„ ì‹¤í–‰
    updateHeight()

    // ResizeObserverë¡œ ë” ì •í™•í•˜ê²Œ ê°ì§€
    const resizeObserver = new ResizeObserver(updateHeight)
    if (imageContainerRef.current) {
      resizeObserver.observe(imageContainerRef.current)
    }

    window.addEventListener('resize', updateHeight)
    return () => {
      window.removeEventListener('resize', updateHeight)
      resizeObserver.disconnect()
    }
  }, [])

  const googleMapUrl = event.location
    ? `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(event.location)}`
    : undefined

  const priceStr = event.price && event.price > 0
    ? `${event.price.toLocaleString()}ì›`
    : 'ë¬´ë£Œ'

  const percent = maxCount ? Math.min(100, (currentCount / maxCount) * 100) : 100

  return (
    <div className="flex flex-col gap-6">
      {/* ìƒë‹¨: ì´ë¯¸ì§€ + ì¹´ë“œ ê·¸ë¦¬ë“œ */}
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 lg:gap-8 items-start">

        {/* ì¢Œì¸¡: ì´ë¯¸ì§€ (1:1 ë¹„ìœ¨ ê³ ì •) */}
        <div ref={imageContainerRef} className="w-full">
          <div className="aspect-square relative rounded-xl overflow-hidden bg-slate-100 border border-slate-200 shadow-sm">
          {event.thumbnail_url ? (
            <img
              src={event.thumbnail_url}
              alt={event.title}
              className="absolute inset-0 w-full h-full object-cover"
            />
          ) : (
            <div className="absolute inset-0 bg-gradient-to-br from-slate-100 via-slate-200 to-slate-300 flex items-center justify-center">
              <Calendar className="w-20 h-20 text-slate-400" />
            </div>
          )}

          {/* ìƒíƒœ ë±ƒì§€ */}
          <div className="absolute top-4 left-4 z-10 flex gap-2">
            {isCompleted ? (
              <Badge className="bg-slate-900 text-white border-none shadow-md px-2.5 py-1 text-xs">ì¢…ë£Œë¨</Badge>
            ) : isPastEvent ? (
              <Badge variant="secondary" className="bg-white/90 text-slate-700 shadow-md backdrop-blur-md px-2.5 py-1 text-xs">ì¢…ë£Œë¨</Badge>
            ) : isFull ? (
              <Badge variant="destructive" className="shadow-md px-2.5 py-1 text-xs">ë§ˆê°ì„ë°•</Badge>
            ) : (
              <Badge className="bg-green-600 hover:bg-green-700 text-white border-none shadow-md px-2.5 py-1 text-xs">ëª¨ì§‘ì¤‘</Badge>
            )}
          </div>

            {/* ì¸ì› ë±ƒì§€ */}
            <div className="absolute top-4 right-4 z-10">
              <div className="flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-bold bg-black/60 text-white backdrop-blur-md shadow-md">
                <Users className="w-3.5 h-3.5" />
                <span>{currentCount}/{maxCount || 'âˆ'}</span>
              </div>
            </div>
          </div>
        </div>

        {/* ìš°ì¸¡: ì •ë³´ ì¹´ë“œ (ì´ë¯¸ì§€ì™€ ë™ì¼í•œ ë†’ì´) */}
        <div
          id="register-card"
          className="w-full lg:aspect-square"
          style={imageHeight ? { height: `${imageHeight}px`, aspectRatio: 'unset' } : undefined}
        >
          <Card className="h-full border-slate-200 bg-white rounded-xl shadow-sm flex flex-col overflow-hidden">
            <CardContent className="p-5 lg:p-6 flex flex-col h-full justify-between">

              {/* ìƒë‹¨ ì˜ì—­ */}
              <div className="flex flex-col gap-3">

                {/* 1. ì œëª© + ê³µìœ ë²„íŠ¼ */}
                <div className="flex justify-between items-start gap-2">
                  <h1 className="text-lg lg:text-xl font-bold text-slate-900 leading-tight line-clamp-2">
                    {event.title}
                  </h1>
                  <EventShareButton
                    title={event.title}
                    description={event.description?.replace(/<[^>]*>/g, "").substring(0, 100) || event.title}
                    variant="ghost"
                    size="icon"
                    className="shrink-0 text-slate-400 hover:text-slate-900 hover:bg-slate-100 w-8 h-8 rounded-full"
                  />
                </div>

                {/* 2. ì •ë³´ ë¦¬ìŠ¤íŠ¸ */}
                <div className="flex flex-col gap-1.5">
                  <InfoRow icon={Calendar} value={`${dateStr} ${timeStr}`} />
                  <InfoRow icon={MapPin} value={event.location || "ì¥ì†Œ ë¯¸ì •"} href={googleMapUrl} />
                  <InfoRow icon={Wallet} value={priceStr} />
                </div>
              </div>

              {/* í•˜ë‹¨ ì˜ì—­ */}
              <div className="pt-3 border-t border-slate-100">
                {/* ëª¨ì§‘ í˜„í™© */}
                <div className="mb-3">
                  <div className="flex justify-between text-sm mb-1.5">
                    <span className="text-slate-500">ëª¨ì§‘ í˜„í™©</span>
                    <span className="font-semibold text-slate-900">{currentCount} / {maxCount || 'âˆ'}</span>
                  </div>
                  <div className="h-1.5 bg-slate-100 rounded-full overflow-hidden">
                    <div
                      className={`h-full rounded-full transition-all duration-500 ease-out ${isFull ? 'bg-red-500' : 'bg-slate-900'}`}
                      style={{ width: `${percent}%` }}
                    />
                  </div>
                </div>

                {/* ë²„íŠ¼ */}
                {isCreator ? (
                  <div className="flex flex-col gap-2">
                    {(isPastEvent || isCompleted) && (
                      <p className="text-xs text-amber-600 text-center py-2 bg-amber-50 rounded-lg border border-amber-100">
                        ì¢…ë£Œëœ ì´ë²¤íŠ¸ì…ë‹ˆë‹¤. ìˆ˜ì •í•˜ì—¬ ë‹¤ì‹œ í™œì„±í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                      </p>
                    )}
                    <div className="grid grid-cols-2 gap-2">
                      <Link href={`${basePath}/${eventId}/manage`} className="w-full">
                        <Button variant="outline" className="w-full h-10 text-sm font-semibold rounded-xl border-slate-200 hover:bg-slate-50 text-slate-700">
                          <Users className="mr-1.5 h-4 w-4" /> ì°¸ì„ì ê´€ë¦¬
                        </Button>
                      </Link>
                      <Link href={`${basePath}/${eventId}/edit`} className="w-full">
                        <Button className="w-full h-10 text-sm font-semibold rounded-xl bg-slate-900 hover:bg-slate-800 text-white">
                          <Edit className="mr-1.5 h-4 w-4" /> ìˆ˜ì •í•˜ê¸°
                        </Button>
                      </Link>
                    </div>
                  </div>
                ) : isPastEvent || isCompleted ? (
                  <Button className="w-full h-10 rounded-xl bg-slate-100 text-slate-400 cursor-not-allowed text-sm" disabled>
                    <AlertCircle className="mr-1.5 h-4 w-4 shrink-0" />
                    <span className="truncate">ì´ë²¤íŠ¸ê°€ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤</span>
                  </Button>
                ) : (
                  <RegisterButton
                    eventId={event.id}
                    userId={userId}
                    isRegistered={isRegistered}
                    paymentStatus={userRegistration?.payment_status}
                    isFull={isFull}
                    price={event.price || 0}
                    registrationStatus={registrationStatus}
                    waitlistPosition={waitlistPosition}
                  />
                )}
              </div>

            </CardContent>
          </Card>
        </div>
      </div>

      {/* í•˜ë‹¨: í˜¸ìŠ¤íŠ¸ ì •ë³´ */}
      <Card className="border-slate-200 shadow-sm bg-white rounded-xl">
        <CardContent className="p-4 flex items-center gap-3">
          {hostProfile?.id ? (
            <ProfilePopover profile={hostProfile}>
              <button className="flex items-center gap-3 cursor-pointer hover:opacity-80 transition-opacity" type="button">
                <Avatar className="h-12 w-12 border-2 border-white shadow-sm">
                  <AvatarImage src={hostAvatar || undefined} />
                  <AvatarFallback className="bg-slate-100 text-slate-600 font-semibold">
                    {hostName[0]}
                  </AvatarFallback>
                </Avatar>
                <div className="flex flex-col text-left">
                  <span className="text-xs font-medium text-slate-500">í˜¸ìŠ¤íŠ¸</span>
                  <span className="text-base font-bold text-slate-900 hover:underline">{hostName}</span>
                </div>
              </button>
            </ProfilePopover>
          ) : (
            <>
              <Avatar className="h-12 w-12 border-2 border-white shadow-sm">
                <AvatarImage src={hostAvatar || undefined} />
                <AvatarFallback className="bg-slate-100 text-slate-600 font-semibold">
                  {hostName[0]}
                </AvatarFallback>
              </Avatar>
              <div className="flex flex-col">
                <span className="text-xs font-medium text-slate-500">í˜¸ìŠ¤íŠ¸</span>
                <span className="text-base font-bold text-slate-900">{hostName}</span>
              </div>
            </>
          )}
        </CardContent>
      </Card>
    </div>
  )
}
</file>

<file path="components/event-detail-content.tsx">
import { createClient } from "@/lib/supabase/server";
import { notFound } from 'next/navigation';
import { Card, CardContent } from "@/components/ui/card";
import { MapPin, ChevronLeft, ExternalLink, FileText, Users } from 'lucide-react';
import Link from "next/link";
import { FloatingActionBar } from "@/components/floating-action-bar";
import { getReviewsByEvent } from "@/lib/queries/posts";
import { ReviewModal } from "@/components/reviews/review-modal";
import { ReviewCard } from "@/components/reviews/review-card";
import { GoogleMapEmbed } from "@/components/google-map-embed";
import { EventDetailHero } from "@/components/event-detail-hero";
import { ClickableAvatar } from "@/components/ui/clickable-avatar";

export default async function EventDetailContent({
  eventId,
  basePath = '/events'
}: {
  eventId: string;
  basePath?: string;
}) {
  const supabase = await createClient();
  const { data: { user } } = await supabase.auth.getUser();

  // 1. ì´ë²¤íŠ¸ ì •ë³´ ì¡°íšŒ
  let event;
  try {
    const { data, error } = await supabase
      .from("events")
      .select(`
        *,
        profiles:created_by (
          id,
          full_name,
          avatar_url,
          email,
          bio,
          tagline
        )
      `)
      .eq("id", eventId)
      .single();

    if (error || !data) notFound();
    event = data;
  } catch (error) { notFound(); }

  // 2. ê´€ë ¨ ì •ë³´ ë³‘ë ¬ ì¡°íšŒ (ë“±ë¡ ì—¬ë¶€, ì°¸ì„ì, í›„ê¸°)
  const [userRegResult, attendeesResult, reviewsResult] = await Promise.all([
    // ì‚¬ìš©ì ë“±ë¡ ì—¬ë¶€ (ë¡œê·¸ì¸í•œ ê²½ìš°ì—ë§Œ)
    user
      ? supabase
        .from("event_registrations")
        .select("id, payment_status, status, waitlist_position")
        .eq("event_id", eventId)
        .eq("user_id", user.id)
        .maybeSingle()
      : Promise.resolve({ data: null }),
    // ì°¸ì„ì ëª©ë¡ (confirmed ìƒíƒœë§Œ)
    supabase
      .from("event_registrations")
      .select(`id, user_id, guest_name, status, profiles:user_id (id, full_name, avatar_url)`)
      .eq("event_id", eventId)
      .eq("status", "confirmed"),
    // í›„ê¸° ëª©ë¡
    getReviewsByEvent(supabase, eventId),
  ]);

  const userRegistration = userRegResult.data;
  const attendeesData = attendeesResult.data;
  const reviews = reviewsResult;

  // 3. ìƒíƒœ ê³„ì‚°
  const attendees = attendeesData || [];
  const isRegistered = !!userRegistration;
  const registrationStatus = userRegistration?.status as "confirmed" | "waitlist" | undefined;
  const waitlistPosition = userRegistration?.waitlist_position as number | null | undefined;
  const currentCount = attendees.length; // ë°°ì—´ ê¸¸ì´ë¡œ ì°¸ì„ì ìˆ˜ ê³„ì‚° (confirmedë§Œ)

  const maxCount = event.max_participants;
  const isFull = maxCount && currentCount >= maxCount;
  const isCreator = user && event.created_by === user.id;

  // ì¢…ë£Œ ì—¬ë¶€ íŒë‹¨: end_dateê°€ ìˆìœ¼ë©´ ê·¸ê²ƒì„ ê¸°ì¤€, ì—†ìœ¼ë©´ start_date + 3ì‹œê°„ì„ ì¢…ë£Œ ì‹œì ìœ¼ë¡œ ê°„ì£¼
  const now = new Date();
  const eventStartDate = new Date(event.event_date);
  const eventEndDate = event.end_date
    ? new Date(event.end_date)
    : new Date(eventStartDate.getTime() + 3 * 60 * 60 * 1000); // ê¸°ë³¸ 3ì‹œê°„

  const isPastEvent = eventEndDate < now;
  const isCompleted = event.status === 'completed'; // ìˆ˜ë™ ì¢…ë£Œ ìƒíƒœ

  // ë‚ ì§œ í¬ë§·íŒ…
  const dateStr = eventStartDate.toLocaleDateString("ko-KR", { year: 'numeric', month: 'long', day: 'numeric', weekday: 'short', timeZone: 'Asia/Seoul' });
  const timeStr = eventStartDate.toLocaleTimeString("ko-KR", { hour: "numeric", minute: "2-digit", hour12: true, timeZone: 'Asia/Seoul' });

  // í”„ë¡œí•„ ì²˜ë¦¬ (ë°°ì—´/ê°ì²´ í˜¸í™˜)
  const hostProfile = Array.isArray(event.profiles) ? event.profiles[0] : event.profiles;
  const hostName = hostProfile?.full_name || "ì•Œ ìˆ˜ ì—†ìŒ";
  const hostAvatar = hostProfile?.avatar_url;

  // êµ¬ê¸€ ë§µ URL ë° í‚¤
  const googleMapUrl = event.location
    ? `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(event.location)}`
    : undefined;
  const googleMapsApiKey = process.env.NEXT_PUBLIC_GOOGLE_MAPS_API_KEY || "";

  return (
    <div className="w-full">
      {/* ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ */}
      <div className="mb-6 flex items-center justify-between">
        <Link href="/e" className="group flex items-center text-sm font-medium text-slate-500 hover:text-slate-900 transition-colors">
          <div className="mr-2 flex h-8 w-8 items-center justify-center rounded-full bg-white border border-slate-200 group-hover:border-slate-300 shadow-sm transition-all">
            <ChevronLeft className="h-4 w-4" />
          </div>
          ì´ë²¤íŠ¸ ëª©ë¡
        </Link>
      </div>

      <div className="flex flex-col gap-10">
        {/* Hero ì„¹ì…˜ - í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ë¡œ ë†’ì´ ë™ê¸°í™” */}
        <EventDetailHero
          event={event}
          hostName={hostName}
          hostAvatar={hostAvatar}
          hostProfile={hostProfile}
          dateStr={dateStr}
          timeStr={timeStr}
          currentCount={currentCount}
          maxCount={maxCount}
          isFull={!!isFull}
          isPastEvent={isPastEvent}
          isCompleted={isCompleted}
          isCreator={!!isCreator}
          isRegistered={isRegistered}
          userRegistration={userRegistration}
          eventId={eventId}
          basePath={basePath}
          userId={user?.id}
          registrationStatus={registrationStatus}
          waitlistPosition={waitlistPosition}
        />

        {/* ìƒì„¸ ë‚´ìš© & ì°¸ì„ì */}
        <div className="grid grid-cols-1 lg:grid-cols-12 gap-8 items-start">
          <div className="lg:col-span-8">

            {/* ìƒì„¸ ë‚´ìš© (í—¤ë” ë¶„ë¦¬) */}
            <div className="mb-8">
              <h3 className="text-xl font-bold text-slate-900 mb-4 flex items-center gap-2">
                <FileText className="w-5 h-5 text-slate-500" />
                ìƒì„¸ ë‚´ìš©
              </h3>
              <Card className="border-slate-200 shadow-sm bg-white overflow-hidden rounded-xl">
                <CardContent className="p-8">
                  <div
                    className="prose max-w-none"
                    dangerouslySetInnerHTML={{ __html: event.description || "" }}
                  />
                </CardContent>
              </Card>
            </div>

            {/* ìœ„ì¹˜ ì•ˆë‚´ */}
            {event.location && googleMapsApiKey && (
              <div className="mb-8">
                <h3 className="text-xl font-bold text-slate-900 mb-4 flex items-center gap-2">
                  <MapPin className="w-5 h-5 text-slate-500" />
                  ìœ„ì¹˜ ì•ˆë‚´
                </h3>
                <GoogleMapEmbed location={event.location} apiKey={googleMapsApiKey} />
                <div className="mt-2 text-right">
                  <a
                    href={googleMapUrl}
                    target="_blank"
                    rel="noopener noreferrer"
                    className="text-sm font-medium text-blue-600 hover:underline inline-flex items-center gap-1"
                  >
                    Google ì§€ë„ì—ì„œ ë³´ê¸° <ExternalLink className="w-3 h-3" />
                  </a>
                </div>
              </div>
            )}
          </div>

          {/* ì°¸ì„ì (í—¤ë” ë¶„ë¦¬) */}
          <div className="lg:col-span-4 space-y-6">
            <div>
              <div className="flex items-center justify-between mb-4">
                <h2 className="text-xl font-bold text-slate-900 flex items-center gap-2">
                  <Users className="w-5 h-5 text-slate-500" />
                  ì°¸ì„ì
                </h2>
                <span className="text-xs font-bold text-slate-500 bg-slate-100 px-2.5 py-1 rounded-full border border-slate-200">
                  {currentCount}ëª…
                </span>
              </div>
              <Card className="border-slate-200 shadow-sm bg-white overflow-hidden rounded-xl">
                <CardContent className="p-6">
                  {attendees.length > 0 ? (
                    <div className="flex flex-wrap gap-3">
                      {attendees.map((attendee: any, index: number) => {
                        const profile = Array.isArray(attendee.profiles) ? attendee.profiles[0] : attendee.profiles;
                        const name = profile?.full_name || attendee.guest_name || "ìµëª…";
                        return (
                          <div key={attendee.id || index} className="flex flex-col items-center gap-1.5 w-14">
                            <ClickableAvatar
                              profile={profile ? { ...profile, full_name: name } : null}
                              size="xl"
                              showName
                              className="flex-col"
                              nameClassName="text-xs text-slate-600 truncate w-full text-center font-medium"
                            />
                          </div>
                        );
                      })}
                    </div>
                  ) : (
                    <div className="py-10 text-center text-slate-400 text-sm bg-slate-50 rounded-xl border border-dashed border-slate-200">
                      ì•„ì§ ì°¸ì„ìê°€ ì—†ìŠµë‹ˆë‹¤.
                      <br />ì²« ë²ˆì§¸ ë©¤ë²„ê°€ ë˜ì–´ë³´ì„¸ìš”!
                    </div>
                  )}
                </CardContent>
              </Card>
            </div>
          </div>
        </div>

        {/* í›„ê¸° ì„¹ì…˜ */}
        <Card className="border-slate-200 shadow-sm bg-white overflow-hidden rounded-xl">
          <div className="px-8 py-6 border-b border-slate-100 bg-slate-50/50 flex flex-col sm:flex-row sm:items-center justify-between gap-4">
            <div>
              <h2 className="text-xl font-bold text-slate-900 flex items-center gap-2">
                ì°¸ê°€ì í›„ê¸°
                <span className="text-sm text-slate-500 font-medium bg-white border border-slate-200 px-2 py-0.5 rounded-full">
                  {reviews ? reviews.length : 0}
                </span>
              </h2>
            </div>
            {user && <ReviewModal userId={user.id} eventId={eventId} />}
          </div>
          <CardContent className="p-8">
            {reviews && reviews.length > 0 ? (
              <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                {reviews.map((review: any) => (
                  <ReviewCard key={review.id} review={review} className="h-full border border-slate-100 shadow-sm hover:shadow-md transition-all" />
                ))}
              </div>
            ) : (
              <div className="flex flex-col items-center justify-center py-16 text-center bg-slate-50 rounded-xl border border-dashed border-slate-200">
                <div className="w-16 h-16 bg-white rounded-full flex items-center justify-center shadow-sm mb-4 text-3xl">ğŸ’¬</div>
                <h3 className="text-lg font-bold text-slate-900 mb-1">ì•„ì§ ì‘ì„±ëœ í›„ê¸°ê°€ ì—†ì–´ìš”</h3>
                <p className="text-slate-500 max-w-sm mx-auto">ëª¨ì„ì´ ëë‚œ í›„ ì²« ë²ˆì§¸ í›„ê¸°ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš”!<br />ì—¬ëŸ¬ë¶„ì˜ ê²½í—˜ ê³µìœ ê°€ í° í˜ì´ ë©ë‹ˆë‹¤.</p>
              </div>
            )}
          </CardContent>
        </Card>
      </div>

      <FloatingActionBar
        eventId={eventId}
        userId={user?.id}
        isRegistered={isRegistered}
        paymentStatus={userRegistration?.payment_status}
        isFull={!!isFull}
        price={event.price || 0}
        isPastEvent={isPastEvent}
        isCreator={!!isCreator}
        eventTitle={event.title}
        dateStr={dateStr}
        timeStr={timeStr}
        location={event.location || ""}
        registrationStatus={registrationStatus}
        waitlistPosition={waitlistPosition}
      />
    </div>
  );
}
</file>

<file path="app/community/board/[slug]/layout.tsx">
import type { ReactNode } from "react"
import { ThreeColumnLayout } from "@/components/layout/three-column-layout"
import { StandardRightSidebar } from "@/components/standard-right-sidebar"
import { CommunityInfoSidebar } from "@/components/community/community-info-sidebar"
import { createClient } from "@/lib/supabase/server"

interface CommunityBoardLayoutProps {
  children: ReactNode
  params: Promise<{ slug: string }>
}

// ì‹œìŠ¤í…œ ê²Œì‹œíŒ ëª©ë¡ (ê¸°ì¡´ ì‚¬ì´ë“œë°” ì‚¬ìš©)
const SYSTEM_BOARDS = [
  "announcement",
  "announcements",
  "free",
  "free-board",
  "insights",
  "reviews",
]

/**
 * ì»¤ë®¤ë‹ˆí‹° ë³´ë“œ ë ˆì´ì•„ì›ƒ
 * - ì‹œìŠ¤í…œ ê²Œì‹œíŒ: StandardRightSidebar (ê³µì§€ì‚¬í•­ ìœ„ì ¯)
 * - ì»¤ë®¤ë‹ˆí‹° ê²Œì‹œíŒ: CommunityInfoSidebar (ì»¤ë®¤ë‹ˆí‹° ì •ë³´)
 *
 * ì°¸ê³ : DashboardLayoutì€ ìƒìœ„ /community/layout.tsxì—ì„œ ì œê³µ
 */
export default async function CommunityBoardLayout({
  children,
  params,
}: CommunityBoardLayoutProps) {
  const { slug } = await params

  // URL ìŠ¬ëŸ¬ê·¸ -> DB ìŠ¬ëŸ¬ê·¸ ë³€í™˜
  let dbSlug = slug
  if (slug === "free") dbSlug = "free-board"
  if (slug === "announcements") dbSlug = "announcement"

  // ì‹œìŠ¤í…œ ê²Œì‹œíŒ ì—¬ë¶€ í™•ì¸
  const isSystemBoard = SYSTEM_BOARDS.includes(dbSlug) || SYSTEM_BOARDS.includes(slug)

  // ì»¤ë®¤ë‹ˆí‹° ê²Œì‹œíŒì¸ ê²½ìš° ë°ì´í„° ì¡°íšŒ
  let communityName: string | null = null
  let userId: string | null = null

  if (!isSystemBoard) {
    const supabase = await createClient()

    // ë³‘ë ¬ë¡œ ì¹´í…Œê³ ë¦¬ì™€ ì„¸ì…˜ ì¡°íšŒ
    const [categoryResult, sessionResult] = await Promise.all([
      supabase.from("board_categories").select("name").eq("slug", dbSlug).single(),
      supabase.auth.getSession(),
    ])

    communityName = categoryResult.data?.name || null
    userId = sessionResult.data.session?.user?.id || null

    // board_categoriesì— ì—†ìœ¼ë©´ communities í…Œì´ë¸”ì—ì„œ slugë¡œ ì§ì ‘ ì°¾ê¸°
    if (!communityName) {
      // slug ì»¬ëŸ¼ì´ ìˆìœ¼ë©´ ì§ì ‘ ì¡°íšŒ, ì—†ìœ¼ë©´ nameìœ¼ë¡œ ì¡°íšŒ
      const { data: communityBySlug } = await supabase
        .from("communities")
        .select("name")
        .or(`slug.eq.${dbSlug},slug.eq.${slug}`)
        .limit(1)
        .maybeSingle()

      if (communityBySlug) {
        communityName = communityBySlug.name
      } else {
        // slug ì»¬ëŸ¼ì´ ì—†ëŠ” ê²½ìš°: nameì„ slugí™”í•´ì„œ ë¹„êµ (ilike ì‚¬ìš©)
        // ì˜ˆ: "ë°˜ê³¨" -> slug "ë°˜ê³¨", "Weekly Vibe" -> slug "weekly-vibe"
        const { data: communityByName } = await supabase
          .from("communities")
          .select("name")
          .ilike("name", dbSlug.replace(/-/g, ' '))
          .limit(1)
          .maybeSingle()

        if (communityByName) {
          communityName = communityByName.name
        }
      }
    }

    console.log("[CommunityBoardLayout] slug:", dbSlug, "communityName:", communityName, "userId:", userId)
  }

  // ì‚¬ì´ë“œë°” ê²°ì •
  // ì»¤ë®¤ë‹ˆí‹° í˜ì´ì§€: ì‚¬ì´ë“œë°”ë¥¼ ë°°ë„ˆ ìƒë‹¨ê³¼ ì •ë ¬ (pt ì œê±°)
  const rightSidebar = isSystemBoard ? (
    <StandardRightSidebar />
  ) : (
    <CommunityInfoSidebar communityName={communityName} userId={userId} />
  )

  return (
    <ThreeColumnLayout rightSidebar={rightSidebar}>
      {children}
    </ThreeColumnLayout>
  )
}
</file>

<file path="next-env.d.ts">
/// <reference types="next" />
/// <reference types="next/image-types/global" />
import "./.next/types/routes.d.ts";

// NOTE: This file should not be edited
// see https://nextjs.org/docs/app/api-reference/config/typescript for more information.
</file>

<file path="lib/actions/community.ts">
"use server"

import { createClient } from "@/lib/supabase/server"
import { revalidatePath } from "next/cache"

/**
 * ì»¤ë®¤ë‹ˆí‹° ìƒì„±
 */
export async function createCommunity(data: {
  name: string
  description?: string
  thumbnail_url?: string
  is_private?: boolean
}) {
  const supabase = await createClient()

  const {
    data: { user },
  } = await supabase.auth.getUser()

  if (!user) {
    return { error: "ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.", data: null }
  }

  // slug ìƒì„± (ì´ë¦„ ê¸°ë°˜)
  const slug = data.name.trim().toLowerCase().replace(/\s+/g, '-')

  // 1. ì»¤ë®¤ë‹ˆí‹° ìƒì„±
  const { data: community, error: communityError } = await supabase
    .from("communities")
    .insert({
      name: data.name.trim(),
      description: data.description?.trim() || null,
      thumbnail_url: data.thumbnail_url || null,
      created_by: user.id,
      is_private: data.is_private || false,
    })
    .select()
    .single()

  if (communityError) {
    return { error: communityError.message, data: null }
  }

  // 2. ìƒì„±ìë¥¼ ownerë¡œ ìë™ ë“±ë¡
  const { error: memberError } = await supabase
    .from("community_members")
    .insert({
      community_id: community.id,
      user_id: user.id,
      role: "owner",
    })

  if (memberError) {
    // ì»¤ë®¤ë‹ˆí‹°ëŠ” ìƒì„±ëì§€ë§Œ ë©¤ë²„ ë“±ë¡ ì‹¤íŒ¨ - ë¡¤ë°±ì€ ì–´ë µì§€ë§Œ ì—ëŸ¬ ë°˜í™˜
    return { error: memberError.message, data: null }
  }

  // 3. board_categoriesì— ê²Œì‹œíŒ ë“±ë¡
  const { error: boardError } = await supabase
    .from("board_categories")
    .insert({
      name: data.name.trim(),
      slug: slug,
      description: data.description?.trim() || null,
      is_active: true,
    })

  if (boardError) {
    console.error("[createCommunity] board_categories ìƒì„± ì‹¤íŒ¨:", boardError)
    // ê²Œì‹œíŒ ìƒì„± ì‹¤íŒ¨í•´ë„ ì»¤ë®¤ë‹ˆí‹°ëŠ” ì´ë¯¸ ìƒì„±ë¨ - ë¡œê·¸ë§Œ ë‚¨ê¹€
  }

  revalidatePath("/community")
  revalidatePath("/communities")
  return { data: { ...community, slug }, error: null }
}

export async function updateCommunityIntro(intro: string) {
  const supabase = await createClient()
  
  const {
    data: { user },
  } = await supabase.auth.getUser()

  if (!user) {
    throw new Error("Unauthorized")
  }

  // ê¶Œí•œ ì²´í¬: master ë˜ëŠ” community_leader
  const { data: profile } = await supabase
    .from("profiles")
    .select("role, roles")
    .eq("id", user.id)
    .single()

  const isMaster = profile?.role === 'master'
  const isLeader = profile?.roles?.includes('community_leader')

  if (!isMaster && !isLeader) {
    throw new Error("Forbidden")
  }

  // community_settings í…Œì´ë¸”ì— ì €ì¥ (upsert)
  const { error } = await supabase
    .from("community_settings")
    .upsert({ 
      key: 'community_intro', 
      value: intro,
      updated_by: user.id,
      updated_at: new Date().toISOString()
    }, { onConflict: 'key' })

  if (error) {
    throw new Error(error.message)
  }

  revalidatePath("/community")
  return { success: true }
}

export async function setCommunityLeader(communityId: string, targetUserId: string) {
  const supabase = await createClient()
  
  const {
    data: { user },
  } = await supabase.auth.getUser()

  if (!user) {
    throw new Error("Unauthorized")
  }

  // ê¶Œí•œ ì²´í¬: masterë§Œ ë¦¬ë” ì§€ì • ê°€ëŠ¥
  const { data: requesterProfile } = await supabase
    .from("profiles")
    .select("role")
    .eq("id", user.id)
    .single()

  if (requesterProfile?.role !== 'master') {
    throw new Error("Forbidden: Only masters can designate community leaders")
  }

  // ëŒ€ìƒ ìœ ì €ê°€ í•´ë‹¹ ì»¤ë®¤ë‹ˆí‹°ì˜ ë©¤ë²„ì¸ì§€ í™•ì¸
  const { data: membership } = await supabase
    .from("community_members")
    .select("id, role")
    .eq("community_id", communityId)
    .eq("user_id", targetUserId)
    .single()

  if (!membership) {
    throw new Error("User is not a member of this community")
  }

  // 1) communities í…Œì´ë¸”ì˜ created_byë¥¼ ì—…ë°ì´íŠ¸ (ë¦¬ë” ë³€ê²½)
  const { error: updateCommunityError } = await supabase
    .from("communities")
    .update({ created_by: targetUserId })
    .eq("id", communityId)

  if (updateCommunityError) {
    throw new Error(updateCommunityError.message)
  }

  // 2) community_members.roleì„ ë¦¬ë” ê¶Œí•œìœ¼ë¡œ ìŠ¹ê²©
  //    - ê¸°ì¡´ì—ëŠ” roleì´ í•­ìƒ 'member'ë¡œ ë‚¨ì•„ ìˆì–´ì„œ
  //      ë¦¬ë” ë±ƒì§€ ìë™ ë°œê¸‰ íŠ¸ë¦¬ê±°ê°€ ë™ì‘í•˜ì§€ ì•Šì•˜ìŒ
  const { error: updateRoleError } = await supabase
    .from("community_members")
    .update({ role: "admin" })
    .eq("id", membership.id)

  if (updateRoleError) {
    throw new Error(updateRoleError.message)
  }

  revalidatePath("/community")
  revalidatePath(`/community/board/*`)
  return { success: true }
}

/**
 * ìš´ì˜ì§„ ì„ëª… (ë¦¬ë”ë§Œ ê°€ëŠ¥)
 */
export async function promoteMemberToAdmin(communityId: string, targetUserId: string) {
  const supabase = await createClient()

  const {
    data: { user },
  } = await supabase.auth.getUser()

  if (!user) {
    return { error: "ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤." }
  }

  // ì»¤ë®¤ë‹ˆí‹° ì •ë³´ ì¡°íšŒ
  const { data: community } = await supabase
    .from("communities")
    .select("created_by")
    .eq("id", communityId)
    .single()

  if (!community) {
    return { error: "ì»¤ë®¤ë‹ˆí‹°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤." }
  }

  // ê¶Œí•œ ì²´í¬: owner(ë¦¬ë”) ë˜ëŠ” masterë§Œ ìš´ì˜ì§„ ì„ëª… ê°€ëŠ¥
  const { data: profile } = await supabase
    .from("profiles")
    .select("role")
    .eq("id", user.id)
    .single()

  const { data: requesterMembership } = await supabase
    .from("community_members")
    .select("role")
    .eq("community_id", communityId)
    .eq("user_id", user.id)
    .single()

  const isOwner = community.created_by === user.id || requesterMembership?.role === "owner"
  const isMaster = profile?.role === "master"

  if (!isOwner && !isMaster) {
    return { error: "ìš´ì˜ì§„ ì„ëª…ì€ ë¦¬ë”ë§Œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤." }
  }

  // ëŒ€ìƒ ìœ ì €ê°€ í•´ë‹¹ ì»¤ë®¤ë‹ˆí‹°ì˜ ë©¤ë²„ì¸ì§€ í™•ì¸
  const { data: targetMembership } = await supabase
    .from("community_members")
    .select("id, role")
    .eq("community_id", communityId)
    .eq("user_id", targetUserId)
    .single()

  if (!targetMembership) {
    return { error: "í•´ë‹¹ ìœ ì €ëŠ” ì»¤ë®¤ë‹ˆí‹° ë©¤ë²„ê°€ ì•„ë‹™ë‹ˆë‹¤." }
  }

  if (targetMembership.role === "owner") {
    return { error: "ë¦¬ë”ëŠ” ìš´ì˜ì§„ìœ¼ë¡œ ë³€ê²½í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤." }
  }

  if (targetMembership.role === "admin") {
    return { error: "ì´ë¯¸ ìš´ì˜ì§„ì…ë‹ˆë‹¤." }
  }

  // ìš´ì˜ì§„ìœ¼ë¡œ ìŠ¹ê²©
  const { error } = await supabase
    .from("community_members")
    .update({ role: "admin" })
    .eq("id", targetMembership.id)

  if (error) {
    return { error: error.message }
  }

  revalidatePath("/community")
  revalidatePath(`/community/board/*`)
  return { success: true }
}

/**
 * ìš´ì˜ì§„ í•´ì œ (ë¦¬ë”ë§Œ ê°€ëŠ¥)
 */
export async function demoteAdminToMember(communityId: string, targetUserId: string) {
  const supabase = await createClient()

  const {
    data: { user },
  } = await supabase.auth.getUser()

  if (!user) {
    return { error: "ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤." }
  }

  // ì»¤ë®¤ë‹ˆí‹° ì •ë³´ ì¡°íšŒ
  const { data: community } = await supabase
    .from("communities")
    .select("created_by")
    .eq("id", communityId)
    .single()

  if (!community) {
    return { error: "ì»¤ë®¤ë‹ˆí‹°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤." }
  }

  // ê¶Œí•œ ì²´í¬: owner(ë¦¬ë”) ë˜ëŠ” masterë§Œ ìš´ì˜ì§„ í•´ì œ ê°€ëŠ¥
  const { data: profile } = await supabase
    .from("profiles")
    .select("role")
    .eq("id", user.id)
    .single()

  const { data: requesterMembership } = await supabase
    .from("community_members")
    .select("role")
    .eq("community_id", communityId)
    .eq("user_id", user.id)
    .single()

  const isOwner = community.created_by === user.id || requesterMembership?.role === "owner"
  const isMaster = profile?.role === "master"

  if (!isOwner && !isMaster) {
    return { error: "ìš´ì˜ì§„ í•´ì œëŠ” ë¦¬ë”ë§Œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤." }
  }

  // ëŒ€ìƒ ìœ ì € ë©¤ë²„ì‹­ í™•ì¸
  const { data: targetMembership } = await supabase
    .from("community_members")
    .select("id, role")
    .eq("community_id", communityId)
    .eq("user_id", targetUserId)
    .single()

  if (!targetMembership) {
    return { error: "í•´ë‹¹ ìœ ì €ëŠ” ì»¤ë®¤ë‹ˆí‹° ë©¤ë²„ê°€ ì•„ë‹™ë‹ˆë‹¤." }
  }

  if (targetMembership.role !== "admin") {
    return { error: "í•´ë‹¹ ìœ ì €ëŠ” ìš´ì˜ì§„ì´ ì•„ë‹™ë‹ˆë‹¤." }
  }

  // ì¼ë°˜ ë©¤ë²„ë¡œ ë³€ê²½
  const { error } = await supabase
    .from("community_members")
    .update({ role: "member" })
    .eq("id", targetMembership.id)

  if (error) {
    return { error: error.message }
  }

  revalidatePath("/community")
  revalidatePath(`/community/board/*`)
  return { success: true }
}

export async function joinCommunity(communityId: string) {
  const supabase = await createClient()

  const {
    data: { user },
  } = await supabase.auth.getUser()

  if (!user) {
    return { error: "ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.", success: false }
  }

  // communities í…Œì´ë¸”ì— ë©¤ë²„ì‹­ ì¶”ê°€
  const { error } = await supabase
    .from("community_members")
    .insert({
      community_id: communityId,
      user_id: user.id,
      joined_at: new Date().toISOString()
    })

  if (error) {
    if (error.code === '23505') { // unique constraint violation
      return { error: "ì´ë¯¸ ì°¸ì—¬í•œ ì»¤ë®¤ë‹ˆí‹°ì…ë‹ˆë‹¤.", success: false }
    }
    return { error: error.message, success: false }
  }

  revalidatePath("/community")
  return { success: true, error: null }
}

export async function leaveCommunity(communityId: string) {
  const supabase = await createClient()

  const {
    data: { user },
  } = await supabase.auth.getUser()

  if (!user) {
    return { error: "ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.", success: false }
  }

  // communities í…Œì´ë¸”ì—ì„œ ë©¤ë²„ì‹­ ì œê±°
  const { error } = await supabase
    .from("community_members")
    .delete()
    .eq("community_id", communityId)
    .eq("user_id", user.id)

  if (error) {
    return { error: error.message, success: false }
  }

  revalidatePath("/community")
  return { success: true, error: null }
}

// ============================================
// ê°€ì… ì‹ ì²­ ê´€ë ¨ í•¨ìˆ˜ (ìŠ¹ì¸ì œ ì»¤ë®¤ë‹ˆí‹°)
// ============================================

/**
 * ì»¤ë®¤ë‹ˆí‹° ê°€ì… ì‹ ì²­ (ìŠ¹ì¸ì œ)
 */
export async function requestJoinCommunity(communityId: string, message?: string) {
  const supabase = await createClient()

  const {
    data: { user },
  } = await supabase.auth.getUser()

  if (!user) {
    return { error: "ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤." }
  }

  // ì´ë¯¸ ë©¤ë²„ì¸ì§€ í™•ì¸
  const { data: existingMember } = await supabase
    .from("community_members")
    .select("id")
    .eq("community_id", communityId)
    .eq("user_id", user.id)
    .single()

  if (existingMember) {
    return { error: "ì´ë¯¸ ê°€ì…ëœ ì»¤ë®¤ë‹ˆí‹°ì…ë‹ˆë‹¤." }
  }

  // ê°€ì… ì‹ ì²­
  const { error } = await supabase
    .from("community_join_requests")
    .insert({
      community_id: communityId,
      user_id: user.id,
      message: message || null,
    })

  if (error) {
    if (error.code === "23505") {
      return { error: "ì´ë¯¸ ê°€ì… ì‹ ì²­ ì¤‘ì…ë‹ˆë‹¤." }
    }
    return { error: error.message }
  }

  revalidatePath("/community")
  return { success: true }
}

/**
 * ê°€ì… ì‹ ì²­ ìŠ¹ì¸ (ìš´ì˜ììš©)
 */
export async function approveJoinRequest(requestId: string) {
  const supabase = await createClient()

  const {
    data: { user },
  } = await supabase.auth.getUser()

  if (!user) {
    return { error: "ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤." }
  }

  // ê°€ì… ì‹ ì²­ ì •ë³´ ì¡°íšŒ
  const { data: request, error: requestError } = await supabase
    .from("community_join_requests")
    .select("community_id, user_id, status")
    .eq("id", requestId)
    .single()

  if (requestError || !request) {
    return { error: "ê°€ì… ì‹ ì²­ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤." }
  }

  if (request.status !== "pending") {
    return { error: "ì´ë¯¸ ì²˜ë¦¬ëœ ì‹ ì²­ì…ë‹ˆë‹¤." }
  }

  // ê¶Œí•œ í™•ì¸ (ì»¤ë®¤ë‹ˆí‹° ìš´ì˜ì ë˜ëŠ” master)
  const { data: community } = await supabase
    .from("communities")
    .select("created_by")
    .eq("id", request.community_id)
    .single()

  const { data: profile } = await supabase
    .from("profiles")
    .select("role")
    .eq("id", user.id)
    .single()

  const { data: adminMember } = await supabase
    .from("community_members")
    .select("role")
    .eq("community_id", request.community_id)
    .eq("user_id", user.id)
    .in("role", ["owner", "admin"])
    .single()

  const isOwner = community?.created_by === user.id
  const isMaster = profile?.role === "master"
  const isAdmin = !!adminMember

  if (!isOwner && !isMaster && !isAdmin) {
    return { error: "ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤." }
  }

  // íŠ¸ëœì­ì…˜: ì‹ ì²­ ìŠ¹ì¸ + ë©¤ë²„ ì¶”ê°€
  const { error: updateError } = await supabase
    .from("community_join_requests")
    .update({
      status: "approved",
      reviewed_at: new Date().toISOString(),
      reviewed_by: user.id,
    })
    .eq("id", requestId)

  if (updateError) {
    return { error: updateError.message }
  }

  // ë©¤ë²„ ì¶”ê°€
  const { error: memberError } = await supabase
    .from("community_members")
    .insert({
      community_id: request.community_id,
      user_id: request.user_id,
      role: "member",
    })

  if (memberError) {
    // ì´ë¯¸ ë©¤ë²„ì¸ ê²½ìš° ë¬´ì‹œ
    if (memberError.code !== "23505") {
      return { error: memberError.message }
    }
  }

  revalidatePath("/community")
  return { success: true }
}

/**
 * ê°€ì… ì‹ ì²­ ê±°ì ˆ (ìš´ì˜ììš©)
 */
export async function rejectJoinRequest(requestId: string, reason?: string) {
  const supabase = await createClient()

  const {
    data: { user },
  } = await supabase.auth.getUser()

  if (!user) {
    return { error: "ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤." }
  }

  // ê°€ì… ì‹ ì²­ ì •ë³´ ì¡°íšŒ
  const { data: request, error: requestError } = await supabase
    .from("community_join_requests")
    .select("community_id, status")
    .eq("id", requestId)
    .single()

  if (requestError || !request) {
    return { error: "ê°€ì… ì‹ ì²­ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤." }
  }

  if (request.status !== "pending") {
    return { error: "ì´ë¯¸ ì²˜ë¦¬ëœ ì‹ ì²­ì…ë‹ˆë‹¤." }
  }

  // ê¶Œí•œ í™•ì¸
  const { data: community } = await supabase
    .from("communities")
    .select("created_by")
    .eq("id", request.community_id)
    .single()

  const { data: profile } = await supabase
    .from("profiles")
    .select("role")
    .eq("id", user.id)
    .single()

  const { data: adminMember } = await supabase
    .from("community_members")
    .select("role")
    .eq("community_id", request.community_id)
    .eq("user_id", user.id)
    .in("role", ["owner", "admin"])
    .single()

  const isOwner = community?.created_by === user.id
  const isMaster = profile?.role === "master"
  const isAdmin = !!adminMember

  if (!isOwner && !isMaster && !isAdmin) {
    return { error: "ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤." }
  }

  // ì‹ ì²­ ê±°ì ˆ
  const { error: updateError } = await supabase
    .from("community_join_requests")
    .update({
      status: "rejected",
      reviewed_at: new Date().toISOString(),
      reviewed_by: user.id,
      rejection_reason: reason || null,
    })
    .eq("id", requestId)

  if (updateError) {
    return { error: updateError.message }
  }

  revalidatePath("/community")
  return { success: true }
}

/**
 * ê°€ì… ì‹ ì²­ ì·¨ì†Œ (ì‹ ì²­ììš©)
 */
export async function cancelJoinRequest(communityId: string) {
  const supabase = await createClient()

  const {
    data: { user },
  } = await supabase.auth.getUser()

  if (!user) {
    return { error: "ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤." }
  }

  const { error } = await supabase
    .from("community_join_requests")
    .delete()
    .eq("community_id", communityId)
    .eq("user_id", user.id)
    .eq("status", "pending")

  if (error) {
    return { error: error.message }
  }

  revalidatePath("/community")
  return { success: true }
}

/**
 * ì»¤ë®¤ë‹ˆí‹° ê°€ì… ì‹ ì²­ ëª©ë¡ ì¡°íšŒ (ìš´ì˜ììš©)
 */
export async function getPendingJoinRequests(communityId: string) {
  const supabase = await createClient()

  const {
    data: { user },
  } = await supabase.auth.getUser()

  if (!user) {
    return { error: "ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.", data: null }
  }

  // ê¶Œí•œ í™•ì¸
  const { data: community } = await supabase
    .from("communities")
    .select("created_by")
    .eq("id", communityId)
    .single()

  const { data: profile } = await supabase
    .from("profiles")
    .select("role")
    .eq("id", user.id)
    .single()

  const { data: adminMember } = await supabase
    .from("community_members")
    .select("role")
    .eq("community_id", communityId)
    .eq("user_id", user.id)
    .in("role", ["owner", "admin"])
    .single()

  const isOwner = community?.created_by === user.id
  const isMaster = profile?.role === "master"
  const isAdmin = !!adminMember

  if (!isOwner && !isMaster && !isAdmin) {
    return { error: "ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.", data: null }
  }

  // ëŒ€ê¸° ì¤‘ì¸ ê°€ì… ì‹ ì²­ ëª©ë¡
  const { data, error } = await supabase
    .from("community_join_requests")
    .select(`
      id,
      message,
      created_at,
      profiles:user_id (
        id,
        full_name,
        avatar_url,
        company,
        position
      )
    `)
    .eq("community_id", communityId)
    .eq("status", "pending")
    .order("created_at", { ascending: false })

  if (error) {
    return { error: error.message, data: null }
  }

  return { data, error: null }
}

export async function updateCommunityDescription(communityId: string, description: string) {
  const supabase = await createClient()

  const {
    data: { user },
  } = await supabase.auth.getUser()

  if (!user) {
    throw new Error("Unauthorized")
  }

  // í•´ë‹¹ ì»¤ë®¤ë‹ˆí‹°ì˜ ë¦¬ë”ì¸ì§€ í™•ì¸
  const { data: community } = await supabase
    .from("communities")
    .select("created_by")
    .eq("id", communityId)
    .single()

  if (!community) {
    throw new Error("Community not found")
  }

  // ê¶Œí•œ ì²´í¬: ë¦¬ë” ë˜ëŠ” master
  const { data: profile } = await supabase
    .from("profiles")
    .select("role")
    .eq("id", user.id)
    .single()

  const isLeader = community.created_by === user.id
  const isMaster = profile?.role === 'master'

  if (!isLeader && !isMaster) {
    throw new Error("Forbidden: Only community leader or master can update description")
  }

  // description ì—…ë°ì´íŠ¸
  const { error } = await supabase
    .from("communities")
    .update({ description })
    .eq("id", communityId)

  if (error) {
    throw new Error(error.message)
  }

  revalidatePath("/community")
  revalidatePath("/community/board/*")
  return { success: true }
}

/**
 * ì»¤ë®¤ë‹ˆí‹° ì„¤ì • ì—…ë°ì´íŠ¸ (ìš´ì˜ììš©)
 * - ì´ë¦„, ì†Œê°œê¸€, ê³µê°œ/ë¹„ê³µê°œ, ì´ìš©ìˆ˜ì¹™ ë³€ê²½ ê°€ëŠ¥
 */
/**
 * ì»¤ë®¤ë‹ˆí‹° ì‚­ì œ (ownerë§Œ ê°€ëŠ¥)
 */
export async function deleteCommunity(communityId: string) {
  const supabase = await createClient()

  const {
    data: { user },
  } = await supabase.auth.getUser()

  if (!user) {
    return { error: "ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤." }
  }

  // í•´ë‹¹ ì»¤ë®¤ë‹ˆí‹° ì •ë³´ ì¡°íšŒ
  const { data: community } = await supabase
    .from("communities")
    .select("created_by, name")
    .eq("id", communityId)
    .single()

  if (!community) {
    return { error: "ì»¤ë®¤ë‹ˆí‹°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤." }
  }

  // ê¶Œí•œ ì²´í¬: owner ë˜ëŠ” masterë§Œ ì‚­ì œ ê°€ëŠ¥
  const { data: profile } = await supabase
    .from("profiles")
    .select("role")
    .eq("id", user.id)
    .single()

  const { data: ownerMember } = await supabase
    .from("community_members")
    .select("role")
    .eq("community_id", communityId)
    .eq("user_id", user.id)
    .eq("role", "owner")
    .single()

  const isOwner = community.created_by === user.id || !!ownerMember
  const isMaster = profile?.role === 'master'

  if (!isOwner && !isMaster) {
    return { error: "ì»¤ë®¤ë‹ˆí‹°ë¥¼ ì‚­ì œí•  ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. ì†Œìœ ìë§Œ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤." }
  }

  // 1. ê´€ë ¨ ê²Œì‹œê¸€ ì‚­ì œ (board_categoriesë¥¼ í†µí•´)
  // ë¨¼ì € board_categoriesì—ì„œ slug ë˜ëŠ” nameìœ¼ë¡œ ì°¾ê¸°
  const slug = community.name.trim().toLowerCase().replace(/\s+/g, '-')
  let boardCategory = null

  // slugë¡œ ë¨¼ì € ì‹œë„
  const { data: boardCatBySlug } = await supabase
    .from("board_categories")
    .select("id")
    .eq("slug", slug)
    .single()

  if (boardCatBySlug) {
    boardCategory = boardCatBySlug
  } else {
    // nameìœ¼ë¡œ ì‹œë„
    const { data: boardCatByName } = await supabase
      .from("board_categories")
      .select("id")
      .eq("name", community.name)
      .single()
    boardCategory = boardCatByName
  }

  console.log("[deleteCommunity] boardCategory:", boardCategory, "slug:", slug, "name:", community.name)

  if (boardCategory) {
    // í•´ë‹¹ ê²Œì‹œíŒì˜ ê²Œì‹œê¸€ ì‚­ì œ
    const { error: postsError } = await supabase
      .from("posts")
      .delete()
      .eq("board_category_id", boardCategory.id)

    if (postsError) {
      console.error("[deleteCommunity] posts ì‚­ì œ ì‹¤íŒ¨:", postsError)
    }

    // board_categories ì‚­ì œ
    const { error: boardCatError } = await supabase
      .from("board_categories")
      .delete()
      .eq("id", boardCategory.id)

    if (boardCatError) {
      console.error("[deleteCommunity] board_categories ì‚­ì œ ì‹¤íŒ¨:", boardCatError)
    }
  }

  // 2. ê°€ì… ì‹ ì²­ ì‚­ì œ
  const { error: joinReqError } = await supabase
    .from("community_join_requests")
    .delete()
    .eq("community_id", communityId)

  if (joinReqError) {
    console.error("[deleteCommunity] join_requests ì‚­ì œ ì‹¤íŒ¨:", joinReqError)
  }

  // 3. ë©¤ë²„ì‹­ ì‚­ì œ
  console.log("[deleteCommunity] ë©¤ë²„ì‹­ ì‚­ì œ ì‹œë„, communityId:", communityId)
  const { error: membersError } = await supabase
    .from("community_members")
    .delete()
    .eq("community_id", communityId)

  console.log("[deleteCommunity] ë©¤ë²„ì‹­ ì‚­ì œ ê²°ê³¼, error:", membersError)

  if (membersError) {
    console.error("[deleteCommunity] members ì‚­ì œ ì‹¤íŒ¨:", membersError)
    return { error: "ë©¤ë²„ì‹­ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: " + membersError.message }
  }

  // 4. ì»¤ë®¤ë‹ˆí‹° ì‚­ì œ
  console.log("[deleteCommunity] ì»¤ë®¤ë‹ˆí‹° ì‚­ì œ ì‹œë„, id:", communityId)
  const { error, data: deletedData } = await supabase
    .from("communities")
    .delete()
    .eq("id", communityId)
    .select()

  console.log("[deleteCommunity] ì»¤ë®¤ë‹ˆí‹° ì‚­ì œ ê²°ê³¼, error:", error, "deletedData:", deletedData)

  if (error) {
    console.error("[deleteCommunity] community ì‚­ì œ ì‹¤íŒ¨:", error)
    return { error: error.message }
  }

  // ì‚­ì œê°€ ì‹¤ì œë¡œ ë˜ì—ˆëŠ”ì§€ í™•ì¸
  const { data: checkDeleted } = await supabase
    .from("communities")
    .select("id")
    .eq("id", communityId)
    .single()

  if (checkDeleted) {
    console.error("[deleteCommunity] ì»¤ë®¤ë‹ˆí‹°ê°€ ì—¬ì „íˆ ì¡´ì¬í•¨! RLS ì •ì±… í™•ì¸ í•„ìš”")
    return { error: "ì‚­ì œê°€ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ê¶Œí•œì„ í™•ì¸í•´ì£¼ì„¸ìš”." }
  }

  console.log("[deleteCommunity] ì‚­ì œ ì™„ë£Œ:", communityId)

  revalidatePath("/community")
  revalidatePath("/communities")
  return { success: true }
}

export async function updateCommunitySettings(
  communityId: string,
  settings: {
    name?: string
    description?: string
    is_private?: boolean
    rules?: string
    thumbnail_url?: string
    banner_url?: string
  }
) {
  const supabase = await createClient()

  const {
    data: { user },
  } = await supabase.auth.getUser()

  if (!user) {
    return { error: "ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤." }
  }

  // í•´ë‹¹ ì»¤ë®¤ë‹ˆí‹° ì •ë³´ ì¡°íšŒ
  const { data: community } = await supabase
    .from("communities")
    .select("created_by")
    .eq("id", communityId)
    .single()

  if (!community) {
    return { error: "ì»¤ë®¤ë‹ˆí‹°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤." }
  }

  // ê¶Œí•œ ì²´í¬: owner, admin, ë˜ëŠ” master
  const { data: profile } = await supabase
    .from("profiles")
    .select("role")
    .eq("id", user.id)
    .single()

  const { data: adminMember } = await supabase
    .from("community_members")
    .select("role")
    .eq("community_id", communityId)
    .eq("user_id", user.id)
    .in("role", ["owner", "admin"])
    .single()

  const isOwnerMember = adminMember?.role === "owner"
  const isOwner = community.created_by === user.id || isOwnerMember
  const isMaster = profile?.role === 'master'
  const isAdmin = !!adminMember

  if (!isOwner && !isMaster && !isAdmin) {
    return { error: "ì„¤ì •ì„ ë³€ê²½í•  ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤." }
  }

  // ì´ë¦„ ë³€ê²½ì€ ë¦¬ë”(owner)ì™€ ë§ˆìŠ¤í„°ë§Œ ê°€ëŠ¥
  if (settings.name && !isOwner && !isMaster) {
    return { error: "ì»¤ë®¤ë‹ˆí‹° ì´ë¦„ì€ ë¦¬ë”ë§Œ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤." }
  }

  // ì„¤ì • ì—…ë°ì´íŠ¸
  const { error } = await supabase
    .from("communities")
    .update({
      ...settings,
      updated_at: new Date().toISOString(),
    })
    .eq("id", communityId)

  if (error) {
    return { error: error.message }
  }

  revalidatePath("/community")
  revalidatePath("/community/board/*")
  revalidatePath(`/communities/${communityId}`)
  return { success: true }
}
</file>

<file path="components/sidebar.tsx">
"use client"

import Link from "next/link"
import { usePathname } from "next/navigation"
import { cn } from "@/lib/utils"
import { Calendar, Shield, Megaphone, MessageSquare, Home, Users, Lightbulb, BookOpen, Ticket, Zap, Headset, Briefcase, Hash } from "lucide-react"
import { useRef, useEffect, useState } from "react"
import { usePrefetchPosts } from "@/lib/hooks/usePrefetchPosts"
import { createClient } from "@/lib/supabase/client"

interface SidebarProps {
  userRole?: string | null
}

interface JoinedCommunity {
  id: string
  name: string
  slug: string
}

const navigationSections = [
  {
    title: null, // ì†Œê°œ ì„¹ì…˜ì€ íƒ€ì´í‹€ ì—†ìŒ
    links: [
      { name: "SEOUL FOUNDERS CLUB", href: "/about", icon: BookOpen },
      { name: "ë©¤ë²„", href: "/member", icon: Users }
    ],
    groupStyle: "major"
  },
  {
    title: "ì„±ì¥",
    links: [
      { name: "ì´ë²¤íŠ¸", href: "/e", icon: Calendar },
      { name: "ì¸ì‚¬ì´íŠ¸", href: "/community/board/insights", icon: Zap },
      { name: "íŒŒíŠ¸ë„ˆìŠ¤", href: "/partners", icon: Briefcase }
    ],
    groupStyle: "major"
  },
  {
    title: "ê²Œì‹œíŒ",
    links: [
      { name: "ê³µì§€ì‚¬í•­", href: "/community/board/announcements", icon: Megaphone },
      { name: "ììœ ê²Œì‹œíŒ", href: "/community/board/free", icon: MessageSquare }
    ],
    groupStyle: "board"
  },
  {
    title: null, // ì„¹ì…˜ íƒ€ì´í‹€ ì œê±°
    links: [
      { name: "ì»¤ë®¤ë‹ˆí‹°", href: "/community", icon: Ticket },
    ],
    groupStyle: "brand",
    showJoinedCommunities: true, // ê°€ì…í•œ ì»¤ë®¤ë‹ˆí‹° í‘œì‹œ í”Œë˜ê·¸
  },
]

// sessionStorage í‚¤
const COMMUNITIES_CACHE_KEY = 'sidebar_joined_communities'

// ìºì‹œì—ì„œ ì»¤ë®¤ë‹ˆí‹° ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
function getCachedCommunities(): JoinedCommunity[] {
  if (typeof window === 'undefined') return []
  try {
    const cached = sessionStorage.getItem(COMMUNITIES_CACHE_KEY)
    if (cached) {
      return JSON.parse(cached)
    }
  } catch (e) {
    console.error("[Sidebar] Cache read error:", e)
  }
  return []
}

// ì»¤ë®¤ë‹ˆí‹° ëª©ë¡ ìºì‹œì— ì €ì¥
function setCachedCommunities(communities: JoinedCommunity[]) {
  if (typeof window === 'undefined') return
  try {
    sessionStorage.setItem(COMMUNITIES_CACHE_KEY, JSON.stringify(communities))
  } catch (e) {
    console.error("[Sidebar] Cache write error:", e)
  }
}

export function Sidebar({ userRole: initialUserRole }: SidebarProps) {
  const pathname = usePathname()
  const prefetch = usePrefetchPosts()
  const sidebarRef = useRef<HTMLDivElement>(null)
  const [userRole, setUserRole] = useState<string | null>(initialUserRole || null)
  // ì„œë²„/í´ë¼ì´ì–¸íŠ¸ ì¼ê´€ì„±ì„ ìœ„í•´ ë¹ˆ ë°°ì—´ë¡œ ì´ˆê¸°í™” (ìºì‹œëŠ” useEffectì—ì„œ ë¡œë“œ)
  const [joinedCommunities, setJoinedCommunities] = useState<JoinedCommunity[]>([])
  const loadingRef = useRef(false)
  const cacheLoadedRef = useRef(false)

  // í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì¸ì¦ ìƒíƒœ ì²´í¬ ë° ê°€ì…í•œ ì»¤ë®¤ë‹ˆí‹° ë¡œë“œ
  useEffect(() => {
    const supabase = createClient()
    let isMounted = true

    async function loadCommunities(userId: string) {
      if (!isMounted) return

      try {
        const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL
        const supabaseKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY

        if (!supabaseUrl || !supabaseKey) return

        const fetchUrl = `${supabaseUrl}/rest/v1/community_members?select=community_id&user_id=eq.${userId}`

        const membershipsRes = await fetch(
          fetchUrl,
          {
            headers: {
              'apikey': supabaseKey,
              'Authorization': `Bearer ${supabaseKey}`,
            },
          }
        )

        if (!membershipsRes.ok) return

        const memberships = await membershipsRes.json()

        if (!isMounted) return

        if (memberships && memberships.length > 0) {
          const communityIds = memberships.map((m: any) => m.community_id)

          // communities ì¡°íšŒ
          const communitiesRes = await fetch(
            `${supabaseUrl}/rest/v1/communities?select=id,name&id=in.(${communityIds.join(',')})`,
            {
              headers: {
                'apikey': supabaseKey!,
                'Authorization': `Bearer ${supabaseKey}`,
              },
            }
          )

          const communities = await communitiesRes.json()

          if (!isMounted) return

          if (communities && communities.length > 0) {
            const communityNames = communities.map((c: any) => c.name)

            // board_categories ì¡°íšŒ
            const categoriesRes = await fetch(
              `${supabaseUrl}/rest/v1/board_categories?select=name,slug&name=in.(${communityNames.map((n: string) => `"${n}"`).join(',')})`,
              {
                headers: {
                  'apikey': supabaseKey!,
                  'Authorization': `Bearer ${supabaseKey}`,
                },
              }
            )

            const categories = await categoriesRes.json()

            const communityList: JoinedCommunity[] = communities.map((community: any) => {
              const category = categories?.find((c: any) => c.name === community.name)
              return {
                id: community.id,
                name: community.name,
                slug: category?.slug || community.name.toLowerCase().replace(/\s+/g, '-'),
              }
            })

            if (isMounted) {
              setJoinedCommunities(communityList)
              setCachedCommunities(communityList) // ìºì‹œì— ì €ì¥
            }
          }
        }
      } catch (error) {
        // Silent fail
      }
    }

    async function initLoad() {
      if (loadingRef.current) return
      loadingRef.current = true

      try {
        const { data: { session } } = await supabase.auth.getSession()

        if (session?.user && isMounted) {
          // ë¡œê·¸ì¸ ìƒíƒœì—ì„œë§Œ ìºì‹œ ë¡œë“œ (hydration ì´í›„)
          if (!cacheLoadedRef.current) {
            cacheLoadedRef.current = true
            const cached = getCachedCommunities()
            if (cached.length > 0) {
              setJoinedCommunities(cached)
            }
          }

          // ì—­í•  ê°€ì ¸ì˜¤ê¸°
          if (!initialUserRole) {
            const { data: profile } = await supabase
              .from("profiles")
              .select("role")
              .eq("id", session.user.id)
              .single()
            if (isMounted) setUserRole(profile?.role || null)
          }

          // ì»¤ë®¤ë‹ˆí‹° ë¡œë“œ
          await loadCommunities(session.user.id)
        } else {
          // ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ê²½ìš° ìºì‹œì™€ ì»¤ë®¤ë‹ˆí‹° ëª©ë¡ ì´ˆê¸°í™”
          if (isMounted) {
            setJoinedCommunities([])
            setCachedCommunities([])
          }
        }
      } catch (error) {
        // Silent fail
      } finally {
        loadingRef.current = false
      }
    }

    initLoad()

    const { data: { subscription } } = supabase.auth.onAuthStateChange((event, session) => {
      if (event === 'INITIAL_SESSION') return

      if (session?.user) {
        // ì—­í•  ê°€ì ¸ì˜¤ê¸°
        if (!initialUserRole) {
          supabase
            .from("profiles")
            .select("role")
            .eq("id", session.user.id)
            .single()
            .then(({ data: profile }) => {
              if (isMounted) setUserRole(profile?.role || null)
            })
        }

        // ì»¤ë®¤ë‹ˆí‹° ë¡œë“œ
        loadCommunities(session.user.id)
      } else {
        // ë¡œê·¸ì•„ì›ƒ ì‹œ ì»¤ë®¤ë‹ˆí‹° ëª©ë¡ ì´ˆê¸°í™”
        if (isMounted) {
          setJoinedCommunities([])
          setCachedCommunities([]) // ìºì‹œë„ ì´ˆê¸°í™”
          setUserRole(null)
        }
      }
    })

    return () => {
      isMounted = false
      subscription.unsubscribe()
    }
  }, [initialUserRole])

  const isAdmin = userRole === "admin" || userRole === "master"
  const showAdminMenu = isAdmin || pathname.startsWith('/admin')

  const isLinkActive = (href: string, startsWith = false) => {
    if (href === '/community' || href === '/community/page') {
      return pathname === href
    }
    return startsWith ? pathname.startsWith(href) : pathname === href
  }

  useEffect(() => {
    const sidebar = sidebarRef.current
    if (!sidebar) return

    const handleWheel = (e: WheelEvent) => {
      const isScrollable = sidebar.scrollHeight > sidebar.clientHeight
      const isAtTop = sidebar.scrollTop <= 1
      const isAtBottom = sidebar.scrollTop + sidebar.clientHeight >= sidebar.scrollHeight - 5

      if (isScrollable) {
        if ((e.deltaY < 0 && !isAtTop) || (e.deltaY > 0 && !isAtBottom)) {
          e.stopPropagation()
        }
      }
    }

    sidebar.addEventListener('wheel', handleWheel, { passive: false })

    return () => {
      sidebar.removeEventListener('wheel', handleWheel)
    }
  }, [])

  return (
    <div className="flex h-full w-full flex-col bg-white border-r border-slate-100 shadow-sm overflow-hidden">
      <nav
        ref={sidebarRef}
        className="flex-1 px-3 py-4 overflow-y-auto overflow-x-hidden no-scrollbar"
        style={{
          scrollbarWidth: 'none',
          msOverflowStyle: 'none',
        }}
      >
        {/* 1. í™ˆ (Top Level) */}
        <div className="space-y-0.5 mb-1">
          <Link
            href="/"
            prefetch={true}
            className={cn(
              "flex items-center gap-2.5 rounded-lg px-5 py-1.5 text-[15px] transition-all",
              isLinkActive("/") ? "bg-slate-100 text-slate-900 font-medium" : "text-slate-600 hover:bg-slate-50 hover:text-slate-900 font-normal",
            )}
          >
            <Home className="h-4 w-4 flex-shrink-0" />
            <span>í™ˆ</span>
          </Link>
        </div>

        {/* 2. êµ¬ì¡°í™”ëœ ë©”ë‰´ ì„¹ì…˜ */}
        {navigationSections.map((section, sectionIndex) => (
          <div key={section.title || sectionIndex}>
            {/* ì„¹ì…˜ êµ¬ë¶„ì„  (ì²« ë²ˆì§¸ ì„¹ì…˜ ì œì™¸) */}
            {sectionIndex > 0 && (
              <div className="my-2 mx-5 border-t border-slate-200" />
            )}

            <div className="py-1">
              {/* íƒ€ì´í‹€ì´ ìˆëŠ” ê²½ìš°ì—ë§Œ í‘œì‹œ */}
              {section.title && (
                <div className="px-5 mb-1.5">
                  <span className="text-[11px] font-medium text-slate-500">
                    {section.title}
                  </span>
                </div>
              )}

              <div className="space-y-0.5">
                {section.links.map((item) => {
                  const useExactMatch = item.href === "/community"
                  const isActive = isLinkActive(item.href, !useExactMatch)
                  const Icon = item.icon
                  const isBoardLink = item.href.startsWith("/community/board/")
                  const boardSlug = isBoardLink ? item.href.split("/").pop() : null
                  let dbSlug = boardSlug
                  if (boardSlug === 'free') dbSlug = 'free-board'
                  if (boardSlug === 'announcements') dbSlug = 'announcement'

                  return (
                    <Link
                      key={item.name}
                      href={item.href}
                      prefetch={true}
                      onMouseEnter={() => {
                        if (isBoardLink && dbSlug) {
                          prefetch(dbSlug)
                        }
                      }}
                      className={cn(
                        "flex items-center gap-2.5 px-5 py-1.5 text-[15px] transition-all rounded-lg",
                        isActive ? "bg-slate-100 text-slate-900 font-medium" : "text-slate-600 hover:bg-slate-50 hover:text-slate-900 font-normal",
                      )}
                    >
                      <Icon className="h-4 w-4 flex-shrink-0" />
                      <span>{item.name}</span>
                    </Link>
                  )
                })}

                {/* ê°€ì…í•œ ì»¤ë®¤ë‹ˆí‹° ëª©ë¡ (í•´ë‹¹ ì„¹ì…˜ì—ë§Œ í‘œì‹œ) */}
                {(section as any).showJoinedCommunities && joinedCommunities.length > 0 && (
                  <div className="space-y-px ml-4">
                    {joinedCommunities.map((community) => {
                      const communityHref = `/community/board/${community.slug}`
                      const isActive = pathname === communityHref || pathname.startsWith(`${communityHref}/`)

                      return (
                        <Link
                          key={community.id}
                          href={communityHref}
                          prefetch={true}
                          onMouseEnter={() => prefetch(community.slug)}
                          className={cn(
                            "flex items-center gap-2 px-4 py-1 text-[13px] transition-all rounded-lg",
                            isActive ? "bg-slate-100 text-slate-900 font-medium" : "text-slate-500 hover:bg-slate-50 hover:text-slate-900 font-normal",
                          )}
                        >
                          <Hash className="h-3.5 w-3.5 flex-shrink-0" />
                          <span className="truncate">{community.name}</span>
                        </Link>
                      )
                    })}
                  </div>
                )}
              </div>
            </div>
          </div>
        ))}

        {/* 3. ê¸°íƒ€ ë° ê´€ë¦¬ì ì„¹ì…˜ */}
        <div>
          <div className="my-2 mx-5 border-t border-slate-200" />
          <div className="py-1">
            <div className="px-5 mb-1.5">
              <span className="text-[11px] font-medium text-slate-500">ê¸°íƒ€</span>
            </div>
          <div className="space-y-0.5">
            <Link
              href="/customer-center"
              prefetch={true}
              className={cn(
                "flex items-center gap-2.5 px-5 py-1.5 text-[15px] transition-all rounded-lg",
                isLinkActive("/customer-center", true)
                  ? "bg-slate-100 text-slate-900 font-medium"
                  : "text-slate-600 hover:bg-slate-50 hover:text-slate-900 font-normal",
              )}
            >
              <Headset className="h-4 w-4 flex-shrink-0" />
              <span>ê³ ê°ì„¼í„°</span>
            </Link>
            {showAdminMenu && (
              <Link
                href="/admin"
                prefetch={true}
                className={cn(
                  "flex items-center gap-2.5 px-5 py-1.5 text-[15px] transition-all rounded-lg",
                  isLinkActive("/admin", true)
                    ? "bg-slate-100 text-slate-900 font-medium"
                    : "text-slate-600 hover:bg-slate-50 hover:text-slate-900 font-normal",
                )}
              >
                <Shield className="h-4 w-4 flex-shrink-0" />
                <span>ê´€ë¦¬ì</span>
              </Link>
            )}
          </div>
          </div>
        </div>
      </nav>

      {/* í•˜ë‹¨ í‘¸í„° ì˜ì—­ */}
      <div className="p-4 border-t border-slate-100 bg-white">
        <div className="text-[11px] leading-relaxed text-slate-400 font-medium px-2">
          <p className="mb-1">Â© 2025 Seoul Founders Club</p>
          <div className="flex flex-wrap gap-x-2 gap-y-1">
            <Link href="/terms" className="hover:text-slate-600 transition-colors">ì´ìš©ì•½ê´€</Link>
            <span className="text-slate-300">Â·</span>
            <Link href="/privacy" className="hover:text-slate-600 transition-colors">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</Link>
          </div>
        </div>
      </div>
    </div>
  )
}
</file>

<file path="app/community/profile/ProfileContent.tsx">
"use client"

import { createClient } from "@/lib/supabase/client"
import { Card, CardContent } from "@/components/ui/card"
import { Mail, Calendar, Edit3, CalendarDays, Ticket, Medal, Camera, LogOut, FileText, X, Loader2, Paperclip, Info } from "lucide-react"
import Image from "next/image"
import { useEffect, useState, useRef } from "react"
import { useRouter } from "next/navigation"
import { Separator } from "@/components/ui/separator"
import { cn } from "@/lib/utils"
import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from "@/components/ui/dialog"
import { Button } from "@/components/ui/button"
import { BadgeManager } from "@/components/badge-manager"
import { updateProfileAvatar, updateProfileInfo } from "@/lib/actions/user"
import { removeBadge } from "@/lib/actions/badges"
import { Input } from "@/components/ui/input"
import { Textarea } from "@/components/ui/textarea"
import { Label } from "@/components/ui/label"
import { Switch } from "@/components/ui/switch"
import { Badge } from "@/components/ui/badge"
import type { User, Profile } from "@/lib/types/profile"
import type { EventListItem } from "@/lib/types/events"
import type { PostListItem } from "@/lib/types/posts"
import type { VisibleBadge, Badge as BadgeType, UserBadgeWithBadge } from "@/lib/types/badges"
import type { LucideIcon } from "lucide-react"
import Link from "next/link"
import { MapPin } from "lucide-react"

type TabType = "posts" | "created_events" | "participated_events"

// ì´ë²¤íŠ¸ ë“±ë¡ ì¿¼ë¦¬ ê²°ê³¼ íƒ€ì…
type EventRegistrationQueryResult = {
  registered_at: string
  events: {
    id: string
    title: string
    thumbnail_url: string | null
    event_date: string
    location: string | null
  } | null
}

// ë±ƒì§€ ì¿¼ë¦¬ ê²°ê³¼ íƒ€ì…
type BadgeQueryResult = {
  badges: {
    icon: string
    name: string
    is_active?: boolean
  } | null
}

// ------------------------------------------------------------------
// í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ë“¤
// ------------------------------------------------------------------

function EmptyState({ message }: { message: string }) {
  return (
    <div className="flex flex-col items-center justify-center py-16 text-slate-400">
      <div className="w-12 h-12 bg-slate-50 rounded-full flex items-center justify-center mb-3">
        <FileText className="h-5 w-5 text-slate-300" />
      </div>
      <p className="text-sm">{message}</p>
    </div>
  )
}

function PostListItem({ post }: { post: PostListItem }) {
  return (
    <Link key={post.id} href={`/community/board/${post.board_categories?.slug || "free"}/${post.id}`} className="flex flex-col p-5 hover:bg-slate-50 transition-colors group border-b border-slate-100 last:border-0">
      <div className="flex items-center gap-2 mb-1.5">
        <span className="px-2 py-0.5 rounded bg-slate-100 text-xs font-medium text-slate-600">
          {post.board_categories?.name || "ê²Œì‹œíŒ"}
        </span>
        <span className="text-xs text-slate-400" suppressHydrationWarning>
          {new Date(post.created_at).toLocaleDateString()}
        </span>
      </div>
      <h3 className="text-base font-medium text-slate-900 group-hover:text-indigo-600 transition-colors truncate">
        {post.title}
      </h3>
      <div className="flex gap-3 mt-2 text-xs text-slate-500">
        <span>ì¢‹ì•„ìš” {post.likes_count || 0}</span>
        <span>ëŒ“ê¸€ {post.comments_count || 0}</span>
      </div>
    </Link>
  )
}

function EventListItem({ event }: { event: EventListItem }) {
  // isPast ê³„ì‚°ì„ í´ë¼ì´ì–¸íŠ¸ì—ì„œë§Œ ìˆ˜í–‰í•˜ì—¬ hydration ë¶ˆì¼ì¹˜ ë°©ì§€
  const [isPast, setIsPast] = useState(false)

  useEffect(() => {
    const eventDate = new Date(event.event_date)
    setIsPast(eventDate < new Date())
  }, [event.event_date])

  let badgeText = "ëª¨ì§‘ì¤‘"
  let badgeStyle = "bg-blue-50 text-blue-700"

  if (event.registration_date) {
    badgeText = "ì‹ ì²­ ì™„ë£Œ"
    badgeStyle = "bg-green-50 text-green-700"
  } else if (isPast) {
    badgeText = "ì¢…ë£Œ"
    badgeStyle = "bg-slate-100 text-slate-500"
  } else if (event.status === 'cancelled') {
    badgeText = "ì·¨ì†Œë¨"
    badgeStyle = "bg-red-50 text-red-700"
  }

  return (
    <Link key={event.id} href={`/events/${event.id}`} className="flex gap-4 p-5 hover:bg-slate-50 transition-colors group border-b border-slate-100 last:border-0">
      <div className="h-16 w-16 shrink-0 rounded-lg bg-slate-100 overflow-hidden relative border border-slate-200">
        {event.thumbnail_url ? (
          <Image src={event.thumbnail_url} alt="" fill sizes="64px" className="object-cover" />
        ) : (
          <div className="flex h-full w-full items-center justify-center text-slate-300"><Ticket className="h-6 w-6" /></div>
        )}
      </div>
      <div className="flex-1 min-w-0">
        <h3 className="font-medium text-slate-900 truncate mb-1 group-hover:text-indigo-600 transition-colors">{event.title}</h3>
        <div className="flex items-center gap-3 text-xs text-slate-500">
          <span className="flex items-center gap-1" suppressHydrationWarning><CalendarDays className="h-3 w-3" /> {new Date(event.event_date).toLocaleDateString()}</span>
          <span className="flex items-center gap-1"><MapPin className="h-3 w-3" /> {event.location || "ì¥ì†Œ ë¯¸ì •"}</span>
        </div>
        <div className="mt-2">
          <span className={cn("inline-flex items-center px-2 py-0.5 rounded text-[10px] font-medium", badgeStyle)}>
            {badgeText}
          </span>
        </div>
      </div>
    </Link>
  )
}

export default function ProfileContent() {
  const router = useRouter()
  const [user, setUser] = useState<User | null>(null)
  const [profile, setProfile] = useState<Profile | null>(null)

  // Hydration ì•ˆì „ì„ ìœ„í•œ mounted ìƒíƒœ
  const [mounted, setMounted] = useState(false)

  // Data States
  const [createdEvents, setCreatedEvents] = useState<EventListItem[]>([])
  const [userPosts, setUserPosts] = useState<PostListItem[]>([])
  const [registeredEvents, setRegisteredEvents] = useState<EventListItem[]>([])
  const [visibleBadges, setVisibleBadges] = useState<VisibleBadge[]>([])
  const [userBadges, setUserBadges] = useState<UserBadgeWithBadge[]>([])
  const [allBadges, setAllBadges] = useState<BadgeType[]>([])

  // UI State
  const [activeTab, setActiveTab] = useState<TabType>("posts")
  const [loading, setLoading] = useState(true)
  const [sessionError, setSessionError] = useState<string | null>(null)
  const [showBadgeManager, setShowBadgeManager] = useState(false)
  const [isUploading, setIsUploading] = useState(false)
  const [showProfileEdit, setShowProfileEdit] = useState(false)
  const [isSaving, setIsSaving] = useState(false)
  const [isSigningOut, setIsSigningOut] = useState(false)
  const [selectedBadgeId, setSelectedBadgeId] = useState<string>("")
  const [addingBadge, setAddingBadge] = useState(false)
  const [showBadgeRequestDialog, setShowBadgeRequestDialog] = useState(false)
  const [badgeEvidence, setBadgeEvidence] = useState("")
  const [badgeProofFile, setBadgeProofFile] = useState<File | null>(null)

  // í”„ë¡œí•„ í¸ì§‘ í¼ ìƒíƒœ
  const [editForm, setEditForm] = useState({
    full_name: "",
    company: "",
    position: "",
    company_2: "",
    position_2: "",
    tagline: "",
    introduction: "",
    member_type: [] as ("ì‚¬ì—…ê°€" | "íˆ¬ìì" | "í¬ë¦¬ì—ì´í„°")[],
    is_profile_public: false,
  })

  // ì¤‘ë³µ ë°ì´í„° ë¡œë”© ë°©ì§€ìš© ref
  const hasLoadedRef = useRef(false)

  // í´ë¼ì´ì–¸íŠ¸ ë§ˆìš´íŠ¸ í™•ì¸
  useEffect(() => {
    setMounted(true)
  }, [])


  // í†µí•©ëœ ì¸ì¦ ë° ë°ì´í„° ë¡œë”© ë¡œì§
  useEffect(() => {
    const supabase = createClient()
    let isMounted = true

    // [ì•ˆì „ì¥ì¹˜] 10ì´ˆ í›„ì—ë„ ë¡œë”© ì¤‘ì´ë©´ ê°•ì œ ì¢…ë£Œ
    const safetyTimerRef = { current: true }
    const safetyTimer = setTimeout(() => {
      if (safetyTimerRef.current && isMounted) {
        console.warn("Safety timer triggered - forcing loading to false")
        setLoading(false)
      }
    }, 10000)

    // ë¦¬ìŠ¤íŠ¸ ë°ì´í„° ë¹„ë™ê¸° ë¡œë”© (Fire & Forget)
    // awaitë¥¼ ì“°ì§€ ì•Šê³  .then()ìœ¼ë¡œ ì²˜ë¦¬í•˜ì—¬ ë©”ì¸ ìŠ¤ë ˆë“œë¥¼ ë§‰ì§€ ì•ŠìŒ
    const loadListData = (userId: string) => {

      // (1) ë§Œë“  ì´ë²¤íŠ¸
      supabase
        .from("events")
        .select(`id, title, thumbnail_url, event_date, location, created_at`)
        .eq("created_by", userId)
        .order("created_at", { ascending: false })
        .limit(20)
        .then(({ data, error }) => {
          if (!isMounted) return
          if (error) console.error(`Events error: ${error.message}`)

          if (!error && data) {
            setCreatedEvents(data.map((event) => ({
              id: event.id,
              title: event.title,
              thumbnail_url: event.thumbnail_url,
              event_date: event.event_date,
              location: event.location,
              created_at: event.created_at,
            })))
          }
        })

      // (2) ì‘ì„± ê²Œì‹œê¸€
      supabase
        .from("posts")
        .select(`id, title, created_at, likes_count, comments_count, board_categories (name, slug)`)
        .eq("author_id", userId)
        .order("created_at", { ascending: false })
        .limit(20)
        .then(({ data, error }) => {
          if (!isMounted) return
          if (error) console.error(`Posts error: ${error.message}`)

          if (!error && data) {
            setUserPosts(data.map((post) => ({
              id: post.id,
              title: post.title,
              created_at: post.created_at,
              board_categories: Array.isArray(post.board_categories) ? post.board_categories[0] : post.board_categories,
              likes_count: post.likes_count || 0,
              comments_count: post.comments_count || 0,
            })))
          }
        })

      // (3) ì‹ ì²­ ë‚´ì—­
      supabase
        .from("event_registrations")
        .select(`
          registered_at,
          events!inner (
            id, title, thumbnail_url, event_date, location
          )
        `)
        .eq("user_id", userId)
        .order("registered_at", { ascending: false })
        .limit(20)
        .then(({ data, error }) => {
          if (error) console.error(`Registrations error: ${error.message}`)
          else if (isMounted && data) {
            const flattened: EventListItem[] = data
              .filter((reg: any) => reg.events)
              .map((reg: any) => ({
                id: reg.events.id,
                title: reg.events.title,
                thumbnail_url: reg.events.thumbnail_url,
                event_date: reg.events.event_date,
                location: reg.events.location,
                created_at: reg.events.event_date,
                registration_date: reg.registered_at ?? undefined,
              }))
            setRegisteredEvents(flattened)
          }
        })

      // (4) ë±ƒì§€ ì •ë³´
      supabase
        .from("user_badges")
        .select(`badges:badge_id (icon, name, is_active)`)
        .eq("user_id", userId)
        .eq("is_visible", true)
        .eq("is_visible", true)
        .limit(10)
        .then(({ data, error }) => {
          if (error) console.error(`Badges error: ${error.message}`)
          else if (isMounted && data) {
            const mappedBadges = data
              .filter((item: any) => item.badges && item.badges.is_active !== false)
              .map((item: any) => ({
                icon: item.badges.icon,
                name: item.badges.name,
              }))
            setVisibleBadges(mappedBadges)
          }
        })

      // (5) ì „ì²´ ë±ƒì§€ ë° ë‚´ ë±ƒì§€ ìƒì„¸
      supabase
        .from("user_badges")
        .select(`
          id, badge_id, is_visible, status, evidence,
          badges:badge_id (id, name, icon, category, description, is_active)
        `)
        .eq("user_id", userId)
        .order("created_at", { ascending: false })
        .then(({ data }) => {
          if (data && isMounted) setUserBadges(data as any)
        })
    }

    // í†µí•©ëœ ì¸ì¦ ë° ë°ì´í„° ë¡œë”© ë¡œì§ (try-finallyë¡œ ë¡œë”© ìƒíƒœ ì•ˆì „ ê´€ë¦¬)
    const loadUserData = async (currentUser: User) => {
      try {
        if (!isMounted) return

        hasLoadedRef.current = true
        safetyTimerRef.current = false // ì •ìƒ ë¡œë“œ ì‹œì‘ë˜ë©´ ì•ˆì „ì¥ì¹˜ ë¹„í™œì„±í™”
        setUser(currentUser)

        // í”„ë¡œí•„ ë¡œë“œ
        const { data: profileData } = await supabase
          .from("profiles")
          .select("*")
          .eq("id", currentUser.id)
          .single()

        if (profileData && isMounted) {
          setProfile(profileData as Profile)
          setEditForm({
            full_name: profileData.full_name || "",
            company: profileData.company || "",
            position: profileData.position || "",
            company_2: profileData.company_2 || "",
            position_2: profileData.position_2 || "",
            tagline: (profileData as any).tagline || "",
            introduction: profileData.introduction || "",
            member_type: Array.isArray((profileData as any).member_type)
              ? (profileData as any).member_type
              : (profileData as any).member_type
                ? [(profileData as any).member_type]
                : [],
            is_profile_public: profileData.is_profile_public || false,
          })
        }

        // ë¦¬ìŠ¤íŠ¸ ë°ì´í„° ë¡œë“œëŠ” ë¹„ë™ê¸°ë¡œ ì‹¤í–‰ (await í•˜ì§€ ì•ŠìŒ)
        loadListData(currentUser.id)
      } catch (error) {
        console.error("Error loading user data:", error)
      } finally {
        // ì„±ê³µí•˜ë“  ì‹¤íŒ¨í•˜ë“  ë¡œë”© ìƒíƒœ í•´ì œ
        if (isMounted) setLoading(false)
      }
    }

    // â˜… í•µì‹¬ ìˆ˜ì •: Promise.race ë° íƒ€ì„ì•„ì›ƒ ì œê±°, getSession + getUser fallback
    const initAuth = async () => {
      try {
        // 1. í˜„ì¬ ì„¸ì…˜ ìƒíƒœ í™•ì¸ (ê°€ì¥ ë¹ ë¦„)
        const { data: { session } } = await supabase.auth.getSession()

        if (session?.user) {
          // ì„¸ì…˜ì´ ìœ íš¨í•˜ë©´ ë°”ë¡œ ë°ì´í„° ë¡œë“œ
          await loadUserData(session.user)
        } else {
          // 2. ì„¸ì…˜ì´ ì—†ìœ¼ë©´ getUserë¡œ ì¬í™•ì¸ (fallback)
          const { data: { user }, error } = await supabase.auth.getUser()

          if (error || !user) {
            console.log("No authenticated user, redirecting...")
            if (isMounted) {
              router.replace("/auth/login")
            }
          } else {
            await loadUserData(user)
          }
        }
      } catch (error) {
        console.error("Auth initialization error:", error)
        if (isMounted) {
          setSessionError("ì¸ì¦ í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")
          setLoading(false)
        }
      }
    }

    // ì´ˆê¸°í™” ì‹¤í–‰
    initAuth()

    // 2. ì¸ì¦ ìƒíƒœ ë³€ê²½ ê°ì§€ (ì„¸ì…˜ ë§Œë£Œ ë“± ëŒ€ì‘)
    const { data: { subscription } } = supabase.auth.onAuthStateChange(async (event, session) => {
      if (!isMounted) return

      if (event === 'SIGNED_IN' && session?.user && !hasLoadedRef.current) {
        setLoading(true)
        await loadUserData(session.user)
      } else if (event === 'SIGNED_OUT') {
        setUser(null)
        setProfile(null)
        hasLoadedRef.current = false
        router.replace("/auth/login")
      }
    })

    return () => {
      isMounted = false
      clearTimeout(safetyTimer)
      subscription.unsubscribe()
    }
  }, [router])

  const handleSignOut = async () => {
    if (isSigningOut) return

    setIsSigningOut(true)
    try {
      const supabase = createClient()
      await supabase.auth.signOut()
      localStorage.clear()
      sessionStorage.clear()
      window.location.replace('/')
    } catch (error) {
      console.error('ë¡œê·¸ì•„ì›ƒ ì˜¤ë¥˜:', error)
      setIsSigningOut(false)
    }
  }

  // ê°•ë ¥ ì´ˆê¸°í™” í•¨ìˆ˜ (ë°°í¬ í™˜ê²½ ë””ë²„ê¹…ìš©)
  const handleResetAuth = () => {
    if (confirm("ë¡œê·¸ì¸ ì •ë³´ë¥¼ ì´ˆê¸°í™”í•˜ê³  ë‹¤ì‹œ ë¡œê·¸ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
      try {
        localStorage.clear()
        sessionStorage.clear()
        // ì¿ í‚¤ë„ ê°€ëŠ¥í•œ ë²”ìœ„ì—ì„œ ì‚­ì œ ì‹œë„
        document.cookie.split(";").forEach(function (c) {
          document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/");
        });
        window.location.href = "/auth/login"
      } catch (e) {
        console.error("Reset failed", e)
        window.location.href = "/auth/login"
      }
    }
  }

  // ì„œë²„/í´ë¼ì´ì–¸íŠ¸ hydration ì¼ì¹˜ë¥¼ ìœ„í•´ mounted ì „ì—ëŠ” ë¡œë”© UI í‘œì‹œ
  if (!mounted || loading) {
    return (
      <div className="flex min-h-[calc(100vh-4rem)] items-center justify-center bg-slate-50 flex-col gap-4">
        <Loader2 className="h-8 w-8 text-indigo-600 animate-spin" />
        <span className="text-sm text-slate-500">í”„ë¡œí•„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</span>
      </div>
    )
  }

  // ì„¸ì…˜ ì—ëŸ¬ ì‹œ ì¬ì‹œë„ UI í‘œì‹œ
  if (sessionError) {
    return (
      <div className="flex min-h-[calc(100vh-4rem)] items-center justify-center bg-slate-50">
        <div className="text-center p-8 max-w-md">
          <div className="w-16 h-16 mx-auto mb-4 rounded-full bg-amber-100 flex items-center justify-center">
            <Info className="h-8 w-8 text-amber-600" />
          </div>
          <h2 className="text-lg font-bold text-slate-900 mb-2">ì—°ê²° ì§€ì—°</h2>
          <p className="text-slate-600 mb-6">{sessionError}</p>

          <div className="flex gap-3 justify-center">
            <Button
              onClick={() => window.location.reload()}
              className="bg-slate-900 hover:bg-slate-800 text-white"
            >
              ë‹¤ì‹œ ì‹œë„
            </Button>
            <Button
              variant="destructive"
              onClick={handleResetAuth}
            >
              ì´ˆê¸°í™” ë° ì¬ë¡œê·¸ì¸
            </Button>
            <Button
              variant="outline"
              onClick={() => router.push("/")}
            >
              í™ˆìœ¼ë¡œ
            </Button>
          </div>
        </div>
      </div>
    )
  }

  if (!user) return null

  const StatCard = ({
    title,
    count,
    type,
    icon: Icon,
  }: {
    title: string,
    count: number,
    type: TabType,
    icon: LucideIcon,
  }) => (
    <div
      onClick={() => setActiveTab(type)}
      className={cn(
        "relative overflow-hidden rounded-xl border p-5 cursor-pointer transition-all duration-200 hover:shadow-md hover:-translate-y-0.5 group bg-white",
        activeTab === type ? "ring-2 ring-indigo-600 border-transparent shadow-md" : "border-slate-200"
      )}
    >
      <div className="flex justify-between items-start mb-2">
        <h3 className="text-sm font-medium text-slate-500">{title}</h3>
        <div className={cn("p-2 rounded-full bg-slate-50 text-slate-400 group-hover:text-indigo-600 transition-colors", activeTab === type && "bg-indigo-50 text-indigo-600")}>
          <Icon className="h-4 w-4" />
        </div>
      </div>
      <div className="flex items-baseline gap-1">
        <span className="text-3xl font-bold text-slate-900">{count}</span>
        <span className="text-xs text-slate-400 ml-1">ê±´</span>
      </div>
    </div>
  )

  const renderBadges = () => (
    <div className="flex flex-col gap-2 w-full">
      {visibleBadges.length > 0 ? (
        visibleBadges.slice(0, 3).map((badge, index) => (
          <div key={index} className="flex items-center justify-center gap-2 rounded-lg bg-slate-50 px-3 py-2.5 text-sm font-medium border border-slate-200 w-full text-slate-700">
            <span className="text-lg">{badge.icon}</span>
            <span>{badge.name}</span>
          </div>
        ))
      ) : (
        <p className="text-sm text-slate-500 text-center w-full py-2">ë…¸ì¶œ ì¤‘ì¸ ì¸ì¦ ë±ƒì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
      )}
    </div>
  )

  const handleSaveProfile = async () => {
    if (!editForm.full_name.trim()) {
      alert("ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.")
      return
    }

    setIsSaving(true)
    try {
      const result = await updateProfileInfo({
        full_name: editForm.full_name,
        company: editForm.company,
        position: editForm.position,
        company_2: editForm.company_2,
        position_2: editForm.position_2,
        tagline: editForm.tagline,
        introduction: editForm.introduction,
        member_type: editForm.member_type,
        is_profile_public: editForm.is_profile_public,
      })

      if (!result.success) {
        const errorMessage = result.error || "ì„œë²„ ì €ì¥ ì‹¤íŒ¨"
        throw new Error(errorMessage)
      }

      setProfile((prev) => {
        if (!prev) return prev
        return {
          ...prev,
          full_name: editForm.full_name,
          company: editForm.company,
          position: editForm.position,
          company_2: editForm.company_2,
          position_2: editForm.position_2,
          tagline: editForm.tagline,
          introduction: editForm.introduction,
          member_type: editForm.member_type,
          is_profile_public: editForm.is_profile_public,
        }
      })

      setShowProfileEdit(false)
      alert("í”„ë¡œí•„ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.")
    } catch (error) {
      console.error("Profile save failed:", error)
      const errorMessage = error instanceof Error ? error.message : "í”„ë¡œí•„ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”."
      alert(`í”„ë¡œí•„ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\n\nì˜¤ë¥˜: ${errorMessage}`)
    } finally {
      setIsSaving(false)
    }
  }

  const handleToggleProfileVisibility = async (isPublic: boolean) => {
    try {
      const { updateProfileVisibility } = await import("@/lib/actions/user")
      await updateProfileVisibility(isPublic)

      setProfile((prev) => {
        if (!prev) return prev
        return { ...prev, is_profile_public: isPublic }
      })
    } catch (error) {
      console.error("Failed to update profile visibility:", error)
      setEditForm(prev => ({ ...prev, is_profile_public: !isPublic }))
    }
  }

  // ë±ƒì§€ë³„ í•„ìš”í•œ ì¦ë¹™ì„œë¥˜ ì•ˆë‚´ í•¨ìˆ˜
  const getRequiredDocuments = (badgeId: string | null): string[] => {
    if (!badgeId) return []

    const badge = allBadges.find(b => b.id === badgeId)
    if (!badge) return []

    const { name, category } = badge

    // ì¹´í…Œê³ ë¦¬ë³„ ê¸°ë³¸ ì•ˆë‚´
    const categoryDocs: Record<string, string[]> = {
      corporate_revenue: ['ì†ìµê³„ì‚°ì„œ', 'ë²•ì¸ì„¸ ì‹ ê³ ì„œ', 'ì¬ë¬´ì œí‘œ', 'ì‚¬ì—…ìë“±ë¡ì¦'],
      investment: ['ì¶œìì¦ì„œ', 'íˆ¬ìê³„ì•½ì„œ', 'ì£¼ì‹ì¸ìˆ˜ì¦ëª…ì„œ', 'íˆ¬ìì§‘í–‰ì¦ëª…ì„œ'],
      valuation: ['íˆ¬ììœ ì¹˜ê³„ì•½ì„œ', 'ê¸°ì—…ê°€ì¹˜í‰ê°€ì„œ', 'ì£¼ì‹ì¸ìˆ˜ê³„ì•½ì„œ', 'íˆ¬ìê³µê³ ë¬¸', 'ì–¸ë¡ ë³´ë„', 'ì£¼ì£¼ëª…ë¶€'],
      influence: ['SNS ê³„ì • ìŠ¤í¬ë¦°ìƒ·', 'íŒ”ë¡œì›Œ ìˆ˜ í™•ì¸ ê°€ëŠ¥í•œ í™”ë©´'],
      professional: ['ìê²©ì¦ ì‚¬ë³¸', 'ë©´í—ˆì¦ ì‚¬ë³¸', 'ìê²© ì¸ì¦ì„œ'],
      community: [] // ì»¤ë®¤ë‹ˆí‹° ë±ƒì§€ëŠ” ìë™ ë¶€ì—¬
    }

    // íŠ¹ì • ë±ƒì§€ì— ëŒ€í•œ ì¶”ê°€ ì•ˆë‚´
    const specificDocs: Record<string, string[]> = {
      'ë³€í˜¸ì‚¬': ['ë³€í˜¸ì‚¬ ìê²©ì¦', 'ë³€í˜¸ì‚¬ ë“±ë¡ì¦'],
      'ê³µì¸íšŒê³„ì‚¬': ['ê³µì¸íšŒê³„ì‚¬ ìê²©ì¦', 'íšŒê³„ì‚¬ ë“±ë¡ì¦'],
      'ì„¸ë¬´ì‚¬': ['ì„¸ë¬´ì‚¬ ìê²©ì¦', 'ì„¸ë¬´ì‚¬ ë“±ë¡ì¦'],
      'ë³€ë¦¬ì‚¬': ['ë³€ë¦¬ì‚¬ ìê²©ì¦', 'ë³€ë¦¬ì‚¬ ë“±ë¡ì¦'],
      'ë…¸ë¬´ì‚¬': ['ê³µì¸ë…¸ë¬´ì‚¬ ìê²©ì¦', 'ë…¸ë¬´ì‚¬ ë“±ë¡ì¦'],
      'ì˜ì‚¬': ['ì˜ì‚¬ ë©´í—ˆì¦'],
      'í•œì˜ì‚¬': ['í•œì˜ì‚¬ ë©´í—ˆì¦'],
      'ìˆ˜ì˜ì‚¬': ['ìˆ˜ì˜ì‚¬ ë©´í—ˆì¦'],
      'ì•½ì‚¬': ['ì•½ì‚¬ ë©´í—ˆì¦'],
    }

    // íŠ¹ì • ë±ƒì§€ì— ëŒ€í•œ ì•ˆë‚´ê°€ ìˆìœ¼ë©´ ìš°ì„  ì‚¬ìš©
    if (specificDocs[name]) {
      return specificDocs[name]
    }

    // ì¹´í…Œê³ ë¦¬ë³„ ê¸°ë³¸ ì•ˆë‚´ ì‚¬ìš©
    return categoryDocs[category] || []
  }

  const handleRequestBadge = async () => {
    if (!selectedBadgeId || !user || (!badgeEvidence.trim() && !badgeProofFile)) {
      alert("ì¦ë¹™ ìë£Œë¥¼ ì…ë ¥í•˜ê±°ë‚˜ íŒŒì¼ì„ ì²¨ë¶€í•´ì£¼ì„¸ìš”.")
      return
    }

    const existingBadge = userBadges.find((ub) => ub.badge_id === selectedBadgeId)
    if (existingBadge) {
      alert("ì´ë¯¸ ì‹ ì²­í•˜ê±°ë‚˜ ë¶€ì—¬ëœ ë±ƒì§€ì…ë‹ˆë‹¤.")
      return
    }

    setAddingBadge(true)
    try {
      const supabase = createClient()
      let proofUrl = null

      if (badgeProofFile) {
        const formData = new FormData()
        formData.append("file", badgeProofFile)

        const uploadResponse = await fetch("/api/upload", {
          method: "POST",
          body: formData,
        })

        if (!uploadResponse.ok) {
          throw new Error("íŒŒì¼ ì—…ë¡œë“œ ì‹¤íŒ¨")
        }

        const uploadData = await uploadResponse.json()
        proofUrl = uploadData.url
      }

      const { requestBadge } = await import("@/lib/actions/badges")
      await requestBadge(user.id, selectedBadgeId, badgeEvidence, proofUrl)

      const { data } = await supabase
        .from("user_badges")
        .select(`
          id,
          badge_id,
          is_visible,
          status,
          evidence,
          badges:badge_id (
            id,
            name,
            icon,
            category,
            description
          )
        `)
        .eq("user_id", user.id)
        .order("created_at", { ascending: false })

      if (data) {
        setUserBadges(data as unknown as UserBadgeWithBadge[])
        const visible: VisibleBadge[] = data
          .filter((ub) => ub.is_visible && ub.badges && ub.status === 'approved')
          .map((ub) => {
            const badge = Array.isArray(ub.badges) ? ub.badges[0] : ub.badges
            return {
              icon: badge?.icon || "",
              name: badge?.name || "",
            }
          })
        setVisibleBadges(visible)
      }

      setSelectedBadgeId("")
      setBadgeEvidence("")
      setBadgeProofFile(null)
      setShowBadgeRequestDialog(false)
      alert("ë±ƒì§€ ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ê²€í†  í›„ ìŠ¹ì¸ë˜ë©´ í”„ë¡œí•„ì— ë…¸ì¶œë©ë‹ˆë‹¤.")
    } catch (error) {
      console.error("Failed to request badge:", error)
      const errorMessage = error instanceof Error ? error.message : "ë±ƒì§€ ì‹ ì²­ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."
      alert(errorMessage)
    } finally {
      setAddingBadge(false)
    }
  }

  const handleRemoveBadge = async (userBadgeId: string) => {
    if (!showProfileEdit) return

    if (!confirm("ë±ƒì§€ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return

    try {
      await removeBadge(userBadgeId)

      if (user) {
        const supabase = createClient()
        const { data } = await supabase
          .from("user_badges")
          .select(`
            id,
            badge_id,
            is_visible,
            status,
            evidence,
            badges:badge_id (
              id,
              name,
              icon,
              category,
              description
            )
          `)
          .eq("user_id", user.id)
          .order("created_at", { ascending: false })

        if (data) {
          setUserBadges(data as unknown as UserBadgeWithBadge[])
          const visible: VisibleBadge[] = data
            .filter((ub) => ub.is_visible && ub.badges)
            .map((ub) => {
              const badge = Array.isArray(ub.badges) ? ub.badges[0] : ub.badges
              return {
                icon: badge?.icon || "",
                name: badge?.name || "",
              }
            })
          setVisibleBadges(visible)
        }
      }
    } catch (error) {
      console.error("Failed to remove badge:", error)
      const errorMessage = error instanceof Error ? error.message : "ë±ƒì§€ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."
      alert(errorMessage)
    }
  }

  const handleOpenProfileEdit = async () => {
    setShowProfileEdit(true)

    if (user) {
      const supabase = createClient()
      const [userBadgesResult, allBadgesResult] = await Promise.all([
        supabase
          .from("user_badges")
          .select(`
            id,
            badge_id,
            is_visible,
            status,
            evidence,
            badges:badge_id (
              id,
              name,
              icon,
              category,
              description,
              is_active
            )
          `)
          .eq("user_id", user.id)
          .order("created_at", { ascending: false }),
        supabase
          .from("badges")
          .select("id, name, icon, category, description")
          .or("is_active.eq.true,is_active.is.null") // í™œì„±í™”ëœ ë±ƒì§€ë§Œ ì¡°íšŒ (true ë˜ëŠ” null)
          .order("category", { ascending: true })
          .order("name", { ascending: true })
      ])

      if (userBadgesResult.data) {
        // Filter out inactive badges from user's badges in edit mode
        const activeUserBadges = userBadgesResult.data.filter((ub: any) =>
          !ub.badges || ub.badges.is_active !== false
        )
        setUserBadges(activeUserBadges as unknown as UserBadgeWithBadge[])
      }
      if (allBadgesResult.data) {
        setAllBadges(allBadgesResult.data as unknown as BadgeType[])
      }
    }
  }

  const handleAvatarUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0]
    if (!file) return

    if (!file.type.startsWith("image/")) {
      alert("ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.")
      return
    }

    setIsUploading(true)
    try {
      const formData = new FormData()
      formData.append("file", file)

      const uploadResponse = await fetch("/api/upload", {
        method: "POST",
        body: formData,
      })

      if (!uploadResponse.ok) {
        let errorMessage = "ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨"
        try {
          const errorData = await uploadResponse.json()
          errorMessage = errorData.error || errorMessage
        } catch {
          const errorText = await uploadResponse.text()
          errorMessage = errorText || errorMessage
        }
        throw new Error(errorMessage)
      }

      const uploadData = await uploadResponse.json()

      if (!uploadData.url) {
        throw new Error("ì—…ë¡œë“œëœ ì´ë¯¸ì§€ URLì„ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.")
      }

      await updateProfileAvatar(uploadData.url)

      setProfile((prev) => {
        if (!prev) return prev
        return {
          ...prev,
          avatar_url: uploadData.url,
        }
      })

      // í”„ë¡œí•„ ì‚¬ì§„ ì—…ë°ì´íŠ¸ í›„ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
      router.refresh()
    } catch (error) {
      console.error("Avatar upload error:", error)
      const errorMessage = error instanceof Error ? error.message : "í”„ë¡œí•„ ì´ë¯¸ì§€ ì—…ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."
      alert(`í”„ë¡œí•„ ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨\n\n${errorMessage}`)
    } finally {
      setIsUploading(false)
    }
  }

  const mainContent = (
    <div className="flex flex-col gap-6">
      <div className="flex items-center justify-between">
        <h1 className="text-2xl md:text-3xl font-bold tracking-tight text-slate-900">ë‚´ í”„ë¡œí•„</h1>
      </div>

      <div className="grid gap-6 md:grid-cols-12">

        {/* 1. ì™¼ìª½ ì»¬ëŸ¼ (í”„ë¡œí•„ ì¹´ë“œ) */}
        <div className="md:col-span-5 lg:col-span-5 xl:col-span-4 flex flex-col gap-4">

          {/* ìƒë‹¨: í”„ë¡œí•„ ì •ë³´ ì¹´ë“œ */}
          <Card className="border-slate-200 bg-white shadow-sm overflow-hidden h-fit">
            <CardContent className="p-8 flex flex-col items-center text-center bg-white">

              <div className="mb-6 relative group">
                <input
                  type="file"
                  accept="image/*"
                  onChange={handleAvatarUpload}
                  className="hidden"
                  id="avatar-upload"
                  disabled={isUploading}
                />
                <label
                  htmlFor="avatar-upload"
                  className="cursor-pointer block relative"
                >
                  <div className="h-32 w-32 rounded-full border-4 border-white shadow-lg overflow-hidden bg-slate-100 relative">
                    {profile?.avatar_url ? (
                      <Image
                        src={profile.avatar_url}
                        alt={profile.full_name || "Profile"}
                        width={256}
                        height={256}
                        quality={100}
                        priority
                        unoptimized
                        className="object-cover h-full w-full"
                      />
                    ) : (
                      <Image
                        src={`https://api.dicebear.com/9.x/notionists/svg?seed=${profile?.full_name || user.email}`}
                        alt={profile?.full_name || "Profile"}
                        width={256}
                        height={256}
                        quality={100}
                        priority
                        unoptimized
                        className="object-cover h-full w-full bg-slate-50"
                      />
                    )}
                    <div className="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                      {isUploading ? (
                        <Loader2 className="h-8 w-8 text-white animate-spin" />
                      ) : (
                        <Camera className="h-8 w-8 text-white" />
                      )}
                    </div>
                  </div>
                </label>
                <div className="absolute bottom-0 right-0 bg-slate-900 text-white text-[10px] font-bold px-2 py-1 rounded-full border-2 border-white shadow-sm">
                  {profile?.role?.toUpperCase() || "MEMBER"}
                </div>
              </div>

              <h2 className="text-2xl font-bold text-slate-900 mb-1">
                {profile?.full_name || "ì´ë¦„ ì—†ìŒ"}
              </h2>
              <p className="text-slate-500 text-sm mb-2 flex items-center justify-center gap-1.5">
                <Mail className="h-3.5 w-3.5" />
                {user.email}
              </p>

              {(profile?.company || profile?.position || profile?.company_2 || profile?.position_2) && (
                <div className="flex flex-col gap-1 items-center">
                  {(profile?.company || profile?.position) && (
                    <p className="text-slate-600 text-sm">
                      {profile?.company}
                      {profile?.company && profile?.position && " Â· "}
                      {profile?.position}
                    </p>
                  )}
                  {(profile?.company_2 || profile?.position_2) && (
                    <p className="text-slate-600 text-sm">
                      {profile?.company_2}
                      {profile?.company_2 && profile?.position_2 && " Â· "}
                      {profile?.position_2}
                    </p>
                  )}
                </div>
              )}

              {profile?.roles && profile.roles.length > 0 && (
                <div className="flex flex-wrap gap-2 justify-center mb-2">
                  {profile.roles.map((role: string) => (
                    <span
                      key={role}
                      className="px-2 py-0.5 rounded-full bg-blue-100 text-blue-700 text-xs font-medium"
                    >
                      {role}
                    </span>
                  ))}
                </div>
              )}

              {profile?.introduction && (
                <p className="text-slate-600 text-sm mb-4 text-center whitespace-pre-line">
                  {profile.introduction}
                </p>
              )}

              <Separator className="w-full mb-6" />

              <Button
                variant="outline"
                size="sm"
                onClick={handleOpenProfileEdit}
                className="w-full mb-6"
              >
                <Edit3 className="h-4 w-4 mr-2" />
                í”„ë¡œí•„ í¸ì§‘
              </Button>

              <div className="w-full space-y-3">
                <div className="flex items-center gap-2 mb-3">
                  <Medal className="h-4 w-4 text-slate-900" />
                  <span className="text-sm font-bold text-slate-900">ë‚´ ë±ƒì§€</span>
                </div>

                <div className="bg-white rounded-xl p-4 min-h-[80px] flex flex-wrap gap-2 justify-center md:justify-start border border-slate-200">
                  {renderBadges()}
                </div>
              </div>

              <div className="mt-6 text-xs text-slate-400 flex items-center gap-1">
                <Calendar className="h-3 w-3" />
                <span suppressHydrationWarning>ê°€ì…ì¼: {new Date(user.created_at).toLocaleDateString()}</span>
              </div>
            </CardContent>
          </Card>

          {/* í•˜ë‹¨: ë³„ë„ ë¡œê·¸ì•„ì›ƒ ì¹´ë“œ */}
          <Card className="border-red-100 bg-red-50/10 shadow-sm overflow-hidden hover:border-red-200 transition-colors">
            <CardContent className="p-0">
              <Button
                onClick={handleSignOut}
                disabled={isSigningOut}
                variant="ghost"
                className="w-full h-12 rounded-none text-red-600 hover:text-red-700 hover:bg-red-50 font-medium flex items-center justify-center gap-2"
              >
                <LogOut className="h-4 w-4" />
                {isSigningOut ? "ë¡œê·¸ì•„ì›ƒ ì¤‘..." : "ë¡œê·¸ì•„ì›ƒ"}
              </Button>
            </CardContent>
          </Card>

        </div>

        {/* 2. ì˜¤ë¥¸ìª½ ì»¬ëŸ¼ (í†µê³„ ë° ë¦¬ìŠ¤íŠ¸) */}
        <div className="md:col-span-7 lg:col-span-7 xl:col-span-8 space-y-6">

          <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
            <StatCard
              title="ì‘ì„±í•œ ê²Œì‹œê¸€"
              count={userPosts.length}
              type="posts"
              icon={Edit3}
            />
            <StatCard
              title="ë§Œë“  ì´ë²¤íŠ¸"
              count={createdEvents.length}
              type="created_events"
              icon={CalendarDays}
            />
            <StatCard
              title="ì°¸ì„ ì‹ ì²­"
              count={registeredEvents.length}
              type="participated_events"
              icon={Ticket}
            />
          </div>

          <Card className="border-slate-200 bg-white shadow-sm min-h-[400px]">
            <CardContent className="p-0">
              <div className="px-6 py-4 border-b border-slate-100">
                <h2 className="text-lg font-bold text-slate-900 flex items-center gap-2">
                  {activeTab === "posts" && <><Edit3 className="h-5 w-5 text-indigo-600" /> ì‘ì„±í•œ ê²Œì‹œê¸€</>}
                  {activeTab === "created_events" && <><CalendarDays className="h-5 w-5 text-indigo-600" /> ë§Œë“  ì´ë²¤íŠ¸</>}
                  {activeTab === "participated_events" && <><Ticket className="h-5 w-5 text-indigo-600" /> ì°¸ì„ ì‹ ì²­</>}
                </h2>
              </div>

              <div className="min-h-[300px]">
                {activeTab === "posts" && (
                  <div className="flex flex-col">
                    {userPosts.length > 0 ? (
                      userPosts.map((post) => (
                        <PostListItem post={post} key={post.id} />
                      ))
                    ) : (
                      <EmptyState message="ì‘ì„±í•œ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤." />
                    )}
                  </div>
                )}

                {activeTab === "created_events" && (
                  <div className="flex flex-col">
                    {createdEvents.length > 0 ? (
                      createdEvents.map((event) => (
                        <EventListItem event={event} key={event.id} />
                      ))
                    ) : (
                      <EmptyState message="ë§Œë“  ì´ë²¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤." />
                    )}
                  </div>
                )}

                {activeTab === "participated_events" && (
                  <div className="flex flex-col">
                    {registeredEvents.length > 0 ? (
                      registeredEvents.map((event) => (
                        <EventListItem event={event} key={event.id} />
                      ))
                    ) : (
                      <EmptyState message="ì°¸ì„ ì‹ ì²­í•œ ì´ë²¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤." />
                    )}
                  </div>
                )}
              </div>
            </CardContent>
          </Card>
        </div>
      </div>
    </div>
  )

  return (
    <>
      <Dialog open={showBadgeManager} onOpenChange={setShowBadgeManager}>
        <DialogContent className="sm:max-w-lg bg-white rounded-xl">
          <DialogHeader>
            <DialogTitle className="text-lg font-bold flex items-center gap-2">
              <Medal className="h-5 w-5 text-slate-700" />
              ë±ƒì§€ ê´€ë¦¬ ë° ë…¸ì¶œ ì„¤ì •
            </DialogTitle>
          </DialogHeader>
          <div className="mt-6">
            <BadgeManager userId={user.id} />
          </div>
        </DialogContent>
      </Dialog>

      <Dialog open={showBadgeRequestDialog} onOpenChange={setShowBadgeRequestDialog}>
        <DialogContent className="sm:max-w-lg bg-white rounded-xl max-h-[90vh] overflow-y-auto">
          <DialogHeader>
            <DialogTitle className="text-lg font-bold">
              ë±ƒì§€ ë°œê¸‰ ì‹ ì²­
            </DialogTitle>
            <DialogDescription className="text-sm text-slate-500">
              ì‹ ì²­í•  ë±ƒì§€ë¥¼ ì„ íƒí•˜ê³  ì¦ë¹™ ìë£Œë¥¼ ì œì¶œí•´ì£¼ì„¸ìš”.
            </DialogDescription>
          </DialogHeader>
          <div className="mt-6 space-y-6">
            {/* ë±ƒì§€ ì„ íƒ */}
            <div>
              <Label className="mb-3 block text-slate-700">
                ì‹ ì²­í•  ë±ƒì§€ ì„ íƒ <span className="text-red-500">*</span>
              </Label>
              <div className="max-h-[400px] overflow-y-auto border border-slate-200 rounded-lg p-4 bg-slate-50">
                {(() => {
                  const availableBadges = allBadges.filter(
                    (badge) => !userBadges.some((ub) => ub.badge_id === badge.id)
                  )

                  // ë±ƒì§€ ì´ë¦„ì—ì„œ ìˆ«ì ì¶”ì¶œ í•¨ìˆ˜
                  const extractNumber = (badgeName: string): number => {
                    // ìœ ë‹ˆì½˜ì€ ê°€ì¥ í° ìˆ«ìë¡œ ì²˜ë¦¬ (ì •ë ¬ ì‹œ ë§ˆì§€ë§‰ì— ì˜¤ë„ë¡)
                    if (badgeName.includes('ìœ ë‹ˆì½˜')) return Infinity

                    // ìˆ«ìì™€ ë‹¨ìœ„(ì–µ, ë§Œ, ì¡° ë“±) ì¶”ì¶œ
                    const match = badgeName.match(/(\d+(?:\.\d+)?)\s*(ì–µ|ë§Œ|ì¡°|ë§Œ\+|ì–µ\+|ì¡°\+)/)
                    if (!match) return 0

                    const num = parseFloat(match[1])
                    const unit = match[2]

                    // ë‹¨ìœ„ë¥¼ ìˆ«ìë¡œ ë³€í™˜
                    if (unit.includes('ì¡°')) return num * 1000000000000
                    if (unit.includes('ì–µ')) return num * 100000000
                    if (unit.includes('ë§Œ')) return num * 10000
                    return num
                  }

                  // ì¹´í…Œê³ ë¦¬ë³„ë¡œ ê·¸ë£¹í™”í•˜ê³  ì •ë ¬
                  const groupedBadges = availableBadges.reduce((acc, badge) => {
                    const category = badge.category || 'ê¸°íƒ€'
                    if (!acc[category]) {
                      acc[category] = []
                    }
                    acc[category].push(badge)
                    return acc
                  }, {} as Record<string, typeof availableBadges>)

                  // ê° ì¹´í…Œê³ ë¦¬ ë‚´ì—ì„œ ìˆ«ì ìˆœì„œë¡œ ì •ë ¬ (ìœ ë‹ˆì½˜ì€ ë§ˆì§€ë§‰)
                  Object.keys(groupedBadges).forEach(category => {
                    groupedBadges[category].sort((a, b) => {
                      const numA = extractNumber(a.name)
                      const numB = extractNumber(b.name)
                      // InfinityëŠ” í•­ìƒ ë§ˆì§€ë§‰ì— ì˜¤ë„ë¡
                      if (numA === Infinity && numB === Infinity) return 0
                      if (numA === Infinity) return 1
                      if (numB === Infinity) return -1
                      return numA - numB
                    })
                  })

                  const categoryLabels: Record<string, string> = {
                    corporate_revenue: 'ê¸°ì—… ë§¤ì¶œ',
                    investment: 'íˆ¬ì ê·œëª¨',
                    valuation: 'ê¸°ì—…ê°€ì¹˜',
                    influence: 'ì¸í”Œë£¨ì–¸ì„œ',
                    professional: 'ì „ë¬¸ì§',
                    community: 'ì»¤ë®¤ë‹ˆí‹°',
                  }

                  if (availableBadges.length === 0) {
                    return (
                      <div className="text-center py-8 text-slate-500 text-sm">
                        ì‹ ì²­ ê°€ëŠ¥í•œ ë±ƒì§€ê°€ ì—†ìŠµë‹ˆë‹¤.
                      </div>
                    )
                  }

                  return (
                    <div className="space-y-4">
                      {Object.entries(groupedBadges).map(([category, badges]) => (
                        <div key={category}>
                          <h4 className="text-xs font-semibold text-slate-500 uppercase tracking-wide mb-2">
                            {categoryLabels[category] || category}
                          </h4>
                          <div className="grid grid-cols-2 gap-2">
                            {badges.map((badge) => (
                              <button
                                key={badge.id}
                                type="button"
                                onClick={() => setSelectedBadgeId(badge.id)}
                                className={cn(
                                  "flex items-center gap-2 p-3 rounded-lg border-2 transition-all text-left",
                                  selectedBadgeId === badge.id
                                    ? "border-slate-900 bg-slate-900 text-white"
                                    : "border-slate-200 bg-white hover:border-slate-300 hover:bg-slate-50"
                                )}
                              >
                                <span className="text-lg">{badge.icon}</span>
                                <span className="text-sm font-medium flex-1">{badge.name}</span>
                                {selectedBadgeId === badge.id && (
                                  <span className="text-white">âœ“</span>
                                )}
                              </button>
                            ))}
                          </div>
                        </div>
                      ))}
                    </div>
                  )
                })()}
              </div>
            </div>

            {/* í•„ìš”í•œ ì¦ë¹™ì„œë¥˜ ì•ˆë‚´ */}
            {selectedBadgeId && getRequiredDocuments(selectedBadgeId).length > 0 && (
              <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                <div className="flex items-start gap-2">
                  <Info className="h-5 w-5 text-blue-600 shrink-0 mt-0.5" />
                  <div className="flex-1">
                    <h4 className="text-sm font-semibold text-blue-900 mb-2">
                      í•„ìš”í•œ ì¦ë¹™ì„œë¥˜
                    </h4>
                    <ul className="text-sm text-blue-800 space-y-1">
                      {getRequiredDocuments(selectedBadgeId).map((doc, idx) => (
                        <li key={idx} className="flex items-center gap-2">
                          <span className="text-blue-500">â€¢</span>
                          <span>{doc}</span>
                        </li>
                      ))}
                    </ul>
                    <p className="text-xs text-blue-700 mt-2">
                      ìœ„ ì¦ë¹™ì„œë¥˜ ì¤‘ í•˜ë‚˜ ì´ìƒì„ ì²¨ë¶€í•˜ê±°ë‚˜ ë§í¬ë¡œ ì œê³µí•´ì£¼ì„¸ìš”.
                    </p>
                  </div>
                </div>
              </div>
            )}

            {/* ì¦ë¹™ ìë£Œ ì…ë ¥ */}
            <div>
              <Label htmlFor="badge_evidence" className="mb-2 block text-slate-700">
                ì¦ë¹™ ìë£Œ <span className="text-red-500">*</span>
              </Label>
              <Textarea
                id="badge_evidence"
                value={badgeEvidence}
                onChange={(e) => setBadgeEvidence(e.target.value)}
                placeholder={
                  selectedBadgeId && getRequiredDocuments(selectedBadgeId).length > 0
                    ? `ì˜ˆ: ${getRequiredDocuments(selectedBadgeId)[0]} ë§í¬ ë˜ëŠ” ì„¤ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”`
                    : "ì˜ˆ: ë§í¬, ì„¤ëª…, ì°¸ê³  ìë£Œ ë“±ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"
                }
                rows={5}
                className="bg-white border-slate-200 focus-visible:ring-slate-900 resize-none mb-3"
              />

              <div className="space-y-2">
                <div className="flex items-center gap-3">
                  <input
                    type="file"
                    id="badge-proof-file"
                    className="hidden"
                    accept=".jpg,.jpeg,.png,.pdf"
                    onChange={(e) => {
                      const file = e.target.files?.[0]
                      if (file) {
                        // íŒŒì¼ í™•ì¥ì ê²€ì¦
                        const allowedExtensions = ['.jpg', '.jpeg', '.png', '.pdf']
                        const fileExtension = '.' + file.name.split('.').pop()?.toLowerCase()
                        if (!allowedExtensions.includes(fileExtension)) {
                          alert('JPG, JPEG, PNG, PDF íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.')
                          e.target.value = ''
                          return
                        }
                        // íŒŒì¼ í¬ê¸° ê²€ì¦ (10MB)
                        const maxSize = 10 * 1024 * 1024
                        if (file.size > maxSize) {
                          alert('íŒŒì¼ í¬ê¸°ëŠ” 10MBë¥¼ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')
                          e.target.value = ''
                          return
                        }
                        setBadgeProofFile(file)
                      }
                    }}
                  />
                  <Label
                    htmlFor="badge-proof-file"
                    className="cursor-pointer flex items-center gap-2 px-3 py-2 rounded-lg border border-slate-200 bg-slate-50 hover:bg-slate-100 transition-colors text-sm font-medium text-slate-600"
                  >
                    <Paperclip className="h-4 w-4" />
                    íŒŒì¼ ì²¨ë¶€
                  </Label>
                  {badgeProofFile && (
                    <div className="flex items-center gap-2 text-sm text-slate-600 bg-blue-50 px-3 py-2 rounded-lg border border-blue-100">
                      <FileText className="h-4 w-4 text-blue-600" />
                      <span className="truncate max-w-[200px]">{badgeProofFile.name}</span>
                      <button
                        onClick={() => setBadgeProofFile(null)}
                        className="ml-1 p-0.5 hover:bg-blue-100 rounded-full transition-colors"
                      >
                        <X className="h-3 w-3 text-slate-400 hover:text-red-500" />
                      </button>
                    </div>
                  )}
                </div>
                <p className="text-xs text-slate-500">
                  ì—…ë¡œë“œ ê°€ëŠ¥: JPG, JPEG, PNG, PDF (ìµœëŒ€ 10MB)
                </p>
              </div>
            </div>
            <div className="flex justify-end gap-2 pt-2">
              <Button
                variant="outline"
                onClick={() => {
                  setShowBadgeRequestDialog(false)
                  setBadgeEvidence("")
                  setBadgeProofFile(null)
                }}
                className="h-11 px-6"
              >
                ì·¨ì†Œ
              </Button>
              <Button
                onClick={handleRequestBadge}
                disabled={(!badgeEvidence.trim() && !badgeProofFile) || addingBadge}
                className={cn(
                  "h-11 px-8 font-bold transition-all",
                  "bg-slate-900 hover:bg-slate-800 text-white shadow-md hover:shadow-lg",
                  addingBadge && "opacity-70 cursor-not-allowed"
                )}
              >
                {addingBadge ? (
                  <>
                    <Loader2 className="h-4 w-4 mr-2 animate-spin" />
                    ì œì¶œ ì¤‘...
                  </>
                ) : (
                  "ì œì¶œí•˜ê¸°"
                )}
              </Button>
            </div>
          </div>
        </DialogContent>
      </Dialog>

      <Dialog open={showProfileEdit} onOpenChange={setShowProfileEdit} modal={false}>
        <DialogContent className="sm:max-w-lg bg-white rounded-xl max-h-[85vh] overflow-y-auto">
          <DialogHeader>
            <DialogTitle className="text-lg font-bold">í”„ë¡œí•„ í¸ì§‘</DialogTitle>
            <DialogDescription className="text-sm text-slate-500">
              ë‹¤ë¥¸ ë©¤ë²„ë“¤ì—ê²Œ ë³´ì—¬ì§ˆ í”„ë¡œí•„ ì •ë³´ë¥¼ ìˆ˜ì •í•©ë‹ˆë‹¤.
            </DialogDescription>
          </DialogHeader>
          <div className="mt-6 space-y-6">
            {/* ê¸°ë³¸ ì •ë³´ ì„¹ì…˜ */}
            <div className="space-y-4">
              <div>
                <Label htmlFor="full_name" className="mb-2 block text-sm font-semibold text-slate-900">ì´ë¦„ <span className="text-red-500">*</span></Label>
                <Input
                  id="full_name"
                  value={editForm.full_name}
                  onChange={(e) => setEditForm({ ...editForm, full_name: e.target.value })}
                  placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”"
                  className="bg-white border-slate-200 focus-visible:ring-slate-900 h-11"
                />
              </div>

              <div>
                <div className="flex gap-3">
                  <div className="flex-1">
                    <Label htmlFor="company" className="mb-2 block text-sm font-semibold text-slate-900">ì†Œì† 1</Label>
                    <Input
                      id="company"
                      value={editForm.company}
                      onChange={(e) => setEditForm({ ...editForm, company: e.target.value })}
                      placeholder="íšŒì‚¬ ë˜ëŠ” ì¡°ì§ëª…"
                      className="bg-white border-slate-200 focus-visible:ring-slate-900 h-11"
                    />
                  </div>
                  <div className="flex-1">
                    <Label htmlFor="position" className="mb-2 block text-sm font-semibold text-slate-900">ì§ì±… 1</Label>
                    <Input
                      id="position"
                      value={editForm.position}
                      onChange={(e) => setEditForm({ ...editForm, position: e.target.value })}
                      placeholder="ì˜ˆ: CEO"
                      className="bg-white border-slate-200 focus-visible:ring-slate-900 h-11"
                    />
                  </div>
                </div>
              </div>

              <div>
                <div className="flex gap-3">
                  <div className="flex-1">
                    <Label htmlFor="company_2" className="mb-2 block text-sm font-semibold text-slate-900">ì†Œì† 2 <span className="text-xs font-normal text-slate-500">(ì„ íƒ)</span></Label>
                    <Input
                      id="company_2"
                      value={editForm.company_2 || ""}
                      onChange={(e) => setEditForm({ ...editForm, company_2: e.target.value })}
                      placeholder="ì¶”ê°€ ì†Œì†"
                      className="bg-white border-slate-200 focus-visible:ring-slate-900 h-11"
                    />
                  </div>
                  <div className="flex-1">
                    <Label htmlFor="position_2" className="mb-2 block text-sm font-semibold text-slate-900">ì§ì±… 2 <span className="text-xs font-normal text-slate-500">(ì„ íƒ)</span></Label>
                    <Input
                      id="position_2"
                      value={editForm.position_2 || ""}
                      onChange={(e) => setEditForm({ ...editForm, position_2: e.target.value })}
                      placeholder="ì¶”ê°€ ì§ì±…"
                      className="bg-white border-slate-200 focus-visible:ring-slate-900 h-11"
                    />
                  </div>
                </div>
              </div>
            </div>

            {/* ì—­í•  ì„¹ì…˜ */}
            <div className="pt-2 border-t border-slate-100">
              <Label className="mb-3 block text-sm font-semibold text-slate-900">ì—­í•  <span className="text-xs font-normal text-slate-500">(ìµœëŒ€ 2ê°œ ì„ íƒ ê°€ëŠ¥)</span></Label>
              <div className="flex gap-2">
                {(["ì‚¬ì—…ê°€", "íˆ¬ìì", "í¬ë¦¬ì—ì´í„°"] as const).map((type) => {
                  const isSelected = editForm.member_type.includes(type)
                  const canSelect = !isSelected && editForm.member_type.length < 2

                  return (
                    <Button
                      key={type}
                      type="button"
                      variant={isSelected ? "default" : "outline"}
                      onClick={() => {
                        if (isSelected) {
                          // ì„ íƒ í•´ì œ
                          setEditForm({
                            ...editForm,
                            member_type: editForm.member_type.filter(t => t !== type)
                          })
                        } else if (canSelect) {
                          // ì„ íƒ ì¶”ê°€
                          setEditForm({
                            ...editForm,
                            member_type: [...editForm.member_type, type]
                          })
                        }
                      }}
                      disabled={!isSelected && !canSelect}
                      className={cn(
                        "flex-1 h-11",
                        isSelected
                          ? "bg-slate-900 hover:bg-slate-800 text-white"
                          : canSelect
                            ? "bg-white border-slate-200 text-slate-700 hover:bg-slate-50"
                            : "bg-white border-slate-200 text-slate-400 cursor-not-allowed opacity-50"
                      )}
                    >
                      {type}
                    </Button>
                  )
                })}
              </div>

              <Label htmlFor="tagline" className="mb-2 block text-sm font-semibold text-slate-900">ë‚˜ë¥¼ í‘œí˜„í•˜ëŠ” í•œë§ˆë””</Label>
              <Input
                id="tagline"
                value={editForm.tagline || ""}
                onChange={(e) => setEditForm({ ...editForm, tagline: e.target.value })}
                placeholder="ì˜ˆ) ì¢‹ì€ ì‚¬ëŒë“¤ê³¼ í•¨ê»˜ ì„±ì¥í•˜ëŠ” ì°½ì—…ê°€ì…ë‹ˆë‹¤."
                className="bg-white border-slate-200 focus-visible:ring-slate-900 h-11"
              />
            </div>

            {/* ìê¸°ì†Œê°œ ì„¹ì…˜ */}
            <div className="pt-2 border-t border-slate-100">
              <Label htmlFor="introduction" className="mb-2 block text-sm font-semibold text-slate-900">ìê¸°ì†Œê°œ</Label>
              <Textarea
                id="introduction"
                value={editForm.introduction}
                onChange={(e) => setEditForm({ ...editForm, introduction: e.target.value })}
                placeholder="ë‚˜ì˜ ê²½í—˜, ê´€ì‹¬ì‚¬, ì»¤ë®¤ë‹ˆí‹°ì—ì„œ í•˜ê³  ì‹¶ì€ í™œë™ ë“±ì„ ììœ ë¡­ê²Œ ì ì–´ì£¼ì„¸ìš”."
                rows={4}
                className="bg-white border-slate-200 focus-visible:ring-slate-900 resize-none"
              />
            </div>

            {/* í”„ë¡œí•„ ê³µê°œ ì„¤ì • */}
            <div className="pt-2 border-t border-slate-100">
              <div
                className="flex items-center justify-between p-4 border border-slate-200 rounded-lg cursor-pointer hover:bg-slate-50 transition-colors bg-white"
                onClick={() => {
                  const newValue = !editForm.is_profile_public
                  setEditForm(prev => ({ ...prev, is_profile_public: newValue }))
                  handleToggleProfileVisibility(newValue)
                }}
              >
                <div className="flex-1">
                  <Label className="text-sm font-semibold text-slate-900 cursor-pointer pointer-events-none">
                    ë©¤ë²„ ë¦¬ìŠ¤íŠ¸ì— ë‚´ í”„ë¡œí•„ì„ ê³µê°œí•©ë‹ˆë‹¤
                  </Label>
                  <p className="text-xs text-slate-500 mt-1 pointer-events-none">
                    ê³µê°œ ì‹œ ë©¤ë²„ í˜ì´ì§€ì—ì„œ í”„ë¡œí•„ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
                  </p>
                </div>
                <Switch
                  checked={editForm.is_profile_public}
                  onCheckedChange={(checked) => {
                    setEditForm(prev => ({ ...prev, is_profile_public: checked }))
                    handleToggleProfileVisibility(checked)
                  }}
                  className="data-[state=checked]:bg-slate-900 data-[state=unchecked]:bg-slate-300"
                />
              </div>
            </div>

            {/* ë±ƒì§€ ì„¹ì…˜ */}
            <div className="pt-2 border-t border-slate-100">
              <Label className="mb-2 block text-sm font-semibold text-slate-900">
                ë±ƒì§€ ë°œê¸‰ ì‹ ì²­
              </Label>
              <p className="text-xs text-slate-500 mb-4">
                ë‚˜ì˜ ì„±ê³¼ë¥¼ ì¦ëª…í•  ë±ƒì§€ë¥¼ ì‹ ì²­í•˜ì„¸ìš”. ì¦ë¹™ ìë£Œ ê²€í†  í›„ ìŠ¹ì¸ë˜ë©´ í”„ë¡œí•„ì— ë…¸ì¶œë©ë‹ˆë‹¤.
              </p>

              <Button
                onClick={() => {
                  setSelectedBadgeId("")
                  setBadgeEvidence("")
                  setBadgeProofFile(null)
                  setShowBadgeRequestDialog(true)
                }}
                disabled={addingBadge || userBadges.length >= 5}
                className="h-11 px-6 w-full border-2 border-slate-200 hover:border-slate-300 bg-white hover:bg-slate-50 text-slate-900 font-medium"
                variant="outline"
              >
                <Medal className="h-4 w-4 mr-2" />
                ë±ƒì§€ ë°œê¸‰ ì‹ ì²­í•˜ê¸°
              </Button>

              <div className="space-y-3">
                {userBadges.filter(ub => ub.status === 'approved' || !ub.status).length > 0 && (
                  <div>
                    <p className="text-xs text-slate-500 mb-2">ìŠ¹ì¸ëœ ë±ƒì§€</p>
                    <div className="flex flex-wrap gap-2 min-h-[60px] p-3 border border-slate-200 rounded-lg bg-slate-50">
                      {userBadges
                        .filter(ub => ub.status === 'approved' || !ub.status)
                        .map((userBadge) => {
                          const badge = userBadge.badges
                          if (!badge) return null
                          return (
                            <div
                              key={userBadge.id}
                              className="flex items-center gap-2 rounded-full bg-white px-3 py-1.5 text-sm font-medium border border-slate-200 shadow-sm"
                            >
                              <span className="text-base">{badge.icon}</span>
                              <span>{badge.name}</span>
                              <button
                                onClick={() => handleRemoveBadge(userBadge.id)}
                                className="ml-1 hover:bg-red-50 rounded-full p-0.5 transition-colors"
                                aria-label="ë±ƒì§€ ì‚­ì œ"
                              >
                                <X className="h-3.5 w-3.5 text-slate-400 hover:text-red-600" />
                              </button>
                            </div>
                          )
                        })}
                    </div>
                  </div>
                )}

                {userBadges.filter(ub => ub.status === 'pending').length > 0 && (
                  <div>
                    <p className="text-xs text-slate-500 mb-2">ì‹¬ì‚¬ ì¤‘ì¸ ë±ƒì§€</p>
                    <div className="flex flex-wrap gap-2 min-h-[60px] p-3 border border-amber-200 rounded-lg bg-amber-50">
                      {userBadges
                        .filter(ub => ub.status === 'pending')
                        .map((userBadge) => {
                          const badge = userBadge.badges
                          if (!badge) return null
                          return (
                            <div
                              key={userBadge.id}
                              className="flex items-center gap-2 rounded-full bg-white px-3 py-1.5 text-sm font-medium border border-amber-300 shadow-sm"
                            >
                              <span className="text-base">{badge.icon}</span>
                              <span>{badge.name}</span>
                              <Badge variant="outline" className="ml-1 text-xs bg-amber-100 text-amber-700 border-amber-300">
                                ì‹¬ì‚¬ ì¤‘
                              </Badge>
                            </div>
                          )
                        })}
                    </div>
                  </div>
                )}

                {userBadges.filter(ub => ub.status === 'rejected').length > 0 && (
                  <div>
                    <p className="text-xs text-slate-500 mb-2">ê±°ì ˆëœ ë±ƒì§€</p>
                    <div className="flex flex-wrap gap-2 min-h-[60px] p-3 border border-red-200 rounded-lg bg-red-50">
                      {userBadges
                        .filter(ub => ub.status === 'rejected')
                        .map((userBadge) => {
                          const badge = userBadge.badges
                          if (!badge) return null
                          return (
                            <div
                              key={userBadge.id}
                              className="flex items-center gap-2 rounded-full bg-white px-3 py-1.5 text-sm font-medium border border-red-300 shadow-sm opacity-60"
                            >
                              <span className="text-base">{badge.icon}</span>
                              <span>{badge.name}</span>
                              <Badge variant="outline" className="ml-1 text-xs bg-red-100 text-red-700 border-red-300">
                                ê±°ì ˆë¨
                              </Badge>
                            </div>
                          )
                        })}
                    </div>
                  </div>
                )}

                {userBadges.length === 0 && (
                  <div className="flex flex-wrap gap-2 min-h-[60px] p-3 border border-slate-200 rounded-lg bg-slate-50">
                    <p className="text-sm text-slate-500 w-full text-center py-2">
                      ì¶”ê°€ëœ ë±ƒì§€ê°€ ì—†ìŠµë‹ˆë‹¤.
                    </p>
                  </div>
                )}
              </div>
            </div>

            <div className="flex justify-end gap-2 pt-2">
              <Button
                variant="outline"
                onClick={() => setShowProfileEdit(false)}
                className="h-11 px-6"
              >
                ì·¨ì†Œ
              </Button>
              <Button
                onClick={handleSaveProfile}
                disabled={isSaving}
                className={cn(
                  "h-11 px-8 font-bold transition-all",
                  "bg-slate-900 hover:bg-slate-800 text-white shadow-md hover:shadow-lg",
                  isSaving && "opacity-70 cursor-not-allowed"
                )}
              >
                {isSaving ? (
                  <>
                    <Loader2 className="h-4 w-4 mr-2 animate-spin" />
                    ì €ì¥ ì¤‘...
                  </>
                ) : (
                  "ì €ì¥í•˜ê¸°"
                )}
              </Button>
            </div>
          </div>
        </DialogContent>
      </Dialog>

      {mainContent}
    </>
  )
}
</file>

<file path="components/community/community-info-sidebar.tsx">
"use client"

import { useEffect, useState } from "react"
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar"
import { Button } from "@/components/ui/button"
import { Badge } from "@/components/ui/badge"
import { Skeleton } from "@/components/ui/skeleton"
import {
  Collapsible,
  CollapsibleContent,
  CollapsibleTrigger,
} from "@/components/ui/collapsible"
import {
  Users,
  Shield,
  BookOpen,
  ChevronDown,
  UserPlus,
  UserMinus,
  Clock,
  Lock,
  Globe,
  Settings,
  Crown,
  Calendar,
} from "lucide-react"
import { cn } from "@/lib/utils"
import { toast } from "@/hooks/use-toast"
import { joinCommunity, leaveCommunity } from "@/lib/actions/community"
import { CommunitySettingsModal } from "./community-settings-modal"
import { ProfilePopover } from "@/components/ui/profile-popover"

/**
 * CommunityInfoSidebar - ì»¤ë®¤ë‹ˆí‹° ì •ë³´ ì‚¬ì´ë“œë°”
 *
 * ì»¤ë®¤ë‹ˆí‹° í˜ì´ì§€ ìš°ì¸¡ì— í‘œì‹œë˜ëŠ” ì •ë³´ ì‚¬ì´ë“œë°”
 * - ì»¤ë®¤ë‹ˆí‹° ì†Œê°œ
 * - ì´ìš©ìˆ˜ì¹™ (ì ‘ì´ì‹)
 * - ìš´ì˜ì ëª©ë¡
 * - ë©¤ë²„ ìˆ˜
 * - ê°€ì…/íƒˆí‡´ ë²„íŠ¼
 */

interface CommunityInfoSidebarProps {
  communityName: string | null
  userId?: string | null
}

interface CommunityData {
  id: string
  name: string
  description: string | null
  rules: string | null
  thumbnail_url: string | null
  banner_url: string | null
  is_private: boolean
  join_type: "free" | "approval" | "invite"
  created_by: string
  member_count: number
  creator: {
    id: string
    full_name: string | null
    avatar_url: string | null
  } | null
  moderators: Array<{
    id: string
    full_name: string | null
    avatar_url: string | null
    role: string
  }>
}

type MembershipStatus = "none" | "member" | "pending" | "admin" | "owner"

export function CommunityInfoSidebar({ communityName, userId }: CommunityInfoSidebarProps) {
  const [community, setCommunity] = useState<CommunityData | null>(null)
  const [membershipStatus, setMembershipStatus] = useState<MembershipStatus>("none")
  const [isLoading, setIsLoading] = useState(true)
  const [isJoining, setIsJoining] = useState(false)
  const [rulesOpen, setRulesOpen] = useState(false)
  const [currentUserId, setCurrentUserId] = useState<string | null>(userId || null)
  const [settingsOpen, setSettingsOpen] = useState(false)

  const canManage = membershipStatus === "owner" || membershipStatus === "admin"

  useEffect(() => {
    if (communityName) {
      fetchCommunityData()
    } else {
      setIsLoading(false)
    }
  }, [communityName])

  async function fetchCommunityData() {
    if (!communityName) {
      setIsLoading(false)
      return
    }

    try {
      setIsLoading(true)
      const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL
      const supabaseKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY

      let communityData = null
      let communityError = null

      try {
        const response = await fetch(
          `${supabaseUrl}/rest/v1/communities?name=eq.${encodeURIComponent(communityName)}&select=id,name,description,rules,thumbnail_url,banner_url,is_private,join_type,created_by`,
          {
            headers: {
              'apikey': supabaseKey!,
              'Authorization': `Bearer ${supabaseKey}`,
              'Content-Type': 'application/json',
            },
          }
        )

        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`)
        }

        const data = await response.json()
        communityData = data.length > 0 ? data[0] : null
      } catch (fetchErr) {
        communityError = fetchErr
      }

      if (communityError) {
        setIsLoading(false)
        return
      }

      if (!communityData) {
        // communities í…Œì´ë¸”ì— ì—†ìœ¼ë©´ ê¸°ë³¸ ì •ë³´ë§Œ í‘œì‹œ
        setCommunity({
          id: communityName,
          name: communityName,
          description: null,
          rules: null,
          thumbnail_url: null,
          banner_url: null,
          is_private: false,
          join_type: "free",
          created_by: "",
          member_count: 0,
          creator: null,
          moderators: [],
        })
        setMembershipStatus("member")
        setIsLoading(false)
        return
      }

      const currentUser = userId || null
      setCurrentUserId(currentUser)

      // ë³‘ë ¬ë¡œ ëª¨ë“  ë°ì´í„° ì¡°íšŒ (ì„±ëŠ¥ ìµœì í™”)
      const fetchHeaders = {
        'apikey': supabaseKey!,
        'Authorization': `Bearer ${supabaseKey}`,
      }

      // ê¸°ë³¸ ë³‘ë ¬ ìš”ì²­ ë°°ì—´
      const parallelRequests: Promise<any>[] = [
        // 1. ë©¤ë²„ ìˆ˜ ì¡°íšŒ
        fetch(
          `${supabaseUrl}/rest/v1/community_members?community_id=eq.${communityData.id}&select=id`,
          { headers: { ...fetchHeaders, 'Prefer': 'count=exact' } }
        ),
        // 2. ìš´ì˜ì ëª©ë¡ ì¡°íšŒ
        fetch(
          `${supabaseUrl}/rest/v1/community_members?community_id=eq.${communityData.id}&role=in.(owner,admin)&select=role,profiles:user_id(id,full_name,avatar_url)`,
          { headers: fetchHeaders }
        ),
        // 3. ìƒì„±ì ì •ë³´ ì¡°íšŒ (í•­ìƒ ì¡°íšŒ, ë‚˜ì¤‘ì— í•„ìš” ì—¬ë¶€ íŒë‹¨)
        communityData.created_by
          ? fetch(
              `${supabaseUrl}/rest/v1/profiles?id=eq.${communityData.created_by}&select=id,full_name,avatar_url`,
              { headers: fetchHeaders }
            )
          : Promise.resolve(null),
      ]

      // 4. í˜„ì¬ ìœ ì €ì˜ ë©¤ë²„ì‹­ ìƒíƒœ ì¡°íšŒ (ë¡œê·¸ì¸í•œ ê²½ìš°)
      if (currentUser && communityData.created_by !== currentUser) {
        parallelRequests.push(
          fetch(
            `${supabaseUrl}/rest/v1/community_members?community_id=eq.${communityData.id}&user_id=eq.${currentUser}&select=role`,
            { headers: fetchHeaders }
          )
        )
      }

      // ëª¨ë“  ìš”ì²­ ë³‘ë ¬ ì‹¤í–‰
      const results = await Promise.all(parallelRequests)
      const [memberCountRes, modsRes, creatorRes, membershipRes] = results

      // ë©¤ë²„ ìˆ˜ íŒŒì‹±
      let memberCount = 0
      if (memberCountRes) {
        const countHeader = memberCountRes.headers.get('content-range')
        if (countHeader) {
          const match = countHeader.match(/\/(\d+)$/)
          if (match) memberCount = parseInt(match[1], 10)
        }
      }

      // ìš´ì˜ì ëª©ë¡ íŒŒì‹±
      let moderatorsData: any[] = []
      if (modsRes?.ok) {
        moderatorsData = await modsRes.json()
      }

      // ìƒì„±ìê°€ ìš´ì˜ì ëª©ë¡ì— ì—†ìœ¼ë©´ ì¶”ê°€
      if (communityData.created_by && creatorRes?.ok) {
        const creatorInList = moderatorsData.some(
          (m: any) => m.profiles?.id === communityData.created_by
        )
        if (!creatorInList) {
          const creatorData = await creatorRes.json()
          if (creatorData.length > 0) {
            moderatorsData.unshift({
              role: 'owner',
              profiles: creatorData[0]
            })
          }
        }
      }

      // ë©¤ë²„ì‹­ ìƒíƒœ ê²°ì •
      if (currentUser) {
        if (communityData.created_by === currentUser) {
          setMembershipStatus("owner")
        } else if (membershipRes?.ok) {
          const membershipData = await membershipRes.json()
          if (membershipData.length > 0) {
            const role = membershipData[0].role as MembershipStatus
            if (role === "owner" || role === "admin") {
              setMembershipStatus(role)
            } else {
              setMembershipStatus("member")
            }
          } else {
            // ë©¤ë²„ê°€ ì•„ë‹Œ ê²½ìš°: ê°€ì… ì‹ ì²­ ìƒíƒœ í™•ì¸ (ì¶”ê°€ ìš”ì²­ í•„ìš”)
            try {
              const joinReqRes = await fetch(
                `${supabaseUrl}/rest/v1/community_join_requests?community_id=eq.${communityData.id}&user_id=eq.${currentUser}&status=eq.pending&select=status`,
                { headers: fetchHeaders }
              )
              if (joinReqRes.ok) {
                const joinReqData = await joinReqRes.json()
                setMembershipStatus(joinReqData.length > 0 ? "pending" : "none")
              }
            } catch (err) {
              setMembershipStatus("none")
            }
          }
        }
      }

      const validModerators = (moderatorsData || [])
        .filter((m: any) => m.profiles && m.profiles.id)
        .map((m: any) => ({
          id: m.profiles.id,
          full_name: m.profiles.full_name,
          avatar_url: m.profiles.avatar_url,
          role: m.role,
        }))

      setCommunity({
        id: communityData.id,
        name: communityData.name,
        description: communityData.description,
        rules: communityData.rules || null,
        thumbnail_url: communityData.thumbnail_url,
        banner_url: communityData.banner_url || null,
        is_private: communityData.is_private,
        join_type: communityData.join_type || "free",
        created_by: communityData.created_by,
        member_count: memberCount || 0,
        creator: null,
        moderators: validModerators,
      })
    } catch (error) {
      console.error("[CommunityInfoSidebar] ì»¤ë®¤ë‹ˆí‹° ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:", error)
    } finally {
      setIsLoading(false)
    }
  }

  async function handleJoin() {
    if (!currentUserId || !community) return

    setIsJoining(true)
    try {
      if (community.join_type === "approval") {
        // ìŠ¹ì¸ì œ: ê°€ì… ì‹ ì²­ (fetch API ì‚¬ìš©)
        const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL
        const supabaseKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY

        const response = await fetch(
          `${supabaseUrl}/rest/v1/community_join_requests`,
          {
            method: 'POST',
            headers: {
              'apikey': supabaseKey!,
              'Authorization': `Bearer ${supabaseKey}`,
              'Content-Type': 'application/json',
              'Prefer': 'return=minimal',
            },
            body: JSON.stringify({
              community_id: community.id,
              user_id: currentUserId,
            }),
          }
        )

        if (!response.ok) {
          throw new Error('ê°€ì… ì‹ ì²­ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.')
        }

        setMembershipStatus("pending")
        toast({ description: "ê°€ì… ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ìš´ì˜ì ìŠ¹ì¸ì„ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”." })
      } else {
        // ììœ  ê°€ì…
        const result = await joinCommunity(community.id)
        if (result.error) throw new Error(result.error)

        setMembershipStatus("member")
        toast({ description: "ì»¤ë®¤ë‹ˆí‹°ì— ê°€ì…ë˜ì—ˆìŠµë‹ˆë‹¤!" })
        fetchCommunityData() // ë©¤ë²„ ìˆ˜ ê°±ì‹ 
      }
    } catch (error: any) {
      toast({
        title: "ê°€ì… ì‹¤íŒ¨",
        description: error.message || "ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.",
        variant: "destructive",
      })
    } finally {
      setIsJoining(false)
    }
  }

  async function handleLeave() {
    if (!community) return

    setIsJoining(true)
    try {
      const result = await leaveCommunity(community.id)
      if (result.error) throw new Error(result.error)

      setMembershipStatus("none")
      toast({ description: "ì»¤ë®¤ë‹ˆí‹°ì—ì„œ íƒˆí‡´í–ˆìŠµë‹ˆë‹¤." })
      fetchCommunityData() // ë©¤ë²„ ìˆ˜ ê°±ì‹ 
    } catch (error: any) {
      toast({
        title: "íƒˆí‡´ ì‹¤íŒ¨",
        description: error.message || "ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.",
        variant: "destructive",
      })
    } finally {
      setIsJoining(false)
    }
  }

  if (isLoading) {
    return (
      <div className="space-y-4">
        <Card>
          <CardContent className="p-4 space-y-3">
            <Skeleton className="h-6 w-32" />
            <Skeleton className="h-4 w-full" />
            <Skeleton className="h-4 w-3/4" />
            <Skeleton className="h-10 w-full" />
          </CardContent>
        </Card>
      </div>
    )
  }

  if (!community) {
    return null
  }

  return (
    <div className="space-y-2">
      {/* í†µí•© ì‚¬ì´ë“œë°” ì¹´ë“œ - ê¹”ë”í•œ í°ìƒ‰ ë°°ê²½ */}
      <Card className="overflow-hidden bg-white shadow-sm border-slate-200">
        {/* í—¤ë” ì„¹ì…˜ - í”„ë¡œí•„ ì‚¬ì§„ ì œê±°, ì´ë¦„ë§Œ í‘œì‹œ */}
        <div className="p-4">
          <h3 className="font-semibold text-slate-900 leading-tight">{community.name}</h3>
          <div className="flex items-center gap-2 mt-1.5 text-xs text-slate-500">
            <span>{community.member_count.toLocaleString()} members</span>
          </div>
        </div>

        {/* ì†Œê°œê¸€ */}
        {community.description && (
          <div className="px-4 pb-3">
            <p className="text-[13px] text-slate-600 leading-relaxed">
              {community.description}
            </p>
          </div>
        )}

        {/* ê³µê°œ/ë¹„ê³µê°œ ìƒíƒœ - Reddit ìŠ¤íƒ€ì¼ */}
        <div className="px-4 pb-3">
          <div className="flex items-center gap-1.5 text-xs text-slate-500">
            {community.is_private ? (
              <>
                <Lock className="h-3.5 w-3.5" />
                <span>ë¹„ê³µê°œ</span>
              </>
            ) : (
              <>
                <Globe className="h-3.5 w-3.5" />
                <span>ê³µê°œ</span>
              </>
            )}
          </div>
        </div>

        {/* ì•¡ì…˜ ë²„íŠ¼ */}
        {(canManage || (currentUserId && !canManage && (membershipStatus === "none" || membershipStatus === "pending"))) && (
          <div className="px-4 pb-4">
            {canManage && (
              <Button
                className="w-full h-9 bg-slate-900 hover:bg-slate-800 text-white"
                size="sm"
                onClick={() => setSettingsOpen(true)}
              >
                <Settings className="h-3.5 w-3.5 mr-1.5" />
                ì»¤ë®¤ë‹ˆí‹° ì„¤ì •
              </Button>
            )}
            {currentUserId && !canManage && membershipStatus === "none" && (
              <Button
                className="w-full h-9 bg-slate-900 hover:bg-slate-800 text-white"
                size="sm"
                onClick={handleJoin}
                disabled={isJoining}
              >
                <UserPlus className="h-3.5 w-3.5 mr-1.5" />
                {community.join_type === "approval" ? "ê°€ì… ì‹ ì²­" : "ì»¤ë®¤ë‹ˆí‹° ê°€ì…"}
              </Button>
            )}
            {currentUserId && !canManage && membershipStatus === "pending" && (
              <Button className="w-full h-9" variant="secondary" size="sm" disabled>
                <Clock className="h-3.5 w-3.5 mr-1.5" />
                ìŠ¹ì¸ ëŒ€ê¸°ì¤‘
              </Button>
            )}
          </div>
        )}

        {/* ë¦¬ë” & ìš´ì˜ì§„ ì„¹ì…˜ */}
        {community.moderators.length > 0 && (
          <>
            <div className="border-t border-slate-100" />
            <div className="p-4 space-y-3">
              {/* ë¦¬ë” (owner) - ì¹´ë“œ ìŠ¤íƒ€ì¼ë¡œ ê°•ì¡° */}
              {community.moderators.filter(m => m.role === "owner").slice(0, 1).map((leader) => (
                <div key={leader.id}>
                  <div className="flex items-center gap-1.5 mb-2">
                    <Crown className="h-3 w-3 text-amber-500" />
                    <span className="text-[11px] font-medium text-slate-500 uppercase tracking-wide">ë¦¬ë”</span>
                  </div>
                  <ProfilePopover profile={{ id: leader.id, full_name: leader.full_name, avatar_url: leader.avatar_url }}>
                    <button type="button" className="w-full flex items-center gap-3 p-3 bg-gradient-to-r from-amber-50 to-orange-50 rounded-xl border border-amber-100/50 hover:from-amber-100 hover:to-orange-100 transition-colors cursor-pointer">
                      <Avatar className="h-10 w-10 shrink-0 ring-2 ring-white shadow-sm">
                        <AvatarImage src={leader.avatar_url || undefined} />
                        <AvatarFallback className="text-sm font-medium bg-amber-100 text-amber-700">
                          {leader.full_name?.charAt(0) || "?"}
                        </AvatarFallback>
                      </Avatar>
                      <div className="min-w-0 flex-1 text-left">
                        <span className="text-[13px] font-semibold text-slate-800 block truncate hover:underline">
                          {leader.full_name || "ìµëª…"}
                        </span>
                        <span className="text-[11px] text-amber-600/80">Community Leader</span>
                      </div>
                    </button>
                  </ProfilePopover>
                </div>
              ))}
              {/* ìš´ì˜ì§„ (admin) - ì»´íŒ©íŠ¸ ë¦¬ìŠ¤íŠ¸ */}
              {community.moderators.filter(m => m.role === "admin").length > 0 && (
                <div>
                  <div className="flex items-center gap-1.5 mb-2">
                    <Shield className="h-3 w-3 text-slate-400" />
                    <span className="text-[11px] font-medium text-slate-500 uppercase tracking-wide">ìš´ì˜ì§„</span>
                  </div>
                  <div className="space-y-1">
                    {community.moderators.filter(m => m.role === "admin").map((admin) => (
                      <ProfilePopover key={admin.id} profile={{ id: admin.id, full_name: admin.full_name, avatar_url: admin.avatar_url }}>
                        <button type="button" className="w-full flex items-center gap-2.5 py-1.5 px-2 rounded-lg hover:bg-slate-50 transition-colors cursor-pointer">
                          <Avatar className="h-7 w-7 shrink-0">
                            <AvatarImage src={admin.avatar_url || undefined} />
                            <AvatarFallback className="text-[10px] bg-slate-100 text-slate-600">
                              {admin.full_name?.charAt(0) || "?"}
                            </AvatarFallback>
                          </Avatar>
                          <span className="text-[13px] text-slate-700 truncate hover:underline">
                            {admin.full_name || "ìµëª…"}
                          </span>
                        </button>
                      </ProfilePopover>
                    ))}
                  </div>
                </div>
              )}
            </div>
          </>
        )}

        {/* ì´ìš©ìˆ˜ì¹™ ì„¹ì…˜ */}
        {community.rules && (
          <>
            <div className="border-t border-slate-100" />
            <div className="p-4">
              <Collapsible open={rulesOpen} onOpenChange={setRulesOpen}>
                <CollapsibleTrigger className="flex items-center justify-between w-full text-[11px] font-medium text-slate-400 uppercase tracking-wide hover:text-slate-600 transition-colors">
                  <div className="flex items-center gap-1.5">
                    <BookOpen className="h-3 w-3" />
                    <span>Rules</span>
                  </div>
                  <ChevronDown
                    className={cn(
                      "h-3.5 w-3.5 transition-transform duration-200",
                      rulesOpen && "rotate-180"
                    )}
                  />
                </CollapsibleTrigger>
                <CollapsibleContent className="pt-2.5">
                  <div className="text-[13px] text-slate-600 bg-slate-50 rounded-lg p-3 whitespace-pre-wrap leading-relaxed border border-slate-100">
                    {community.rules}
                  </div>
                </CollapsibleContent>
              </Collapsible>
            </div>
          </>
        )}
      </Card>

      {/* ì»¤ë®¤ë‹ˆí‹° íƒˆí‡´ ë²„íŠ¼ - ì¹´ë“œ ë°– í•˜ë‹¨ì— ë°°ì¹˜ */}
      {currentUserId && !canManage && membershipStatus === "member" && (
        <button
          onClick={handleLeave}
          disabled={isJoining}
          className="w-full text-[11px] text-slate-400 hover:text-red-500 py-2 transition-colors disabled:opacity-50"
        >
          ì»¤ë®¤ë‹ˆí‹° íƒˆí‡´
        </button>
      )}

      {/* ì„¤ì • ëª¨ë‹¬ */}
      {community && canManage && (
        <CommunitySettingsModal
          open={settingsOpen}
          onOpenChange={setSettingsOpen}
          community={{
            id: community.id,
            name: community.name,
            description: community.description,
            is_private: community.is_private,
            rules: community.rules,
            thumbnail_url: community.thumbnail_url,
            banner_url: community.banner_url,
          }}
          isOwner={membershipStatus === "owner"}
          onSuccess={fetchCommunityData}
        />
      )}
    </div>
  )
}
</file>

</files>
